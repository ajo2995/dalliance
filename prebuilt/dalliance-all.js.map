{"version":3,"sources":["node_modules/browser-pack/_prelude.js","js/bam.js","dalliance-all.js","js/bedwig.js","js/bigwig.js","js/bin.js","js/browser-ui.js","js/cbrowser.js","js/chainset.js","js/cigar.js","js/color.js","js/cram.js","js/das.js","js/default-renderer.es6","js/domui.js","js/dummy-renderer.es6","js/encode.js","js/ensembljson.js","js/export-config.js","js/export-image.js","js/export-ui.js","js/exports.js","js/feature-draw.js","js/feature-popup.js","js/features.js","js/glyphs.js","js/jbjson.js","js/kspace.js","js/lh3utils.js","js/memstore.js","js/multi-renderer.es6","js/numformats.js","js/overlay.js","js/probe.js","js/rulers.es6","js/sample.js","js/search.js","js/sequence-draw.js","js/session.js","js/sha1.js","js/sourceadapters.js","js/sourcecompare.js","js/spans.js","js/style.js","js/sub-renderer.es6","js/svg-export.js","js/svg-utils.js","js/tabix-source.js","js/tabix.js","js/test-source.es6","js/thub.js","js/tier-actions.js","js/tier-edit.js","js/tier.js","js/track-adder.js","js/trix.js","js/twoBit.js","js/utils.js","js/vcf.js","js/version.js","js/zoomslider.js","node_modules/es6-promise/dist/commonjs/main.js","node_modules/es6-promise/dist/commonjs/promise/all.js","node_modules/es6-promise/dist/commonjs/promise/asap.js","node_modules/es6-promise/dist/commonjs/promise/cast.js","node_modules/es6-promise/dist/commonjs/promise/config.js","node_modules/es6-promise/dist/commonjs/promise/polyfill.js","node_modules/es6-promise/dist/commonjs/promise/promise.js","node_modules/es6-promise/dist/commonjs/promise/race.js","node_modules/es6-promise/dist/commonjs/promise/reject.js","node_modules/es6-promise/dist/commonjs/promise/resolve.js","node_modules/es6-promise/dist/commonjs/promise/utils.js","node_modules/jszlib/js/inflate.js","node_modules/process/browser.js","node_modules/ramda/dist/ramda.js","node_modules/revalidator/lib/revalidator.js"],"names":["e","t","n","r","s","o","u","a","require","i","f","Error","code","l","exports","call","length","1","module","BamFile","_getBaiRefLength","uncba","offset","p","nbin","readInt","b","nchnk","nintv","minBlockIndex","q","v","readVob","bi","block","makeBam","data","bai","indexChunks","callback","attempted","slice","fetch","header","makeBam2","timeout","parseBamHeader","unc","unbgzf","byteLength","Uint8Array","magic","BAM_MAGIC","toString","headLen","String","fromCharCode","nRef","bam","chrToIndex","indexToChr","lName","name","j","indexOf","substring","push","indices","parseBai","baiMagic","BAI_MAGIC","nref","ref","blockStart","Math","min","chunks","result","url","replace","RegExp","BamRecord","spans","bin","Range","union","intersection","readShort","readByte","readFloat","readInt64","lh3utils","reg2bins","Chunk","BamFlags","MULTIPLE_SEGMENTS","ALL_SEGMENTS_ALIGN","SEGMENT_UNMAPPED","NEXT_SEGMENT_UNMAPPED","REVERSE_COMPLEMENT","NEXT_REVERSE_COMPLEMENT","FIRST_SEGMENT","LAST_SEGMENT","SECONDARY_ALIGNMENT","QC_FAIL","DUPLICATE","SUPPLEMENTARY","prototype","blocksForRange","refId","max","index","this","intBinsL","intBins","leafChunks","otherChunks","c","cs","ce","lowest","minLin","maxLin","lb","prunedOtherChunks","chnk","maxv","intChunks","sort","c0","c1","dif","minv","mergedChunks","cur","nc","chr","opts","tramp","records","ba","finished","thisB","readBamRecords","chrId","fetchMin","fetchMax","undefined","start_stop","buffer","bind","SEQRET_DECODER","CIGAR_DECODER","sink","blockSize","blockEnd","record","refID","pos","bmn","mq","nl","flag_nc","flag","lseq","nextRef","nextPos","segment","light","seqLength","includeName","readName","nextSegment","cigar","cigop","seq","seqBytes","sb","qseq","quals","value","tag","type","cc","elen","reader","atype","alen","./bin","./lh3utils","./spans","2","BedWigParser","BedParseSession","parser","WigParseSession","wigState","sa","dalliance_registerParserFactory","registerParserFactory","das","DASStylesheet","DASStyle","DASGroup","DASFeature","utils","shallowCopy","revalidator","createSession","__KV_REGEXP","__SPACE_REGEXP","BED_COLOR_REGEXP","parse","line","toks","split","start","parseInt","end","label","score","parseFloat","orientation","color","test","itemRgb","thickStart","thickEnd","blockCount","blockSizes","map","x","blockStarts","grp","id","notes","groups","geneId","geneName","gg","bmin","bmax","span","tsList","ranges","ts","bf","codingRegion","tl","tlList","readingFrame","readframe","flush","schema","properties","description","required","minimum","enum","itemRGB","pattern","maximum","items","validate","check","valid","console","log","errors","step","ti","m","exec","getStyleSheet","stylesheet","wigStyle","glyph","BGCOLOR","HEIGHT","pushStyle","FGCOLOR","BUMP","LABEL","ZINDEX","tsStyle","densStyle","COLOR1","COLOR2","./das","./sourceadapters","./utils","3","bwg_readOffset","M1","M2","M3","M4","BigWig","BigWigView","bwg","cirTreeOffset","cirTreeLength","isSummary","makeBwg","salted","Int16Array","la","Int32Array","BIG_WIG_MAGIC","BIG_BED_MAGIC","BIG_WIG_MAGIC_BE","BIG_BED_MAGIC_BE","version","numZoomLevels","chromTreeOffset","unzoomedDataOffset","unzoomedIndexOffset","fieldCount","definedFieldCount","asOffset","totalSummaryOffset","uncompressBufSize","extHeaderOffset","zoomLevels","zl","zlReduction","zlData","zlIndex","reduction","dataOffset","indexOffset","readChromTree","getAutoSQL","as","BBIExtraIndex","bbi","field","jszlib","jszlib_inflate_buffer","inflateBuffer","arrayCopy","BIG_WIG_TYPE_GRAPH","BIG_WIG_TYPE_VSTEP","BIG_WIG_TYPE_FSTEP","chromsToIDs","idsToChroms","maxID","udo","eb","bpt","keySize","rootNodeOffset","bptReadNode","nodeType","cnt","childOffset","key","ki","charCode","chromId","substr","readWigData","chrName","readWigDataById","cirHeader","cirBlockSize","blocksToFetch","outstanding","filter","Date","now","fmin","fmax","cirFobRecur","level","instrument","cachedCirRoot","cirFobRecur2","fetchFeatures","maxCirBlockSpan","blockSpan","fetchRanges","fr","cirFobStartFetch","attempts","resultBuffer","contains","cirBlockData","isLeaf","lo","startChrom","startBase","endChrom","endBase","blockOffset","size","recurOffsets","b0","b1","features","createFeature","_chromId","k","parseFeatures","splice","fetchStart","fetchSize","fb","tmp","fa","Float32Array","itemCount","validCnt","maxVal","sumData","summaryOpts","maxScore","itemStep","itemSpan","blockType","dfc","rest","ch","bedColumns","featureOpts","isNaN","col","fields","exonFrames","geneName2","spanList","tlOffset","brf","readframeExplicit","getFirstAdjacent","dir","getFirstAdjacentById","blockToFetch","bestBlockChr","bestBlockOffset","chrx","bestFeature","bestChr","bestPos","fi","bestRecur","getUnzoomedView","unzoomedView","cirLen","nzl","getZoomedView","z","zh","view","_tsFetch","zoom","topLevelReductionCache","feats","thresholdSearch","referencePoint","threshold","fbThresholdSearchRecur","candidates","c2","d","chrOrd","candidate","rp","fromRef","initialChr","header_re","field_re","headerMatch","declType","comment","getExtraIndices","extraIndexCount","extraIndexListOffset","eil","ii","eiType","eiFieldCount","eiOffset","eiField","lookup","nodeOffset","valSize","node","Uint16Array","Uint32Array","lastChildOffset","localeCompare","4","BlobFetchable","blob","URLFetchable","_typeof","bstringToBuffer","charCodeAt","buf","readIntBE","Symbol","iterator","obj","constructor","sha1","b64_sha1","Promise","webkitSlice","FileReader","onloadend","ev","readAsBinaryString","FileReaderSync","res","readAsArrayBuffer","ns","ne","seed","isSafari","navigator","userAgent","fetchAsText","getURL","then","req","XMLHttpRequest","salt","open","setRequestHeader","onreadystatechange","readyState","status","responseText","credentials","withCredentials","send","err","resolver","urlOrObj","resolve","attempt","truncatedLength","setTimeout","abort","overrideMimeType","responseType","clearTimeout","response","bl","mozResponseArrayBuffer","convertBuffer","ArrayBuffer","./sha1","es6-promise","5","humanReadableScale","suffix","round","browser","Browser","makeElement","nf","removeChildren","formatLongInt","makeZoomSlider","initUI","holder","genomePanel","noSourceCSS","forEach","path","document","head","appendChild","rel","href","resolveURL","disableDefaultFeaturePopup","addFeatureListener","feature","hit","tier","featurePopup","classList","add","toolbar","className","title","coordSystem","speciesName","nameForCoordSystem","setDocumentTitle","locField","makeTooltip","locStatusField","zoomInBtn","zoomSlider","width","zoomSliderWidth","zoomOutBtn","clearHighlightsButton","addTrackBtn","favBtn","svgBtn","optsButton","helpButton","tierEditButton","leapLeftButton","leapRightButton","modeButtons","noTrackAdder","noTrackEditor","noExport","noOptions","noHelp","setUiMode","uiMode","mb","help","export","remove","noLeapButtons","firstChild","noTitle","margin","noLocationField","noClearHighlightsButton","noZoomSlider","toolbarBelow","lt2","lt5","roundSliderValue","rounded","ltx","zoomExpt","zoomBase","whole","frac","markSlider","addLabel","exp","addViewListener","_oldZoom","isSnapZooming","alternate","value2","current","active","removeLabels","zmin","zmax","zrange","numSliderTicks","sti","storeStatus","storeViewStatus","highlights","style","display","addTierListener","storeTierStatus","addEventListener","keyCode","preventDefault","stopPropagation","setSelectedTier","g","search","textContent","trackAddPopup","displayed","removeAllPopups","showTrackAdder","zoomStep","wantSnap","savedZoom","zoomSliderValue","zoomMin","activeZSV","openExportPanel","toggleOptsPopup","toggleHelpPopup","selectedTiers","openTierPanel","tiers","leap","reverseKeyScrolling","st","getSelectedTier","featureSource","sourceAdapterIsCapable","quantLeapThreshold","config","dasSource","addTierSelectionListener","canLeap","clearHighlights","addTierSelectionWrapListener","focus","sel","hideToolPanel","manipulatingTier","ft","uiKeyHandler","removeEventListener","browserHolder","showToolPanel","panel","nowrap","activeToolPanel","parentElement","removeChild","content","overflowY","divider","svgHolder","resizeViewer","helpFrame","scrolling","seamless","src","optsForm","boxSizing","MozBoxSizing","verticalAlign","optsTable","cellPadding","scrollModeButton","checked","reverseScrolling","align","scrollKeyButton","rulerSelect","rulerLocation","positionRuler","paintQuant","singleBaseHighlightButton","singleBaseHighlight","setAttribute","resetButton","marginLeft","marginRight","reset","./cbrowser","./export-config","./export-image","./export-ui","./numformats","./session","./svg-export","./tier-edit","./zoomslider","6","Region","renderers","default","DefaultRenderer","dummy","DummyRenderer","multi","MultiRenderer","sub","SubRenderer","defaultRenderer","renderer","prefix","sources","tierGroups","searchOnlySources","searchOnlySourceHolders","featureListeners","featureHoverListeners","viewListeners","regionSelectListeners","tierListeners","tierSelectionListeners","tierSelectionWrapListeners","cookieKey","chains","pageName","zoomFactor","maxPixelsPerBase","origin","targetQuantRes","featurePanelWidth","entryPoints","currentSeqMax","maxViewWidth","defaultSubtierMax","highZoomThreshold","mediumZoomThreshold","minExtraWidth","maxExtraWidth","defaultHighlightFill","defaultHighlightAlpha","exportHighlights","exportRuler","exportBanner","exportRegion","tierBackgroundColors","minTierHeight","noDefaultLabels","availableSources","Observed","defaultSources","mappableSources","registry","noRegistryTabs","defaultTrackAdderTab","hubs","hubObjects","sourceCache","SourceCache","retina","useFetchWorkers","maxWorkers","workerPath","resolvers","resolverSeed","assemblyNamePrimary","assemblyNameUcsc","defaultSearchRegionPadding","httpCanaryURL","httpWarningURL","initListeners","baseColors","aminoAcids","F","L","I","M","V","S","P","T","A","Y","H","Q","N","K","D","E","C","W","R","G","-","viewStart","viewEnd","offscreenInitWidth","uiPrefix","location","window","hostname","port","proto","protocol","realInit","loadListener","setSources","msh","maybeMapping","mapping","set","glyphLookup","glyphs","rx","ry","matches","gi","notSelectable","minY","maxY","group","FetchWorker","worker","tagSeed","callbacks","onmessage","cmd","postMessage","cb","error","makeFetchWorker","wurl","wscript","VERSION","wblob","Blob","reject","Worker","URL","createObjectURL","onerror","message","sourcesByURI","Awaited","miniJSONify","textXHR","DasTier","hex_sha1","thub","connectTrackHub","formatQuantLabel","Chainset","sourcecompare","sourcesAreEqual","sourcesAreEqualModuloStyle","sourceDataURI","sourceStyleURI","destroy","resizeListener","fetchWorkers","_iteratorNormalCompletion","_didIteratorError","_iteratorError","_step","_iterator","next","done","terminate","self","wasInitialized","ua","disablePinning","defaultChr","defaultStart","defaultEnd","restoreStatus","statusRestored","injectionPoint","Element","browserHolderHolder","getElementById","tabIndex","maxHeight","pinnedTierHolder","tierHolder","makeLoader","locSingleBase","locSingleBaseHolder","minFloor","maxFloor","zoomSliderDict","loc","createTextNode","tierHolderHolder","bhtmlRoot","disablePoweredBy","ruler","ruler2","chainConfigs","promisedWorkers","pw","all","nextWorker","getComputedStyle","getBoundingClientRect","realInit2","pollInterval","setInterval","clearInterval","_this","scale","zoomMax","wheelDeltaX","delta","move","wheelDeltaY","scrollTop","axis","detail","touchStartHandler","touchMoveHandler","touchEndHandler","touchCancelHandler","keyHandler","layoutsChanged","wantedLayoutHeight","layoutHeight","clipTier","arrangeTiers","newZoom","scrollArrowKey","shiftKey","tt","forceHeight","subtiers","height","mergeConfig","ctrlKey","metaKey","th","tq","quant","qmin","qmax","qscale","notify","altKey","contiguous","mt","si","ip","withPreservedSelection","_ensureTiersGrouped","markSelectedTiers","notifyTierSelection","reorderTiers","notifyTier","nst","top","row","offsetTop","bottom","offsetHeight","notifyTierSelectionWrap","it","discontig","infoVisible","infoElement","updateHeight","bumpStatus","collapseSuperGroups","bumped","mergeSelectedTiers","addTier","pinned","hPopupHolder","body","source","restoredConfigs","disabled","makeTier","refreshTier","_iteratorNormalCompletion2","_didIteratorError2","_iteratorError2","_step2","_iterator2","_source","_createSources","createSources","onFirstRender","firstRenderPromise","ss","getSequenceSource","getSeqInfo","queryRegistry","hi","hc","hub","tdb","genome","genomes","ucscName","altLabel","fullScreen","setFullScreenHeight","setLocation","touchOriginX","touches","pageX","touchOriginY","pageY","sep","abs","zooming","zoomLastSep","zoomInitialSep","zoomInitialScale","touchX","touchY","cp","scp","getRenderer","drawTier","realMakeTier","stack","background","oorigin","dragOrigin","dragMoveOrigin","hoverTimeout","isDragging","featureLookup","padding","glyphCacheOrigin","dragMoveHandler","clientX","dragUpHandler","viewport","clientY","br","left","cursor","notifyFeatureHover","doubleClickTimeout","featureDoubleClick","notifyFeature","sequenceSource","notifyRegionSelect","removeButton","removeTier","nameButton","hitTier","bumpButton","dragLabel","dragTierHolder","dragTierHolderScrollLimit","tierOrdinal","yAtLastReorder","tiersWereReordered","labelDragHandler","scrollHeight","cloneNode","visibility","holderBCR","pty","ttr","tix","labelReleaseHandler","init","updatedTier","currentlyHeight","updateLabel","_updateFromConfig","hasPinned","pinnedTiers","unpinnedTiers","visible","xi","tierCallback","getTierRenderer","renderCallback","renderTier","knownSpace","invalidate","down","groupedTiers","tierGroup","pusho","newTiers","reverse","nt","nti","arrangedTiers","element","parentNode","setBackground","refresh","retrieveTierData","drawOverlays","notifyLocation","minExtraW","maxExtraW","newOrigin","oh","scaleAtLastRedraw","od","originHaxx","scaledQuantRes","innerDrawnStart","innerDrawnEnd","outerDrawnStart","outerDrawnEnd","cancel","KnownSpace","seg","bestCacheOverlapping","drawnStart","drawnEnd","retrieveFeatures","tryCache","coords","cacheHash","cacheTime","localStorage","JSON","cacheAge","rex","rurl","DASRegistry","scoords","taxon","auth","stringify","soft","wid","nStart","nEnd","oz","nz","factor","viewCenter","len","spaceCheck","dontRefresh","skipRefresh","oldFPW","viewWidth","nve","innerHeight","conf","force","target","targetTier","featureCache","removeAllTiers","_sequenceSource","_getSequenceSource","provides_entrypoints","tier_type","twoBitURI","twoBitBlob","TwoBitSequenceSource","ensemblURI","EnsemblSequenceSource","DASSequenceSource","newChr","newMin","newMax","oldNewMin","_setLocation","findChr","altChr","si2","newChrInfo","chrChanged","newWidth","csm","newScale","oldScale","scaleChanged","newZS","oldZS","viewportHolder","overlay","difToActive","difToSaved","norigin","drawOverlay","instrumentActivity","activityStartTime","setCenterLocation","newCenterLoc","halfWidth","pingActivity","activity","loaderButton","addInitListener","handler","removeFeatureListener","idx","arrayIndexOf","fli","ex","addFeatureHoverListener","removeFeatureHoverListener","removeViewListener","nvs","lli","removeTierListener","tli","addRegionSelectListener","removeRegionSelectListener","rli","highlightRegion","_highlightRegion","h","visStart","visEnd","featuresInRegion","fl","currentFeatures","button","browserMid","removeTierSelectionListener","removeTierSelectionWrapListener","right","borderWidth","borderRightWidth","centreOffset","offsetWidth","quantOverlay","fstart","fwidth","newMid","zoomForScale","ssScale","zoomForCurrentScale","tierTotal","currentHeight","fedge","mid","findNextFeature","nxt","nmin","nmax","newStart","newEnd","alert","primary","ucsc","devicePixelRatio","canFetchPlainHTTP","_plainHTTPPromise","getWorker","postCommand","command","uri","registerResolver","transfer","EnsemblProteinSequenceSource","get","scb","configs","put","./browser-ui","./chainset","./default-renderer","./domui","./dummy-renderer","./feature-popup","./kspace","./multi-renderer","./search","./sourcecompare","./sub-renderer","./thub","./tier","./tier-actions","./track-adder","./version","7","srcTag","destTag","chainsBySrc","chainsByDest","postFetchQueues","fetchedTiles","granularity","chainFetcher","BBIChainFetcher","AliasChainFetcher","DASChainFetcher","DASSource","pi","cleanChr","bbiFeatureToChain","chain","srcChr","srcChrom","srcMin","srcStart","srcMax","srcEnd","srcOri","destChr","destMin","destMax","destOri","ori","blocks","srcStarts","destStarts","blockLengths","blockLens","forwardAliases","sequenceAliases","ai","al","DASSegment","parseCigar","exportConfig","mapPoint","ci","cpos","bSrc","bDest","bSize","dpos","apos","flipped","mapSegment","mappings","cmin","cmax","partialMax","partialMin","unmapPoint","sourceBlocksForRange","STATE_PENDING","STATE_FETCHED","thisCS","minTile","maxTile","needsNewOrPending","needsNewFetch","tn","fetchChains","cbs","present","oci","oc","cbd","pfq","srcBlocks","amin","amax","_min","_max","alignments","aligns","aln","srcSeg","destSeg","segments","objects","object","dbSource","accession","strand","srcops","destops","srcOffset","destOffset","srci","desti","op","blockLen","resp","./bigwig","./cigar","8","match","cigops","CIGAR_REGEXP","count","9","DColour","red","green","blue","hex2","y","dasColourForName","palette","COLOR_RE","CSS_COLOR_RE","black","makeColourSteps","steps","stops","colours","dcolours","grad","STEP_LOOP","rs","ca","fill","toSvgString","makeGradient","color1","color2","color3","toHexString","yellow","white","gray","grey","lightskyblue","lightsalmon","hotpink","10","CramFile","_getCraiRefLength","makeCram","crai","makeCram2","parseCramHeader","CRAM_MAGIC","cram","parseCrai","craiMagic","CRAI_MAGIC","resultBB","CramRecord","CramFlags","readCramRecords","11","a1","a2","options","props","dasBaseURI","DASCoords","coordsMatch","DASSequence","alpha","alphabet","DASLink","desc","DASAlignment","styles","parseGradient","getAttribute","colors","se","getElementsByTagName","stop","nodeValue","elementValue","children","childNodes","ni","childElementOf","hasChildNodes","child","Node","ELEMENT_NODE","nextSibling","dasLinksOf","links","Array","maybeLinkChilden","linkXML","dasNotesOf","maybeNotes","doCrossDomainRequest","custAuth","XDomainRequest","onload","dom","ActiveXObject","async","loadXML","ontimeout","responseXML","isDasBooleanTrue","toLowerCase","isDasBooleanNotFalse","copyStylesheet","nss","sh","_methodRE","_labelRE","_typeRE","_gradient","isBounded","toDASQuery","getURI","dasURI","segs","segMin","segMax","segId","segSize","segDesc","sequence","seqs","segAlpha","segSeq","rawSeq","space","toUpperCase","features_uri","filters","adjacent","adj","maxbins","join","msg","segmentMap","segmentXML","segmentID","featureXMLs","dasFeature","spos","epos","tec","te","typeId","typeCv","method","groupXML","dasGroup","pec","parts","parents","aliXMLs","aliXML","ali","objXMLs","oi","objXML","dbVersion","blockXMLs","blockXML","order","segXMLs","segXML","styleHolder","successCB","failureCB","creds","stylesheet_uri","typeXMLs","typeStyle","glyphXMLs","glyphXML","localName","failure","quri","sourceXMLs","sourceXML","versionXMLs","versionXML","coordXMLs","coordXML","coord","caps","capXMLs","capXML","fep","propXMLs","source_uri","capabilities","errHandler","xUser","btoa","xPass","./color","12","_interopRequireWildcard","__esModule","newObj","Object","hasOwnProperty","updateStatus","canvas","getContext","currentSequence","_sequenceDraw","drawSeqTier","prepareSubtiers","vOffset","defaultTo","prepareViewport","paint","restore","drawCallback","glyphsForGroup","groupElement","gstyle","styleForFeature","labelWanted","_das","glyphForFeature","connector","labelText","LABELS","g1","g2","zindex","groupGlyph","Glyphs","GroupGlyph","LabelledGlyph","bump","noLabel","glyphType","hideSubpixelGlyphs","minPos","rawMaxPos","maxPos","glyphHolder","featureToCrossLikeGlyph","_glyphHolder","_slicedToArray","_featureToGradientLik","featureToGradientLikeGlyph","_featureToGradientLik2","PaddedGlyph","parallel","PARALLEL","sw","SOUTHWEST","NORTHEAST","ArrowGlyph","stroke","AArrowGlyph","_stroke","SpanGlyph","_stroke2","lineStyle","STYLE","LineGlyph","_stroke3","_fill","PrimersGlyph","string","STRING","_fill2","TextGlyph","_stroke4","_fill3","TooManyGlyph","_featureToPointGlyph","featureToPointGlyph","_featureToPointGlyph2","sequenceGlyph","insertionLabels","__INSERTIONS","TriangleGlyph","insertion","altAlleles","_stroke5","_fill4","bg","BoxGlyph","_stroke6","_fill5","BGITEM","_scale","tags","refSeq","getRefSeq","AminoAcidGlyph","forceLabel","groupFeatures","gbsFeatures","gbsStyles","stackedFeatures","_utils","ungroupedFeatures","concat","makeStackedBars","gbs","gf","lineGraphGlyphs","makeLinePlot","glyphifyGroups","groupIds","keys","groupedFeatures","groupGlyphs","gId","bumpSubtiers","grid","gridOffset","gridSpacing","subtierMax","subtiersExceeded","unbumpedST","_featureDraw","SubTier","bumpedSTs","glyphTier","find","hasSpaceFor","subtier","unshift","GridGlyph","arguments","MIN_PADDING","scaleVertical","_loop","sgId","sgGroup","superGroups","isSuperGroup","featuresByType","sgMin","sgMax","sgSeg","groupedFeature","template","_spans","mergedRanges","range","posCoverage","actCoverage","newFeature","visualWeight","superGroup","sgGlyphs","gGlyphs","_bumpSubtiers","_bumpSubtiers2","drawUnmapped","drawStart","drawEnd","unmappedBlocks","knownCoverage","knownRanges","fillStyle","fillRect","clearViewport","clearRect","clear","desiredWidth","fpw","lh","canvasHeight","save","overlayLabelCanvas","OverlayLabelCanvas","translate","paintToContext","getScoreMinMax","smin","quantMin","smax","quantMax","relScoreOrigin","relScore","relOrigin","csStart","csEnd","sfMin","sfMax","requiredHeight","outline","STROKECOLOR","COLOR_BY_SCORE2","BGGRAD","_color","COLOR3","score2","smin2","MIN2","smax2","MAX2","relScore2","clamp","SIZE","RSIZE","STROKETHRESHOLD","ExGlyph","DIRECTION","LINEWIDTH","DotGlyph","PlimsollGlyph","points","POINTS","StarGlyph","CrossGlyph","boxGlyph","SCATTER","_getScoreMinMax","_getScoreMinMax2","_relScoreOrigin","_relScoreOrigin2","originShift","heightFudge","featureLabel","textHeight","TranslatedGlyph","centerOnAxis","_getScoreMinMax3","_getScoreMinMax4","AUTOMIN","currentFeaturesMinScore","AUTOMAX","currentFeaturesMaxScore","tmin","tmax","_relScoreOrigin3","_relScoreOrigin4","ALPHA","_grad","tempGlyph","_getScoreMinMax5","_getScoreMinMax6","yscale","sc","PointGlyph","rawseq","rawquals","indels","ops","_cigar","co","repeat","inseq","ig","__SEQCOLOR","mismatchSeq","strandColor","_minusColor","_plusColor","__disableQuals","SequenceGlyph","__CLEARBG","yshift","prevSign","curSign","curGlyphPoints","glyphSequences","prevPoint","px","ADDITIVE","POSCOLOR","NEGCOLOR","py","lggs","gs","lgg","LineGraphGlyph","posStacks","negStacks","stackOrigin","relScoreEnd","relScoreStart","relScoreMax","relScoreMin","createQuantOverlay","tics","w","ticSpacing","ticInterval","globalAlpha","strokeStyle","lineWidth","beginPath","moveTo","lineTo","ty","_t","_ty","textAlign","fillText","_numformats","_t2","_ty2","_t3","_ty3","defineProperty","sliceIterator","arr","_arr","_n","_d","_e","_s","_i","isArray","TypeError","_glyphs","_ramda","./cigar.js","./color.js","./das.js","./feature-draw.js","./glyphs.js","./sequence-draw.js","./spans.js","./utils.js","ramda","13","makeTreeTableSection","update","ttButton","heading","popupHolder","ele","text","_outlistener","isin","timer","setup","mx","scrollX","my","scrollY","ttt","popup","_moveHandler","offsetParent","popit","documentElement","scrollLeft","winWidth","innerWidth","position","maxWidth","closeButton","innerHTML","dragOX","dragOY","moveHandler","_upHandler","tbar","paddingLeft","paddingRight","popupHandle","14","_defaultRenderer","15","lookupEncodeURI","json","accept","EncodeURLHolder","rawurl","EncodeFetchable","getURLPromise","urlPromise","urlPromiseValidity","16","EnsemblFeatureSource","FeatureSourceBase","base","species","dalliance_registerSourceAdapterFactory","registerSourceAdapterFactory","create","cdsStyle","varStyle","getScales","types","pool","busy","notifyActivity","jr","jf","feature_type","ID","Parent","consequence_type","alt_alleles","query","seq_region_name","17","exportFullConfig","exportSourceConfig","exportChains","sourceConfig","noPersist","forceMin","forceMinDynamic","forceMax","forceMaxDynamic","exportPageTemplate","18","fillTextRightJustified","measureText","drawSeqTierGC","exportImage","ypos","banner","region","backupFPW","backupScale","totHeight","backupSubtiers","backupOriginHaxx","backupLayoutHeight","mult","resolutionMultiplier","cw","font","closePath","clip","draw","hasQuant","numTics","strokeWidth","labelName","labelWidth","rulerPos","toDataURL","./glyphs","./sequence-draw","19","exportForm","exportSelect","exportContent","setupEOT","exportHighlightsToggle","exportRulerToggle","exportRegionToggle","exportBannerToggle","exportScale","exportWidth","exportButton","blobURL","note","makeSVG","page","downloadLink","download","previewLink","eotHighlights","eotGuideline","eotScale","eotWidth","eotRegion","eotBanner","exportOptsTable","es","insertBefore","20","chainset","dalliance_makeParser","makeParser","Ruler","rulerDrawCallback","./rulers","21","indexFor","gmin","ub","mg","ind","gc","zeroLine","ctx","maybe","labelRE","methodRE","typeRE","softMin","SOFTMIN","Number","MAX_VALUE","MIN","softMax","SOFTMAX","MIN_VALUE","MAX","22","FeatureInfo","pick","fid","sections","maybeConcat","pushnew","TAGVAL_NOTE_RE","addFeatureInfoPlugin","featureInfoPlugins","setTitle","info","__ignored_feature","featureInfo","fips","fipi","table","suppressMethod","minWidth","suppressScore","fisi","section","23","sortFeatures","minScore","fbid","dmin","dmax","drawnGroupedFeatures","groupMins","groupMaxes","groupsToSupers","nonPositional","init_fbid","superParentsOf","spids","pid","drawn","fGroups","fSuperGroup","gid","ogm","pushnewo","sgs","sp","24","PathGlyphBase","radius","_width","_height","_alpha","_radius","covList","coverage","GLOBAL_GC","unmeasured","anchor","metrics","textLen","measured","_x","_dir","minp","maxp","_ori","_style","_strand","_parallel","_sw","_ne","_string","_textLen","aminoTileColor","aa","tileColors","ALTERNATE_COLOR","purple","reverseComplement","seq_dict","rev_seq","rev_compl_seq","_seq","_orientation","_readframe","scheme","fillbg","_strandColor","_ref","_scheme","_quals","_fillbg","_scaleVertical","_y","yOffset","spacing","_r","_points","overhang","_overhang","_hh","ox","oy","makeElementNS","AMINO_ACID_TRANSLATION","svgu","NS_SVG","SVGPath","NS_XLINK","drawPath","toSVG","toPathData","arcTo","strokeRect","drawConnectors","gl","last","pathData","transform","fontSize","registerGlyph","minVisible","maxVisible","hh","hw","arc","cx","cy","lInset","rInset","minLength","instep","setLineDash","drawStemPath","drawTrigsPath","prevOverhang","nextOverhang","leftOverhang","codon","isRetina","__dalliance_SequenceGlyphCache","altPattern","isCloseUp","alphaForQual","qual","mismatch","qc","oldAlpha","refBase","alt","img","createElement","imgGc","dy","drawImage","fillOpacity","textAnchor","midX","midY","theta","sin","cos","x1","y1","x2","y2","./svg-utils","25","JBrowseStore","jbori","subfeatures","uniqueID","cds","sj","sf","txGroup","exon","tlGroup","cdsExon","26","FetchPool","reqs","awaitedFeatures","requestsIssued","notifyRequestsIssued","KSCacheBaton","tierMap","seqSource","DummySequenceSource","viewCount","latestViews","filterFeatures","ff","featuresByGroup","gmax","MappedFeatureSource","CachingFeatureSource","BWGFeatureSource","RemoteBWGFeatureSource","BAMFeatureSource","RemoteBAMFeatureSource","DummyFeatureSource","OverlayFeatureSource","sample","downsample","getBaseCoverage","addRequest","xhr","abortAll","cancelled","baton","awaitedSeq","seqWasFetched","startFetchesForTiers","gex","needSeq","tierRenderer","startFetchesFor","wasRendered","cachedSeq","provide","wantedTypes","viewID","getSource","needsSeq","needsSequence","styleFilters","getActiveStyleFilters","typeList","cachedFeatures","provision","availableScales","latestViewID","actualScale","setFeatures","mayDownsample","needBaseComposition","isPrototypeOf","forceReduction","noDownsample","await","./overlay","./sample","27","Vob","allowZero","bint","lim","oBlockList","ptr","totalSize","xlen","out","reg2bin","beg","list","28","MemStore","featuresByChr","maxLength","chrRing","MemStoreFeatureSource","storeHolder","payload","_load","store","session","feat","lines","li","addFeatures","dirty","f1","f2","_indexFor","mini","maxi","chrInd","readAsText","getDefaultFIPs","29","multiTier","multiConfig","getSubConfig","multi_id","minOffset","pipe","reduce","acc","flatten","Infinity","t1","t2","grid_offset","grid_spacing","quantCanvas","30","dot","dotThreshold","31","activityListeners","readinessListeners","changeListeners","business","readiness","initN","merge","OverlayFeatureSource_merge_concat","filterDispatchOnMethod","OverlayFeatureSource_merge_byKey","OverlayBaton","returnCount","statusCount","returns","statuses","featureSets","omaps","fsi","om","of","keyForFeature","mf","fs","_sourceAdapterIsCapable","cap","addActivityListener","addChangeListener","notifyChange","addReadinessListener","notifyReadiness","notifyReadinessListener","removeReadinessListener","removeActivityListener","listener","removeChangeListener","s0","sfl","fetchN","completed","quantFindNextFeature","32","probeResource","retry","fetchable","BED_REGEXP","KV_REGEXP","VCFHEAD_RE","transport","nameExtractPattern","TABIX_MAGIC","apply","maybeType","finishProbeBedWig","tbi","./bam","./encode","./tabix","33","rulers","rulerY","oldLineWidth","34","ds_scale","__DS_SCALES","pow","DSBin","tot","hasScore","_featureOrder","targetRez","sn","binTots","maxBin","minBin","minLap","maxLap","bm","sampledFeatures","BaseBin","_pos","_bases","_totalCount","alignSeqUsingCigar","processedSeq","currentRefSeq","allBins","minForFeature","maxForFeature","charAt","recordBase","baseFeatures","infoList","refString","baseScoreList","fBase","maxSeen","cov","lap","lMin","lMax","baseComposition","totalQual","strandCnt","strandComposition","+","totalCount","totalCountStr","baseCnt","basePercentage","plusStrandCnt","minusStrandCnt","meanQual","baseInfoString","toFixed","minCount","baseCount","baseScorePair","35","_toConsumableArray","arr2","from","parseLocCardinal","connectTrix","REGION_PATTERN","statusCallback","srPadding","searchCount","foundLatch","searchCallback","found","nchr","doTrixSearch","trix","searchEndpoint","doDasSearch","searchSources","trixURI","ix","ixx","trixxURI","provides_search","found2","./trix","36","tileSizeForScale","MIN_TILE","knownStart","knownEnd","seqTierMax","tile","svgSeqTier","37","nukeStatus","noPersistView","currentSourceList","coveredHubURLs","currentHubList","CONFIG","storedConfigVersion","storedConfigHash","pageConfigHash","defaultSourcesByURI","ul","qChr","qMin","qMax","sz","rks","sbh","rl","sourceStr","storedSources","osi","oldSource","hubStr","38","rstr2hex","rstr_sha1","str2rstr_utf8","rstr2b64","binb2rstr","binb_sha1","rstr2binb","input","hex_tab","hexcase","output","tab","triplet","b64pad","olda","oldb","oldc","oldd","olde","bit_rol","safe_add","sha1_ft","sha1_kt","lsw","msw","num","39","factory","__dalliance_sourceAdapterFactories","__dalliance_parserFactories","cfsid","__cfs_id_seed","DASFeatureSource","awaitedEntryPoints","ep","twoBit","makeTwoBit","tb","bwgSource","bwgHolder","preflight","pfs","bwg_preflights","keyHolder","resolverKey","bamRecordToFeature","bamRecord","bamSource","bamGroup","bamHolder","CRAMFeatureSource","cramSource","cramGroup","cramHolder","RemoteCRAMFeatureSource","JBrowseFeatureSource","jbURI","jbQuery","resolveUrlToPage","StyleFilterSet","initSources","thisTier","saf","bwgURI","bwgBlob","bamURI","bamBlob","cramURI","cramBlob","fetchStylesheet","ssSource","cacheKey","started","doesNotContain","addAll","af","defStyle","dasStaticFeatures","cachedStaticFeatures","cachedStaticScale","tryMaxBins","fops","retScale","dasAdjLock","getDesiredTypes","epi","getSeq","arg","ei","extraIndices","quantLeap","eii","wantDensity","clientBin","scaleFactor","is","link","scales","noExtraFeatureInfo","fip","geneHint","connection","meta","under","bamF","baiF","baiBlob","baiURI","bamRecords","ri","indexUri","indexBlob","cramF","craiF","craiBlob","craiURI","cramRecords","cramRecordToFeature","simplifySegments","minGap","s1","s2","ssegs","currentSeg","fetchLength","mseg","finalStatus","mappedFeatures","mappedLoc","fscale","mi","m1","m2","segDestCoverage","./bedwig","./cram","./ensembljson","./jbjson","./memstore","./style","./tabix-source","./test-source","./twoBit","./vcf","40","41","_Compound","sorted","_rangeOrder","merged","shift","_ranges","insertRange","r0","r1","l0","l1","i0","i1","or","lapMin","lapMax","rangeOrder","isContiguous","_pushRanges","lower_bound","floor","rangeOver","42","StyleFilter","_filters","equals","_list","filterSet","43","44","saveDoc","implementation","createDocument","saveRoot","fontFamily","dallianceAnchor","clipRect","tierSVG","clipPath","clipRule","tierLabels","tierTopPos","tierBackground","seqTrack","glyphElements","svg","XMLSerializer","serializeToString","root","outerHTML","45","46","TabixFeatureSource","tabixHolder","indexURI","connectTabix","tabix","fetchHeader","47","TabixFile","unchead","format","colSeq","colStart","colEnd","skip","headerMax","readRecords","canonicalChr","LINE_LOOP","48","_classCallCheck","instance","Constructor","_possibleConstructorReturn","ReferenceError","_inherits","subClass","superClass","enumerable","writable","configurable","setPrototypeOf","__proto__","_createClass","defineProperties","descriptor","protoProps","staticProps","_sourceadapters","TestSource","_FeatureSourceBase","getPrototypeOf","genFeature","./sourceadapters.js","49","TrackHub","TrackHubTrack","TrackHubDB","hubURL","hubFile","THUB_PARSE_REGEXP","genomesFile","genURL","relativeURL","genFile","stanzas","THUB_STANZA_REGEXP","gprops","twoBitPath","trackDb","absURL","THUB_COMPARE","priority","shortLabel","THUB_SUBGROUP_REGEXP","THUB_PENNANT_PREFIX","_parent","getTracks","_tracks","trackFile","tracks","tracksById","track","_db","subgroups","sgtoks","sgtag","sgrecord","titles","sgti","sgm","container","bigDataUrl","toplevels","composites","parent","ptoks","compositeTrack","comp","parentOfViews","toDallianceSource","longLabel","pennantIcon","pennant","searchTrix","aggregate","typeToks","bedTokens","bedPlus","bigbedStyles","bigwigStyles","yLineOnOff","yLineMark","maxHeightPixels","mhpToks","gtype","graphTypeDefault","altColor","cbsToks","plus","minus","tlStyle","50","nsh","51","getSeqStyle","__dalliance_smallGlyphs","DOT","EX","STAR","SQUARE","CROSS","TRIANGLE","PLIMSOLL","setStyleColors","numColors","tierColorField","tierColorField2","tierColorField3","tierPlusColorField","tierMinusColorField","mutateStylesheet","visitor","changeColor","mergeStylesheet","tierForm","aboutBanner","Name","paddingBottom","marginBottom","about","aboutNotes","sduri","semanticBanner","editBanner","tierNameField","tierPinnedToggle","glyphField","tierColorFields","colorListPlus","colorListMinus","colorListElement","setNumColors","tierMinField","tierMaxField","tierMinToggle","tierMaxToggle","quantLeapToggle","quantLeapThreshField","tierHeightField","bumpToggle","bumpLimit","labelToggle","mainStyle","isQuantitative","isSimpleQuantitative","activeStyleCount","minRow","maxRow","bumpRow","labelRow","styleRow","colorRow","setMinValue","setMaxValue","seqStyle","seqMismatchRow","seqMismatchToggle","seqInsertRow","seqInsertToggle","seqIgnoreQualsRow","seqIgnoreQualsToggle","plusStrandColorRow","minusStrandColorRow","quantLeapRow","tierTable","setConfig","updateQuant","currentScale","52","__tier_idSeed","border","minHeight","notifier","notifierHolder","paddingTop","borderRadius","nameElement","classes","styleIdSeed","layoutWasDone","featureInfoPlugin","noSourceFeatureInfo","readinessListener","ready","activityListener","listeners","featuresLoadedListeners","_resolveFirstRenderPromise","setStylesheet","baseStylesheet","baseStylesheetValidity","sfs","sourceConfigNeedsSeq","some","knownChr","notifyFeaturesLoaded","mmin","trySourceFNF","clientHeight","_notifierToStatus","checkedHTTP","can","warnHTTP","notifierFadeTimeout","_notifierOn","opacity","_notifierOff","notifyTierListeners","newStyle","stylesheetValidity","newConfig","needsRefresh","needsReorder","wantedHeight","wantedPinned","wantedSubtierMax","wantedBumped","scheduleRedraw","redrawTimeout","clearTierListeners","change","clearFeaturesLoadedListeners","addFeaturesLoadedListener","removeFeaturesLoadedListener","./feature-draw","./features","53","activateButton","addModeButtons","which","domui","currentlyActive","makeButton","tooltip","regButton","makeHubStab","refreshButton","addButton","canButton","customMode","stabHolder","buttonIdSeed","ttab","trim","tops","buttons","dg","dimensions","dprops","dtoks","dti","dimX","dimY","sgX","sgY","trks","vX","vY","matrix","tableLayout","transformOrigin","webkitTransform","webkitTransformOrigin","mbody","yi","cell","ds","bd","dalliance_source","__mapping","dalliance_mapping","stabBody","stab","buttonId","ld","htmlFor","setChecks","switchToBinMode","binButton","pageHolder","custURL","custFile","multiple","switchToHubConnectMode","addHubButton","switchToCustomMode","custButton","customForm","doAdd","curi","nds","tryAddDAS","fileList","files","tryAddMultiple","lcuri","tryAddBin","dataToFinalize","completeBAM","promptForBAI","completeTabixVCF","promptForTabix","custName","custCS","custQuant","custUser","custPass","tryAddHub","multipleSet","hidden","makeSourceConfig","bestHub","bestHubButton","okay","hubButton","makeHubButton","modeButtonHolder","tryAddDASxSources","sqfail","addDasCompletionPage","coordsDetermined","quantDetermined","indexF","hasBAI","magic2","binFormatErrorPage","hasTabix","makeStab","makeStabObserver","mm","mapButton","groupedDefaults","hubMenuButton","hbContent","loader","marginTop","removeHubItem","allOnItem","allOffItem","hubMenu","clickCatcher","firstDefButton","firstDefSources","defButton","asform","overflow","__sourceHolder","msources","removeListener","addListenerAndFire","cors","tsm","testSegment","tabError","quantIrrelevant","csk","newSources","probeMultiple","updateMultipleStatus","usedIndices","bams","tabixes","baiPattern","tbiPattern","needsIndex","multTable","typeContent","ccs","state","indexFile","buttonHolder","./probe","54","ixxData","offsets","TrixIndex","ixslice","qtag","ist","55","TwoBitFile","headerBlockSize","HEADER_BLOCK_SIZE","headerBlocksFetched","TWOBIT_MAGIC","TWOBIT_MAGIC_BE","seqCount","seqDict","parseSeqInfo","TwoBitSeq","tbf","seqOffset","_length","nBlockCnt","r2","nbs","nbMin","nbLen","nb","nBlocks","mBlockCnt","TWOBIT_TABLE","fillSeq","fsm","bb","bv","seqData","seqstr","nSpans","intr","56","arrayRemove","attribs","namespace","createElementNS","setAttrs","setAttr","attr","attr_name_cache","_attr","lcc","exc","queue","saltURL","__dalliance_saltSeed","lastIndexOf","addListener","TTT","TTC","TTA","TTG","CTT","CTC","CTA","CTG","ATT","ATC","ATA","ATG","GTT","GTC","GTA","GTG","TCT","TCC","TCA","TCG","CCT","CCC","CCA","CCG","ACT","ACC","ACA","ACG","GCT","GCC","GCA","GCG","TAT","TAC","TAA","TAG","CAT","CAC","CAA","CAG","AAT","AAC","AAA","AAG","GAT","GAC","GAA","GAG","TGT","TGC","TGA","TGG","CGT","CGC","CGA","CGG","AGT","AGC","AGA","AGG","GGT","GGC","GGA","GGG","57","VCFParser","VCFParseSession","VCF_INFO_RE","VCF_INFO_HEADER","VCF_INFO_HEADER_TOK","refAllele","infoToks","val","58","MAJOR","MINOR","MICRO","BRANCH","vs","PATCH","59","setPos","np","thumb","setPos2","pos2","thumb2","labels","slider","txt","onChange","createEvent","initEvent","thumbMouseDown","dispatchEvent","thumbDragHandler","thumbDragEndHandler","60","polyfill","./promise/polyfill","./promise/promise","61","promises","resolveAll","results","remaining","promise","isFunction","62","process","global","useNextTick","nextTick","useMutationObserver","iterations","observer","BrowserMutationObserver","observe","characterData","useSetTimeout","local","tuple","asap","scheduleFlush","browserGlobal","MutationObserver","WebKitMutationObserver","_process","63","cast","64","configure","65","es6PromiseSupport","RSVPPromise","./promise","66","_subscribers","invokeResolver","resolvePromise","rejectPromise","reason","invokeCallback","settled","succeeded","failed","hasCallback","handleThenable","FULFILLED","REJECTED","subscribe","onFulfillment","onRejection","subscribers","publish","_detail","resolved","objectOrFunction","fulfill","_state","PENDING","SEALED","publishFulfillment","publishRejection","race","staticResolve","staticReject","thenPromise","catch","./all","./asap","./cast","./config","./race","./reject","./resolve","67","68","69","70","getTime","71","ZStream","Inflate","was","InfBlocks","checkfn","hufts","MANY","mode","IB_TYPE","blens","codes","InfCodes","bitk","bitb","read","write","inftree","InfTree","inflate_trees_fixed","td","fixed_bl","fixed_bd","fixed_tl","fixed_td","Z_OK","dest","arrayCopy_fast","hasSubarray","subarray","BYTES_PER_ELEMENT","byteOffset","arrayCopy_slow","afterUncOffset","inflateInit","DEF_WBITS","next_in","next_in_index","avail_in","obuf","next_out","next_out_index","avail_out","inflate","Z_NO_FLUSH","Z_STREAM_END","Z_BUF_ERROR","newob","MAX_WBITS","BMAX","PRESET_DICT","Z_FINISH","Z_DEFLATED","Z_NEED_DICT","Z_STREAM_ERROR","Z_DATA_ERROR","Z_MEM_ERROR","METHOD","FLAG","DICT4","DICT3","DICT2","DICT1","DICT0","BLOCKS","CHECK4","CHECK3","CHECK2","CHECK1","DONE","BAD","inflate_mask","IB_LENS","IB_STORED","IB_TABLE","IB_BTREE","IB_DTREE","IB_CODES","IB_DRY","IB_DONE","IB_BAD","cplens","cplext","cpdist","cpdext","istate","inflateEnd","ret","inflateSync","inflateSetDictionary","dictionary","dictLength","inflateReset","total_in","total_out","free","wbits","marker","need","adler","proc","_adler","adler32","set_dictionary","mark","inflateSyncPoint","sync_point","INFBLOCKS_BORDER","inflate_flush","inflate_trees_bits","inflate_trees_dynamic","IC_START","IC_LEN","IC_LENEXT","IC_DIST","IC_DISTEXT","IC_COPY","IC_LIT","IC_WASH","IC_END","IC_BADCODE","tl_index","td_index","lbits","dbits","ltree","ltree_index","dtree","dtree_index","tree","tindex","inflate_fast","tree_index","lit","dist","tp","tp_index","ml","md","tp_index_t_3","huft_build","bindex","hp","hn","mask","xp","initWorkArea","nd","vsize","testArray","72","defaultSetTimout","defaultClearTimeout","runTimeout","fun","cachedSetTimeout","runClearTimeout","cachedClearTimeout","cleanUpNextTick","draining","currentQueue","queueIndex","drainQueue","run","Item","array","noop","args","env","argv","versions","on","once","off","removeAllListeners","emit","binding","cwd","chdir","umask","73","__","@@functional/placeholder","_arity","fn","a0","a3","a4","a5","a6","a7","a8","a9","_arrayFromIterator","iter","_arrayOf","_cloneRegExp","ignoreCase","multiline","sticky","unicode","_complement","_concat","set1","set2","len1","len2","_containsWith","pred","_filter","_forceReduced","@@transducer/value","@@transducer/reduced","_functionName","_has","prop","_identity","_isArguments","_isArray","_isFunction","_isInteger","isInteger","_isNumber","_isObject","_isPlaceholder","_isRegExp","_isString","_isTransformer","_map","functor","_objectAssign","nextKey","_of","_pipe","_pipeP","_quote","escaped","_reduced","_slice","to","_toISOString","pad","toISOString","getUTCFullYear","getUTCMonth","getUTCDate","getUTCHours","getUTCMinutes","getUTCSeconds","getUTCMilliseconds","_xfBase","xf","_xwrap","XWrap","_aperture","limit","_assign","assign","_checkForMethod","methodname","_curry1","_curry2","_b","_a","_curry3","f3","_c","_curryN","received","combined","argsIdx","combinedIdx","_dispatchable","transducer","_dropLastWhile","_xall","XAll","_xany","XAny","any","_xaperture","XAperture","full","getCopy","_xdrop","XDrop","_xdropLast","XDropLast","_xdropRepeatsWith","XDropRepeatsWith","lastValue","seenFirstValue","sameAsLast","_xdropWhile","XDropWhile","_xfilter","XFilter","_xfind","XFind","_xfindIndex","XFindIndex","_xfindLast","XFindLast","_xfindLastIndex","XFindLastIndex","lastIdx","_xmap","XMap","_xtake","XTake","_xtakeWhile","XTakeWhile","adjust","_idx","always","and","aperture","append","el","assoc","assocPath","thisObj","comparator","curryN","dec","differenceWith","first","second","firstLen","dissoc","dissocPath","tail","divide","dropWhile","empty","evolve","transformations","transformation","findIndex","findLast","findLastIndex","fromPairs","pairs","groupWith","nextidx","gt","gte","has","hasIn","identical","identity","ifElse","condition","onTrue","onFalse","inc","insert","elt","insertAll","elts","intersperse","separator","Ctor","isArrayLike","isNil","hasEnumBug","propertyIsEnumerable","nonEnumerableProps","hasArgsEnumBug","item","nIdx","ks","checkArgsLength","keysIn","NaN","lt","lte","mapAccum","mapAccumRight","str","mathMod","maxBy","mergeAll","mergeWithKey","minBy","modulo","multiply","nAry","negate","none","not","nth","nthArg","objOf","called","over","Identity","lens","pair","fst","snd","paths","pathOr","pathSatisfies","propPath","names","pickAll","pickBy","prepend","propOr","propSatisfies","ps","reduceRight","reduced","regex","replacement","scan","fromIndex","toIndex","sortBy","splitAt","splitEvery","splitWhen","subtract","take","xs","takeLastWhile","takeWhile","tap","times","RangeError","toPairs","toPairsIn","transpose","outerlist","innerlist","ws","zeroWidth","hasProtoTrim","beginRx","endRx","tryCatch","tryer","catcher","unapply","unary","uncurryN","depth","endIdx","currentDepth","unfold","uniqWith","unless","whenFalseFn","until","useWith","transformers","values","vals","valuesIn","Const","when","whenTrueFn","where","spec","testObj","wrap","wrapper","xprod","ilen","jlen","zip","rv","zipObj","zipWith","_clone","refFrom","refTo","deep","copy","copiedValue","valueOf","_createPartialApplicator","_dropLast","_equals","stackA","stackB","entries","keysA","pop","_makeFlat","recursive","flatt","_reduce","_arrayReduce","_iterableReduce","_methodReduce","symIterator","_stepCat","_stepCatArray","@@transducer/init","@@transducer/step","@@transducer/result","_stepCatString","_stepCatObject","_xdropLastWhile","XDropLastWhile","retained","retain","_xgroupBy","XGroupBy","inputs","addIndex","origFn","binary","clone","curry","drop","dropLast","dropLastWhile","filterable","flip","intersectionWith","list1","list2","lookupList","filteredList","into","invert","invertObj","isEmpty","mapObjIndexed","mergeWith","_","_l","partial","partialRight","pathEq","_path","pluck","project","propEq","propIs","reduceBy","valueFn","valueAcc","keyFn","sum","takeLast","transduce","unionWith","whereEq","_flatCat","preservingReduced","rxf","_indexOf","inf","_xchain","allPass","preds","allUniq","anyPass","ap","applicative","applySpec","monad","cond","arity","constructN","Fn","$0","$1","$2","$3","$4","$5","$6","$7","$8","$9","converge","after","fns","context","countBy","elem","dropRepeatsWith","eqBy","eqProps","obj1","obj2","groupBy","indexBy","juxt","getter","setter","toFunctorFn","lensIndex","lensPath","lensProp","liftN","lifted","mean","median","partition","pipeP","product","traversable","traverse","unnest","_contains","_toString","seen","recur","mapPairs","repr","compose","composeK","composeP","construct","difference","dropRepeats","lift","omit","pipeK","without","_Set","_nativeSet","Set","_items","hasOrAdd","shouldAdd","prevSize","newSize","bIdx","both","complement","either","invoker","Function","memoize","cache","toLower","toUpper","uniqBy","appliedItem","symmetricDifference","symmetricDifferenceWith","uniq","define","amd","74","mixin","defaults","validateProperty","validateObject","allProps","visitedProps","patternProperties","re","additionalProperties","unvisitedProps","unvisitedProperties","property","constrain","assert","validateFormats","validateFormatExtensions","formatExtensions","formats","validateFormatsStrict","dependencies","checkType","multiplier","nestedErrors","isDate","attribute","actual","expected","messages","allowEmpty","exclusiveMinimum","exclusiveMaximum","divisibleBy","minItems","maxItems","uniqueItems","conform","email","ip-address","ipv6","date-time","date","time","host-name","utc-millisec"],"mappings":"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EAAA,EAAA,EAAA,EAAA,EAAA,IAAA,EAAA,EAAA,GAAA,EAAA,EAAA,IACA,GAAA,EAAA,EAAA,EAAA,EAAA,GAAA,EAAA,EAAA,GAAA,EAAA,EAAA,IACA,GAAA,EAAA,GAAA,EAAA,EAAA,IAAA,EAAA,EAAA,GAAA,EAAA,EAAA,IACA,GAAA,EAAA,GAAA,EAAA,EAAA,IAAA,EAAA,EAAA,GAAA,EAAA,EAAA,IACA,EAAA,EAAA,EAAA,EAAA,EAAA,IAAA,EAAA,EAAA,GAAA,EAAA,EAAA,IACA,GAAA,EAAA,EAAA,EAAA,EAAA,GAAA,EAAA,EAAA,GAAA,GAAA,EAAA,IACA,GAAA,EAAA,GAAA,EAAA,EAAA,IAAA,EAAA,EAAA,GAAA,EAAA,EAAA,IACA,GAAA,EAAA,GAAA,EAAA,EAAA,IAAA,EAAA,EAAA,GAAA,EAAA,EAAA,IACA,EAAA,EAAA,EAAA,EAAA,EAAA,IAAA,EAAA,EAAA,GAAA,EAAA,EAAA,IACA,GAAA,EAAA,EAAA,EAAA,EAAA,GAAA,EAAA,EAAA,GAAA,EAAA,EAAA,IACA,GAAA,EAAA,GAAA,EAAA,EAAA,IAAA,EAAA,EAAA,GAAA,EAAA,EAAA,IACA,GAAA,EAAA,GAAA,EAAA,EAAA,IAAA,EAAA,EAAA,GAAA,EAAA,EAAA,IACA,EAAA,EAAA,GAAA,EAAA,EAAA,IAAA,EAAA,EAAA,GAAA,EAAA,EAAA,IACA,GAAA,EAAA,EAAA,EAAA,EAAA,GAAA,EAAA,EAAA,GAAA,GAAA,EAAA,IACA,GAAA,EAAA,GAAA,EAAA,EAAA,IAAA,EAAA,EAAA,GAAA,EAAA,EAAA,IACA,GAAA,EAAA,GAAA,EAAA,EAAA,GAAA,EAAA,EAAA,GAAA,EAAA,EAAA,IACA,EAAA,EAAA,EAAA,EAAA,EAAA,IAAA,EAAA,EAAA,GAAA,EAAA,EAAA,IACA,GAAA,EAAA,EAAA,EAAA,EAAA,GAAA,EAAA,EAAA,GAAA,EAAA,EAAA,IACA,GAAA,EAAA,GAAA,EAAA,EAAA,IAAA,EAAA,EAAA,GAAA,EAAA,EAAA,IACA,GAAA,EAAA,GAAA,EAAA,EAAA,IAAA,EAAA,EAAA,GAAA,EAAA,EAAA,IACA,EAAA,EAAA,GAAA,EAAA,EAAA,IAAA,EAAA,EAAA,GAAA,EAAA,EAAA,IACA,GAAA,EAAA,EAAA,EAAA,EAAA,GAAA,EAAA,EAAA,GAAA,IAAA,EAAA,EACA,GAAA,EAAA,GAAA,EAAA,EAAA,IAAA,EAAA,EAAA,GAAA,EAAA,EAAA,IACA,GAAA,EAAA,GAAA,EAAA,EAAA,IAAA,EAAA,EAAA,GAAA,EAAA,EAAA,IACA,EAAA,EAAA,EAAA,EAAA,EAAA,IAAA,EAAA,EAAA,GAAA,EAAA,EAAA,IACA,GAAA,EAAA,EAAA,EAAA,EAAA,GAAA,EAAA,EAAA,GAAA,EAAA,EAAA,IACA,GAAA,EAAA,GAAA,EAAA,EAAA,IAAA,EAAA,EAAA,GAAA,EAAA,EAAA,IACA,GAAA,EAAA,GAAA,EAAA,EAAA,IAAA,EAAA,EAAA,GAAA,EAAA,EAAA,IACA,EAAA,EAAA,GAAA,EAAA,EAAA,IAAA,EAAA,EAAA,GAAA,EAAA,EAAA,IACA,GAAA,EAAA,IAAA,EAAA,EAAA,GAAA,EAAA,EAAA,GAAA,GAAA,EAAA,IACA,GAAA,EAAA,GAAA,EAAA,EAAA,IAAA,EAAA,EAAA,GAAA,EAAA,EAAA,IACA,GAAA,EAAA,GAAA,EAAA,EAAA,GAAA,EAAA,EAAA,GAAA,EAAA,EAAA,IACA,EAAA,EAAA,EAAA,EAAA,EAAA,IAAA,EAAA,EAAA,GAAA,EAAA,EAAA,IACA,GAAA,EAAA,EAAA,EAAA,EAAA,GAAA,EAAA,EAAA,GAAA,EAAA,EAAA,IACA,GAAA,EAAA,GAAA,EAAA,EAAA,IAAA,EAAA,EAAA,GAAA,EAAA,EAAA,IACA,GAAA,EAAA,GAAA,EAAA,EAAA,IAAA,EAAA,EAAA,GAAA,EAAA,EAAA,IACA,EAAA,EAAA,EAAA,EAAA,EAAA,IAAA,EAAA,EAAA,GAAA,EAAA,EAAA,IACA,GAAA,EAAA,EAAA,EAAA,EAAA,GAAA,EAAA,EAAA,GAAA,GAAA,EAAA,IACA,GAAA,EAAA,GAAA,EAAA,EAAA,IAAA,EAAA,EAAA,GAAA,EAAA,EAAA,IACA,GAAA,EAAA,GAAA,EAAA,EAAA,IAAA,EAAA,EAAA,GAAA,EAAA,EAAA,IACA,EAAA,EAAA,EAAA,EAAA,EAAA,IAAA,EAAA,EAAA,GAAA,EAAA,EAAA,IACA,GAAA,EAAA,EAAA,EAAA,EAAA,GAAA,EAAA,EAAA,GAAA,EAAA,EAAA,IACA,GAAA,EAAA,GAAA,EAAA,EAAA,IAAA,EAAA,EAAA,GAAA,EAAA,EAAA,IACA,GAAA,EAAA,GAAA,EAAA,EAAA,IAAA,EAAA,EAAA,GAAA,EAAA,EAAA,IACA,EAAA,EAAA,GAAA,EAAA,EAAA,IAAA,EAAA,EAAA,GAAA,EAAA,EAAA,IACA,GAAA,EAAA,EAAA,EAAA,EAAA,GAAA,EAAA,EAAA,GAAA,GAAA,EAAA,IACA,GAAA,EAAA,GAAA,EAAA,EAAA,IAAA,EAAA,EAAA,GAAA,EAAA,EAAA,IACA,GAAA,EAAA,GAAA,EAAA,EAAA,GAAA,EAAA,EAAA,GAAA,EAAA,EAAA,IACA,EAAA,EAAA,EAAA,EAAA,EAAA,IAAA,EAAA,EAAA,GAAA,EAAA,EAAA,IACA,GAAA,EAAA,EAAA,EAAA,EAAA,GAAA,EAAA,EAAA,GAAA,EAAA,EAAA,IACA,GAAA,EAAA,GAAA,EAAA,EAAA,IAAA,EAAA,EAAA,GAAA,EAAA,EAAA,IACA,GAAA,EAAA,GAAA,EAAA,EAAA,IAAA,EAAA,EAAA,GAAA,EAAA,EAAA,IACA,EAAA,EAAA,GAAA,EAAA,EAAA,IAAA,EAAA,EAAA,GAAA,EAAA,EAAA,IACA,GAAA,EAAA,EAAA,EAAA,EAAA,GAAA,EAAA,EAAA,GAAA,IAAA,EAAA,EACA,GAAA,EAAA,GAAA,EAAA,EAAA,IAAA,EAAA,EAAA,GAAA,EAAA,EAAA,IACA,GAAA,EAAA,GAAA,EAAA,EAAA,IAAA,EAAA,EAAA,GAAA,EAAA,EAAA,IACA,EAAA,EAAA,EAAA,EAAA,EAAA,IAAA,EAAA,EAAA,GAAA,EAAA,EAAA,IACA,GAAA,EAAA,EAAA,EAAA,EAAA,GAAA,EAAA,EAAA,GAAA,EAAA,EAAA,IACA,GAAA,EAAA,GAAA,EAAA,EAAA,IAAA,EAAA,EAAA,GAAA,EAAA,EAAA,IACA,GAAA,EAAA,GAAA,EAAA,EAAA,IAAA,EAAA,EAAA,GAAA,EAAA,EAAA,IACA,EAAA,EAAA,GAAA,EAAA,EAAA,IAAA,EAAA,EAAA,GAAA,EAAA,EAAA,IACA,GAAA,EAAA,IAAA,EAAA,EAAA,GAAA,EAAA,EAAA,GAAA,GAAA,EAAA,IACA,GAAA,EAAA,GAAA,EAAA,EAAA,IAAA,EAAA,EAAA,GAAA,EAAA,EAAA,IAEA,GAAA,EAAA,GAAA,EAAA,EAAA,GAAA,EAAA,EAAA,GAAA,EAAA,EAAA,IACA,EAAA,EAAA,EAAA,EAAA,EAAA,IAAA,EAAA,EAAA,GAAA,EAAA,EAAA,IACA,GAAA,EAAA,EAAA,EAAA,EAAA,GAAA,EAAA,EAAA,GAAA,EAAA,EAAA,IACA,GAAA,EAAA,GAAA,EAAA,EAAA,IAAA,EAAA,EAAA,GAAA,EAAA,EAAA,IACA,GAAA,EAAA,GAAA,EAAA,EAAA,IAAA,EAAA,EAAA,GAAA,EAAA,EAAA,IACA,EAAA,EAAA,EAAA,EAAA,EAAA,IAAA,EAAA,EAAA,GAAA,EAAA,EAAA,IACA,GAAA,EAAA,EAAA,EAAA,EAAA,GAAA,EAAA,EAAA,GAAA,GAAA,EAAA,IACA,GAAA,EAAA,GAAA,EAAA,EAAA,IAAA,EAAA,EAAA,GAAA,EAAA,EAAA,IACA,GAAA,EAAA,GAAA,EAAA,EAAA,IAAA,EAAA,EAAA,GAAA,EAAA,EAAA,IACA,EAAA,EAAA,EAAA,EAAA,EAAA,IAAA,EAAA,EAAA,GAAA,EAAA,EAAA,IACA,GAAA,EAAA,EAAA,EAAA,EAAA,GAAA,EAAA,EAAA,GAAA,EAAA,EAAA,IACA,GAAA,EAAA,GAAA,EAAA,EAAA,IAAA,EAAA,EAAA,GAAA,EAAA,EAAA,IACA,GAAA,EAAA,GAAA,EAAA,EAAA,IAAA,EAAA,EAAA,GAAA,EAAA,EAAA,IACA,EAAA,EAAA,GAAA,EAAA,EAAA,IAAA,EAAA,EAAA,GAAA,EAAA,EAAA,IACA,GAAA,EAAA,EAAA,EAAA,EAAA,GAAA,EAAA,EAAA,GAAA,GAAA,EAAA,IACA,GAAA,EAAA,GAAA,EAAA,EAAA,IAAA,EAAA,EAAA,GAAA,EAAA,EAAA,IACA,GAAA,EAAA,GAAA,EAAA,EAAA,GAAA,EAAA,EAAA,GAAA,EAAA,EAAA,IACA,EAAA,EAAA,EAAA,EAAA,EAAA,IAAA,EAAA,EAAA,GAAA,EAAA,EAAA,IACA,GAAA,EAAA,EAAA,EAAA,EAAA,GAAA,EAAA,EAAA,GAAA,EAAA,EAAA,IACA,GAAA,EAAA,GAAA,EAAA,EAAA,IAAA,EAAA,EAAA,GAAA,EAAA,EAAA,IACA,GAAA,EAAA,GAAA,EAAA,EAAA,IAAA,EAAA,EAAA,GAAA,EAAA,EAAA,IACA,EAAA,EAAA,GAAA,EAAA,EAAA,IAAA,EAAA,EAAA,GAAA,EAAA,EAAA,IACA,GAAA,EAAA,EAAA,EAAA,EAAA,GAAA,EAAA,EAAA,GAAA,IAAA,EAAA,EACA,GAAA,EAAA,GAAA,EAAA,EAAA,IAAA,EAAA,EAAA,GAAA,EAAA,EAAA,IACA,GAAA,EAAA,GAAA,EAAA,EAAA,IAAA,EAAA,EAAA,GAAA,EAAA,EAAA,IACA,EAAA,EAAA,EAAA,EAAA,EAAA,IAAA,EAAA,EAAA,GAAA,EAAA,EAAA,IACA,GAAA,EAAA,EAAA,EAAA,EAAA,GAAA,EAAA,EAAA,GAAA,EAAA,EAAA,IACA,GAAA,EAAA,GAAA,EAAA,EAAA,IAAA,EAAA,EAAA,GAAA,EAAA,EAAA,IACA,GAAA,EAAA,GAAA,EAAA,EAAA,IAAA,EAAA,EAAA,GAAA,EAAA,EAAA,IACA,EAAA,EAAA,GAAA,EAAA,EAAA,IAAA,EAAA,EAAA,GAAA,EAAA,EAAA,IACA,GAAA,EAAA,IAAA,EAAA,EAAA,GAAA,EAAA,EAAA,GAAA,GAAA,EAAA,IACA,GAAA,EAAA,GAAA,EAAA,EAAA,IAAA,EAAA,EAAA,GAAA,EAAA,EAAA,IACA,GAAA,EAAA,GAAA,EAAA,EAAA,GAAA,EAAA,EAAA,GAAA,EAAA,EAAA,IACA,EAAA,EAAA,EAAA,EAAA,EAAA,IAAA,EAAA,EAAA,GAAA,EAAA,EAAA,IACA,GAAA,EAAA,EAAA,EAAA,EAAA,GAAA,EAAA,EAAA,GAAA,EAAA,EAAA,IACA,GAAA,EAAA,GAAA,EAAA,EAAA,IAAA,EAAA,EAAA,GAAA,EAAA,EAAA,IACA,GAAA,EAAA,GAAA,EAAA,EAAA,IAAA,EAAA,EAAA,GAAA,EAAA,EAAA,IACA,EAAA,EAAA,EAAA,EAAA,EAAA,IAAA,EAAA,EAAA,GAAA,EAAA,EAAA,IACA,GAAA,EAAA,EAAA,EAAA,EAAA,GAAA,EAAA,EAAA,GAAA,GAAA,EAAA,IACA,GAAA,EAAA,GAAA,EAAA,EAAA,IAAA,EAAA,EAAA,GAAA,EAAA,EAAA,IACA,GAAA,EAAA,GAAA,EAAA,EAAA,IAAA,EAAA,EAAA,GAAA,EAAA,EAAA,IACA,EAAA,EAAA,EAAA,EAAA,EAAA,IAAA,EAAA,EAAA,GAAA,EAAA,EAAA,IACA,GAAA,EAAA,EAAA,EAAA,EAAA,GAAA,EAAA,EAAA,GAAA,EAAA,EAAA,IACA,GAAA,EAAA,GAAA,EAAA,EAAA,IAAA,EAAA,EAAA,GAAA,EAAA,EAAA,IACA,GAAA,EAAA,GAAA,EAAA,EAAA,IAAA,EAAA,EAAA,GAAA,EAAA,EAAA,IACA,EAAA,EAAA,GAAA,EAAA,EAAA,IAAA,EAAA,EAAA,GAAA,EAAA,EAAA,IACA,GAAA,EAAA,EAAA,EAAA,EAAA,GAAA,EAAA,EAAA,GAAA,GAAA,EAAA,IACA,GAAA,EAAA,GAAA,EAAA,EAAA,IAAA,EAAA,EAAA,GAAA,EAAA,EAAA,IACA,GAAA,EAAA,GAAA,EAAA,EAAA,GAAA,EAAA,EAAA,GAAA,EAAA,EAAA,IACA,EAAA,EAAA,EAAA,EAAA,EAAA,IAAA,EAAA,EAAA,GAAA,EAAA,EAAA,IACA,GAAA,EAAA,EAAA,EAAA,EAAA,GAAA,EAAA,EAAA,GAAA,EAAA,EAAA,IACA,GAAA,EAAA,GAAA,EAAA,EAAA,IAAA,EAAA,EAAA,GAAA,EAAA,EAAA,IACA,GAAA,EAAA,GAAA,EAAA,EAAA,IAAA,EAAA,EAAA,GAAA,EAAA,EAAA,IACA,EAAA,EAAA,GAAA,EAAA,EAAA,IAAA,EAAA,EAAA,GAAA,EAAA,EAAA,IACA,GAAA,EAAA,EAAA,EAAA,EAAA,GAAA,EAAA,EAAA,GAAA,IAAA,EAAA,EACA,GAAA,EAAA,GAAA,EAAA,EAAA,IAAA,EAAA,EAAA,GAAA,EAAA,EAAA,IACA,GAAA,EAAA,GAAA,EAAA,EAAA,IAAA,EAAA,EAAA,GAAA,EAAA,EAAA,IACA,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","file":"dalliance-all.js","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})","/* -*- mode: javascript; c-basic-offset: 4; indent-tabs-mode: nil -*- */\n\n// \n// Dalliance Genome Explorer\n// (c) Thomas Down 2006-2011\n//\n// bam.js: indexed binary alignments\n//\n\n\"use strict\";\n\nif (typeof(require) !== 'undefined') {\n    var spans = require('./spans');\n    var Range = spans.Range;\n    var union = spans.union;\n    var intersection = spans.intersection;\n\n    var bin = require('./bin');\n    var readInt = bin.readInt;\n    var readShort = bin.readShort;\n    var readByte = bin.readByte;\n    var readInt64 = bin.readInt64;\n    var readFloat = bin.readFloat;\n\n    var lh3utils = require('./lh3utils');\n    var readVob = lh3utils.readVob;\n    var unbgzf = lh3utils.unbgzf;\n    var reg2bins = lh3utils.reg2bins;\n    var Chunk = lh3utils.Chunk;\n}\n\n\nvar BAM_MAGIC = 0x14d4142;\nvar BAI_MAGIC = 0x1494142;\n\nvar BamFlags = {\n    MULTIPLE_SEGMENTS:       0x1,\n    ALL_SEGMENTS_ALIGN:      0x2,\n    SEGMENT_UNMAPPED:        0x4,\n    NEXT_SEGMENT_UNMAPPED:   0x8,\n    REVERSE_COMPLEMENT:      0x10,\n    NEXT_REVERSE_COMPLEMENT: 0x20,\n    FIRST_SEGMENT:           0x40,\n    LAST_SEGMENT:            0x80,\n    SECONDARY_ALIGNMENT:     0x100,\n    QC_FAIL:                 0x200,\n    DUPLICATE:               0x400,\n    SUPPLEMENTARY:           0x800\n};\n\nfunction BamFile() {\n}\n\n\n// Calculate the length (in bytes) of the BAI ref starting at offset.\n// Returns {nbin, length, minBlockIndex}\nfunction _getBaiRefLength(uncba, offset) {\n    var p = offset;\n    var nbin = readInt(uncba, p); p += 4;\n    for (var b = 0; b < nbin; ++b) {\n        var bin = readInt(uncba, p);\n        var nchnk = readInt(uncba, p+4);\n        p += 8 + (nchnk * 16);\n    }\n    var nintv = readInt(uncba, p); p += 4;\n\n    var minBlockIndex = 1000000000;\n    var q = p;\n    for (var i = 0; i < nintv; ++i) {\n        var v = readVob(uncba, q); q += 8;\n        if (v) {\n            var bi = v.block;\n            if (v.offset > 0)\n                bi += 65536;\n\n            if (bi < minBlockIndex)\n                minBlockIndex = bi;\n            break;\n        }\n    }\n    p += (nintv * 8);\n\n    return {\n        minBlockIndex: minBlockIndex,\n        nbin: nbin,\n        length: p - offset\n    };\n}\n\n\nfunction makeBam(data, bai, indexChunks, callback, attempted) {\n    // Do an initial probe on the BAM file to catch any mixed-content errors.\n    data.slice(0, 10).fetch(function(header) {\n        if (header) {\n            return makeBam2(data, bai, indexChunks, callback, attempted);\n        } else {\n            return callback(null, \"Couldn't access BAM.\");\n        }\n    }, {timeout: 5000});\n}\n\nfunction makeBam2(data, bai, indexChunks, callback, attempted) {\n    var bam = new BamFile();\n    bam.data = data;\n    bam.bai = bai;\n    bam.indexChunks = indexChunks;\n\n    var minBlockIndex = bam.indexChunks ? bam.indexChunks.minBlockIndex : 1000000000;\n\n    // Fills out bam.chrToIndex and bam.indexToChr based on the first few bytes of the BAM.\n    function parseBamHeader(r) {\n        if (!r) {\n            return callback(null, \"Couldn't access BAM\");\n        }\n\n        var unc = unbgzf(r, r.byteLength);\n        var uncba = new Uint8Array(unc);\n\n        var magic = readInt(uncba, 0);\n        if (magic != BAM_MAGIC) {\n            return callback(null, \"Not a BAM file, magic=0x\" + magic.toString(16));\n        }\n        var headLen = readInt(uncba, 4);\n        var header = '';\n        for (var i = 0; i < headLen; ++i) {\n            header += String.fromCharCode(uncba[i + 8]);\n        }\n\n        var nRef = readInt(uncba, headLen + 8);\n        var p = headLen + 12;\n\n        bam.chrToIndex = {};\n        bam.indexToChr = [];\n        for (var i = 0; i < nRef; ++i) {\n            var lName = readInt(uncba, p);\n            var name = '';\n            for (var j = 0; j < lName-1; ++j) {\n                name += String.fromCharCode(uncba[p + 4 + j]);\n            }\n            var lRef = readInt(uncba, p + lName + 4);\n            bam.chrToIndex[name] = i;\n            if (name.indexOf('chr') == 0) {\n                bam.chrToIndex[name.substring(3)] = i;\n            } else {\n                bam.chrToIndex['chr' + name] = i;\n            }\n            bam.indexToChr.push(name);\n\n            p = p + 8 + lName;\n        }\n\n        if (bam.indices) {\n            return callback(bam);\n        }\n    }\n\n    function parseBai(header) {\n        if (!header) {\n            return \"Couldn't access BAI\";\n        }\n\n        var uncba = new Uint8Array(header);\n        var baiMagic = readInt(uncba, 0);\n        if (baiMagic != BAI_MAGIC) {\n            return callback(null, 'Not a BAI file, magic=0x' + baiMagic.toString(16));\n        }\n\n        var nref = readInt(uncba, 4);\n\n        bam.indices = [];\n\n        var p = 8;\n        for (var ref = 0; ref < nref; ++ref) {\n            var blockStart = p;\n            var o = _getBaiRefLength(uncba, blockStart);\n            p += o.length;\n\n            minBlockIndex = Math.min(o.minBlockIndex, minBlockIndex);\n\n            var nbin = o.nbin;\n\n            if (nbin > 0) {\n                bam.indices[ref] = new Uint8Array(header, blockStart, p - blockStart);\n            }\n        }\n\n        return true;\n    }\n\n    if (!bam.indexChunks) {\n        bam.bai.fetch(function(header) {   // Do we really need to fetch the whole thing? :-(\n            var result = parseBai(header);\n            if (result !== true) {\n                if (bam.bai.url && typeof(attempted) === \"undefined\") {\n                    // Already attempted x.bam.bai not there so now trying x.bai\n                    bam.bai.url = bam.data.url.replace(new RegExp('.bam$'), '.bai');\n                    \n                     // True lets us know we are making a second attempt\n                    makeBam2(data, bam.bai, indexChunks, callback, true);\n                }\n                else {\n                    // We've attempted x.bam.bai & x.bai and nothing worked\n                    callback(null, result);\n                }\n            } else {\n              bam.data.slice(0, minBlockIndex).fetch(parseBamHeader);\n            }\n        });   // Timeout on first request to catch Chrome mixed-content error.\n    } else {\n        var chunks = bam.indexChunks.chunks;\n        bam.indices = []\n        for (var i = 0; i < chunks.length; i++) {\n           bam.indices[i] = null;  // To be filled out lazily as needed\n        }\n        bam.data.slice(0, minBlockIndex).fetch(parseBamHeader);\n    }\n}\n\n\n\nBamFile.prototype.blocksForRange = function(refId, min, max) {\n    var index = this.indices[refId];\n    if (!index) {\n        return [];\n    }\n\n    var intBinsL = reg2bins(min, max);\n    var intBins = [];\n    for (var i = 0; i < intBinsL.length; ++i) {\n        intBins[intBinsL[i]] = true;\n    }\n    var leafChunks = [], otherChunks = [];\n\n    var nbin = readInt(index, 0);\n    var p = 4;\n    for (var b = 0; b < nbin; ++b) {\n        var bin = readInt(index, p);\n        var nchnk = readInt(index, p+4);\n//        dlog('bin=' + bin + '; nchnk=' + nchnk);\n        p += 8;\n        if (intBins[bin]) {\n            for (var c = 0; c < nchnk; ++c) {\n                var cs = readVob(index, p);\n                var ce = readVob(index, p + 8);\n                (bin < 4681 ? otherChunks : leafChunks).push(new Chunk(cs, ce));\n                p += 16;\n            }\n        } else {\n            p +=  (nchnk * 16);\n        }\n    }\n    // console.log('leafChunks = ' + JSON.stringify(leafChunks));\n    // console.log('otherChunks = ' + JSON.stringify(otherChunks));\n\n    var nintv = readInt(index, p);\n    // console.log('nintv=' + nintv);\n    var lowest = null;\n    var minLin = Math.min(min>>14, nintv - 1), maxLin = Math.min(max>>14, nintv - 1);\n    for (var i = minLin; i <= maxLin; ++i) {\n        var lb =  readVob(index, p + 4 + (i * 8));\n        if (!lb) {\n            continue;\n        }\n        if (!lowest || lb.block < lowest.block || (lb.block == lowest.block && lb.offset < lowest.offset)) {\n            lowest = lb;\n        }\n    }\n    // console.log('Lowest LB = ' + lowest);\n\n    var prunedOtherChunks = [];\n    if (lowest != null) {\n        for (var i = 0; i < otherChunks.length; ++i) {\n            var chnk = otherChunks[i];\n            if (chnk.maxv.block > lowest.block || (chnk.maxv.block == lowest.block && chnk.maxv.offset >= lowest.offset)) {\n                prunedOtherChunks.push(chnk);\n            }\n        }\n    }\n    // console.log('prunedOtherChunks = ' + JSON.stringify(prunedOtherChunks));\n    otherChunks = prunedOtherChunks;\n\n    var intChunks = [];\n    for (var i = 0; i < otherChunks.length; ++i) {\n        intChunks.push(otherChunks[i]);\n    }\n    for (var i = 0; i < leafChunks.length; ++i) {\n        intChunks.push(leafChunks[i]);\n    }\n\n    intChunks.sort(function(c0, c1) {\n        var dif = c0.minv.block - c1.minv.block;\n        if (dif != 0) {\n            return dif;\n        } else {\n            return c0.minv.offset - c1.minv.offset;\n        }\n    });\n    var mergedChunks = [];\n    if (intChunks.length > 0) {\n        var cur = intChunks[0];\n        for (var i = 1; i < intChunks.length; ++i) {\n            var nc = intChunks[i];\n            if (nc.minv.block == cur.maxv.block /* && nc.minv.offset == cur.maxv.offset */) { // no point splitting mid-block\n                cur = new Chunk(cur.minv, nc.maxv);\n            } else {\n                mergedChunks.push(cur);\n                cur = nc;\n            }\n        }\n        mergedChunks.push(cur);\n    }\n    // console.log('mergedChunks = ' + JSON.stringify(mergedChunks));\n\n    return mergedChunks;\n}\n\nBamFile.prototype.fetch = function(chr, min, max, callback, opts) {\n    var thisB = this;\n    opts = opts || {};\n\n    var chrId = this.chrToIndex[chr];\n    var chunks;\n    if (chrId === undefined) {\n        chunks = [];\n    } else {\n        // Fetch this portion of the BAI if it hasn't been loaded yet.\n        if (this.indices[chrId] === null && this.indexChunks.chunks[chrId]) {\n            var start_stop = this.indexChunks.chunks[chrId];\n            return this.bai.slice(start_stop[0], start_stop[1]).fetch(function(data) {\n                var buffer = new Uint8Array(data);\n                this.indices[chrId] = buffer;\n                return this.fetch(chr, min, max, callback, opts);\n            }.bind(this));\n        }\n\n        chunks = this.blocksForRange(chrId, min, max);\n        if (!chunks) {\n            callback(null, 'Error in index fetch');\n        }\n    }\n    \n    var records = [];\n    var index = 0;\n    var data;\n\n    function tramp() {\n        if (index >= chunks.length) {\n            return callback(records);\n        } else if (!data) {\n            var c = chunks[index];\n            var fetchMin = c.minv.block;\n            var fetchMax = c.maxv.block + (1<<16); // *sigh*\n            // console.log('fetching ' + fetchMin + ':' + fetchMax);\n            thisB.data.slice(fetchMin, fetchMax - fetchMin).fetch(function(r) {\n                data = unbgzf(r, c.maxv.block - c.minv.block + 1);\n                return tramp();\n            });\n        } else {\n            var ba = new Uint8Array(data);\n            var finished = thisB.readBamRecords(ba, chunks[index].minv.offset, records, min, max, chrId, opts);\n            data = null;\n            ++index;\n            if (finished)\n                return callback(records);\n            else\n                return tramp();\n        }\n    }\n    tramp();\n}\n\nvar SEQRET_DECODER = ['=', 'A', 'C', 'x', 'G', 'x', 'x', 'x', 'T', 'x', 'x', 'x', 'x', 'x', 'x', 'N'];\nvar CIGAR_DECODER = ['M', 'I', 'D', 'N', 'S', 'H', 'P', '=', 'X', '?', '?', '?', '?', '?', '?', '?'];\n\nfunction BamRecord() {\n}\n\nBamFile.prototype.readBamRecords = function(ba, offset, sink, min, max, chrId, opts) {\n    while (true) {\n        var blockSize = readInt(ba, offset);\n        var blockEnd = offset + blockSize + 4;\n        if (blockEnd > ba.length) {\n            return false;\n        }\n\n        var record = new BamRecord();\n\n        var refID = readInt(ba, offset + 4);\n        var pos = readInt(ba, offset + 8);\n        \n        var bmn = readInt(ba, offset + 12);\n        var bin = (bmn & 0xffff0000) >> 16;\n        var mq = (bmn & 0xff00) >> 8;\n        var nl = bmn & 0xff;\n\n        var flag_nc = readInt(ba, offset + 16);\n        var flag = (flag_nc & 0xffff0000) >> 16;\n        var nc = flag_nc & 0xffff;\n    \n        var lseq = readInt(ba, offset + 20);\n        \n        var nextRef  = readInt(ba, offset + 24);\n        var nextPos = readInt(ba, offset + 28);\n        \n        var tlen = readInt(ba, offset + 32);\n    \n        record.segment = this.indexToChr[refID];\n        record.flag = flag;\n        record.pos = pos;\n        record.mq = mq;\n        if (opts.light)\n            record.seqLength = lseq;\n\n        if (!opts.light || opts.includeName) {\n            var readName = '';\n            for (var j = 0; j < nl-1; ++j) {\n                readName += String.fromCharCode(ba[offset + 36 + j]);\n            }\n            record.readName = readName;\n        }\n        \n        if (!opts.light) {\n            if (nextRef >= 0) {\n                record.nextSegment = this.indexToChr[nextRef];\n                record.nextPos = nextPos;\n            }\n        \n            var p = offset + 36 + nl;\n\n            var cigar = '';\n            for (var c = 0; c < nc; ++c) {\n                var cigop = readInt(ba, p);\n                cigar = cigar + (cigop>>4) + CIGAR_DECODER[cigop & 0xf];\n                p += 4;\n            }\n            record.cigar = cigar;\n        \n            var seq = '';\n            var seqBytes = (lseq + 1) >> 1;\n            for (var j = 0; j < seqBytes; ++j) {\n                var sb = ba[p + j];\n                seq += SEQRET_DECODER[(sb & 0xf0) >> 4];\n                if (seq.length < lseq)\n                    seq += SEQRET_DECODER[(sb & 0x0f)];\n            }\n            p += seqBytes;\n            record.seq = seq;\n\n            var qseq = '';\n            for (var j = 0; j < lseq; ++j) {\n                qseq += String.fromCharCode(ba[p + j] + 33);\n            }\n            p += lseq;\n            record.quals = qseq;\n\n            while (p < blockEnd) {\n                var tag = String.fromCharCode(ba[p], ba[p + 1]);\n                var type = String.fromCharCode(ba[p + 2]);\n                var value;\n\n                if (type == 'A') {\n                    value = String.fromCharCode(ba[p + 3]);\n                    p += 4;\n                } else if (type == 'i' || type == 'I') {\n                    value = readInt(ba, p + 3);\n                    p += 7;\n                } else if (type == 'c' || type == 'C') {\n                    value = ba[p + 3];\n                    p += 4;\n                } else if (type == 's' || type == 'S') {\n                    value = readShort(ba, p + 3);\n                    p += 5;\n                } else if (type == 'f') {\n                    value = readFloat(ba, p + 3);\n                    p += 7;\n                } else if (type == 'Z' || type == 'H') {\n                    p += 3;\n                    value = '';\n                    for (;;) {\n                        var cc = ba[p++];\n                        if (cc == 0) {\n                            break;\n                        } else {\n                            value += String.fromCharCode(cc);\n                        }\n                    }\n                } else if (type == 'B') {\n                    var atype = String.fromCharCode(ba[p + 3]);\n                    var alen = readInt(ba, p + 4);\n                    var elen;\n                    var reader;\n                    if (atype == 'i' || atype == 'I' || atype == 'f') {\n                        elen = 4;\n                        if (atype == 'f')\n                            reader = readFloat;\n                        else\n                            reader = readInt;\n                    } else if (atype == 's' || atype == 'S') {\n                        elen = 2;\n                        reader = readShort;\n                    } else if (atype == 'c' || atype == 'C') {\n                        elen = 1;\n                        reader = readByte;\n                    } else {\n                        throw 'Unknown array type ' + atype;\n                    }\n\n                    p += 8;\n                    value = [];\n                    for (var i = 0; i < alen; ++i) {\n                        value.push(reader(ba, p));\n                        p += elen;\n                    }\n                } else {\n                    throw 'Unknown type '+ type;\n                }\n                record[tag] = value;\n            }\n        }\n\n        if (!min || record.pos <= max && record.pos + lseq >= min) {\n            if (chrId === undefined || refID == chrId) {\n                sink.push(record);\n            }\n        }\n        if (record.pos > max) {\n            return true;\n        }\n        offset = blockEnd;\n    }\n\n    // Exits via top of loop.\n};\n\nif (typeof(module) !== 'undefined') {\n    module.exports = {\n        makeBam: makeBam,\n        BAM_MAGIC: BAM_MAGIC,\n        BAI_MAGIC: BAI_MAGIC,\n        BamFlags: BamFlags\n    };\n}\n","(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){\n/* -*- mode: javascript; c-basic-offset: 4; indent-tabs-mode: nil -*- */\n\n// \n// Dalliance Genome Explorer\n// (c) Thomas Down 2006-2011\n//\n// bam.js: indexed binary alignments\n//\n\n\"use strict\";\n\nif (typeof require !== 'undefined') {\n    var spans = require('./spans');\n    var Range = spans.Range;\n    var union = spans.union;\n    var intersection = spans.intersection;\n\n    var bin = require('./bin');\n    var readInt = bin.readInt;\n    var readShort = bin.readShort;\n    var readByte = bin.readByte;\n    var readInt64 = bin.readInt64;\n    var readFloat = bin.readFloat;\n\n    var lh3utils = require('./lh3utils');\n    var readVob = lh3utils.readVob;\n    var unbgzf = lh3utils.unbgzf;\n    var reg2bins = lh3utils.reg2bins;\n    var Chunk = lh3utils.Chunk;\n}\n\nvar BAM_MAGIC = 0x14d4142;\nvar BAI_MAGIC = 0x1494142;\n\nvar BamFlags = {\n    MULTIPLE_SEGMENTS: 0x1,\n    ALL_SEGMENTS_ALIGN: 0x2,\n    SEGMENT_UNMAPPED: 0x4,\n    NEXT_SEGMENT_UNMAPPED: 0x8,\n    REVERSE_COMPLEMENT: 0x10,\n    NEXT_REVERSE_COMPLEMENT: 0x20,\n    FIRST_SEGMENT: 0x40,\n    LAST_SEGMENT: 0x80,\n    SECONDARY_ALIGNMENT: 0x100,\n    QC_FAIL: 0x200,\n    DUPLICATE: 0x400,\n    SUPPLEMENTARY: 0x800\n};\n\nfunction BamFile() {}\n\n// Calculate the length (in bytes) of the BAI ref starting at offset.\n// Returns {nbin, length, minBlockIndex}\nfunction _getBaiRefLength(uncba, offset) {\n    var p = offset;\n    var nbin = readInt(uncba, p);p += 4;\n    for (var b = 0; b < nbin; ++b) {\n        var bin = readInt(uncba, p);\n        var nchnk = readInt(uncba, p + 4);\n        p += 8 + nchnk * 16;\n    }\n    var nintv = readInt(uncba, p);p += 4;\n\n    var minBlockIndex = 1000000000;\n    var q = p;\n    for (var i = 0; i < nintv; ++i) {\n        var v = readVob(uncba, q);q += 8;\n        if (v) {\n            var bi = v.block;\n            if (v.offset > 0) bi += 65536;\n\n            if (bi < minBlockIndex) minBlockIndex = bi;\n            break;\n        }\n    }\n    p += nintv * 8;\n\n    return {\n        minBlockIndex: minBlockIndex,\n        nbin: nbin,\n        length: p - offset\n    };\n}\n\nfunction makeBam(data, bai, indexChunks, callback, attempted) {\n    // Do an initial probe on the BAM file to catch any mixed-content errors.\n    data.slice(0, 10).fetch(function (header) {\n        if (header) {\n            return makeBam2(data, bai, indexChunks, callback, attempted);\n        } else {\n            return callback(null, \"Couldn't access BAM.\");\n        }\n    }, { timeout: 5000 });\n}\n\nfunction makeBam2(data, bai, indexChunks, callback, attempted) {\n    var bam = new BamFile();\n    bam.data = data;\n    bam.bai = bai;\n    bam.indexChunks = indexChunks;\n\n    var minBlockIndex = bam.indexChunks ? bam.indexChunks.minBlockIndex : 1000000000;\n\n    // Fills out bam.chrToIndex and bam.indexToChr based on the first few bytes of the BAM.\n    function parseBamHeader(r) {\n        if (!r) {\n            return callback(null, \"Couldn't access BAM\");\n        }\n\n        var unc = unbgzf(r, r.byteLength);\n        var uncba = new Uint8Array(unc);\n\n        var magic = readInt(uncba, 0);\n        if (magic != BAM_MAGIC) {\n            return callback(null, \"Not a BAM file, magic=0x\" + magic.toString(16));\n        }\n        var headLen = readInt(uncba, 4);\n        var header = '';\n        for (var i = 0; i < headLen; ++i) {\n            header += String.fromCharCode(uncba[i + 8]);\n        }\n\n        var nRef = readInt(uncba, headLen + 8);\n        var p = headLen + 12;\n\n        bam.chrToIndex = {};\n        bam.indexToChr = [];\n        for (var i = 0; i < nRef; ++i) {\n            var lName = readInt(uncba, p);\n            var name = '';\n            for (var j = 0; j < lName - 1; ++j) {\n                name += String.fromCharCode(uncba[p + 4 + j]);\n            }\n            var lRef = readInt(uncba, p + lName + 4);\n            bam.chrToIndex[name] = i;\n            if (name.indexOf('chr') == 0) {\n                bam.chrToIndex[name.substring(3)] = i;\n            } else {\n                bam.chrToIndex['chr' + name] = i;\n            }\n            bam.indexToChr.push(name);\n\n            p = p + 8 + lName;\n        }\n\n        if (bam.indices) {\n            return callback(bam);\n        }\n    }\n\n    function parseBai(header) {\n        if (!header) {\n            return \"Couldn't access BAI\";\n        }\n\n        var uncba = new Uint8Array(header);\n        var baiMagic = readInt(uncba, 0);\n        if (baiMagic != BAI_MAGIC) {\n            return callback(null, 'Not a BAI file, magic=0x' + baiMagic.toString(16));\n        }\n\n        var nref = readInt(uncba, 4);\n\n        bam.indices = [];\n\n        var p = 8;\n        for (var ref = 0; ref < nref; ++ref) {\n            var blockStart = p;\n            var o = _getBaiRefLength(uncba, blockStart);\n            p += o.length;\n\n            minBlockIndex = Math.min(o.minBlockIndex, minBlockIndex);\n\n            var nbin = o.nbin;\n\n            if (nbin > 0) {\n                bam.indices[ref] = new Uint8Array(header, blockStart, p - blockStart);\n            }\n        }\n\n        return true;\n    }\n\n    if (!bam.indexChunks) {\n        bam.bai.fetch(function (header) {\n            // Do we really need to fetch the whole thing? :-(\n            var result = parseBai(header);\n            if (result !== true) {\n                if (bam.bai.url && typeof attempted === \"undefined\") {\n                    // Already attempted x.bam.bai not there so now trying x.bai\n                    bam.bai.url = bam.data.url.replace(new RegExp('.bam$'), '.bai');\n\n                    // True lets us know we are making a second attempt\n                    makeBam2(data, bam.bai, indexChunks, callback, true);\n                } else {\n                    // We've attempted x.bam.bai & x.bai and nothing worked\n                    callback(null, result);\n                }\n            } else {\n                bam.data.slice(0, minBlockIndex).fetch(parseBamHeader);\n            }\n        }); // Timeout on first request to catch Chrome mixed-content error.\n    } else {\n        var chunks = bam.indexChunks.chunks;\n        bam.indices = [];\n        for (var i = 0; i < chunks.length; i++) {\n            bam.indices[i] = null; // To be filled out lazily as needed\n        }\n        bam.data.slice(0, minBlockIndex).fetch(parseBamHeader);\n    }\n}\n\nBamFile.prototype.blocksForRange = function (refId, min, max) {\n    var index = this.indices[refId];\n    if (!index) {\n        return [];\n    }\n\n    var intBinsL = reg2bins(min, max);\n    var intBins = [];\n    for (var i = 0; i < intBinsL.length; ++i) {\n        intBins[intBinsL[i]] = true;\n    }\n    var leafChunks = [],\n        otherChunks = [];\n\n    var nbin = readInt(index, 0);\n    var p = 4;\n    for (var b = 0; b < nbin; ++b) {\n        var bin = readInt(index, p);\n        var nchnk = readInt(index, p + 4);\n        //        dlog('bin=' + bin + '; nchnk=' + nchnk);\n        p += 8;\n        if (intBins[bin]) {\n            for (var c = 0; c < nchnk; ++c) {\n                var cs = readVob(index, p);\n                var ce = readVob(index, p + 8);\n                (bin < 4681 ? otherChunks : leafChunks).push(new Chunk(cs, ce));\n                p += 16;\n            }\n        } else {\n            p += nchnk * 16;\n        }\n    }\n    // console.log('leafChunks = ' + JSON.stringify(leafChunks));\n    // console.log('otherChunks = ' + JSON.stringify(otherChunks));\n\n    var nintv = readInt(index, p);\n    // console.log('nintv=' + nintv);\n    var lowest = null;\n    var minLin = Math.min(min >> 14, nintv - 1),\n        maxLin = Math.min(max >> 14, nintv - 1);\n    for (var i = minLin; i <= maxLin; ++i) {\n        var lb = readVob(index, p + 4 + i * 8);\n        if (!lb) {\n            continue;\n        }\n        if (!lowest || lb.block < lowest.block || lb.block == lowest.block && lb.offset < lowest.offset) {\n            lowest = lb;\n        }\n    }\n    // console.log('Lowest LB = ' + lowest);\n\n    var prunedOtherChunks = [];\n    if (lowest != null) {\n        for (var i = 0; i < otherChunks.length; ++i) {\n            var chnk = otherChunks[i];\n            if (chnk.maxv.block > lowest.block || chnk.maxv.block == lowest.block && chnk.maxv.offset >= lowest.offset) {\n                prunedOtherChunks.push(chnk);\n            }\n        }\n    }\n    // console.log('prunedOtherChunks = ' + JSON.stringify(prunedOtherChunks));\n    otherChunks = prunedOtherChunks;\n\n    var intChunks = [];\n    for (var i = 0; i < otherChunks.length; ++i) {\n        intChunks.push(otherChunks[i]);\n    }\n    for (var i = 0; i < leafChunks.length; ++i) {\n        intChunks.push(leafChunks[i]);\n    }\n\n    intChunks.sort(function (c0, c1) {\n        var dif = c0.minv.block - c1.minv.block;\n        if (dif != 0) {\n            return dif;\n        } else {\n            return c0.minv.offset - c1.minv.offset;\n        }\n    });\n    var mergedChunks = [];\n    if (intChunks.length > 0) {\n        var cur = intChunks[0];\n        for (var i = 1; i < intChunks.length; ++i) {\n            var nc = intChunks[i];\n            if (nc.minv.block == cur.maxv.block /* && nc.minv.offset == cur.maxv.offset */) {\n                    // no point splitting mid-block\n                    cur = new Chunk(cur.minv, nc.maxv);\n                } else {\n                mergedChunks.push(cur);\n                cur = nc;\n            }\n        }\n        mergedChunks.push(cur);\n    }\n    // console.log('mergedChunks = ' + JSON.stringify(mergedChunks));\n\n    return mergedChunks;\n};\n\nBamFile.prototype.fetch = function (chr, min, max, callback, opts) {\n    var thisB = this;\n    opts = opts || {};\n\n    var chrId = this.chrToIndex[chr];\n    var chunks;\n    if (chrId === undefined) {\n        chunks = [];\n    } else {\n        // Fetch this portion of the BAI if it hasn't been loaded yet.\n        if (this.indices[chrId] === null && this.indexChunks.chunks[chrId]) {\n            var start_stop = this.indexChunks.chunks[chrId];\n            return this.bai.slice(start_stop[0], start_stop[1]).fetch(function (data) {\n                var buffer = new Uint8Array(data);\n                this.indices[chrId] = buffer;\n                return this.fetch(chr, min, max, callback, opts);\n            }.bind(this));\n        }\n\n        chunks = this.blocksForRange(chrId, min, max);\n        if (!chunks) {\n            callback(null, 'Error in index fetch');\n        }\n    }\n\n    var records = [];\n    var index = 0;\n    var data;\n\n    function tramp() {\n        if (index >= chunks.length) {\n            return callback(records);\n        } else if (!data) {\n            var c = chunks[index];\n            var fetchMin = c.minv.block;\n            var fetchMax = c.maxv.block + (1 << 16); // *sigh*\n            // console.log('fetching ' + fetchMin + ':' + fetchMax);\n            thisB.data.slice(fetchMin, fetchMax - fetchMin).fetch(function (r) {\n                data = unbgzf(r, c.maxv.block - c.minv.block + 1);\n                return tramp();\n            });\n        } else {\n            var ba = new Uint8Array(data);\n            var finished = thisB.readBamRecords(ba, chunks[index].minv.offset, records, min, max, chrId, opts);\n            data = null;\n            ++index;\n            if (finished) return callback(records);else return tramp();\n        }\n    }\n    tramp();\n};\n\nvar SEQRET_DECODER = ['=', 'A', 'C', 'x', 'G', 'x', 'x', 'x', 'T', 'x', 'x', 'x', 'x', 'x', 'x', 'N'];\nvar CIGAR_DECODER = ['M', 'I', 'D', 'N', 'S', 'H', 'P', '=', 'X', '?', '?', '?', '?', '?', '?', '?'];\n\nfunction BamRecord() {}\n\nBamFile.prototype.readBamRecords = function (ba, offset, sink, min, max, chrId, opts) {\n    while (true) {\n        var blockSize = readInt(ba, offset);\n        var blockEnd = offset + blockSize + 4;\n        if (blockEnd > ba.length) {\n            return false;\n        }\n\n        var record = new BamRecord();\n\n        var refID = readInt(ba, offset + 4);\n        var pos = readInt(ba, offset + 8);\n\n        var bmn = readInt(ba, offset + 12);\n        var bin = (bmn & 0xffff0000) >> 16;\n        var mq = (bmn & 0xff00) >> 8;\n        var nl = bmn & 0xff;\n\n        var flag_nc = readInt(ba, offset + 16);\n        var flag = (flag_nc & 0xffff0000) >> 16;\n        var nc = flag_nc & 0xffff;\n\n        var lseq = readInt(ba, offset + 20);\n\n        var nextRef = readInt(ba, offset + 24);\n        var nextPos = readInt(ba, offset + 28);\n\n        var tlen = readInt(ba, offset + 32);\n\n        record.segment = this.indexToChr[refID];\n        record.flag = flag;\n        record.pos = pos;\n        record.mq = mq;\n        if (opts.light) record.seqLength = lseq;\n\n        if (!opts.light || opts.includeName) {\n            var readName = '';\n            for (var j = 0; j < nl - 1; ++j) {\n                readName += String.fromCharCode(ba[offset + 36 + j]);\n            }\n            record.readName = readName;\n        }\n\n        if (!opts.light) {\n            if (nextRef >= 0) {\n                record.nextSegment = this.indexToChr[nextRef];\n                record.nextPos = nextPos;\n            }\n\n            var p = offset + 36 + nl;\n\n            var cigar = '';\n            for (var c = 0; c < nc; ++c) {\n                var cigop = readInt(ba, p);\n                cigar = cigar + (cigop >> 4) + CIGAR_DECODER[cigop & 0xf];\n                p += 4;\n            }\n            record.cigar = cigar;\n\n            var seq = '';\n            var seqBytes = lseq + 1 >> 1;\n            for (var j = 0; j < seqBytes; ++j) {\n                var sb = ba[p + j];\n                seq += SEQRET_DECODER[(sb & 0xf0) >> 4];\n                if (seq.length < lseq) seq += SEQRET_DECODER[sb & 0x0f];\n            }\n            p += seqBytes;\n            record.seq = seq;\n\n            var qseq = '';\n            for (var j = 0; j < lseq; ++j) {\n                qseq += String.fromCharCode(ba[p + j] + 33);\n            }\n            p += lseq;\n            record.quals = qseq;\n\n            while (p < blockEnd) {\n                var tag = String.fromCharCode(ba[p], ba[p + 1]);\n                var type = String.fromCharCode(ba[p + 2]);\n                var value;\n\n                if (type == 'A') {\n                    value = String.fromCharCode(ba[p + 3]);\n                    p += 4;\n                } else if (type == 'i' || type == 'I') {\n                    value = readInt(ba, p + 3);\n                    p += 7;\n                } else if (type == 'c' || type == 'C') {\n                    value = ba[p + 3];\n                    p += 4;\n                } else if (type == 's' || type == 'S') {\n                    value = readShort(ba, p + 3);\n                    p += 5;\n                } else if (type == 'f') {\n                    value = readFloat(ba, p + 3);\n                    p += 7;\n                } else if (type == 'Z' || type == 'H') {\n                    p += 3;\n                    value = '';\n                    for (;;) {\n                        var cc = ba[p++];\n                        if (cc == 0) {\n                            break;\n                        } else {\n                            value += String.fromCharCode(cc);\n                        }\n                    }\n                } else if (type == 'B') {\n                    var atype = String.fromCharCode(ba[p + 3]);\n                    var alen = readInt(ba, p + 4);\n                    var elen;\n                    var reader;\n                    if (atype == 'i' || atype == 'I' || atype == 'f') {\n                        elen = 4;\n                        if (atype == 'f') reader = readFloat;else reader = readInt;\n                    } else if (atype == 's' || atype == 'S') {\n                        elen = 2;\n                        reader = readShort;\n                    } else if (atype == 'c' || atype == 'C') {\n                        elen = 1;\n                        reader = readByte;\n                    } else {\n                        throw 'Unknown array type ' + atype;\n                    }\n\n                    p += 8;\n                    value = [];\n                    for (var i = 0; i < alen; ++i) {\n                        value.push(reader(ba, p));\n                        p += elen;\n                    }\n                } else {\n                    throw 'Unknown type ' + type;\n                }\n                record[tag] = value;\n            }\n        }\n\n        if (!min || record.pos <= max && record.pos + lseq >= min) {\n            if (chrId === undefined || refID == chrId) {\n                sink.push(record);\n            }\n        }\n        if (record.pos > max) {\n            return true;\n        }\n        offset = blockEnd;\n    }\n\n    // Exits via top of loop.\n};\n\nif (typeof module !== 'undefined') {\n    module.exports = {\n        makeBam: makeBam,\n        BAM_MAGIC: BAM_MAGIC,\n        BAI_MAGIC: BAI_MAGIC,\n        BamFlags: BamFlags\n    };\n}\n\n},{\"./bin\":4,\"./lh3utils\":27,\"./spans\":41}],2:[function(require,module,exports){\n/* -*- mode: javascript; c-basic-offset: 4; indent-tabs-mode: nil -*- */\n\n// \n// Dalliance Genome Explorer\n// (c) Thomas Down 2006-2014\n//\n// bedwig.js\n//\n\n\"use strict\";\n\nif (typeof require !== 'undefined') {\n    var spans = require('./spans');\n    var Range = spans.Range;\n    var union = spans.union;\n    var intersection = spans.intersection;\n\n    var sa = require('./sourceadapters');\n    var dalliance_registerParserFactory = sa.registerParserFactory;\n\n    var das = require('./das');\n    var DASStylesheet = das.DASStylesheet;\n    var DASStyle = das.DASStyle;\n    var DASFeature = das.DASFeature;\n    var DASGroup = das.DASGroup;\n\n    var utils = require('./utils');\n    var shallowCopy = utils.shallowCopy;\n\n    var revalidator = require('revalidator');\n}\n\nfunction BedWigParser(type) {\n    this.type = type;\n}\n\nBedWigParser.prototype.createSession = function (sink) {\n    if (this.type == 'wig') return new WigParseSession(this, sink);else return new BedParseSession(this, sink);\n};\n\nvar __KV_REGEXP = /([^=]+)=(.+)/;\nvar __SPACE_REGEXP = /\\s/;\nvar BED_COLOR_REGEXP = new RegExp(\"^[0-9]+,[0-9]+,[0-9]+\");\n\nfunction BedParseSession(parser, sink) {\n    this.parser = parser;\n    this.sink = sink;\n}\n\nBedParseSession.prototype.parse = function (line) {\n    var toks = line.split(__SPACE_REGEXP);\n    if (toks.length < 3) return;\n\n    var start = parseInt(toks[1]) + 1;\n    var end = parseInt(toks[2]);\n\n    var f = { segment: toks[0],\n        min: start,\n        max: end };\n\n    if (toks.length > 3 && toks[3] !== '.') {\n        f.label = toks[3];\n    }\n\n    if (toks.length > 4) {\n        f.score = parseFloat(toks[4]);\n    }\n\n    if (toks.length > 5) {\n        f.orientation = toks[5];\n    }\n\n    if (toks.length > 8) {\n        var color = toks[8];\n        if (BED_COLOR_REGEXP.test(color)) {\n            f.itemRgb = 'rgb(' + color + ')';\n        }\n    }\n\n    if (toks.length >= 12) {\n        var thickStart = parseInt(toks[6]);\n        var thickEnd = parseInt(toks[7]);\n        var blockCount = parseInt(toks[9]);\n        var blockSizes = toks[10].split(',').map(function (x) {\n            return parseInt(x);\n        });\n        var blockStarts = toks[11].split(',').map(function (x) {\n            return parseInt(x);\n        });\n\n        f.type = 'transcript';\n        var grp = new DASGroup();\n        grp.id = toks[3];\n        grp.type = 'transcript';\n        grp.notes = [];\n        f.groups = [grp];\n\n        if (toks.length > 12) {\n            var geneId = toks[12];\n            var geneName = geneId;\n            if (toks.length > 13) {\n                geneName = toks[13];\n            }\n            var gg = new DASGroup();\n            gg.id = geneId;\n            gg.label = geneName;\n            gg.type = 'gene';\n            f.groups.push(gg);\n        }\n\n        var spans = null;\n        for (var b = 0; b < blockCount; ++b) {\n            var bmin = blockStarts[b] + start;\n            var bmax = bmin + blockSizes[b];\n            var span = new Range(bmin, bmax);\n            if (spans) {\n                spans = union(spans, span);\n            } else {\n                spans = span;\n            }\n        }\n\n        var tsList = spans.ranges();\n        for (var s = 0; s < tsList.length; ++s) {\n            var ts = tsList[s];\n            var bf = shallowCopy(f);\n            bf.min = ts.min();\n            bf.max = ts.max();\n            this.sink(bf);\n        }\n\n        if (thickEnd > thickStart) {\n            var codingRegion = f.orientation == '+' ? new Range(thickStart, thickEnd + 3) : new Range(thickStart - 3, thickEnd);\n            // +/- 3 to account for stop codon\n\n            var tl = intersection(spans, codingRegion);\n            if (tl) {\n                f.type = 'translation';\n                var tlList = tl.ranges();\n                var readingFrame = 0;\n                for (var s = 0; s < tlList.length; ++s) {\n                    // Record reading frame for every exon\n                    var index = s;\n                    if (f.orientation == '-') index = tlList.length - s - 1;\n                    var ts = tlList[index];\n                    var bf = shallowCopy(f);\n                    bf.min = ts.min();\n                    bf.max = ts.max();\n                    f.readframe = readingFrame;\n                    var length = ts.max() - ts.min();\n                    readingFrame = (readingFrame + length) % 3;\n                    this.sink(bf);\n                }\n            }\n        }\n    } else {\n        this.sink(f);\n    }\n};\n\nBedParseSession.prototype.flush = function () {};\n\nBedParseSession.prototype.schema = {\n    properties: {\n        segment: {\n            description: 'the name of the region containing the feature',\n            type: 'string',\n            required: true\n        },\n        min: {\n            description: 'the start position of the feature (0-based)',\n            type: 'integer',\n            minimum: 1,\n            required: true\n        },\n        max: {\n            description: 'the end position of the feature (1-based)',\n            type: 'integer',\n            required: true\n        },\n        label: {\n            description: 'the label for a feature',\n            type: 'string'\n        },\n        score: {\n            description: 'score of a feature',\n            type: 'float'\n        },\n        orientation: {\n            description: 'strand of feature',\n            type: 'string',\n            enum: ['+', '-', '.']\n        },\n        itemRGB: {\n            description: 'rgb color to draw feature',\n            type: 'string',\n            pattern: '^rgb\\([0-9]+,[0-9]+,[0-9]+)$'\n        },\n        type: {\n            description: 'type of feature',\n            type: 'string',\n            enum: ['transcript', 'translation']\n        },\n        readingFrame: {\n            description: 'open reading frame at the start of the interval',\n            type: 'integer',\n            minimum: 0,\n            maximum: 2\n        },\n        groups: {\n            description: 'list of groups that a feature belongs to',\n            type: 'array',\n            items: {\n                type: 'object',\n                properties: {\n                    id: {\n                        type: 'string',\n                        required: true\n                    },\n                    label: {\n                        type: 'string',\n                        required: true\n                    },\n                    type: {\n                        type: 'string',\n                        required: true\n                    }\n                }\n            }\n        }\n    }\n};\n\nBedParseSession.prototype.validate = function (f) {\n    // use revalidator.validate to check if feature f is valid\n    var check = revalidator.validate(f, this.schema);\n    if (check.valid) {\n        this.sink(f);\n    } else {\n        console.log(check.errors);\n    }\n};\n\nfunction WigParseSession(parser, sink) {\n    this.parser = parser;\n    this.sink = sink;\n    this.wigState = null;\n}\n\nWigParseSession.prototype.parse = function (line) {\n    var toks = line.split(__SPACE_REGEXP);\n\n    if (toks[0] == 'fixedStep') {\n        this.wigState = 'fixedStep';\n        this.chr = this.pos = this.step = null;\n        this.span = 1;\n\n        for (var ti = 1; ti < toks.length; ++ti) {\n            var m = __KV_REGEXP.exec(toks[ti]);\n            if (m) {\n                if (m[1] == 'chrom') {\n                    this.chr = m[2];\n                } else if (m[1] == 'start') {\n                    this.pos = parseInt(m[2]);\n                } else if (m[1] == 'step') {\n                    this.step = parseInt(m[2]);\n                } else if (m[1] == 'span') {\n                    this.span = parseInt(m[2]);\n                }\n            }\n        }\n    } else if (toks[0] == 'variableStep') {\n        this.wigState = 'variableStep';\n        this.chr = null;\n        this.span = 1;\n\n        for (var ti = 1; ti < toks.length; ++ti) {\n            var m = __KV_REGEXP.exec(toks[ti]);\n            if (m[1] == 'chrom') {\n                this.chr = m[2];\n            } else if (m[1] == 'span') {\n                this.span = parseInt(m[2]);\n            }\n        }\n    } else {\n        if (!this.wigState) {\n            if (toks.length < 4) return;\n\n            var f = { segment: toks[0],\n                min: parseInt(toks[1]) + 1,\n                max: parseInt(toks[2]),\n                score: parseFloat(toks[3]) };\n\n            this.sink(f);\n        } else if (this.wigState == 'fixedStep') {\n            if (toks.length != 1) return;\n            var score = parseFloat(toks[0]);\n            var f = { segment: this.chr, min: this.pos, max: this.pos + this.span - 1, score: score };\n            this.pos += this.step;\n            this.sink(f);\n        } else if (this.wigState == 'variableStep') {\n            if (toks.length != 2) return;\n            var pos = parseInt(toks[0]);\n            var score = parseFloat(toks[1]);\n            var f = { segment: this.chr, min: pos, max: pos + this.span - 1, score: score };\n            this.sink(f);\n        }\n    }\n};\n\nWigParseSession.prototype.flush = function () {};\n\nWigParseSession.prototype.schema = {\n    properties: {\n        segment: {\n            description: 'the name of the region containing the feature',\n            type: 'string',\n            required: true\n        },\n        min: {\n            description: 'the start position of the feature',\n            type: 'integer',\n            minimum: 1,\n            required: true\n        },\n        max: {\n            description: 'the end position of the feature',\n            type: 'integer',\n            required: true\n        },\n        score: {\n            description: 'score of a feature',\n            type: 'float',\n            required: true\n        }\n    }\n};\n\nWigParseSession.prototype.validate = function (f) {\n    // use revalidator.validate to check if feature f is valid\n    var check = revalidator.validate(f, this.schema);\n    if (check.valid) {\n        this.sink(f);\n    } else {\n        console.log(check.errors);\n    }\n};\n\nBedWigParser.prototype.getStyleSheet = function (callback) {\n    var thisB = this;\n    var stylesheet = new DASStylesheet();\n\n    if (this.type == 'wig') {\n        var wigStyle = new DASStyle();\n        wigStyle.glyph = 'HISTOGRAM';\n        wigStyle.BGCOLOR = 'blue';\n        wigStyle.HEIGHT = 30;\n        stylesheet.pushStyle({ type: 'default' }, null, wigStyle);\n    } else {\n        var wigStyle = new DASStyle();\n        wigStyle.glyph = 'BOX';\n        wigStyle.FGCOLOR = 'black';\n        wigStyle.BGCOLOR = 'blue';\n        wigStyle.HEIGHT = 8;\n        wigStyle.BUMP = true;\n        wigStyle.LABEL = true;\n        wigStyle.ZINDEX = 20;\n        stylesheet.pushStyle({ type: 'default' }, null, wigStyle);\n\n        var wigStyle = new DASStyle();\n        wigStyle.glyph = 'BOX';\n        wigStyle.FGCOLOR = 'black';\n        wigStyle.BGCOLOR = 'red';\n        wigStyle.HEIGHT = 10;\n        wigStyle.BUMP = true;\n        wigStyle.ZINDEX = 20;\n        stylesheet.pushStyle({ type: 'translation' }, null, wigStyle);\n\n        var tsStyle = new DASStyle();\n        tsStyle.glyph = 'BOX';\n        tsStyle.FGCOLOR = 'black';\n        tsStyle.BGCOLOR = 'white';\n        tsStyle.HEIGHT = 10;\n        tsStyle.ZINDEX = 10;\n        tsStyle.BUMP = true;\n        tsStyle.LABEL = true;\n        stylesheet.pushStyle({ type: 'transcript' }, null, tsStyle);\n\n        var densStyle = new DASStyle();\n        densStyle.glyph = 'HISTOGRAM';\n        densStyle.COLOR1 = 'white';\n        densStyle.COLOR2 = 'black';\n        densStyle.HEIGHT = 30;\n        stylesheet.pushStyle({ type: 'density' }, null, densStyle);\n    }\n\n    return callback(stylesheet);\n};\n\ndalliance_registerParserFactory('bed', function (t) {\n    return new BedWigParser(t);\n});\ndalliance_registerParserFactory('wig', function (t) {\n    return new BedWigParser(t);\n});\n\n},{\"./das\":11,\"./sourceadapters\":39,\"./spans\":41,\"./utils\":56,\"revalidator\":74}],3:[function(require,module,exports){\n/* -*- mode: javascript; c-basic-offset: 4; indent-tabs-mode: nil -*- */\n\n// \n// Dalliance Genome Explorer\n// (c) Thomas Down 2006-2010\n//\n// bigwig.js: indexed binary WIG (and BED) files\n//\n\n\"use strict\";\n\nif (typeof require !== 'undefined') {\n    var spans = require('./spans');\n    var Range = spans.Range;\n    var union = spans.union;\n    var intersection = spans.intersection;\n\n    var das = require('./das');\n    var DASFeature = das.DASFeature;\n    var DASGroup = das.DASGroup;\n\n    var utils = require('./utils');\n    var shallowCopy = utils.shallowCopy;\n\n    var bin = require('./bin');\n    var readInt = bin.readInt;\n\n    var jszlib = require('jszlib');\n    var jszlib_inflate_buffer = jszlib.inflateBuffer;\n    var arrayCopy = jszlib.arrayCopy;\n}\n\nvar BIG_WIG_MAGIC = 0x888FFC26;\nvar BIG_WIG_MAGIC_BE = 0x26FC8F88;\nvar BIG_BED_MAGIC = 0x8789F2EB;\nvar BIG_BED_MAGIC_BE = 0xEBF28987;\n\nvar BIG_WIG_TYPE_GRAPH = 1;\nvar BIG_WIG_TYPE_VSTEP = 2;\nvar BIG_WIG_TYPE_FSTEP = 3;\n\nvar M1 = 256;\nvar M2 = 256 * 256;\nvar M3 = 256 * 256 * 256;\nvar M4 = 256 * 256 * 256 * 256;\n\nvar BED_COLOR_REGEXP = new RegExp(\"^[0-9]+,[0-9]+,[0-9]+\");\n\nfunction bwg_readOffset(ba, o) {\n    var offset = ba[o] + ba[o + 1] * M1 + ba[o + 2] * M2 + ba[o + 3] * M3 + ba[o + 4] * M4;\n    return offset;\n}\n\nfunction BigWig() {}\n\nBigWig.prototype.readChromTree = function (callback) {\n    var thisB = this;\n    this.chromsToIDs = {};\n    this.idsToChroms = {};\n    this.maxID = 0;\n\n    var udo = this.unzoomedDataOffset;\n    var eb = udo - this.chromTreeOffset & 3;\n    udo = udo + 4 - eb;\n\n    this.data.slice(this.chromTreeOffset, udo - this.chromTreeOffset).fetch(function (bpt) {\n        var ba = new Uint8Array(bpt);\n        var sa = new Int16Array(bpt);\n        var la = new Int32Array(bpt);\n        var bptMagic = la[0];\n        var blockSize = la[1];\n        var keySize = la[2];\n        var valSize = la[3];\n        var itemCount = bwg_readOffset(ba, 16);\n        var rootNodeOffset = 32;\n\n        var bptReadNode = function bptReadNode(offset) {\n            var nodeType = ba[offset];\n            var cnt = sa[offset / 2 + 1];\n            offset += 4;\n            for (var n = 0; n < cnt; ++n) {\n                if (nodeType == 0) {\n                    offset += keySize;\n                    var childOffset = bwg_readOffset(ba, offset);\n                    offset += 8;\n                    childOffset -= thisB.chromTreeOffset;\n                    bptReadNode(childOffset);\n                } else {\n                    var key = '';\n                    for (var ki = 0; ki < keySize; ++ki) {\n                        var charCode = ba[offset++];\n                        if (charCode != 0) {\n                            key += String.fromCharCode(charCode);\n                        }\n                    }\n                    var chromId = ba[offset + 3] << 24 | ba[offset + 2] << 16 | ba[offset + 1] << 8 | ba[offset + 0];\n                    var chromSize = ba[offset + 7] << 24 | ba[offset + 6] << 16 | ba[offset + 5] << 8 | ba[offset + 4];\n                    offset += 8;\n\n                    thisB.chromsToIDs[key] = chromId;\n                    if (key.indexOf('chr') == 0) {\n                        thisB.chromsToIDs[key.substr(3)] = chromId;\n                    }\n                    thisB.idsToChroms[chromId] = key;\n                    thisB.maxID = Math.max(thisB.maxID, chromId);\n                }\n            }\n        };\n        bptReadNode(rootNodeOffset);\n\n        callback(thisB);\n    });\n};\n\nfunction BigWigView(bwg, cirTreeOffset, cirTreeLength, isSummary) {\n    this.bwg = bwg;\n    this.cirTreeOffset = cirTreeOffset;\n    this.cirTreeLength = cirTreeLength;\n    this.isSummary = isSummary;\n}\n\nBigWigView.prototype.readWigData = function (chrName, min, max, callback) {\n    var chr = this.bwg.chromsToIDs[chrName];\n    if (chr === undefined) {\n        // Not an error because some .bwgs won't have data for all chromosomes.\n        return callback([]);\n    } else {\n        this.readWigDataById(chr, min, max, callback);\n    }\n};\n\nBigWigView.prototype.readWigDataById = function (chr, min, max, callback) {\n    var thisB = this;\n    if (!this.cirHeader) {\n        this.bwg.data.slice(this.cirTreeOffset, 48).fetch(function (result) {\n            thisB.cirHeader = result;\n            var la = new Int32Array(thisB.cirHeader);\n            thisB.cirBlockSize = la[1];\n            thisB.readWigDataById(chr, min, max, callback);\n        });\n        return;\n    }\n\n    var blocksToFetch = [];\n    var outstanding = 0;\n\n    var beforeBWG = Date.now();\n\n    var filter = function filter(chromId, fmin, fmax, toks) {\n        return (chr < 0 || chromId == chr) && fmin <= max && fmax >= min;\n    };\n\n    var cirFobRecur = function cirFobRecur(offset, level) {\n        if (thisB.bwg.instrument) console.log('level=' + level + '; offset=' + offset + '; time=' + (Date.now() | 0));\n\n        outstanding += offset.length;\n\n        if (offset.length == 1 && offset[0] - thisB.cirTreeOffset == 48 && thisB.cachedCirRoot) {\n            cirFobRecur2(thisB.cachedCirRoot, 0, level);\n            --outstanding;\n            if (outstanding == 0) {\n                thisB.fetchFeatures(filter, blocksToFetch, callback);\n            }\n            return;\n        }\n\n        var maxCirBlockSpan = 4 + thisB.cirBlockSize * 32; // Upper bound on size, based on a completely full leaf node.\n        var spans;\n        for (var i = 0; i < offset.length; ++i) {\n            var blockSpan = new Range(offset[i], offset[i] + maxCirBlockSpan);\n            spans = spans ? union(spans, blockSpan) : blockSpan;\n        }\n\n        var fetchRanges = spans.ranges();\n        for (var r = 0; r < fetchRanges.length; ++r) {\n            var fr = fetchRanges[r];\n            cirFobStartFetch(offset, fr, level);\n        }\n    };\n\n    var cirFobStartFetch = function cirFobStartFetch(offset, fr, level, attempts) {\n        var length = fr.max() - fr.min();\n        thisB.bwg.data.slice(fr.min(), fr.max() - fr.min()).fetch(function (resultBuffer) {\n            for (var i = 0; i < offset.length; ++i) {\n                if (fr.contains(offset[i])) {\n                    cirFobRecur2(resultBuffer, offset[i] - fr.min(), level);\n\n                    if (offset[i] - thisB.cirTreeOffset == 48 && offset[i] - fr.min() == 0) thisB.cachedCirRoot = resultBuffer;\n\n                    --outstanding;\n                    if (outstanding == 0) {\n                        thisB.fetchFeatures(filter, blocksToFetch, callback);\n                    }\n                }\n            }\n        });\n    };\n\n    var cirFobRecur2 = function cirFobRecur2(cirBlockData, offset, level) {\n        var ba = new Uint8Array(cirBlockData);\n        var sa = new Int16Array(cirBlockData);\n        var la = new Int32Array(cirBlockData);\n\n        var isLeaf = ba[offset];\n        var cnt = sa[offset / 2 + 1];\n        offset += 4;\n\n        if (isLeaf != 0) {\n            for (var i = 0; i < cnt; ++i) {\n                var lo = offset / 4;\n                var startChrom = la[lo];\n                var startBase = la[lo + 1];\n                var endChrom = la[lo + 2];\n                var endBase = la[lo + 3];\n                var blockOffset = bwg_readOffset(ba, offset + 16);\n                var blockSize = bwg_readOffset(ba, offset + 24);\n                if ((chr < 0 || startChrom < chr || startChrom == chr && startBase <= max) && (chr < 0 || endChrom > chr || endChrom == chr && endBase >= min)) {\n                    blocksToFetch.push({ offset: blockOffset, size: blockSize });\n                }\n                offset += 32;\n            }\n        } else {\n            var recurOffsets = [];\n            for (var i = 0; i < cnt; ++i) {\n                var lo = offset / 4;\n                var startChrom = la[lo];\n                var startBase = la[lo + 1];\n                var endChrom = la[lo + 2];\n                var endBase = la[lo + 3];\n                var blockOffset = bwg_readOffset(ba, offset + 16);\n                if ((chr < 0 || startChrom < chr || startChrom == chr && startBase <= max) && (chr < 0 || endChrom > chr || endChrom == chr && endBase >= min)) {\n                    recurOffsets.push(blockOffset);\n                }\n                offset += 24;\n            }\n            if (recurOffsets.length > 0) {\n                cirFobRecur(recurOffsets, level + 1);\n            }\n        }\n    };\n\n    cirFobRecur([thisB.cirTreeOffset + 48], 1);\n};\n\nBigWigView.prototype.fetchFeatures = function (filter, blocksToFetch, callback) {\n    var thisB = this;\n\n    blocksToFetch.sort(function (b0, b1) {\n        return (b0.offset | 0) - (b1.offset | 0);\n    });\n\n    if (blocksToFetch.length == 0) {\n        callback([]);\n    } else {\n        var features = [];\n        var createFeature = function createFeature(chr, fmin, fmax, opts) {\n            if (!opts) {\n                opts = {};\n            }\n\n            var f = new DASFeature();\n            f._chromId = chr;\n            f.segment = thisB.bwg.idsToChroms[chr];\n            f.min = fmin;\n            f.max = fmax;\n            f.type = thisB.bwg.type;\n\n            for (var k in opts) {\n                f[k] = opts[k];\n            }\n\n            features.push(f);\n        };\n\n        var tramp = function tramp() {\n            if (blocksToFetch.length == 0) {\n                var afterBWG = Date.now();\n                // dlog('BWG fetch took ' + (afterBWG - beforeBWG) + 'ms');\n                callback(features);\n                return; // just in case...\n            } else {\n                var block = blocksToFetch[0];\n                if (block.data) {\n                    thisB.parseFeatures(block.data, createFeature, filter);\n                    blocksToFetch.splice(0, 1);\n                    tramp();\n                } else {\n                    var fetchStart = block.offset;\n                    var fetchSize = block.size;\n                    var bi = 1;\n                    while (bi < blocksToFetch.length && blocksToFetch[bi].offset == fetchStart + fetchSize) {\n                        fetchSize += blocksToFetch[bi].size;\n                        ++bi;\n                    }\n\n                    thisB.bwg.data.slice(fetchStart, fetchSize).fetch(function (result) {\n                        var offset = 0;\n                        var bi = 0;\n                        while (offset < fetchSize) {\n                            var fb = blocksToFetch[bi];\n\n                            var data;\n                            if (thisB.bwg.uncompressBufSize > 0) {\n                                data = jszlib_inflate_buffer(result, offset + 2, fb.size - 2);\n                            } else {\n                                var tmp = new Uint8Array(fb.size); // FIXME is this really the best we can do?\n                                arrayCopy(new Uint8Array(result, offset, fb.size), 0, tmp, 0, fb.size);\n                                data = tmp.buffer;\n                            }\n                            fb.data = data;\n\n                            offset += fb.size;\n                            ++bi;\n                        }\n                        tramp();\n                    });\n                }\n            }\n        };\n        tramp();\n    }\n};\n\nBigWigView.prototype.parseFeatures = function (data, createFeature, filter) {\n    var ba = new Uint8Array(data);\n\n    if (this.isSummary) {\n        var sa = new Int16Array(data);\n        var la = new Int32Array(data);\n        var fa = new Float32Array(data);\n\n        var itemCount = data.byteLength / 32;\n        for (var i = 0; i < itemCount; ++i) {\n            var chromId = la[i * 8];\n            var start = la[i * 8 + 1];\n            var end = la[i * 8 + 2];\n            var validCnt = la[i * 8 + 3];\n            var minVal = fa[i * 8 + 4];\n            var maxVal = fa[i * 8 + 5];\n            var sumData = fa[i * 8 + 6];\n            var sumSqData = fa[i * 8 + 7];\n\n            if (filter(chromId, start + 1, end)) {\n                var summaryOpts = { type: 'bigwig', score: sumData / validCnt, maxScore: maxVal };\n                if (this.bwg.type == 'bigbed') {\n                    summaryOpts.type = 'density';\n                }\n                createFeature(chromId, start + 1, end, summaryOpts);\n            }\n        }\n    } else if (this.bwg.type == 'bigwig') {\n        var sa = new Int16Array(data);\n        var la = new Int32Array(data);\n        var fa = new Float32Array(data);\n\n        var chromId = la[0];\n        var blockStart = la[1];\n        var blockEnd = la[2];\n        var itemStep = la[3];\n        var itemSpan = la[4];\n        var blockType = ba[20];\n        var itemCount = sa[11];\n\n        if (blockType == BIG_WIG_TYPE_FSTEP) {\n            for (var i = 0; i < itemCount; ++i) {\n                var score = fa[i + 6];\n                var fmin = blockStart + i * itemStep + 1,\n                    fmax = blockStart + i * itemStep + itemSpan;\n                if (filter(chromId, fmin, fmax)) createFeature(chromId, fmin, fmax, { score: score });\n            }\n        } else if (blockType == BIG_WIG_TYPE_VSTEP) {\n            for (var i = 0; i < itemCount; ++i) {\n                var start = la[i * 2 + 6] + 1;\n                var end = start + itemSpan - 1;\n                var score = fa[i * 2 + 7];\n                if (filter(chromId, start, end)) createFeature(chromId, start, end, { score: score });\n            }\n        } else if (blockType == BIG_WIG_TYPE_GRAPH) {\n            for (var i = 0; i < itemCount; ++i) {\n                var start = la[i * 3 + 6] + 1;\n                var end = la[i * 3 + 7];\n                var score = fa[i * 3 + 8];\n                if (start > end) {\n                    start = end;\n                }\n                if (filter(chromId, start, end)) createFeature(chromId, start, end, { score: score });\n            }\n        } else {\n            console.log('Currently not handling bwgType=' + blockType);\n        }\n    } else if (this.bwg.type == 'bigbed') {\n        var offset = 0;\n        var dfc = this.bwg.definedFieldCount;\n        var schema = this.bwg.schema;\n\n        while (offset < ba.length) {\n            var chromId = ba[offset + 3] << 24 | ba[offset + 2] << 16 | ba[offset + 1] << 8 | ba[offset + 0];\n            var start = ba[offset + 7] << 24 | ba[offset + 6] << 16 | ba[offset + 5] << 8 | ba[offset + 4];\n            var end = ba[offset + 11] << 24 | ba[offset + 10] << 16 | ba[offset + 9] << 8 | ba[offset + 8];\n            offset += 12;\n            var rest = '';\n            while (true) {\n                var ch = ba[offset++];\n                if (ch != 0) {\n                    rest += String.fromCharCode(ch);\n                } else {\n                    break;\n                }\n            }\n\n            var featureOpts = {};\n\n            var bedColumns;\n            if (rest.length > 0) {\n                bedColumns = rest.split('\\t');\n            } else {\n                bedColumns = [];\n            }\n            if (bedColumns.length > 0 && dfc > 3) {\n                featureOpts.label = bedColumns[0];\n            }\n            if (bedColumns.length > 1 && dfc > 4) {\n                var score = parseInt(bedColumns[1]);\n                if (!isNaN(score)) featureOpts.score = score;\n            }\n            if (bedColumns.length > 2 && dfc > 5) {\n                featureOpts.orientation = bedColumns[2];\n            }\n            if (bedColumns.length > 5 && dfc > 8) {\n                var color = bedColumns[5];\n                if (BED_COLOR_REGEXP.test(color)) {\n                    featureOpts.itemRgb = 'rgb(' + color + ')';\n                }\n            }\n\n            if (bedColumns.length > dfc - 3 && schema) {\n                for (var col = dfc - 3; col < bedColumns.length; ++col) {\n                    featureOpts[schema.fields[col + 3].name] = bedColumns[col];\n                }\n            }\n\n            if (filter(chromId, start + 1, end, bedColumns)) {\n                if (dfc < 12) {\n                    createFeature(chromId, start + 1, end, featureOpts);\n                } else {\n                    var thickStart = bedColumns[3] | 0;\n                    var thickEnd = bedColumns[4] | 0;\n                    var blockCount = bedColumns[6] | 0;\n                    var blockSizes = bedColumns[7].split(',');\n                    var blockStarts = bedColumns[8].split(',');\n\n                    if (featureOpts.exonFrames) {\n                        var exonFrames = featureOpts.exonFrames.split(',');\n                        featureOpts.exonFrames = undefined;\n                    }\n\n                    featureOpts.type = 'transcript';\n                    var grp = new DASGroup();\n                    for (var k in featureOpts) {\n                        grp[k] = featureOpts[k];\n                    }\n                    grp.id = bedColumns[0];\n                    grp.segment = this.bwg.idsToChroms[chromId];\n                    grp.min = start + 1;\n                    grp.max = end;\n                    grp.notes = [];\n                    featureOpts.groups = [grp];\n\n                    // Moving towards using bigGenePred model, but will\n                    // still support old Dalliance-style BED12+gene-name for the\n                    // foreseeable future.\n                    if (bedColumns.length > 9) {\n                        var geneId = featureOpts.geneName || bedColumns[9];\n                        var geneName = geneId;\n                        if (bedColumns.length > 10) {\n                            geneName = bedColumns[10];\n                        }\n                        if (featureOpts.geneName2) geneName = featureOpts.geneName2;\n\n                        var gg = shallowCopy(grp);\n                        gg.id = geneId;\n                        gg.label = geneName;\n                        gg.type = 'gene';\n                        featureOpts.groups.push(gg);\n                    }\n\n                    var spanList = [];\n                    for (var b = 0; b < blockCount; ++b) {\n                        var bmin = (blockStarts[b] | 0) + start;\n                        var bmax = bmin + (blockSizes[b] | 0);\n                        var span = new Range(bmin, bmax);\n                        spanList.push(span);\n                    }\n                    var spans = union(spanList);\n\n                    var tsList = spans.ranges();\n                    for (var s = 0; s < tsList.length; ++s) {\n                        var ts = tsList[s];\n                        createFeature(chromId, ts.min() + 1, ts.max(), featureOpts);\n                    }\n\n                    if (thickEnd > thickStart) {\n                        var codingRegion = featureOpts.orientation == '+' ? new Range(thickStart, thickEnd + 3) : new Range(thickStart - 3, thickEnd);\n                        // +/- 3 to account for stop codon\n\n                        var tl = intersection(spans, codingRegion);\n                        if (tl) {\n                            featureOpts.type = 'translation';\n                            var tlList = tl.ranges();\n                            var readingFrame = 0;\n\n                            var tlOffset = 0;\n                            while (tlList[0].min() > tsList[tlOffset].max()) {\n                                tlOffset++;\n                            }for (var s = 0; s < tlList.length; ++s) {\n                                // Record reading frame for every exon\n                                var index = s;\n                                if (featureOpts.orientation == '-') index = tlList.length - s - 1;\n                                var ts = tlList[index];\n                                featureOpts.readframe = readingFrame;\n                                if (exonFrames) {\n                                    var brf = parseInt(exonFrames[index + tlOffset]);\n                                    if (typeof brf === 'number' && brf >= 0 && brf <= 2) {\n                                        featureOpts.readframe = brf;\n                                        featureOpts.readframeExplicit = true;\n                                    }\n                                }\n                                var length = ts.max() - ts.min();\n                                readingFrame = (readingFrame + length) % 3;\n                                createFeature(chromId, ts.min() + 1, ts.max(), featureOpts);\n                            }\n                        }\n                    }\n                }\n            }\n        }\n    } else {\n        throw Error(\"Don't know what to do with \" + this.bwg.type);\n    }\n};\n\n//\n// nasty cut/paste, should roll back in!\n//\n\nBigWigView.prototype.getFirstAdjacent = function (chrName, pos, dir, callback) {\n    var chr = this.bwg.chromsToIDs[chrName];\n    if (chr === undefined) {\n        // Not an error because some .bwgs won't have data for all chromosomes.\n        return callback([]);\n    } else {\n        this.getFirstAdjacentById(chr, pos, dir, callback);\n    }\n};\n\nBigWigView.prototype.getFirstAdjacentById = function (chr, pos, dir, callback) {\n    var thisB = this;\n    if (!this.cirHeader) {\n        this.bwg.data.slice(this.cirTreeOffset, 48).fetch(function (result) {\n            thisB.cirHeader = result;\n            var la = new Int32Array(thisB.cirHeader);\n            thisB.cirBlockSize = la[1];\n            thisB.getFirstAdjacentById(chr, pos, dir, callback);\n        });\n        return;\n    }\n\n    var blockToFetch = null;\n    var bestBlockChr = -1;\n    var bestBlockOffset = -1;\n\n    var outstanding = 0;\n\n    var beforeBWG = Date.now();\n\n    var cirFobRecur = function cirFobRecur(offset, level) {\n        outstanding += offset.length;\n\n        var maxCirBlockSpan = 4 + thisB.cirBlockSize * 32; // Upper bound on size, based on a completely full leaf node.\n        var spans;\n        for (var i = 0; i < offset.length; ++i) {\n            var blockSpan = new Range(offset[i], offset[i] + maxCirBlockSpan);\n            spans = spans ? union(spans, blockSpan) : blockSpan;\n        }\n\n        var fetchRanges = spans.ranges();\n        for (var r = 0; r < fetchRanges.length; ++r) {\n            var fr = fetchRanges[r];\n            cirFobStartFetch(offset, fr, level);\n        }\n    };\n\n    var cirFobStartFetch = function cirFobStartFetch(offset, fr, level, attempts) {\n        var length = fr.max() - fr.min();\n        thisB.bwg.data.slice(fr.min(), fr.max() - fr.min()).fetch(function (resultBuffer) {\n            for (var i = 0; i < offset.length; ++i) {\n                if (fr.contains(offset[i])) {\n                    cirFobRecur2(resultBuffer, offset[i] - fr.min(), level);\n                    --outstanding;\n                    if (outstanding == 0) {\n                        if (!blockToFetch) {\n                            if (dir > 0 && (chr != 0 || pos > 0)) {\n                                return thisB.getFirstAdjacentById(0, 0, dir, callback);\n                            } else if (dir < 0 && (chr != thisB.bwg.maxID || pos < 1000000000)) {\n                                return thisB.getFirstAdjacentById(thisB.bwg.maxID, 1000000000, dir, callback);\n                            }\n                            return callback([]);\n                        }\n\n                        thisB.fetchFeatures(function (chrx, fmin, fmax, toks) {\n                            return dir < 0 && (chrx < chr || fmax < pos) || dir > 0 && (chrx > chr || fmin > pos);\n                        }, [blockToFetch], function (features) {\n                            var bestFeature = null;\n                            var bestChr = -1;\n                            var bestPos = -1;\n                            for (var fi = 0; fi < features.length; ++fi) {\n                                var f = features[fi];\n                                var chrx = f._chromId,\n                                    fmin = f.min,\n                                    fmax = f.max;\n                                if (bestFeature == null || dir < 0 && (chrx > bestChr || fmax > bestPos) || dir > 0 && (chrx < bestChr || fmin < bestPos)) {\n                                    bestFeature = f;\n                                    bestPos = dir < 0 ? fmax : fmin;\n                                    bestChr = chrx;\n                                }\n                            }\n\n                            if (bestFeature != null) return callback([bestFeature]);else return callback([]);\n                        });\n                    }\n                }\n            }\n        });\n    };\n\n    var cirFobRecur2 = function cirFobRecur2(cirBlockData, offset, level) {\n        var ba = new Uint8Array(cirBlockData);\n        var sa = new Int16Array(cirBlockData);\n        var la = new Int32Array(cirBlockData);\n\n        var isLeaf = ba[offset];\n        var cnt = sa[offset / 2 + 1];\n        offset += 4;\n\n        if (isLeaf != 0) {\n            for (var i = 0; i < cnt; ++i) {\n                var lo = offset / 4;\n                var startChrom = la[lo];\n                var startBase = la[lo + 1];\n                var endChrom = la[lo + 2];\n                var endBase = la[lo + 3];\n                var blockOffset = bwg_readOffset(ba, offset + 16);\n                var blockSize = bwg_readOffset(ba, offset + 24);\n                if (dir < 0 && (startChrom < chr || startChrom == chr && startBase <= pos) || dir > 0 && (endChrom > chr || endChrom == chr && endBase >= pos)) {\n                    // console.log('Got an interesting block: startBase=' + startChrom + ':' + startBase + '; endBase=' + endChrom + ':' + endBase + '; offset=' + blockOffset + '; size=' + blockSize);\n                    if (/_random/.exec(thisB.bwg.idsToChroms[startChrom])) {\n                        // dlog('skipping random: ' + thisB.bwg.idsToChroms[startChrom]);\n                    } else if (blockToFetch == null || dir < 0 && (endChrom > bestBlockChr || endChrom == bestBlockChr && endBase > bestBlockOffset) || dir > 0 && (startChrom < bestBlockChr || startChrom == bestBlockChr && startBase < bestBlockOffset)) {\n                        //                        dlog('best is: startBase=' + startChrom + ':' + startBase + '; endBase=' + endChrom + ':' + endBase + '; offset=' + blockOffset + '; size=' + blockSize);\n                        blockToFetch = { offset: blockOffset, size: blockSize };\n                        bestBlockOffset = dir < 0 ? endBase : startBase;\n                        bestBlockChr = dir < 0 ? endChrom : startChrom;\n                    }\n                }\n                offset += 32;\n            }\n        } else {\n            var bestRecur = -1;\n            var bestPos = -1;\n            var bestChr = -1;\n            for (var i = 0; i < cnt; ++i) {\n                var lo = offset / 4;\n                var startChrom = la[lo];\n                var startBase = la[lo + 1];\n                var endChrom = la[lo + 2];\n                var endBase = la[lo + 3];\n                var blockOffset = la[lo + 4] << 32 | la[lo + 5];\n                if (dir < 0 && (startChrom < chr || startChrom == chr && startBase <= pos) && endChrom >= chr || dir > 0 && (endChrom > chr || endChrom == chr && endBase >= pos) && startChrom <= chr) {\n                    if (bestRecur < 0 || endBase > bestPos) {\n                        bestRecur = blockOffset;\n                        bestPos = dir < 0 ? endBase : startBase;\n                        bestChr = dir < 0 ? endChrom : startChrom;\n                    }\n                }\n                offset += 24;\n            }\n            if (bestRecur >= 0) {\n                cirFobRecur([bestRecur], level + 1);\n            }\n        }\n    };\n\n    cirFobRecur([thisB.cirTreeOffset + 48], 1);\n};\n\nBigWig.prototype.readWigData = function (chrName, min, max, callback) {\n    this.getUnzoomedView().readWigData(chrName, min, max, callback);\n};\n\nBigWig.prototype.getUnzoomedView = function () {\n    if (!this.unzoomedView) {\n        var cirLen = 4000;\n        var nzl = this.zoomLevels[0];\n        if (nzl) {\n            cirLen = this.zoomLevels[0].dataOffset - this.unzoomedIndexOffset;\n        }\n        this.unzoomedView = new BigWigView(this, this.unzoomedIndexOffset, cirLen, false);\n    }\n    return this.unzoomedView;\n};\n\nBigWig.prototype.getZoomedView = function (z) {\n    var zh = this.zoomLevels[z];\n    if (!zh.view) {\n        zh.view = new BigWigView(this, zh.indexOffset, /* this.zoomLevels[z + 1].dataOffset - zh.indexOffset */4000, true);\n    }\n    return zh.view;\n};\n\nfunction makeBwg(data, callback, name) {\n    var bwg = new BigWig();\n    bwg.data = data;\n    bwg.name = name;\n    bwg.data.slice(0, 512).salted().fetch(function (result) {\n        if (!result) {\n            return callback(null, \"Couldn't fetch file\");\n        }\n\n        var header = result;\n        var ba = new Uint8Array(header);\n        var sa = new Int16Array(header);\n        var la = new Int32Array(header);\n        var magic = ba[0] + M1 * ba[1] + M2 * ba[2] + M3 * ba[3];\n        if (magic == BIG_WIG_MAGIC) {\n            bwg.type = 'bigwig';\n        } else if (magic == BIG_BED_MAGIC) {\n            bwg.type = 'bigbed';\n        } else if (magic == BIG_WIG_MAGIC_BE || magic == BIG_BED_MAGIC_BE) {\n            return callback(null, \"Currently don't support big-endian BBI files\");\n        } else {\n            return callback(null, \"Not a supported format, magic=0x\" + magic.toString(16));\n        }\n\n        bwg.version = sa[2]; // 4\n        bwg.numZoomLevels = sa[3]; // 6\n        bwg.chromTreeOffset = bwg_readOffset(ba, 8);\n        bwg.unzoomedDataOffset = bwg_readOffset(ba, 16);\n        bwg.unzoomedIndexOffset = bwg_readOffset(ba, 24);\n        bwg.fieldCount = sa[16]; // 32\n        bwg.definedFieldCount = sa[17]; // 34\n        bwg.asOffset = bwg_readOffset(ba, 36);\n        bwg.totalSummaryOffset = bwg_readOffset(ba, 44);\n        bwg.uncompressBufSize = la[13]; // 52\n        bwg.extHeaderOffset = bwg_readOffset(ba, 56);\n\n        bwg.zoomLevels = [];\n        for (var zl = 0; zl < bwg.numZoomLevels; ++zl) {\n            var zlReduction = la[zl * 6 + 16];\n            var zlData = bwg_readOffset(ba, zl * 24 + 72);\n            var zlIndex = bwg_readOffset(ba, zl * 24 + 80);\n            bwg.zoomLevels.push({ reduction: zlReduction, dataOffset: zlData, indexOffset: zlIndex });\n        }\n\n        bwg.readChromTree(function () {\n            bwg.getAutoSQL(function (as) {\n                bwg.schema = as;\n                return callback(bwg);\n            });\n        });\n    }, { timeout: 5000 }); // Potential timeout on first request to catch mixed-content errors on\n    // Chromium.\n}\n\nBigWig.prototype._tsFetch = function (zoom, chr, min, max, callback) {\n    var bwg = this;\n    if (zoom >= this.zoomLevels.length - 1) {\n        if (!this.topLevelReductionCache) {\n            this.getZoomedView(this.zoomLevels.length - 1).readWigDataById(-1, 0, 300000000, function (feats) {\n                bwg.topLevelReductionCache = feats;\n                return bwg._tsFetch(zoom, chr, min, max, callback);\n            });\n        } else {\n            var f = [];\n            var c = this.topLevelReductionCache;\n            for (var fi = 0; fi < c.length; ++fi) {\n                if (c[fi]._chromId == chr) {\n                    f.push(c[fi]);\n                }\n            }\n            return callback(f);\n        }\n    } else {\n        var view;\n        if (zoom < 0) {\n            view = this.getUnzoomedView();\n        } else {\n            view = this.getZoomedView(zoom);\n        }\n        return view.readWigDataById(chr, min, max, callback);\n    }\n};\n\nBigWig.prototype.thresholdSearch = function (chrName, referencePoint, dir, threshold, callback) {\n    dir = dir < 0 ? -1 : 1;\n    var bwg = this;\n    var initialChr = this.chromsToIDs[chrName];\n    var candidates = [{ chrOrd: 0, chr: initialChr, zoom: bwg.zoomLevels.length - 4, min: 0, max: 300000000, fromRef: true }];\n    for (var i = 1; i <= this.maxID + 1; ++i) {\n        var chrId = (initialChr + dir * i) % (this.maxID + 1);\n        if (chrId < 0) chrId += this.maxID + 1;\n        candidates.push({ chrOrd: i, chr: chrId, zoom: bwg.zoomLevels.length - 1, min: 0, max: 300000000 });\n    }\n\n    function fbThresholdSearchRecur() {\n        if (candidates.length == 0) {\n            return callback(null);\n        }\n        candidates.sort(function (c1, c2) {\n            var d = c1.zoom - c2.zoom;\n            if (d != 0) return d;\n\n            d = c1.chrOrd - c2.chrOrd;\n            if (d != 0) return d;else return c1.min - c2.min * dir;\n        });\n\n        var candidate = candidates.splice(0, 1)[0];\n        bwg._tsFetch(candidate.zoom, candidate.chr, candidate.min, candidate.max, function (feats) {\n            var rp = dir > 0 ? 0 : 300000000;\n            if (candidate.fromRef) rp = referencePoint;\n\n            for (var fi = 0; fi < feats.length; ++fi) {\n                var f = feats[fi];\n                var score;\n                if (f.maxScore != undefined) score = f.maxScore;else score = f.score;\n\n                if (dir > 0) {\n                    if (score > threshold) {\n                        if (candidate.zoom < 0) {\n                            if (f.min > rp) return callback(f);\n                        } else if (f.max > rp) {\n                            candidates.push({ chr: candidate.chr, chrOrd: candidate.chrOrd, zoom: candidate.zoom - 2, min: f.min, max: f.max, fromRef: candidate.fromRef });\n                        }\n                    }\n                } else {\n                    if (score > threshold) {\n                        if (candidate.zoom < 0) {\n                            if (f.max < rp) return callback(f);\n                        } else if (f.min < rp) {\n                            candidates.push({ chr: candidate.chr, chrOrd: candidate.chrOrd, zoom: candidate.zoom - 2, min: f.min, max: f.max, fromRef: candidate.fromRef });\n                        }\n                    }\n                }\n            }\n            fbThresholdSearchRecur();\n        });\n    }\n\n    fbThresholdSearchRecur();\n};\n\nBigWig.prototype.getAutoSQL = function (callback) {\n    var thisB = this;\n    if (!this.asOffset) return callback(null);\n\n    this.data.slice(this.asOffset, 2048).fetch(function (result) {\n        var ba = new Uint8Array(result);\n        var s = '';\n        for (var i = 0; i < ba.length; ++i) {\n            if (ba[i] == 0) break;\n            s += String.fromCharCode(ba[i]);\n        }\n\n        /* \n         * Quick'n'dirty attempt to parse autoSql format.\n         * See: http://www.linuxjournal.com/files/linuxjournal.com/linuxjournal/articles/059/5949/5949l2.html\n         */\n\n        var header_re = /(\\w+)\\s+(\\w+)\\s+(\"([^\"]+)\")?\\s+\\(\\s*/;\n        var field_re = /([\\w\\[\\]]+)\\s+(\\w+)\\s*;\\s*(\"([^\"]+)\")?\\s*/g;\n\n        var headerMatch = header_re.exec(s);\n        if (headerMatch) {\n            var as = {\n                declType: headerMatch[1],\n                name: headerMatch[2],\n                comment: headerMatch[4],\n\n                fields: []\n            };\n\n            s = s.substring(headerMatch[0]);\n            for (var m = field_re.exec(s); m != null; m = field_re.exec(s)) {\n                as.fields.push({ type: m[1],\n                    name: m[2],\n                    comment: m[4] });\n            }\n\n            return callback(as);\n        }\n    });\n};\n\nBigWig.prototype.getExtraIndices = function (callback) {\n    var thisB = this;\n    if (this.version < 4 || this.extHeaderOffset == 0 || this.type != 'bigbed') {\n        return callback(null);\n    } else {\n        this.data.slice(this.extHeaderOffset, 64).fetch(function (result) {\n            if (!result) {\n                return callback(null, \"Couldn't fetch extension header\");\n            }\n\n            var ba = new Uint8Array(result);\n            var sa = new Int16Array(result);\n            var la = new Int32Array(result);\n\n            var extHeaderSize = sa[0];\n            var extraIndexCount = sa[1];\n            var extraIndexListOffset = bwg_readOffset(ba, 4);\n\n            if (extraIndexCount == 0) {\n                return callback(null);\n            }\n\n            // FIXME 20byte records only make sense for single-field indices.\n            // Right now, these seem to be the only things around, but the format\n            // is actually more general.\n            thisB.data.slice(extraIndexListOffset, extraIndexCount * 20).fetch(function (eil) {\n                if (!eil) {\n                    return callback(null, \"Couldn't fetch index info\");\n                }\n\n                var ba = new Uint8Array(eil);\n                var sa = new Int16Array(eil);\n                var la = new Int32Array(eil);\n\n                var indices = [];\n                for (var ii = 0; ii < extraIndexCount; ++ii) {\n                    var eiType = sa[ii * 10];\n                    var eiFieldCount = sa[ii * 10 + 1];\n                    var eiOffset = bwg_readOffset(ba, ii * 20 + 4);\n                    var eiField = sa[ii * 10 + 8];\n                    var index = new BBIExtraIndex(thisB, eiType, eiFieldCount, eiOffset, eiField);\n                    indices.push(index);\n                }\n                callback(indices);\n            });\n        });\n    }\n};\n\nfunction BBIExtraIndex(bbi, type, fieldCount, offset, field) {\n    this.bbi = bbi;\n    this.type = type;\n    this.fieldCount = fieldCount;\n    this.offset = offset;\n    this.field = field;\n}\n\nBBIExtraIndex.prototype.lookup = function (name, callback) {\n    var thisB = this;\n\n    this.bbi.data.slice(this.offset, 32).fetch(function (bpt) {\n        var ba = new Uint8Array(bpt);\n        var sa = new Int16Array(bpt);\n        var la = new Int32Array(bpt);\n        var bptMagic = la[0];\n        var blockSize = la[1];\n        var keySize = la[2];\n        var valSize = la[3];\n        var itemCount = bwg_readOffset(ba, 16);\n        var rootNodeOffset = 32;\n\n        function bptReadNode(nodeOffset) {\n            thisB.bbi.data.slice(nodeOffset, 4 + blockSize * (keySize + valSize)).fetch(function (node) {\n                var ba = new Uint8Array(node);\n                var sa = new Uint16Array(node);\n                var la = new Uint32Array(node);\n\n                var nodeType = ba[0];\n                var cnt = sa[1];\n\n                var offset = 4;\n                if (nodeType == 0) {\n                    var lastChildOffset = null;\n                    for (var n = 0; n < cnt; ++n) {\n                        var key = '';\n                        for (var ki = 0; ki < keySize; ++ki) {\n                            var charCode = ba[offset++];\n                            if (charCode != 0) {\n                                key += String.fromCharCode(charCode);\n                            }\n                        }\n\n                        var childOffset = bwg_readOffset(ba, offset);\n                        offset += 8;\n\n                        if (name.localeCompare(key) < 0 && lastChildOffset) {\n                            bptReadNode(lastChildOffset);\n                            return;\n                        }\n                        lastChildOffset = childOffset;\n                    }\n                    bptReadNode(lastChildOffset);\n                } else {\n                    for (var n = 0; n < cnt; ++n) {\n                        var key = '';\n                        for (var ki = 0; ki < keySize; ++ki) {\n                            var charCode = ba[offset++];\n                            if (charCode != 0) {\n                                key += String.fromCharCode(charCode);\n                            }\n                        }\n\n                        // Specific for EI case.\n                        if (key == name) {\n                            var start = bwg_readOffset(ba, offset);\n                            var length = readInt(ba, offset + 8);\n\n                            return thisB.bbi.getUnzoomedView().fetchFeatures(function (chr, min, max, toks) {\n                                if (toks && toks.length > thisB.field - 3) return toks[thisB.field - 3] == name;\n                            }, [{ offset: start, size: length }], callback);\n                        }\n                        offset += valSize;\n                    }\n                    return callback([]);\n                }\n            });\n        }\n\n        bptReadNode(thisB.offset + rootNodeOffset);\n    });\n};\n\nif (typeof module !== 'undefined') {\n    module.exports = {\n        makeBwg: makeBwg,\n        BIG_BED_MAGIC: BIG_BED_MAGIC,\n        BIG_WIG_MAGIC: BIG_WIG_MAGIC\n    };\n}\n\n},{\"./bin\":4,\"./das\":11,\"./spans\":41,\"./utils\":56,\"jszlib\":71}],4:[function(require,module,exports){\n/* -*- mode: javascript; c-basic-offset: 4; indent-tabs-mode: nil -*- */\n\n// \n// Dalliance Genome Explorer\n// (c) Thomas Down 2006-2011\n//\n// bin.js general binary data support\n//\n\n\"use strict\";\n\nvar _typeof = typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; };\n\nif (typeof require !== 'undefined') {\n    var utils = require('./utils');\n    var shallowCopy = utils.shallowCopy;\n\n    var sha1 = require('./sha1');\n    var b64_sha1 = sha1.b64_sha1;\n\n    var Promise = require('es6-promise').Promise;\n}\n\nfunction BlobFetchable(b) {\n    this.blob = b;\n}\n\nBlobFetchable.prototype.slice = function (start, length) {\n    var b;\n\n    if (this.blob.slice) {\n        if (length) {\n            b = this.blob.slice(start, start + length);\n        } else {\n            b = this.blob.slice(start);\n        }\n    } else {\n        if (length) {\n            b = this.blob.webkitSlice(start, start + length);\n        } else {\n            b = this.blob.webkitSlice(start);\n        }\n    }\n    return new BlobFetchable(b);\n};\n\nBlobFetchable.prototype.salted = function () {\n    return this;\n};\n\nif (typeof FileReader !== 'undefined') {\n    // console.log('defining async BlobFetchable.fetch');\n\n    BlobFetchable.prototype.fetch = function (callback) {\n        var reader = new FileReader();\n        reader.onloadend = function (ev) {\n            callback(bstringToBuffer(reader.result));\n        };\n        reader.readAsBinaryString(this.blob);\n    };\n} else {\n    // if (console && console.log)\n    //    console.log('defining sync BlobFetchable.fetch');\n\n    BlobFetchable.prototype.fetch = function (callback) {\n        var reader = new FileReaderSync();\n        try {\n            var res = reader.readAsArrayBuffer(this.blob);\n            callback(res);\n        } catch (e) {\n            callback(null, e);\n        }\n    };\n}\n\nfunction URLFetchable(url, start, end, opts) {\n    if (!opts) {\n        if ((typeof start === 'undefined' ? 'undefined' : _typeof(start)) === 'object') {\n            opts = start;\n            start = undefined;\n        } else {\n            opts = {};\n        }\n    }\n\n    this.url = url;\n    this.start = start || 0;\n    if (end) {\n        this.end = end;\n    }\n    this.opts = opts;\n}\n\nURLFetchable.prototype.slice = function (s, l) {\n    if (s < 0) {\n        throw 'Bad slice ' + s;\n    }\n\n    var ns = this.start,\n        ne = this.end;\n    if (ns && s) {\n        ns = ns + s;\n    } else {\n        ns = s || ns;\n    }\n    if (l && ns) {\n        ne = ns + l - 1;\n    } else {\n        ne = ne || l - 1;\n    }\n    return new URLFetchable(this.url, ns, ne, this.opts);\n};\n\nvar seed = 0;\nvar isSafari = typeof navigator !== 'undefined' && navigator.userAgent.indexOf('Safari') >= 0 && navigator.userAgent.indexOf('Chrome') < 0;\n\nURLFetchable.prototype.fetchAsText = function (callback) {\n    var thisB = this;\n\n    this.getURL().then(function (url) {\n        try {\n            var req = new XMLHttpRequest();\n            var length;\n            if ((isSafari || thisB.opts.salt) && url.indexOf('?') < 0) {\n                url = url + '?salt=' + b64_sha1('' + Date.now() + ',' + ++seed);\n            }\n            req.open('GET', url, true);\n\n            if (thisB.end) {\n                if (thisB.end - thisB.start > 100000000) {\n                    throw 'Monster fetch!';\n                }\n                req.setRequestHeader('Range', 'bytes=' + thisB.start + '-' + thisB.end);\n                length = thisB.end - thisB.start + 1;\n            }\n\n            req.onreadystatechange = function () {\n                if (req.readyState == 4) {\n                    if (req.status == 200 || req.status == 206) {\n                        return callback(req.responseText);\n                    } else {\n                        return callback(null);\n                    }\n                }\n            };\n            if (thisB.opts.credentials) {\n                req.withCredentials = true;\n            }\n            req.send();\n        } catch (e) {\n            return callback(null);\n        }\n    }).catch(function (err) {\n        console.log(err);\n        return callback(null, err);\n    });\n};\n\nURLFetchable.prototype.salted = function () {\n    var o = shallowCopy(this.opts);\n    o.salt = true;\n    return new URLFetchable(this.url, this.start, this.end, o);\n};\n\nURLFetchable.prototype.getURL = function () {\n    if (this.opts.resolver) {\n        return this.opts.resolver(this.url).then(function (urlOrObj) {\n            if (typeof urlOrObj === 'string') {\n                return urlOrObj;\n            } else {\n                return urlOrObj.url;\n            }\n        });\n    } else {\n        return Promise.resolve(this.url);\n    }\n};\n\nURLFetchable.prototype.fetch = function (callback, opts) {\n    var thisB = this;\n\n    opts = opts || {};\n    var attempt = opts.attempt || 1;\n    var truncatedLength = opts.truncatedLength;\n    if (attempt > 3) {\n        return callback(null);\n    }\n\n    this.getURL().then(function (url) {\n        try {\n            var timeout;\n            if (opts.timeout && !thisB.opts.credentials) {\n                timeout = setTimeout(function () {\n                    console.log('timing out ' + url);\n                    req.abort();\n                    return callback(null, 'Timeout');\n                }, opts.timeout);\n            }\n\n            var req = new XMLHttpRequest();\n            var length;\n            if ((isSafari || thisB.opts.salt) && url.indexOf('?') < 0) {\n                url = url + '?salt=' + b64_sha1('' + Date.now() + ',' + ++seed);\n            }\n            req.open('GET', url, true);\n            req.overrideMimeType('text/plain; charset=x-user-defined');\n            if (thisB.end) {\n                if (thisB.end - thisB.start > 100000000) {\n                    throw 'Monster fetch!';\n                }\n                req.setRequestHeader('Range', 'bytes=' + thisB.start + '-' + thisB.end);\n                length = thisB.end - thisB.start + 1;\n            }\n            req.responseType = 'arraybuffer';\n            req.onreadystatechange = function () {\n                if (req.readyState == 4) {\n                    if (timeout) clearTimeout(timeout);\n                    if (req.status == 200 || req.status == 206) {\n                        if (req.response) {\n                            var bl = req.response.byteLength;\n                            if (length && length != bl && (!truncatedLength || bl != truncatedLength)) {\n                                return thisB.fetch(callback, { attempt: attempt + 1, truncatedLength: bl });\n                            } else {\n                                return callback(req.response);\n                            }\n                        } else if (req.mozResponseArrayBuffer) {\n                            return callback(req.mozResponseArrayBuffer);\n                        } else {\n                            var r = req.responseText;\n                            if (length && length != r.length && (!truncatedLength || r.length != truncatedLength)) {\n                                return thisB.fetch(callback, { attempt: attempt + 1, truncatedLength: r.length });\n                            } else {\n                                return callback(bstringToBuffer(req.responseText));\n                            }\n                        }\n                    } else {\n                        return thisB.fetch(callback, { attempt: attempt + 1 });\n                    }\n                }\n            };\n            if (thisB.opts.credentials) {\n                req.withCredentials = true;\n            }\n            req.send();\n        } catch (e) {\n            return callback(null);\n        }\n    }).catch(function (err) {\n        console.log(err);\n        return callback(null, err);\n    });\n};\n\nfunction bstringToBuffer(result) {\n    if (!result) {\n        return null;\n    }\n\n    var ba = new Uint8Array(result.length);\n    for (var i = 0; i < ba.length; ++i) {\n        ba[i] = result.charCodeAt(i);\n    }\n    return ba.buffer;\n}\n\n// Read from Uint8Array\n\nvar convertBuffer = new ArrayBuffer(8);\nvar ba = new Uint8Array(convertBuffer);\nvar fa = new Float32Array(convertBuffer);\n\nfunction readFloat(buf, offset) {\n    ba[0] = buf[offset];\n    ba[1] = buf[offset + 1];\n    ba[2] = buf[offset + 2];\n    ba[3] = buf[offset + 3];\n    return fa[0];\n}\n\nfunction readInt64(ba, offset) {\n    return ba[offset + 7] << 24 | ba[offset + 6] << 16 | ba[offset + 5] << 8 | ba[offset + 4];\n}\n\nfunction readInt(ba, offset) {\n    return ba[offset + 3] << 24 | ba[offset + 2] << 16 | ba[offset + 1] << 8 | ba[offset];\n}\n\nfunction readShort(ba, offset) {\n    return ba[offset + 1] << 8 | ba[offset];\n}\n\nfunction readByte(ba, offset) {\n    return ba[offset];\n}\n\nfunction readIntBE(ba, offset) {\n    return ba[offset] << 24 | ba[offset + 1] << 16 | ba[offset + 2] << 8 | ba[offset + 3];\n}\n\n// Exports if we are being used as a module\n\nif (typeof module !== 'undefined') {\n    module.exports = {\n        BlobFetchable: BlobFetchable,\n        URLFetchable: URLFetchable,\n\n        readInt: readInt,\n        readIntBE: readIntBE,\n        readInt64: readInt64,\n        readShort: readShort,\n        readByte: readByte,\n        readFloat: readFloat\n    };\n}\n\n},{\"./sha1\":38,\"./utils\":56,\"es6-promise\":60}],5:[function(require,module,exports){\n/* -*- mode: javascript; c-basic-offset: 4; indent-tabs-mode: nil -*- */\n\n//\n// Dalliance Genome Explorer\n// (c) Thomas Down 2006-2013\n//\n// browser-us.js: standard UI wiring\n//\n\n\"use strict\";\n\nif (typeof require !== 'undefined') {\n    var browser = require('./cbrowser');\n    var Browser = browser.Browser;\n\n    var utils = require('./utils');\n    var makeElement = utils.makeElement;\n    var removeChildren = utils.removeChildren;\n\n    var nf = require('./numformats');\n    var formatLongInt = nf.formatLongInt;\n\n    var makeZoomSlider = require('./zoomslider');\n\n    // For side effects\n\n    require('./tier-edit');\n    require('./export-config');\n    require('./export-ui');\n    require('./export-image');\n    require('./svg-export');\n    require('./session');\n}\n\n/*\n * Quite a bit of this ought to be done using a templating system, but\n * since web-components isn't quite ready for prime time yet we'll stick\n * with constructing it all in Javascript for now...\n */\n\nBrowser.prototype.initUI = function (holder, genomePanel) {\n    if (!this.noSourceCSS) {\n        ['bootstrap-scoped.css', 'dalliance-scoped.css', 'font-awesome.min.css'].forEach(function (path) {\n            document.head.appendChild(makeElement('link', '', {\n                rel: 'stylesheet',\n                href: this.resolveURL('$$css/' + path)\n            }));\n        }.bind(this));\n    }\n\n    var b = this;\n\n    if (!b.disableDefaultFeaturePopup) {\n        this.addFeatureListener(function (ev, feature, hit, tier) {\n            b.featurePopup(ev, feature, hit, tier);\n        });\n    }\n\n    holder.classList.add('dalliance');\n    var toolbar = b.toolbar = makeElement('div', null, { className: 'btn-toolbar toolbar' });\n\n    var title = b.coordSystem.speciesName + ' ' + b.nameForCoordSystem(b.coordSystem);\n    if (this.setDocumentTitle) {\n        document.title = title + ' :: dalliance';\n    }\n\n    var locField = makeElement('input', '', { className: 'loc-field' });\n    b.makeTooltip(locField, 'Enter a genomic location or gene name');\n    var locStatusField = makeElement('p', '', { className: 'loc-status' });\n\n    var zoomInBtn = makeElement('a', [makeElement('i', null, { className: 'fa fa-search-plus' })], { className: 'btn' });\n    var zoomSlider = new makeZoomSlider({ width: b.zoomSliderWidth });\n    b.makeTooltip(zoomSlider, \"Highlighted button shows current zoom level, gray button shows inactive zoom level (click or tap SPACE to toggle).\");\n\n    var zoomOutBtn = makeElement('a', [makeElement('i', null, { className: 'fa fa-search-minus' })], { className: 'btn' });\n\n    var clearHighlightsButton = makeElement('a', [makeElement('i', null, { className: 'fa fa-eraser' })], { className: 'btn' });\n\n    var addTrackBtn = makeElement('a', [makeElement('i', null, { className: 'fa fa-plus' })], { className: 'btn' });\n    var favBtn = makeElement('a', [makeElement('i', null, { className: 'fa fa-bookmark' })], { className: 'btn' });\n    var svgBtn = makeElement('a', [makeElement('i', null, { className: 'fa fa-print' })], { className: 'btn' });\n    var resetBtn = makeElement('a', [makeElement('i', null, { className: 'fa fa-refresh' })], { className: 'btn' });\n    var optsButton = makeElement('a', [makeElement('i', null, { className: 'fa fa-cogs' })], { className: 'btn' });\n    var helpButton = makeElement('a', [makeElement('i', null, { className: 'fa fa-question' })], { className: 'btn' });\n\n    var tierEditButton = makeElement('a', [makeElement('i', null, { className: 'fa fa-road' })], { className: 'btn' });\n    b.makeTooltip(tierEditButton, 'Configure currently selected track(s) (E)');\n\n    var leapLeftButton = makeElement('a', [makeElement('i', null, { className: 'fa fa-angle-left' })], { className: 'btn' }, { width: '5px' });\n    var leapRightButton = makeElement('a', [makeElement('i', null, { className: 'fa fa-angle-right' })], { className: 'btn pull-right' }, { width: '5px' });\n\n    var modeButtons = makeElement('div', null, { className: 'btn-group pull-right' });\n    if (!this.noTrackAdder) modeButtons.appendChild(addTrackBtn);\n    if (!this.noTrackEditor) modeButtons.appendChild(tierEditButton);\n    if (!this.noExport) modeButtons.appendChild(svgBtn);\n    if (!this.noOptions) modeButtons.appendChild(optsButton);\n    if (!this.noHelp) modeButtons.appendChild(helpButton);\n\n    this.setUiMode = function (m) {\n        this.uiMode = m;\n        var mb = { help: helpButton, add: addTrackBtn, opts: optsButton, 'export': svgBtn, tier: tierEditButton };\n        for (var x in mb) {\n            if (x == m) mb[x].classList.add('active');else mb[x].classList.remove('active');\n        }\n    };\n\n    if (!this.noLeapButtons) toolbar.appendChild(leapRightButton);\n\n    if (modeButtons.firstChild) toolbar.appendChild(modeButtons);\n\n    if (!this.noLeapButtons) toolbar.appendChild(leapLeftButton);\n    if (!this.noTitle) {\n        toolbar.appendChild(makeElement('div', makeElement('h4', title, {}, { margin: '0px' }), { className: 'btn-group title' }));\n    }\n    if (!this.noLocationField) toolbar.appendChild(makeElement('div', [locField, locStatusField], { className: 'btn-group loc-group' }));\n    if (!this.noClearHighlightsButton) toolbar.appendChild(clearHighlightsButton);\n\n    if (!this.noZoomSlider) {\n        toolbar.appendChild(makeElement('div', [zoomInBtn, makeElement('span', zoomSlider, { className: 'btn' }), zoomOutBtn], { className: 'btn-group' }));\n    }\n\n    if (this.toolbarBelow) {\n        holder.appendChild(genomePanel);\n        holder.appendChild(toolbar);\n    } else {\n        holder.appendChild(toolbar);\n        holder.appendChild(genomePanel);\n    }\n\n    var lt2 = Math.log(2) / Math.log(10);\n    var lt5 = Math.log(5) / Math.log(10);\n    var roundSliderValue = function roundSliderValue(x) {\n        var ltx = (x / b.zoomExpt + Math.log(b.zoomBase)) / Math.log(10);\n\n        var whole = ltx | 0;\n        var frac = ltx - whole;\n        var rounded;\n\n        if (frac < 0.01) rounded = whole;else if (frac <= lt2 + 0.01) rounded = whole + lt2;else if (frac <= lt5 + 0.01) rounded = whole + lt5;else {\n            rounded = whole + 1;\n        }\n\n        return (rounded * Math.log(10) - Math.log(b.zoomBase)) * b.zoomExpt;\n    };\n\n    var markSlider = function markSlider(x) {\n        zoomSlider.addLabel(x, humanReadableScale(Math.exp(x / b.zoomExpt) * b.zoomBase));\n    };\n\n    this.addViewListener(function (chr, min, max, _oldZoom, zoom) {\n        locField.value = chr + ':' + formatLongInt(min) + '..' + formatLongInt(max);\n        zoomSlider.min = zoom.min | 0;\n        zoomSlider.max = zoom.max | 0;\n        if (zoom.isSnapZooming) {\n            zoomSlider.value = zoom.alternate;\n            zoomSlider.value2 = zoom.current;\n            zoomSlider.active = 2;\n        } else {\n            zoomSlider.value = zoom.current;\n            zoomSlider.value2 = zoom.alternate;\n            zoomSlider.active = 1;\n        }\n\n        if (zoom.current == zoom.min) zoomInBtn.classList.add('disabled');else zoomInBtn.classList.remove('disabled');\n\n        if (zoom.current == zoom.max) zoomOutBtn.classList.add('disabled');else zoomOutBtn.classList.remove('disabled');\n\n        zoomSlider.removeLabels();\n        var zmin = zoom.min;\n        var zmax = zoom.max;\n        var zrange = zmax - zmin;\n\n        var numSliderTicks = 4;\n        if (b.zoomSliderWidth && b.zoomSliderWidth < 150) numSliderTicks = 3;\n        markSlider(roundSliderValue(zmin));\n        for (var sti = 1; sti < numSliderTicks - 1; ++sti) {\n            markSlider(roundSliderValue(zmin + 1.0 * sti * zrange / (numSliderTicks - 1)));\n        }\n        markSlider(roundSliderValue(zmax));\n\n        if (b.storeStatus) {\n            b.storeViewStatus();\n        }\n\n        if (b.highlights.length > 0) {\n            clearHighlightsButton.style.display = 'inline-block';\n        } else {\n            clearHighlightsButton.style.display = 'none';\n        }\n    });\n\n    this.addTierListener(function () {\n        if (b.storeStatus) {\n            b.storeTierStatus();\n        }\n    });\n\n    locField.addEventListener('keydown', function (ev) {\n        if (ev.keyCode == 40) {\n            ev.preventDefault();ev.stopPropagation();\n            b.setSelectedTier(0);\n        }if (ev.keyCode == 10 || ev.keyCode == 13) {\n            ev.preventDefault();\n\n            var g = locField.value;\n            b.search(g, function (err) {\n                if (err) {\n                    locStatusField.textContent = '' + err;\n                } else {\n                    locStatusField.textContent = '';\n                }\n            });\n        }\n    }, false);\n\n    var trackAddPopup;\n    addTrackBtn.addEventListener('click', function (ev) {\n        if (trackAddPopup && trackAddPopup.displayed) {\n            b.removeAllPopups();\n        } else {\n            trackAddPopup = b.showTrackAdder(ev);\n        }\n    }, false);\n    b.makeTooltip(addTrackBtn, 'Add a new track from the registry or an indexed file. (A)');\n\n    zoomInBtn.addEventListener('click', function (ev) {\n        ev.stopPropagation();ev.preventDefault();\n\n        b.zoomStep(-10);\n    }, false);\n    b.makeTooltip(zoomInBtn, 'Zoom in (+)');\n\n    zoomOutBtn.addEventListener('click', function (ev) {\n        ev.stopPropagation();ev.preventDefault();\n\n        b.zoomStep(10);\n    }, false);\n    b.makeTooltip(zoomOutBtn, 'Zoom out (-)');\n\n    zoomSlider.addEventListener('change', function (ev) {\n        var wantSnap = zoomSlider.active == 2;\n        if (wantSnap != b.isSnapZooming) {\n            b.savedZoom = b.zoomSliderValue - b.zoomMin;\n            b.isSnapZooming = wantSnap;\n        }\n        var activeZSV = zoomSlider.active == 1 ? zoomSlider.value : zoomSlider.value2;\n\n        b.zoomSliderValue = 1.0 * activeZSV;\n        b.zoom(Math.exp(1.0 * activeZSV / b.zoomExpt));\n    }, false);\n\n    favBtn.addEventListener('click', function (ev) {\n        ev.stopPropagation();ev.preventDefault();\n    }, false);\n    b.makeTooltip(favBtn, 'Favourite regions');\n\n    svgBtn.addEventListener('click', function (ev) {\n        ev.stopPropagation();ev.preventDefault();\n        b.openExportPanel();\n    }, false);\n    b.makeTooltip(svgBtn, 'Export publication-quality SVG. (X)');\n\n    var optsPopup;\n    optsButton.addEventListener('click', function (ev) {\n        ev.stopPropagation();ev.preventDefault();\n\n        b.toggleOptsPopup(ev);\n    }, false);\n    b.makeTooltip(optsButton, 'Configure options.');\n\n    helpButton.addEventListener('click', function (ev) {\n        ev.stopPropagation();ev.preventDefault();\n        b.toggleHelpPopup(ev);\n    });\n    b.makeTooltip(helpButton, 'Help; Keyboard shortcuts. (H)');\n\n    tierEditButton.addEventListener('click', function (ev) {\n        ev.stopPropagation();ev.preventDefault();\n        if (b.selectedTiers.length == 1) {\n            b.openTierPanel(b.tiers[b.selectedTiers[0]]);\n        }\n    }, false);\n\n    leapLeftButton.addEventListener('click', function (ev) {\n        b.leap(b.reverseKeyScrolling ? -1 : 1, false);\n    }, false);\n    b.makeTooltip(leapLeftButton, function (ev) {\n        var st = b.getSelectedTier();\n        var tier;\n        if (st >= 0) tier = b.tiers[st];\n\n        if (tier && tier.featureSource && b.sourceAdapterIsCapable(tier.featureSource, 'quantLeap') && typeof tier.quantLeapThreshold == 'number') {\n            return 'Jump to the next region with a score above the threshold in the selected track \"' + (tier.config.name || tier.dasSource.name) + '\"\" (ctrl+LEFT)';\n        } else if (tier && tier.featureSource && b.sourceAdapterIsCapable(tier.featureSource, 'leap')) {\n            return 'Jump to the next feature in the selected track \"' + (tier.config.name || tier.dasSource.name) + '\" (ctrl+LEFT)';\n        } else {\n            return 'Jump left (shift+LEFT)';\n        }\n    });\n\n    leapRightButton.addEventListener('click', function (ev) {\n        b.leap(b.reverseKeyScrolling ? 1 : -1, false);\n    }, false);\n    b.makeTooltip(leapRightButton, function (ev) {\n        var st = b.getSelectedTier();\n        var tier;\n        if (st >= 0) tier = b.tiers[st];\n\n        if (tier && tier.featureSource && b.sourceAdapterIsCapable(tier.featureSource, 'quantLeap') && typeof tier.quantLeapThreshold == 'number') {\n            return 'Jump to the next region with a score above the threshold in the selected track \"' + (tier.config.name || tier.dasSource.name) + '\"\" (ctrl+RIGHT)';\n        } else if (tier && tier.featureSource && b.sourceAdapterIsCapable(tier.featureSource, 'leap')) {\n            return 'Jump to the next feature in the selected track \"' + (tier.config.name || tier.dasSource.name) + '\" (ctrl+RIGHT)';\n        } else {\n            return 'Jump right (shift+RIGHT)';\n        }\n    });\n    b.addTierSelectionListener(function () {\n        var st = b.getSelectedTier();\n        var tier;\n        if (st >= 0) tier = b.tiers[st];\n\n        var canLeap = false;\n        if (tier && tier.featureSource) {\n            if (b.sourceAdapterIsCapable(tier.featureSource, 'quantLeap') && typeof tier.quantLeapThreshold == 'number') canLeap = true;else if (b.sourceAdapterIsCapable(tier.featureSource, 'leap')) canLeap = true;\n        }\n\n        leapLeftButton.firstChild.className = canLeap ? 'fa fa-angle-double-left' : 'fa fa-angle-left';\n        leapRightButton.firstChild.className = canLeap ? 'fa fa-angle-double-right' : 'fa fa-angle-right';\n    });\n\n    clearHighlightsButton.addEventListener('click', function (ev) {\n        b.clearHighlights();\n    }, false);\n    b.makeTooltip(clearHighlightsButton, 'Clear highlights (C)');\n\n    b.addTierSelectionWrapListener(function (dir) {\n        if (dir < 0) {\n            b.setSelectedTier(null);\n            locField.focus();\n        }\n    });\n\n    b.addTierSelectionListener(function (sel) {\n        if (b.uiMode === 'tier') {\n            if (sel.length == 0) {\n                b.hideToolPanel();\n                b.manipulatingTier = null;\n                b.uiMode = 'none';\n            } else {\n                var ft = b.tiers[sel[0]];\n                if (ft != b.manipulatingTier) {\n                    b.openTierPanel(ft);\n                }\n            }\n        }\n    });\n\n    var uiKeyHandler = function uiKeyHandler(ev) {\n        // console.log('bukh: ' + ev.keyCode);\n        if (ev.keyCode == 65 || ev.keyCode == 97) {\n            // a\n            ev.preventDefault();ev.stopPropagation();\n            b.showTrackAdder();\n        } else if (ev.keyCode == 72 || ev.keyCode == 104) {\n            // h\n            ev.stopPropagation();ev.preventDefault();\n            b.toggleHelpPopup(ev);\n        } else if (ev.keyCode == 69 || ev.keyCode == 101) {\n            //e\n            ev.stopPropagation();ev.preventDefault();\n            if (b.selectedTiers.length == 1) {\n                b.openTierPanel(b.tiers[b.selectedTiers[0]]);\n            }\n        } else if (ev.keyCode == 88 || ev.keyCode == 120) {\n            // x\n            ev.stopPropagation();ev.preventDefault();\n            b.openExportPanel();\n        } else if (ev.keyCode == 67 || ev.keyCode == 99) {\n            // c\n            ev.stopPropagation();ev.preventDefault();\n            b.clearHighlights();\n        }\n    };\n\n    holder.addEventListener('focus', function (ev) {\n        holder.addEventListener('keydown', uiKeyHandler, false);\n    }, false);\n    holder.addEventListener('blur', function (ev) {\n        holder.removeEventListener('keydown', uiKeyHandler, false);\n    }, false);\n\n    holder.addEventListener('keydown', function (ev) {\n        if (ev.keyCode === 27) {\n            if (b.uiMode !== 'none') {\n                // Only consume event if tool panel is open.\n                ev.preventDefault();\n                ev.stopPropagation();\n                b.setUiMode('none');\n                b.hideToolPanel();\n\n                if (b.selectedTiers && b.selectedTiers.length > 0) {\n                    b.browserHolder.focus();\n                }\n            }\n        }\n    }, false);\n};\n\nBrowser.prototype.showToolPanel = function (panel, nowrap) {\n    var thisB = this;\n\n    if (this.activeToolPanel) {\n        this.activeToolPanel.parentElement.removeChild(this.activeToolPanel);\n    }\n\n    var content;\n    if (nowrap) content = panel;else content = makeElement('div', panel, {}, { overflowY: 'auto', width: '100%' });\n\n    var divider = makeElement('div', makeElement('i', null, { className: 'fa fa-caret-right' }), { className: 'tool-divider' });\n    divider.addEventListener('click', function (ev) {\n        thisB.hideToolPanel();\n        thisB.setUiMode('none');\n    }, false);\n    this.makeTooltip(divider, 'Close tool panel (ESC)');\n    this.activeToolPanel = makeElement('div', [divider, content], { className: 'tool-holder' });\n    this.svgHolder.appendChild(this.activeToolPanel);\n    this.resizeViewer();\n\n    var thisB = this;\n};\n\nBrowser.prototype.hideToolPanel = function () {\n    if (this.activeToolPanel) {\n        this.activeToolPanel.parentElement.removeChild(this.activeToolPanel);\n    }\n    this.svgHolder.style.width = '100%';\n    this.activeToolPanel = null;\n    this.resizeViewer();\n};\n\nBrowser.prototype.toggleHelpPopup = function (ev) {\n    if (this.uiMode === 'help') {\n        this.hideToolPanel();\n        this.setUiMode('none');\n    } else {\n        var helpFrame = makeElement('iframe', null, { scrolling: 'yes', seamless: 'seamless', src: this.resolveURL('$$help/index.html'), className: 'help-panel' });\n        this.showToolPanel(helpFrame, false);\n        this.setUiMode('help');\n    }\n};\n\nBrowser.prototype.toggleOptsPopup = function (ev) {\n    var b = this;\n\n    if (this.uiMode === 'opts') {\n        this.hideToolPanel();\n        this.setUiMode('none');\n    } else {\n        var optsForm = makeElement('div', null, { className: 'form-horizontal' }, { boxSizing: 'border-box', MozBoxSizing: 'border-box', display: 'inline-block', verticalAlign: 'top' });\n        var optsTable = makeElement('table');\n        optsTable.cellPadding = 5;\n\n        var scrollModeButton = makeElement('input', '', { type: 'checkbox', checked: b.reverseScrolling });\n        scrollModeButton.addEventListener('change', function (ev) {\n            b.reverseScrolling = scrollModeButton.checked;\n            b.storeStatus();\n        }, false);\n        optsTable.appendChild(makeElement('tr', [makeElement('td', 'Reverse trackpad scrolling', { align: 'right' }), makeElement('td', scrollModeButton)]));\n\n        var scrollKeyButton = makeElement('input', '', { type: 'checkbox', checked: b.reverseKeyScrolling });\n        scrollKeyButton.addEventListener('change', function (ev) {\n            b.reverseKeyScrolling = scrollKeyButton.checked;\n            b.storeStatus();\n        }, false);\n        optsTable.appendChild(makeElement('tr', [makeElement('td', 'Reverse scrolling buttons and keys', { align: 'right' }), makeElement('td', scrollKeyButton)]));\n\n        var rulerSelect = makeElement('select');\n        rulerSelect.appendChild(makeElement('option', 'Left', { value: 'left' }));\n        rulerSelect.appendChild(makeElement('option', 'Center', { value: 'center' }));\n        rulerSelect.appendChild(makeElement('option', 'Right', { value: 'right' }));\n        rulerSelect.appendChild(makeElement('option', 'None', { value: 'none' }));\n        rulerSelect.value = b.rulerLocation;\n        rulerSelect.addEventListener('change', function (ev) {\n            b.rulerLocation = rulerSelect.value;\n            b.positionRuler();\n            for (var ti = 0; ti < b.tiers.length; ++ti) {\n                b.tiers[ti].paintQuant();\n            }\n            b.storeStatus();\n        }, false);\n        optsTable.appendChild(makeElement('tr', [makeElement('td', 'Vertical guideline', { align: 'right' }), makeElement('td', rulerSelect)]));\n\n        var singleBaseHighlightButton = makeElement('input', '', { type: 'checkbox', checked: b.singleBaseHighlight });\n        singleBaseHighlightButton.addEventListener('change', function (ev) {\n            b.singleBaseHighlight = singleBaseHighlightButton.checked;\n            b.positionRuler();\n            b.storeStatus();\n        }, false);\n        singleBaseHighlightButton.setAttribute('id', 'singleBaseHightlightButton'); // making this because access is required when the key 'u' is pressed and the options are visible\n        optsTable.appendChild(makeElement('tr', [makeElement('td', 'Display and highlight current genome location', { align: 'right' }), makeElement('td', singleBaseHighlightButton)]));\n\n        optsForm.appendChild(optsTable);\n\n        var resetButton = makeElement('button', 'Reset browser', { className: 'btn' }, { marginLeft: 'auto', marginRight: 'auto', display: 'block' });\n        resetButton.addEventListener('click', function (ev) {\n            b.reset();\n        }, false);\n        optsForm.appendChild(resetButton);\n\n        this.showToolPanel(optsForm);\n        this.setUiMode('opts');\n    }\n};\n\nfunction humanReadableScale(x) {\n    var suffix = 'bp';\n    if (x > 1000000000) {\n        x /= 1000000000;\n        suffix = 'Gb';\n    } else if (x > 1000000) {\n        x /= 1000000;\n        suffix = 'Mb';\n    } else if (x > 1000) {\n        x /= 1000;\n        suffix = 'kb';\n    }\n    return '' + Math.round(x) + suffix;\n}\n\n},{\"./cbrowser\":6,\"./export-config\":17,\"./export-image\":18,\"./export-ui\":19,\"./numformats\":30,\"./session\":37,\"./svg-export\":44,\"./tier-edit\":51,\"./utils\":56,\"./zoomslider\":59}],6:[function(require,module,exports){\n/* -*- mode: javascript; c-basic-offset: 4; indent-tabs-mode: nil -*- */\n\n//\n// Dalliance Genome Explorer\n// (c) Thomas Down 2006-2011\n//\n// cbrowser.js: canvas browser container\n//\n\n\"use strict\";\n\nif (typeof require !== 'undefined') {\n    var utils = require('./utils');\n    var Observed = utils.Observed;\n    var Awaited = utils.Awaited;\n    var makeElement = utils.makeElement;\n    var removeChildren = utils.removeChildren;\n    var miniJSONify = utils.miniJSONify;\n    var shallowCopy = utils.shallowCopy;\n    var textXHR = utils.textXHR;\n\n    var tier = require('./tier');\n    var DasTier = tier.DasTier;\n\n    var sha1 = require('./sha1');\n    var hex_sha1 = sha1.hex_sha1;\n\n    var thub = require('./thub');\n    var connectTrackHub = thub.connectTrackHub;\n\n    var VERSION = require('./version');\n\n    var nf = require('./numformats');\n    var formatQuantLabel = nf.formatQuantLabel;\n    var formatLongInt = nf.formatLongInt;\n\n    var Chainset = require('./chainset').Chainset;\n\n    var Promise = require('es6-promise').Promise;\n\n    var sourcecompare = require('./sourcecompare');\n    var sourcesAreEqual = sourcecompare.sourcesAreEqual;\n    var sourcesAreEqualModuloStyle = sourcecompare.sourcesAreEqualModuloStyle;\n    var sourceDataURI = sourcecompare.sourceDataURI;\n    var sourceStyleURI = sourcecompare.sourceStyleURI;\n\n    var DefaultRenderer = require('./default-renderer');\n\n    var MultiRenderer = require('./multi-renderer');\n    var SubRenderer = require('./sub-renderer');\n\n    var DummyRenderer = require('./dummy-renderer');\n}\n\nfunction Region(chr, min, max) {\n    this.min = min;\n    this.max = max;\n    this.chr = chr;\n}\n\nfunction Browser(opts) {\n    if (!opts) {\n        opts = {};\n    }\n\n    this.renderers = { 'default': DefaultRenderer,\n        'dummy': DummyRenderer,\n        'multi': MultiRenderer,\n        'sub': SubRenderer\n    };\n\n    this.defaultRenderer = opts.renderer || DefaultRenderer;\n\n    this.prefix = '//www.biodalliance.org/release-0.14/';\n\n    this.sources = [];\n    this.tiers = [];\n    this.tierGroups = {};\n\n    this.searchOnlySources = [];\n    this.searchOnlySourceHolders = [];\n\n    this.featureListeners = [];\n    this.featureHoverListeners = [];\n    this.viewListeners = [];\n    this.regionSelectListeners = [];\n    this.tierListeners = [];\n    this.tierSelectionListeners = [];\n    this.tierSelectionWrapListeners = [];\n\n    this.cookieKey = 'browser';\n\n    this.chains = {};\n\n    this.pageName = 'svgHolder';\n    this.zoomFactor = 1.0;\n    this.maxPixelsPerBase = 10;\n    this.origin = 0;\n    this.targetQuantRes = 1.0;\n    this.featurePanelWidth = 750;\n    this.zoomBase = 100;\n    this.zoomExpt = 30.0; // Back to being fixed....\n    this.zoomSliderValue = 100;\n    this.entryPoints = null;\n    this.currentSeqMax = -1; // init once EPs are fetched.\n\n    this.highlights = [];\n    this.selectedTiers = [1];\n\n    this.maxViewWidth = 500000;\n    this.defaultSubtierMax = 100;\n\n    this.highZoomThreshold = 0.2;\n    this.mediumZoomThreshold = 0.01;\n\n    this.minExtraWidth = 100.0;\n    this.maxExtraWidth = 1000.0;\n\n    // Options.\n\n    this.reverseScrolling = false;\n    this.rulerLocation = 'center';\n    this.defaultHighlightFill = 'red';\n    this.defaultHighlightAlpha = 0.3;\n    this.exportHighlights = true;\n    this.exportRuler = true;\n    this.exportBanner = true;\n    this.exportRegion = true;\n    this.singleBaseHighlight = true;\n\n    // Visual config.\n\n    // this.tierBackgroundColors = [\"rgb(245,245,245)\", \"rgb(230,230,250)\" /* 'white' */];\n    this.tierBackgroundColors = [\"rgb(245,245,245)\", 'white'];\n    this.minTierHeight = 20;\n    this.noDefaultLabels = false;\n\n    // Registry\n\n    this.availableSources = new Observed();\n    this.defaultSources = [];\n    this.mappableSources = {};\n\n    // Central DAS Registry no longer available 2015-05\n\n    this.registry = null; // '//www.dasregistry.org/das/sources';\n    this.noRegistryTabs = true;\n\n    this.defaultTrackAdderTab = null;\n\n    this.hubs = [];\n    this.hubObjects = [];\n\n    this.sourceCache = new SourceCache();\n\n    this.retina = true;\n\n    this.useFetchWorkers = true;\n    this.maxWorkers = 2;\n    this.workerPath = '$$worker-all.js';\n    this.resolvers = {};\n    this.resolverSeed = 1;\n\n    this.assemblyNamePrimary = true;\n    this.assemblyNameUcsc = true;\n\n    this.defaultSearchRegionPadding = 10000;\n\n    // HTTP warning support\n\n    this.httpCanaryURL = 'http://www.biodalliance.org/http-canary.txt';\n    this.httpWarningURL = '//www.biodalliance.org/https.html';\n\n    this.initListeners = [];\n\n    if (opts.baseColors) {\n        this.baseColors = opts.baseColors;\n    } else {\n        if (opts.aminoAcids) {\n            this.baseColors = {\n                F: 'rgb(182, 201, 237)',\n                L: 'rgb(213, 236, 213)',\n                I: 'rgb(239, 213, 211)',\n                M: 'rgb(255, 23, 0)',\n                V: 'rgb(255, 172, 0)',\n                S: 'rgb(255, 244, 19)',\n                P: 'rgb(138, 189, 67)',\n                T: 'rgb(36, 153, 57)',\n                A: 'rgb(0, 166, 236)',\n                Y: 'rgb(0, 101, 178)',\n                H: 'rgb(215, 206, 182)',\n                Q: 'rgb(252, 176, 124)',\n                N: 'rgb(159, 148, 186)',\n                K: 'rgb(133, 117, 67)',\n                D: 'rgb(108, 242, 51)',\n                E: 'rgb(0, 253, 255)',\n                C: 'rgb(248, 129, 51)',\n                W: 'rgb(243, 68, 252)',\n                R: 'rgb(207, 207, 207)',\n                G: 'rgb(166, 213, 227)'\n            };\n        } else {\n            this.baseColors = {\n                A: 'green',\n                C: 'blue',\n                G: 'orange',\n                T: 'red',\n                '-': 'hotpink', // deletion\n                'I': 'red' // insertion\n            };\n        }\n    }\n\n    if (opts.viewStart !== undefined && typeof opts.viewStart !== 'number') {\n        throw Error('viewStart must be an integer');\n    }\n    if (opts.viewEnd !== undefined && typeof opts.viewEnd !== 'number') {\n        throw Error('viewEnd must be an integer');\n    }\n    if (opts.offscreenInitWidth !== undefined && typeof opts.offscreenInitWidth !== 'number') {\n        throw Error('offscreenInitWidth must be an integer');\n    }\n\n    for (var k in opts) {\n        this[k] = opts[k];\n    }\n\n    if (typeof opts.uiPrefix === 'string' && typeof opts.prefix !== 'string') {\n        this.prefix = opts.uiPrefix;\n    }\n    // If the prefix only starts with a single '/' this is relative to the current\n    // site, so we need to prefix the prefix with //{hostname}\n    if (this.prefix.indexOf('//') < 0 && this.prefix.indexOf('/') === 0) {\n        var location = window.location.hostname;\n        if (window.location.port) {\n            location += ':' + window.location.port;\n        };\n        this.prefix = '//' + location + this.prefix;\n    }\n    if (this.prefix.indexOf('//') === 0) {\n        var proto = window.location.protocol;\n        if (proto == 'http:' || proto == 'https:') {\n            // Protocol-relative URLs okay.\n        } else {\n            console.log(window.location.protocol);\n            console.log('WARNING: prefix is set to a protocol-relative URL (' + this.prefix + ' when loading from a non-HTTP source');\n            this.prefix = 'http:' + this.prefix;\n        }\n    }\n\n    if (!this.coordSystem) {\n        throw Error('Coordinate system must be configured');\n    }\n\n    if (this.chr === undefined || this.viewStart === undefined || this.viewEnd === undefined) {\n        throw Error('Viewed region (chr:start..end) must be defined');\n    }\n\n    var thisB = this;\n\n    if (document.readyState === 'complete') {\n        thisB.realInit();\n    } else {\n        var loadListener = function loadListener(ev) {\n            window.removeEventListener('load', loadListener, false);\n            thisB.realInit();\n        };\n        window.addEventListener('load', loadListener, false);\n    }\n}\n\nBrowser.prototype.resolveURL = function (url) {\n    return url.replace('$$', this.prefix);\n};\n\nBrowser.prototype.destroy = function () {\n    window.removeEventListener('resize', this.resizeListener, false);\n    if (this.fetchWorkers) {\n        var _iteratorNormalCompletion = true;\n        var _didIteratorError = false;\n        var _iteratorError = undefined;\n\n        try {\n            for (var _iterator = this.fetchWorkers[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {\n                var worker = _step.value;\n\n                worker.terminate();\n            }\n        } catch (err) {\n            _didIteratorError = true;\n            _iteratorError = err;\n        } finally {\n            try {\n                if (!_iteratorNormalCompletion && _iterator.return) {\n                    _iterator.return();\n                }\n            } finally {\n                if (_didIteratorError) {\n                    throw _iteratorError;\n                }\n            }\n        }\n    }\n};\n\nBrowser.prototype.realInit = function () {\n    var self = this;\n    var thisB = this;\n\n    if (this.wasInitialized) {\n        console.log('Attemping to call realInit on an already-initialized Dalliance instance');\n        return;\n    }\n\n    this.wasInitialized = true;\n\n    if (typeof navigator !== 'undefined') {\n        var ua = navigator.userAgent || 'dummy';\n        if (ua.indexOf('Trident') >= 0 && ua.indexOf('rv:11') >= 0) {\n            // console.log('Detected IE11, disabling tier pinning.');\n            this.disablePinning = true;\n        }\n    }\n\n    this.defaultChr = this.chr;\n    this.defaultStart = this.viewStart;\n    this.defaultEnd = this.viewEnd;\n    this.defaultSources = [];\n    for (var i = 0; i < this.sources.length; ++i) {\n        var s = this.sources[i];\n        if (s) this.defaultSources.push(s);\n    }\n\n    if (this.restoreStatus) {\n        this.statusRestored = this.restoreStatus();\n    }\n\n    if (this.injectionPoint && this.injectionPoint instanceof Element) {\n        this.browserHolderHolder = this.injectionPoint;\n    } else if (this.injectionPoint) {\n        this.browserHolderHolder = document.getElementById(this.injectionPoint);\n        if (!this.browserHolderHolder) {\n            throw Error('injectionPoint must point to a valid DOM element of element ID');\n        }\n    } else {\n        this.browserHolderHolder = document.getElementById(this.pageName);\n        if (!this.browserHolderHolder) {\n            throw Error('pageName must be a valid element ID (or use the injectionPoint option instead)');\n        }\n    }\n\n    this.browserHolderHolder.classList.add('dalliance-injection-point');\n    this.browserHolder = makeElement('div', null, { className: 'dalliance dalliance-root', tabIndex: -1 });\n    if (this.maxHeight) {\n        this.browserHolder.style.maxHeight = this.maxHeight + 'px';\n    } else if (this.maxHeight != undefined) {\n        this.browserHolder.style.maxHeight = null;\n    }\n    removeChildren(this.browserHolderHolder);\n    this.browserHolderHolder.appendChild(this.browserHolder);\n    this.svgHolder = makeElement('div', null, { className: 'main-holder' });\n\n    this.initUI(this.browserHolder, this.svgHolder);\n\n    this.pinnedTierHolder = makeElement('div', null, { className: 'tier-holder tier-holder-pinned' });\n    this.tierHolder = makeElement('div', this.makeLoader(24), { className: 'tier-holder tier-holder-rest' });\n\n    this.locSingleBase = makeElement('span', '', { className: 'loc-single-base' });\n    var locSingleBaseHolder = makeElement('div', this.locSingleBase, { className: 'loc-single-base-holder' });\n    // Add listener to update single base location\n    this.addViewListener(function (chr, minFloor, maxFloor, zoomSliderValue, zoomSliderDict, min, max) {\n        // Just setting textContent causes layout flickering in Blink.\n        // This approach means that the element is never empty.\n        var loc = Math.round((max + min) / 2);\n        self.locSingleBase.appendChild(document.createTextNode(chr + ':' + formatLongInt(loc)));\n        self.locSingleBase.removeChild(self.locSingleBase.firstChild);\n    });\n\n    if (this.disablePinning) {\n        this.tierHolderHolder = this.tierHolder;\n    } else {\n        this.tierHolderHolder = makeElement('div', [locSingleBaseHolder, this.pinnedTierHolder, this.tierHolder], { className: 'tier-holder-holder' });\n        this.svgHolder.appendChild(this.tierHolderHolder);\n    }\n    this.svgHolder.appendChild(this.tierHolderHolder);\n\n    this.bhtmlRoot = makeElement('div');\n    if (!this.disablePoweredBy) {\n        this.bhtmlRoot.appendChild(makeElement('span', ['Powered by ', makeElement('a', 'Biodalliance', { href: 'http://www.biodalliance.org/' }), ' ' + VERSION], { className: 'powered-by' }));\n    }\n    this.browserHolder.appendChild(this.bhtmlRoot);\n\n    this.resizeListener = function (ev) {\n        thisB.resizeViewer();\n    };\n\n    this.ruler = makeElement('div', null, { className: 'guideline' });\n    this.ruler2 = makeElement('div', null, { className: 'single-base-guideline' });\n    this.tierHolderHolder.appendChild(this.ruler);\n    this.tierHolderHolder.appendChild(this.ruler2);\n    this.chainConfigs = this.chains || {};\n    this.chains = {};\n    for (var k in this.chainConfigs) {\n        var cc = this.chainConfigs[k];\n        if (cc instanceof Chainset) {\n            console.log('WARNING: Should no longer use \"new Chainset\" in Biodalliance configurations.');\n        }\n        this.chains[k] = new Chainset(cc);\n    }\n\n    var promisedWorkers;\n    if (this.maxWorkers > 0) {\n        var pw = [];\n        for (var fi = 0; fi < this.maxWorkers; ++fi) {\n            pw.push(makeFetchWorker(this));\n        }promisedWorkers = Promise.all(pw);\n    } else {\n        promisedWorkers = Promise.resolve([]);\n    }\n\n    this.fetchWorkers = null;\n    this.nextWorker = 0;\n    promisedWorkers.then(function (v) {\n        console.log('Booted ' + v.length + ' workers');\n        thisB.fetchWorkers = v;\n    }, function (v) {\n        console.log('Failed to boot workers', v);\n    }).then(function () {\n        if (self.offscreenInitWidth || window.getComputedStyle(thisB.browserHolderHolder).display != 'none' && thisB.tierHolder.getBoundingClientRect().width > 0) {\n            setTimeout(function () {\n                thisB.realInit2();\n            }, 1);\n        } else {\n            var pollInterval = setInterval(function () {\n                if (window.getComputedStyle(thisB.browserHolderHolder).display != 'none' && thisB.tierHolder.getBoundingClientRect().width > 0) {\n                    clearInterval(pollInterval);\n                    thisB.realInit2();\n                }\n            }, 300);\n        }\n    });\n};\n\nBrowser.prototype.realInit2 = function () {\n    var _this = this;\n\n    var thisB = this;\n\n    // Remove the loader icon, if needed\n    removeChildren(this.tierHolder);\n    removeChildren(this.pinnedTierHolder);\n\n    this.featurePanelWidth = this.tierHolder.getBoundingClientRect().width | thisB.offscreenInitWidth | 0;\n    window.addEventListener('resize', this.resizeListener, false);\n\n    this.scale = this.featurePanelWidth / (this.viewEnd - this.viewStart);\n    if (!this.zoomMax) {\n        this.zoomMax = this.zoomExpt * Math.log(this.maxViewWidth / this.zoomBase);\n        this.zoomMin = this.zoomExpt * Math.log(this.featurePanelWidth / this.maxPixelsPerBase / this.zoomBase);\n    }\n    this.zoomSliderValue = this.zoomExpt * Math.log((this.viewEnd - this.viewStart + 1) / this.zoomBase);\n\n    // Event handlers\n\n    this.tierHolderHolder.addEventListener('mousewheel', function (ev) {\n        ev.stopPropagation();ev.preventDefault();\n\n        if (ev.wheelDeltaX) {\n            var delta = ev.wheelDeltaX / 5;\n            if (!thisB.reverseScrolling) {\n                delta = -delta;\n            }\n            thisB.move(delta);\n        }\n\n        if (ev.wheelDeltaY) {\n            var delta = ev.wheelDeltaY;\n            if (thisB.reverseScrolling) {\n                delta = -delta;\n            }\n            thisB.tierHolder.scrollTop += delta;\n        }\n    }, false);\n\n    this.tierHolderHolder.addEventListener('MozMousePixelScroll', function (ev) {\n        ev.stopPropagation();ev.preventDefault();\n        if (ev.axis == 1) {\n            if (ev.detail != 0) {\n                var delta = ev.detail / 4;\n                if (thisB.reverseScrolling) {\n                    delta = -delta;\n                }\n                thisB.move(delta);\n            }\n        } else {\n            var delta = ev.detail;\n            if (!thisB.reverseScrolling) {\n                delta = -delta;\n            }\n\n            thisB.tierHolder.scrollTop += delta;\n        }\n    }, false);\n\n    this.tierHolderHolder.addEventListener('touchstart', function (ev) {\n        return thisB.touchStartHandler(ev);\n    }, false);\n    this.tierHolderHolder.addEventListener('touchmove', function (ev) {\n        return thisB.touchMoveHandler(ev);\n    }, false);\n    this.tierHolderHolder.addEventListener('touchend', function (ev) {\n        return thisB.touchEndHandler(ev);\n    }, false);\n    this.tierHolderHolder.addEventListener('touchcancel', function (ev) {\n        return thisB.touchCancelHandler(ev);\n    }, false);\n\n    var keyHandler = function keyHandler(ev) {\n        // console.log('cbkh: ' + ev.keyCode);\n        if (ev.keyCode == 13) {\n            // enter\n            var layoutsChanged = false;\n            for (var ti = 0; ti < thisB.tiers.length; ++ti) {\n                var t = thisB.tiers[ti];\n                if (t.wantedLayoutHeight && t.wantedLayoutHeight != t.layoutHeight) {\n                    t.layoutHeight = t.wantedLayoutHeight;\n                    t.clipTier();\n                    layoutsChanged = true;\n                }\n            }\n            if (layoutsChanged) {\n                thisB.arrangeTiers();\n            }\n        } else if (ev.keyCode == 32 || ev.charCode == 32) {\n            // space\n            if (!thisB.isSnapZooming) {\n                thisB.isSnapZooming = true;\n                var newZoom = (thisB.savedZoom || 0.0) + thisB.zoomMin;\n                thisB.savedZoom = thisB.zoomSliderValue - thisB.zoomMin;\n                thisB.zoomSliderValue = newZoom;\n                thisB.zoom(Math.exp(1.0 * newZoom / thisB.zoomExpt));\n            } else {\n                thisB.isSnapZooming = false;\n                var newZoom = (thisB.savedZoom || 20.0) + thisB.zoomMin;\n                thisB.savedZoom = thisB.zoomSliderValue - thisB.zoomMin;\n                thisB.zoomSliderValue = newZoom;\n                thisB.zoom(Math.exp(1.0 * newZoom / thisB.zoomExpt));\n            }\n            ev.stopPropagation();ev.preventDefault();\n        } else if (ev.keyCode == 85) {\n            // u\n            if (thisB.uiMode === 'opts') {\n                // if the options are visible, toggle the checkbox too\n                var check = document.getElementById(\"singleBaseHightlightButton\").checked;\n                document.getElementById(\"singleBaseHightlightButton\").checked = !check;\n            }\n            thisB.singleBaseHighlight = !thisB.singleBaseHighlight;\n            thisB.positionRuler();\n            ev.stopPropagation();ev.preventDefault();\n        } else if (ev.keyCode == 39) {\n            // right arrow\n            ev.stopPropagation();ev.preventDefault();\n            thisB.scrollArrowKey(ev, -1);\n        } else if (ev.keyCode == 37) {\n            // left arrow\n            ev.stopPropagation();ev.preventDefault();\n            thisB.scrollArrowKey(ev, 1);\n        } else if (ev.keyCode == 38 || ev.keyCode == 87) {\n            // up arrow | w\n            ev.stopPropagation();ev.preventDefault();\n\n            if (ev.shiftKey) {\n                var st = thisB.getSelectedTier();\n                if (st < 0) return;\n                var tt = thisB.tiers[st];\n                var ch = tt.forceHeight || tt.subtiers[0].height;\n                if (ch >= 40) {\n                    tt.mergeConfig({ height: ch - 10 });\n                }\n            } else if (ev.ctrlKey || ev.metaKey) {\n                var st = thisB.getSelectedTier();\n                if (st < 0) return;\n                var tt = thisB.tiers[st];\n\n                if (tt.quantLeapThreshold) {\n                    var th = tt.subtiers[0].height;\n                    var tq = tt.subtiers[0].quant;\n                    if (!tq) return;\n\n                    var qmin = 1.0 * tq.min;\n                    var qmax = 1.0 * tq.max;\n\n                    var qscale = (qmax - qmin) / th;\n                    tt.mergeConfig({ quantLeapThreshold: qmin + ((Math.round((tt.quantLeapThreshold - qmin) / qscale) | 0) + 1) * qscale });\n\n                    tt.notify('Threshold: ' + formatQuantLabel(tt.quantLeapThreshold));\n                }\n            } else if (ev.altKey) {\n                var cnt = thisB.selectedTiers.length;\n                if (cnt == 0) return;\n\n                var st = thisB.selectedTiers[0];\n                var contiguous = true;\n                var mt = [];\n                for (var si = 0; si < thisB.selectedTiers.length; ++si) {\n                    mt.push(thisB.tiers[thisB.selectedTiers[si]]);\n                    if (si > 0 && thisB.selectedTiers[si] - thisB.selectedTiers[si - 1] != 1) contiguous = false;\n                }\n\n                if (contiguous && st <= 0) return;\n\n                for (var si = thisB.selectedTiers.length - 1; si >= 0; --si) {\n                    thisB.tiers.splice(thisB.selectedTiers[si], 1);\n                }thisB.selectedTiers.splice(0, cnt);\n\n                var ip = contiguous ? st - 1 : st;\n                for (var si = 0; si < mt.length; ++si) {\n                    thisB.tiers.splice(ip + si, 0, mt[si]);\n                    thisB.selectedTiers.push(ip + si);\n                }\n\n                thisB.withPreservedSelection(thisB._ensureTiersGrouped);\n                thisB.markSelectedTiers();\n                thisB.notifyTierSelection();\n                thisB.reorderTiers();\n                thisB.notifyTier(\"selected\", st);\n            } else {\n                var st = thisB.getSelectedTier();\n                if (st > 0) {\n                    thisB.setSelectedTier(st - 1);\n                    var nst = thisB.tiers[thisB.getSelectedTier()];\n                    var top = nst.row.offsetTop,\n                        bottom = top + nst.row.offsetHeight;\n                    if (top < thisB.tierHolder.scrollTop || bottom > thisB.tierHolder.scrollTop + thisB.tierHolder.offsetHeight) {\n                        thisB.tierHolder.scrollTop = top;\n                    }\n                } else {\n                    thisB.notifyTierSelectionWrap(-1);\n                }\n            }\n        } else if (ev.keyCode == 40 || ev.keyCode == 83) {\n            // down arrow | s\n            ev.stopPropagation();ev.preventDefault();\n\n            if (ev.shiftKey) {\n                var st = thisB.getSelectedTier();\n                if (st < 0) return;\n                var tt = thisB.tiers[st];\n                var ch = tt.forceHeight || tt.subtiers[0].height;\n                tt.mergeConfig({ height: ch + 10 });\n            } else if (ev.ctrlKey || ev.metaKey) {\n                var st = thisB.getSelectedTier();\n                if (st < 0) return;\n                var tt = thisB.tiers[st];\n\n                if (tt.quantLeapThreshold) {\n                    var th = tt.subtiers[0].height;\n                    var tq = tt.subtiers[0].quant;\n                    if (!tq) return;\n\n                    var qmin = 1.0 * tq.min;\n                    var qmax = 1.0 * tq.max;\n                    var qscale = (qmax - qmin) / th;\n\n                    var it = Math.round((tt.quantLeapThreshold - qmin) / qscale) | 0;\n                    if (it > 1) {\n                        tt.mergeConfig({ quantLeapThreshold: qmin + (it - 1) * qscale });\n                        tt.notify('Threshold: ' + formatQuantLabel(tt.quantLeapThreshold));\n                    }\n                }\n            } else if (ev.altKey) {\n                var cnt = thisB.selectedTiers.length;\n                if (cnt == 0) return;\n\n                var st = thisB.selectedTiers[0];\n                var discontig = 0;\n                var mt = [];\n                for (var si = 0; si < thisB.selectedTiers.length; ++si) {\n                    mt.push(thisB.tiers[thisB.selectedTiers[si]]);\n                    if (si > 0) discontig += thisB.selectedTiers[si] - thisB.selectedTiers[si - 1] - 1;\n                }\n                var contiguous = discontig == 0;\n\n                if (contiguous && st + cnt >= thisB.tiers.length) return;\n\n                for (var si = thisB.selectedTiers.length - 1; si >= 0; --si) {\n                    thisB.tiers.splice(thisB.selectedTiers[si], 1);\n                }thisB.selectedTiers.splice(0, cnt);\n\n                var ip = contiguous ? st + 1 : st + discontig;\n                for (var si = 0; si < mt.length; ++si) {\n                    thisB.tiers.splice(ip + si, 0, mt[si]);\n                    thisB.selectedTiers.push(ip + si);\n                }\n\n                thisB.withPreservedSelection(function () {\n                    thisB._ensureTiersGrouped(true);\n                });\n                thisB.markSelectedTiers();\n                thisB.notifyTierSelection();\n                thisB.reorderTiers();\n                thisB.notifyTier(\"selected\", st);\n            } else {\n                var st = thisB.getSelectedTier();\n                if (st < thisB.tiers.length - 1) {\n                    thisB.setSelectedTier(st + 1);\n                    var nst = thisB.tiers[thisB.getSelectedTier()];\n                    var top = nst.row.offsetTop,\n                        bottom = top + nst.row.offsetHeight;\n                    if (top < thisB.tierHolder.scrollTop || bottom > thisB.tierHolder.scrollTop + thisB.tierHolder.offsetHeight) {\n                        thisB.tierHolder.scrollTop = Math.min(top, bottom - thisB.tierHolder.offsetHeight);\n                    }\n                }\n            }\n        } else if (ev.keyCode == 187 || ev.keyCode == 61) {\n            // +\n            ev.stopPropagation();ev.preventDefault();\n            thisB.zoomStep(-10);\n        } else if (ev.keyCode == 189 || ev.keyCode == 173) {\n            // -\n            ev.stopPropagation();ev.preventDefault();\n            thisB.zoomStep(10);\n        } else if (ev.keyCode == 73 || ev.keyCode == 105) {\n            // i\n            ev.stopPropagation();ev.preventDefault();\n            var st = thisB.getSelectedTier();\n            if (st < 0) return;\n            var t = thisB.tiers[st];\n            if (!t.infoVisible) {\n                t.infoElement.style.display = 'block';\n                t.updateHeight();\n                t.infoVisible = true;\n            } else {\n                t.infoElement.style.display = 'none';\n                t.updateHeight();\n                t.infoVisible = false;\n            }\n        } else if (ev.keyCode == 84 || ev.keyCode == 116) {\n            // t\n            var bumpStatus;\n            if (ev.shiftKey) {\n                ev.stopPropagation();ev.preventDefault();\n                for (var ti = 0; ti < thisB.tiers.length; ++ti) {\n                    var t = thisB.tiers[ti];\n                    if (t.dasSource.collapseSuperGroups) {\n                        if (bumpStatus === undefined) {\n                            bumpStatus = !t.bumped;\n                        }\n                        t.mergeConfig({ bumped: bumpStatus });\n                    }\n                }\n            } else if (!ev.ctrlKey && !ev.metaKey) {\n                ev.stopPropagation();ev.preventDefault();\n                var st = thisB.getSelectedTier();\n                if (st < 0) return;\n                var t = thisB.tiers[st];\n\n                if (t.dasSource.collapseSuperGroups) {\n                    if (bumpStatus === undefined) {\n                        bumpStatus = !t.bumped;\n                    }\n                    t.mergeConfig({ bumped: bumpStatus });\n                }\n            }\n        } else if (ev.keyCode == 77 || ev.keyCode == 109) {\n            // m\n            ev.stopPropagation();ev.preventDefault();\n            if ((ev.ctrlKey || ev.metaKey) && thisB.selectedTiers.length > 1) {\n                thisB.mergeSelectedTiers();\n            }\n        } else if (ev.keyCode == 68 || ev.keyCode == 100) {\n            // d\n            ev.stopPropagation();ev.preventDefault();\n            if (ev.ctrlKey || ev.metaKey) {\n                var st = thisB.getSelectedTier();\n                if (st < 0) return;\n                thisB.addTier(thisB.tiers[st].dasSource);\n            }\n        } else if (ev.keyCode == 80 || ev.keyCode == 112) {\n            // p\n            if (ev.ctrlKey || ev.metaKey) {\n                // Need to be careful because order of tiers could change\n                // once we start updating pinning.\n                var tt = [];\n                for (var st = 0; st < thisB.selectedTiers.length; ++st) {\n                    tt.push(thisB.tiers[thisB.selectedTiers[st]]);\n                }\n                for (var ti = 0; ti < tt.length; ++ti) {\n                    tt[ti].mergeConfig({ pinned: !tt[ti].pinned });\n                }\n            }\n        } else {\n            // console.log('key: ' + ev.keyCode + '; char: ' + ev.charCode);\n        }\n    };\n\n    this.browserHolder.addEventListener('focus', function (ev) {\n        thisB.browserHolder.addEventListener('keydown', keyHandler, false);\n    }, false);\n    this.browserHolder.addEventListener('blur', function (ev) {\n        thisB.browserHolder.removeEventListener('keydown', keyHandler, false);\n    }, false);\n\n    // Popup support (does this really belong here? FIXME)\n    this.hPopupHolder = makeElement('div');\n    this.hPopupHolder.style['font-family'] = 'helvetica';\n    this.hPopupHolder.style['font-size'] = '12pt';\n    this.hPopupHolder.classList.add('dalliance');\n    document.body.appendChild(this.hPopupHolder);\n\n    for (var t = 0; t < this.sources.length; ++t) {\n        var source = this.sources[t];\n        if (!source) continue;\n\n        var config = {};\n        if (this.restoredConfigs) {\n            config = this.restoredConfigs[t];\n        }\n\n        if (!source.disabled) {\n            this.makeTier(source, config).then(function (tier) {\n                thisB.refreshTier(tier);\n            });\n        }\n    }\n\n    var _iteratorNormalCompletion2 = true;\n    var _didIteratorError2 = false;\n    var _iteratorError2 = undefined;\n\n    try {\n        for (var _iterator2 = this.searchOnlySources[Symbol.iterator](), _step2; !(_iteratorNormalCompletion2 = (_step2 = _iterator2.next()).done); _iteratorNormalCompletion2 = true) {\n            var _source = _step2.value;\n\n            if (!_source.disabled) {\n                var _createSources = this.createSources(_source),\n                    features = _createSources.features;\n\n                if (features) {\n                    this.searchOnlySourceHolders.push({\n                        dasSource: _source,\n                        featureSource: features\n                    });\n                }\n            }\n        }\n    } catch (err) {\n        _didIteratorError2 = true;\n        _iteratorError2 = err;\n    } finally {\n        try {\n            if (!_iteratorNormalCompletion2 && _iterator2.return) {\n                _iterator2.return();\n            }\n        } finally {\n            if (_didIteratorError2) {\n                throw _iteratorError2;\n            }\n        }\n    }\n\n    if (this.onFirstRender) {\n        Promise.all(this.tiers.map(function (t) {\n            return t.firstRenderPromise;\n        })).then(function () {\n            return _this.onFirstRender();\n        }).catch(function (err) {\n            return console.log(err);\n        });\n    }\n\n    thisB._ensureTiersGrouped();\n    thisB.arrangeTiers();\n    thisB.reorderTiers();\n\n    var ss = this.getSequenceSource();\n    if (ss) {\n        ss.getSeqInfo(this.chr, function (si) {\n            if (si) thisB.currentSeqMax = si.length;else thisB.currentSeqMax = -1;\n        });\n    }\n\n    this.queryRegistry();\n    for (var m in this.chains) {\n        this.queryRegistry(m, true);\n    }\n\n    if (this.hubs) {\n        for (var hi = 0; hi < this.hubs.length; ++hi) {\n            var hc = this.hubs[hi];\n            if (typeof hc == 'string') {\n                hc = { url: hc };\n            };\n\n            (function (hc) {\n                connectTrackHub(hc.url, function (hub, err) {\n                    if (err) {\n                        console.log(err);\n                    } else {\n                        var tdb;\n                        if (hc.genome) tdb = hub.genomes[hc.genome];else tdb = hub.genomes[thisB.coordSystem.ucscName];\n\n                        if (tdb) {\n                            if (hc.mapping) tdb.mapping = hc.mapping;\n                            if (hc.label) tdb.hub.altLabel = hc.label;\n                            thisB.hubObjects.push(tdb);\n                        }\n                    }\n                }, hc);\n            })(hc);\n        }\n    }\n\n    if (this.fullScreen) {\n        this.setFullScreenHeight();\n    }\n\n    if (!this.statusRestored && this.storeStatus) {\n        this.storeStatus();\n    }\n\n    thisB.setLocation(this.chr, this.viewStart, this.viewEnd, function () {\n        thisB.setSelectedTier(1);\n        // Ping any init listeners.\n        for (var ii = 0; ii < thisB.initListeners.length; ++ii) {\n            try {\n                thisB.initListeners[ii].call(thisB);\n            } catch (e) {\n                console.log(e);\n            }\n        }\n    });\n};\n\n//\n// Touch event support\n//\n\nBrowser.prototype.touchStartHandler = function (ev) {\n    // Events not consumed so they can be interpretted as clicks as well.\n\n    this.touchOriginX = ev.touches[0].pageX;\n    this.touchOriginY = ev.touches[0].pageY;\n    if (ev.touches.length == 2) {\n        var sep = Math.abs(ev.touches[0].pageX - ev.touches[1].pageX);\n        this.zooming = true;\n        this.zoomLastSep = this.zoomInitialSep = sep;\n        this.zoomInitialScale = this.scale;\n    }\n};\n\nBrowser.prototype.touchMoveHandler = function (ev) {\n    // These events *are* consumed to ensure we never get any dragging that\n    // we don't manage ourselves.\n\n    ev.stopPropagation();ev.preventDefault();\n\n    if (ev.touches.length == 1) {\n        var touchX = ev.touches[0].pageX;\n        var touchY = ev.touches[0].pageY;\n        if (this.touchOriginX && touchX != this.touchOriginX) {\n            this.move(touchX - this.touchOriginX);\n        }\n        if (this.touchOriginY && touchY != this.touchOriginY) {\n            this.tierHolder.scrollTop -= touchY - this.touchOriginY;\n        }\n        this.touchOriginX = touchX;\n        this.touchOriginY = touchY;\n    } else if (this.zooming && ev.touches.length == 2) {\n        var sep = Math.abs(ev.touches[0].pageX - ev.touches[1].pageX);\n        if (sep != this.zoomLastSep) {\n            var cp = (ev.touches[0].pageX + ev.touches[1].pageX) / 2;\n            var scp = this.viewStart + cp / this.scale | 0;\n            this.scale = this.zoomInitialScale * (sep / this.zoomInitialSep);\n            this.viewStart = scp - cp / this.scale | 0;\n            for (var i = 0; i < this.tiers.length; ++i) {\n                tiers[i].getRenderer().drawTier(tiers[i]);\n            }\n        }\n        this.zoomLastSep = sep;\n    }\n};\n\nBrowser.prototype.touchEndHandler = function (ev) {};\n\nBrowser.prototype.touchCancelHandler = function (ev) {};\n\nBrowser.prototype.makeTier = function (source, config) {\n    try {\n        return this.realMakeTier(source, config);\n    } catch (e) {\n        console.log('Error initializing', source);\n        console.log(e.stack || e);\n    }\n};\n\nBrowser.prototype.realMakeTier = function (source, config) {\n    var thisB = this;\n    var background = null;\n    if (this.tierBackgroundColors) {\n        background = this.tierBackgroundColors[this.tiers.length % this.tierBackgroundColors.length];\n    }\n\n    var tier = new DasTier(this, source, config, background);\n    tier.oorigin = this.viewStart;\n\n    var isDragging = false;\n    var dragOrigin, dragMoveOrigin;\n    var hoverTimeout;\n\n    var featureLookup = function featureLookup(rx, ry) {\n        var st = tier.subtiers;\n        if (!st) {\n            return;\n        }\n\n        var sti = 0;\n        ry -= tier.padding;;\n        while (sti < st.length && ry > st[sti].height && sti < st.length - 1) {\n            ry = ry - st[sti].height - tier.padding;\n            ++sti;\n        }\n        if (sti >= st.length) {\n            return;\n        }\n\n        var glyphs = st[sti].glyphs;\n        var viewCenter = (thisB.viewStart + thisB.viewEnd) / 2;\n        var offset = (tier.glyphCacheOrigin - thisB.viewStart) * thisB.scale;\n        rx -= offset;\n\n        return glyphLookup(glyphs, rx, ry);\n    };\n\n    var dragMoveHandler = function dragMoveHandler(ev) {\n        ev.preventDefault();ev.stopPropagation();\n        var rx = ev.clientX;\n        if (rx != dragMoveOrigin) {\n            thisB.move(rx - dragMoveOrigin, true);\n            dragMoveOrigin = rx;\n        }\n        thisB.isDragging = true;\n    };\n\n    var dragUpHandler = function dragUpHandler(ev) {\n        window.removeEventListener('mousemove', dragMoveHandler, true);\n        window.removeEventListener('mouseup', dragUpHandler, true);\n        thisB.move(ev.clientX - dragMoveOrigin); // Snap back (FIXME: consider animation)\n    };\n\n    tier.viewport.addEventListener('mousedown', function (ev) {\n        thisB.browserHolder.focus();\n        ev.preventDefault();\n        var br = tier.row.getBoundingClientRect();\n        var rx = ev.clientX,\n            ry = ev.clientY;\n\n        window.addEventListener('mousemove', dragMoveHandler, true);\n        window.addEventListener('mouseup', dragUpHandler, true);\n        dragOrigin = dragMoveOrigin = rx;\n        thisB.isDragging = false; // Not dragging until a movement event arrives.\n    }, false);\n\n    tier.viewport.addEventListener('mousemove', function (ev) {\n        var br = tier.row.getBoundingClientRect();\n        var rx = ev.clientX - br.left,\n            ry = ev.clientY - br.top;\n\n        var hit = featureLookup(rx, ry);\n        if (hit && hit.length > 0) {\n            tier.row.style.cursor = 'pointer';\n        } else {\n            tier.row.style.cursor = 'default';\n        }\n\n        if (hoverTimeout) {\n            clearTimeout(hoverTimeout);\n        }\n\n        if (isDragging) {\n            // if (tier.dasSource.tier_type !== 'sequence' && rx != dragMoveOrigin) {\n            //    thisB.move((rx - dragMoveOrigin));\n            //    dragMoveOrigin = rx;\n            // }\n        } else {\n            hoverTimeout = setTimeout(function () {\n                var hit = featureLookup(rx, ry);\n                if (hit && hit.length > 0) {\n                    thisB.notifyFeatureHover(ev, hit[hit.length - 1], hit, tier);\n                }\n            }, 1000);\n        }\n    });\n\n    var doubleClickTimeout = null;\n    tier.viewport.addEventListener('mouseup', function (ev) {\n        var br = tier.row.getBoundingClientRect();\n        var rx = ev.clientX - br.left,\n            ry = ev.clientY - br.top;\n\n        var hit = featureLookup(rx, ry);\n        if (hit && hit.length > 0 && !thisB.isDragging) {\n            if (doubleClickTimeout) {\n                clearTimeout(doubleClickTimeout);\n                doubleClickTimeout = null;\n                thisB.featureDoubleClick(hit, rx, ry);\n            } else {\n                doubleClickTimeout = setTimeout(function () {\n                    doubleClickTimeout = null;\n                    thisB.notifyFeature(ev, hit[hit.length - 1], hit, tier);\n                }, 500);\n            }\n        }\n\n        if (thisB.isDragging && rx != dragOrigin && tier.sequenceSource) {\n            var a = thisB.viewStart + rx / thisB.scale;\n            var b = thisB.viewStart + dragOrigin / thisB.scale;\n\n            var min, max;\n            if (a < b) {\n                min = a | 0;max = b | 0;\n            } else {\n                min = b | 0;max = a | 0;\n            }\n\n            thisB.notifyRegionSelect(thisB.chr, min, max);\n        }\n        thisB.isDragging = false;\n    }, false);\n\n    tier.viewport.addEventListener('mouseout', function (ev) {\n        isDragging = false;\n    });\n\n    tier.removeButton.addEventListener('click', function (ev) {\n        ev.stopPropagation();ev.preventDefault();\n        for (var ti = 0; ti < thisB.tiers.length; ++ti) {\n            if (thisB.tiers[ti] === tier) {\n                thisB.removeTier({ index: ti });\n                break;\n            }\n        }\n    }, false);\n    tier.nameButton.addEventListener('click', function (ev) {\n        ev.stopPropagation();ev.preventDefault();\n\n        if (ev.shiftKey) {\n            var hitTier = -1;\n            for (var ti = 0; ti < thisB.tiers.length; ++ti) {\n                if (thisB.tiers[ti] === tier) {\n                    hitTier = ti;\n                    break;\n                }\n            }\n            if (hitTier >= 0) {\n                var i = thisB.selectedTiers.indexOf(hitTier);\n                if (i >= 0) {\n                    thisB.selectedTiers.splice(i, 1);\n                } else {\n                    thisB.selectedTiers.push(hitTier);\n                    thisB.selectedTiers.sort();\n                }\n                thisB.markSelectedTiers();\n                thisB.notifyTierSelection();\n\n                if (thisB.selectedTiers.length > 0) {\n                    thisB.browserHolder.focus();\n                } else {\n                    thisB.notifyTierSelectionWrap(-1);\n                }\n            }\n        } else {\n            for (var ti = 0; ti < thisB.tiers.length; ++ti) {\n                if (thisB.tiers[ti] === tier) {\n                    thisB.browserHolder.focus();\n                    if (thisB.selectedTiers.length != 1 || thisB.selectedTiers[0] != ti) {\n                        thisB.setSelectedTier(ti);\n                        return;\n                    }\n                }\n            }\n\n            if (!tier.infoVisible) {\n                tier.infoElement.style.display = 'block';\n                tier.updateHeight();\n                tier.infoVisible = true;\n            } else {\n                tier.infoElement.style.display = 'none';\n                tier.updateHeight();\n                tier.infoVisible = false;\n            }\n        }\n    }, false);\n    tier.bumpButton.addEventListener('click', function (ev) {\n        ev.stopPropagation();ev.preventDefault();\n        var bumpStatus;\n        var t = tier;\n        if (t.dasSource.collapseSuperGroups) {\n            if (bumpStatus === undefined) {\n                bumpStatus = !t.bumped;\n            }\n            t.mergeConfig({ bumped: bumpStatus });\n        }\n    }, false);\n\n    var dragLabel;\n    var dragTierHolder;\n    var dragTierHolderScrollLimit;\n    var tierOrdinal;\n    var yAtLastReorder;\n    var tiersWereReordered = false;\n\n    var labelDragHandler = function labelDragHandler(ev) {\n        var label = tier.label;\n\n        ev.stopPropagation();ev.preventDefault();\n        if (!dragLabel) {\n            if (tier.pinned) {\n                dragTierHolder = thisB.pinnedTierHolder;\n            } else {\n                dragTierHolder = thisB.tierHolder;\n            }\n            dragTierHolderScrollLimit = dragTierHolder.scrollHeight - dragTierHolder.offsetHeight;\n\n            dragLabel = label.cloneNode(true);\n            dragLabel.style.cursor = 'pointer';\n            dragTierHolder.appendChild(dragLabel);\n            label.style.visibility = 'hidden';\n\n            for (var ti = 0; ti < thisB.tiers.length; ++ti) {\n                if (thisB.tiers[ti] === tier) {\n                    tierOrdinal = ti;\n                    break;\n                }\n            }\n\n            yAtLastReorder = ev.clientY;\n        }\n\n        var holderBCR = dragTierHolder.getBoundingClientRect();\n        dragLabel.style.left = label.getBoundingClientRect().left - holderBCR.left + 'px';\n        dragLabel.style.top = ev.clientY - holderBCR.top + dragTierHolder.scrollTop - 10 + 'px';\n\n        var pty = ev.clientY - holderBCR.top + dragTierHolder.scrollTop;\n        for (var ti = 0; ti < thisB.tiers.length; ++ti) {\n            var tt = thisB.tiers[ti];\n            if (tt.pinned ^ tier.pinned) continue;\n\n            var ttr = tt.row.getBoundingClientRect();\n            pty -= ttr.bottom - ttr.top;\n            if (pty < 0) {\n                if (ti < tierOrdinal && ev.clientY < yAtLastReorder || ti > tierOrdinal && ev.clientY > yAtLastReorder) {\n                    thisB.withPreservedSelection(function () {\n                        thisB.tiers.splice(tierOrdinal, 1);\n                        thisB.tiers.splice(ti, 0, tier);\n                        thisB._ensureTiersGrouped(ti > tierOrdinal);\n                    });\n\n                    for (var tix = 0; tix < thisB.tiers.length; ++tix) {\n                        if (thisB.tiers[tix] == tier) tierOrdinal = tix;\n                    }yAtLastReorder = ev.clientY;\n                    thisB.reorderTiers();\n                    dragTierHolder.appendChild(dragLabel); // Because reorderTiers removes all children.\n                    tiersWereReordered = true;\n                }\n                break;\n            }\n        }\n\n        if (dragLabel.offsetTop < dragTierHolder.scrollTop) {\n            dragTierHolder.scrollTop -= dragTierHolder.scrollTop - dragLabel.offsetTop;\n        } else if (dragLabel.offsetTop + dragLabel.offsetHeight > dragTierHolder.scrollTop + dragTierHolder.offsetHeight) {\n            dragTierHolder.scrollTop = Math.min(dragTierHolder.scrollTop + (dragLabel.offsetTop + dragLabel.offsetHeight) - (dragTierHolder.scrollTop + dragTierHolder.offsetHeight), dragTierHolderScrollLimit);\n        }\n    };\n\n    var labelReleaseHandler = function labelReleaseHandler(ev) {\n        var label = tier.label;\n\n        ev.stopPropagation();ev.preventDefault();\n        if (dragLabel) {\n            dragLabel.style.cursor = 'auto';\n            dragTierHolder.removeChild(dragLabel);\n            dragLabel = null;\n            label.style.visibility = 'visible';\n        }\n        document.removeEventListener('mousemove', labelDragHandler, false);\n        document.removeEventListener('mouseup', labelReleaseHandler, false);\n\n        if (tiersWereReordered) {\n            for (var ti = 0; ti < thisB.tiers.length; ++ti) {\n                if (thisB.tiers[ti] == tier) {\n                    thisB.setSelectedTier(ti);\n                    break;\n                }\n            }\n            thisB.notifyTier(\"reordered\", tier);\n        }\n    };\n\n    tier.label.addEventListener('mousedown', function (ev) {\n        ev.stopPropagation();ev.preventDefault();\n        tiersWereReordered = false;\n        document.addEventListener('mousemove', labelDragHandler, false);\n        document.addEventListener('mouseup', labelReleaseHandler, false);\n    }, false);\n\n    this.tiers.push(tier); // NB this currently tells any extant knownSpace about the new tier.\n\n    // fetches stylesheet\n    return tier.init().then(function (updatedTier) {\n        updatedTier.currentlyHeight = 50;\n        thisB.updateHeight();\n        updatedTier.updateLabel();\n\n        thisB.withPreservedSelection(thisB._ensureTiersGrouped);\n        updatedTier._updateFromConfig();\n        thisB.reorderTiers();\n\n        return updatedTier;\n    });\n};\n\nBrowser.prototype.reorderTiers = function () {\n    removeChildren(this.tierHolder);\n    removeChildren(this.pinnedTierHolder);\n    if (this.disablePinning) {\n        this.tierHolder.appendChild(this.ruler);\n        this.tierHolder.appendChild(this.ruler2);\n    }\n    var hasPinned = false;\n    var pinnedTiers = [],\n        unpinnedTiers = [];\n    for (var i = 0; i < this.tiers.length; ++i) {\n        var t = this.tiers[i];\n        var visible = ['sub', 'dummy'].indexOf(this.tiers[i].dasSource.renderer) === -1;\n        if (t.pinned && !this.disablePinning) {\n            pinnedTiers.push(t);\n            if (visible) this.pinnedTierHolder.appendChild(this.tiers[i].row);\n            hasPinned = true;\n        } else {\n            unpinnedTiers.push(t);\n            if (visible) this.tierHolder.appendChild(this.tiers[i].row);\n        }\n    }\n\n    this.withPreservedSelection(function () {\n        this.tiers.splice(0, this.tiers.length);\n        for (var i = 0; i < pinnedTiers.length; ++i) {\n            this.tiers.push(pinnedTiers[i]);\n        }for (var i = 0; i < unpinnedTiers.length; ++i) {\n            this.tiers.push(unpinnedTiers[i]);\n        }\n    });\n\n    if (hasPinned) this.pinnedTierHolder.classList.add('tier-holder-pinned-full');else this.pinnedTierHolder.classList.remove('tier-holder-pinned-full');\n\n    this.arrangeTiers();\n};\n\nBrowser.prototype.withPreservedSelection = function (f) {\n    var st = [];\n    for (var xi = 0; xi < this.selectedTiers.length; ++xi) {\n        st.push(this.tiers[this.selectedTiers[xi]]);\n    }\n\n    f.call(this);\n\n    this.selectedTiers = [];\n    for (var sti = 0; sti < this.tiers.length; ++sti) {\n        if (st.indexOf(this.tiers[sti]) >= 0) this.selectedTiers.push(sti);\n    }\n};\n\nBrowser.prototype.refreshTier = function (tier, tierCallback) {\n    var renderer = this.getTierRenderer(tier);\n    if (tier.dasSource.renderer === 'multi') {\n        renderer.drawTier(tier);\n    } else {\n        var renderCallback = tierCallback || renderer.renderTier;\n        if (this.knownSpace) {\n            this.knownSpace.invalidate(tier, renderCallback);\n        }\n    }\n};\n\nBrowser.prototype.getTierRenderer = function (tier) {\n    var renderer = tier.dasSource.renderer || this.defaultRenderer;\n    if (typeof renderer === 'string') {\n        return this.renderers[renderer];\n    } else if (typeof renderer.renderTier === 'function' && typeof renderer.drawTier === 'function') {\n        return renderer;\n    } else {\n        console.log(\"Tier doesn't have a renderer\");\n    }\n};\n\n/* Internal use only, assumes selection is being managed elsewhere... */\n\nBrowser.prototype._ensureTiersGrouped = function (down) {\n    var groupedTiers = {};\n    for (var ti = 0; ti < this.tiers.length; ++ti) {\n        var t = this.tiers[ti];\n        if (t.dasSource.tierGroup) {\n            pusho(groupedTiers, t.dasSource.tierGroup, t);\n        }\n    }\n\n    var newTiers = [];\n    if (down) this.tiers.reverse();\n    for (var ti = 0; ti < this.tiers.length; ++ti) {\n        var t = this.tiers[ti];\n        if (t.dasSource.tierGroup) {\n            var nt = groupedTiers[t.dasSource.tierGroup];\n            if (nt) {\n                if (down) nt.reverse();\n                for (var nti = 0; nti < nt.length; ++nti) {\n                    newTiers.push(nt[nti]);\n                }groupedTiers[t.dasSource.tierGroup] = null;\n            }\n        } else {\n            newTiers.push(t);\n        }\n    }\n    if (down) newTiers.reverse();\n    this.tiers.splice(0, this.tiers.length);\n    for (var nti = 0; nti < newTiers.length; ++nti) {\n        this.tiers.push(newTiers[nti]);\n    }\n};\n\nBrowser.prototype.arrangeTiers = function () {\n    var arrangedTiers = [];\n    var groupedTiers = {};\n\n    for (var ti = 0; ti < this.tiers.length; ++ti) {\n        var t = this.tiers[ti];\n        if (t.pinned) {\n            arrangedTiers.push(t);\n            if (t.dasSource.tierGroup) {\n                pusho(groupedTiers, t.dasSource.tierGroup, t);\n            }\n        }\n    }\n    for (var ti = 0; ti < this.tiers.length; ++ti) {\n        var t = this.tiers[ti];\n        if (!t.pinned) {\n            arrangedTiers.push(t);\n            if (t.dasSource.tierGroup) {\n                pusho(groupedTiers, t.dasSource.tierGroup, t);\n            }\n        }\n    }\n\n    for (var g in groupedTiers) {\n        var tiers = groupedTiers[g];\n        var tierGroup = this.tierGroups[g];\n        if (!tierGroup) {\n            tierGroup = {\n                element: makeElement('div', makeElement('span', g, { className: 'tier-group-label' }), { className: \"tier-group\" })\n            };\n            this.tierGroups[g] = tierGroup;\n        }\n\n        if (tierGroup.element.parentNode) tierGroup.element.parentNode.removeChild(tierGroup.element);\n\n        var holder = tiers[0].pinned ? this.pinnedTierHolder : this.tierHolder;\n        var min = 10000000,\n            max = 0;\n        for (var ti = 0; ti < tiers.length; ++ti) {\n            var row = tiers[ti].row;\n            min = Math.min(min, row.offsetTop);\n            max = Math.max(max, row.offsetTop + row.offsetHeight);\n        }\n        tierGroup.element.style.top = min + 'px';\n        tierGroup.element.style.left = '0px';\n        tierGroup.element.style.height = max - min + 'px';\n        holder.appendChild(tierGroup.element);\n    }\n\n    if (this.tierBackgroundColors) {\n        for (var ti = 0; ti < arrangedTiers.length; ++ti) {\n            var t = arrangedTiers[ti];\n            t.setBackground(this.tierBackgroundColors[ti % this.tierBackgroundColors.length]);\n            if (t.dasSource.tierGroup) t.label.style.left = '18px';else t.label.style.left = '2px';\n            t.background = this.tierBackgroundColors[ti % this.tierBackgroundColors.length];\n        }\n    }\n};\n\nBrowser.prototype.refresh = function () {\n    this.retrieveTierData(this.tiers);\n    this.drawOverlays();\n    this.positionRuler();\n};\n\nvar defaultTierRenderer = function defaultTierRenderer(status, tier) {\n    console.log(\"DEPRECATED!\");\n};\n\nBrowser.prototype.retrieveTierData = function (tiers) {\n    this.notifyLocation();\n    var width = this.viewEnd - this.viewStart + 1;\n    var minExtraW = this.minExtraWidth / this.scale | 0;\n    var maxExtraW = this.maxExtraWidth / this.scale | 0;\n\n    var newOrigin = (this.viewStart + this.viewEnd) / 2;\n    var oh = newOrigin - this.origin;\n    this.origin = newOrigin;\n    this.scaleAtLastRedraw = this.scale;\n    for (var t = 0; t < tiers.length; ++t) {\n        var od = oh;\n        if (tiers[t].originHaxx) {\n            od += tiers[t].originHaxx;\n        }\n        tiers[t].originHaxx = od;\n    }\n\n    var scaledQuantRes = this.targetQuantRes / this.scale;\n\n    var innerDrawnStart = Math.max(1, (this.viewStart | 0) - minExtraW);\n    var innerDrawnEnd = Math.min((this.viewEnd | 0) + minExtraW, (this.currentSeqMax | 0) > 0 ? this.currentSeqMax | 0 : 1000000000);\n    var outerDrawnStart = Math.max(1, (this.viewStart | 0) - maxExtraW);\n    var outerDrawnEnd = Math.min((this.viewEnd | 0) + maxExtraW, (this.currentSeqMax | 0) > 0 ? this.currentSeqMax | 0 : 1000000000);\n\n    if (!this.knownSpace || this.knownSpace.chr !== this.chr) {\n        var ss = this.getSequenceSource();\n        if (this.knownSpace) this.knownSpace.cancel();\n        // known space is created based on the entire tier list, for future caching purposes, even if only a subset of the tiers are needed to be rendered now.\n        this.knownSpace = new KnownSpace(this.tiers, this.chr, outerDrawnStart, outerDrawnEnd, scaledQuantRes, ss);\n    }\n\n    var seg = this.knownSpace.bestCacheOverlapping(this.chr, innerDrawnStart, innerDrawnEnd);\n    if (seg && seg.min <= innerDrawnStart && seg.max >= innerDrawnEnd) {\n        this.drawnStart = Math.max(seg.min, outerDrawnStart);\n        this.drawnEnd = Math.min(seg.max, outerDrawnEnd);\n    } else {\n        this.drawnStart = outerDrawnStart;\n        this.drawnEnd = outerDrawnEnd;\n    }\n    // send in the subset of tiers to retrieve.\n    this.knownSpace.retrieveFeatures(tiers, this.chr, this.drawnStart, this.drawnEnd, scaledQuantRes);\n};\n\nfunction setSources(msh, availableSources, maybeMapping) {\n    if (maybeMapping) {\n        for (var s = 0; s < availableSources.length; ++s) {\n            availableSources[s].mapping = maybeMapping;\n        }\n    }\n    msh.set(availableSources);\n}\n\nBrowser.prototype.queryRegistry = function (maybeMapping, tryCache) {\n    if (!this.registry) return;\n\n    var thisB = this;\n    var coords, msh;\n    if (maybeMapping) {\n        coords = this.chains[maybeMapping].coords;\n        if (!thisB.mappableSources[maybeMapping]) {\n            thisB.mappableSources[maybeMapping] = new Observed();\n        }\n        msh = thisB.mappableSources[maybeMapping];\n    } else {\n        coords = this.coordSystem;\n        msh = this.availableSources;\n    }\n    var cacheHash = hex_sha1(miniJSONify(coords));\n    if (tryCache) {\n        var cacheTime = localStorage['dalliance.registry.' + cacheHash + '.last_queried'];\n        if (cacheTime) {\n            try {\n                setSources(msh, JSON.parse(localStorage['dalliance.registry.' + cacheHash + '.sources']), maybeMapping);\n                var cacheAge = (Date.now() | 0) - (cacheTime | 0);\n                if (cacheAge < 12 * 60 * 60 * 1000) {\n                    return;\n                }\n            } catch (rex) {\n                console.log('Bad registry cache: ' + rex);\n            }\n        }\n    }\n\n    var rurl = this.registry;\n    if (rurl.indexOf('//') == 0) {\n        var proto = window.location.protocol;\n        if (proto != 'https:' && proto != 'http:') rurl = 'http:' + rurl;\n    }\n    new DASRegistry(rurl).sources(function (sources) {\n        var availableSources = [];\n        for (var s = 0; s < sources.length; ++s) {\n            var source = sources[s];\n            if (!source.coords || source.coords.length == 0) {\n                continue;\n            }\n            var scoords = source.coords[0];\n            if (scoords.taxon != coords.taxon || scoords.auth != coords.auth || scoords.version != coords.version) {\n                continue;\n            }\n            availableSources.push(source);\n        }\n\n        localStorage['dalliance.registry.' + cacheHash + '.sources'] = JSON.stringify(availableSources);\n        localStorage['dalliance.registry.' + cacheHash + '.last_queried'] = '' + Date.now();\n\n        setSources(msh, availableSources, maybeMapping);\n    }, function (error) {\n        // msh.set(null);\n    }, coords);\n};\n\n//\n// Navigation\n//\n\nBrowser.prototype.move = function (pos, soft) {\n    var wid = this.viewEnd - this.viewStart;\n    var nStart = this.viewStart - 1.0 * pos / this.scale;\n    var nEnd = nStart + wid;\n\n    if (!soft) {\n        if (this.currentSeqMax > 0 && nEnd > this.currentSeqMax) {\n            nEnd = this.currentSeqMax;\n            nStart = this.viewEnd - wid;\n        }\n        if (nStart < 1) {\n            nStart = 1;\n            nEnd = nStart + wid;\n        }\n    }\n\n    this.setLocation(null, nStart, nEnd, null, soft);\n};\n\nBrowser.prototype.zoomStep = function (delta) {\n    var oz = 1.0 * this.zoomSliderValue;\n    var nz = oz + delta;\n    if (nz < this.zoomMin) {\n        nz = this.zoomMin;\n    }\n    if (nz > this.zoomMax) {\n        nz = this.zoomMax;\n    }\n\n    if (nz != oz) {\n        this.zoomSliderValue = nz; // FIXME maybe ought to set inside zoom!\n        this.zoom(Math.exp(1.0 * nz / this.zoomExpt));\n    }\n};\n\nBrowser.prototype.zoom = function (factor) {\n    this.zoomFactor = factor;\n    var viewCenter = Math.round((this.viewStart + this.viewEnd) / 2.0) | 0;\n    this.viewStart = viewCenter - this.zoomBase * this.zoomFactor / 2;\n    this.viewEnd = viewCenter + this.zoomBase * this.zoomFactor / 2;\n    if (this.currentSeqMax > 0 && this.viewEnd > this.currentSeqMax + 5) {\n        var len = this.viewEnd - this.viewStart + 1;\n        this.viewEnd = this.currentSeqMax;\n        this.viewStart = this.viewEnd - len + 1;\n    }\n    if (this.viewStart < 1) {\n        var len = this.viewEnd - this.viewStart + 1;\n        this.viewStart = 1;\n        this.viewEnd = this.viewStart + len - 1;\n    }\n    this.scale = this.featurePanelWidth / (this.viewEnd - this.viewStart);\n    var width = this.viewEnd - this.viewStart + 1;\n\n    var scaleRat = this.scale / this.scaleAtLastRedraw;\n\n    this.notifyLocation();\n    this.refresh();\n};\n\nBrowser.prototype.spaceCheck = function (dontRefresh) {\n    if (!this.knownSpace || this.knownSpace.chr !== this.chr) {\n        this.refresh();\n        return;\n    }\n\n    var width = (this.viewEnd - this.viewStart | 0) + 1;\n    var minExtraW = this.minExtraWidth / this.scale | 0;\n    var maxExtraW = this.maxExtraWidth / this.scale | 0;\n\n    if ((this.drawnStart | 0) > Math.max(1, (this.viewStart | 0) - minExtraW | 0) || (this.drawnEnd | 0) < Math.min((this.viewEnd | 0) + minExtraW, (this.currentSeqMax | 0) > 0 ? this.currentSeqMax | 0 : 1000000000)) {\n        this.refresh();\n    }\n};\n\nBrowser.prototype.resizeViewer = function (skipRefresh) {\n    var width = this.tierHolder.getBoundingClientRect().width | 0;\n    if (width == 0) return;\n\n    var oldFPW = Math.max(this.featurePanelWidth, 300); // Can get silly values stored\n    // when the browser is hidden.\n    this.featurePanelWidth = width | 0;\n\n    if (oldFPW != this.featurePanelWidth) {\n        this.zoomMax = this.zoomExpt * Math.log(this.maxViewWidth / this.zoomBase);\n        this.zoomMin = this.zoomExpt * Math.log(this.featurePanelWidth / this.maxPixelsPerBase / this.zoomBase); // FIXME hard-coded minimum.\n        this.zoomSliderValue = this.zoomExpt * Math.log((this.viewEnd - this.viewStart + 1) / this.zoomBase);\n\n        var viewWidth = this.viewEnd - this.viewStart;\n        var nve = this.viewStart + viewWidth * this.featurePanelWidth / oldFPW;\n\n        this.viewEnd = nve;\n\n        var wid = this.viewEnd - this.viewStart + 1;\n        if (this.currentSeqMax > 0 && this.viewEnd > this.currentSeqMax) {\n            this.viewEnd = this.currentSeqMax;\n            this.viewStart = this.viewEnd - wid + 1;\n        }\n        if (this.viewStart < 1) {\n            this.viewStart = 1;\n            this.viewEnd = this.viewStart + wid - 1;\n        }\n\n        this.positionRuler();\n\n        if (!skipRefresh) {\n            this.spaceCheck();\n        }\n        this.notifyLocation();\n    }\n\n    if (this.fullScreen) {\n        this.setFullScreenHeight();\n    }\n};\n\nBrowser.prototype.setFullScreenHeight = function () {\n    var rest = document.body.offsetHeight - this.browserHolder.offsetHeight;\n    this.browserHolder.style.maxHeight = Math.max(300, window.innerHeight - rest - 20) + 'px';\n};\n\nBrowser.prototype.addTier = function (conf) {\n    var thisB = this;\n    conf = shallowCopy(conf);\n    conf.disabled = false;\n\n    return this.makeTier(conf).then(function (tier) {\n        thisB.refreshTier(tier);\n        thisB.markSelectedTiers();\n        thisB.positionRuler();\n        thisB.notifyTier(\"added\", tier);\n        return tier;\n    });\n};\n\nBrowser.prototype.removeTier = function (conf, force) {\n    var target = -1;\n\n    if (typeof conf.index !== 'undefined' && conf.index >= 0 && conf.index < this.tiers.length) {\n        target = conf.index;\n    } else {\n        for (var ti = 0; ti < this.tiers.length; ++ti) {\n            var ts = this.tiers[ti].dasSource;\n\n            if (sourcesAreEqual(conf, ts)) {\n                target = ti;break;\n            }\n        }\n    }\n\n    if (target < 0) {\n        throw \"Couldn't find requested tier\";\n    }\n\n    var targetTier = this.tiers[target];\n    this.tiers.splice(target, 1);\n\n    var nst = [];\n    for (var sti = 0; sti < this.selectedTiers.length; ++sti) {\n        var st = this.selectedTiers[sti];\n        if (st < target) {\n            nst.push(st);\n        } else if (st > target) {\n            nst.push(st - 1);\n        }\n    }\n    this.selectedTiers = nst;\n    this.markSelectedTiers();\n\n    targetTier.destroy();\n    if (this.knownSpace) {\n        this.knownSpace.featureCache[targetTier] = null;\n    }\n\n    this.reorderTiers();\n    this.notifyTier(\"removed\", targetTier);\n};\n\nBrowser.prototype.removeAllTiers = function () {\n    var thisB = this;\n    this.selectedTiers = [];\n    this.markSelectedTiers();\n    this.tiers.forEach(function (targetTier) {\n        targetTier.destroy();\n        if (thisB.knownSpace) {\n            thisB.knownSpace.featureCache[targetTier] = null;\n        }\n    });\n    this.tiers.length = 0;\n    this.reorderTiers();\n    this.notifyTier(\"removedAll\", null);\n};\n\nBrowser.prototype.getSequenceSource = function () {\n    if (this._sequenceSource === undefined) this._sequenceSource = this._getSequenceSource();\n    return this._sequenceSource;\n};\n\nBrowser.prototype._getSequenceSource = function () {\n    for (var ti = 0; ti < this.tiers.length; ++ti) {\n        if (this.tiers[ti].sequenceSource) {\n            return this.tiers[ti].sequenceSource;\n        }\n    }\n\n    for (var si = 0; si < this.defaultSources.length; ++si) {\n        var s = this.defaultSources[si];\n        if (s.provides_entrypoints || s.tier_type == 'sequence' || s.twoBitURI || s.twoBitBlob) {\n            if (s.twoBitURI || s.twoBitBlob) {\n                return new TwoBitSequenceSource(s);\n            } else if (s.ensemblURI) {\n                return new EnsemblSequenceSource(s);\n            } else {\n                return new DASSequenceSource(s);\n            }\n        }\n    }\n};\n\nBrowser.prototype.setLocation = function (newChr, newMin, newMax, callback, soft) {\n    if (typeof newMin !== 'number') {\n        throw Error('minimum must be a number (got ' + JSON.stringify(newMin) + ')');\n    }\n    if (typeof newMax !== 'number') {\n        throw Error('maximum must be a number (got ' + JSON.stringify(newMax) + ')');\n    }\n\n    if (newMin > newMax) {\n        var oldNewMin = newMin;\n        newMin = newMax;\n        newMax = oldNewMin;\n    } else if (newMin === newMax) {\n        newMax += 1;\n    }\n\n    if (!callback) {\n        callback = function callback(err) {\n            if (err) {\n                throw err;\n            }\n        };\n    }\n    var thisB = this;\n\n    if ((!newChr || newChr == this.chr) && this.currentSeqMax > 0) {\n        return this._setLocation(null, newMin, newMax, null, callback, soft);\n    } else {\n        var ss = this.getSequenceSource();\n        if (!ss) {\n            return callback('Need a sequence source');\n        }\n\n        var findChr = newChr || this.chr;\n        ss.getSeqInfo(findChr, function (si) {\n            if (!si) {\n                var altChr;\n                if (findChr.indexOf('chr') == 0) {\n                    altChr = findChr.substr(3);\n                } else {\n                    altChr = 'chr' + findChr;\n                }\n                ss.getSeqInfo(altChr, function (si2) {\n                    if (!si2 && newChr) {\n                        return callback(\"Couldn't find sequence '\" + newChr + \"'\");\n                    } else if (!si2) {\n                        return thisB._setLocation(null, newMin, newMax, null, callback, soft);\n                    } else {\n                        return thisB._setLocation(altChr, newMin, newMax, si2, callback, soft);\n                    }\n                });\n            } else {\n                return thisB._setLocation(newChr, newMin, newMax, si, callback, soft);\n            }\n        });\n    }\n};\n\nBrowser.prototype._setLocation = function (newChr, newMin, newMax, newChrInfo, callback, soft) {\n    var chrChanged = false;\n    if (newChr) {\n        if (newChr.indexOf('chr') == 0) newChr = newChr.substring(3);\n\n        if (this.chr != newChr) chrChanged = true;\n        this.chr = newChr;\n        this.currentSeqMax = newChrInfo.length;\n    }\n\n    newMin = parseFloat(newMin);newMax = parseFloat(newMax);\n\n    var newWidth = Math.max(10, newMax - newMin + 1);\n\n    if (!soft) {\n        var csm = this.currentSeqMax;\n        if (csm <= 0) csm = 1000000000000;\n        if (newMin < 1) {\n            newMin = 1;newMax = newMin + newWidth - 1;\n        }\n        if (newMax > csm) {\n            newMax = csm;\n            newMin = Math.max(1, newMax - newWidth + 1);\n        }\n    }\n\n    this.viewStart = newMin;\n    this.viewEnd = newMax;\n    var newScale = Math.max(this.featurePanelWidth || this.offscreenInitWidth, 50) / (this.viewEnd - this.viewStart);\n    var oldScale = this.scale;\n    var scaleChanged = Math.abs(newScale - oldScale) > 0.000001;\n    this.scale = newScale;\n\n    var newZS, oldZS;\n    oldZS = this.zoomSliderValue;\n    this.zoomSliderValue = newZS = this.zoomExpt * Math.log((this.viewEnd - this.viewStart + 1) / this.zoomBase);\n\n    if (scaleChanged || chrChanged) {\n        for (var i = 0; i < this.tiers.length; ++i) {\n            this.tiers[i].viewportHolder.style.left = '5000px';\n            this.tiers[i].overlay.style.left = '5000px';\n        }\n\n        this.refresh();\n        // var self = this;\n        // this.tiers.forEach(function(tier) {self.refreshTier(tier);});\n        // this.refreshTier\n\n        if (this.savedZoom) {\n            newZS -= this.zoomMin;\n            oldZS -= this.zoomMin;\n            var difToActive = newZS - oldZS;\n            var difToSaved = newZS - this.savedZoom;\n            if (Math.abs(difToActive) > Math.abs(difToSaved)) {\n                this.isSnapZooming = !this.isSnapZooming;\n                this.savedZoom = oldZS;\n            }\n        } else {\n            this.isSnapZooming = false;\n            this.savedZoom = null;\n        }\n    } else {\n        var viewCenter = (this.viewStart + this.viewEnd) / 2;\n\n        for (var i = 0; i < this.tiers.length; ++i) {\n            var offset = (this.viewStart - this.tiers[i].norigin) * this.scale;\n            this.tiers[i].viewportHolder.style.left = '' + ((-offset | 0) - 1000) + 'px';\n            this.tiers[i].drawOverlay();\n        }\n    }\n\n    this.notifyLocation();\n\n    this.spaceCheck();\n    if (this.instrumentActivity) this.activityStartTime = Date.now() | 0;\n    return callback();\n};\n\nBrowser.prototype.setCenterLocation = function (newChr, newCenterLoc) {\n    var halfWidth = (this.viewEnd - this.viewStart) / 2,\n        newMin = newCenterLoc - halfWidth,\n        newMax = newCenterLoc + halfWidth;\n    this.setLocation(newChr, newMin, newMax);\n};\n\nBrowser.prototype.pingActivity = function () {\n    if (!this.instrumentActivity || !this.activityStartTime) return;\n\n    var activity = 0;\n    for (var ti = 0; ti < this.tiers.length; ++ti) {\n        if (this.tiers[ti].loaderButton.style.display !== 'none') ++activity;\n    }\n\n    if (activity == 0) {\n        var now = Date.now() | 0;\n        console.log('Loading took ' + (now - this.activityStartTime) + 'ms');\n        this.activityStartTime = null;\n    }\n};\n\nBrowser.prototype.addInitListener = function (handler) {\n    this.initListeners.push(handler);\n};\n\nBrowser.prototype.addFeatureListener = function (handler, opts) {\n    opts = opts || {};\n    this.featureListeners.push(handler);\n};\n\nBrowser.prototype.removeFeatureListener = function (handler, opts) {\n    var idx = arrayIndexOf(this.featureListeners, handler);\n    if (idx >= 0) {\n        this.featureListeners.splice(idx, 1);\n    }\n};\n\nBrowser.prototype.notifyFeature = function (ev, feature, hit, tier) {\n    for (var fli = 0; fli < this.featureListeners.length; ++fli) {\n        try {\n            if (this.featureListeners[fli](ev, feature, hit, tier)) return;\n        } catch (ex) {\n            console.log(ex.stack);\n        }\n    }\n};\n\nBrowser.prototype.addFeatureHoverListener = function (handler, opts) {\n    opts = opts || {};\n    this.featureHoverListeners.push(handler);\n};\n\nBrowser.prototype.removeFeatureHoverListener = function (handler, opts) {\n    var idx = arrayIndexOf(this.featureHoverListeners, handler);\n    if (idx >= 0) {\n        this.featureHoverListeners.splice(idx, 1);\n    }\n};\n\nBrowser.prototype.notifyFeatureHover = function (ev, feature, hit, tier) {\n    for (var fli = 0; fli < this.featureHoverListeners.length; ++fli) {\n        try {\n            this.featureHoverListeners[fli](ev, feature, hit, tier);\n        } catch (ex) {\n            console.log(ex.stack);\n        }\n    }\n};\n\nBrowser.prototype.addViewListener = function (handler, opts) {\n    opts = opts || {};\n    this.viewListeners.push(handler);\n};\n\nBrowser.prototype.removeViewListener = function (handler, opts) {\n    var idx = arrayIndexOf(this.viewListeners, handler);\n    if (idx >= 0) {\n        this.viewListeners.splice(idx, 1);\n    }\n};\n\nBrowser.prototype.notifyLocation = function () {\n    var nvs = Math.max(1, this.viewStart | 0);\n    var nve = this.viewEnd | 0;\n    if (this.currentSeqMax > 0 && nve > this.currentSeqMax) nve = this.currentSeqMax;\n\n    for (var lli = 0; lli < this.viewListeners.length; ++lli) {\n        try {\n            this.viewListeners[lli](this.chr, nvs, nve, this.zoomSliderValue, { current: this.zoomSliderValue,\n                alternate: this.savedZoom + this.zoomMin || this.zoomMin,\n                isSnapZooming: this.isSnapZooming,\n                min: this.zoomMin,\n                max: this.zoomMax }, this.viewStart, this.viewEnd);\n        } catch (ex) {\n            console.log(ex.stack);\n        }\n    }\n};\n\nBrowser.prototype.addTierListener = function (handler) {\n    this.tierListeners.push(handler);\n};\n\nBrowser.prototype.removeTierListener = function (handler) {\n    var idx = arrayIndexOf(this.tierListeners, handler);\n    if (idx >= 0) {\n        this.tierListeners.splice(idx, 1);\n    }\n};\n\nBrowser.prototype.notifyTier = function (status, tier) {\n    for (var tli = 0; tli < this.tierListeners.length; ++tli) {\n        try {\n            this.tierListeners[tli](status, tier);\n        } catch (ex) {\n            console.log(ex.stack);\n        }\n    }\n};\n\nBrowser.prototype.addRegionSelectListener = function (handler) {\n    this.regionSelectListeners.push(handler);\n};\n\nBrowser.prototype.removeRegionSelectListener = function (handler) {\n    var idx = arrayIndexOf(this.regionSelectListeners, handler);\n    if (idx >= 0) {\n        this.regionSelectListeners.splice(idx, 1);\n    }\n};\n\nBrowser.prototype.notifyRegionSelect = function (chr, min, max) {\n    for (var rli = 0; rli < this.regionSelectListeners.length; ++rli) {\n        try {\n            this.regionSelectListeners[rli](chr, min, max);\n        } catch (ex) {\n            console.log(ex.stack);\n        }\n    }\n};\n\nBrowser.prototype.highlightRegion = function (chr, min, max) {\n    var thisB = this;\n\n    if (chr == this.chr) {\n        return this._highlightRegion(chr, min, max);\n    }\n\n    var ss = this.getSequenceSource();\n    if (!ss) {\n        throw 'Need a sequence source';\n    }\n\n    ss.getSeqInfo(chr, function (si) {\n        if (!si) {\n            var altChr;\n            if (chr.indexOf('chr') == 0) {\n                altChr = chr.substr(3);\n            } else {\n                altChr = 'chr' + chr;\n            }\n            ss.getSeqInfo(altChr, function (si2) {\n                if (!si2) {\n                    // Fail silently.\n                } else {\n                    return thisB._highlightRegion(altChr, min, max);\n                }\n            });\n        } else {\n            return thisB._highlightRegion(chr, min, max);\n        }\n    });\n};\n\nBrowser.prototype._highlightRegion = function (chr, min, max) {\n    for (var hi = 0; hi < this.highlights.length; ++hi) {\n        var h = this.highlights[hi];\n        if (h.chr == chr && h.min == min && h.max == max) return;\n    }\n\n    this.highlights.push(new Region(chr, min, max));\n    var visStart = this.viewStart - 1000 / this.scale;\n    var visEnd = this.viewEnd + 1000 / this.scale;\n    if ((chr == this.chr || chr == 'chr' + this.chr) && min < visEnd && max > visStart) {\n        this.drawOverlays();\n    }\n\n    this.notifyLocation();\n};\n\nBrowser.prototype.clearHighlights = function () {\n    this.highlights = [];\n    this.drawOverlays();\n    this.notifyLocation();\n};\n\nBrowser.prototype.drawOverlays = function () {\n    for (var ti = 0; ti < this.tiers.length; ++ti) {\n        this.tiers[ti].drawOverlay();\n    }\n};\n\nBrowser.prototype.featuresInRegion = function (chr, min, max) {\n    var features = [];\n    if (chr !== this.chr) {\n        return [];\n    }\n\n    for (var ti = 0; ti < this.tiers.length; ++ti) {\n        var fl = this.tiers[ti].currentFeatures || [];\n        for (var fi = 0; fi < fl.length; ++fi) {\n            var f = fl[fi];\n            if (f.min <= max && f.max >= min) {\n                features.push(f);\n            }\n        }\n    }\n    return features;\n};\n\nBrowser.prototype.getSelectedTier = function () {\n    if (this.selectedTiers.length > 0) return this.selectedTiers[0];else return -1;\n};\n\nBrowser.prototype.setSelectedTier = function (t) {\n    if (t == null) {\n        this.selectedTiers = [];\n    } else {\n        this.selectedTiers = [t];\n    }\n    this.markSelectedTiers();\n    this.notifyTierSelection();\n};\n\nBrowser.prototype.markSelectedTiers = function () {\n    for (var ti = 0; ti < this.tiers.length; ++ti) {\n        var button = this.tiers[ti].nameButton;\n\n        if (this.selectedTiers.indexOf(ti) >= 0) {\n            button.classList.add('active');\n        } else {\n            button.classList.remove('active');\n        }\n    }\n    if (this.selectedTiers.length > 0) {\n        var browserMid = this.browserHolder.offsetTop + this.browserHolder.offsetHeight / 2;\n        if (browserMid > document.body.scrollTop && browserMid + 100 < document.body.scrollTop + window.innerHeight) this.browserHolder.focus();\n    }\n};\n\nBrowser.prototype.addTierSelectionListener = function (handler) {\n    this.tierSelectionListeners.push(handler);\n};\n\nBrowser.prototype.removeTierSelectionListener = function (handler) {\n    var idx = arrayIndexOf(this.tierSelectionListeners, handler);\n    if (idx >= 0) {\n        this.tierSelectionListeners.splice(idx, 1);\n    }\n};\n\nBrowser.prototype.notifyTierSelection = function () {\n    for (var fli = 0; fli < this.tierSelectionListeners.length; ++fli) {\n        try {\n            this.tierSelectionListeners[fli](this.selectedTiers);\n        } catch (ex) {\n            console.log(ex.stack);\n        }\n    }\n};\n\nBrowser.prototype.addTierSelectionWrapListener = function (f) {\n    this.tierSelectionWrapListeners.push(f);\n};\n\nBrowser.prototype.removeTierSelectionWrapListener = function (handler) {\n    var idx = arrayIndexOf(this.tierSelectionWrapListeners, handler);\n    if (idx >= 0) {\n        this.tierSelectionWrapListeners.splice(idx, 1);\n    }\n};\n\nBrowser.prototype.notifyTierSelectionWrap = function (i) {\n    for (var fli = 0; fli < this.tierSelectionWrapListeners.length; ++fli) {\n        try {\n            this.tierSelectionWrapListeners[fli](i);\n        } catch (ex) {\n            console.log(ex.stack);\n        }\n    }\n};\n\nBrowser.prototype.positionRuler = function () {\n    var display = 'none';\n    var left = '';\n    var right = '';\n\n    if (this.rulerLocation == 'center') {\n        display = 'block';\n        left = '' + (this.featurePanelWidth / 2 | 0) + 'px';\n    } else if (this.rulerLocation == 'left') {\n        display = 'block';\n        left = '0px';\n    } else if (this.rulerLocation == 'right') {\n        display = 'block';\n        right = '0px';\n    } else {\n        display = 'none';\n    }\n\n    this.ruler.style.display = display;\n    this.ruler.style.left = left;\n    this.ruler.style.right = right;\n\n    if (this.singleBaseHighlight) {\n        this.ruler2.style.display = 'block';\n        this.ruler2.style.borderWidth = '1px';\n        if (this.scale < 1) {\n            this.ruler2.style.width = '0px';\n            this.ruler2.style.borderRightWidth = '0px';\n        } else {\n            this.ruler2.style.width = this.scale + 'px';\n            this.ruler2.style.borderRightWidth = '1px';\n        }\n        // Position accompanying single base location text\n        this.locSingleBase.style.visibility = 'visible';\n        var centreOffset = this.featurePanelWidth / 2 - this.locSingleBase.offsetWidth / 2 + this.ruler2.offsetWidth / 2;\n        this.locSingleBase.style.left = '' + (centreOffset | 0) + 'px';\n    } else {\n        this.locSingleBase.style.visibility = 'hidden';\n        this.ruler2.style.width = '1px';\n        this.ruler2.style.borderWidth = '0px';\n        this.ruler2.style.display = this.rulerLocation == 'center' ? 'none' : 'block';\n    }\n\n    this.ruler2.style.left = '' + (this.featurePanelWidth / 2 | 0) + 'px';\n\n    for (var ti = 0; ti < this.tiers.length; ++ti) {\n        var tier = this.tiers[ti];\n        var q = tier.quantOverlay;\n\n        var quant;\n        if (tier.subtiers && tier.subtiers.length > 0) quant = tier.subtiers[0].quant;\n\n        if (q) {\n            q.style.display = quant ? display : 'none';\n            q.style.left = left;\n            q.style.right = right;\n        }\n    }\n};\n\nBrowser.prototype.featureDoubleClick = function (hit, rx, ry) {\n    if (!hit || hit.length == 0) return;\n\n    var f = hit[hit.length - 1];\n\n    if (!f.min || !f.max) {\n        return;\n    }\n\n    var fstart = ((f.min | 0) - (this.viewStart | 0)) * this.scale;\n    var fwidth = (f.max - f.min + 1) * this.scale;\n\n    var newMid = ((f.min | 0) + (f.max | 0)) / 2;\n    if (fwidth > 10) {\n        var frac = 1.0 * (rx - fstart) / fwidth;\n        if (frac < 0.3) {\n            newMid = f.min | 0;\n        } else if (frac > 0.7) {\n            newMid = (f.max | 0) + 1;\n        }\n    }\n\n    var width = this.viewEnd - this.viewStart;\n    this.setLocation(null, newMid - width / 2, newMid + width / 2);\n};\n\nBrowser.prototype.zoomForScale = function (scale) {\n    var ssScale;\n    if (scale > this.highZoomThreshold) {\n        ssScale = 'high';\n    } else if (scale > this.mediumZoomThreshold) {\n        ssScale = 'medium';\n    } else {\n        ssScale = 'low';\n    }\n    return ssScale;\n};\n\nBrowser.prototype.zoomForCurrentScale = function () {\n    return this.zoomForScale(this.scale);\n};\n\nBrowser.prototype.updateHeight = function () {\n    var tierTotal = 0;\n    for (var ti = 0; ti < this.tiers.length; ++ti) {\n        tierTotal += this.tiers[ti].currentHeight || 30;\n    }this.ruler.style.height = '' + tierTotal + 'px';\n    this.ruler2.style.height = '' + tierTotal + 'px';\n    this.browserHolder.style.display = 'block';\n    this.browserHolder.style.display = '-webkit-flex';\n    this.browserHolder.style.display = 'flex';\n    // this.svgHolder.style.maxHeight = '' + Math.max(tierTotal, 500) + 'px';\n};\n\nBrowser.prototype.scrollArrowKey = function (ev, dir) {\n    if (this.reverseKeyScrolling) dir = -dir;\n\n    if (ev.ctrlKey || ev.metaKey) {\n        var fedge = false;\n        if (ev.shiftKey) {\n            fedge = true;\n        }\n\n        this.leap(dir, fedge);\n    } else if (this.scale > 1) {\n        // per-base scrolling mode, tries to perfectly center.\n        var mid = (this.viewStart + this.viewEnd) / 2;\n        var err = mid - Math.round(mid);\n        var n = 1;\n        if (ev.shiftKey) n *= 10;\n        if (dir > 0) {\n            n = -n;\n            n -= err;\n            if (err > 0) n += 1;\n        } else {\n            n -= err;\n            if (err < 0) n -= 1;\n        }\n        this.setLocation(null, this.viewStart + n, this.viewEnd + n);\n    } else {\n        this.move(ev.shiftKey ? 100 * dir : 25 * dir);\n    }\n};\n\nBrowser.prototype.leap = function (dir, fedge) {\n    var thisB = this;\n    var pos = (thisB.viewStart + thisB.viewEnd + 1) / 2 | 0;\n    if (dir > 0 && thisB.viewStart <= 1) {\n        pos -= 100000000;\n    } else if (dir < 0 && thisB.viewEnd >= thisB.currentSeqMax) {\n        pos += 100000000;\n    }\n\n    var st = thisB.getSelectedTier();\n    if (st < 0) return;\n    var tier = thisB.tiers[st];\n\n    if (tier && (tier.featureSource && this.sourceAdapterIsCapable(tier.featureSource, 'quantLeap') && typeof tier.quantLeapThreshold == 'number' || tier.featureSource && this.sourceAdapterIsCapable(tier.featureSource, 'leap'))) {\n        tier.findNextFeature(thisB.chr, pos, -dir, fedge, function (nxt) {\n            if (nxt) {\n                var nmin = nxt.min;\n                var nmax = nxt.max;\n                if (fedge) {\n                    if (dir > 0) {\n                        if (nmin > pos + 1) {\n                            nmax = nmin;\n                        } else {\n                            nmax++;\n                            nmin = nmax;\n                        }\n                    } else {\n                        if (nmax < pos - 1) {\n                            nmax++;\n                            nmin = nmax;\n                        } else {\n                            nmax = nmin;\n                        }\n                    }\n                }\n                var wid = thisB.viewEnd - thisB.viewStart + 1;\n                if (parseFloat(wid / 2) == parseInt(wid / 2)) {\n                    wid--;\n                }\n                var newStart = (nmin + nmax - wid) / 2 + 1;\n                var newEnd = newStart + wid - 1;\n                var pos2 = pos;\n                thisB.setLocation(nxt.segment, newStart, newEnd);\n            } else {\n                alert('no next feature'); // FIXME better reporting would be nice!\n            }\n        });\n    } else {\n        this.move(100 * dir);\n    }\n};\n\nfunction glyphLookup(glyphs, rx, ry, matches) {\n    matches = matches || [];\n\n    for (var gi = glyphs.length - 1; gi >= 0; --gi) {\n        var g = glyphs[gi];\n        if (!g.notSelectable && g.min() <= rx && g.max() >= rx) {\n            if (g.minY) {\n                if (ry < g.minY() || ry > g.maxY()) continue;\n            }\n\n            if (g.feature) {\n                matches.push(g.feature);\n            } else if (g.group) {\n                matches.push(g.group);\n            }\n\n            if (g.glyphs) {\n                return glyphLookup(g.glyphs, rx, ry, matches);\n            } else if (g.glyph) {\n                return glyphLookup([g.glyph], rx, ry, matches);\n            } else {\n                return matches;\n            }\n        }\n    }\n    return matches;\n}\n\nBrowser.prototype.nameForCoordSystem = function (cs) {\n    var primary = null,\n        ucsc = null;\n    if (this.assemblyNamePrimary) {\n        primary = '' + cs.auth;\n        if (typeof cs.version !== 'undefined') primary += cs.version;\n    }\n    if (this.assemblyNameUcsc) {\n        ucsc = cs.ucscName;\n    }\n    if (primary != null && ucsc != null) return primary + '/' + ucsc;else return primary || ucsc || 'unknown';\n};\n\nBrowser.prototype.makeLoader = function (size) {\n    size = size || 16;\n    var retina = window.devicePixelRatio > 1;\n    if (size < 20) {\n        return makeElement('img', null, { src: this.resolveURL('$$img/spinner_' + (retina ? 16 : 32) + '.gif'), width: '16', height: '16' });\n    } else {\n        return makeElement('img', null, { src: this.resolveURL('$$img/spinner_' + (retina ? 24 : 48) + '.gif'), width: '24', height: '24' });\n    }\n};\n\nBrowser.prototype.canFetchPlainHTTP = function () {\n    var self = this;\n    if (!this._plainHTTPPromise) {\n        var worker = this.getWorker();\n        if (worker) {\n            this._plainHTTPPromise = new Promise(function (resolve, reject) {\n                worker.postCommand({ command: 'textxhr',\n                    uri: self.httpCanaryURL }, function (result, err) {\n                    if (result) {\n                        resolve(true);\n                    } else {\n                        resolve(false);\n                    }\n                });\n            });\n        } else {\n            this._plainHTTPPromise = new Promise(function (resolve, reject) {\n                textXHR(self.httpCanaryURL, function (result, err) {\n                    if (result) {\n                        resolve(true);\n                    } else {\n                        resolve(false);\n                    }\n                }, { timeout: 2000 });\n            });\n        }\n    }\n    return this._plainHTTPPromise;\n};\n\nBrowser.prototype.getWorker = function () {\n    if (!this.useFetchWorkers || !this.fetchWorkers || this.fetchWorkers.length == 0) return null;\n\n    if (this.nextWorker >= this.fetchWorkers.length) this.nextWorker = 0;\n    return this.fetchWorkers[this.nextWorker++];\n};\n\nBrowser.prototype.registerResolver = function (resolver) {\n    var id = 'res' + ++this.resolverSeed;\n    this.resolvers[id] = resolver;\n    return id;\n};\n\nfunction FetchWorker(browser, worker) {\n    var thisB = this;\n    this.tagSeed = 0;\n    this.callbacks = {};\n    this.browser = browser;\n    this.worker = worker;\n\n    this.worker.onmessage = function (ev) {\n        var data = ev.data;\n\n        if (!data.cmd) {\n            var cb = thisB.callbacks[data.tag];\n            if (cb) {\n                cb(data.result, data.error);\n                delete thisB.callbacks[data.tag];\n            }\n        } else if (data.cmd == 'resolve') {\n            var resolver = thisB.browser.resolvers[data.resolver];\n            if (resolver) {\n                resolver(data.url).then(function (url) {\n                    thisB.worker.postMessage({\n                        tag: data.tag,\n                        url: url\n                    });\n                }).catch(function (err) {\n                    console.log(err);\n                    thisB.worker.postMessage({\n                        tag: data.tag,\n                        err: err.toString()\n                    });\n                });\n            } else {\n                console.log('No resolver ' + data.resolver);\n            }\n        } else {\n            console.log('Bad worker callback ' + data.cmd);\n        }\n    };\n}\n\nfunction makeFetchWorker(browser) {\n    var wurl = browser.resolveURL(browser.workerPath);\n    if (wurl.indexOf('//') == 0) {\n        var proto = window.location.protocol;\n        if (proto == 'https:') wurl = 'https:' + wurl;else wurl = 'http:' + wurl;\n    }\n\n    var wscript = 'importScripts(\"' + wurl + '?version=' + VERSION + '\");';\n    var wblob = new Blob([wscript], { type: 'application/javascript' });\n\n    return new Promise(function (resolve, reject) {\n        var worker = new Worker(URL.createObjectURL(wblob));\n\n        worker.onmessage = function (ev) {\n            if (ev.data.tag === 'init') {\n                console.log('Worker initialized');\n                resolve(new FetchWorker(browser, worker));\n            }\n        };\n\n        worker.onerror = function (ev) {\n            reject(ev.message);\n        };\n    });\n}\n\nFetchWorker.prototype.postCommand = function (cmd, callback, transfer) {\n    var tag = 'x' + ++this.tagSeed;\n    cmd.tag = tag;\n    this.callbacks[tag] = callback;\n    this.worker.postMessage(cmd, transfer);\n};\n\nFetchWorker.prototype.terminate = function () {\n    this.worker.terminate();\n};\n\nif (typeof module !== 'undefined') {\n    module.exports = {\n        Browser: Browser\n    };\n\n    // Required because they add stuff to Browser.prototype\n    require('./browser-ui');\n    require('./track-adder');\n    require('./feature-popup');\n    require('./tier-actions');\n    require('./domui');\n    require('./search');\n\n    var sa = require('./sourceadapters');\n    var TwoBitSequenceSource = sa.TwoBitSequenceSource;\n    var EnsemblSequenceSource = sa.EnsemblSequenceSource;\n    var EnsemblProteinSequenceSource = sa.EnsemblProteinSequenceSource;\n    var DASSequenceSource = sa.DASSequenceSource;\n\n    var KnownSpace = require('./kspace').KnownSpace;\n\n    var DASRegistry = require('./das').DASRegistry;\n}\n\nfunction SourceCache() {\n    this.sourcesByURI = {};\n}\n\nSourceCache.prototype.get = function (conf) {\n    var scb = this.sourcesByURI[sourceDataURI(conf)];\n    if (scb) {\n        for (var si = 0; si < scb.configs.length; ++si) {\n            if (sourcesAreEqualModuloStyle(scb.configs[si], conf)) {\n                return scb.sources[si];\n            }\n        }\n    }\n};\n\nSourceCache.prototype.put = function (conf, source) {\n    var uri = sourceDataURI(conf);\n    var scb = this.sourcesByURI[uri];\n    if (!scb) {\n        scb = { configs: [], sources: [] };\n        this.sourcesByURI[uri] = scb;\n    }\n    scb.configs.push(conf);\n    scb.sources.push(source);\n};\n\n},{\"./browser-ui\":5,\"./chainset\":7,\"./das\":11,\"./default-renderer\":12,\"./domui\":13,\"./dummy-renderer\":14,\"./feature-popup\":22,\"./kspace\":26,\"./multi-renderer\":29,\"./numformats\":30,\"./search\":35,\"./sha1\":38,\"./sourceadapters\":39,\"./sourcecompare\":40,\"./sub-renderer\":43,\"./thub\":49,\"./tier\":52,\"./tier-actions\":50,\"./track-adder\":53,\"./utils\":56,\"./version\":58,\"es6-promise\":60}],7:[function(require,module,exports){\n/* -*- mode: javascript; c-basic-offset: 4; indent-tabs-mode: nil -*- */\n\n// \n// Dalliance Genome Explorer\n// (c) Thomas Down 2006-2010\n//\n// chainset.js: liftover support\n//\n\n\"use strict\";\n\nif (typeof require !== 'undefined') {\n    var das = require('./das');\n    var DASSource = das.DASSource;\n    var DASSegment = das.DASSegment;\n\n    var utils = require('./utils');\n    var pusho = utils.pusho;\n    var shallowCopy = utils.shallowCopy;\n\n    var parseCigar = require('./cigar').parseCigar;\n\n    var bin = require('./bin');\n    var URLFetchable = bin.URLFetchable;\n\n    var bbi = require('./bigwig');\n    var makeBwg = bbi.makeBwg;\n\n    var Promise = require('es6-promise').Promise;\n}\n\nfunction Chainset(conf, srcTag, destTag, coords) {\n    if (typeof conf == 'string') {\n        this.uri = conf;\n        this.srcTag = srcTag;\n        this.destTag = destTag;\n        this.coords = coords;\n    } else {\n        this.uri = conf.uri;\n        this.srcTag = conf.srcTag;\n        this.destTag = conf.destTag;\n        this.coords = shallowCopy(conf.coords);\n        this.type = conf.type;\n        this.credentials = conf.credentials;\n    }\n\n    this.chainsBySrc = {};\n    this.chainsByDest = {};\n    this.postFetchQueues = {};\n    this.fetchedTiles = {};\n    this.granularity = 1000000; // size in bases of tile to fetch\n\n    if (this.type == 'bigbed') {\n        this.chainFetcher = new BBIChainFetcher(this.uri, this.credentials);\n    } else if (this.type == 'alias') {\n        this.chainFetcher = new AliasChainFetcher(conf);\n    } else {\n        this.chainFetcher = new DASChainFetcher(this.uri, this.srcTag, this.destTag);\n    }\n};\n\nChainset.prototype.exportConfig = function () {\n    return {\n        uri: this.uri,\n        srcTag: this.srcTag,\n        destTag: this.destTag,\n        coords: this.coords,\n        type: this.type,\n        credentials: this.credentials\n    };\n};\n\nChainset.prototype.mapPoint = function (chr, pos) {\n    var chains = this.chainsBySrc[chr] || [];\n    for (var ci = 0; ci < chains.length; ++ci) {\n        var c = chains[ci];\n        if (pos >= c.srcMin && pos <= c.srcMax) {\n            var cpos;\n            if (c.srcOri == '-') {\n                cpos = c.srcMax - pos;\n            } else {\n                cpos = pos - c.srcMin;\n            }\n            var blocks = c.blocks;\n            for (var bi = 0; bi < blocks.length; ++bi) {\n                var b = blocks[bi];\n                var bSrc = b[0];\n                var bDest = b[1];\n                var bSize = b[2];\n                if (cpos >= bSrc && cpos <= bSrc + bSize) {\n                    var apos = cpos - bSrc;\n\n                    var dpos;\n                    if (c.destOri == '-') {\n                        dpos = c.destMax - bDest - apos;\n                    } else {\n                        dpos = apos + bDest + c.destMin;\n                    }\n                    return { seq: c.destChr, pos: dpos, flipped: c.srcOri != c.destOri };\n                }\n            }\n        }\n    }\n    return null;\n};\n\nChainset.prototype.mapSegment = function (chr, min, max) {\n    var chains = this.chainsBySrc[chr] || [];\n    var mappings = [];\n    for (var ci = 0; ci < chains.length; ++ci) {\n        var c = chains[ci];\n        if (max >= c.srcMin && min <= c.srcMax) {\n            var cmin, cmax;\n            if (c.srcOri == '-') {\n                cmin = c.srcMax - max;\n                cmax = c.srcMax - min;\n            } else {\n                cmin = min - c.srcMin;\n                cmax = max - c.srcMin;\n            }\n            var blocks = c.blocks;\n            for (var bi = 0; bi < blocks.length; ++bi) {\n                var b = blocks[bi];\n                var bSrc = b[0];\n                var bDest = b[1];\n                var bSize = b[2];\n                if (cmax >= bSrc && cmin <= bSrc + bSize) {\n                    var m = {\n                        segment: c.destChr,\n                        flipped: c.srcOri == '-' ^ c.destOri == '-' };\n\n                    if (c.destOri == '-') {\n                        if (cmin >= bSrc) {\n                            m.max = c.destMax - bDest - cmin + bSrc;\n                        } else {\n                            m.max = c.destMax - bDest;\n                            m.partialMax = bSrc - cmin;\n                        }\n                        if (cmax <= bSrc + bSize) {\n                            m.min = c.destMax - bDest - cmax + bSrc;\n                        } else {\n                            m.min = c.destMax - bDest - bSize;\n                            m.partialMin = cmax - bSrc - bSize;\n                        }\n                    } else {\n                        if (cmin >= bSrc) {\n                            m.min = c.destMin + bDest + cmin - bSrc;\n                        } else {\n                            m.min = c.destMin + bDest;\n                            m.partialMin = bSrc - cmin;\n                        }\n                        if (cmax <= bSrc + bSize) {\n                            m.max = c.destMin + bDest + cmax - bSrc;\n                        } else {\n                            m.max = c.destMin + bDest + bSize;\n                            m.partialMax = cmax - bSrc - bSize;\n                        }\n                    }\n                    mappings.push(m);\n                }\n            }\n        }\n    }\n    return mappings;\n};\n\nChainset.prototype.unmapPoint = function (chr, pos) {\n    var chains = this.chainsByDest[chr] || [];\n    for (var ci = 0; ci < chains.length; ++ci) {\n        var c = chains[ci];\n        if (pos >= c.destMin && pos <= c.destMax) {\n            var cpos;\n            if (c.srcOri == '-') {\n                cpos = c.destMax - pos;\n            } else {\n                cpos = pos - c.destMin;\n            }\n\n            var blocks = c.blocks;\n            for (var bi = 0; bi < blocks.length; ++bi) {\n                var b = blocks[bi];\n                var bSrc = b[0];\n                var bDest = b[1];\n                var bSize = b[2];\n\n                if (cpos >= bDest && cpos <= bDest + bSize) {\n                    var apos = cpos - bDest;\n\n                    var dpos = apos + bSrc + c.srcMin;\n                    var dpos;\n                    if (c.destOri == '-') {\n                        dpos = c.srcMax - bSrc - apos;\n                    } else {\n                        dpos = apos + bSrc + c.srcMin;\n                    }\n                    return { seq: c.srcChr, pos: dpos, flipped: c.srcOri != c.destOri };\n                }\n            }\n            // return null;\n        }\n    }\n    return null;\n};\n\nChainset.prototype.sourceBlocksForRange = function (chr, min, max, callback) {\n    var STATE_PENDING = 1;\n    var STATE_FETCHED = 2;\n\n    var thisCS = this;\n    var minTile = min / this.granularity | 0;\n    var maxTile = max / this.granularity | 0;\n\n    var needsNewOrPending = false;\n    var needsNewFetch = false;\n    for (var t = minTile; t <= maxTile; ++t) {\n        var tn = chr + '_' + t;\n        if (this.fetchedTiles[tn] != STATE_FETCHED) {\n            needsNewOrPending = true;\n            if (this.fetchedTiles[tn] != STATE_PENDING) {\n                this.fetchedTiles[tn] = STATE_PENDING;\n                needsNewFetch = true;\n            }\n        }\n    }\n\n    if (needsNewOrPending) {\n        if (!this.postFetchQueues[chr]) {\n            this.chainFetcher.fetchChains(chr, minTile * this.granularity, (maxTile + 1) * this.granularity - 1).then(function (chains) {\n                if (!thisCS.chainsByDest) thisCS.chainsByDest[chr] = [];\n                for (var ci = 0; ci < chains.length; ++ci) {\n                    var chain = chains[ci];\n\n                    {\n                        var cbs = thisCS.chainsBySrc[chain.srcChr];\n                        if (!cbs) {\n                            thisCS.chainsBySrc[chain.srcChr] = [chain];\n                        } else {\n                            var present = false;\n                            for (var oci = 0; oci < cbs.length; ++oci) {\n                                var oc = cbs[oci];\n                                if (oc.srcMin == chain.srcMin && oc.srcMax == chain.srcMax) {\n                                    present = true;\n                                    break;\n                                }\n                            }\n                            if (!present) cbs.push(chain);\n                        }\n                    }\n\n                    {\n                        var cbd = thisCS.chainsByDest[chain.destChr];\n                        if (!cbd) {\n                            thisCS.chainsByDest[chain.destChr] = [chain];\n                        } else {\n                            var present = false;\n                            for (var oci = 0; oci < cbd.length; ++oci) {\n                                var oc = cbd[oci];\n                                if (oc.destMin == chain.destMin && oc.destMax == chain.destMax) {\n                                    present = true;\n                                    break;\n                                }\n                            }\n                            if (!present) cbd.push(chain);\n                        }\n                    }\n                }\n                for (var t = minTile; t <= maxTile; ++t) {\n                    var tn = chr + '_' + t;\n                    thisCS.fetchedTiles[tn] = STATE_FETCHED;\n                }\n                if (thisCS.postFetchQueues[chr]) {\n                    var pfq = thisCS.postFetchQueues[chr];\n                    for (var i = 0; i < pfq.length; ++i) {\n                        pfq[i]();\n                    }\n                    thisCS.postFetchQueues[chr] = null;\n                }\n            }).catch(function (err) {\n                console.log(err);\n            });\n        }\n\n        pusho(this.postFetchQueues, chr, function () {\n            // Will either succeed if the tiles that are needed have already been fetched,\n            // or queue up a new fetch.\n\n            thisCS.sourceBlocksForRange(chr, min, max, callback);\n        });\n    } else {\n        var srcBlocks = [];\n        var chains = this.chainsByDest[chr] || [];\n        for (var ci = 0; ci < chains.length; ++ci) {\n            var c = chains[ci];\n            if (min <= c.destMax && max >= c.destMin) {\n                var cmin, cmax;\n                if (c.srcOri == '-') {\n                    cmin = c.destMax - max;\n                    cmax = c.destMax - min;\n                } else {\n                    cmin = min - c.destMin;\n                    cmax = max - c.destMin;\n                }\n\n                var blocks = c.blocks;\n                for (var bi = 0; bi < blocks.length; ++bi) {\n                    var b = blocks[bi];\n                    var bSrc = b[0];\n                    var bDest = b[1];\n                    var bSize = b[2];\n\n                    if (cmax >= bDest && cmin <= bDest + bSize) {\n                        var amin = Math.max(cmin, bDest) - bDest;\n                        var amax = Math.min(cmax, bDest + bSize) - bDest;\n\n                        if (c.destOri == '-') {\n                            srcBlocks.push(new DASSegment(c.srcChr, c.srcMax - bSrc - amax, c.srcMax - bSrc - amin));\n                        } else {\n                            srcBlocks.push(new DASSegment(c.srcChr, c.srcMin + amin + bSrc, c.srcMin + amax + bSrc));\n                        }\n                    }\n                }\n            }\n        }\n        callback(srcBlocks);\n    }\n};\n\nfunction DASChainFetcher(uri, srcTag, destTag) {\n    this.source = new DASSource(uri);\n    this.srcTag = srcTag;\n    this.destTag = destTag;\n}\n\nDASChainFetcher.prototype.fetchChains = function (chr, _min, _max) {\n    var thisCS = this;\n\n    return new Promise(function (resolve, reject) {\n        thisCS.source.alignments(chr, {}, function (aligns) {\n            var chains = [];\n\n            for (var ai = 0; ai < aligns.length; ++ai) {\n                var aln = aligns[ai];\n                for (var bi = 0; bi < aln.blocks.length; ++bi) {\n                    var block = aln.blocks[bi];\n                    var srcSeg, destSeg;\n                    for (var si = 0; si < block.segments.length; ++si) {\n                        var seg = block.segments[si];\n                        var obj = aln.objects[seg.object];\n                        if (obj.dbSource === thisCS.srcTag) {\n                            srcSeg = seg;\n                        } else if (obj.dbSource === thisCS.destTag) {\n                            destSeg = seg;\n                        }\n                    }\n                    if (srcSeg && destSeg) {\n                        var chain = {\n                            srcChr: aln.objects[srcSeg.object].accession,\n                            srcMin: srcSeg.min | 0,\n                            srcMax: srcSeg.max | 0,\n                            srcOri: srcSeg.strand,\n                            destChr: aln.objects[destSeg.object].accession,\n                            destMin: destSeg.min | 0,\n                            destMax: destSeg.max | 0,\n                            destOri: destSeg.strand,\n                            blocks: []\n                        };\n\n                        var srcops = parseCigar(srcSeg.cigar),\n                            destops = parseCigar(destSeg.cigar);\n\n                        var srcOffset = 0,\n                            destOffset = 0;\n                        var srci = 0,\n                            desti = 0;\n                        while (srci < srcops.length && desti < destops.length) {\n                            if (srcops[srci].op == 'M' && destops[desti].op == 'M') {\n                                var blockLen = Math.min(srcops[srci].cnt, destops[desti].cnt);\n                                chain.blocks.push([srcOffset, destOffset, blockLen]);\n                                if (srcops[srci].cnt == blockLen) {\n                                    ++srci;\n                                } else {\n                                    srcops[srci].cnt -= blockLen;\n                                }\n                                if (destops[desti].cnt == blockLen) {\n                                    ++desti;\n                                } else {\n                                    destops[desti] -= blockLen;\n                                }\n                                srcOffset += blockLen;\n                                destOffset += blockLen;\n                            } else if (srcops[srci].op == 'I') {\n                                destOffset += srcops[srci++].cnt;\n                            } else if (destops[desti].op == 'I') {\n                                srcOffset += destops[desti++].cnt;\n                            }\n                        }\n\n                        chains.push(chain);\n                    }\n                }\n            }\n            resolve(chains);\n        });\n    });\n};\n\nfunction BBIChainFetcher(uri, credentials) {\n    var self = this;\n    this.uri = uri;\n    this.credentials = credentials;\n\n    this.bwg = new Promise(function (resolve, reject) {\n        makeBwg(new URLFetchable(self.uri, { credentials: self.credentials,\n            resolver: self.resolver }), function (bwg, err) {\n            if (bwg) {\n                resolve(bwg);\n            } else {\n                reject(err);\n            }\n        });\n    });\n\n    this.bwg.then(function (bwg, err) {\n        if (err) console.log(err);\n    });\n}\n\nfunction pi(x) {\n    return parseInt(x);\n}\n\nfunction cleanChr(c) {\n    if (c.indexOf('chr') == 0) return c.substr(3);else return c;\n}\n\nfunction bbiFeatureToChain(feature) {\n    var chain = {\n        srcChr: cleanChr(feature.srcChrom),\n        srcMin: parseInt(feature.srcStart),\n        srcMax: parseInt(feature.srcEnd),\n        srcOri: feature.srcOri,\n        destChr: cleanChr(feature.segment),\n        destMin: feature.min - 1, // Convert back from bigbed parser\n        destMax: feature.max,\n        destOri: feature.ori,\n        blocks: []\n    };\n    var srcStarts = feature.srcStarts.split(',').map(pi);\n    var destStarts = feature.destStarts.split(',').map(pi);\n    var blockLengths = feature.blockLens.split(',').map(pi);\n    for (var bi = 0; bi < srcStarts.length; ++bi) {\n        chain.blocks.push([srcStarts[bi], destStarts[bi], blockLengths[bi]]);\n    }\n\n    return chain;\n}\n\nBBIChainFetcher.prototype.fetchChains = function (chr, min, max) {\n    return this.bwg.then(function (bwg, err) {\n        if (!bwg) throw Error(\"No BWG\");\n\n        return new Promise(function (resolve, reject) {\n            bwg.getUnzoomedView().readWigData(chr, min, max, function (feats) {\n                resolve(feats.map(bbiFeatureToChain));\n            });\n        });\n    });\n};\n\nfunction AliasChainFetcher(conf) {\n    this.conf = conf;\n    this.forwardAliases = {};\n    var sa = conf.sequenceAliases || [];\n    for (var ai = 0; ai < sa.length; ++ai) {\n        var al = sa[ai];\n        if (al.length < 2) continue;\n\n        var fa = [];\n        for (var i = 0; i < al.length - 1; ++i) {\n            fa.push(al[i]);\n        }this.forwardAliases[al[al.length - 1]] = fa;\n    }\n}\n\nAliasChainFetcher.prototype.fetchChains = function (chr, min, max) {\n    var resp = [];\n    var fa = this.forwardAliases[chr] || [];\n    for (var i = 0; i < fa.length; ++i) {\n        resp.push({\n            srcChr: fa[i],\n            srcMin: 1,\n            srcMax: 1000000000,\n            srcOri: '+',\n            destChr: chr,\n            destMin: 1,\n            destMax: 1000000000,\n            destOri: '+',\n            blocks: [[1, 1, 1000000000]]\n        });\n    }\n\n    return Promise.resolve(resp);\n};\n\nif (typeof module !== 'undefined') {\n    module.exports = {\n        Chainset: Chainset\n    };\n}\n\n},{\"./bigwig\":3,\"./bin\":4,\"./cigar\":8,\"./das\":11,\"./utils\":56,\"es6-promise\":60}],8:[function(require,module,exports){\n'use strict';\n\n// \n// Dalliance Genome Explorer\n// (c) Thomas Down 2006-2010\n//\n// chainset.js: liftover support\n//\n\nvar CIGAR_REGEXP = new RegExp('([0-9]*)([MIDS])', 'g');\n\nfunction parseCigar(cigar) {\n    var cigops = [];\n    var match;\n    while ((match = CIGAR_REGEXP.exec(cigar)) != null) {\n        var count = match[1];\n        if (count.length == 0) {\n            count = 1;\n        }\n        cigops.push({ cnt: count | 0, op: match[2] });\n    }\n    return cigops;\n}\n\nif (typeof module !== 'undefined') {\n    module.exports = {\n        parseCigar: parseCigar\n    };\n}\n\n},{}],9:[function(require,module,exports){\n/* -*- mode: javascript; c-basic-offset: 4; indent-tabs-mode: nil -*- */\n\n// \n// Dalliance Genome Explorer\n// (c) Thomas Down 2006-2010\n//\n// color.js\n//\n\n\"use strict\";\n\nfunction DColour(red, green, blue, name) {\n    this.red = red | 0;\n    this.green = green | 0;\n    this.blue = blue | 0;\n    if (name) {\n        this.name = name;\n    }\n}\n\nDColour.prototype.toSvgString = function () {\n    if (!this.name) {\n        this.name = \"rgb(\" + this.red + \",\" + this.green + \",\" + this.blue + \")\";\n    }\n\n    return this.name;\n};\n\nfunction hex2(x) {\n    var y = '00' + x.toString(16);\n    return y.substring(y.length - 2);\n}\n\nDColour.prototype.toHexString = function () {\n    return '#' + hex2(this.red) + hex2(this.green) + hex2(this.blue);\n};\n\nvar palette = {\n    red: new DColour(255, 0, 0, 'red'),\n    green: new DColour(0, 255, 0, 'green'),\n    blue: new DColour(0, 0, 255, 'blue'),\n    yellow: new DColour(255, 255, 0, 'yellow'),\n    white: new DColour(255, 255, 255, 'white'),\n    black: new DColour(0, 0, 0, 'black'),\n    gray: new DColour(180, 180, 180, 'gray'),\n    grey: new DColour(180, 180, 180, 'grey'),\n    lightskyblue: new DColour(135, 206, 250, 'lightskyblue'),\n    lightsalmon: new DColour(255, 160, 122, 'lightsalmon'),\n    hotpink: new DColour(255, 105, 180, 'hotpink')\n};\n\nvar COLOR_RE = new RegExp('^#([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$');\nvar CSS_COLOR_RE = /rgb\\(([0-9]+),([0-9]+),([0-9]+)\\)/;\n\nfunction dasColourForName(name) {\n    var c = palette[name];\n    if (!c) {\n        var match = COLOR_RE.exec(name);\n        if (match) {\n            c = new DColour('0x' + match[1] | 0, '0x' + match[2] | 0, '0x' + match[3] | 0, name);\n            palette[name] = c;\n        } else {\n            match = CSS_COLOR_RE.exec(name);\n            if (match) {\n                c = new DColour(match[1] | 0, match[2] | 0, match[3] | 0, name);\n                palette[name] = c;\n            } else {\n                console.log(\"couldn't handle color: \" + name);\n                c = palette.black;\n                palette[name] = c;\n            }\n        }\n    }\n    return c;\n}\n\nfunction makeColourSteps(steps, stops, colours) {\n    var dcolours = [];\n    for (var ci = 0; ci < colours.length; ++ci) {\n        dcolours.push(dasColourForName(colours[ci]));\n    }\n\n    var grad = [];\n    STEP_LOOP: for (var si = 0; si < steps; ++si) {\n        var rs = 1.0 * si / (steps - 1);\n        var score = stops[0] + (stops[stops.length - 1] - stops[0]) * rs;\n        for (var i = 0; i < stops.length - 1; ++i) {\n            if (score >= stops[i] && score <= stops[i + 1]) {\n                var frac = (score - stops[i]) / (stops[i + 1] - stops[i]);\n                var ca = dcolours[i];\n                var cb = dcolours[i + 1];\n\n                var fill = new DColour(ca.red * (1.0 - frac) + cb.red * frac | 0, ca.green * (1.0 - frac) + cb.green * frac | 0, ca.blue * (1.0 - frac) + cb.blue * frac | 0).toSvgString();\n                grad.push(fill);\n\n                continue STEP_LOOP;\n            }\n        }\n        throw 'Bad step';\n    }\n\n    return grad;\n}\n\nfunction makeGradient(steps, color1, color2, color3) {\n    if (color3) {\n        return makeColourSteps(steps, [0, 0.5, 1], [color1, color2, color3]);\n    } else {\n        return makeColourSteps(steps, [0, 1], [color1, color2]);\n    }\n}\n\nif (typeof module !== 'undefined') {\n    module.exports = {\n        makeColourSteps: makeColourSteps,\n        makeGradient: makeGradient,\n        dasColourForName: dasColourForName\n    };\n}\n\n},{}],10:[function(require,module,exports){\n/* -*- mode: javascript; c-basic-offset: 4; indent-tabs-mode: nil -*- */\n\n// \n// Dalliance Genome Explorer\n// (c) Thomas Down 2006-2011\n//\n// cram.js: indexed binary alignments\n//\n\n\"use strict\";\n\nif (typeof require !== 'undefined') {\n    var spans = require('./spans');\n    var Range = spans.Range;\n    var union = spans.union;\n    var intersection = spans.intersection;\n\n    var bin = require('./bin');\n    var readInt = bin.readInt;\n    var readShort = bin.readShort;\n    var readByte = bin.readByte;\n    var readInt64 = bin.readInt64;\n    var readFloat = bin.readFloat;\n\n    var lh3utils = require('./lh3utils');\n    var readVob = lh3utils.readVob;\n    var unbgzf = lh3utils.unbgzf;\n    var reg2bins = lh3utils.reg2bins;\n    var Chunk = lh3utils.Chunk;\n\n    var jszlib = require('jszlib');\n}\n\nvar CRAM_MAGIC = 0x14d4142;\nvar CRAI_MAGIC = 0x88B1F;\n\nvar CramFlags = {\n    MULTIPLE_SEGMENTS: 0x1,\n    ALL_SEGMENTS_ALIGN: 0x2,\n    SEGMENT_UNMAPPED: 0x4,\n    NEXT_SEGMENT_UNMAPPED: 0x8,\n    REVERSE_COMPLEMENT: 0x10,\n    NEXT_REVERSE_COMPLEMENT: 0x20,\n    FIRST_SEGMENT: 0x40,\n    LAST_SEGMENT: 0x80,\n    SECONDARY_ALIGNMENT: 0x100,\n    QC_FAIL: 0x200,\n    DUPLICATE: 0x400,\n    SUPPLEMENTARY: 0x800\n};\n\nfunction CramFile() {}\n\n// Calculate the length (in bytes) of the CRAI ref starting at offset.\n// Returns {nbin, length, minBlockIndex}\nfunction _getCraiRefLength(uncba, offset) {\n    var p = offset;\n    var nbin = readInt(uncba, p);p += 4;\n    for (var b = 0; b < nbin; ++b) {\n        var bin = readInt(uncba, p);\n        var nchnk = readInt(uncba, p + 4);\n        p += 8 + nchnk * 16;\n    }\n    var nintv = readInt(uncba, p);p += 4;\n\n    var minBlockIndex = 1000000000;\n    var q = p;\n    for (var i = 0; i < nintv; ++i) {\n        var v = readVob(uncba, q);q += 8;\n        if (v) {\n            var bi = v.block;\n            if (v.offset > 0) bi += 65536;\n\n            if (bi < minBlockIndex) minBlockIndex = bi;\n            break;\n        }\n    }\n    p += nintv * 8;\n\n    return {\n        minBlockIndex: minBlockIndex,\n        nbin: nbin,\n        length: p - offset\n    };\n}\n\nfunction makeCram(data, crai, indexChunks, callback, attempted) {\n    // Do an initial probe on the CRAM file to catch any mixed-content errors.\n    data.slice(0, 10).fetch(function (header) {\n        if (header) {\n            return makeCram2(data, crai, indexChunks, callback, attempted);\n        } else {\n            return callback(null, \"Couldn't access CRAM.\");\n        }\n    }, { timeout: 5000 });\n}\n\nfunction makeCram2(data, crai, indexChunks, callback, attempted) {\n    var cram = new CramFile();\n    cram.data = data;\n    cram.crai = crai;\n    cram.indexChunks = indexChunks;\n\n    var minBlockIndex = cram.indexChunks ? cram.indexChunks.minBlockIndex : 1000000000;\n\n    // Fills out cram.chrToIndex and cram.indexToChr based on the first few bytes of the CRAM.\n    function parseCramHeader(r) {\n        if (!r) {\n            return callback(null, \"Couldn't access CRAM\");\n        }\n\n        var unc = unbgzf(r, r.byteLength);\n        var uncba = new Uint8Array(unc);\n\n        var magic = readInt(uncba, 0);\n        if (magic != CRAM_MAGIC) {\n            return callback(null, \"Not a CRAM file, magic=0x\" + magic.toString(16));\n        }\n        var headLen = readInt(uncba, 4);\n        var header = '';\n        for (var i = 0; i < headLen; ++i) {\n            header += String.fromCharCode(uncba[i + 8]);\n        }\n\n        var nRef = readInt(uncba, headLen + 8);\n        var p = headLen + 12;\n\n        cram.chrToIndex = {};\n        cram.indexToChr = [];\n        for (var i = 0; i < nRef; ++i) {\n            var lName = readInt(uncba, p);\n            var name = '';\n            for (var j = 0; j < lName - 1; ++j) {\n                name += String.fromCharCode(uncba[p + 4 + j]);\n            }\n            var lRef = readInt(uncba, p + lName + 4);\n            cram.chrToIndex[name] = i;\n            if (name.indexOf('chr') == 0) {\n                cram.chrToIndex[name.substring(3)] = i;\n            } else {\n                cram.chrToIndex['chr' + name] = i;\n            }\n            cram.indexToChr.push(name);\n\n            p = p + 8 + lName;\n        }\n\n        if (cram.indices) {\n            return callback(cram);\n        }\n    }\n\n    function parseCrai(header) {\n        if (!header) {\n            return \"Couldn't access CRAI\";\n        }\n\n        var uncba = new Uint8Array(header);\n\n        var craiMagic = readInt(uncba, 0);\n        if (craiMagic != CRAI_MAGIC) {\n            return callback(null, 'Not a CRAI file, magic=0x' + craiMagic.toString(16));\n        }\n\n        var offset = 10;\n        var unc = jszlib.inflateBuffer(header, offset, header.byteLength - offset);\n        var s = '';\n        var resultBB = new Uint8Array(unc);\n        for (var i = 0; i < resultBB.length; ++i) {\n            s += String.fromCharCode(resultBB[i]);\n        }\n        console.log(s);\n\n        cram.indices = [];\n\n        var p = 8;\n        for (var ref = 0; ref < nref; ++ref) {\n            var blockStart = p;\n            var o = _getCraiRefLength(uncba, blockStart);\n            p += o.length;\n\n            minBlockIndex = Math.min(o.minBlockIndex, minBlockIndex);\n\n            var nbin = o.nbin;\n\n            if (nbin > 0) {\n                cram.indices[ref] = new Uint8Array(header, blockStart, p - blockStart);\n            }\n        }\n\n        return true;\n    }\n\n    if (!cram.indexChunks) {\n        cram.crai.fetch(function (header) {\n            // Do we really need to fetch the whole thing? :-(\n            var result = parseCrai(header);\n            if (result !== true) {\n                if (cram.crai.url && typeof attempted === \"undefined\") {\n                    // Already attempted x.cram.crai not there so now trying x.crai\n                    cram.crai.url = cram.data.url.replace(new RegExp('.cram$'), '.crai');\n\n                    // True lets us know we are making a second attempt\n                    makeCram2(data, cram.crai, indexChunks, callback, true);\n                } else {\n                    // We've attempted x.cram.crai & x.crai and nothing worked\n                    callback(null, result);\n                }\n            } else {\n                cram.data.slice(0, minBlockIndex).fetch(parseCramHeader);\n            }\n        }); // Timeout on first request to catch Chrome mixed-content error.\n    } else {\n        var chunks = cram.indexChunks.chunks;\n        cram.indices = [];\n        for (var i = 0; i < chunks.length; i++) {\n            cram.indices[i] = null; // To be filled out lazily as needed\n        }\n        cram.data.slice(0, minBlockIndex).fetch(parseCramHeader);\n    }\n}\n\nCramFile.prototype.blocksForRange = function (refId, min, max) {\n    var index = this.indices[refId];\n    if (!index) {\n        return [];\n    }\n\n    var intBinsL = reg2bins(min, max);\n    var intBins = [];\n    for (var i = 0; i < intBinsL.length; ++i) {\n        intBins[intBinsL[i]] = true;\n    }\n    var leafChunks = [],\n        otherChunks = [];\n\n    var nbin = readInt(index, 0);\n    var p = 4;\n    for (var b = 0; b < nbin; ++b) {\n        var bin = readInt(index, p);\n        var nchnk = readInt(index, p + 4);\n        //        dlog('bin=' + bin + '; nchnk=' + nchnk);\n        p += 8;\n        if (intBins[bin]) {\n            for (var c = 0; c < nchnk; ++c) {\n                var cs = readVob(index, p);\n                var ce = readVob(index, p + 8);\n                (bin < 4681 ? otherChunks : leafChunks).push(new Chunk(cs, ce));\n                p += 16;\n            }\n        } else {\n            p += nchnk * 16;\n        }\n    }\n    // console.log('leafChunks = ' + JSON.stringify(leafChunks));\n    // console.log('otherChunks = ' + JSON.stringify(otherChunks));\n\n    var nintv = readInt(index, p);\n    // console.log('nintv=' + nintv);\n    var lowest = null;\n    var minLin = Math.min(min >> 14, nintv - 1),\n        maxLin = Math.min(max >> 14, nintv - 1);\n    for (var i = minLin; i <= maxLin; ++i) {\n        var lb = readVob(index, p + 4 + i * 8);\n        if (!lb) {\n            continue;\n        }\n        if (!lowest || lb.block < lowest.block || lb.block == lowest.block && lb.offset < lowest.offset) {\n            lowest = lb;\n        }\n    }\n    // console.log('Lowest LB = ' + lowest);\n\n    var prunedOtherChunks = [];\n    if (lowest != null) {\n        for (var i = 0; i < otherChunks.length; ++i) {\n            var chnk = otherChunks[i];\n            if (chnk.maxv.block > lowest.block || chnk.maxv.block == lowest.block && chnk.maxv.offset >= lowest.offset) {\n                prunedOtherChunks.push(chnk);\n            }\n        }\n    }\n    // console.log('prunedOtherChunks = ' + JSON.stringify(prunedOtherChunks));\n    otherChunks = prunedOtherChunks;\n\n    var intChunks = [];\n    for (var i = 0; i < otherChunks.length; ++i) {\n        intChunks.push(otherChunks[i]);\n    }\n    for (var i = 0; i < leafChunks.length; ++i) {\n        intChunks.push(leafChunks[i]);\n    }\n\n    intChunks.sort(function (c0, c1) {\n        var dif = c0.minv.block - c1.minv.block;\n        if (dif != 0) {\n            return dif;\n        } else {\n            return c0.minv.offset - c1.minv.offset;\n        }\n    });\n    var mergedChunks = [];\n    if (intChunks.length > 0) {\n        var cur = intChunks[0];\n        for (var i = 1; i < intChunks.length; ++i) {\n            var nc = intChunks[i];\n            if (nc.minv.block == cur.maxv.block /* && nc.minv.offset == cur.maxv.offset */) {\n                    // no point splitting mid-block\n                    cur = new Chunk(cur.minv, nc.maxv);\n                } else {\n                mergedChunks.push(cur);\n                cur = nc;\n            }\n        }\n        mergedChunks.push(cur);\n    }\n    // console.log('mergedChunks = ' + JSON.stringify(mergedChunks));\n\n    return mergedChunks;\n};\n\nCramFile.prototype.fetch = function (chr, min, max, callback, opts) {\n    var thisB = this;\n    opts = opts || {};\n\n    var chrId = this.chrToIndex[chr];\n    var chunks;\n    if (chrId === undefined) {\n        chunks = [];\n    } else {\n        // Fetch this portion of the CRAI if it hasn't been loaded yet.\n        if (this.indices[chrId] === null && this.indexChunks.chunks[chrId]) {\n            var start_stop = this.indexChunks.chunks[chrId];\n            return this.crai.slice(start_stop[0], start_stop[1]).fetch(function (data) {\n                var buffer = new Uint8Array(data);\n                this.indices[chrId] = buffer;\n                return this.fetch(chr, min, max, callback, opts);\n            }.bind(this));\n        }\n\n        chunks = this.blocksForRange(chrId, min, max);\n        if (!chunks) {\n            callback(null, 'Error in index fetch');\n        }\n    }\n\n    var records = [];\n    var index = 0;\n    var data;\n\n    function tramp() {\n        if (index >= chunks.length) {\n            return callback(records);\n        } else if (!data) {\n            var c = chunks[index];\n            var fetchMin = c.minv.block;\n            var fetchMax = c.maxv.block + (1 << 16); // *sigh*\n            // console.log('fetching ' + fetchMin + ':' + fetchMax);\n            thisB.data.slice(fetchMin, fetchMax - fetchMin).fetch(function (r) {\n                data = unbgzf(r, c.maxv.block - c.minv.block + 1);\n                return tramp();\n            });\n        } else {\n            var ba = new Uint8Array(data);\n            var finished = thisB.readCramRecords(ba, chunks[index].minv.offset, records, min, max, chrId, opts);\n            data = null;\n            ++index;\n            if (finished) return callback(records);else return tramp();\n        }\n    }\n    tramp();\n};\n\nvar SEQRET_DECODER = ['=', 'A', 'C', 'x', 'G', 'x', 'x', 'x', 'T', 'x', 'x', 'x', 'x', 'x', 'x', 'N'];\nvar CIGAR_DECODER = ['M', 'I', 'D', 'N', 'S', 'H', 'P', '=', 'X', '?', '?', '?', '?', '?', '?', '?'];\n\nfunction CramRecord() {}\n\nCramFile.prototype.readCramRecords = function (ba, offset, sink, min, max, chrId, opts) {\n    while (true) {\n        var blockSize = readInt(ba, offset);\n        var blockEnd = offset + blockSize + 4;\n        if (blockEnd > ba.length) {\n            return false;\n        }\n\n        var record = new CramRecord();\n\n        var refID = readInt(ba, offset + 4);\n        var pos = readInt(ba, offset + 8);\n\n        var bmn = readInt(ba, offset + 12);\n        var bin = (bmn & 0xffff0000) >> 16;\n        var mq = (bmn & 0xff00) >> 8;\n        var nl = bmn & 0xff;\n\n        var flag_nc = readInt(ba, offset + 16);\n        var flag = (flag_nc & 0xffff0000) >> 16;\n        var nc = flag_nc & 0xffff;\n\n        var lseq = readInt(ba, offset + 20);\n\n        var nextRef = readInt(ba, offset + 24);\n        var nextPos = readInt(ba, offset + 28);\n\n        var tlen = readInt(ba, offset + 32);\n\n        record.segment = this.indexToChr[refID];\n        record.flag = flag;\n        record.pos = pos;\n        record.mq = mq;\n        if (opts.light) record.seqLength = lseq;\n\n        if (!opts.light || opts.includeName) {\n            var readName = '';\n            for (var j = 0; j < nl - 1; ++j) {\n                readName += String.fromCharCode(ba[offset + 36 + j]);\n            }\n            record.readName = readName;\n        }\n\n        if (!opts.light) {\n            if (nextRef >= 0) {\n                record.nextSegment = this.indexToChr[nextRef];\n                record.nextPos = nextPos;\n            }\n\n            var p = offset + 36 + nl;\n\n            var cigar = '';\n            for (var c = 0; c < nc; ++c) {\n                var cigop = readInt(ba, p);\n                cigar = cigar + (cigop >> 4) + CIGAR_DECODER[cigop & 0xf];\n                p += 4;\n            }\n            record.cigar = cigar;\n\n            var seq = '';\n            var seqBytes = lseq + 1 >> 1;\n            for (var j = 0; j < seqBytes; ++j) {\n                var sb = ba[p + j];\n                seq += SEQRET_DECODER[(sb & 0xf0) >> 4];\n                if (seq.length < lseq) seq += SEQRET_DECODER[sb & 0x0f];\n            }\n            p += seqBytes;\n            record.seq = seq;\n\n            var qseq = '';\n            for (var j = 0; j < lseq; ++j) {\n                qseq += String.fromCharCode(ba[p + j] + 33);\n            }\n            p += lseq;\n            record.quals = qseq;\n\n            while (p < blockEnd) {\n                var tag = String.fromCharCode(ba[p], ba[p + 1]);\n                var type = String.fromCharCode(ba[p + 2]);\n                var value;\n\n                if (type == 'A') {\n                    value = String.fromCharCode(ba[p + 3]);\n                    p += 4;\n                } else if (type == 'i' || type == 'I') {\n                    value = readInt(ba, p + 3);\n                    p += 7;\n                } else if (type == 'c' || type == 'C') {\n                    value = ba[p + 3];\n                    p += 4;\n                } else if (type == 's' || type == 'S') {\n                    value = readShort(ba, p + 3);\n                    p += 5;\n                } else if (type == 'f') {\n                    value = readFloat(ba, p + 3);\n                    p += 7;\n                } else if (type == 'Z' || type == 'H') {\n                    p += 3;\n                    value = '';\n                    for (;;) {\n                        var cc = ba[p++];\n                        if (cc == 0) {\n                            break;\n                        } else {\n                            value += String.fromCharCode(cc);\n                        }\n                    }\n                } else if (type == 'B') {\n                    var atype = String.fromCharCode(ba[p + 3]);\n                    var alen = readInt(ba, p + 4);\n                    var elen;\n                    var reader;\n                    if (atype == 'i' || atype == 'I' || atype == 'f') {\n                        elen = 4;\n                        if (atype == 'f') reader = readFloat;else reader = readInt;\n                    } else if (atype == 's' || atype == 'S') {\n                        elen = 2;\n                        reader = readShort;\n                    } else if (atype == 'c' || atype == 'C') {\n                        elen = 1;\n                        reader = readByte;\n                    } else {\n                        throw 'Unknown array type ' + atype;\n                    }\n\n                    p += 8;\n                    value = [];\n                    for (var i = 0; i < alen; ++i) {\n                        value.push(reader(ba, p));\n                        p += elen;\n                    }\n                } else {\n                    throw 'Unknown type ' + type;\n                }\n                record[tag] = value;\n            }\n        }\n\n        if (!min || record.pos <= max && record.pos + lseq >= min) {\n            if (chrId === undefined || refID == chrId) {\n                sink.push(record);\n            }\n        }\n        if (record.pos > max) {\n            return true;\n        }\n        offset = blockEnd;\n    }\n\n    // Exits via top of loop.\n};\n\nif (typeof module !== 'undefined') {\n    module.exports = {\n        makeCram: makeCram,\n        CRAM_MAGIC: CRAM_MAGIC,\n        CRAI_MAGIC: CRAI_MAGIC,\n        CramFlags: CramFlags\n    };\n}\n\n},{\"./bin\":4,\"./lh3utils\":27,\"./spans\":41,\"jszlib\":71}],11:[function(require,module,exports){\n/* -*- mode: javascript; c-basic-offset: 4; indent-tabs-mode: nil -*- */\n\n// \n// Dalliance Genome Explorer\n// (c) Thomas Down 2006-2010\n//\n// das.js: queries and low-level data model.\n//\n\n\"use strict\";\n\nif (typeof require !== 'undefined') {\n    var utils = require('./utils');\n    var shallowCopy = utils.shallowCopy;\n    var pusho = utils.pusho;\n\n    var color = require('./color');\n    var makeColourSteps = color.makeColourSteps;\n}\n\nvar dasLibErrorHandler = function dasLibErrorHandler(errMsg) {\n    alert(errMsg);\n};\nvar dasLibRequestQueue = new Array();\n\nfunction DASSegment(name, start, end, description) {\n    this.name = name;\n    this.start = start;\n    this.end = end;\n    this.description = description;\n}\nDASSegment.prototype.toString = function () {\n    return this.name + ':' + this.start + '..' + this.end;\n};\nDASSegment.prototype.isBounded = function () {\n    return this.start && this.end;\n};\nDASSegment.prototype.toDASQuery = function () {\n    var q = 'segment=' + this.name;\n    if (this.start && this.end) {\n        q += ':' + this.start + ',' + this.end;\n    }\n    return q;\n};\n\nfunction DASSource(a1, a2) {\n    var options;\n    if (typeof a1 == 'string') {\n        this.uri = a1;\n        options = a2 || {};\n    } else {\n        options = a1 || {};\n    }\n    for (var k in options) {\n        this[k] = options[k];\n    }\n\n    if (!this.coords) {\n        this.coords = [];\n    }\n    if (!this.props) {\n        this.props = {};\n    }\n\n    this.dasBaseURI = this.uri;\n    if (this.dasBaseURI && this.dasBaseURI.substr(this.uri.length - 1) != '/') {\n        this.dasBaseURI = this.dasBaseURI + '/';\n    }\n}\n\nDASSource.prototype.getURI = function (uri) {\n    if (this.resolver) {\n        return this.resolver(uri).then(function (urlOrObj) {\n            if (typeof urlOrObj === 'string') {\n                return urlOrObj;\n            } else {\n                return urlOrObj.url;\n            }\n        });\n    } else {\n        return Promise.resolve(uri);\n    }\n};\n\nfunction DASCoords() {}\n\nfunction coordsMatch(c1, c2) {\n    return c1.taxon == c2.taxon && c1.auth == c2.auth && c1.version == c2.version;\n}\n\n//\n// DAS 1.6 entry_points command\n//\n\nDASSource.prototype.entryPoints = function (callback) {\n    var dasURI = this.dasBaseURI + 'entry_points';\n    this.doCrossDomainRequest(dasURI, function (responseXML) {\n        if (!responseXML) {\n            return callback([]);\n        }\n\n        var entryPoints = new Array();\n\n        var segs = responseXML.getElementsByTagName('SEGMENT');\n        for (var i = 0; i < segs.length; ++i) {\n            var seg = segs[i];\n            var segId = seg.getAttribute('id');\n\n            var segSize = seg.getAttribute('size');\n            var segMin, segMax;\n            if (segSize) {\n                segMin = 1;segMax = segSize | 0;\n            } else {\n                segMin = seg.getAttribute('start');\n                if (segMin) {\n                    segMin |= 0;\n                }\n                segMax = seg.getAttribute('stop');\n                if (segMax) {\n                    segMax |= 0;\n                }\n            }\n            var segDesc = null;\n            if (seg.firstChild) {\n                segDesc = seg.firstChild.nodeValue;\n            }\n            entryPoints.push(new DASSegment(segId, segMin, segMax, segDesc));\n        }\n        callback(entryPoints);\n    });\n};\n\n//\n// DAS 1.6 sequence command\n// Do we need an option to fall back to the dna command?\n//\n\nfunction DASSequence(name, start, end, alpha, seq) {\n    this.name = name;\n    this.start = start;\n    this.end = end;\n    this.alphabet = alpha;\n    this.seq = seq;\n}\n\nDASSource.prototype.sequence = function (segment, callback) {\n    var dasURI = this.dasBaseURI + 'sequence?' + segment.toDASQuery();\n    this.doCrossDomainRequest(dasURI, function (responseXML) {\n        if (!responseXML) {\n            callback([]);\n            return;\n        } else {\n            var seqs = new Array();\n\n            var segs = responseXML.getElementsByTagName('SEQUENCE');\n            for (var i = 0; i < segs.length; ++i) {\n                var seg = segs[i];\n                var segId = seg.getAttribute('id');\n                var segMin = seg.getAttribute('start');\n                var segMax = seg.getAttribute('stop');\n                var segAlpha = 'DNA';\n                var segSeq = null;\n                if (seg.firstChild) {\n                    var rawSeq = seg.firstChild.nodeValue;\n                    segSeq = '';\n                    var idx = 0;\n                    while (true) {\n                        var space = rawSeq.indexOf('\\n', idx);\n                        if (space >= 0) {\n                            segSeq += rawSeq.substring(idx, space).toUpperCase();\n                            idx = space + 1;\n                        } else {\n                            segSeq += rawSeq.substring(idx).toUpperCase();\n                            break;\n                        }\n                    }\n                }\n                seqs.push(new DASSequence(segId, segMin, segMax, segAlpha, segSeq));\n            }\n\n            callback(seqs);\n        }\n    });\n};\n\n//\n// DAS 1.6 features command\n//\n\nfunction DASFeature() {}\n\nfunction DASGroup(id) {\n    if (id) this.id = id;\n}\n\nfunction DASLink(desc, uri) {\n    this.desc = desc;\n    this.uri = uri;\n}\n\nDASSource.prototype.features = function (segment, options, callback) {\n    options = options || {};\n    var thisB = this;\n\n    var dasURI;\n    if (this.features_uri) {\n        dasURI = this.features_uri;\n    } else {\n        var filters = [];\n\n        if (segment) {\n            filters.push(segment.toDASQuery());\n        } else if (options.group) {\n            var g = options.group;\n            if (typeof g == 'string') {\n                filters.push('group_id=' + g);\n            } else {\n                for (var gi = 0; gi < g.length; ++gi) {\n                    filters.push('group_id=' + g[gi]);\n                }\n            }\n        }\n\n        if (options.adjacent) {\n            var adj = options.adjacent;\n            if (typeof adj == 'string') {\n                adj = [adj];\n            }\n            for (var ai = 0; ai < adj.length; ++ai) {\n                filters.push('adjacent=' + adj[ai]);\n            }\n        }\n\n        if (options.type) {\n            if (typeof options.type == 'string') {\n                filters.push('type=' + options.type);\n            } else {\n                for (var ti = 0; ti < options.type.length; ++ti) {\n                    filters.push('type=' + options.type[ti]);\n                }\n            }\n        }\n\n        if (options.maxbins) {\n            filters.push('maxbins=' + options.maxbins);\n        }\n\n        if (filters.length > 0) {\n            dasURI = this.dasBaseURI + 'features?' + filters.join(';');\n        } else {\n            callback([], 'No filters specified');\n        }\n    }\n\n    this.doCrossDomainRequest(dasURI, function (responseXML, req) {\n        if (!responseXML) {\n            var msg;\n            if (req.status == 0) {\n                msg = 'server may not support CORS';\n            } else {\n                msg = 'status=' + req.status;\n            }\n            callback([], 'Failed request: ' + msg);\n            return;\n        }\n        /*      if (req) {\n                    var caps = req.getResponseHeader('X-DAS-Capabilties');\n                    if (caps) {\n                        alert(caps);\n                    }\n                } */\n\n        var features = new Array();\n        var segmentMap = {};\n\n        var segs = responseXML.getElementsByTagName('SEGMENT');\n        for (var si = 0; si < segs.length; ++si) {\n            var segmentXML = segs[si];\n            var segmentID = segmentXML.getAttribute('id');\n            segmentMap[segmentID] = {\n                min: segmentXML.getAttribute('start'),\n                max: segmentXML.getAttribute('stop')\n            };\n\n            var featureXMLs = segmentXML.getElementsByTagName('FEATURE');\n            for (var i = 0; i < featureXMLs.length; ++i) {\n                var feature = featureXMLs[i];\n                var dasFeature = new DASFeature();\n\n                dasFeature.segment = segmentID;\n                dasFeature.id = feature.getAttribute('id');\n                dasFeature.label = feature.getAttribute('label');\n\n                /*\n                                var childNodes = feature.childNodes;\n                                for (var c = 0; c < childNodes.length; ++c) {\n                                    var cn = childNodes[c];\n                                    if (cn.nodeType == Node.ELEMENT_NODE) {\n                                        var key = cn.tagName;\n                                        //var val = null;\n                                        //if (cn.firstChild) {\n                                        //   val = cn.firstChild.nodeValue;\n                                        //}\n                                        dasFeature[key] = 'x';\n                                    }\n                                } */\n\n                var spos = elementValue(feature, \"START\");\n                var epos = elementValue(feature, \"END\");\n                if ((spos | 0) > (epos | 0)) {\n                    dasFeature.min = epos | 0;\n                    dasFeature.max = spos | 0;\n                } else {\n                    dasFeature.min = spos | 0;\n                    dasFeature.max = epos | 0;\n                }\n                {\n                    var tec = feature.getElementsByTagName('TYPE');\n                    if (tec.length > 0) {\n                        var te = tec[0];\n                        if (te.firstChild) {\n                            dasFeature.type = te.firstChild.nodeValue;\n                        }\n                        dasFeature.typeId = te.getAttribute('id');\n                        dasFeature.typeCv = te.getAttribute('cvId');\n                    }\n                }\n                dasFeature.type = elementValue(feature, \"TYPE\");\n                if (!dasFeature.type && dasFeature.typeId) {\n                    dasFeature.type = dasFeature.typeId; // FIXME?\n                }\n\n                dasFeature.method = elementValue(feature, \"METHOD\");\n                {\n                    var ori = elementValue(feature, \"ORIENTATION\");\n                    if (!ori) {\n                        ori = '0';\n                    }\n                    dasFeature.orientation = ori;\n                }\n                dasFeature.score = elementValue(feature, \"SCORE\");\n                dasFeature.links = dasLinksOf(feature);\n                dasFeature.notes = dasNotesOf(feature);\n\n                var groups = feature.getElementsByTagName(\"GROUP\");\n                for (var gi = 0; gi < groups.length; ++gi) {\n                    var groupXML = groups[gi];\n                    var dasGroup = new DASGroup();\n                    dasGroup.type = groupXML.getAttribute('type');\n                    dasGroup.id = groupXML.getAttribute('id');\n                    dasGroup.links = dasLinksOf(groupXML);\n                    dasGroup.notes = dasNotesOf(groupXML);\n                    if (!dasFeature.groups) {\n                        dasFeature.groups = new Array(dasGroup);\n                    } else {\n                        dasFeature.groups.push(dasGroup);\n                    }\n                }\n\n                // Magic notes.  Check with TAD before changing this.\n                if (dasFeature.notes) {\n                    for (var ni = 0; ni < dasFeature.notes.length; ++ni) {\n                        var n = dasFeature.notes[ni];\n                        if (n.indexOf('Genename=') == 0) {\n                            var gg = new DASGroup();\n                            gg.type = 'gene';\n                            gg.id = n.substring(9);\n                            if (!dasFeature.groups) {\n                                dasFeature.groups = new Array(gg);\n                            } else {\n                                dasFeature.groups.push(gg);\n                            }\n                        }\n                    }\n                }\n\n                {\n                    var pec = feature.getElementsByTagName('PART');\n                    if (pec.length > 0) {\n                        var parts = [];\n                        for (var pi = 0; pi < pec.length; ++pi) {\n                            parts.push(pec[pi].getAttribute('id'));\n                        }\n                        dasFeature.parts = parts;\n                    }\n                }\n                {\n                    var pec = feature.getElementsByTagName('PARENT');\n                    if (pec.length > 0) {\n                        var parents = [];\n                        for (var pi = 0; pi < pec.length; ++pi) {\n                            parents.push(pec[pi].getAttribute('id'));\n                        }\n                        dasFeature.parents = parents;\n                    }\n                }\n\n                features.push(dasFeature);\n            }\n        }\n\n        callback(features, undefined, segmentMap);\n    }, function (err) {\n        callback([], err);\n    });\n};\n\nfunction DASAlignment(type) {\n    this.type = type;\n    this.objects = {};\n    this.blocks = [];\n}\n\nDASSource.prototype.alignments = function (segment, options, callback) {\n    var dasURI = this.dasBaseURI + 'alignment?query=' + segment;\n    this.doCrossDomainRequest(dasURI, function (responseXML) {\n        if (!responseXML) {\n            callback([], 'Failed request ' + dasURI);\n            return;\n        }\n\n        var alignments = [];\n        var aliXMLs = responseXML.getElementsByTagName('alignment');\n        for (var ai = 0; ai < aliXMLs.length; ++ai) {\n            var aliXML = aliXMLs[ai];\n            var ali = new DASAlignment(aliXML.getAttribute('alignType'));\n            var objXMLs = aliXML.getElementsByTagName('alignObject');\n            for (var oi = 0; oi < objXMLs.length; ++oi) {\n                var objXML = objXMLs[oi];\n                var obj = {\n                    id: objXML.getAttribute('intObjectId'),\n                    accession: objXML.getAttribute('dbAccessionId'),\n                    version: objXML.getAttribute('objectVersion'),\n                    dbSource: objXML.getAttribute('dbSource'),\n                    dbVersion: objXML.getAttribute('dbVersion')\n                };\n                ali.objects[obj.id] = obj;\n            }\n\n            var blockXMLs = aliXML.getElementsByTagName('block');\n            for (var bi = 0; bi < blockXMLs.length; ++bi) {\n                var blockXML = blockXMLs[bi];\n                var block = {\n                    order: blockXML.getAttribute('blockOrder'),\n                    segments: []\n                };\n                var segXMLs = blockXML.getElementsByTagName('segment');\n                for (var si = 0; si < segXMLs.length; ++si) {\n                    var segXML = segXMLs[si];\n                    var seg = {\n                        object: segXML.getAttribute('intObjectId'),\n                        min: segXML.getAttribute('start'),\n                        max: segXML.getAttribute('end'),\n                        strand: segXML.getAttribute('strand'),\n                        cigar: elementValue(segXML, 'cigar')\n                    };\n                    block.segments.push(seg);\n                }\n                ali.blocks.push(block);\n            }\n\n            alignments.push(ali);\n        }\n        callback(alignments);\n    });\n};\n\nfunction DASStylesheet() {\n    this.styles = [];\n}\n\nDASStylesheet.prototype.pushStyle = function (filters, zoom, style) {\n    if (!filters) {\n        filters = { type: 'default' };\n    }\n    var styleHolder = shallowCopy(filters);\n    if (zoom) {\n        styleHolder.zoom = zoom;\n    }\n    styleHolder.style = style;\n    this.styles.push(styleHolder);\n};\n\nfunction DASStyle() {}\n\nfunction parseGradient(grad) {\n    var steps = grad.getAttribute('steps');\n    if (steps) {\n        steps = steps | 0;\n    } else {\n        steps = 50;\n    }\n\n    var stops = [];\n    var colors = [];\n    var se = grad.getElementsByTagName('STOP');\n    for (var si = 0; si < se.length; ++si) {\n        var stop = se[si];\n        stops.push(1.0 * stop.getAttribute('score'));\n        colors.push(stop.firstChild.nodeValue);\n    }\n\n    return makeColourSteps(steps, stops, colors);\n}\n\nDASSource.prototype.stylesheet = function (successCB, failureCB) {\n    var dasURI,\n        creds = this.credentials;\n    if (this.stylesheet_uri) {\n        dasURI = this.stylesheet_uri;\n        creds = false;\n    } else {\n        dasURI = this.dasBaseURI + 'stylesheet';\n    }\n\n    this.getURI(dasURI).then(function (dasURI) {\n        doCrossDomainRequest(dasURI, function (responseXML) {\n            if (!responseXML) {\n                if (failureCB) {\n                    failureCB();\n                }\n                return;\n            }\n            var stylesheet = new DASStylesheet();\n            var typeXMLs = responseXML.getElementsByTagName('TYPE');\n            for (var i = 0; i < typeXMLs.length; ++i) {\n                var typeStyle = typeXMLs[i];\n\n                var filter = {};\n                filter.type = typeStyle.getAttribute('id'); // Am I right in thinking that this makes DASSTYLE XML invalid?  Ugh.\n                filter.label = typeStyle.getAttribute('label');\n                filter.method = typeStyle.getAttribute('method');\n                var glyphXMLs = typeStyle.getElementsByTagName('GLYPH');\n                for (var gi = 0; gi < glyphXMLs.length; ++gi) {\n                    var glyphXML = glyphXMLs[gi];\n                    var zoom = glyphXML.getAttribute('zoom');\n                    var glyph = childElementOf(glyphXML);\n                    var style = new DASStyle();\n                    style.glyph = glyph.localName;\n                    var child = glyph.firstChild;\n\n                    while (child) {\n                        if (child.nodeType == Node.ELEMENT_NODE) {\n                            if (child.localName == 'BGGRAD') {\n                                style[child.localName] = parseGradient(child);\n                            } else {\n                                style[child.localName] = child.firstChild.nodeValue;\n                            }\n                        }\n                        child = child.nextSibling;\n                    }\n                    stylesheet.pushStyle(filter, zoom, style);\n                }\n            }\n            successCB(stylesheet);\n        }, creds);\n    }).catch(function (err) {\n        console.log(err);\n        failureCB();\n    });\n};\n\n//\n// sources command\n// \n\nfunction DASRegistry(uri, opts) {\n    opts = opts || {};\n    this.uri = uri;\n    this.opts = opts;\n}\n\nDASRegistry.prototype.sources = function (callback, failure, opts) {\n    if (!opts) {\n        opts = {};\n    }\n\n    var filters = [];\n    if (opts.taxon) {\n        filters.push('organism=' + opts.taxon);\n    }\n    if (opts.auth) {\n        filters.push('authority=' + opts.auth);\n    }\n    if (opts.version) {\n        filters.push('version=' + opts.version);\n    }\n    var quri = this.uri;\n    if (filters.length > 0) {\n        quri = quri + '?' + filters.join('&'); // '&' as a separator to hack around dasregistry.org bug.\n    }\n\n    doCrossDomainRequest(quri, function (responseXML) {\n        if (!responseXML && failure) {\n            failure();\n            return;\n        }\n\n        var sources = [];\n        var sourceXMLs = responseXML.getElementsByTagName('SOURCE');\n        for (var si = 0; si < sourceXMLs.length; ++si) {\n            var sourceXML = sourceXMLs[si];\n            var versionXMLs = sourceXML.getElementsByTagName('VERSION');\n            if (versionXMLs.length < 1) {\n                continue;\n            }\n            var versionXML = versionXMLs[0];\n\n            var coordXMLs = versionXML.getElementsByTagName('COORDINATES');\n            var coords = [];\n            for (var ci = 0; ci < coordXMLs.length; ++ci) {\n                var coordXML = coordXMLs[ci];\n                var coord = new DASCoords();\n                coord.auth = coordXML.getAttribute('authority');\n                coord.taxon = coordXML.getAttribute('taxid');\n                coord.version = coordXML.getAttribute('version');\n                coords.push(coord);\n            }\n\n            var caps = [];\n            var capXMLs = versionXML.getElementsByTagName('CAPABILITY');\n            var uri;\n            for (var ci = 0; ci < capXMLs.length; ++ci) {\n                var capXML = capXMLs[ci];\n\n                caps.push(capXML.getAttribute('type'));\n\n                if (capXML.getAttribute('type') == 'das1:features') {\n                    var fep = capXML.getAttribute('query_uri');\n                    uri = fep.substring(0, fep.length - 'features'.length);\n                }\n            }\n\n            var props = {};\n            var propXMLs = versionXML.getElementsByTagName('PROP');\n            for (var pi = 0; pi < propXMLs.length; ++pi) {\n                pusho(props, propXMLs[pi].getAttribute('name'), propXMLs[pi].getAttribute('value'));\n            }\n\n            if (uri) {\n                var source = new DASSource(uri, {\n                    source_uri: sourceXML.getAttribute('uri'),\n                    name: sourceXML.getAttribute('title'),\n                    desc: sourceXML.getAttribute('description'),\n                    coords: coords,\n                    props: props,\n                    capabilities: caps\n                });\n                sources.push(source);\n            }\n        }\n\n        callback(sources);\n    });\n};\n\n//\n// Utility functions\n//\n\nfunction elementValue(element, tag) {\n    var children = element.getElementsByTagName(tag);\n    if (children.length > 0 && children[0].firstChild) {\n        var c = children[0];\n        if (c.childNodes.length == 1) {\n            return c.firstChild.nodeValue;\n        } else {\n            var s = '';\n            for (var ni = 0; ni < c.childNodes.length; ++ni) {\n                s += c.childNodes[ni].nodeValue;\n            }\n            return s;\n        }\n    } else {\n        return null;\n    }\n}\n\nfunction childElementOf(element) {\n    if (element.hasChildNodes()) {\n        var child = element.firstChild;\n        do {\n            if (child.nodeType == Node.ELEMENT_NODE) {\n                return child;\n            }\n            child = child.nextSibling;\n        } while (child != null);\n    }\n    return null;\n}\n\nfunction dasLinksOf(element) {\n    var links = new Array();\n    var maybeLinkChilden = element.getElementsByTagName('LINK');\n    for (var ci = 0; ci < maybeLinkChilden.length; ++ci) {\n        var linkXML = maybeLinkChilden[ci];\n        if (linkXML.parentNode == element) {\n            links.push(new DASLink(linkXML.firstChild ? linkXML.firstChild.nodeValue : 'Unknown', linkXML.getAttribute('href')));\n        }\n    }\n\n    return links;\n}\n\nfunction dasNotesOf(element) {\n    var notes = [];\n    var maybeNotes = element.getElementsByTagName('NOTE');\n    for (var ni = 0; ni < maybeNotes.length; ++ni) {\n        if (maybeNotes[ni].firstChild) {\n            notes.push(maybeNotes[ni].firstChild.nodeValue);\n        }\n    }\n    return notes;\n}\n\nfunction doCrossDomainRequest(url, handler, credentials, custAuth) {\n    // TODO: explicit error handlers?\n\n    if (window.XDomainRequest) {\n        var req = new XDomainRequest();\n        req.onload = function () {\n            var dom = new ActiveXObject(\"Microsoft.XMLDOM\");\n            dom.async = false;\n            dom.loadXML(req.responseText);\n            handler(dom);\n        };\n        req.open(\"get\", url);\n        req.send();\n    } else {\n        try {\n            var req = new XMLHttpRequest();\n            var timeout = setTimeout(function () {\n                console.log('timing out ' + url);\n                req.abort();\n                handler(null, req);\n            }, 5000);\n\n            req.ontimeout = function () {\n                console.log('timeout on ' + url);\n            };\n\n            req.onreadystatechange = function () {\n                if (req.readyState == 4) {\n                    clearTimeout(timeout);\n                    if (req.status >= 200 || req.status == 0) {\n                        handler(req.responseXML, req);\n                    }\n                }\n            };\n            req.open(\"get\", url, true);\n            // IE10/11 fix: The timeout property may be set only in the time interval between a call to the open method\n            //              and the first call to the send method.\n            req.timeout = 5000;\n            if (credentials) {\n                req.withCredentials = true;\n            }\n            if (custAuth) {\n                req.setRequestHeader('X-DAS-Authorisation', custAuth);\n            }\n            req.overrideMimeType('text/xml');\n            req.setRequestHeader('Accept', 'application/xml,*/*');\n            req.send();\n        } catch (e) {\n            handler(null, req, e);\n        }\n    }\n}\n\nDASSource.prototype.doCrossDomainRequest = function (url, handler, errHandler) {\n    var custAuth;\n    if (this.xUser) {\n        custAuth = 'Basic ' + btoa(this.xUser + ':' + this.xPass);\n    }\n\n    try {\n        return doCrossDomainRequest(url, handler, this.credentials, custAuth);\n    } catch (err) {\n        if (errHandler) {\n            errHandler(err);\n        } else {\n            throw err;\n        }\n    }\n};\n\nfunction isDasBooleanTrue(s) {\n    s = ('' + s).toLowerCase();\n    return s === 'yes' || s === 'true';\n}\n\nfunction isDasBooleanNotFalse(s) {\n    if (!s) return false;\n\n    s = ('' + s).toLowerCase();\n    return s !== 'no' || s !== 'false';\n}\n\nfunction copyStylesheet(ss) {\n    var nss = shallowCopy(ss);\n    nss.styles = [];\n    for (var si = 0; si < ss.styles.length; ++si) {\n        var sh = nss.styles[si] = shallowCopy(ss.styles[si]);\n        sh._methodRE = sh._labelRE = sh._typeRE = undefined;\n        sh.style = shallowCopy(sh.style);\n        sh.style.id = undefined;\n        sh.style._gradient = undefined;\n    }\n    return nss;\n}\n\nif (typeof module !== 'undefined') {\n    module.exports = {\n        DASGroup: DASGroup,\n        DASFeature: DASFeature,\n        DASStylesheet: DASStylesheet,\n        DASStyle: DASStyle,\n        DASSource: DASSource,\n        DASSegment: DASSegment,\n        DASRegistry: DASRegistry,\n        DASSequence: DASSequence,\n        DASLink: DASLink,\n\n        isDasBooleanTrue: isDasBooleanTrue,\n        isDasBooleanNotFalse: isDasBooleanNotFalse,\n        copyStylesheet: copyStylesheet,\n        coordsMatch: coordsMatch\n    };\n}\n\n},{\"./color\":9,\"./utils\":56}],12:[function(require,module,exports){\n/* jshint esversion: 6 */\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\nexports.paintQuant = exports.createQuantOverlay = exports.clearViewport = exports.drawUnmapped = exports.paint = exports.prepareViewport = exports.prepareSubtiers = exports.drawTier = exports.renderTier = undefined;\n\nvar _slicedToArray = function () { function sliceIterator(arr, i) { var _arr = []; var _n = true; var _d = false; var _e = undefined; try { for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i[\"return\"]) _i[\"return\"](); } finally { if (_d) throw _e; } } return _arr; } return function (arr, i) { if (Array.isArray(arr)) { return arr; } else if (Symbol.iterator in Object(arr)) { return sliceIterator(arr, i); } else { throw new TypeError(\"Invalid attempt to destructure non-iterable instance\"); } }; }();\n\nvar _featureDraw = require(\"./feature-draw.js\");\n\nvar _sequenceDraw = require(\"./sequence-draw.js\");\n\nvar _spans = require(\"./spans.js\");\n\nvar _utils = require(\"./utils.js\");\n\nvar _glyphs = require(\"./glyphs.js\");\n\nvar Glyphs = _interopRequireWildcard(_glyphs);\n\nvar _das = require(\"./das.js\");\n\nvar _color = require(\"./color.js\");\n\nvar _cigar = require(\"./cigar.js\");\n\nvar _numformats = require(\"./numformats\");\n\nvar _ramda = require(\"ramda\");\n\nvar R = _interopRequireWildcard(_ramda);\n\nfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }\n\n// The only functions that must be exported by a renderer are renderTier\n// and drawTier, the rest are exported for use in other renderers.\nexports.renderTier = renderTier;\nexports.drawTier = drawTier;\nexports.prepareSubtiers = prepareSubtiers;\nexports.prepareViewport = prepareViewport;\nexports.paint = paint;\nexports.drawUnmapped = drawUnmapped;\nexports.clearViewport = clearViewport;\nexports.createQuantOverlay = createQuantOverlay;\nexports.paintQuant = paintQuant;\n\n\nfunction renderTier(status, tier) {\n    drawTier(tier);\n    tier.updateStatus(status);\n}\n\nfunction drawTier(tier) {\n    var canvas = tier.viewport.getContext(\"2d\");\n    var retina = tier.browser.retina && window.devicePixelRatio > 1;\n\n    if (tier.sequenceSource) {\n        var sequence = tier.currentSequence;\n        (0, _sequenceDraw.drawSeqTier)(tier, sequence);\n    } else if (tier.currentFeatures) {\n        prepareSubtiers(tier, canvas);\n    } else {\n        console.log(\"No sequence or features in tier!\");\n    }\n\n    if (tier.subtiers) {\n        var vOffset = R.defaultTo(0, tier.dasSource.vOffset);\n\n        prepareViewport(tier, canvas, retina, true, vOffset); // NB calls canvas.save\n        paint(tier, canvas, vOffset);\n        canvas.restore();\n    }\n\n    tier.drawOverlay();\n    tier.paintQuant();\n\n    if (typeof tier.dasSource.drawCallback === \"function\") {\n        tier.dasSource.drawCallback(canvas, tier);\n    }\n\n    tier.originHaxx = 0;\n    tier.browser.arrangeTiers();\n}\n\nfunction glyphsForGroup(canvas, features, y, groupElement, tier) {\n    var gstyle = tier.styleForFeature(groupElement);\n    var label = void 0;\n    var labelWanted = false;\n\n    var glyphs = [];\n    var strand = null;\n\n    features.forEach(function (f) {\n        if (f.orientation && strand === null) {\n            strand = f.orientation;\n        }\n\n        if (!label && f.label) {\n            label = f.label;\n        }\n\n        var style = tier.styleForFeature(f);\n        if (style && !f.parts) {\n            if ((0, _das.isDasBooleanTrue)(style.LABEL)) labelWanted = true;\n\n            var glyph = glyphForFeature(canvas, f, y, style, tier, null, true);\n            if (glyph) glyphs.push(glyph);\n        }\n    });\n\n    if (glyphs.length === 0) return null;\n\n    var connector = 'flat';\n    if (gstyle && gstyle.glyph === 'LINE') {\n        // Stick with flat...\n    } else {\n        if (tier.dasSource.collapseSuperGroups && !tier.bumped) {\n            if (strand === '+' || strand === '-') {\n                connector = 'collapsed' + strand;\n            }\n        } else {\n            if (strand === '+' || strand === '-') {\n                connector = 'hat' + strand;\n            }\n        }\n    }\n\n    var labelText = null;\n    if (label && labelWanted || gstyle && ((0, _das.isDasBooleanTrue)(gstyle.LABEL) || (0, _das.isDasBooleanTrue)(gstyle.LABELS))) {\n        // HACK, LABELS should work.\n        labelText = groupElement.label || label;\n    }\n\n    glyphs.sort(function (g1, g2) {\n        return (g1.zindex || 0) - (g2.zindex || 0);\n    });\n\n    var groupGlyph = new Glyphs.GroupGlyph(glyphs, connector);\n    if (labelText) {\n        if (strand === '+') {\n            labelText = '>' + labelText;\n        } else if (strand === '-') {\n            labelText = '<' + labelText;\n        }\n        groupGlyph = new Glyphs.LabelledGlyph(canvas, groupGlyph, labelText, false);\n    }\n    groupGlyph.bump = true;\n    return groupGlyph;\n}\n\nfunction glyphForFeature(canvas, feature, y, style, tier, forceHeight, noLabel) {\n    var scale = tier.browser.scale;\n    var origin = tier.browser.viewStart;\n    var glyphType = style.glyph || 'BOX';\n\n    var min = feature.min;\n    var max = feature.max;\n    var strand = feature.orientation;\n    var score = feature.score;\n    var label = feature.label || feature.id;\n\n    // Hide glyphs that are smaller than a pixel in width.\n    if (tier.dasSource.hideSubpixelGlyphs && (max - min) * scale < 1) return null;\n\n    var minPos = (min - origin) * scale;\n    var rawMaxPos = (max - origin + 1) * scale;\n    var maxPos = Math.max(rawMaxPos, minPos + 1);\n\n    forceHeight = forceHeight * 1.0;\n    var height = (tier.forceHeight || style.HEIGHT || forceHeight || 12) * 1.0;\n    height = height * 1.0;\n    var bump = style.BUMP && (0, _das.isDasBooleanTrue)(style.BUMP);\n\n    var glyph = void 0;\n    var quant = void 0;\n\n    // Create the glyph\n    if (glyphType === 'CROSS' || glyphType === 'EX' || glyphType === 'TRIANGLE' || glyphType === 'DOT' || glyphType === 'SQUARE' || glyphType === 'STAR' || glyphType === 'PLIMSOLL') {\n        var glyphHolder = featureToCrossLikeGlyph(canvas, tier, feature, y, glyphType, style, forceHeight, noLabel);\n        if (glyphHolder) {\n            var _glyphHolder = _slicedToArray(glyphHolder, 2);\n\n            glyph = _glyphHolder[0];\n            quant = _glyphHolder[1];\n        }\n    } else if (glyphType === 'HISTOGRAM' || glyphType === 'GRADIENT' && score !== 'undefined') {\n        var _featureToGradientLik = featureToGradientLikeGlyph(canvas, tier, feature, y, glyphType, style, forceHeight);\n\n        var _featureToGradientLik2 = _slicedToArray(_featureToGradientLik, 2);\n\n        glyph = _featureToGradientLik2[0];\n        quant = _featureToGradientLik2[1];\n    } else if (glyphType === 'HIDDEN') {\n        glyph = new Glyphs.PaddedGlyph(null, minPos, maxPos);\n        noLabel = true;\n    } else if (glyphType === 'ARROW') {\n        var color = style.FGCOLOR || 'purple';\n        var parallel = (0, _das.isDasBooleanTrue)(style.PARALLEL);\n        var sw = (0, _das.isDasBooleanTrue)(style.SOUTHWEST);\n        var ne = (0, _das.isDasBooleanTrue)(style.NORTHEAST);\n        glyph = new Glyphs.ArrowGlyph(minPos, maxPos, height, color, parallel, sw, ne);\n    } else if (glyphType === 'ANCHORED_ARROW') {\n        var stroke = style.FGCOLOR || 'none';\n        var fill = style.BGCOLOR || 'green';\n        glyph = new Glyphs.AArrowGlyph(minPos, maxPos, height, fill, stroke, strand);\n        glyph.bump = true;\n    } else if (glyphType === 'SPAN') {\n        var _stroke = style.FGCOLOR || 'black';\n        glyph = new Glyphs.SpanGlyph(minPos, maxPos, height, _stroke);\n    } else if (glyphType === 'LINE') {\n        var _stroke2 = style.FGCOLOR || 'black';\n        var lineStyle = style.STYLE || 'solid';\n        glyph = new Glyphs.LineGlyph(minPos, maxPos, height, lineStyle, strand, _stroke2);\n    } else if (glyphType === 'PRIMERS') {\n        var _stroke3 = style.FGCOLOR || 'black';\n        var _fill = style.BGCOLOR || 'red';\n        glyph = new Glyphs.PrimersGlyph(minPos, maxPos, height, _fill, _stroke3);\n    } else if (glyphType === 'TEXT') {\n        var string = style.STRING || 'text';\n        var _fill2 = style.FGCOLOR || 'black';\n        glyph = new Glyphs.TextGlyph(canvas, minPos, maxPos, height, _fill2, string);\n    } else if (glyphType === 'TOOMANY') {\n        var _stroke4 = style.FGCOLOR || 'gray';\n        var _fill3 = style.BGCOLOR || 'orange';\n        glyph = new Glyphs.TooManyGlyph(minPos, maxPos, height, _fill3, _stroke4);\n    } else if (glyphType === 'POINT') {\n        var _featureToPointGlyph = featureToPointGlyph(tier, feature, style);\n\n        var _featureToPointGlyph2 = _slicedToArray(_featureToPointGlyph, 2);\n\n        glyph = _featureToPointGlyph2[0];\n        quant = _featureToPointGlyph2[1];\n    } else if (glyphType === '__SEQUENCE') {\n        glyph = sequenceGlyph(canvas, tier, feature, style, forceHeight);\n    } else if (glyphType === '__INSERTION') {\n        var insertionLabels = true;\n        if (style.__INSERTIONS !== undefined) insertionLabels = (0, _das.isDasBooleanNotFalse)(style.__INSERTIONS);\n        glyph = new Glyphs.TriangleGlyph(minPos, 5, 'S', 5, tier.browser.baseColors['I']);\n        if (insertionLabels) glyph = new Glyphs.LabelledGlyph(canvas, glyph, feature.insertion || feature.altAlleles[0], false, 'center', 'above', '7px sans-serif');\n\n        if (maxPos - minPos > 1) {\n            var _stroke5 = style.FGCOLOR || 'red';\n            var _fill4 = style.BGCOLOR || style.COLOR1 || 'green';\n            var bg = new Glyphs.BoxGlyph(minPos, 5, maxPos - minPos, height, _fill4, _stroke5);\n            glyph = new Glyphs.GroupGlyph([bg, glyph]);\n        }\n    } else if (glyphType === '__NONE') {\n        return null;\n    } else if (glyphType === 'BOX') {\n        var _stroke6 = style.FGCOLOR || null;\n        var _fill5 = style.BGCOLOR || style.COLOR1 || 'green';\n        if (style.BGITEM && feature.itemRgb) _fill5 = feature.itemRgb;\n        var _scale = (maxPos - minPos) / (max - min);\n        if (feature.type == 'translation' && (feature.method == 'protein_coding' || feature.readframeExplicit) && (!feature.tags || feature.tags.indexOf('cds_start_NF') < 0 || feature.readframeExplicit) && (!tier.dasSource.collapseSuperGroups || tier.bumped) && _scale >= 0.5) {\n            var refSeq = getRefSeq(tier, min, max);\n            glyph = new Glyphs.AminoAcidGlyph(minPos, maxPos, height, _fill5, refSeq, feature.orientation, feature.readframe);\n        } else {\n            glyph = new Glyphs.BoxGlyph(minPos, 0, maxPos - minPos, height, _fill5, _stroke6);\n        }\n    }\n\n    if (!glyph) return;\n\n    if (((0, _das.isDasBooleanTrue)(style.LABEL) || feature.forceLabel) && label && !noLabel) {\n        glyph = new Glyphs.LabelledGlyph(canvas, glyph, label, false);\n    }\n\n    if (bump) {\n        glyph.bump = true;\n    }\n\n    glyph.feature = feature;\n\n    if ((0, _das.isDasBooleanTrue)(style[\"HIDEAXISLABEL\"])) quant = null;\n\n    if (quant) {\n        glyph.quant = quant;\n    }\n\n    if (style.ZINDEX) {\n        glyph.zindex = style.ZINDEX | 0;\n    }\n\n    return glyph;\n}\n\nfunction groupFeatures(tier, canvas, y) {\n    var glyphs = [];\n    var gbsFeatures = {};\n    var gbsStyles = {};\n    var stackedFeatures = [];\n\n    R.map(function (features) {\n        features.forEach(function (feature) {\n            var style = tier.styleForFeature(feature);\n\n            if (feature.parts || !style) return;\n\n            if (style.glyph === 'LINEPLOT') {\n                (0, _utils.pusho)(gbsFeatures, style.id, feature);\n                gbsStyles[style.id] = style;\n            } else if (style.glyph === 'STACKED') {\n                stackedFeatures.push(feature);\n            } else {\n                var glyph = glyphForFeature(canvas, feature, y, style, tier);\n                if (glyph) glyphs.push(glyph);\n            }\n        });\n    }, tier.ungroupedFeatures);\n\n    if (stackedFeatures.length > 0) {\n        glyphs = glyphs.concat(makeStackedBars(stackedFeatures, tier));\n    }\n\n    for (var gbs in gbsFeatures) {\n        var gf = gbsFeatures[gbs];\n        var style = gbsStyles[gbs];\n        if (style.glyph === 'LINEPLOT') {\n            var lineGraphGlyphs = makeLinePlot(gf, style, tier, y);\n            lineGraphGlyphs.forEach(function (g) {\n                return glyphs.push(g);\n            });\n        }\n    }\n\n    return glyphs;\n}\n\nfunction glyphifyGroups(tier, canvas, glyphs, y) {\n    var groupIds = Object.keys(tier.groupedFeatures);\n    var groupGlyphs = {};\n\n    groupIds.sort(function (g1, g2) {\n        return tier.groupedFeatures[g2][0].score - tier.groupedFeatures[g1][0].score;\n    });\n\n    groupIds.forEach(function (gId) {\n        var glyphs = glyphsForGroup(canvas, tier.groupedFeatures[gId], y, tier.groups[gId], tier, tier.dasSource.collapseSuperGroups && !tier.bumped ? 'collapsed_gene' : 'tent');\n\n        if (glyphs) {\n            glyphs.group = tier.groups[gId];\n            groupGlyphs[gId] = glyphs;\n        }\n    });\n\n    return groupGlyphs;\n}\n\nfunction bumpSubtiers(tier, glyphs, grid, gridOffset, gridSpacing) {\n    var subtierMax = tier.subtierMax || tier.dasSource.subtierMax || tier.browser.defaultSubtierMax;\n\n    var subtiersExceeded = false;\n\n    var unbumpedST = new _featureDraw.SubTier();\n    var bumpedSTs = [];\n\n    // We want to add each glyph to either the subtier\n    // containing unbumped subtiers, or to the first bumped subtier.\n    glyphs.forEach(function (glyph) {\n        // if the glyph is to be bumped...\n        if (glyph.bump && (tier.bumped || tier.dasSource.collapseSuperGroups)) {\n\n            var glyphTier = bumpedSTs.find(function (st) {\n                return st.hasSpaceFor(glyph);\n            });\n\n            if (glyphTier) {\n                glyphTier.add(glyph);\n            } else if (bumpedSTs.length >= subtierMax) {\n                subtiersExceeded = true;\n            } else {\n                var subtier = new _featureDraw.SubTier();\n                subtier.add(glyph);\n                bumpedSTs.push(subtier);\n            }\n        } else {\n            unbumpedST.add(glyph);\n        }\n    });\n\n    if (unbumpedST.glyphs.length > 0) {\n        bumpedSTs = [unbumpedST].concat(bumpedSTs);\n    }\n\n    // Simple hack to make the horizontal grid in bumped subtiers (e.g. lineplots)\n    // optional and configurable.\n    if (grid) {\n        bumpedSTs.forEach(function (subtier) {\n            if (subtier.quant) {\n                subtier.glyphs.unshift(new Glyphs.GridGlyph(subtier.height, gridOffset, gridSpacing));\n            }\n        });\n    }\n\n    bumpedSTs.forEach(function (subtier) {\n        subtier.glyphs.sort(function (g1, g2) {\n            return (g1.zindex || 0) - (g2.zindex || 0);\n        });\n    });\n\n    return [bumpedSTs, subtiersExceeded];\n}\n\n// The whole tier is translated downward on its canvas by y pixels\nfunction prepareSubtiers(tier, canvas) {\n    var y = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 0;\n    var grid = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : true;\n\n\n    var MIN_PADDING = 3;\n    tier.padding = typeof tier.dasSource.padding === 'number' ? tier.dasSource.padding : MIN_PADDING;\n\n    tier.scaleVertical = typeof tier.dasSource.scaleVertical === 'boolean' ? tier.dasSource.scaleVertical : false;\n\n    var glyphs = groupFeatures(tier, canvas, y);\n\n    // Merge supergroups\n    if (tier.dasSource.collapseSuperGroups && !tier.bumped) {\n        var _loop = function _loop(sgId) {\n            var sgGroup = tier.superGroups[sgId];\n            tier.groups[sgId] = (0, _utils.shallowCopy)(tier.groups[sgId]);\n            var group = tier.groups[sgId];\n            group.isSuperGroup = true;\n            var featuresByType = {};\n\n            var sgMin = 10000000000,\n                sgMax = -10000000000;\n            var sgSeg = null;\n\n            sgGroup.forEach(function (g, i) {\n                var groupedFeature = tier.groupedFeatures[sgGroup[i]];\n                if (!groupedFeature) return;\n\n                groupedFeature.forEach(function (feature) {\n                    (0, _utils.pusho)(featuresByType, feature.type, feature);\n                    sgMin = Math.min(feature.min, sgMin);\n                    sgMax = Math.max(feature.max, sgMax);\n                    if (feature.segment && !sgSeg) sgSeg = feature.segment;\n                });\n\n                if (group && !group.links || group.links.length === 0) {\n                    group.links = tier.groups[sgGroup[0]].links;\n                }\n\n                delete tier.groupedFeatures[sgGroup[i]];\n            });\n\n            tier.groups[sgId].max = sgMax;\n            tier.groups[sgId].min = sgMin;\n            tier.groups[sgId].segment = sgSeg;\n\n            R.map(function (features) {\n\n                var template = features[0];\n                var loc = null;\n\n                features.forEach(function (feature) {\n                    var fl = new _spans.Range(feature.min, feature.max);\n                    loc = loc ? (0, _spans.union)(loc, fl) : fl;\n                });\n\n                var mergedRanges = loc.ranges();\n\n                mergedRanges.forEach(function (range) {\n                    var posCoverage = ((range.max() | 0) - (range.min() | 0) + 1) * sgGroup.length;\n                    var actCoverage = 0;\n\n                    features.forEach(function (feature) {\n                        var fmin = feature.min || 0;\n                        var fmax = feature.max || 0;\n                        if (fmin <= range.max() && fmax >= range.min()) {\n\n                            actCoverage += Math.min(fmax, range.max()) - Math.max(fmin, range.min()) + 1;\n                        }\n                    });\n\n                    var newFeature = new _das.DASFeature();\n                    for (var key in template) {\n                        newFeature[key] = template[key];\n                    }\n\n                    newFeature.min = range.min();\n                    newFeature.max = range.max();\n                    if (newFeature.label && sgGroup.length > 1) {\n                        newFeature.label += ' (' + sgGroup.length + ' vars)';\n                    }\n\n                    newFeature.visualWeight = 1.0 * actCoverage / posCoverage;\n\n                    (0, _utils.pusho)(tier.groupedFeatures, sgId, newFeature);\n                });\n            }, featuresByType);\n\n            delete tier.superGroups[sgId]; // Do we want this?\n        };\n\n        for (var sgId in tier.superGroups) {\n            _loop(sgId);\n        }\n    }\n\n    // Glyphify groups.\n    var groupGlyphs = glyphifyGroups(tier, canvas, glyphs, y);\n\n    R.map(function (superGroup) {\n        var sgGlyphs = [];\n        var sgMin = 10000000000;\n        var sgMax = -10000000000;\n\n        superGroup.forEach(function (glyphs) {\n            var gGlyphs = groupGlyphs[glyphs];\n            if (gGlyphs) {\n                sgGlyphs.push(gGlyphs);\n                sgMin = Math.min(sgMin, gGlyphs.min());\n                sgMax = Math.max(sgMax, gGlyphs.max());\n            }\n        });\n\n        sgGlyphs.forEach(function (glyph) {\n            glyphs.push(new Glyphs.PaddedGlyph(glyph, sgMin, sgMax));\n        });\n    }, tier.superGroups);\n\n    R.map(function (glyph) {\n        return glyphs.push(glyph);\n    }, groupGlyphs);\n\n    var _bumpSubtiers = bumpSubtiers(tier, glyphs, grid, y),\n        _bumpSubtiers2 = _slicedToArray(_bumpSubtiers, 2),\n        subtiers = _bumpSubtiers2[0],\n        subtiersExceeded = _bumpSubtiers2[1];\n\n    tier.glyphCacheOrigin = tier.browser.viewStart;\n\n    if (subtiersExceeded) tier.updateStatus('Bumping limit exceeded, use the track editor to see more features');else tier.updateStatus();\n\n    tier.subtiers = subtiers;\n}\n\n// Fills out areas that haven't been fetched as gray blocks\nfunction drawUnmapped(tier, canvas, padding) {\n    var drawStart = tier.browser.viewStart - 1000.0 / tier.browser.scale;\n    var drawEnd = tier.browser.viewEnd + 1000.0 / tier.browser.scale;\n    var unmappedBlocks = [];\n    if (tier.knownCoverage) {\n        var knownRanges = tier.knownCoverage.ranges();\n        knownRanges.forEach(function (range, index) {\n            if (index === 0) {\n                if (range.min() > drawStart) unmappedBlocks.push({ min: drawStart, max: range.min() - 1 });\n            } else {\n                unmappedBlocks.push({ min: knownRanges[index - 1].max() + 1, max: range.min() - 1 });\n            }\n\n            if (index == knownRanges.length - 1 && range.max() < drawEnd) {\n                unmappedBlocks.push({ min: range.max() + 1, max: drawEnd });\n            }\n        });\n    }\n    if (unmappedBlocks.length > 0) {\n        canvas.fillStyle = 'gray';\n        unmappedBlocks.forEach(function (block) {\n            var min = (block.min - tier.browser.viewStart) * tier.browser.scale + 1000;\n            var max = (block.max - tier.browser.viewStart) * tier.browser.scale + 1000;\n            canvas.fillRect(min, 0, max - min, padding);\n        });\n    }\n}\n\nfunction clearViewport(canvas, width, height) {\n    canvas.clearRect(0, 0, width, height);\n}\n\n// Make the viewport & canvas the correct size for the tier\nfunction prepareViewport(tier, canvas, retina) {\n    var clear = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : true;\n    var vOffset = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : 0;\n\n    var desiredWidth = tier.browser.featurePanelWidth + 2000;\n    if (retina) {\n        desiredWidth *= 2;\n    }\n\n    var fpw = tier.viewport.width | 0;\n    if (fpw < desiredWidth - 50) {\n        tier.viewport.width = fpw = desiredWidth;\n    }\n\n    var lh = tier.padding + vOffset;\n\n    tier.subtiers.forEach(function (s) {\n        return lh += s.height + tier.padding;\n    });\n\n    lh += 6;\n    lh = Math.max(lh, tier.browser.minTierHeight);\n\n    var canvasHeight = lh;\n    if (retina) {\n        canvasHeight *= 2;\n    }\n\n    if (canvasHeight != tier.viewport.height) {\n        tier.viewport.height = canvasHeight;\n    }\n\n    tier.viewportHolder.style.left = '-1000px';\n    tier.viewport.style.width = retina ? '' + fpw / 2 + 'px' : '' + fpw + 'px';\n    tier.viewport.style.height = '' + lh + 'px';\n    tier.layoutHeight = Math.max(lh, tier.browser.minTierHeight);\n\n    tier.updateHeight();\n    tier.norigin = tier.browser.viewStart;\n\n    canvas.save();\n    if (retina) {\n        canvas.scale(2, 2);\n    }\n\n    if (clear) {\n        clearViewport(canvas, fpw, canvasHeight);\n    }\n\n    drawUnmapped(tier, canvas, lh);\n}\n\nfunction paint(tier, canvas) {\n    var vOffset = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 0;\n\n    var overlayLabelCanvas = new Glyphs.OverlayLabelCanvas();\n    var offset = (tier.glyphCacheOrigin - tier.browser.viewStart) * tier.browser.scale + 1000;\n    canvas.translate(offset, vOffset + tier.padding);\n    overlayLabelCanvas.translate(0, tier.padding);\n\n    tier.paintToContext(canvas, overlayLabelCanvas, offset);\n\n    if (overlayLabelCanvas.glyphs.length > 0) tier.overlayLabelCanvas = overlayLabelCanvas;else tier.overlayLabelCanvas = null;\n\n    canvas.restore();\n}\n\nfunction getScoreMinMax(tier, style) {\n    var smin = tier.quantMin(style);\n    var smax = tier.quantMax(style);\n\n    if (!smax) {\n        if (smin < 0) {\n            smax = 0;\n        } else {\n            smax = 10;\n        }\n    }\n    if (!smin) {\n        smin = 0;\n    }\n    return [smin, smax];\n}\n\nfunction relScoreOrigin(score, smin, smax) {\n    var relScore = (1.0 * score - smin) / (smax - smin);\n    var relOrigin = -1.0 * smin / (smax - smin);\n\n    return [relScore, relOrigin];\n}\n\nfunction getRefSeq(tier, min, max) {\n    var refSeq = null;\n    if (tier.currentSequence) {\n        var csStart = tier.currentSequence.start | 0;\n        var csEnd = tier.currentSequence.end | 0;\n        if (csStart <= max && csEnd >= min) {\n            var sfMin = Math.max(min, csStart);\n            var sfMax = Math.min(max, csEnd);\n\n            refSeq = tier.currentSequence.seq.substr(sfMin - csStart, sfMax - sfMin + 1);\n            while (min < sfMin) {\n                refSeq = 'N' + refSeq;\n                sfMin--;\n            }\n            while (max > sfMax) {\n                refSeq = refSeq + 'N';\n                sfMax++;\n            }\n        }\n    }\n    return refSeq;\n}\n\nfunction featureToCrossLikeGlyph(canvas, tier, feature, y, glyphType, style, forceHeight, noLabel) {\n    var scale = tier.browser.scale;\n    var origin = tier.browser.viewStart;\n\n    var score = feature.score;\n    var label = feature.label || feature.id;\n\n    var minPos = (feature.min - origin) * scale;\n    var maxPos = Math.max((feature.max - origin + 1) * scale, minPos + 1);\n\n    var height = (tier.forceHeight || style.HEIGHT || forceHeight || 12) * 1.0;\n    var requiredHeight = height;\n\n    var glyph = null;\n    var quant = null;\n\n    var stroke = style.FGCOLOR || 'black';\n    var fill = style.BGCOLOR || 'none';\n    var outline = style.STROKECOLOR;\n\n    if (style.BGITEM && feature.itemRgb) {\n        stroke = feature.itemRgb;\n    } else if ((0, _das.isDasBooleanTrue)(style.COLOR_BY_SCORE2)) {\n        var grad = style.BGGRAD || style._gradient;\n        if (!grad) {\n            grad = (0, _color.makeGradient)(50, style.COLOR1, style.COLOR2, style.COLOR3);\n            style._gradient = grad;\n        }\n\n        var score2 = feature.score2;\n        if (score2 !== undefined || !stroke) {\n            score2 = score2 || 0;\n\n            var smin2 = style.MIN2 ? 1.0 * style.MIN2 : 0.0;\n            var smax2 = style.MAX2 ? 1.0 * style.MAX2 : 1.0;\n            var relScore2 = (1.0 * score2 - smin2) / (smax2 - smin2);\n\n            var step = relScore2 * grad.length | 0;\n            R.clamp(0, step, grad.length - 1);\n            stroke = grad[step];\n        }\n    }\n\n    var size = style.SIZE || height;\n    if (style.RSIZE) {\n        size = 1.0 * style.RSIZE * height;\n    }\n\n    if (style.STROKETHRESHOLD) {\n        if (size < 1.0 * style.STROKETHRESHOLD) outline = null;\n    }\n\n    var mid = (minPos + maxPos) / 2;\n\n    if (glyphType === 'EX') {\n        glyph = new Glyphs.ExGlyph(mid, size, stroke);\n    } else if (glyphType === 'TRIANGLE') {\n        var dir = style.DIRECTION || 'N';\n        var width = style.LINEWIDTH || size;\n        glyph = new Glyphs.TriangleGlyph(mid, size, dir, width, stroke, outline);\n    } else if (glyphType === 'DOT') {\n        glyph = new Glyphs.DotGlyph(mid, size, stroke, outline);\n    } else if (glyphType === 'PLIMSOLL') {\n        glyph = new Glyphs.PlimsollGlyph(mid, size, 0.2 * size, stroke, outline);\n    } else if (glyphType === 'SQUARE') {\n        glyph = new Glyphs.BoxGlyph(mid - size / 2, 0, size, size, stroke, outline);\n    } else if (glyphType === 'STAR') {\n        var points = style.POINTS || 5;\n        glyph = new Glyphs.StarGlyph(mid, size / 2, points, stroke, outline);\n    } else {\n        glyph = new Glyphs.CrossGlyph(mid, size, stroke);\n    }\n\n    if (fill && fill !== 'none' && maxPos - minPos > 5) {\n        var boxGlyph = new Glyphs.BoxGlyph(minPos, 0, maxPos - minPos, size, fill);\n        glyph = new Glyphs.GroupGlyph([boxGlyph, glyph]);\n    }\n\n    if ((0, _das.isDasBooleanTrue)(style.SCATTER)) {\n        var _getScoreMinMax = getScoreMinMax(tier, style),\n            _getScoreMinMax2 = _slicedToArray(_getScoreMinMax, 2),\n            smin = _getScoreMinMax2[0],\n            smax = _getScoreMinMax2[1];\n\n        var _relScoreOrigin = relScoreOrigin(score, smin, smax),\n            _relScoreOrigin2 = _slicedToArray(_relScoreOrigin, 2),\n            relScore = _relScoreOrigin2[0],\n            relOrigin = _relScoreOrigin2[1];\n\n        if (relScore < 0.0 || relScore > 1.0) {\n            // Glyph is out of bounds.\n            // Should we allow for \"partially showing\" glyphs?\n\n            return null;\n        } else {\n            var originShift = function originShift(x) {\n                return (x - relOrigin) * requiredHeight;\n            };\n            height = Math.max(1, originShift(relScore));\n            y = y + originShift(1);\n\n            if (relScore >= relOrigin) y = y - height;\n\n            quant = { min: smin, max: smax };\n\n            var heightFudge = 0;\n            var featureLabel = R.defaultTo(style.LABEL, feature.forceLabel);\n\n            if ((0, _das.isDasBooleanNotFalse)(featureLabel) && label && !noLabel) {\n                glyph = new Glyphs.LabelledGlyph(canvas, glyph, label, true, null, featureLabel == 'above' ? 'above' : 'below');\n                if (featureLabel === 'above') {\n                    heightFudge = glyph.textHeight + 2;\n                }\n                noLabel = true;\n            }\n            glyph = new Glyphs.TranslatedGlyph(glyph, 0, y - size / 2 - heightFudge, requiredHeight);\n        }\n    }\n\n    return [glyph, quant];\n}\n\nfunction featureToGradientLikeGlyph(canvas, tier, feature, y, glyphType, style, forceHeight) {\n    var scale = tier.browser.scale;\n    var origin = tier.browser.viewStart;\n\n    var score = feature.score;\n\n    var minPos = (feature.min - origin) * scale;\n    var maxPos = Math.max((feature.max - origin + 1) * scale, minPos + 1);\n\n    var height = (tier.forceHeight || style.HEIGHT || forceHeight || 12) * 1.0;\n    var requiredHeight = height * 1.0;\n\n    var glyph = null;\n    var quant = null;\n\n    var centerOnAxis = (0, _das.isDasBooleanTrue)(style[\"AXISCENTER\"]);\n\n    var _getScoreMinMax3 = getScoreMinMax(tier, style),\n        _getScoreMinMax4 = _slicedToArray(_getScoreMinMax3, 2),\n        smin = _getScoreMinMax4[0],\n        smax = _getScoreMinMax4[1];\n\n    // AUTOMIN & AUTOMAX respectively set the lower and upper bounds\n\n\n    if ((0, _das.isDasBooleanTrue)(style.AUTOMIN)) {\n        smin = tier.currentFeaturesMinScore * 0.95;\n        console.log(\"smin:\\t\" + smin);\n    }\n    if ((0, _das.isDasBooleanTrue)(style.AUTOMAX)) {\n        smax = tier.currentFeaturesMaxScore * 1.05;\n        console.log(\"smax:\\t\" + smax);\n    }\n\n    if (1.0 * score < 1.0 * smin) {\n        score = smin;\n    }\n    if (1.0 * score > 1.0 * smax) {\n        score = smax;\n    }\n\n    // Shift smin/smax in case we want to center the histogram\n    // on the horizontal axis\n    if (centerOnAxis) {\n        var tmin = tier.quantMin(style);\n        var tmax = tier.quantMax(style);\n\n        if ((0, _das.isDasBooleanTrue)(style.AUTOMIN)) {\n            tmin = tier.currentFeaturesMinScore * 0.95;\n        }\n        if ((0, _das.isDasBooleanTrue)(style.AUTOMAX)) {\n            tmax = tier.currentFeaturesMaxScore * 1.05;\n        }\n\n        smin = tmin - (tmax - tmin) / 2;\n        smax = tmax - (tmax - tmin) / 2;\n    }\n\n    var _relScoreOrigin3 = relScoreOrigin(score, smin, smax),\n        _relScoreOrigin4 = _slicedToArray(_relScoreOrigin3, 2),\n        relScore = _relScoreOrigin4[0],\n        relOrigin = _relScoreOrigin4[1];\n\n    if (glyphType === 'HISTOGRAM') {\n        var originShift = function originShift(x) {\n            return x - Math.max(0, relOrigin);\n        };\n        height = Math.abs(originShift(relScore)) * requiredHeight;\n        y = y + originShift(1.0) * requiredHeight;\n\n        if (relScore >= relOrigin) y -= height;\n\n        if (centerOnAxis) y += height / 2;\n\n        if ((0, _das.isDasBooleanTrue)(style[\"HIDEAXISLABEL\"])) quant = null;else quant = { min: smin, max: smax };\n    }\n\n    var stroke = style.FGCOLOR || null;\n    var fill = style.BGCOLOR || style.COLOR1 || 'green';\n    if (style.BGITEM && feature.itemRgb) fill = feature.itemRgb;\n    var alpha = style.ALPHA ? 1.0 * style.ALPHA : null;\n\n    if (style.BGGRAD) {\n        var grad = style.BGGRAD;\n        var step = relScore * grad.length | 0;\n        step = R.clamp(0, step, grad.length - 1);\n        fill = grad[step];\n    }\n\n    if (style.COLOR2) {\n        var _grad = style._gradient;\n        if (!_grad) {\n            _grad = (0, _color.makeGradient)(50, style.COLOR1, style.COLOR2, style.COLOR3);\n            style._gradient = _grad;\n        }\n\n        var _step = relScore * _grad.length | 0;\n        _step = R.clamp(0, _step, _grad.length - 1);\n        fill = _grad[_step];\n    }\n\n    var tempGlyph = new Glyphs.BoxGlyph(minPos, y, maxPos - minPos, height, fill, stroke, alpha);\n    glyph = new Glyphs.TranslatedGlyph(tempGlyph, 0, 0, requiredHeight);\n\n    return [glyph, quant];\n}\n\nfunction featureToPointGlyph(tier, feature, style) {\n    var scale = tier.browser.scale;\n    var origin = tier.browser.viewStart;\n\n    var score = feature.score;\n\n    var minPos = (feature.min - origin) * scale;\n    var maxPos = Math.max((feature.max - origin + 1) * scale, minPos + 1);\n\n    var height = tier.forceHeight || style.HEIGHT || 30;\n\n    var glyph = null;\n    var quant = null;\n\n    var _getScoreMinMax5 = getScoreMinMax(tier, style),\n        _getScoreMinMax6 = _slicedToArray(_getScoreMinMax5, 2),\n        smin = _getScoreMinMax6[0],\n        smax = _getScoreMinMax6[1];\n\n    var yscale = 1.0 * height / (smax - smin);\n    var relScore = (1.0 * score - smin) / (smax - smin);\n    var sc = (score - 1.0 * smin) * yscale | 0;\n    quant = { min: smin, max: smax };\n\n    var fill = style.FGCOLOR || style.COLOR1 || 'black';\n    if (style.COLOR2) {\n        var grad = style._gradient;\n        if (!grad) {\n            grad = (0, _color.makeGradient)(50, style.COLOR1, style.COLOR2, style.COLOR3);\n            style._gradient = grad;\n        }\n\n        var step = relScore * grad.length | 0;\n        step = R.clamp(0, step, grad.length - 1);\n        fill = grad[step];\n    }\n\n    glyph = new Glyphs.PointGlyph((minPos + maxPos) / 2, height - sc, height, fill);\n\n    return [glyph, quant];\n}\n\nfunction sequenceGlyph(canvas, tier, feature, style, forceHeight) {\n    var scale = tier.browser.scale;\n    var origin = tier.browser.viewStart;\n\n    var min = feature.min;\n    var max = feature.max;\n    var minPos = (feature.min - origin) * scale;\n    var maxPos = Math.max((feature.max - origin + 1) * scale, minPos + 1);\n\n    var height = (tier.forceHeight || style.HEIGHT || forceHeight || 12) * 1.0;\n\n    var glyph = null;\n\n    var rawseq = feature.seq;\n    var seq = rawseq;\n    var rawquals = feature.quals;\n    var quals = rawquals;\n    var insertionLabels = (0, _das.isDasBooleanTrue)(style.__INSERTIONS);\n\n    var indels = [];\n    if (feature.cigar) {\n        var ops = (0, _cigar.parseCigar)(feature.cigar);\n        seq = '';\n        quals = '';\n        var cursor = 0;\n\n        ops.forEach(function (co) {\n            if (co.op === 'M') {\n                seq += rawseq.substr(cursor, co.cnt);\n                quals += rawquals.substr(cursor, co.cnt);\n                cursor += co.cnt;\n            } else if (co.op === 'D') {\n                seq += \"-\".repeat(co.cnt);\n                quals += \"Z\".repeat(co.cnt);\n            } else if (co.op === 'I') {\n                var inseq = rawseq.substr(cursor, co.cnt);\n                var ig = new Glyphs.TranslatedGlyph(new Glyphs.TriangleGlyph(minPos + seq.length * scale, 6, 'S', 5, tier.browser.baseColors['I']), 0, -2, 0);\n                if (insertionLabels) ig = new Glyphs.LabelledGlyph(canvas, ig, inseq, false, 'center', 'above', '7px sans-serif');\n                ig.feature = { label: 'Insertion: ' + inseq, type: 'insertion', method: 'insertion' };\n                indels.push(ig);\n\n                cursor += co.cnt;\n            } else if (co.op === 'S') {\n                cursor += co.cnt;\n            } else {\n                console.log('unknown cigop' + co.op);\n            }\n        });\n    }\n\n    var refSeq = getRefSeq(tier, min, max);\n    if (seq && refSeq && (style.__SEQCOLOR === 'mismatch' || style.__SEQCOLOR === 'mismatch-all')) {\n        var mismatchSeq = [];\n        var match = feature.orientation === '-' ? ',' : '.';\n        for (var i = 0; i < seq.length; ++i) {\n            mismatchSeq.push(seq[i] == refSeq[i] ? match : seq[i]);\n        }\n        seq = mismatchSeq.join('');\n    }\n\n    var strandColor = feature.orientation === '-' ? style._minusColor || 'lightskyblue' : style._plusColor || 'lightsalmon';\n\n    if (style.__disableQuals) quals = false;\n\n    glyph = new Glyphs.SequenceGlyph(tier.browser.baseColors, strandColor, minPos, maxPos, height, seq, refSeq, style.__SEQCOLOR, quals, !(0, _das.isDasBooleanTrue)(style.__CLEARBG), tier.scaleVertical);\n\n    if (insertionLabels) glyph = new Glyphs.TranslatedGlyph(glyph, 0, 7);\n\n    if (indels.length > 0) {\n        indels.splice(0, 0, glyph);\n        glyph = new Glyphs.GroupGlyph(indels);\n    }\n\n    return glyph;\n}\n\nfunction makeLinePlot(features, style, tier, yshift) {\n    yshift = yshift || 0;\n\n    var origin = tier.browser.viewStart,\n        scale = tier.browser.scale;\n    var height = tier.forceHeight || style.HEIGHT || 30;\n    var min = tier.quantMin(style);\n    var max = tier.quantMax(style);\n\n    // AUTOMIN & AUTOMAX respectively set the lower and upper bounds\n    if ((0, _das.isDasBooleanTrue)(style.AUTOMIN)) {\n        // add some basically arbitrary padding\n        min = tier.currentFeaturesMinScore * 0.95;\n    }\n    if ((0, _das.isDasBooleanTrue)(style.AUTOMAX)) {\n        max = tier.currentFeaturesMaxScore * 1.05;\n    }\n\n    var yscale = 1.0 * height / (max - min);\n    var color = style.FGCOLOR || style.COLOR1 || 'black';\n\n    var prevSign = 1;\n    var curSign = null;\n\n    var curGlyphPoints = [];\n    var glyphSequences = [];\n\n    var prevPoint = null;\n\n    features.forEach(function (f) {\n        var px = (((f.min | 0) + (f.max | 0)) / 2 - origin) * scale;\n        var sc = (f.score - 1.0 * min) * yscale | 0;\n\n        // Additive tracks are always above the x-axis, and are colored\n        // depending on whether the score is positive or negative.\n        if ((0, _das.isDasBooleanTrue)(style.ADDITIVE)) {\n            curSign = f.score < 0 ? -1 : 1;\n\n            if (curSign !== prevSign) {\n                glyphSequences.push({\n                    points: curGlyphPoints,\n                    color: prevSign === 1 ? style.POSCOLOR : style.NEGCOLOR\n                });\n                curGlyphPoints = [];\n                // Need to add the previous point to this sequence,\n                // otherwise there is a gap in the resulting plot\n                curGlyphPoints.push(prevPoint);\n            }\n            prevSign = curSign;\n        } else {\n            curSign = 1;\n        }\n\n        var py = height - sc * curSign + yshift;\n        prevPoint = { x: px, y: py };\n        curGlyphPoints.push(prevPoint);\n    });\n\n    // Need to add the final sequence of points as well.\n    if ((0, _das.isDasBooleanTrue)(style.ADDITIVE)) {\n        color = curSign === 1 ? style.POSCOLOR : style.NEGCOLOR;\n    }\n    glyphSequences.push({\n        points: curGlyphPoints,\n        color: color\n    });\n\n    var lggs = glyphSequences.map(function (gs) {\n        var lgg = new Glyphs.LineGraphGlyph(gs.points, gs.color, height);\n        lgg.quant = { min: min, max: max };\n\n        if (style.ZINDEX) lgg.zindex = style.ZINDEX | 0;\n\n        return lgg;\n    });\n\n    return lggs;\n}\n\nfunction makeStackedBars(features, tier) {\n    var glyphs = [];\n\n    var posStacks = [],\n        negStacks = [];\n\n    var scale = tier.browser.scale,\n        origin = tier.browser.viewStart;\n    for (var fi = 0; fi < features.length; ++fi) {\n        var feature = features[fi];\n        var style = tier.styleForFeature(feature);\n        var score = feature.score * 1.0;\n\n        var height = tier.forceHeight || style.HEIGHT || 12;\n        var requiredHeight = height = 1.0 * height;\n\n        var min = feature.min;\n        var max = feature.max;\n\n        var minPos = (min - origin) * scale;\n        var rawMaxPos = (max - origin + 1) * scale;\n        var maxPos = Math.max(rawMaxPos, minPos + 1);\n\n        // This should somewhat match the 'HISTOGRAM' path.\n\n        var smin = tier.quantMin(style);\n        var smax = tier.quantMax(style);\n\n        if (!smax) {\n            if (smin < 0) {\n                smax = 0;\n            } else {\n                smax = 10;\n            }\n        } else {\n            smax = smax * 1.0;\n        }\n\n        if (!smin) {\n            smin = 0;\n        } else {\n            smin = smin * 1.0;\n        }\n\n        var stackOrigin;\n        if (score >= 0) {\n            stackOrigin = posStacks[min] || 0;\n            posStacks[min] = stackOrigin + score;\n        } else {\n            stackOrigin = negStacks[min] || 0;\n            negStacks[min] = stackOrigin + score;\n        }\n\n        if (stackOrigin > smax || stackOrigin < smin) {\n            // Stack has extended outside of range.\n            continue;\n        }\n\n        if (stackOrigin + score < smin) {\n            score = smin - stackOrigin;\n        }\n        if (stackOrigin + score > smax) {\n            score = smax - stackOrigin;\n        }\n\n        var relScoreEnd = (score + stackOrigin - smin) / (smax - smin);\n        var relScoreStart = (stackOrigin - smin) / (smax - smin);\n        var relScoreMax = Math.max(relScoreStart, relScoreEnd);\n        var relScoreMin = Math.min(relScoreStart, relScoreEnd);\n\n        height = (relScoreMax - relScoreMin) * requiredHeight;\n        var y = (1.0 - relScoreMax) * requiredHeight;\n\n        var stroke = style.FGCOLOR || null;\n        var fill = style.BGCOLOR || style.COLOR1 || 'green';\n        if (style.BGITEM && feature.itemRgb) fill = feature.itemRgb;\n        var alpha = style.ALPHA ? 1.0 * style.ALPHA : null;\n\n        var gg = new Glyphs.BoxGlyph(minPos, y, maxPos - minPos, height, fill, stroke, alpha);\n        gg = new Glyphs.TranslatedGlyph(gg, 0, 0, requiredHeight);\n        gg.feature = feature;\n        gg.quant = {\n            min: smin, max: smax\n        };\n        if (style.ZINDEX) {\n            gg.zindex = style.ZINDEX | 0;\n        }\n        glyphs.push(gg);\n    }\n    return glyphs;\n}\n\n// height is subtier height\nfunction createQuantOverlay(tier, height) {\n    var retina = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : false;\n\n    var width = 50;\n\n    tier.quantOverlay.height = height;\n    tier.quantOverlay.width = retina ? width * 2 : width;\n    tier.quantOverlay.style.height = '' + (retina ? height / 2 : height) + 'px';\n    tier.quantOverlay.style.width = '' + width + 'px';\n    tier.quantOverlay.style.display = 'block';\n\n    var canvas = tier.quantOverlay.getContext('2d');\n\n    if (retina) {\n        canvas.scale(2, 2);\n    }\n\n    return canvas;\n}\n\nfunction paintQuant(canvas, tier, quant, tics) {\n    canvas.save();\n\n    var h = tier.quantOverlay.height;\n    var w = 100;\n\n    var ticSpacing = (h + tier.padding * 2) / tics;\n    var ticInterval = (quant.max - quant.min) / tics;\n\n    canvas.fillStyle = 'white';\n    canvas.globalAlpha = 0.6;\n    if (tier.browser.rulerLocation == 'right') {\n        canvas.fillRect(w - 30, 0, 30, h + tier.padding * 2);\n    } else {\n        canvas.fillRect(0, 0, 30, h + tier.padding * 2);\n    }\n    canvas.globalAlpha = 1.0;\n\n    canvas.strokeStyle = 'black';\n    canvas.lineWidth = 1;\n    canvas.beginPath();\n    if (tier.browser.rulerLocation == 'right') {\n        canvas.moveTo(w - 8, tier.padding);\n        canvas.lineTo(w, tier.padding);\n        canvas.lineTo(w, h + tier.padding);\n        canvas.lineTo(w - 8, h + tier.padding);\n\n        for (var t = 1; t < tics - 1; t++) {\n            var ty = t * ticSpacing;\n            canvas.moveTo(w, ty);\n            canvas.lineTo(w - 5, ty);\n        }\n    } else {\n        canvas.moveTo(8, tier.padding);\n        canvas.lineTo(0, tier.padding);\n        canvas.lineTo(0, h + tier.padding);\n        canvas.lineTo(8, h + tier.padding);\n\n        for (var _t = 1; _t < tics - 1; _t++) {\n            var _ty = _t * ticSpacing;\n            canvas.moveTo(0, _ty);\n            canvas.lineTo(5, _ty);\n        }\n    }\n    canvas.stroke();\n\n    canvas.fillStyle = 'black';\n\n    if (tier.browser.rulerLocation == 'right') {\n        canvas.textAlign = 'right';\n        canvas.fillText((0, _numformats.formatQuantLabel)(quant.max), w - 9, 8);\n        canvas.fillText((0, _numformats.formatQuantLabel)(quant.min), w - 9, h + tier.padding);\n\n        for (var _t2 = 1; _t2 < tics - 1; _t2++) {\n            var _ty2 = _t2 * ticSpacing;\n            canvas.fillText((0, _numformats.formatQuantLabel)(1.0 * quant.max - _t2 * ticInterval), w - 9, _ty2 + 3);\n        }\n    } else {\n        canvas.textAlign = 'left';\n        canvas.fillText((0, _numformats.formatQuantLabel)(quant.max), 9, 8);\n        canvas.fillText((0, _numformats.formatQuantLabel)(quant.min), 9, h + tier.padding);\n\n        for (var _t3 = 1; _t3 < tics - 1; _t3++) {\n            var _ty3 = _t3 * ticSpacing;\n            canvas.fillText((0, _numformats.formatQuantLabel)(1.0 * quant.max - _t3 * ticInterval), 9, _ty3 + 3);\n        }\n    }\n\n    canvas.restore();\n}\n\n},{\"./cigar.js\":8,\"./color.js\":9,\"./das.js\":11,\"./feature-draw.js\":21,\"./glyphs.js\":24,\"./numformats\":30,\"./sequence-draw.js\":36,\"./spans.js\":41,\"./utils.js\":56,\"ramda\":73}],13:[function(require,module,exports){\n/* -*- mode: javascript; c-basic-offset: 4; indent-tabs-mode: nil -*- */\n\n// \n// Dalliance Genome Explorer\n// (c) Thomas Down 2006-2010\n//\n// domui.js: SVG UI components\n//\n\n\"use strict\";\n\nif (typeof require !== 'undefined') {\n    var browser = require('./cbrowser');\n    var Browser = browser.Browser;\n\n    var utils = require('./utils');\n    var makeElement = utils.makeElement;\n    var removeChildren = utils.removeChildren;\n}\n\nBrowser.prototype.removeAllPopups = function () {\n    removeChildren(this.hPopupHolder);\n    removeChildren(this.popupHolder);\n};\n\nBrowser.prototype.makeTooltip = function (ele, text) {\n    var isin = false;\n    var thisB = this;\n    var timer = null;\n    var _outlistener;\n    _outlistener = function outlistener(ev) {\n        isin = false;\n        if (timer) {\n            clearTimeout(timer);\n            timer = null;\n        }\n        ele.removeEventListener('mouseout', _outlistener, false);\n    };\n\n    var setup = function setup(ev) {\n        var mx = ev.clientX + window.scrollX,\n            my = ev.clientY + window.scrollY;\n        if (!timer) {\n            timer = setTimeout(function () {\n                var ttt;\n                if (typeof text === 'function') {\n                    ttt = text();\n                } else {\n                    ttt = text;\n                }\n\n                var popup = makeElement('div', [makeElement('div', null, { className: 'tooltip-arrow' }), makeElement('div', ttt, { className: 'tooltip-inner' })], { className: 'tooltip bottom in' }, {\n                    display: 'block',\n                    top: '' + (my + 20) + 'px',\n                    left: '' + Math.max(mx - 30, 20) + 'px'\n                });\n                thisB.hPopupHolder.appendChild(popup);\n                var _moveHandler;\n                _moveHandler = function moveHandler(ev) {\n                    try {\n                        thisB.hPopupHolder.removeChild(popup);\n                    } catch (e) {\n                        // May have been removed by other code which clears the popup layer.\n                    }\n                    window.removeEventListener('mousemove', _moveHandler, false);\n                    if (isin) {\n                        if (ele.offsetParent == null) {} else {\n                            setup(ev);\n                        }\n                    }\n                };\n                window.addEventListener('mousemove', _moveHandler, false);\n                timer = null;\n            }, 1000);\n        }\n    };\n\n    ele.addEventListener('mouseover', function (ev) {\n        isin = true;\n        ele.addEventListener('mouseout', _outlistener, false);\n        setup(ev);\n    }, false);\n    ele.addEventListener('DOMNodeRemovedFromDocument', function (ev) {\n        isin = false;\n        if (timer) {\n            clearTimeout(timer);\n            timer = null;\n        }\n    }, false);\n};\n\nBrowser.prototype.popit = function (ev, name, ele, opts) {\n    var thisB = this;\n    if (!opts) opts = {};\n    if (!ev) ev = {};\n\n    var width = opts.width || 200;\n\n    var mx, my;\n\n    if (ev.clientX) {\n        var mx = ev.clientX,\n            my = ev.clientY;\n    } else {\n        mx = 500;my = 50;\n    }\n    mx += document.documentElement.scrollLeft || document.body.scrollLeft;\n    my += document.documentElement.scrollTop || document.body.scrollTop;\n    var winWidth = window.innerWidth;\n\n    var top = my;\n    var left = Math.min(mx - width / 2 - 4, winWidth - width - 30);\n\n    var popup = makeElement('div');\n    popup.className = 'popover fade ' + (ev.clientX ? 'bottom ' : '') + 'in';\n    popup.style.display = 'block';\n    popup.style.position = 'absolute';\n    popup.style.top = '' + top + 'px';\n    popup.style.left = '' + left + 'px';\n    popup.style.width = width + 'px';\n    if (width > 276) {\n        // HACK Bootstrappification...\n        popup.style.maxWidth = width + 'px';\n    }\n\n    popup.appendChild(makeElement('div', null, { className: 'arrow' }));\n\n    if (name) {\n        var closeButton = makeElement('button', '', { className: 'close' });\n        closeButton.innerHTML = '&times;';\n\n        closeButton.addEventListener('mouseover', function (ev) {\n            closeButton.style.color = 'red';\n        }, false);\n        closeButton.addEventListener('mouseout', function (ev) {\n            closeButton.style.color = 'black';\n        }, false);\n        closeButton.addEventListener('click', function (ev) {\n            ev.preventDefault();ev.stopPropagation();\n            thisB.removeAllPopups();\n        }, false);\n        var tbar = makeElement('h4', [makeElement('span', name, null, { maxWidth: '200px' }), closeButton], {/*className: 'popover-title' */}, { paddingLeft: '10px', paddingRight: '10px' });\n\n        var dragOX, dragOY;\n        var moveHandler, _upHandler;\n        moveHandler = function moveHandler(ev) {\n            ev.stopPropagation();ev.preventDefault();\n            left = left + (ev.clientX - dragOX);\n            if (left < 8) {\n                left = 8;\n            }if (left > winWidth - width - 32) {\n                left = winWidth - width - 26;\n            }\n            top = top + (ev.clientY - dragOY);\n            top = Math.max(10, top);\n            popup.style.top = '' + top + 'px';\n            popup.style.left = '' + Math.min(left, winWidth - width - 10) + 'px';\n            dragOX = ev.clientX;dragOY = ev.clientY;\n        };\n        _upHandler = function upHandler(ev) {\n            ev.stopPropagation();ev.preventDefault();\n            window.removeEventListener('mousemove', moveHandler, false);\n            window.removeEventListener('mouseup', _upHandler, false);\n        };\n        tbar.addEventListener('mousedown', function (ev) {\n            ev.preventDefault();ev.stopPropagation();\n            dragOX = ev.clientX;dragOY = ev.clientY;\n            window.addEventListener('mousemove', moveHandler, false);\n            window.addEventListener('mouseup', _upHandler, false);\n        }, false);\n\n        popup.appendChild(tbar);\n    }\n\n    popup.appendChild(makeElement('div', ele, { className: 'popover-content' }, {\n        padding: '0px'\n    }));\n    this.hPopupHolder.appendChild(popup);\n\n    var popupHandle = {\n        node: popup,\n        displayed: true\n    };\n    popup.addEventListener('DOMNodeRemoved', function (ev) {\n        if (ev.target == popup) {\n            popupHandle.displayed = false;\n        }\n    }, false);\n    return popupHandle;\n};\n\nfunction makeTreeTableSection(title, content, visible) {\n    var ttButton = makeElement('i');\n    function update() {\n        if (visible) {\n            ttButton.className = 'fa fa-caret-down';\n            content.style.display = 'table';\n        } else {\n            ttButton.className = 'fa fa-caret-right';\n            content.style.display = 'none';\n        }\n    }\n    update();\n\n    ttButton.addEventListener('click', function (ev) {\n        ev.preventDefault();ev.stopPropagation();\n        visible = !visible;\n        update();\n    }, false);\n\n    var heading = makeElement('h6', [ttButton, ' ', title], {}, { display: 'block', background: 'gray', color: 'white', width: '100%', padding: '5px 2px', margin: '0px' });\n    return makeElement('div', [heading, content], {});\n}\n\nif (typeof module !== 'undefined') {\n    module.exports = {\n        makeTreeTableSection: makeTreeTableSection\n    };\n}\n\n},{\"./cbrowser\":6,\"./utils\":56}],14:[function(require,module,exports){\n/* jshint esversion: 6 */\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\nexports.drawTier = exports.renderTier = undefined;\n\nvar _defaultRenderer = require(\"./default-renderer\");\n\nvar DefaultRenderer = _interopRequireWildcard(_defaultRenderer);\n\nfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }\n\nexports.renderTier = renderTier;\nexports.drawTier = drawTier;\n\n\nfunction renderTier(status, tier) {\n    drawTier(tier);\n    tier.updateStatus(status);\n}\n\nfunction drawTier(tier) {\n    var canvas = tier.viewport.getContext(\"2d\");\n    var retina = tier.browser.retina && window.devicePixelRatio > 1;\n    if (retina) {\n        canvas.scale(2, 2);\n    }\n\n    var features = tier.currentFeatures;\n    var sequence = tier.currentSequence;\n    if (tier.sequenceSource) {\n        DefaultRenderer.drawSeqTier(tier, sequence);\n    } else if (features) {\n        DefaultRenderer.prepareSubtiers(tier, canvas);\n    } else {\n        console.log(\"No sequence or features in tier!\");\n    }\n\n    if (tier.subtiers) {\n        DefaultRenderer.prepareViewport(tier, canvas, retina, true);\n    }\n\n    tier.drawOverlay();\n    tier.paintQuant();\n\n    if (typeof tier.dasSource.drawCallback === \"function\") {\n        tier.dasSource.drawCallback(canvas, tier);\n    }\n\n    tier.originHaxx = 0;\n    tier.browser.arrangeTiers();\n}\n\n},{\"./default-renderer\":12}],15:[function(require,module,exports){\n/* -*- mode: javascript; c-basic-offset: 4; indent-tabs-mode: nil -*- */\n\n// \n// Dalliance Genome Explorer\n// (c) Thomas Down 2006-2014\n//\n// encode.js: interface for ENCODE DCC services\n//\n\n\"use strict\";\n\nvar _typeof = typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; };\n\nif (typeof require !== 'undefined') {\n    var Promise = require('es6-promise').Promise;\n}\n\nfunction lookupEncodeURI(uri, json) {\n    if (uri.indexOf('?') < 0) uri = uri + '?soft=true';\n\n    return new Promise(function (accept, reject) {\n        var req = new XMLHttpRequest();\n        req.onreadystatechange = function () {\n            if (req.readyState == 4) {\n                if (req.status >= 300) {\n                    reject('Error code ' + req.status);\n                } else {\n                    var resp = JSON.parse(req.response);\n                    accept(json ? resp : resp.location);\n                }\n            }\n        };\n\n        req.open('GET', uri, true);\n        req.setRequestHeader('Accept', 'application/json');\n        req.responseType = 'text';\n        req.send();\n    });\n}\n\nfunction EncodeURLHolder(url) {\n    this.rawurl = url;\n}\n\nEncodeURLHolder.prototype.getURLPromise = function () {\n    if (this.urlPromise && this.urlPromiseValidity > Date.now()) {\n        return this.urlPromise;\n    } else {\n        this.urlPromise = lookupEncodeURI(this.rawurl, true).then(function (resp) {\n            return resp.location;\n        });\n        this.urlPromiseValidity = Date.now() + 12 * 3600 * 1000;\n        return this.urlPromise;\n    }\n};\n\nfunction EncodeFetchable(url, start, end, opts) {\n    if (!opts) {\n        if ((typeof start === 'undefined' ? 'undefined' : _typeof(start)) === 'object') {\n            opts = start;\n            start = undefined;\n        } else {\n            opts = {};\n        }\n    }\n\n    this.url = typeof url === 'string' ? new EncodeURLHolder(url) : url;\n    this.start = start || 0;\n    if (end) {\n        this.end = end;\n    }\n    this.opts = opts;\n}\n\nEncodeFetchable.prototype.slice = function (s, l) {\n    if (s < 0) {\n        throw 'Bad slice ' + s;\n    }\n\n    var ns = this.start,\n        ne = this.end;\n    if (ns && s) {\n        ns = ns + s;\n    } else {\n        ns = s || ns;\n    }\n    if (l && ns) {\n        ne = ns + l - 1;\n    } else {\n        ne = ne || l - 1;\n    }\n    return new EncodeFetchable(this.url, ns, ne, this.opts);\n};\n\nEncodeFetchable.prototype.fetchAsText = function (callback) {\n    var self = this;\n    var req = new XMLHttpRequest();\n    var length;\n    self.url.getURLPromise().then(function (url) {\n        req.open('GET', url, true);\n\n        if (self.end) {\n            if (self.end - self.start > 100000000) {\n                throw 'Monster fetch!';\n            }\n            req.setRequestHeader('Range', 'bytes=' + self.start + '-' + self.end);\n            length = self.end - self.start + 1;\n        }\n\n        req.onreadystatechange = function () {\n            if (req.readyState == 4) {\n                if (req.status == 200 || req.status == 206) {\n                    return callback(req.responseText);\n                } else {\n                    return callback(null);\n                }\n            }\n        };\n        if (self.opts.credentials) {\n            req.withCredentials = true;\n        }\n        req.send();\n    }).catch(function (err) {\n        console.log(err);\n        return callback(null);\n    });\n};\n\nEncodeFetchable.prototype.salted = function () {\n    return this;\n};\n\nEncodeFetchable.prototype.fetch = function (callback, attempt, truncatedLength) {\n    var self = this;\n\n    attempt = attempt || 1;\n    if (attempt > 3) {\n        return callback(null);\n    }\n\n    self.url.getURLPromise().then(function (url) {\n        var req = new XMLHttpRequest();\n        var length;\n        req.open('GET', url, true);\n        req.overrideMimeType('text/plain; charset=x-user-defined');\n        if (self.end) {\n            if (self.end - self.start > 100000000) {\n                throw 'Monster fetch!';\n            }\n            req.setRequestHeader('Range', 'bytes=' + self.start + '-' + self.end);\n            length = self.end - self.start + 1;\n        }\n        req.responseType = 'arraybuffer';\n        req.onreadystatechange = function () {\n            if (req.readyState == 4) {\n                if (req.status == 200 || req.status == 206) {\n                    if (req.response) {\n                        var bl = req.response.byteLength;\n                        if (length && length != bl && (!truncatedLength || bl != truncatedLength)) {\n                            return self.fetch(callback, attempt + 1, bl);\n                        } else {\n                            return callback(req.response);\n                        }\n                    } else if (req.mozResponseArrayBuffer) {\n                        return callback(req.mozResponseArrayBuffer);\n                    } else {\n                        var r = req.responseText;\n                        if (length && length != r.length && (!truncatedLength || r.length != truncatedLength)) {\n                            return self.fetch(callback, attempt + 1, r.length);\n                        } else {\n                            return callback(bstringToBuffer(req.responseText));\n                        }\n                    }\n                } else {\n                    return self.fetch(callback, attempt + 1);\n                }\n            }\n        };\n        if (self.opts.credentials) {\n            req.withCredentials = true;\n        }\n        req.send();\n    }).catch(function (err) {\n        console.log(err);\n    });\n};\n\nfunction bstringToBuffer(result) {\n    if (!result) {\n        return null;\n    }\n\n    var ba = new Uint8Array(result.length);\n    for (var i = 0; i < ba.length; ++i) {\n        ba[i] = result.charCodeAt(i);\n    }\n    return ba.buffer;\n}\n\nif (typeof module !== 'undefined') {\n    module.exports = {\n        lookupEncodeURI: lookupEncodeURI,\n        EncodeFetchable: EncodeFetchable\n    };\n}\n\n},{\"es6-promise\":60}],16:[function(require,module,exports){\n/* -*- mode: javascript; c-basic-offset: 4; indent-tabs-mode: nil -*- */\n\n// \n// Dalliance Genome Explorer\n// (c) Thomas Down 2006-2013\n//\n// ensembljson.js -- query the Ensembl REST API.\n//\n\n\"use strict\";\n\nif (typeof require !== 'undefined') {\n    var sa = require('./sourceadapters');\n    var dalliance_registerSourceAdapterFactory = sa.registerSourceAdapterFactory;\n    var FeatureSourceBase = sa.FeatureSourceBase;\n\n    var das = require('./das');\n    var DASStylesheet = das.DASStylesheet;\n    var DASStyle = das.DASStyle;\n    var DASFeature = das.DASFeature;\n    var DASGroup = das.DASGroup;\n}\n\nfunction EnsemblFeatureSource(source) {\n    FeatureSourceBase.call(this);\n    this.source = source;\n    this.base = source.uri || '//rest.ensembl.org';\n    if (this.base.indexOf('//') === 0) {\n        var proto = window.location.protocol;\n        if (proto == 'http:' || proto == 'https:') {\n            // Protocol-relative URLs okay.\n        } else {\n            this.base = 'http:' + this.base;\n        }\n    }\n    this.species = source.species || 'human';\n\n    if (typeof source.type === 'string') {\n        this.type = [source.type];\n    } else {\n        this.type = source.type || ['regulatory'];\n    }\n}\n\nEnsemblFeatureSource.prototype = Object.create(FeatureSourceBase.prototype);\nEnsemblFeatureSource.prototype.constructor = EnsemblFeatureSource;\n\nEnsemblFeatureSource.prototype.getStyleSheet = function (callback) {\n    var stylesheet = new DASStylesheet();\n\n    var tsStyle = new DASStyle();\n    tsStyle.glyph = '__NONE';\n    if (this.type.indexOf('exon') >= 0) stylesheet.pushStyle({ type: 'transcript' }, null, tsStyle);\n    if (this.type.indexOf('exon') >= 0 || this.type.indexOf('transcript') >= 0) stylesheet.pushStyle({ type: 'gene' }, null, tsStyle);\n\n    var cdsStyle = new DASStyle();\n    cdsStyle.glyph = 'BOX';\n    cdsStyle.FGCOLOR = 'black';\n    cdsStyle.BGCOLOR = 'red';\n    cdsStyle.HEIGHT = 8;\n    cdsStyle.BUMP = true;\n    cdsStyle.LABEL = true;\n    cdsStyle.ZINDEX = 30;\n    stylesheet.pushStyle({ type: 'cds' }, null, cdsStyle);\n\n    {\n        var varStyle = new DASStyle();\n        varStyle.glyph = 'SQUARE';\n        varStyle.BUMP = 'yes';\n        varStyle.LABEL = 'no';\n        // varStyle.BGCOLOR = '#888888';\n        varStyle.FGCOLOR = 'blue';\n        stylesheet.pushStyle({ type: 'variation', method: '.+_UTR_variant' }, null, varStyle);\n    }\n    {\n        var varStyle = new DASStyle();\n        varStyle.glyph = 'TRIANGLE';\n        varStyle.DIRECTION = 'S';\n        varStyle.BUMP = 'yes';\n        varStyle.LABEL = 'no';\n        // varStyle.BGCOLOR = '#888888';\n        varStyle.FGCOLOR = 'blue';\n        stylesheet.pushStyle({ type: 'variation', method: 'missense_variant' }, null, varStyle);\n    }\n    {\n        var varStyle = new DASStyle();\n        varStyle.glyph = 'TRIANGLE';\n        varStyle.DIRECTION = 'N';\n        varStyle.BUMP = 'yes';\n        varStyle.LABEL = 'no';\n        // varStyle.BGCOLOR = '#888888';\n        varStyle.FGCOLOR = 'blue';\n        stylesheet.pushStyle({ type: 'variation', method: 'splice_.+_variant' }, null, varStyle);\n    }\n    {\n        var varStyle = new DASStyle();\n        varStyle.glyph = 'STAR';\n        varStyle.POINTS = 6;\n        varStyle.BUMP = 'yes';\n        varStyle.LABEL = 'no';\n        // varStyle.BGCOLOR = '#888888';\n        varStyle.FGCOLOR = 'blue';\n        stylesheet.pushStyle({ type: 'variation', method: 'regulatory_region_variant' }, null, varStyle);\n    }\n    {\n        var varStyle = new DASStyle();\n        varStyle.glyph = 'PLIMSOLL';\n        varStyle.BUMP = 'yes';\n        varStyle.LABEL = 'no';\n        // varStyle.BGCOLOR = '#888888';\n        varStyle.FGCOLOR = 'rgb(50,80,255)';\n        varStyle.STROKECOLOR = 'black';\n        stylesheet.pushStyle({ type: 'variation' }, null, varStyle);\n    }\n    {\n        var varStyle = new DASStyle();\n        varStyle.glyph = 'SQUARE';\n        varStyle.BUMP = 'yes';\n        varStyle.LABEL = 'no';\n        varStyle.BGCOLOR = '#888888';\n        varStyle.FGCOLOR = 'red';\n        stylesheet.pushStyle({ type: 'indel', method: '.+_UTR_variant' }, null, varStyle);\n    }\n    {\n        var varStyle = new DASStyle();\n        varStyle.glyph = 'TRIANGLE';\n        varStyle.DIRECTION = 'S';\n        varStyle.BUMP = 'yes';\n        varStyle.LABEL = 'no';\n        varStyle.BGCOLOR = '#888888';\n        varStyle.FGCOLOR = 'red';\n        stylesheet.pushStyle({ type: 'indel', method: 'missense_variant' }, null, varStyle);\n    }\n    {\n        var varStyle = new DASStyle();\n        varStyle.glyph = 'TRIANGLE';\n        varStyle.DIRECTION = 'N';\n        varStyle.BUMP = 'yes';\n        varStyle.LABEL = 'no';\n        varStyle.BGCOLOR = '#888888';\n        varStyle.FGCOLOR = 'red';\n        stylesheet.pushStyle({ type: 'indel', method: 'splice_.+_variant' }, null, varStyle);\n    }\n    {\n        var varStyle = new DASStyle();\n        varStyle.glyph = 'STAR';\n        varStyle.POINTS = 6;\n        varStyle.BUMP = 'yes';\n        varStyle.LABEL = 'no';\n        varStyle.BGCOLOR = '#888888';\n        varStyle.FGCOLOR = 'red';\n        stylesheet.pushStyle({ type: 'indel', method: 'regulatory_region_variant' }, null, varStyle);\n    }\n    {\n        var varStyle = new DASStyle();\n        varStyle.glyph = 'PLIMSOLL';\n        varStyle.BUMP = 'yes';\n        varStyle.LABEL = 'no';\n        varStyle.BGCOLOR = '#888888';\n        varStyle.FGCOLOR = 'red';\n        varStyle.STROKECOLOR = 'black';\n        stylesheet.pushStyle({ type: 'indel' }, null, varStyle);\n    }\n\n    var wigStyle = new DASStyle();\n    wigStyle.glyph = 'BOX';\n    wigStyle.FGCOLOR = 'black';\n    wigStyle.BGCOLOR = 'orange';\n    wigStyle.HEIGHT = 8;\n    wigStyle.BUMP = true;\n    wigStyle.LABEL = true;\n    wigStyle.ZINDEX = 20;\n    stylesheet.pushStyle({ type: 'default' }, null, wigStyle);\n    return callback(stylesheet);\n};\n\nEnsemblFeatureSource.prototype.getScales = function () {\n    return [];\n};\n\nEnsemblFeatureSource.prototype.fetch = function (chr, min, max, scale, types, pool, callback) {\n    var thisB = this;\n    var url = this.base + '/overlap/region/' + this.species + '/' + chr + ':' + min + '-' + max;\n\n    var filters = [];\n    for (var ti = 0; ti < this.type.length; ++ti) {\n        filters.push('feature=' + this.type[ti]);\n    }\n    filters.push('content-type=application/json');\n    url = url + '?' + filters.join(';');\n\n    var req = new XMLHttpRequest();\n    req.onreadystatechange = function () {\n        if (req.readyState == 4) {\n            thisB.busy--;\n            thisB.notifyActivity();\n\n            if (req.status >= 300) {\n                var err = 'Error code ' + req.status;\n                try {\n                    var jr = JSON.parse(req.response);\n                    if (jr.error) {\n                        err = jr.error;\n                    }\n                } catch (ex) {};\n\n                callback(err, null);\n            } else {\n                var jf = JSON.parse(req.response);\n                var features = [];\n                for (var fi = 0; fi < jf.length; ++fi) {\n                    var j = jf[fi];\n\n                    var notes = [];\n                    var f = new DASFeature();\n                    f.segment = chr;\n                    f.min = j['start'] | 0;\n                    f.max = j['end'] | 0;\n                    f.type = j.feature_type || 'unknown';\n                    f.id = j.ID;\n\n                    if (j.Parent) {\n                        var grp = new DASGroup();\n                        grp.id = j.Parent;\n                        f.groups = [grp];\n                    }\n\n                    if (j.strand) {\n                        if (j.strand < 0) f.orientation = '-';else if (j.strand > 0) f.orientation = '+';\n                    }\n\n                    if (j.consequence_type) f.method = j.consequence_type;\n\n                    if (j.alt_alleles) {\n                        notes.push('Alleles=' + j.alt_alleles.join('/'));\n                        if (j.alt_alleles.length > 1) {\n                            if (j.alt_alleles[1].length != j.alt_alleles[0].length || j.alt_alleles[1] == '-') {\n                                f.type = 'indel';\n                            }\n                        }\n                    }\n\n                    if (notes.length > 0) {\n                        f.notes = notes;\n                    }\n                    features.push(f);\n                }\n                callback(null, features);\n            }\n        }\n    };\n\n    thisB.busy++;\n    thisB.notifyActivity();\n\n    req.open('GET', url, true);\n    req.responseType = 'text';\n    req.send();\n};\n\nEnsemblFeatureSource.prototype.capabilities = function () {\n    var caps = {};\n    if (this.type && this.type.indexOf('transcript') >= 0) {\n        caps.search = ['gene'];\n    }\n    return caps;\n};\n\nEnsemblFeatureSource.prototype.search = function (query, callback) {\n    var url = this.base + '/lookup/symbol/' + this.species + '/' + query + '?content-type=application/json';\n    var req = new XMLHttpRequest();\n    req.onreadystatechange = function () {\n        if (req.readyState == 4) if (req.status >= 300 || req.status < 200) {\n            var err = 'Error code ' + req.status;\n            try {\n                var jr = JSON.parse(req.response);\n                if (jr.error) {\n                    err = jr.error;\n                }\n            } catch (ex) {};\n\n            if (req.status == 400) // E! returns an error if the lookup fails.  Who knows?\n                return callback([]);else return callback(null, err);\n        } else {\n            var resp = JSON.parse(req.response);\n            var result = [];\n\n            if (resp && resp.seq_region_name) {\n                result.push({\n                    segment: resp.seq_region_name,\n                    min: resp.start,\n                    max: resp.end\n                });\n            }\n\n            return callback(result);\n        }\n    };\n\n    req.open('GET', url, true);\n    req.responseType = 'text';\n    req.send();\n};\n\ndalliance_registerSourceAdapterFactory('ensembl', function (source) {\n    return { features: new EnsemblFeatureSource(source) };\n});\n\n},{\"./das\":11,\"./sourceadapters\":39}],17:[function(require,module,exports){\n'use strict';\n\n/* -*- mode: javascript; c-basic-offset: 4; indent-tabs-mode: nil -*- */\n\n// \n// Dalliance Genome Explorer\n// (c) Thomas Down 2006-2014\n//\n// export-config.js\n//\n\nif (typeof require !== 'undefined') {\n    var browser = require('./cbrowser');\n    var Browser = browser.Browser;\n\n    var utils = require('./utils');\n    var shallowCopy = utils.shallowCopy;\n\n    var sha1 = require('./sha1');\n    var hex_sha1 = sha1.hex_sha1;\n\n    var das = require('./das');\n    var copyStylesheet = das.copyStylesheet;\n}\n\nBrowser.prototype.exportFullConfig = function (opts) {\n    opts = opts || {};\n\n    var config = {\n        chr: this.chr,\n        viewStart: this.viewStart | 0,\n        viewEnd: this.viewEnd | 0,\n        cookieKey: 'dalliance_' + hex_sha1(Date.now()),\n\n        coordSystem: this.coordSystem,\n\n        sources: this.exportSourceConfig(),\n\n        chains: this.exportChains()\n    };\n\n    if (this.prefix) config.prefix = this.prefix;\n\n    return config;\n};\n\nBrowser.prototype.exportChains = function () {\n    var cc = {};\n    var cs = this.chains || {};\n    for (var k in cs) {\n        cc[k] = cs[k].exportConfig();\n    }\n    return cc;\n};\n\nBrowser.prototype.exportSourceConfig = function (opts) {\n    opts = opts || {};\n\n    var sourceConfig = [];\n    for (var ti = 0; ti < this.tiers.length; ++ti) {\n        var tier = this.tiers[ti];\n        var source = shallowCopy(tier.dasSource);\n\n        if (source.noPersist) continue;\n\n        source.coords = undefined;\n        source.props = undefined;\n        if (!source.disabled) source.disabled = undefined;\n\n        if (tier.config.stylesheet) {\n            source.style = copyStylesheet(tier.config.stylesheet).styles;\n            source.stylesheet_uri = undefined;\n        } else if (source.style) {\n            source.style = copyStylesheet({ styles: source.style }).styles;\n        }\n\n        if (typeof tier.config.name === 'string') {\n            source.name = tier.config.name;\n        }\n\n        if (tier.config.height !== undefined) {\n            source.forceHeight = tier.config.height;\n        }\n        if (tier.config.forceMin !== undefined) {\n            source.forceMin = tier.config.forceMin;\n        }\n        if (tier.config.forceMinDynamic) source.forceMinDynamic = tier.config.forceMinDynamic;\n        if (tier.config.forceMax !== undefined) {\n            source.forceMax = tier.config.forceMax;\n        }\n        if (tier.config.bumped !== undefined) {\n            source.bumped = tier.config.bumped;\n        }\n        if (tier.config.forceMaxDynamic) source.forceMaxDynamic = tier.config.forceMaxDynamic;\n\n        sourceConfig.push(source);\n    }\n\n    return sourceConfig;\n};\n\nBrowser.prototype.exportPageTemplate = function (opts) {\n    opts = opts || {};\n    var template = '<html>\\n' + '  <head>\\n' + '    <script language=\"javascript\" src=\"' + this.resolveURL('$$dalliance-compiled.js') + '\"></script>\\n' + '    <script language=\"javascript\">\\n' + '      var dalliance_browser = new Browser(' + JSON.stringify(this.exportFullConfig(opts), null, 2) + ');\\n' + '    </script>\\n' + '  </head>\\n' + '  <body>\\n' + '    <div id=\"svgHolder\">Dalliance goes here</div>\\n' + '  </body>\\n' + '<html>\\n';\n\n    return template;\n};\n\n},{\"./cbrowser\":6,\"./das\":11,\"./sha1\":38,\"./utils\":56}],18:[function(require,module,exports){\n/* -*- mode: javascript; c-basic-offset: 4; indent-tabs-mode: nil -*- */\n\n// \n// Dalliance Genome Explorer\n// (c) Thomas Down 2006-2014\n//\n// export-image.js\n//\n\n\"use strict\";\n\nif (typeof require !== 'undefined') {\n    var browser = require('./cbrowser');\n    var Browser = browser.Browser;\n\n    var g = require('./glyphs');\n    var OverlayLabelCanvas = g.OverlayLabelCanvas;\n\n    var nf = require('./numformats');\n    var formatQuantLabel = nf.formatQuantLabel;\n    var formatLongInt = nf.formatLongInt;\n\n    var VERSION = require('./version');\n\n    var drawSeqTierGC = require('./sequence-draw').drawSeqTierGC;\n}\n\nfunction fillTextRightJustified(g, text, x, y) {\n    g.fillText(text, x - g.measureText(text).width, y);\n}\n\nBrowser.prototype.exportImage = function (opts) {\n    opts = opts || {};\n\n    var fpw = opts.width || this.featurePanelWidth;\n    var padding = 3;\n    var ypos = 0;\n    if (opts.banner || opts.region) {\n        ypos = 40;\n    }\n\n    var backupFPW = this.featurePanelWidth;\n    var backupScale = this.scale;\n    this.featurePanelWidth = fpw;\n    this.scale = this.featurePanelWidth / (this.viewEnd - this.viewStart);\n\n    var totHeight = ypos;\n    for (var ti = 0; ti < this.tiers.length; ++ti) {\n        if (ti > 0) totHeight += padding;\n        var tier = this.tiers[ti];\n\n        tier.backupSubtiers = tier.subtiers;\n        tier.backupOriginHaxx = tier.originHaxx;\n        tier.backupLayoutHeight = tier.layoutHeight;\n\n        if (tier.subtiers) {\n            var renderer = this.getTierRenderer(tier);\n            if (renderer && renderer.prepareSubtiers) {\n                renderer.prepareSubtiers(tier, tier.viewport.getContext('2d'));\n            }\n\n            if (tier.subtiers) {\n                var lh = tier.padding;\n                for (var s = 0; s < tier.subtiers.length; ++s) {\n                    lh = lh + tier.subtiers[s].height + tier.padding;\n                }\n                lh += 6;\n                tier.layoutHeight = Math.max(lh, this.minTierHeight);\n            }\n        }\n\n        if (tier.layoutHeight !== undefined) totHeight += tier.layoutHeight;\n    }\n    var mult = opts.resolutionMultiplier || 1.0;\n    var margin = 200;\n\n    var cw = (fpw + margin) * mult | 0;\n    var ch = totHeight * mult | 0;\n    var c = makeElement('canvas', null, { width: cw, height: ch });\n    var g = c.getContext('2d');\n    g.fillStyle = 'white';\n    g.fillRect(0, 0, cw, ch);\n\n    g.scale(mult, mult);\n\n    if (opts.region) {\n        g.save();\n        g.fillStyle = 'black';\n        g.font = '12pt sans-serif';\n        g.fillText(this.chr + ':' + formatLongInt(this.viewStart) + '..' + formatLongInt(this.viewEnd), margin + 100, 28);\n        g.restore();\n    }\n\n    if (opts.banner) {\n        g.save();\n        g.fillStyle = 'black';\n        g.font = '12pt sans-serif';\n        fillTextRightJustified(g, 'Graphics from Biodalliance ' + VERSION, margin + fpw - 100, 28);\n        g.restore();\n    }\n\n    g.font = '10px sans-serif';\n\n    for (var ti = 0; ti < this.tiers.length; ++ti) {\n        var tier = this.tiers[ti];\n        var offset = (tier.glyphCacheOrigin - this.viewStart) * this.scale;\n\n        var oc = new OverlayLabelCanvas();\n        g.save(); // 1\n        g.translate(0, ypos);\n\n        g.save(); // 2\n        g.beginPath();\n        g.moveTo(margin, 0);\n        g.lineTo(margin + fpw, 0);\n        g.lineTo(margin + fpw, tier.layoutHeight);\n        g.lineTo(margin, tier.layoutHeight);\n        g.closePath();\n        g.clip();\n        g.translate(margin, 0);\n\n        g.save(); // 3\n        g.translate(offset, 0);\n        if (tier.subtiers) {\n            tier.paintToContext(g, oc, offset + 1000);\n        } else {\n            drawSeqTierGC(tier, tier.currentSequence, g);\n        }\n        g.restore(); // 2\n\n        g.save(); // 3\n        g.translate(offset, 0);\n        oc.draw(g, -offset, fpw - offset);\n        g.restore(); // 2\n        g.restore(); // 1\n\n        var hasQuant = false;\n        var pos = 0;\n        var subtiers = tier.subtiers || [];\n        for (var sti = 0; sti < subtiers.length; ++sti) {\n            var subtier = subtiers[sti];\n\n            if (subtier.quant) {\n                hasQuant = true;\n                var q = subtier.quant;\n                var h = subtier.height;\n\n                var numTics = 2;\n                if (h > 40) {\n                    numTics = 1 + (h / 20 | 0);\n                }\n                var ticSpacing = h / (numTics - 1);\n                var ticInterval = (q.max - q.min) / (numTics - 1);\n\n                g.beginPath();\n                g.moveTo(margin + 5, pos);\n                g.lineTo(margin, pos);\n                g.lineTo(margin, pos + subtier.height);\n                g.lineTo(margin + 5, pos + subtier.height);\n                for (var t = 1; t < numTics - 1; ++t) {\n                    var ty = t * ticSpacing;\n                    g.moveTo(margin, pos + ty);\n                    g.lineTo(margin + 3, pos + ty);\n                }\n                g.strokeStyle = 'black';\n                g.strokeWidth = 2;\n                g.stroke();\n\n                g.fillStyle = 'black';\n                fillTextRightJustified(g, formatQuantLabel(q.max), margin - 3, pos + 7);\n                fillTextRightJustified(g, formatQuantLabel(q.min), margin - 3, pos + subtier.height);\n                for (var t = 1; t < numTics - 1; ++t) {\n                    var ty = t * ticSpacing;\n                    fillTextRightJustified(g, formatQuantLabel(1.0 * q.max - t * ticInterval), margin - 3, pos + ty + 3);\n                }\n            }\n\n            pos += subtier.height + padding;\n        }\n\n        var labelName;\n        if (typeof tier.config.name === 'string') labelName = tier.config.name;else labelName = tier.dasSource.name;\n        var labelWidth = g.measureText(labelName).width;\n        g.fillStyle = 'black';\n        g.fillText(labelName, margin - (hasQuant ? 28 : 12) - labelWidth, (tier.layoutHeight + 3) / 2);\n\n        g.restore(); // 0\n\n        ypos += tier.layoutHeight + padding;\n\n        tier.subtiers = tier.backupSubtiers;\n        tier.originHaxx = tier.backupOriginHaxx;\n        tier.layoutHeight = tier.backupLayoutHeight;\n    }\n\n    if (opts.highlights) {\n        g.save();\n\n        g.beginPath();\n        g.moveTo(margin, 0);\n        g.lineTo(margin + fpw, 0);\n        g.lineTo(margin + fpw, ypos);\n        g.lineTo(margin, ypos);\n        g.closePath();\n        g.clip();\n\n        g.translate(margin + offset, 0);\n        var origin = this.viewStart;\n        var visStart = this.viewStart;\n        var visEnd = this.viewEnd;\n\n        for (var hi = 0; hi < this.highlights.length; ++hi) {\n            var h = this.highlights[hi];\n            if ((h.chr === this.chr || h.chr === 'chr' + this.chr) && h.min < visEnd && h.max > visStart) {\n                g.globalAlpha = this.defaultHighlightAlpha;\n                g.fillStyle = this.defaultHighlightFill;\n                g.fillRect((h.min - origin) * this.scale, 0, (h.max - h.min) * this.scale, ypos);\n            }\n        }\n        g.restore();\n    }\n\n    var rulerPos = -1;\n    if (opts.ruler == 'center') {\n        rulerPos = margin + (this.viewEnd - this.viewStart + 1) * this.scale / 2;\n    } else if (opts.ruler == 'left') {\n        rulerPos = margin;\n    } else if (opts.ruler == 'right') {\n        rulerPos = margin + (this.viewEnd - this.viewStart + 1) * this.scale;\n    }\n    if (rulerPos >= 0) {\n        g.strokeStyle = 'blue';\n        g.beginPath();\n        g.moveTo(rulerPos, 0);\n        g.lineTo(rulerPos, ypos);\n        g.stroke();\n    }\n\n    this.featurePanelWidth = backupFPW;\n    this.scale = backupScale;\n\n    return c.toDataURL('image/png');\n};\n\n},{\"./cbrowser\":6,\"./glyphs\":24,\"./numformats\":30,\"./sequence-draw\":36,\"./version\":58}],19:[function(require,module,exports){\n'use strict';\n\n/* -*- mode: javascript; c-basic-offset: 4; indent-tabs-mode: nil -*- */\n\n// \n// Dalliance Genome Explorer\n// (c) Thomas Down 2006-2014\n//\n// export-ui.js\n//\n\nif (typeof require !== 'undefined') {\n    var browser = require('./cbrowser');\n    var Browser = browser.Browser;\n\n    var utils = require('./utils');\n    var makeElement = utils.makeElement;\n    var removeChildren = utils.removeChildren;\n}\n\nBrowser.prototype.openExportPanel = function () {\n    var b = this;\n    if (this.uiMode === 'export') {\n        this.hideToolPanel();\n        this.setUiMode('none');\n    } else {\n        var exportForm = makeElement('div', null, { className: 'export-form' });\n        var exportSelect = makeElement('select');\n        exportSelect.appendChild(makeElement('option', 'SVG', { value: 'svg' }));\n        exportSelect.appendChild(makeElement('option', 'Image', { value: 'png' }));\n        exportSelect.appendChild(makeElement('option', 'Dalliance config', { value: 'config' }));\n        exportSelect.appendChild(makeElement('option', 'Dalliance sources', { value: 'sources' }));\n        exportSelect.appendChild(makeElement('option', 'Dalliance page', { value: 'page' }));\n        exportSelect.value = 'svg';\n\n        exportSelect.addEventListener('change', function (ev) {\n            removeChildren(exportContent);\n            setupEOT();\n        }, false);\n        exportForm.appendChild(makeElement('p', ['Export as: ', exportSelect]));\n\n        var exportHighlightsToggle = makeElement('input', null, { type: 'checkbox', checked: this.exportHighlights });\n        exportHighlightsToggle.addEventListener('change', function (ev) {\n            b.exportHighlights = exportHighlightsToggle.checked;\n            b.storeStatus();\n        }, false);\n        var exportRulerToggle = makeElement('input', null, { type: 'checkbox', checked: this.exportRuler });\n        exportRulerToggle.addEventListener('change', function (ev) {\n            b.exportRuler = exportRulerToggle.checked;\n            b.storeStatus();\n        }, false);\n        var exportRegionToggle = makeElement('input', null, { type: 'checkbox', checked: this.exportRegion });\n        exportRegionToggle.addEventListener('change', function (ev) {\n            b.exportRegion = exportRegionToggle.checked;\n            b.storeStatus();\n        }, false);\n        var exportBannerToggle = makeElement('input', null, { type: 'checkbox', checked: this.exportBanner });\n        exportBannerToggle.addEventListener('change', function (ev) {\n            b.exportBanner = exportBannerToggle.checked;\n            b.storeStatus();\n        }, false);\n        var exportScale = makeElement('input', null, { type: 'text', value: '1.0' });\n        var exportWidth = makeElement('input', null, { type: 'text', value: '800' });\n\n        var exportButton = makeElement('button', 'Export', { className: 'btn btn-primary' });\n        exportButton.addEventListener('click', function (ev) {\n            removeChildren(exportContent);\n\n            var blobURL;\n            var note, type, name;\n            if (exportSelect.value === 'svg') {\n                blobURL = URL.createObjectURL(b.makeSVG({ highlights: exportHighlightsToggle.checked,\n                    banner: b.exportBanner,\n                    region: b.exportRegion,\n                    ruler: exportRulerToggle.checked ? b.rulerLocation : 'none',\n                    width: parseInt(exportWidth.value) || 800 }));\n                note = 'SVG';\n                type = 'image/svg';\n                name = 'dalliance-view.svg';\n            } else if (exportSelect.value === 'png') {\n                var mult = parseFloat(exportScale.value);\n                if (mult < 0.1 || mult > 10) {\n                    alert('bad scale ' + mult);\n                    return;\n                }\n\n                blobURL = b.exportImage({ highlights: exportHighlightsToggle.checked,\n                    banner: b.exportBanner,\n                    region: b.exportRegion,\n                    ruler: exportRulerToggle.checked ? b.rulerLocation : 'none',\n                    resolutionMultiplier: mult,\n                    width: parseInt(exportWidth.value) || 800 });\n                note = 'Image';\n                type = 'image/png';\n                name = 'dalliance-view.png';\n            } else if (exportSelect.value === 'config') {\n                var config = JSON.stringify(b.exportFullConfig(), null, 2);\n                var blob = new Blob([config], { type: 'text/plain' });\n                blobURL = URL.createObjectURL(blob);\n                note = 'Configuration';\n                type = 'text/plain';\n                name = 'dalliance-config.json';\n            } else if (exportSelect.value === 'sources') {\n                var config = JSON.stringify(b.exportSourceConfig(), null, 2);\n                var blob = new Blob([config], { type: 'text/plain' });\n                blobURL = URL.createObjectURL(blob);\n                note = 'Source array';\n                type = 'text/plain';\n                name = 'dalliance-sources.json';\n            } else if (exportSelect.value === 'page') {\n                var page = b.exportPageTemplate();\n                var type = 'text/html';\n                var blob = new Blob([page], { type: type });\n                blobURL = URL.createObjectURL(blob);\n                note = 'Page template';\n                name = 'dalliance-view.html';\n            }\n\n            if (blobURL) {\n                var downloadLink = makeElement('a', '[Download]', {\n                    href: blobURL,\n                    download: name,\n                    type: type\n                });\n\n                var previewLink = makeElement('a', '[Preview in browser]', {\n                    href: blobURL,\n                    type: type,\n                    target: '_new'\n                });\n\n                exportContent.appendChild(makeElement('p', ['' + note + ' created: ', downloadLink, previewLink]));\n            }\n        }, false);\n\n        b.addViewListener(function () {\n            removeChildren(exportContent);\n        });\n        b.addTierListener(function () {\n            removeChildren(exportContent);\n        });\n\n        var exportContent = makeElement('p', '');\n\n        var eotHighlights = makeElement('tr', [makeElement('th', 'Include highlights', {}, { width: '400px', textAlign: 'right' }), makeElement('td', exportHighlightsToggle)]);\n        var eotGuideline = makeElement('tr', [makeElement('th', 'Include vertical guideline', {}, { textAlign: 'right' }), makeElement('td', exportRulerToggle)]);\n        var eotScale = makeElement('tr', [makeElement('th', 'Scale multiplier', {}, { textAlign: 'right' }), makeElement('td', exportScale)]);\n        var eotWidth = makeElement('tr', [makeElement('th', 'Width (logical px)', {}, { textAlign: 'right' }), makeElement('td', exportWidth)]);\n        var eotRegion = makeElement('tr', [makeElement('th', 'Label with genomic coordinates', {}, { textAlign: 'right' }), makeElement('td', exportRegionToggle)]);\n        var eotBanner = makeElement('tr', [makeElement('th', 'Include banner', {}, { textAlign: 'right' }), makeElement('td', exportBannerToggle)]);\n\n        var exportOptsTable = makeElement('table', [eotHighlights, eotGuideline, eotWidth, eotScale, eotRegion], null, { width: '500px' });\n        var setupEOT = function setupEOT() {\n            var es = exportSelect.value;\n            eotHighlights.style.display = es == 'svg' || es == 'png' ? 'table-row' : 'none';\n            eotGuideline.style.display = es == 'svg' || es == 'png' ? 'table-row' : 'none';\n            eotScale.style.display = es == 'png' ? 'table-row' : 'none';\n            eotWidth.style.display = es == 'svg' || es == 'png' ? 'table-row' : 'none';\n            eotRegion.style.display = es == 'svg' || es == 'png' ? 'table-row' : 'none';\n            eotBanner.style.display = es == 'svg' || es == 'png' ? 'table-row' : 'none';\n        };\n        setupEOT();\n\n        exportForm.appendChild(exportOptsTable);\n        exportForm.appendChild(exportButton);\n        exportForm.appendChild(exportContent);\n\n        if (this.uiMode !== 'none') this.hideToolPanel();\n        this.browserHolder.insertBefore(exportForm, this.svgHolder);\n        this.activeToolPanel = exportForm;\n\n        this.setUiMode('export');\n    }\n};\n\n},{\"./cbrowser\":6,\"./utils\":56}],20:[function(require,module,exports){\n'use strict';\n\n/* -*- mode: javascript; c-basic-offset: 4; indent-tabs-mode: nil -*- */\n\n// \n// Dalliance Genome Explorer\n// (c) Thomas Down 2006-2014\n//\n// exports.js: shim to export symbols into global namespace for ease of embedding\n//\n\nvar browser = require('./cbrowser');\nvar chainset = require('./chainset');\nvar sa = require('./sourceadapters');\nvar utils = require('./utils');\nvar das = require('./das');\nvar sc = require('./sourcecompare');\n\nwindow.Browser = browser.Browser;\nwindow.sourcesAreEqual = sc.sourcesAreEqual;\nwindow.Chainset = chainset.Chainset; // Pre-0.12 configurations need this.\n\n// Useful for info plugins.  Should be reconsidered in the future.\nwindow.makeElement = utils.makeElement;\n\n// Allow source plugins to be loaded separately.\nwindow.dalliance_registerSourceAdapterFactory = sa.registerSourceAdapterFactory;\nwindow.dalliance_registerParserFactory = sa.registerParserFactory;\nwindow.dalliance_makeParser = sa.makeParser;\n\n// DAS* objects for some plugins -- remove when plugin API changes...\n\nwindow.DASSequence = das.DASSequence;\nwindow.DASFeature = das.DASFeature;\nwindow.DASGroup = das.DASGroup;\nwindow.DASStylesheet = das.DASStylesheet;\nwindow.DASStyle = das.DASStyle;\nwindow.DASSource = das.DASSource; // Pre-0.8 configurations used this.  Still some around...\n\nvar ruler = require(\"./rulers\");\nwindow.Ruler = ruler.Ruler;\nwindow.rulerDrawCallback = ruler.rulerDrawCallback;\n\n},{\"./cbrowser\":6,\"./chainset\":7,\"./das\":11,\"./rulers\":33,\"./sourceadapters\":39,\"./sourcecompare\":40,\"./utils\":56}],21:[function(require,module,exports){\n//\n// Dalliance Genome Explorer\n// (c) Thomas Down 2006-2010\n//\n// feature-draw.js: new feature-tier renderer\n//\n\n\"use strict\";\n\nif (typeof require !== 'undefined') {\n    var tier = require('./tier');\n    var DasTier = tier.DasTier;\n\n    var nf = require('./numformats');\n    var formatQuantLabel = nf.formatQuantLabel;\n}\n\nfunction SubTier() {\n    this.glyphs = [];\n    this.height = 0;\n    this.quant = null;\n}\n\nSubTier.prototype.indexFor = function (glyph) {\n    var gmin = glyph.min();\n    var lb = 0,\n        ub = this.glyphs.length;\n    while (ub > lb) {\n        var mid = (lb + ub) / 2 | 0;\n        if (mid >= this.glyphs.length) return this.glyphs.length;\n        var mg = this.glyphs[mid];\n        if (gmin < mg.min()) {\n            ub = mid;\n        } else {\n            lb = mid + 1;\n        }\n    }\n    return ub;\n};\n\nSubTier.prototype.add = function (glyph) {\n    var ind = this.indexFor(glyph);\n    this.glyphs.splice(ind, 0, glyph);\n    this.height = Math.max(this.height, glyph.height());\n    if (glyph.quant && this.quant == null) {\n        this.quant = glyph.quant;\n    }\n};\n\nSubTier.prototype.hasSpaceFor = function (glyph) {\n    var ind = this.indexFor(glyph);\n    if (ind > 0 && this.glyphs[ind - 1].max() >= glyph.min()) return false;\n    if (ind < this.glyphs.length && this.glyphs[ind].min() <= glyph.max()) return false;\n\n    return true;\n};\n\nDasTier.prototype.paintToContext = function (gc, oc, offset) {\n    var subtiers = this.subtiers;\n    var fpw = this.viewport.width | 0;\n\n    gc.save();\n    for (var s = 0; s < subtiers.length; ++s) {\n        var quant = null;\n        var glyphs = subtiers[s].glyphs;\n        for (var i = 0; i < glyphs.length; ++i) {\n            var glyph = glyphs[i];\n            if (glyph.min() < fpw - offset && glyph.max() > -offset) {\n                var glyph = glyphs[i];\n                glyph.draw(gc, oc);\n                if (glyph.quant) {\n                    quant = glyph.quant;\n                }\n            }\n        }\n\n        if (quant && quant.min < 0 && quant.max > 0 && this.dasSource.zeroLine) {\n            var ry = subtiers[0].height * (quant.max / (quant.max - quant.min));\n            gc.save();\n            gc.strokeStyle = this.dasSource.zeroLine;\n            gc.lineWidth = 0.5;\n            gc.beginPath();\n            gc.moveTo(-1000, ry);\n            gc.lineTo(fpw + 1000, ry);\n            gc.stroke();\n            gc.restore();\n        }\n\n        if (this.scaleVertical) {\n            var scale = this.browser.scale;\n            gc.translate(0, scale + this.padding);\n            oc.translate(0, scale + this.padding);\n        } else {\n            gc.translate(0, subtiers[s].height + this.padding);\n            oc.translate(0, subtiers[s].height + this.padding);\n        }\n    }\n    gc.restore();\n\n    if (quant && this.quantLeapThreshold && this.featureSource && this.browser.sourceAdapterIsCapable(this.featureSource, 'quantLeap')) {\n        var ry = subtiers[0].height * (1.0 - (this.quantLeapThreshold - quant.min) / (quant.max - quant.min));\n\n        gc.save();\n        gc.strokeStyle = 'red';\n        gc.lineWidth = 0.3;\n        gc.beginPath();\n        gc.moveTo(-1000, ry);\n        gc.lineTo(fpw + 1000, ry);\n        gc.stroke();\n        gc.restore();\n    }\n};\n\nDasTier.prototype.paintQuant = function () {\n    if (!this.quantOverlay) return;\n\n    var retina = this.browser.retina && window.devicePixelRatio > 1;\n\n    var quant;\n    if (this.subtiers && this.subtiers.length > 0) quant = this.subtiers[0].quant;\n\n    if (quant) {\n        var h = this.subtiers[0].height;\n        var w = 50;\n        this.quantOverlay.height = this.viewport.height;\n        this.quantOverlay.width = retina ? w * 2 : w;\n        this.quantOverlay.style.height = '' + (retina ? this.quantOverlay.height / 2 : this.quantOverlay.height) + 'px';\n        this.quantOverlay.style.width = '' + w + 'px';\n        this.quantOverlay.style.display = 'block';\n        var ctx = this.quantOverlay.getContext('2d');\n        if (retina) ctx.scale(2, 2);\n\n        var numTics = 2;\n        if (h > 40) {\n            numTics = 1 + (h / 20 | 0);\n        }\n        var ticSpacing = (h + this.padding * 2) / (numTics - 1);\n        var ticInterval = (quant.max - quant.min) / (numTics - 1);\n\n        ctx.fillStyle = 'white';\n        ctx.globalAlpha = 0.6;\n        if (this.browser.rulerLocation == 'right') {\n            ctx.fillRect(w - 30, 0, 30, h + this.padding * 2);\n        } else {\n            ctx.fillRect(0, 0, 30, h + this.padding * 2);\n        }\n        ctx.globalAlpha = 1.0;\n\n        ctx.strokeStyle = 'black';\n        ctx.lineWidth = 1;\n        ctx.beginPath();\n\n        if (this.browser.rulerLocation == 'right') {\n            ctx.moveTo(w - 8, this.padding);\n            ctx.lineTo(w, this.padding);\n            ctx.lineTo(w, h + this.padding);\n            ctx.lineTo(w - 8, h + this.padding);\n            for (var t = 1; t < numTics - 1; ++t) {\n                var ty = t * ticSpacing;\n                ctx.moveTo(w, ty);\n                ctx.lineTo(w - 5, ty);\n            }\n        } else {\n            ctx.moveTo(8, this.padding);\n            ctx.lineTo(0, this.padding);\n            ctx.lineTo(0, h + this.padding);\n            ctx.lineTo(8, h + this.padding);\n            for (var t = 1; t < numTics - 1; ++t) {\n                var ty = t * ticSpacing;\n                ctx.moveTo(0, ty);\n                ctx.lineTo(5, ty);\n            }\n        }\n        ctx.stroke();\n\n        ctx.fillStyle = 'black';\n\n        if (this.browser.rulerLocation == 'right') {\n            ctx.textAlign = 'right';\n            ctx.fillText(formatQuantLabel(quant.max), w - 9, 8);\n            ctx.fillText(formatQuantLabel(quant.min), w - 9, h + this.padding);\n            for (var t = 1; t < numTics - 1; ++t) {\n                var ty = t * ticSpacing;\n                ctx.fillText(formatQuantLabel(1.0 * quant.max - t * ticInterval), w - 9, ty + 3);\n            }\n        } else {\n            ctx.textAlign = 'left';\n            ctx.fillText(formatQuantLabel(quant.max), 9, 8);\n            ctx.fillText(formatQuantLabel(quant.min), 9, h + this.padding);\n            for (var t = 1; t < numTics - 1; ++t) {\n                var ty = t * ticSpacing;\n                ctx.fillText(formatQuantLabel(1.0 * quant.max - t * ticInterval), 9, ty + 3);\n            }\n        }\n    } else {\n        this.quantOverlay.style.display = 'none';\n    }\n};\n\nDasTier.prototype.styleForFeature = function (f) {\n    var ssScale = this.browser.zoomForCurrentScale();\n\n    if (!this.stylesheet) {\n        return null;\n    }\n\n    var maybe = null;\n    var ss = this.stylesheet.styles;\n    for (var si = 0; si < ss.length; ++si) {\n        var sh = ss[si];\n        if (sh.zoom && sh.zoom != ssScale) {\n            continue;\n        }\n\n        if (sh.orientation) {\n            if (sh.orientation != f.orientation) {\n                continue;\n            }\n        }\n\n        var labelRE = sh._labelRE;\n        if (!labelRE || !labelRE.test) {\n            labelRE = new RegExp('^' + sh.label + '$');\n            sh._labelRE = labelRE;\n        }\n        if (sh.label && !labelRE.test(f.label)) {\n            continue;\n        }\n        var methodRE = sh._methodRE;\n        if (!methodRE || !methodRE.test) {\n            methodRE = new RegExp('^' + sh.method + '$');\n            sh._methodRE = methodRE;\n        }\n        if (sh.method && !methodRE.test(f.method)) {\n            continue;\n        }\n        if (sh.type) {\n            if (sh.type == 'default') {\n                if (!maybe) {\n                    maybe = sh.style;\n                }\n                continue;\n            } else {\n                var typeRE = sh._typeRE;\n                if (!typeRE || !typeRE.test) {\n                    typeRE = new RegExp('^' + sh.type + '$');\n                    sh._typeRE = typeRE;\n                }\n                if (!typeRE.test(f.type)) continue;\n            }\n        }\n        return sh.style;\n    }\n    return maybe;\n};\n\nDasTier.prototype.quantMin = function (style) {\n    if (this.forceMinDynamic) {\n        return this.currentFeaturesMinScore || 0;\n    } else if (typeof this.forceMin === 'number') {\n        return this.forceMin;\n    } else {\n        var softMin = typeof style.SOFTMIN !== 'undefined' ? style.SOFTMIN : Number.MAX_VALUE;\n        return style.MIN || Math.min(softMin, this.currentFeaturesMinScore || 0);\n    }\n};\n\nDasTier.prototype.quantMax = function (style) {\n    if (this.forceMaxDynamic) {\n        return this.currentFeaturesMaxScore || 0;\n    } else if (typeof this.forceMax === 'number') {\n        return this.forceMax;\n    } else {\n        var softMax = typeof style.SOFTMAX !== 'undefined' ? style.SOFTMAX : Number.MIN_VALUE;\n        return style.MAX || Math.max(softMax, this.currentFeaturesMaxScore || 0);\n    }\n};\n\nif (typeof module !== 'undefined') {\n    module.exports = {\n        SubTier: SubTier\n    };\n}\n\n},{\"./numformats\":30,\"./tier\":52}],22:[function(require,module,exports){\n/* -*- mode: javascript; c-basic-offset: 4; indent-tabs-mode: nil -*- */\n\n// \n// Dalliance Genome Explorer\n// (c) Thomas Down 2006-2011\n//\n// feature-popup.js\n//\n\n\"use strict\";\n\nif (typeof require !== 'undefined') {\n    var browser = require('./cbrowser');\n    var Browser = browser.Browser;\n\n    var utils = require('./utils');\n    var pick = utils.pick;\n    var pushnew = utils.pushnew;\n    var makeElement = utils.makeElement;\n}\n\nvar TAGVAL_NOTE_RE = new RegExp('^([A-Za-z_-]+)=(.+)');\n\nBrowser.prototype.addFeatureInfoPlugin = function (handler) {\n    if (!this.featureInfoPlugins) {\n        this.featureInfoPlugins = [];\n    }\n    this.featureInfoPlugins.push(handler);\n};\n\nfunction FeatureInfo(hit, feature, group) {\n    var name = pick(group.type, feature.type);\n    var fid = pick(group.label, feature.label, group.id, feature.id);\n    if (fid && fid.indexOf('__dazzle') != 0) {\n        name = name + ': ' + fid;\n    }\n\n    this.hit = hit;\n    this.feature = feature;\n    this.group = group;\n    this.title = name;\n    this.sections = [];\n}\n\nFeatureInfo.prototype.setTitle = function (t) {\n    this.title = t;\n};\n\nFeatureInfo.prototype.add = function (label, info) {\n    if (typeof info === 'string') {\n        info = makeElement('span', info);\n    }\n    this.sections.push({ label: label, info: info });\n};\n\nBrowser.prototype.featurePopup = function (ev, __ignored_feature, hit, tier) {\n    var hi = hit.length;\n    var feature = --hi >= 0 ? hit[hi] : {};\n    var group = --hi >= 0 ? hit[hi] : {};\n\n    var featureInfo = new FeatureInfo(hit, feature, group);\n    featureInfo.tier = tier;\n    var fips = this.featureInfoPlugins || [];\n    for (var fipi = 0; fipi < fips.length; ++fipi) {\n        try {\n            fips[fipi](feature, featureInfo);\n        } catch (e) {\n            console.log(e.stack || e);\n        }\n    }\n    fips = tier.featureInfoPlugins || [];\n    for (fipi = 0; fipi < fips.length; ++fipi) {\n        try {\n            fips[fipi](feature, featureInfo);\n        } catch (e) {\n            console.log(e.stack || e);\n        }\n    }\n\n    this.removeAllPopups();\n\n    var table = makeElement('table', null, { className: 'table table-striped table-condensed' });\n    table.style.width = '100%';\n    table.style.margin = '0px';\n\n    var idx = 0;\n    if (feature.method && !tier.dasSource.suppressMethod) {\n        var row = makeElement('tr', [makeElement('th', 'Method'), makeElement('td', feature.method)]);\n        table.appendChild(row);\n        ++idx;\n    }\n    {\n        var loc;\n        if (group.segment) {\n            loc = group;\n        } else {\n            loc = feature;\n        }\n        var row = makeElement('tr', [makeElement('th', 'Location'), makeElement('td', loc.segment + ':' + loc.min + '-' + loc.max, {}, { minWidth: '200px' })]);\n        table.appendChild(row);\n        ++idx;\n    }\n    if (feature.score !== undefined && feature.score !== null && feature.score != '-' && !feature.suppressScore && !tier.dasSource.suppressScore) {\n        var row = makeElement('tr', [makeElement('th', 'Score'), makeElement('td', '' + feature.score)]);\n        table.appendChild(row);\n        ++idx;\n    }\n    {\n        var links = maybeConcat(group.links, feature.links);\n        if (links && links.length > 0) {\n            var row = makeElement('tr', [makeElement('th', 'Links'), makeElement('td', links.map(function (l) {\n                return makeElement('div', makeElement('a', l.desc, { href: l.uri, target: '_new' }));\n            }))]);\n            table.appendChild(row);\n            ++idx;\n        }\n    }\n    {\n        var notes = maybeConcat(group.notes, feature.notes);\n        for (var ni = 0; ni < notes.length; ++ni) {\n            var k = 'Note';\n            var v = notes[ni];\n            var m = v.match(TAGVAL_NOTE_RE);\n            if (m) {\n                k = m[1];\n                v = m[2];\n            }\n\n            var row = makeElement('tr', [makeElement('th', k), makeElement('td', v)]);\n            table.appendChild(row);\n            ++idx;\n        }\n    }\n\n    for (var fisi = 0; fisi < featureInfo.sections.length; ++fisi) {\n        var section = featureInfo.sections[fisi];\n        table.appendChild(makeElement('tr', [makeElement('th', section.label), makeElement('td', section.info)]));\n    }\n\n    this.popit(ev, featureInfo.title || 'Feature', table, { width: 450 });\n};\n\nfunction maybeConcat(a, b) {\n    var l = [];\n    if (a) {\n        for (var i = 0; i < a.length; ++i) {\n            pushnew(l, a[i]);\n        }\n    }\n    if (b) {\n        for (var i = 0; i < b.length; ++i) {\n            pushnew(l, b[i]);\n        }\n    }\n    return l;\n}\n\n},{\"./cbrowser\":6,\"./utils\":56}],23:[function(require,module,exports){\n\"use strict\";\n\nif (typeof require !== 'undefined') {\n    var utils = require('./utils');\n    var pusho = utils.pusho;\n    var pushnewo = utils.pushnewo;\n}\n\nfunction sortFeatures(tier) {\n    var dmin = tier.browser.drawnStart,\n        dmax = tier.browser.drawnEnd;\n    var ungroupedFeatures = {};\n    var groupedFeatures = {};\n    var drawnGroupedFeatures = {};\n    var groupMins = {},\n        groupMaxes = {};\n    var groups = {};\n    var superGroups = {};\n    var groupsToSupers = {};\n    var nonPositional = [];\n    var minScore, maxScore;\n    var fbid;\n\n    var init_fbid = function init_fbid() {\n        fbid = {};\n        for (var fi = 0; fi < tier.currentFeatures.length; ++fi) {\n            var f = tier.currentFeatures[fi];\n            if (f.id) {\n                fbid[f.id] = f;\n            }\n        }\n    };\n\n    var superParentsOf = function superParentsOf(f) {\n        // FIXME: should recur.\n        var spids = [];\n        if (f.parents) {\n            for (var pi = 0; pi < f.parents.length; ++pi) {\n                var pid = f.parents[pi];\n                var p = fbid[pid];\n                if (!p) {\n                    continue;\n                }\n                // alert(p.type + ':' + p.typeCv);\n                if (p.typeCv == 'SO:0000704') {\n                    pushnew(spids, pid);\n                }\n            }\n        }\n        return spids;\n    };\n\n    for (var fi = 0; fi < tier.currentFeatures.length; ++fi) {\n        var f = tier.currentFeatures[fi];\n        if (f.parts) {\n            continue;\n        }\n\n        var drawn = f.min <= dmax && f.max >= dmin;\n\n        if (!f.min || !f.max) {\n            nonPositional.push(f);\n            continue;\n        }\n\n        if (f.score && f.score != '.' && f.score != '-') {\n            var sc = 1.0 * f.score;\n            if (!minScore || sc < minScore) {\n                minScore = sc;\n            }\n            if (!maxScore || sc > maxScore) {\n                maxScore = sc;\n            }\n        }\n\n        var fGroups = [];\n        var fSuperGroup = null;\n        if (f.groups) {\n            for (var gi = 0; gi < f.groups.length; ++gi) {\n                var g = f.groups[gi];\n                var gid = g.id;\n                if (g.type == 'gene') {\n                    // Like a super-grouper...\n                    fSuperGroup = gid;\n                    groups[gid] = g;\n                } else if (g.type == 'translation') {\n                    // have to ignore this to get sensible results from bj-e :-(.\n                } else {\n                    pusho(groupedFeatures, gid, f);\n                    groups[gid] = g;\n                    fGroups.push(gid);\n\n                    var ogm = groupMins[gid];\n                    if (!ogm || f.min < ogm) groupMins[gid] = f.min;\n\n                    ogm = groupMaxes[gid];\n                    if (!ogm || f.max > ogm) groupMaxes[gid] = f.max;\n                }\n            }\n        }\n\n        if (f.parents) {\n            if (!fbid) {\n                init_fbid();\n            }\n            for (var pi = 0; pi < f.parents.length; ++pi) {\n                var pid = f.parents[pi];\n                var p = fbid[pid];\n                if (!p) {\n                    // alert(\"couldn't find \" + pid);\n                    continue;\n                }\n                if (!p.parts) {\n                    p.parts = [f];\n                }\n                pushnewo(groupedFeatures, pid, p);\n                pusho(groupedFeatures, pid, f);\n\n                if (!groups[pid]) {\n                    groups[pid] = {\n                        type: p.type,\n                        id: p.id,\n                        label: p.label || p.id\n                    };\n                }\n                fGroups.push(pid);\n\n                var ogm = groupMins[pid];\n                if (!ogm || f.min < ogm) groupMins[pid] = f.min;\n\n                ogm = groupMaxes[pid];\n                if (!ogm || f.max > ogm) groupMaxes[pid] = f.max;\n\n                var sgs = superParentsOf(p);\n                if (sgs.length > 0) {\n                    fSuperGroup = sgs[0];\n                    var sp = fbid[sgs[0]];\n                    groups[sgs[0]] = {\n                        type: sp.type,\n                        id: sp.id,\n                        label: sp.label || sp.id\n                    };\n                    if (!tier.dasSource.collapseSuperGroups) {\n                        tier.dasSource.collapseSuperGroups = true;\n                    }\n                }\n            }\n        }\n\n        if (fGroups.length == 0) {\n            if (drawn) pusho(ungroupedFeatures, f.type, f);\n        } else if (fSuperGroup) {\n            for (var g = 0; g < fGroups.length; ++g) {\n                var gid = fGroups[g];\n                pushnewo(superGroups, fSuperGroup, gid);\n                groupsToSupers[gid] = fSuperGroup;\n            }\n        }\n    }\n\n    for (var gid in groupedFeatures) {\n        var group = groups[gid];\n        if (typeof group.min !== 'number') group.min = groupMins[gid];\n        if (typeof group.max !== 'number') group.max = groupMaxes[gid];\n\n        if (groupMaxes[gid] >= dmin && groupMins[gid] <= dmax) drawnGroupedFeatures[gid] = groupedFeatures[gid];\n    }\n\n    tier.ungroupedFeatures = ungroupedFeatures;\n    tier.groupedFeatures = drawnGroupedFeatures;\n    tier.groups = groups;\n    tier.superGroups = superGroups;\n    tier.groupsToSupers = groupsToSupers;\n\n    if (minScore) {\n        if (minScore > 0) {\n            minScore = 0;\n        } else if (maxScore < 0) {\n            maxScore = 0;\n        }\n        tier.currentFeaturesMinScore = minScore;\n        tier.currentFeaturesMaxScore = maxScore;\n    }\n}\n\nif (typeof module !== 'undefined') {\n    module.exports = {\n        sortFeatures: sortFeatures\n    };\n}\n\n},{\"./utils\":56}],24:[function(require,module,exports){\n/* -*- mode: javascript; c-basic-offset: 4; indent-tabs-mode: nil -*- */\n\n// \n// Dalliance Genome Explorer\n// (c) Thomas Down 2006-2010\n//\n// glyphs.js: components which know how to draw themselves\n//\n\n\"use strict\";\n\nif (typeof require !== 'undefined') {\n    var spans = require('./spans');\n    var union = spans.union;\n    var Range = spans.Range;\n\n    var utils = require('./utils');\n    var makeElementNS = utils.makeElementNS;\n    var AMINO_ACID_TRANSLATION = utils.AMINO_ACID_TRANSLATION;\n\n    var svgu = require('./svg-utils');\n    var NS_SVG = svgu.NS_SVG;\n    var NS_XLINK = svgu.NS_XLINK;\n    var SVGPath = svgu.SVGPath;\n}\n\nfunction PathGlyphBase(stroke, fill) {\n    this._stroke = stroke;\n    this._fill = fill;\n}\n\nPathGlyphBase.prototype.draw = function (g) {\n    g.beginPath();\n    this.drawPath(g);\n\n    if (this._fill) {\n        g.fillStyle = this._fill;\n        g.fill();\n    }\n    if (this._stroke) {\n        g.strokeStyle = this._stroke;\n        g.stroke();\n    }\n};\n\nPathGlyphBase.prototype.toSVG = function () {\n    var g = new SVGPath();\n    this.drawPath(g);\n\n    return makeElementNS(NS_SVG, 'path', null, { d: g.toPathData(),\n        fill: this._fill || 'none',\n        stroke: this._stroke || 'none' });\n};\n\nPathGlyphBase.prototype.drawPath = function (g) {\n    throw 'drawPath method on PathGlyphBase must be overridden';\n};\n\nfunction BoxGlyph(x, y, width, height, fill, stroke, alpha, radius) {\n    this.x = x;\n    this.y = y;\n    this._width = width;\n    this._height = height;\n    this.fill = fill;\n    this.stroke = stroke;\n    this._alpha = alpha;\n    this._radius = radius || 0;\n}\n\nBoxGlyph.prototype.draw = function (g) {\n    var r = this._radius;\n\n    if (r > 0) {\n        g.beginPath();\n        g.moveTo(this.x + r, this.y);\n        g.lineTo(this.x + this._width - r, this.y);\n        g.arcTo(this.x + this._width, this.y, this.x + this._width, this.y + r, r);\n        g.lineTo(this.x + this._width, this.y + this._height - r);\n        g.arcTo(this.x + this._width, this.y + this._height, this.x + this._width - r, this.y + this._height, r);\n        g.lineTo(this.x + r, this.y + this._height);\n        g.arcTo(this.x, this.y + this._height, this.x, this.y + this._height - r, r);\n        g.lineTo(this.x, this.y + r);\n        g.arcTo(this.x, this.y, this.x + r, this.y, r);\n        g.closePath();\n\n        if (this._alpha != null) {\n            g.save();\n            g.globalAlpha = this._alpha;\n        }\n\n        if (this.fill) {\n            g.fillStyle = this.fill;\n            g.fill();\n        }\n        if (this.stroke) {\n            g.strokeStyle = this.stroke;\n            g.lineWidth = 0.5;\n            g.stroke();\n        }\n\n        if (this._alpha != null) {\n            g.restore();\n        }\n    } else {\n        if (this._alpha != null) {\n            g.save();\n            g.globalAlpha = this._alpha;\n        }\n\n        if (this.fill) {\n            g.fillStyle = this.fill;\n            g.fillRect(this.x, this.y, this._width, this._height);\n        }\n\n        if (this.stroke) {\n            g.strokeStyle = this.stroke;\n            g.lineWidth = 0.5;\n            g.strokeRect(this.x, this.y, this._width, this._height);\n        }\n\n        if (this._alpha != null) {\n            g.restore();\n        }\n    }\n};\n\nBoxGlyph.prototype.toSVG = function () {\n    var s = makeElementNS(NS_SVG, 'rect', null, { x: this.x,\n        y: this.y,\n        width: this._width,\n        height: this._height,\n        stroke: this.stroke || 'none',\n        strokeWidth: 0.5,\n        fill: this.fill || 'none' });\n    if (this._alpha != null) {\n        s.setAttribute('opacity', this._alpha);\n    }\n\n    return s;\n};\n\nBoxGlyph.prototype.min = function () {\n    return this.x;\n};\n\nBoxGlyph.prototype.max = function () {\n    return this.x + this._width;\n};\n\nBoxGlyph.prototype.height = function () {\n    return this.y + this._height;\n};\n\nfunction GroupGlyph(glyphs, connector) {\n    this.glyphs = glyphs;\n    this.connector = connector;\n    this.h = glyphs[0].height();\n\n    var covList = [];\n    for (var g = 0; g < glyphs.length; ++g) {\n        var gg = glyphs[g];\n        covList.push(new Range(gg.min(), gg.max()));\n        this.h = Math.max(this.h, gg.height());\n    }\n    this.coverage = union(covList);\n}\n\nGroupGlyph.prototype.drawConnectors = function (g) {\n    var ranges = this.coverage.ranges();\n    for (var r = 1; r < ranges.length; ++r) {\n        var gl = ranges[r];\n        var last = ranges[r - 1];\n        if (last && gl.min() > last.max()) {\n            var start = last.max();\n            var end = gl.min();\n            var mid = (start + end) / 2;\n\n            if (this.connector === 'hat+') {\n                g.moveTo(start, this.h / 2);\n                g.lineTo(mid, 0);\n                g.lineTo(end, this.h / 2);\n            } else if (this.connector === 'hat-') {\n                g.moveTo(start, this.h / 2);\n                g.lineTo(mid, this.h);\n                g.lineTo(end, this.h / 2);\n            } else if (this.connector === 'collapsed+') {\n                g.moveTo(start, this.h / 2);\n                g.lineTo(end, this.h / 2);\n                if (end - start > 4) {\n                    g.moveTo(mid - 2, this.h / 2 - 3);\n                    g.lineTo(mid + 2, this.h / 2);\n                    g.lineTo(mid - 2, this.h / 2 + 3);\n                }\n            } else if (this.connector === 'collapsed-') {\n                g.moveTo(start, this.h / 2);\n                g.lineTo(end, this.h / 2);\n                if (end - start > 4) {\n                    g.moveTo(mid + 2, this.h / 2 - 3);\n                    g.lineTo(mid - 2, this.h / 2);\n                    g.lineTo(mid + 2, this.h / 2 + 3);\n                }\n            } else {\n                g.moveTo(start, this.h / 2);\n                g.lineTo(end, this.h / 2);\n            }\n        }\n        last = gl;\n    }\n};\n\nGroupGlyph.prototype.draw = function (g, oc) {\n    for (var i = 0; i < this.glyphs.length; ++i) {\n        var gl = this.glyphs[i];\n        gl.draw(g, oc);\n    }\n\n    g.strokeStyle = 'black';\n    g.beginPath();\n    this.drawConnectors(g);\n    g.stroke();\n};\n\nGroupGlyph.prototype.toSVG = function () {\n    var g = makeElementNS(NS_SVG, 'g');\n    for (var i = 0; i < this.glyphs.length; ++i) {\n        g.appendChild(this.glyphs[i].toSVG());\n    }\n\n    var p = new SVGPath();\n    this.drawConnectors(p);\n\n    var pathData = p.toPathData();\n    if (pathData.length > 0) {\n        var path = makeElementNS(NS_SVG, 'path', null, { d: p.toPathData(),\n            fill: 'none',\n            stroke: 'black',\n            strokeWidth: 0.5 });\n        g.appendChild(path);\n    }\n\n    return g;\n};\n\nGroupGlyph.prototype.min = function () {\n    return this.coverage.min();\n};\n\nGroupGlyph.prototype.max = function () {\n    return this.coverage.max();\n};\n\nGroupGlyph.prototype.height = function () {\n    return this.h;\n};\n\nfunction LineGraphGlyph(points, color, height) {\n    this.points = points;\n    this.color = color;\n    this._height = height || 50;\n}\n\nLineGraphGlyph.prototype.min = function () {\n    return this.points[0].x;\n    // return this.points[0];\n};\n\nLineGraphGlyph.prototype.max = function () {\n    return this.points[this.points.length - 1].x;\n    // return this.points[this.points.length - 2];\n};\n\nLineGraphGlyph.prototype.height = function () {\n    return this._height;\n};\n\nLineGraphGlyph.prototype.draw = function (g) {\n    g.save();\n    g.strokeStyle = this.color;\n    g.lineWidth = 2;\n    g.beginPath();\n    this.points.forEach(function (p, i) {\n        if (i === 0) g.moveTo(p.x, p.y);else g.lineTo(p.x, p.y);\n    });\n    g.stroke();\n    g.restore();\n};\n\nLineGraphGlyph.prototype.toSVG = function () {\n    var p = new SVGPath();\n    for (var i = 0; i < this.points.length; ++i) {\n        var x = this.points[i].x;\n        var y = this.points[i].y;\n        if (i == 0) {\n            p.moveTo(x, y);\n        } else {\n            p.lineTo(x, y);\n        }\n    }\n\n    return makeElementNS(NS_SVG, 'path', null, { d: p.toPathData(),\n        fill: 'none',\n        stroke: this.color,\n        strokeWidth: '2px' });\n};\n\nfunction LabelledGlyph(GLOBAL_GC, glyph, text, unmeasured, anchor, align, font) {\n    this.glyph = glyph;\n    this.text = text;\n    this.anchor = anchor || 'left';\n    this.align = align || 'below';\n    if (font) {\n        this.font = font;\n    }\n    if (this.font) {\n        GLOBAL_GC.save();\n        GLOBAL_GC.font = this.font;\n    }\n    var metrics = GLOBAL_GC.measureText(text);\n    if (this.font) {\n        GLOBAL_GC.restore();\n    }\n    this.textLen = metrics.width;\n    this.textHeight = 5;\n    this.bump = glyph.bump;\n    this.measured = !unmeasured;\n}\n\nLabelledGlyph.prototype.toSVG = function () {\n    var child = this.glyph.toSVG();\n    var opts = {};\n\n    if (this.align == 'above') {\n        child = makeElementNS(NS_SVG, 'g', child, { transform: \"translate(0, \" + (this.textHeight | 0 + 2) + \")\" });\n        opts.y = this.textHeight;\n    } else {\n        opts.y = this.glyph.height() + 15;\n    }\n\n    if (this.font) {\n        opts.fontSize = 7;\n    }\n\n    if ('center' == this.anchor) {\n        opts.x = (this.glyph.min() + this.glyph.max() - this.textLen) / 2;\n    } else {\n        opts.x = this.glyph.min();\n    }\n\n    return makeElementNS(NS_SVG, 'g', [child, makeElementNS(NS_SVG, 'text', this.text, opts)]);\n};\n\nLabelledGlyph.prototype.min = function () {\n    return this.glyph.min();\n};\n\nLabelledGlyph.prototype.max = function () {\n    if (this.measured) return Math.max(this.glyph.max(), 1.0 * this.glyph.min() + this.textLen + 10);else return this.glyph.max();\n};\n\nLabelledGlyph.prototype.height = function () {\n    var h = this.glyph.height();\n    if (this.measured) {\n        if (this.align == 'above') {\n            h += this.textHeight + 2;\n        } else {\n            h += 20;\n        }\n    }\n    return h;\n};\n\nLabelledGlyph.prototype.draw = function (g, oc) {\n    if (this.align == 'above') {\n        g.save();\n        g.translate(0, this.textHeight + 2);\n    }\n    this.glyph.draw(g);\n    if (this.align == 'above') {\n        g.restore();\n    }\n\n    oc.registerGlyph(this);\n};\n\nLabelledGlyph.prototype.drawOverlay = function (g, minVisible, maxVisible) {\n    g.fillStyle = 'black';\n    if (this.font) {\n        g.save();\n        g.font = this.font;\n    }\n    var p;\n    if ('center' == this.anchor) {\n        p = (this.glyph.min() + this.glyph.max() - this.textLen) / 2;\n    } else {\n        p = this.glyph.min();\n        if (p < minVisible) {\n            p = Math.min(minVisible, this.glyph.max() - this.textLen);\n        }\n    }\n    g.fillText(this.text, p, this.align == 'above' ? this.textHeight : this.glyph.height() + 15);\n    if (this.font) {\n        g.restore();\n    }\n};\n\nfunction CrossGlyph(x, height, stroke) {\n    this._x = x;\n    this._height = height;\n    this._stroke = stroke;\n}\n\nCrossGlyph.prototype.draw = function (g) {\n    var hh = this._height / 2;\n\n    g.beginPath();\n    g.moveTo(this._x, 0);\n    g.lineTo(this._x, this._height);\n    g.moveTo(this._x - hh, hh);\n    g.lineTo(this._x + hh, hh);\n\n    g.strokeStyle = this._stroke;\n    g.lineWidth = 1;\n\n    g.stroke();\n};\n\nCrossGlyph.prototype.toSVG = function () {\n    var hh = this._height / 2;\n\n    var g = new SVGPath();\n    g.moveTo(this._x, 0);\n    g.lineTo(this._x, this._height);\n    g.moveTo(this._x - hh, hh);\n    g.lineTo(this._x + hh, hh);\n\n    return makeElementNS(NS_SVG, 'path', null, { d: g.toPathData(),\n        fill: 'none',\n        stroke: this._stroke,\n        strokeWidth: '1px' });\n};\n\nCrossGlyph.prototype.min = function () {\n    return this._x - this._height / 2;\n};\n\nCrossGlyph.prototype.max = function () {\n    return this._x + this._height / 2;\n};\n\nCrossGlyph.prototype.height = function () {\n    return this._height;\n};\n\nfunction ExGlyph(x, height, stroke) {\n    this._x = x;\n    this._height = height;\n    this._stroke = stroke;\n}\n\nExGlyph.prototype.draw = function (g) {\n    var hh = this._height / 2;\n\n    g.beginPath();\n    g.moveTo(this._x - hh, 0);\n    g.lineTo(this._x + hh, this._height);\n    g.moveTo(this._x - hh, this._height);\n    g.lineTo(this._x + hh, 0);\n\n    g.strokeStyle = this._stroke;\n    g.lineWidth = 1;\n\n    g.stroke();\n};\n\nExGlyph.prototype.toSVG = function () {\n    var hh = this._height / 2;\n\n    var g = new SVGPath();\n    g.moveTo(this._x - hh, 0);\n    g.lineTo(this._x + hh, this._height);\n    g.moveTo(this._x - hh, this._height);\n    g.lineTo(this._x + hh, 0);\n\n    return makeElementNS(NS_SVG, 'path', null, { d: g.toPathData(),\n        fill: 'none',\n        stroke: this._stroke,\n        strokeWidth: '1px' });\n};\n\nExGlyph.prototype.min = function () {\n    return this._x - this._height / 2;\n};\n\nExGlyph.prototype.max = function () {\n    return this._x + this._height / 2;\n};\n\nExGlyph.prototype.height = function () {\n    return this._height;\n};\n\nfunction TriangleGlyph(x, height, dir, width, fill, stroke) {\n    PathGlyphBase.call(this, stroke, fill);\n\n    this._x = x;\n    this._height = height;\n    this._dir = dir;\n    this._width = width;\n}\n\nTriangleGlyph.prototype = Object.create(PathGlyphBase.prototype);\n\nTriangleGlyph.prototype.drawPath = function (g) {\n    var hh = this._height / 2;\n    var hw = this._width / 2;\n\n    if (this._dir === 'S') {\n        g.moveTo(this._x, this._height);\n        g.lineTo(this._x - hw, 0);\n        g.lineTo(this._x + hw, 0);\n    } else if (this._dir === 'W') {\n        g.moveTo(this._x + hw, hh);\n        g.lineTo(this._x - hw, 0);\n        g.lineTo(this._x - hw, this._height);\n    } else if (this._dir === 'E') {\n        g.moveTo(this._x - hw, hh);\n        g.lineTo(this._x + hw, 0);\n        g.lineTo(this._x + hw, this._height);\n    } else {\n        g.moveTo(this._x, 0);\n        g.lineTo(this._x + hw, this._height);\n        g.lineTo(this._x - hw, this._height);\n    }\n\n    g.closePath();\n};\n\nTriangleGlyph.prototype.min = function () {\n    return this._x - this._height / 2;\n};\n\nTriangleGlyph.prototype.max = function () {\n    return this._x + this._height / 2;\n};\n\nTriangleGlyph.prototype.height = function () {\n    return this._height;\n};\n\nfunction DotGlyph(x, height, fill, stroke) {\n    this._x = x;\n    this._height = height;\n    this._fill = fill;\n    this._stroke = stroke;\n}\n\nDotGlyph.prototype.draw = function (g) {\n    var hh = this._height / 2;\n    g.fillStyle = this._stroke;\n    g.beginPath();\n    g.arc(this._x, hh, hh, 0, 6.29);\n\n    if (this._fill) {\n        g.fillStyle = this._fill;\n        g.fill();\n    }\n\n    if (this._stroke) {\n        g.strokeStyle = this._stroke;\n        g.stroke();\n    }\n};\n\nDotGlyph.prototype.toSVG = function () {\n    var hh = this._height / 2;\n    return makeElementNS(NS_SVG, 'circle', null, { cx: this._x, cy: hh, r: hh,\n        fill: this._fill || 'none',\n        stroke: this._stroke || 'none',\n        strokeWidth: '1px' });\n};\n\nDotGlyph.prototype.min = function () {\n    return this._x - this._height / 2;\n};\n\nDotGlyph.prototype.max = function () {\n    return this._x + this._height / 2;\n};\n\nDotGlyph.prototype.height = function () {\n    return this._height;\n};\n\nfunction PaddedGlyph(glyph, minp, maxp) {\n    this.glyph = glyph;\n    this._min = minp;\n    this._max = maxp;\n    if (glyph) {\n        this.bump = glyph.bump;\n    }\n}\n\nPaddedGlyph.prototype.draw = function (g, oc) {\n    if (this.glyph) this.glyph.draw(g, oc);\n};\n\nPaddedGlyph.prototype.toSVG = function () {\n    if (this.glyph) {\n        return this.glyph.toSVG();\n    } else {\n        return makeElementNS(NS_SVG, 'g');\n    }\n};\n\nPaddedGlyph.prototype.min = function () {\n    return this._min;\n};\n\nPaddedGlyph.prototype.max = function () {\n    return this._max;\n};\n\nPaddedGlyph.prototype.height = function () {\n    if (this.glyph) {\n        return this.glyph.height();\n    } else {\n        return 1;\n    }\n};\n\nfunction AArrowGlyph(min, max, height, fill, stroke, ori) {\n    PathGlyphBase.call(this, stroke, fill);\n    this._min = min;\n    this._max = max;\n    this._height = height;\n    this._ori = ori;\n}\n\nAArrowGlyph.prototype = Object.create(PathGlyphBase.prototype);\n\nAArrowGlyph.prototype.min = function () {\n    return this._min;\n};\n\nAArrowGlyph.prototype.max = function () {\n    return this._max;\n};\n\nAArrowGlyph.prototype.height = function () {\n    return this._height;\n};\n\nAArrowGlyph.prototype.drawPath = function (g) {\n    var maxPos = this._max;\n    var minPos = this._min;\n    var height = this._height;\n    var lInset = 0;\n    var rInset = 0;\n    var minLength = this._height + 2;\n    var instep = 0.333333 * this._height;\n    var y = 0;\n\n    if (this._ori) {\n        if (this._ori === '+') {\n            rInset = 0.5 * this._height;\n        } else if (this._ori === '-') {\n            lInset = 0.5 * this._height;\n        }\n    }\n\n    if (maxPos - minPos < minLength) {\n        minPos = (maxPos + minPos - minLength) / 2;\n        maxPos = minPos + minLength;\n    }\n\n    g.moveTo(minPos + lInset, y + instep);\n    g.lineTo(maxPos - rInset, y + instep);\n    g.lineTo(maxPos - rInset, y);\n    g.lineTo(maxPos, y + this._height / 2);\n    g.lineTo(maxPos - rInset, y + height);\n    g.lineTo(maxPos - rInset, y + instep + instep);\n    g.lineTo(minPos + lInset, y + instep + instep);\n    g.lineTo(minPos + lInset, y + height);\n    g.lineTo(minPos, y + height / 2);\n    g.lineTo(minPos + lInset, y);\n    g.lineTo(minPos + lInset, y + instep);\n};\n\nfunction SpanGlyph(min, max, height, stroke) {\n    PathGlyphBase.call(this, stroke, null);\n    this._min = min;\n    this._max = max;\n    this._height = height;\n}\n\nSpanGlyph.prototype = Object.create(PathGlyphBase.prototype);\n\nSpanGlyph.prototype.min = function () {\n    return this._min;\n};\nSpanGlyph.prototype.max = function () {\n    return this._max;\n};\nSpanGlyph.prototype.height = function () {\n    return this._height;\n};\n\nSpanGlyph.prototype.drawPath = function (g) {\n    var minPos = this._min,\n        maxPos = this._max;\n    var height = this._height,\n        hh = height / 2;\n    g.moveTo(minPos, hh);\n    g.lineTo(maxPos, hh);\n    g.moveTo(minPos, 0);\n    g.lineTo(minPos, height);\n    g.moveTo(maxPos, 0);\n    g.lineTo(maxPos, height);\n};\n\nfunction LineGlyph(min, max, height, style, strand, stroke) {\n    this._min = min;\n    this._max = max;\n    this._height = height;\n    this._style = style;\n    this._strand = strand;\n    this._stroke = stroke;\n}\n\nLineGlyph.prototype.min = function () {\n    return this._min;\n};\nLineGlyph.prototype.max = function () {\n    return this._max;\n};\nLineGlyph.prototype.height = function () {\n    return this._height;\n};\n\nLineGlyph.prototype.drawPath = function (g) {\n    var minPos = this._min,\n        maxPos = this._max;\n    var height = this._height,\n        hh = height / 2;\n\n    if (this._style === 'hat') {\n        g.moveTo(minPos, hh);\n        g.lineTo((minPos + maxPos) / 2, this._strand === '-' ? height : 0);\n        g.lineTo(maxPos, hh);\n    } else {\n        g.moveTo(minPos, hh);\n        g.lineTo(maxPos, hh);\n    }\n};\n\nLineGlyph.prototype.draw = function (g) {\n    g.beginPath();\n    this.drawPath(g);\n    g.strokeStyle = this._stroke;\n    if (this._style === 'dashed' && g.setLineDash) {\n        g.save();\n        g.setLineDash([3]);\n        g.stroke();\n        g.restore();\n    } else {\n        g.stroke();\n    }\n};\n\nLineGlyph.prototype.toSVG = function () {\n    var g = new SVGPath();\n    this.drawPath(g);\n\n    var opts = { d: g.toPathData(),\n        stroke: this._stroke || 'none' };\n    if (this._style === 'dashed') {\n        opts['strokeDasharray'] = '3';\n    }\n\n    return makeElementNS(NS_SVG, 'path', null, opts);\n};\n\nfunction PrimersGlyph(min, max, height, fill, stroke) {\n    this._min = min;\n    this._max = max;\n    this._height = height;\n    this._fill = fill;\n    this._stroke = stroke;\n}\n\nPrimersGlyph.prototype.min = function () {\n    return this._min;\n};\nPrimersGlyph.prototype.max = function () {\n    return this._max;\n};\nPrimersGlyph.prototype.height = function () {\n    return this._height;\n};\n\nPrimersGlyph.prototype.drawStemPath = function (g) {\n    var minPos = this._min,\n        maxPos = this._max;\n    var height = this._height,\n        hh = height / 2;\n    g.moveTo(minPos, hh);\n    g.lineTo(maxPos, hh);\n};\n\nPrimersGlyph.prototype.drawTrigsPath = function (g) {\n    var minPos = this._min,\n        maxPos = this._max;\n    var height = this._height,\n        hh = height / 2;\n    g.moveTo(minPos, 0);\n    g.lineTo(minPos + height, hh);\n    g.lineTo(minPos, height);\n    g.lineTo(minPos, 0);\n    g.moveTo(maxPos, 0);\n    g.lineTo(maxPos - height, hh);\n    g.lineTo(maxPos, height);\n    g.lineTo(maxPos, 0);\n};\n\nPrimersGlyph.prototype.draw = function (g) {\n    g.beginPath();\n    this.drawStemPath(g);\n    g.strokeStyle = this._stroke;\n    g.stroke();\n    g.beginPath();\n    this.drawTrigsPath(g);\n    g.fillStyle = this._fill;\n    g.fill();\n};\n\nPrimersGlyph.prototype.toSVG = function () {\n    var s = new SVGPath();\n    this.drawStemPath(s);\n    var t = new SVGPath();\n    this.drawTrigsPath(t);\n\n    return makeElementNS(NS_SVG, 'g', [makeElementNS(NS_SVG, 'path', null, { d: s.toPathData(),\n        stroke: this._stroke || 'none' }), makeElementNS(NS_SVG, 'path', null, { d: t.toPathData(),\n        fill: this._fill || 'none' })]);\n};\n\nfunction ArrowGlyph(min, max, height, color, parallel, sw, ne) {\n    PathGlyphBase.call(this, null, color);\n    this._min = min;\n    this._max = max;\n    this._height = height;\n    this._color = color;\n    this._parallel = parallel;\n    this._sw = sw;\n    this._ne = ne;\n}\n\nArrowGlyph.prototype = Object.create(PathGlyphBase.prototype);\n\nArrowGlyph.prototype.min = function () {\n    return this._min;\n};\nArrowGlyph.prototype.max = function () {\n    return this._max;\n};\nArrowGlyph.prototype.height = function () {\n    return this._height;\n};\n\nArrowGlyph.prototype.drawPath = function (g) {\n    var min = this._min,\n        max = this._max,\n        height = this._height;\n\n    if (this._parallel) {\n        var hh = height / 2;\n        var instep = 0.4 * height;\n        if (this._sw) {\n            g.moveTo(min + hh, height - instep);\n            g.lineTo(min + hh, height);\n            g.lineTo(min, hh);\n            g.lineTo(min + hh, 0);\n            g.lineTo(min + hh, instep);\n        } else {\n            g.moveTo(min, height - instep);\n            g.lineTo(min, instep);\n        }\n        if (this._ne) {\n            g.lineTo(max - hh, instep);\n            g.lineTo(max - hh, 0);\n            g.lineTo(max, hh);\n            g.lineTo(max - hh, height);\n            g.lineTo(max - hh, height - instep);\n        } else {\n            g.lineTo(max, instep);\n            g.lineTo(max, height - instep);\n        }\n        g.closePath();\n    } else {\n        var mid = (min + max) / 2;\n        var instep = 0.4 * (max - min);\n        var th = height / 3;\n\n        if (this._ne) {\n            g.moveTo(min + instep, th);\n            g.lineTo(min, th);\n            g.lineTo(mid, 0);\n            g.lineTo(max, th);\n            g.lineTo(max - instep, th);\n        } else {\n            g.moveTo(min + instep, 0);\n            g.lineTo(max - instep, 0);\n        }\n        if (this._sw) {\n            g.lineTo(max - instep, height - th);\n            g.lineTo(max, height - th);\n            g.lineTo(mid, height);\n            g.lineTo(min, height - th);\n            g.lineTo(min + instep, height - th);\n        } else {\n            g.lineTo(max - instep, height);\n            g.lineTo(min + instep, height);\n        }\n        g.closePath();\n    }\n};\n\nfunction TooManyGlyph(min, max, height, fill, stroke) {\n    this._min = min;\n    this._max = max;\n    this._height = height;\n    this._fill = fill;\n    this._stroke = stroke;\n}\n\nTooManyGlyph.prototype.min = function () {\n    return this._min;\n};\nTooManyGlyph.prototype.max = function () {\n    return this._max;\n};\nTooManyGlyph.prototype.height = function () {\n    return this._height;\n};\n\nTooManyGlyph.prototype.toSVG = function () {\n    return makeElementNS(NS_SVG, 'rect', null, { x: this._min,\n        y: 0,\n        width: this._max - this._min,\n        height: this._height,\n        stroke: this._stroke || 'none',\n        fill: this._fill || 'none' });\n};\n\nTooManyGlyph.prototype.draw = function (g) {\n    if (this._fill) {\n        g.fillStyle = this._fill;\n        g.fillRect(this._min, 0, this._max - this._min, this._height);\n    }\n    if (this._stroke) {\n        g.strokeStyle = this._stroke;\n        g.strokeRect(this._min, 0, this._max - this._min, this._height);\n        g.beginPath();\n        for (var n = 2; n < this._height; n += 3) {\n            g.moveTo(this._min, n);\n            g.lineTo(this._max, n);\n        }\n        g.stroke();\n    }\n};\n\nfunction TextGlyph(GLOBAL_GC, min, max, height, fill, string) {\n    this._min = min;\n    this._max = max;\n    this._height = height;\n    this._fill = fill;\n    this._string = string;\n    this._textLen = GLOBAL_GC.measureText(string).width;\n}\n\nTextGlyph.prototype.min = function () {\n    return this._min;\n};\nTextGlyph.prototype.max = function () {\n    return Math.max(this._max, this._min + this._textLen);\n};\nTextGlyph.prototype.height = function () {\n    return this._height;\n};\n\nTextGlyph.prototype.draw = function (g) {\n    g.fillStyle = this._fill;\n    g.fillText(this._string, this._min, this._height - 4);\n};\n\nTextGlyph.prototype.toSVG = function () {\n    return makeElementNS(NS_SVG, 'text', this._string, { x: this._min, y: this._height - 4 });\n};\n\nfunction aminoTileColor(aa, start, color) {\n    var ALTERNATE_COLOR = {\n        'red': 'darkred',\n        'purple': 'mediumpurple',\n        'blue': 'darkblue',\n        'green': 'darkgreen'\n    };\n    var color2 = ALTERNATE_COLOR[color.toLowerCase()];\n    var tileColors;\n    if (!color2) tileColors = ['rgb(73, 68, 149)', 'rgb(9, 0, 103)'];\n    // default to UCSC colors\n    else tileColors = [color, color2];\n\n    if (aa == '?') return 'black';else if (aa == 'M') return 'greenyellow';else if (aa == '*') return 'crimson';else return tileColors[start % 2];\n}\n\nfunction reverseComplement(sequence) {\n    var seq_dict = { 'A': 'T', 'T': 'A', 'G': 'C', 'C': 'G' };\n    var rev_seq = sequence.split('').reverse().join('');\n    var rev_compl_seq = [];\n    for (var b = 0; b < rev_seq.length; ++b) {\n        var base = rev_seq.substr(b, 1).toUpperCase();\n        rev_compl_seq.push(base in seq_dict ? seq_dict[base] : 'N');\n    }\n    return rev_compl_seq.join('');\n}\n\nfunction AminoAcidGlyph(min, max, height, fill, seq, orientation, readframe) {\n    this._min = min;\n    this._max = max;\n    this._height = height;\n    this._fill = fill;\n    this._seq = seq;\n    this._orientation = orientation;\n    this._readframe = readframe;\n}\n\nAminoAcidGlyph.prototype.min = function () {\n    return this._min;\n};\nAminoAcidGlyph.prototype.max = function () {\n    return this._max;\n};\nAminoAcidGlyph.prototype.height = function () {\n    return this._height;\n};\n\nAminoAcidGlyph.prototype.draw = function (gc) {\n    var seq = this._seq;\n    var color = this._fill;\n\n    if (!seq) return;\n\n    var scale = (this._max - this._min + 1) / seq.length;\n\n    var prevOverhang = (3 - this._readframe) % 3;\n    var nextOverhang = (seq.length - prevOverhang) % 3;\n    var leftOverhang = this._orientation == '+' ? prevOverhang : nextOverhang;\n\n    if (leftOverhang > 0) {\n        gc.fillStyle = color;\n        gc.fillRect(this._min, 0, scale * leftOverhang, this._height);\n    }\n\n    for (var p = leftOverhang; p < seq.length; p += 3) {\n        var codon = seq.substr(p, 3).toUpperCase();\n        if (this._orientation == '-') codon = reverseComplement(codon);\n        var aa = codon in AMINO_ACID_TRANSLATION ? AMINO_ACID_TRANSLATION[codon] : '?';\n        color = codon.length == 3 ? aminoTileColor(aa, p, this._fill) : this._fill;\n        gc.fillStyle = color;\n        gc.fillRect(this._min + p * scale, 0, scale * codon.length, this._height);\n\n        if (scale >= 8 && codon.length == 3) {\n            gc.fillStyle = 'white';\n            gc.fillText(aa, this._min + (p + 1) * scale, this._height);\n        }\n    }\n};\n\nAminoAcidGlyph.prototype.toSVG = function () {\n    var g = makeElementNS(NS_SVG, 'g');\n    var seq = this._seq;\n    var color = this._fill;\n\n    if (!seq) return g;\n\n    var scale = (this._max - this._min + 1) / seq.length;\n\n    var prevOverhang = (3 - this._readframe) % 3;\n    var nextOverhang = (seq.length - prevOverhang) % 3;\n    var leftOverhang = this._orientation == '+' ? prevOverhang : nextOverhang;\n\n    if (leftOverhang > 0) {\n        g.appendChild(makeElementNS(NS_SVG, 'rect', null, {\n            x: this._min,\n            y: 0,\n            width: scale * leftOverhang,\n            height: this._height,\n            fill: color }));\n    }\n    for (var p = leftOverhang; p < seq.length; p += 3) {\n        var codon = seq.substr(p, 3).toUpperCase();\n        if (this._orientation == '-') codon = reverseComplement(codon);\n        var aa = codon in AMINO_ACID_TRANSLATION ? AMINO_ACID_TRANSLATION[codon] : '?';\n        color = codon.length == 3 ? aminoTileColor(aa, p, this._fill) : this._fill;\n        g.appendChild(makeElementNS(NS_SVG, 'rect', null, {\n            x: this._min + p * scale,\n            y: 0,\n            width: scale * codon.length,\n            height: this._height,\n            fill: color }));\n\n        if (scale >= 8 && codon.length == 3) {\n            g.appendChild(makeElementNS(NS_SVG, 'text', aa, {\n                x: this._min + (p + 1) * scale,\n                y: this._height,\n                fill: 'white' }));\n        }\n    }\n    return g;\n};\n\nvar isRetina = typeof window !== 'undefined' && window.devicePixelRatio > 1;\nvar __dalliance_SequenceGlyphCache = {};\nvar altPattern = new RegExp('^[ACGT-]$');\nvar isCloseUp = function isCloseUp(scale) {\n    return scale >= 8;\n};\n\nfunction SequenceGlyph(baseColors, strandColor, min, max, height, seq, ref, scheme, quals, fillbg, scaleVertical) {\n    this.baseColors = baseColors;\n    this._strandColor = strandColor;\n    this._min = min;\n    this._max = max;\n    this._height = height;\n    this._seq = seq;\n    this._ref = ref;\n    this._scheme = scheme;\n    this._quals = quals;\n    this._fillbg = fillbg;\n    this._scaleVertical = scaleVertical;\n}\n\nSequenceGlyph.prototype.min = function () {\n    return this._min;\n};\nSequenceGlyph.prototype.max = function () {\n    return this._max;\n};\nSequenceGlyph.prototype.height = function () {\n    return this._height;\n};\n\nSequenceGlyph.prototype.alphaForQual = function (qual) {\n    return 0.1 + 0.9 * Math.max(0.0, Math.min(1.0 * qual / 30.0, 1.0));\n};\n\nSequenceGlyph.prototype.draw = function (gc) {\n    var seq = this._seq;\n    var ref = this._ref;\n    var mismatch = this._scheme === 'mismatch' || this._scheme === 'mismatch-all';\n    var all = this._scheme === 'mismatch-all';\n\n    var seqLength = seq ? seq.length : this._max - this._min + 1;\n    var scale = (this._max - this._min + 1) / seqLength;\n\n    if (mismatch && !isCloseUp(scale)) {\n        gc.fillStyle = this._strandColor;\n        if (this._scaleVertical) gc.fillRect(this._min, scale, this._max - this._min, scale);else gc.fillRect(this._min, this._height / 4, this._max - this._min, this._height / 2);\n    }\n\n    for (var p = 0; p < seqLength; ++p) {\n        var base = seq ? seq.substr(p, 1).toUpperCase() : 'N';\n\n        if (!altPattern.test(base) && !isCloseUp(scale)) continue;\n\n        var color = this.baseColors[base];\n\n        if (this._quals) {\n            var qc = this._quals.charCodeAt(p) - 33;\n            var oldAlpha = gc.globalAlpha; // NB hoisted!\n            gc.globalAlpha = this.alphaForQual(qc);\n        }\n\n        if (!color) {\n            var refBase = ref ? ref.substr(p, 1).toUpperCase() : 'N';\n            if (base == 'N' || refBase == 'N') color = 'gray';else color = this._strandColor;\n\n            if (all) base = refBase;\n        }\n\n        gc.fillStyle = color;\n\n        var alt = altPattern.test(base);\n        if (this._fillbg || !isCloseUp(scale) || !alt) {\n            if (this._scaleVertical) gc.fillRect(this._min + p * scale, scale, scale, scale);else gc.fillRect(this._min + p * scale, 0, scale, this._height);\n        }\n        if (isCloseUp(scale) && alt) {\n            var key = color + '_' + base;\n            var img = __dalliance_SequenceGlyphCache[key];\n            if (!img) {\n                img = document.createElement('canvas');\n                if (isRetina) {\n                    img.width = 16;\n                    img.height = 20;\n                } else {\n                    img.width = 8;\n                    img.height = 10;\n                }\n                var imgGc = img.getContext('2d');\n                if (isRetina) {\n                    imgGc.scale(2, 2);\n                }\n                imgGc.fillStyle = this._fillbg ? 'black' : color;\n                var w = imgGc.measureText(base).width;\n                imgGc.fillText(base, 0.5 * (8.0 - w), 8);\n                __dalliance_SequenceGlyphCache[key] = img;\n            }\n            var dy = this._scaleVertical ? scale : 0;\n            if (isRetina) gc.drawImage(img, this._min + p * scale + 0.5 * (scale - 8), dy, 8, 10);else gc.drawImage(img, this._min + p * scale + 0.5 * (scale - 8), dy);\n        }\n\n        if (this._quals) {\n            gc.globalAlpha = oldAlpha;\n        }\n    }\n};\n\nSequenceGlyph.prototype.toSVG = function () {\n    var seq = this._seq;\n    var ref = this._ref;\n    var mismatch = this._scheme === 'mismatch' || this._scheme === 'mismatch-all';\n    var all = this._scheme === 'mismatch-all';\n    var scale = (this._max - this._min + 1) / this._seq.length;\n    var g = makeElementNS(NS_SVG, 'g');\n\n    for (var p = 0; p < seq.length; ++p) {\n        var base = seq ? seq.substr(p, 1).toUpperCase() : 'N';\n        var color = this.baseColors[base];\n\n        if (!color) {\n            var refBase = ref ? ref.substr(p, 1).toUpperCase() : 'N';\n            if (base == 'N' || refBase == 'N') color = 'gray';else color = this._strandColor;\n\n            if (all) base = refBase;\n        }\n\n        var alpha = 1.0;\n        if (this._quals) {\n            var qc = this._quals.charCodeAt(p) - 33;\n            alpha = this.alphaForQual(qc);\n        }\n\n        var alt = altPattern.test(base);\n        if (this._fillbg || !isCloseUp(scale) || !alt) {\n            g.appendChild(makeElementNS(NS_SVG, 'rect', null, {\n                x: this._min + p * scale,\n                y: 0,\n                width: scale,\n                height: this._height,\n                fill: color,\n                fillOpacity: alpha }));\n        }\n\n        if (isCloseUp(scale) && alt) {\n            g.appendChild(makeElementNS(NS_SVG, 'text', base, {\n                x: this._min + (0.5 + p) * scale,\n                y: 8,\n                textAnchor: 'middle',\n                fill: this._fillbg ? 'black' : color,\n                fillOpacity: alpha }));\n        }\n    }\n\n    return g;\n};\n\nfunction TranslatedGlyph(glyph, x, y, height) {\n    this.glyph = glyph;\n    this._height = height;\n    this._x = x;\n    this._y = y;\n}\n\nTranslatedGlyph.prototype.height = function () {\n    if (this._height) {\n        return this._height;\n    } else {\n        return this.glyph.height() + this._y;\n    }\n};\n\nTranslatedGlyph.prototype.min = function () {\n    return this.glyph.min() + this._x;\n};\n\nTranslatedGlyph.prototype.max = function () {\n    return this.glyph.max() + this._x;\n};\n\nTranslatedGlyph.prototype.minY = function () {\n    return this._y;\n};\n\nTranslatedGlyph.prototype.maxY = function () {\n    return this._y + this.glyph.height();\n};\n\nTranslatedGlyph.prototype.draw = function (g, o) {\n    g.save();\n    g.translate(this._x, this._y);\n    this.glyph.draw(g, o);\n    g.restore();\n};\n\nTranslatedGlyph.prototype.toSVG = function () {\n    var s = this.glyph.toSVG();\n    s.setAttribute('transform', 'translate(' + this._x + ',' + this._y + ')');\n    return s;\n};\n\nfunction PointGlyph(x, y, height, fill) {\n    this._x = x;\n    this._y = y;\n    this._height = height;\n    this._fill = fill;\n}\n\nPointGlyph.prototype.min = function () {\n    return this._x - 2;\n};\n\nPointGlyph.prototype.max = function () {\n    return this._x + 2;\n};\n\nPointGlyph.prototype.height = function () {\n    return this._height;\n};\n\nPointGlyph.prototype.draw = function (g) {\n    g.save();\n    g.globalAlpha = 0.3;\n    g.fillStyle = this._fill;\n    g.beginPath();\n    g.arc(this._x, this._y, 1.5, 0, 6.29);\n    g.fill();\n    g.restore();\n};\n\nPointGlyph.prototype.toSVG = function () {\n    return makeElementNS(NS_SVG, 'circle', null, { cx: this._x, cy: this._y, r: 2,\n        fill: this._fill,\n        stroke: 'none' });\n};\n\nfunction GridGlyph(height, yOffset, spacing) {\n    this._height = height || 50;\n    this.yOffset = yOffset || 0;\n    this.spacing = spacing || 10;\n}\n\nGridGlyph.prototype.notSelectable = true;\n\nGridGlyph.prototype.min = function () {\n    return -100000;\n};\n\nGridGlyph.prototype.max = function () {\n    return 100000;\n};\n\nGridGlyph.prototype.height = function () {\n    return this._height;\n};\n\nGridGlyph.prototype.draw = function (g) {\n    g.save();\n    g.strokeStyle = 'black';\n    g.lineWidth = 0.1;\n\n    g.beginPath();\n    for (var y = this.yOffset; y <= this._height + this.yOffset; y += this.spacing) {\n        // for (var y = 0; y <= this._height; y += 10) {\n        g.moveTo(-5000, y);\n        g.lineTo(5000, y);\n    }\n    g.stroke();\n    g.restore();\n};\n\nGridGlyph.prototype.toSVG = function () {\n    var p = new SVGPath();\n    for (var y = 0; y <= this._height; y += 10) {\n        p.moveTo(-5000, y);\n        p.lineTo(5000, y);\n    }\n\n    return makeElementNS(NS_SVG, 'path', null, { d: p.toPathData(),\n        fill: 'none',\n        stroke: 'black',\n        strokeWidth: '0.1px' });\n};\n\nfunction StarGlyph(x, r, points, fill, stroke) {\n    PathGlyphBase.call(this, stroke, fill);\n    this._x = x;\n    this._r = r;\n    this._points = points;\n}\n\nStarGlyph.prototype = Object.create(PathGlyphBase.prototype);\n\nStarGlyph.prototype.min = function () {\n    return this._x - this._r;\n};\n\nStarGlyph.prototype.max = function () {\n    return this._x + this._r;\n};\n\nStarGlyph.prototype.height = function () {\n    return 2 * this._r;\n};\n\nStarGlyph.prototype.drawPath = function (g) {\n    var midX = this._x,\n        midY = this._r,\n        r = this._r;\n    for (var p = 0; p < this._points; ++p) {\n        var theta = p * 6.28 / this._points;\n        var px = midX + r * Math.sin(theta);\n        var py = midY - r * Math.cos(theta);\n        if (p == 0) {\n            g.moveTo(px, py);\n        } else {\n            g.lineTo(px, py);\n        }\n        theta = (p + 0.5) * 6.28 / this._points;\n        px = midX + 0.4 * r * Math.sin(theta);\n        py = midY - 0.4 * r * Math.cos(theta);\n        g.lineTo(px, py);\n    }\n    g.closePath();\n};\n\nfunction PlimsollGlyph(x, height, overhang, fill, stroke) {\n    this._x = x;\n    this._height = height;\n    this._overhang = overhang;\n    this._fill = fill;\n    this._stroke = stroke;\n    this._hh = height / 2;\n}\n\nPlimsollGlyph.prototype.draw = function (g) {\n    var hh = this._height / 2;\n    g.fillStyle = this._stroke;\n    g.beginPath();\n    g.arc(this._x, hh, hh - this._overhang, 0, 6.29);\n    g.moveTo(this._x, 0);\n    g.lineTo(this._x, this._height);\n\n    if (this._fill) {\n        g.fillStyle = this._fill;\n        g.fill();\n    }\n\n    if (this._stroke) {\n        g.strokeStyle = this._stroke;\n        g.stroke();\n    }\n};\n\nPlimsollGlyph.prototype.toSVG = function () {\n    var hh = this._hh;\n    return makeElementNS(NS_SVG, 'g', [makeElementNS(NS_SVG, 'circle', null, { cx: this._x, cy: hh, r: hh - this._overhang }), makeElementNS(NS_SVG, 'line', null, { x1: this._x, y1: 0, x2: this._x, y2: this._height })], { fill: this._fill || 'none',\n        stroke: this._stroke || 'none',\n        strokeWidth: '1px' });\n};\n\nPlimsollGlyph.prototype.min = function () {\n    return this._x - this._hh;\n};\n\nPlimsollGlyph.prototype.max = function () {\n    return this._x + this._hh;\n};\n\nPlimsollGlyph.prototype.height = function () {\n    return this._height;\n};\n\nfunction OverlayLabelCanvas() {\n    this.ox = 0;\n    this.oy = 0;\n    this.glyphs = [];\n}\n\nOverlayLabelCanvas.prototype.translate = function (x, y) {\n    this.ox += x;\n    this.oy += y;\n};\n\nOverlayLabelCanvas.prototype.registerGlyph = function (g) {\n    this.glyphs.push({\n        x: this.ox,\n        y: this.oy,\n        glyph: g\n    });\n};\n\nOverlayLabelCanvas.prototype.draw = function (g, minVisible, maxVisible) {\n    for (var gi = 0; gi < this.glyphs.length; ++gi) {\n        var gg = this.glyphs[gi];\n        g.save();\n        g.translate(gg.x, gg.y);\n        gg.glyph.drawOverlay(g, minVisible, maxVisible);\n        g.restore();\n    }\n};\n\nif (typeof module !== 'undefined') {\n    module.exports = {\n        BoxGlyph: BoxGlyph,\n        GroupGlyph: GroupGlyph,\n        LineGraphGlyph: LineGraphGlyph,\n        LabelledGlyph: LabelledGlyph,\n        CrossGlyph: CrossGlyph,\n        ExGlyph: ExGlyph,\n        TriangleGlyph: TriangleGlyph,\n        DotGlyph: DotGlyph,\n        PaddedGlyph: PaddedGlyph,\n        AArrowGlyph: AArrowGlyph,\n        SpanGlyph: SpanGlyph,\n        LineGlyph: LineGlyph,\n        PrimersGlyph: PrimersGlyph,\n        ArrowGlyph: ArrowGlyph,\n        TooManyGlyph: TooManyGlyph,\n        TextGlyph: TextGlyph,\n        SequenceGlyph: SequenceGlyph,\n        AminoAcidGlyph: AminoAcidGlyph,\n        TranslatedGlyph: TranslatedGlyph,\n        GridGlyph: GridGlyph,\n        StarGlyph: StarGlyph,\n        PointGlyph: PointGlyph,\n        PlimsollGlyph: PlimsollGlyph,\n\n        OverlayLabelCanvas: OverlayLabelCanvas\n    };\n}\n\n},{\"./spans\":41,\"./svg-utils\":45,\"./utils\":56}],25:[function(require,module,exports){\n'use strict';\n\n/* -*- mode: javascript; c-basic-offset: 4; indent-tabs-mode: nil -*- */\n\n// \n// Dalliance Genome Explorer\n// (c) Thomas Down 2006-2013\n//\n// jbjson.js -- query JBrowse-style REST data stores\n//\n\nif (typeof require !== 'undefined') {\n    var das = require('./das');\n    var DASStylesheet = das.DASStylesheet;\n    var DASStyle = das.DASStyle;\n    var DASFeature = das.DASFeature;\n    var DASGroup = das.DASGroup;\n\n    var utils = require('./utils');\n    var shallowCopy = utils.shallowCopy;\n\n    var spans = require('./spans');\n    var Range = spans.Range;\n    var union = spans.union;\n    var intersection = spans.intersection;\n}\n\nfunction JBrowseStore(base, query) {\n    this.base = base;\n    this.query = query;\n}\n\nfunction jbori(strand) {\n    if (strand > 0) return '+';else if (strand < 0) return '-';\n}\n\nJBrowseStore.prototype.features = function (segment, opts, callback) {\n    opts = opts || {};\n\n    url = this.base + '/features/' + segment.name;\n\n    var filters = [];\n    if (this.query) {\n        filters.push(this.query);\n    }\n    if (segment.isBounded) {\n        filters.push('start=' + segment.start);\n        filters.push('end=' + segment.end);\n    }\n    if (filters.length > 0) {\n        url = url + '?' + filters.join('&');\n    }\n\n    var req = new XMLHttpRequest();\n    req.onreadystatechange = function () {\n        if (req.readyState == 4) {\n            if (req.status >= 300) {\n                callback(null, 'Error code ' + req.status);\n            } else {\n                var jf = JSON.parse(req.response)['features'];\n                var features = [];\n                for (fi = 0; fi < jf.length; ++fi) {\n                    var j = jf[fi];\n\n                    var f = new DASFeature();\n                    f.segment = segment.name;\n                    f.min = (j['start'] | 0) + 1;\n                    f.max = j['end'] | 0;\n                    if (j.name) {\n                        f.label = j.name;\n                    }\n                    if (j.strand) f.orientation = jbori(j.strand);\n                    f.type = j.type || 'unknown';\n\n                    if (j.subfeatures && j.subfeatures.length > 0) {\n                        f.id = j.uniqueID;\n\n                        var blocks = [];\n                        var cds = [];\n                        var all = [];\n\n                        for (var si = 0; si < j.subfeatures.length; ++si) {\n                            var sj = j.subfeatures[si];\n                            var sf = shallowCopy(f);\n                            sf.min = sj.start + 1;\n                            sf.max = sj.end;\n                            sf.groups = [f];\n\n                            all.push(sf);\n                            blocks.push(new Range(sf.min, sf.max));\n                            if (sj.type === 'CDS') cds.push(sf);\n                        }\n\n                        if (cds.length > 0) {\n                            spans = union(blocks);\n                            var txGroup = shallowCopy(f);\n                            txGroup.type = 'transcript';\n                            spans.ranges().forEach(function (exon) {\n                                features.push({\n                                    segment: segment.name,\n                                    min: exon.min(),\n                                    max: exon.max(),\n                                    orientation: f.orientation,\n                                    groups: [txGroup],\n                                    type: 'transcript'\n                                });\n                            });\n\n                            var tlGroup = shallowCopy(f);\n                            cds.forEach(function (cdsExon) {\n                                cdsExon.type = 'translation';\n                                cdsExon.groups = [tlGroup];\n                                features.push(cdsExon);\n                            });\n                        } else {\n                            all.forEach(function (f) {\n                                features.push(f);\n                            });\n                        }\n                    } else {\n                        features.push(f);\n                    }\n                }\n                callback(features);\n            }\n        }\n    };\n\n    req.open('GET', url, true);\n    req.responseType = 'text';\n    req.send();\n};\n\nif (typeof module !== 'undefined') {\n    module.exports = {\n        JBrowseStore: JBrowseStore\n    };\n}\n\n},{\"./das\":11,\"./spans\":41,\"./utils\":56}],26:[function(require,module,exports){\n/* -*- mode: javascript; c-basic-offset: 4; indent-tabs-mode: nil -*- */\n\n//\n// Dalliance Genome Explorer\n// (c) Thomas Down 2006-2013\n//\n// kspace.js\n//\n\n\"use strict\";\n\nif (typeof require !== 'undefined') {\n    var utils = require('./utils');\n    var Awaited = utils.Awaited;\n    var pusho = utils.pusho;\n\n    var sa = require('./sourceadapters');\n    var MappedFeatureSource = sa.MappedFeatureSource;\n    var CachingFeatureSource = sa.CachingFeatureSource;\n    var BWGFeatureSource = sa.BWGFeatureSource;\n    var RemoteBWGFeatureSource = sa.RemoteBWGFeatureSource;\n    var BAMFeatureSource = sa.BAMFeatureSource;\n    var RemoteBAMFeatureSource = sa.RemoteBAMFeatureSource;\n    var DummySequenceSource = sa.DummySequenceSource;\n    var DummyFeatureSource = sa.DummyFeatureSource;\n\n    var OverlayFeatureSource = require('./overlay').OverlayFeatureSource;\n\n    var spans = require('./spans');\n    var Range = spans.Range;\n    var union = spans.union;\n    var intersection = spans.intersection;\n\n    var sample = require('./sample');\n    var downsample = sample.downsample;\n    var getBaseCoverage = sample.getBaseCoverage;\n\n    var das = require('./das');\n    var DASSequence = das.DASSequence;\n\n    var Promise = require('es6-promise').Promise;\n}\n\nfunction FetchPool() {\n    var self = this;\n    this.reqs = [];\n    this.awaitedFeatures = {};\n    this.requestsIssued = new Promise(function (resolve, reject) {\n        self.notifyRequestsIssued = resolve;\n    });\n}\n\nFetchPool.prototype.addRequest = function (xhr) {\n    this.reqs.push(xhr);\n};\n\nFetchPool.prototype.abortAll = function () {\n    for (var i = 0; i < this.reqs.length; ++i) {\n        this.reqs[i].abort();\n    }\n};\n\nfunction KSCacheBaton(chr, min, max, scale, features, status, coverage) {\n    this.chr = chr;\n    this.min = min;\n    this.max = max;\n    this.coverage = coverage;\n    this.scale = scale;\n    this.features = features || [];\n    this.status = status;\n}\n\nKSCacheBaton.prototype.toString = function () {\n    return this.chr + \":\" + this.min + \"..\" + this.max + \";scale=\" + this.scale;\n};\n\nfunction KnownSpace(tierMap, chr, min, max, scale, seqSource) {\n    this.tierMap = tierMap;\n    this.chr = chr;\n    this.min = min;\n    this.max = max;\n    this.scale = scale;\n    this.seqSource = seqSource || new DummySequenceSource();\n    this.viewCount = 0;\n\n    this.featureCache = {};\n    this.latestViews = {};\n}\n\nKnownSpace.prototype.cancel = function () {\n    this.cancelled = true;\n};\n\nKnownSpace.prototype.bestCacheOverlapping = function (chr, min, max) {\n    var baton = this.featureCache[this.tierMap[0]];\n    if (baton) {\n        return baton;\n    } else {\n        return null;\n    }\n};\n\nKnownSpace.prototype.retrieveFeatures = function (tiers, chr, min, max, scale) {\n    if (scale != scale) {\n        throw \"retrieveFeatures called with silly scale\";\n    }\n\n    if (chr != this.chr) {\n        throw \"Can't extend Known Space to a new chromosome\";\n    }\n    if (min < 1) {\n        min = 1;\n    }\n\n    this.min = min;\n    this.max = max;\n    this.scale = scale;\n\n    if (this.pool) {\n        this.pool.abortAll();\n    }\n    this.pool = new FetchPool();\n    this.awaitedSeq = new Awaited();\n    this.seqWasFetched = false;\n    this.viewCount++;\n\n    this.startFetchesForTiers(tiers);\n    this.pool.notifyRequestsIssued();\n};\n\nfunction filterFeatures(features, min, max) {\n    var ff = [];\n    var featuresByGroup = {};\n\n    for (var fi = 0; fi < features.length; ++fi) {\n        var f = features[fi];\n        if (!f.min || !f.max) {\n            ff.push(f);\n        } else if (f.groups && f.groups.length > 0) {\n            pusho(featuresByGroup, f.groups[0].id, f);\n        } else if (f.min <= max && f.max >= min) {\n            ff.push(f);\n        }\n    }\n\n    for (var gid in featuresByGroup) {\n        var gf = featuresByGroup[gid];\n        var gmin = 100000000000,\n            gmax = -100000000000;\n        for (var fi = 0; fi < gf.length; ++fi) {\n            var f = gf[fi];\n            gmin = Math.min(gmin, f.min);\n            gmax = Math.max(gmax, f.max);\n        }\n        if (gmin <= max || gmax >= min) {\n            for (var fi = 0; fi < gf.length; ++fi) {\n                ff.push(gf[fi]);\n            }\n        }\n    }\n\n    return ff;\n}\n\nKnownSpace.prototype.invalidate = function (tier) {\n    if (!this.pool) {\n        return;\n    }\n\n    this.featureCache[tier] = null;\n    this.startFetchesForTiers([tier]);\n};\n\nKnownSpace.prototype.startFetchesForTiers = function (tiers) {\n    var thisB = this;\n\n    var awaitedSeq = this.awaitedSeq;\n    var needSeq = false;\n\n    var gex;\n\n    for (var t = 0; t < tiers.length; ++t) {\n        var tierRenderer = tiers[t].browser.getTierRenderer(tiers[t]);\n        try {\n            if (this.startFetchesFor(tiers[t], awaitedSeq)) {\n                needSeq = true;\n            }\n        } catch (ex) {\n            var tier = tiers[t];\n\n            tier.currentFeatures = [];\n            tier.currentSequence = null;\n            console.log('Error fetching tier source');\n            console.log(ex);\n            gex = ex;\n            console.log(ex.stack);\n            tierRenderer.renderTier(ex, tier);\n            tier.wasRendered();\n        }\n    }\n\n    if (needSeq && !this.seqWasFetched) {\n        this.seqWasFetched = true;\n        var smin = this.min,\n            smax = this.max;\n\n        if (this.cs) {\n            if (this.cs.start <= smin && this.cs.end >= smax) {\n                var cachedSeq;\n                if (this.cs.start == smin && this.cs.end == smax) {\n                    cachedSeq = this.cs;\n                } else {\n                    cachedSeq = new DASSequence(this.cs.name, smin, smax, this.cs.alphabet, this.cs.seq.substring(smin - this.cs.start, smax + 1 - this.cs.start));\n                }\n                return awaitedSeq.provide(cachedSeq);\n            }\n        }\n\n        this.seqSource.fetch(this.chr, smin, smax, this.pool, function (err, seq) {\n            if (seq) {\n                if (!thisB.cs || smin <= thisB.cs.start && smax >= thisB.cs.end || smin >= thisB.cs.end || smax <= thisB.cs.start || smax - smin > thisB.cs.end - thisB.cs.start) {\n                    thisB.cs = seq;\n                }\n                awaitedSeq.provide(seq);\n            } else {\n                console.log('Sequence loading failed', err);\n                awaitedSeq.provide(null);\n            }\n        });\n    }\n\n    if (gex) throw gex;\n};\n\nKnownSpace.prototype.startFetchesFor = function (tier, awaitedSeq) {\n    var thisB = this;\n\n    var viewID = this.viewCount;\n    var source = tier.getSource() || new DummyFeatureSource();\n    var needsSeq = tier.needsSequence(this.scale);\n    var baton = thisB.featureCache[tier];\n    var styleFilters = tier.getActiveStyleFilters(this.scale);\n    var wantedTypes;\n    if (styleFilters) wantedTypes = styleFilters.typeList();\n    var chr = this.chr,\n        min = this.min,\n        max = this.max;\n\n    if (wantedTypes === undefined) {\n        return false;\n    }\n    if (baton && baton.chr === this.chr && baton.min <= min && baton.max >= max) {\n        var cachedFeatures = baton.features;\n        if (baton.min < min || baton.max > max) {\n            cachedFeatures = filterFeatures(cachedFeatures, min, max);\n        }\n\n        thisB.provision(tier, baton.chr, intersection(baton.coverage, new Range(min, max)), baton.scale, wantedTypes, cachedFeatures, baton.status, needsSeq ? awaitedSeq : null);\n\n        var availableScales = source.getScales();\n\n        if (baton.scale <= this.scale || !availableScales) {\n            return needsSeq;\n        }\n    }\n\n    if (source.instrument) console.log('Starting  fetch ' + viewID + ' (' + min + ', ' + max + ')');\n\n    source.fetch(chr, min, max, this.scale, wantedTypes, this.pool, function (status, features, scale, coverage) {\n        if (source.instrument) console.log('Finishing fetch ' + viewID);\n\n        var latestViewID = thisB.latestViews[tier] || -1;\n        if (thisB.cancelled || latestViewID > viewID) {\n            return;\n        }\n\n        if (!coverage) {\n            coverage = new Range(min, max);\n        }\n\n        if (!baton || min < baton.min || max > baton.max) {\n            // FIXME should be merging in some cases?\n            thisB.featureCache[tier] = new KSCacheBaton(chr, min, max, scale, features, status, coverage);\n        }\n\n        thisB.latestViews[tier] = viewID;\n        thisB.provision(tier, chr, coverage, scale, wantedTypes, features, status, needsSeq ? awaitedSeq : null);\n    }, styleFilters);\n    return needsSeq;\n};\n\nKnownSpace.prototype.provision = function (tier, chr, coverage, actualScale, wantedTypes, features, status, awaitedSeq) {\n    var tierRenderer = tier.browser.getTierRenderer(tier);\n    if (status) {\n        tier.setFeatures(chr, coverage, actualScale, [], null);\n        if (!features) {\n            var e = new Error(status);\n            status = \"Error fetching data: \" + status + \"; see browser console\";\n            console.log(\"Error fetching data for tier \" + tier.dasSource.name + \":\");\n            console.log(tier.dasSource);\n            console.log(\"Stack trace:\");\n            console.log(e.stack);\n        }\n        tierRenderer.renderTier(status, tier);\n        tier.wasRendered();\n    } else {\n        var mayDownsample = false;\n        var needBaseComposition = false;\n        var src = tier.getSource();\n        while (MappedFeatureSource.prototype.isPrototypeOf(src) || CachingFeatureSource.prototype.isPrototypeOf(src) || OverlayFeatureSource.prototype.isPrototypeOf(src)) {\n\n            if (OverlayFeatureSource.prototype.isPrototypeOf(src)) {\n                src = src.sources[0];\n            } else {\n                src = src.source;\n            }\n        }\n        if (BWGFeatureSource.prototype.isPrototypeOf(src) || RemoteBWGFeatureSource.prototype.isPrototypeOf(src) || BAMFeatureSource.prototype.isPrototypeOf(src) || RemoteBAMFeatureSource.prototype.isPrototypeOf(src)) {\n\n            mayDownsample = true;\n        }\n\n        if (!src.opts || !src.opts.forceReduction && !src.opts.noDownsample) {\n            if ( /* (actualScale < (this.scale/2) && features.length > 200)  || */\n            mayDownsample && wantedTypes && wantedTypes.length == 1 && wantedTypes.indexOf('density') >= 0) {\n                features = downsample(features, this.scale);\n            }\n        }\n\n        if (wantedTypes && wantedTypes.length == 1 && wantedTypes.indexOf('base-coverage') >= 0) {\n            // Base-composition coverage track\n            needBaseComposition = true;\n        }\n\n        if (awaitedSeq) {\n            awaitedSeq.await(function (seq) {\n                if (needBaseComposition) {\n                    features = getBaseCoverage(features, seq, tier.browser.baseColors);\n                }\n                tier.setFeatures(chr, coverage, actualScale, features, seq);\n                tierRenderer.renderTier(status, tier);\n                tier.wasRendered();\n            });\n        } else {\n            tier.setFeatures(chr, coverage, actualScale, features);\n            tierRenderer.renderTier(status, tier);\n            tier.wasRendered();\n        }\n    }\n};\n\nif (typeof module !== 'undefined') {\n    module.exports = {\n        KnownSpace: KnownSpace\n    };\n}\n\n},{\"./das\":11,\"./overlay\":31,\"./sample\":34,\"./sourceadapters\":39,\"./spans\":41,\"./utils\":56,\"es6-promise\":60}],27:[function(require,module,exports){\n'use strict';\n\n/* -*- mode: javascript; c-basic-offset: 4; indent-tabs-mode: nil -*- */\n\n// \n// Dalliance Genome Explorer\n// (c) Thomas Down 2006-2011\n//\n// lh3utils.js: common support for lh3's file formats\n//\n\nif (typeof require !== 'undefined') {\n    var jszlib = require('jszlib');\n    var jszlib_inflate_buffer = jszlib.inflateBuffer;\n    var arrayCopy = jszlib.arrayCopy;\n}\n\nfunction Vob(b, o) {\n    this.block = b;\n    this.offset = o;\n}\n\nVob.prototype.toString = function () {\n    return '' + this.block + ':' + this.offset;\n};\n\nfunction readVob(ba, offset, allowZero) {\n    var block = (ba[offset + 6] & 0xff) * 0x100000000 + (ba[offset + 5] & 0xff) * 0x1000000 + (ba[offset + 4] & 0xff) * 0x10000 + (ba[offset + 3] & 0xff) * 0x100 + (ba[offset + 2] & 0xff);\n    var bint = ba[offset + 1] << 8 | ba[offset];\n    if (block == 0 && bint == 0 && !allowZero) {\n        return null; // Should only happen in the linear index?\n    } else {\n        return new Vob(block, bint);\n    }\n}\n\nfunction unbgzf(data, lim) {\n    lim = Math.min(lim || 1, data.byteLength - 50);\n    var oBlockList = [];\n    var ptr = [0];\n    var totalSize = 0;\n\n    while (ptr[0] < lim) {\n        var ba = new Uint8Array(data, ptr[0], 12); // FIXME is this enough for all credible BGZF block headers?\n        var xlen = ba[11] << 8 | ba[10];\n        // dlog('xlen[' + (ptr[0]) +']=' + xlen);\n        var unc = jszlib_inflate_buffer(data, 12 + xlen + ptr[0], Math.min(65536, data.byteLength - 12 - xlen - ptr[0]), ptr);\n        ptr[0] += 8;\n        totalSize += unc.byteLength;\n        oBlockList.push(unc);\n    }\n\n    if (oBlockList.length == 1) {\n        return oBlockList[0];\n    } else {\n        var out = new Uint8Array(totalSize);\n        var cursor = 0;\n        for (var i = 0; i < oBlockList.length; ++i) {\n            var b = new Uint8Array(oBlockList[i]);\n            arrayCopy(b, 0, out, cursor, b.length);\n            cursor += b.length;\n        }\n        return out.buffer;\n    }\n}\n\nfunction Chunk(minv, maxv) {\n    this.minv = minv;this.maxv = maxv;\n}\n\n//\n// Binning (transliterated from SAM1.3 spec)\n//\n\n/* calculate bin given an alignment covering [beg,end) (zero-based, half-close-half-open) */\nfunction reg2bin(beg, end) {\n    --end;\n    if (beg >> 14 == end >> 14) return ((1 << 15) - 1) / 7 + (beg >> 14);\n    if (beg >> 17 == end >> 17) return ((1 << 12) - 1) / 7 + (beg >> 17);\n    if (beg >> 20 == end >> 20) return ((1 << 9) - 1) / 7 + (beg >> 20);\n    if (beg >> 23 == end >> 23) return ((1 << 6) - 1) / 7 + (beg >> 23);\n    if (beg >> 26 == end >> 26) return ((1 << 3) - 1) / 7 + (beg >> 26);\n    return 0;\n}\n\n/* calculate the list of bins that may overlap with region [beg,end) (zero-based) */\nvar MAX_BIN = ((1 << 18) - 1) / 7;\nfunction reg2bins(beg, end) {\n    var i = 0,\n        k,\n        list = [];\n    --end;\n    list.push(0);\n    for (k = 1 + (beg >> 26); k <= 1 + (end >> 26); ++k) {\n        list.push(k);\n    }for (k = 9 + (beg >> 23); k <= 9 + (end >> 23); ++k) {\n        list.push(k);\n    }for (k = 73 + (beg >> 20); k <= 73 + (end >> 20); ++k) {\n        list.push(k);\n    }for (k = 585 + (beg >> 17); k <= 585 + (end >> 17); ++k) {\n        list.push(k);\n    }for (k = 4681 + (beg >> 14); k <= 4681 + (end >> 14); ++k) {\n        list.push(k);\n    }return list;\n}\n\nif (typeof module !== 'undefined') {\n    module.exports = {\n        unbgzf: unbgzf,\n        readVob: readVob,\n        reg2bin: reg2bin,\n        reg2bins: reg2bins,\n        Chunk: Chunk\n    };\n}\n\n},{\"jszlib\":71}],28:[function(require,module,exports){\n/* -*- mode: javascript; c-basic-offset: 4; indent-tabs-mode: nil -*- */\n\n// \n// Dalliance Genome Explorer\n// (c) Thomas Down 2006-2014\n//\n// memstore.js\n//\n\n\"use strict\";\n\nif (typeof require !== 'undefined') {\n    var sa = require('./sourceadapters');\n    var dalliance_registerSourceAdapterFactory = sa.registerSourceAdapterFactory;\n    var dalliance_makeParser = sa.makeParser;\n    var FeatureSourceBase = sa.FeatureSourceBase;\n\n    var das = require('./das');\n    var DASStylesheet = das.DASStylesheet;\n    var DASStyle = das.DASStyle;\n    var DASFeature = das.DASFeature;\n    var DASGroup = das.DASGroup;\n\n    var utils = require('./utils');\n    var Awaited = utils.Awaited;\n    var textXHR = utils.textXHR;\n}\n\nfunction MemStore() {\n    this.featuresByChr = {};\n    this.maxLength = 1;\n    this.chrRing = null;\n}\n\nMemStore.prototype.addFeatures = function (features) {\n    var dirty = {};\n    for (var fi = 0; fi < features.length; ++fi) {\n        var f = features[fi];\n        var chr = f.segment || f.chr;\n        var fa = this.featuresByChr[chr];\n        if (!fa) {\n            fa = [];\n            this.featuresByChr[chr] = fa;\n        }\n        fa.push(f);\n        dirty[chr] = true;\n\n        var len = f.max - f.min + 1;\n        if (len > this.maxLength) this.maxLength = len;\n    }\n\n    for (chr in dirty) {\n        var fa = this.featuresByChr[chr];\n        fa.sort(function (f1, f2) {\n            var d = f1.min - f2.min;\n            if (d != 0) return d;\n            return f1.max - f2.max;\n        });\n    }\n    this.chrRing = null;\n};\n\nMemStore.prototype._indexFor = function (fa, p) {\n    var lb = 0,\n        ub = fa.length;\n    while (ub > lb) {\n        var mid = (lb + ub) / 2 | 0;\n        if (mid >= fa.length) return fa.length;\n        var mg = fa[mid];\n        if (p < mg.min) {\n            ub = mid;\n        } else {\n            lb = mid + 1;\n        }\n    }\n    return ub;\n};\n\nMemStore.prototype.fetch = function (chr, min, max) {\n    var fa = this.featuresByChr[chr];\n    if (!fa) {\n        if (chr.indexOf('chr') == 0) fa = this.featuresByChr[chr.substring(3)];else fa = this.featuresByChr['chr' + chr];\n    }\n    if (!fa) return [];\n\n    var mini = Math.max(0, this._indexFor(fa, min - this.maxLength - 1));\n    var maxi = Math.min(fa.length - 1, this._indexFor(fa, max));\n\n    var res = [];\n    for (var fi = mini; fi <= maxi; ++fi) {\n        var f = fa[fi];\n        if (f.min <= max && f.max >= min) res.push(f);\n    }\n    return res;\n};\n\nMemStore.prototype.findNextFeature = function (chr, pos, dir) {\n    if (this.chrRing == null) {\n        this.chrRing = [];\n        for (var chr in this.featuresByChr) {\n            this.chrRing.push(chr);\n        }\n        this.chrRing.sort();\n    }\n\n    var fa = this.featuresByChr[chr];\n    if (!fa) {\n        if (chr.indexOf('chr') == 0) {\n            chr = chr.substring(3);\n            fa = this.featuresByChr[chr];\n        } else {\n            chr = 'chr' + chr;\n            fa = this.featuresByChr[chr];\n        }\n    }\n    if (!fa) return null;\n\n    var i = Math.max(0, Math.min(this._indexFor(fa, pos), fa.length - 1));\n    if (dir > 0) {\n        while (i < fa.length) {\n            var f = fa[i++];\n            if (f.min > pos) return f;\n        }\n        var chrInd = this.chrRing.indexOf(chr) + 1;\n        if (chrInd >= this.chrRing.length) chrInd = 0;\n        return this.findNextFeature(this.chrRing[chrInd], 0, dir);\n    } else {\n        while (i >= 0) {\n            var f = fa[i--];\n            if (f.max < pos) return f;\n        }\n        var chrInd = this.chrRing.indexOf(chr) - 1;\n        if (chrInd < 0) chrInd = this.chrRing.length - 1;\n        return this.findNextFeature(this.chrRing[chrInd], 10000000000, dir);\n    }\n};\n\nfunction MemStoreFeatureSource(source) {\n    this.source = source;\n    FeatureSourceBase.call(this);\n    this.storeHolder = new Awaited();\n\n    this.parser = dalliance_makeParser(source.payload);\n    if (!this.parser) {\n        throw \"Unsupported memstore payload: \" + source.payload;\n    }\n\n    var thisB = this;\n    this._load(function (resp, err) {\n        if (err) {\n            thisB.error = err;\n            thisB.storeHolder.provide(null);\n        } else {\n            var store = new MemStore();\n            var features = [];\n            var session = thisB.parser.createSession(function (f) {\n                features.push(f);\n            });\n\n            if (err === 'already parsed') {\n                resp.forEach(function (feat) {\n                    session.validate(feat);\n                });\n            } else {\n                var lines = resp.split('\\n');\n\n                for (var li = 0; li < lines.length; ++li) {\n                    var line = lines[li];\n                    if (line.length > 0) {\n                        session.parse(line);\n                    }\n                }\n                session.flush();\n            }\n            store.addFeatures(features);\n\n            thisB.storeHolder.provide(store);\n        }\n    });\n}\n\nMemStoreFeatureSource.prototype = Object.create(FeatureSourceBase.prototype);\n\nMemStoreFeatureSource.prototype._load = function (callback) {\n    if (this.source.blob) {\n        var r = new FileReader();\n        r.onloadend = function () {\n            return callback(r.result, r.error);\n        };\n        r.readAsText(this.source.blob);\n    } else if (this.source.features) {\n        return callback(this.source.features, 'already parsed');\n    } else {\n        if (this.source.credentials) var opts = { credentials: this.source.credentials };\n        textXHR(this.source.uri, callback, opts);\n    }\n};\n\nMemStoreFeatureSource.prototype.fetch = function (chr, min, max, scale, types, pool, cnt) {\n    var thisB = this;\n    this.storeHolder.await(function (store) {\n        if (store) {\n            var f = store.fetch(chr, min, max);\n            return cnt(null, f, 100000000);\n        } else {\n            return cnt(thisB.error);\n        }\n    });\n};\n\nMemStoreFeatureSource.prototype.getStyleSheet = function (callback) {\n    if (this.parser && this.parser.getStyleSheet) this.parser.getStyleSheet(callback);\n};\n\nMemStoreFeatureSource.prototype.getDefaultFIPs = function (callback) {\n    if (this.parser && this.parser.getDefaultFIPs) this.parser.getDefaultFIPs(callback);\n};\n\nMemStoreFeatureSource.prototype.getScales = function () {\n    return 100000000;\n};\n\nMemStoreFeatureSource.prototype.findNextFeature = function (chr, pos, dir, callback) {\n    var thisB = this;\n    this.storeHolder.await(function (store) {\n        if (store) {\n            return callback(store.findNextFeature(chr, pos, dir));\n        } else {\n            return callback(null, thisB.error);\n        }\n    });\n};\n\nMemStoreFeatureSource.prototype.capabilities = function () {\n    var caps = { leap: true };\n    return caps;\n};\n\ndalliance_registerSourceAdapterFactory('memstore', function (source) {\n    return { features: new MemStoreFeatureSource(source) };\n});\n\n},{\"./das\":11,\"./sourceadapters\":39,\"./utils\":56}],29:[function(require,module,exports){\n/* jshint esversion: 6 */\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\nexports.drawTier = exports.renderTier = undefined;\n\nvar _typeof = typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; };\n\nvar _sequenceDraw = require(\"./sequence-draw.js\");\n\nvar _glyphs = require(\"./glyphs.js\");\n\nvar _defaultRenderer = require(\"./default-renderer\");\n\nvar DefaultRenderer = _interopRequireWildcard(_defaultRenderer);\n\nvar _ramda = require(\"ramda\");\n\nvar R = _interopRequireWildcard(_ramda);\n\nfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }\n\nexports.renderTier = renderTier;\nexports.drawTier = drawTier;\n\n/* Renders multiple tiers in a single track.\n   Works by simply drawing several tiers to a single canvas.\n   Actual rendering is done using default-renderer.es6.\n   A multi-tier renderer is configured by adding the following to a tier's\n   configuration:\n   renderer: 'multi',\n   multi: {\n       multi_id: \"multi_1\",\n   }\n\n   All subtiers with the \"multi_1\" multi_id will be drawn to this tier's canvas.\n */\n\nfunction renderTier(status, tier) {\n    drawTier(tier);\n    tier.updateStatus(status);\n}\n\nfunction drawTier(multiTier) {\n    var multiConfig = multiTier.dasSource.multi;\n    var getSubConfig = function getSubConfig(t) {\n        return t.dasSource.sub;\n    };\n\n    // Padding is used for finding the correct canvas size and must be set\n    if (!multiTier.padding) multiTier.padding = 3;\n\n    var canvas = multiTier.viewport.getContext(\"2d\");\n    var retina = multiTier.browser.retina && window.devicePixelRatio > 1;\n    if (retina) {\n        canvas.scale(2, 2);\n    }\n\n    // Filter out only tiers that are to be drawn in this multitier,\n    // and also have fetched data.\n    var tiers = multiTier.browser.tiers.filter(function (tier) {\n        return _typeof(getSubConfig(tier)) === \"object\" && getSubConfig(tier).multi_id === multiConfig.multi_id && (tier.currentFeatures || tier.currentSequence);\n    });\n\n    // The shortest distance from the top of the canvas to a subtier\n    var minOffset = R.pipe(R.map(function (tier) {\n        return tier.dasSource.sub.offset;\n    }), R.reduce(function (acc, offset) {\n        return offset < acc ? offset : acc;\n    }, 0))(tiers);\n\n    tiers.forEach(function (tier) {\n        if (tier.sequenceSource) {\n            (0, _sequenceDraw.drawSeqTier)(tier, tier.currentSequence);\n        } else {\n            // Shift subtiers up by the minimum offset,\n            // so that there's no empty space at the top\n            DefaultRenderer.prepareSubtiers(tier, canvas, getSubConfig(tier).offset - minOffset, false);\n        }\n\n        // Must be set for painting to work\n        if (!multiTier.glyphCacheOrigin) multiTier.glyphCacheOrigin = tier.glyphCacheOrigin;\n    });\n\n    // The canvas should fit all subtiers, including offsets, but no more\n    var canvasHeight = R.pipe(R.map(function (tier) {\n        return R.map(function (subtier) {\n            return subtier.height + getSubConfig(tier).offset;\n        }, tier.subtiers);\n    }), R.flatten, R.reduce(function (acc, h) {\n        return h > acc ? h : acc;\n    }, -Infinity), R.add(-minOffset))(tiers);\n\n    prepareViewport(multiTier, canvas, retina, canvasHeight, true);\n\n    tiers.sort(function (t1, t2) {\n        return getSubConfig(t1).z > getSubConfig(t2).z;\n    });\n\n    // TODO: make it add the glyph on to the first available tier;\n    // crashes if last tier is empty...\n    if (multiConfig.grid && tiers && tiers[tiers.length - 1] && tiers[tiers.length - 1].subtiers[0]) {\n        var grid = new _glyphs.GridGlyph(canvasHeight, multiConfig.grid_offset, multiConfig.grid_spacing);\n        // pretty hacky way of adding the grid, but it works (mostly)\n        tiers[tiers.length - 1].subtiers[0].glyphs.unshift(grid);\n    }\n\n    tiers.forEach(function (tier) {\n        // Need to save and restore canvas to make sure that the subtiers are\n        // drawn on top of one another, if not shifted...\n        canvas.save();\n        DefaultRenderer.paint(tier, canvas, retina, true);\n        canvas.restore();\n    });\n\n    multiTier.drawOverlay();\n\n    if (multiConfig.quant) {\n        var quantCanvas = DefaultRenderer.createQuantOverlay(multiTier, canvasHeight + multiTier.padding * 2, retina);\n        DefaultRenderer.paintQuant(quantCanvas, multiTier, multiConfig.quant, 10);\n    }\n\n    if (typeof multiTier.dasSource.drawCallback === \"function\") {\n        multiTier.dasSource.drawCallback(canvas, multiTier);\n    }\n\n    multiTier.originHaxx = 0;\n    multiTier.browser.arrangeTiers();\n}\n\nfunction prepareViewport(tier, canvas, retina, canvasHeight) {\n    var clear = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : true;\n\n    var desiredWidth = tier.browser.featurePanelWidth + 2000;\n    if (retina) {\n        desiredWidth *= 2;\n    }\n\n    var fpw = tier.viewport.width | 0;\n    if (fpw < desiredWidth - 50) {\n        tier.viewport.width = fpw = desiredWidth;\n    }\n\n    canvasHeight += 2 * tier.padding;\n    canvasHeight = Math.max(canvasHeight, tier.browser.minTierHeight);\n\n    if (canvasHeight != tier.viewport.height) {\n        tier.viewport.height = canvasHeight;\n\n        if (retina) {\n            tier.viewport.height *= 2;\n        }\n    }\n\n    tier.viewportHolder.style.left = '-1000px';\n    tier.viewport.style.width = retina ? '' + fpw / 2 + 'px' : '' + fpw + 'px';\n    tier.viewport.style.height = '' + canvasHeight + 'px';\n    tier.layoutHeight = Math.max(canvasHeight, tier.browser.minTierHeight);\n\n    tier.updateHeight();\n    tier.norigin = tier.browser.viewStart;\n\n    if (clear) {\n        DefaultRenderer.clearViewport(canvas, fpw, canvasHeight);\n    }\n\n    DefaultRenderer.drawUnmapped(tier, canvas, canvasHeight);\n}\n\n},{\"./default-renderer\":12,\"./glyphs.js\":24,\"./sequence-draw.js\":36,\"ramda\":73}],30:[function(require,module,exports){\n'use strict';\n\n/* -*- mode: javascript; c-basic-offset: 4; indent-tabs-mode: nil -*- */\n\n// \n// Dalliance Genome Explorer\n// (c) Thomas Down 2006-2014\n//\n// memstore.js\n//\n\nfunction formatLongInt(n) {\n    return (n | 0).toString().replace(/\\B(?=(\\d{3})+(?!\\d))/g, ',');\n}\n\nfunction formatQuantLabel(v) {\n    var t = '' + v;\n    var dot = t.indexOf('.');\n    if (dot < 0) {\n        return t;\n    } else {\n        var dotThreshold = 2;\n        if (t.substring(0, 1) == '-') {\n            ++dotThreshold;\n        }\n\n        if (dot >= dotThreshold) {\n            return t.substring(0, dot);\n        } else {\n            return t.substring(0, dot + 2);\n        }\n    }\n}\n\nif (typeof module !== 'undefined') {\n    module.exports = {\n        formatLongInt: formatLongInt,\n        formatQuantLabel: formatQuantLabel\n    };\n}\n\n},{}],31:[function(require,module,exports){\n/* -*- mode: javascript; c-basic-offset: 4; indent-tabs-mode: nil -*- */\n\n// \n// Dalliance Genome Explorer\n// (c) Thomas Down 2006-2013\n//\n// overlay.js: featuresources composed from multiple underlying sources\n//\n\n\"use strict\";\n\nif (typeof require !== 'undefined') {\n    var utils = require('./utils');\n    var shallowCopy = utils.shallowCopy;\n    var arrayIndexOf = utils.arrayIndexOf;\n}\n\nfunction OverlayFeatureSource(sources, opts) {\n    this.sources = sources;\n    this.opts = opts || {};\n    this.activityListeners = [];\n    this.readinessListeners = [];\n    this.changeListeners = [];\n    this.business = [];\n    this.readiness = [];\n\n    for (var i = 0; i < this.sources.length; ++i) {\n        this.initN(i);\n    }\n\n    if (typeof opts.merge === 'function') {\n        this.merge = opts.merge;\n    } else if (opts.merge == 'concat') {\n        this.merge = OverlayFeatureSource_merge_concat;\n    } else if (opts.merge == 'alternates') {\n        this.merge = OverlayFeatureSource_merge_concat;\n        this.filterDispatchOnMethod = true;\n    } else {\n        this.merge = OverlayFeatureSource_merge_byKey;\n    }\n}\n\nOverlayFeatureSource.prototype.initN = function (n) {\n    var s = this.sources[n];\n    var thisB = this;\n    this.business[n] = 0;\n\n    if (s.addActivityListener) {\n        s.addActivityListener(function (b) {\n            thisB.business[n] = b;\n            thisB.notifyActivity();\n        });\n    }\n    if (s.addChangeListener) {\n        s.addChangeListener(function () {\n            thisB.notifyChange();\n        });\n    }\n    if (s.addReadinessListener) {\n        s.addReadinessListener(function (r) {\n            thisB.readiness[n] = r;\n            thisB.notifyReadiness();\n        });\n    }\n};\n\nOverlayFeatureSource.prototype.addReadinessListener = function (l) {\n    this.readinessListeners.push(l);\n    this.notifyReadinessListener(l);\n};\n\nOverlayFeatureSource.prototype.removeReadinessListener = function (l) {\n    var idx = arrayIndexOf(this.readinessListeners, l);\n    if (idx >= 0) {\n        this.readinessListeners.splice(idx, 1);\n    }\n};\n\nOverlayFeatureSource.prototype.notifyReadiness = function () {\n    for (var i = 0; i < this.readinessListeners.length; ++i) {\n        this.notifyReadinessListener(this.readinessListeners[i]);\n    }\n};\n\nOverlayFeatureSource.prototype.notifyReadinessListener = function (l) {\n    var r = null;\n    for (var i = 0; i < this.readiness.length; ++i) {\n        if (this.readiness[i] != null) {\n            r = this.readiness[i];break;\n        }\n    }\n    try {\n        l(r);\n    } catch (e) {\n        console.log(e);\n    }\n};\n\nOverlayFeatureSource.prototype.addActivityListener = function (l) {\n    this.activityListeners.push(l);\n};\n\nOverlayFeatureSource.prototype.removeActivityListener = function (l) {\n    var idx = arrayIndexOf(this.activityListeners, l);\n    if (idx >= 0) {\n        this.activityListeners.splice(idx, 1);\n    }\n};\n\nOverlayFeatureSource.prototype.notifyActivity = function () {\n    var busy = 0;\n    for (var i = 0; i < this.business.length; ++i) {\n        busy += this.business[i];\n    }\n\n    for (var li = 0; li < this.activityListeners.length; ++li) {\n        try {\n            this.activityListeners[li](busy);\n        } catch (e) {\n            console.log(e);\n        }\n    }\n};\n\nOverlayFeatureSource.prototype.addChangeListener = function (listener) {\n    this.changeListeners.push(listener);\n};\n\nOverlayFeatureSource.prototype.removeChangeListener = function (l) {\n    var idx = arrayIndexOf(this.changeListeners, l);\n    if (idx >= 0) {\n        this.changeListeners.splice(idx, 1);\n    }\n};\n\nOverlayFeatureSource.prototype.notifyChange = function () {\n    for (var li = 0; li < this.changeListeners.length; ++li) {\n        try {\n            this.changeListeners[li](this.busy);\n        } catch (e) {\n            console.log(e);\n        }\n    }\n};\n\nOverlayFeatureSource.prototype.getScales = function () {\n    return this.sources[0].getScales();\n};\n\nOverlayFeatureSource.prototype.getStyleSheet = function (callback) {\n    return this.sources[0].getStyleSheet(callback);\n};\n\nOverlayFeatureSource.prototype.capabilities = function () {\n    var caps = {};\n    var s0 = this.sources[0];\n    if (s0.capabilities) caps = shallowCopy(s0.capabilities());\n\n    for (var i = 1; i < this.sources.length; ++i) {\n        var si = this.sources[i];\n        if (si.capabilities) {\n            var co = si.capabilities();\n            if (co.search) {\n                caps.search = co.search;\n            }\n        }\n    }\n\n    return caps;\n};\n\nOverlayFeatureSource.prototype.search = function (query, callback) {\n    for (var i = 0; i < this.sources.length; ++i) {\n        if (_sourceAdapterIsCapable(this.sources[i], 'search')) {\n            return this.sources[i].search(query, callback);\n        }\n    }\n};\n\nOverlayFeatureSource.prototype.fetch = function (chr, min, max, scale, types, pool, callback, styleFilters) {\n    var sources;\n    if (this.filterDispatchOnMethod) {\n        sources = [];\n        var sfl = styleFilters.list();\n        for (var si = 0; si < this.sources.length; ++si) {\n            var source = this.sources[si];\n            for (var fi = 0; fi < sfl.length; ++fi) {\n                var filter = sfl[fi];\n                if (!filter.method || filter.method == source.name) {\n                    sources.push(source);\n                    break;\n                }\n            }\n        }\n    } else {\n        sources = this.sources;\n    }\n\n    var baton = new OverlayBaton(this, callback, sources);\n    for (var si = 0; si < sources.length; ++si) {\n        this.fetchN(baton, si, sources[si], chr, min, max, scale, types, pool, styleFilters);\n    }\n};\n\nOverlayFeatureSource.prototype.fetchN = function (baton, si, source, chr, min, max, scale, types, pool, styleFilters) {\n    // FIXME should we try to prune styleFilters?\n    source.fetch(chr, min, max, scale, types, pool, function (status, features, scale) {\n        return baton.completed(si, status, features, scale);\n    }, styleFilters);\n};\n\nOverlayFeatureSource.prototype.quantFindNextFeature = function (chr, pos, dir, threshold, callback) {\n    return this.sources[0].quantFindNextFeature(chr, pos, dir, threshold, callback);\n};\n\nOverlayFeatureSource.prototype.findNextFeature = function (chr, pos, dir, callback) {\n    return this.sources[0].findNextFeature(chr, pos, dir, callback);\n};\n\nfunction OverlayBaton(source, callback, sources) {\n    this.source = source;\n    this.callback = callback;\n    this.sources = sources;\n    this.count = sources.length;\n\n    this.returnCount = 0;\n    this.statusCount = 0;\n    this.returns = [];\n    this.features = [];\n    this.statuses = [];\n    this.scale = null;\n}\n\nOverlayBaton.prototype.completed = function (index, status, features, scale) {\n    if (this.scale == null || index == 0) this.scale = scale;\n\n    if (this.returns[index]) throw 'Multiple returns for source ' + index;\n\n    this.returns[index] = true;\n    this.returnCount++;\n\n    this.features[index] = features;\n\n    if (status) {\n        this.statuses[index] = status;\n        this.statusCount++;\n    }\n\n    if (this.returnCount == this.count) {\n        if (this.statusCount > 0) {\n            var message = '';\n            for (var si = 0; si < this.count; ++si) {\n                var s = this.statuses[si];\n                if (s) {\n                    if (message.length > 0) message += ', ';\n                    message += s;\n                }\n            }\n            return this.callback(message, null, this.scale);\n        } else {\n            this.callback(null, this.source.merge(this.features, this.sources), this.scale);\n        }\n    }\n};\n\nOverlayFeatureSource.prototype.getDefaultFIPs = function (callback) {\n    for (var si = 0; si < this.sources.length; ++si) {\n        var s = this.sources[si];\n        if (s.getDefaultFIPs) s.getDefaultFIPs(callback);\n    }\n};\n\nOverlayFeatureSource.prototype.keyForFeature = function (feature) {\n    return '' + feature.min + '..' + feature.max;\n};\n\nfunction OverlayFeatureSource_merge_byKey(featureSets) {\n    var omaps = [];\n\n    for (var fsi = 1; fsi < featureSets.length; ++fsi) {\n        var om = {};\n        var of = featureSets[fsi];\n        for (var fi = 0; fi < of.length; ++fi) {\n            om[this.keyForFeature(of[fi])] = of[fi];\n        }\n        omaps.push(om);\n    }\n\n    var mf = [];\n    var fl = featureSets[0];\n    for (var fi = 0; fi < fl.length; ++fi) {\n        var f = fl[fi];\n\n        for (var oi = 0; oi < omaps.length; ++oi) {\n            var om = omaps[oi];\n            of = om[this.keyForFeature(f)];\n            if (of) {\n                for (var k in of) {\n                    if (k === 'score') {\n                        f.score2 = of.score;\n                    } else if (k === 'min' || k === 'max' || k === 'segment' || k === '_cachedStyle') {\n                        // do nothing\n                    } else {\n                        f[k] = of[k];\n                    }\n                }\n            }\n        }\n        mf.push(f);\n    }\n    return mf;\n}\n\nfunction OverlayFeatureSource_merge_concat(featureSets, sources) {\n    var features = [];\n    for (var fsi = 0; fsi < featureSets.length; ++fsi) {\n        var fs = featureSets[fsi];\n        var name = sources[fsi].name;\n        for (var fi = 0; fi < fs.length; ++fi) {\n            var f = fs[fi];\n            f.method = name;\n            features.push(f);\n        }\n    }\n    return features;\n}\n\nfunction _sourceAdapterIsCapable(s, cap) {\n    if (!s.capabilities) return false;else return s.capabilities()[cap];\n}\n\nif (typeof module !== 'undefined') {\n    module.exports = {\n        OverlayFeatureSource: OverlayFeatureSource\n    };\n}\n\n},{\"./utils\":56}],32:[function(require,module,exports){\n/* -*- mode: javascript; c-basic-offset: 4; indent-tabs-mode: nil -*- */\n\n// \n// Dalliance Genome Explorer\n// (c) Thomas Down 2006-2014\n//\n// bedwig.js\n//\n\n\"use strict\";\n\nif (typeof require !== 'undefined') {\n    var bin = require('./bin');\n    var URLFetchable = bin.URLFetchable;\n    var BlobFetchable = bin.BlobFetchable;\n    var readInt = bin.readInt;\n\n    var bbi = require('./bigwig');\n    var BIG_WIG_MAGIC = bbi.BIG_WIG_MAGIC;\n    var BIG_BED_MAGIC = bbi.BIG_BED_MAGIC;\n\n    var lh3utils = require('./lh3utils');\n    var unbgzf = lh3utils.unbgzf;\n\n    var bam = require('./bam');\n    var BAM_MAGIC = bam.BAM_MAGIC;\n    var BAI_MAGIC = bam.BAI_MAGIC;\n\n    var tbi = require('./tabix');\n    var TABIX_MAGIC = tbi.TABIX_MAGIC;\n\n    var EncodeFetchable = require('./encode').EncodeFetchable;\n}\n\nfunction probeResource(source, listener, retry) {\n    var BED_REGEXP = new RegExp('^\\\\w+\\\\s[0-9]+\\\\s[0-9]+.*$');\n    var KV_REGEXP = /([^=]+)=\\\"?([^\\\"]+)\\\"?/;\n    var VCFHEAD_RE = /^##\\s*fileformat=VCFv4\\..+/;\n\n    var fetchable;\n    if (source.blob) fetchable = new BlobFetchable(source.blob);else if (source.transport == 'encode') fetchable = new EncodeFetchable(source.uri);else fetchable = new URLFetchable(source.uri, { credentials: source.credentials });\n\n    fetchable.slice(0, 1 << 16).salted().fetch(function (result, error) {\n        if (!result) {\n            if (!retry) {\n                source.credentials = true;\n                probeResource(source, listener, true);\n            }\n\n            return listener(source, \"Couldn't fetch data\");\n        }\n\n        var ba = new Uint8Array(result);\n        var la = new Uint32Array(result, 0, 1);\n        var magic = la[0];\n        if (magic == BIG_WIG_MAGIC || magic == BIG_BED_MAGIC) {\n            source.tier_type = 'bwg';\n            var nameExtractPattern = new RegExp('/?([^/]+?)(.bw|.bb|.bigWig|.bigBed)?$');\n            var match = nameExtractPattern.exec(source.uri || source.blob.name);\n            if (match) {\n                source.name = match[1];\n            }\n\n            return listener(source, null);\n        } else if (magic == BAI_MAGIC) {\n            source.tier_type = 'bai';\n            return listener(source, null);\n        } else if (ba[0] == 31 || ba[1] == 139) {\n            var unc = unbgzf(result);\n            var uncba = new Uint8Array(unc);\n            magic = readInt(uncba, 0);\n            if (magic == BAM_MAGIC) {\n                source.tier_type = 'bam';\n                var nameExtractPattern = new RegExp('/?([^/]+?)(.bam)?$');\n                var match = nameExtractPattern.exec(source.uri || source.blob.name);\n                if (match) {\n                    source.name = match[1];\n                }\n\n                return listener(source, null);\n            } else if (magic == TABIX_MAGIC) {\n                source.tier_type = 'tabix-index';\n                return listener(source, null);\n            } else if (magic == 0x69662323) {\n                source.tier_type = 'tabix';\n                source.payload = 'vcf';\n                var nameExtractPattern = new RegExp('/?([^/]+?)(.vcf)?(.gz)?$');\n                var match = nameExtractPattern.exec(source.uri || source.blob.name);\n                if (match) {\n                    source.name = match[1];\n                }\n\n                return listener(source, null);\n            } else {\n                console.log('magic = ' + magic.toString(16));\n                return listener(source, \"Unsupported format\");\n            }\n        } else {\n            var text = String.fromCharCode.apply(null, ba);\n            var lines = text.split(\"\\n\");\n\n            if (lines.length > 0 && VCFHEAD_RE.test(lines[0])) {\n                source.tier_type = 'memstore';\n                source.payload = 'vcf';\n                var nameExtractPattern = new RegExp('/?([^/]+?)(\\.vcf)?$');\n                var match = nameExtractPattern.exec(source.uri || source.blob.name);\n                if (match && !source.name) {\n                    source.name = match[1];\n                }\n                return listener(source, null);\n            }\n\n            for (var li = 0; li < lines.length; ++li) {\n                var line = lines[li].replace('\\r', '');\n                if (line.length == 0) continue;\n\n                if (line.indexOf('browser') == 0) continue;\n\n                if (line.indexOf('track') == 0) {\n                    var maybeType = 'bed';\n                    var toks = line.split(/\\s/);\n                    for (var ti = 1; ti < toks.length; ++ti) {\n                        var m = KV_REGEXP.exec(toks[ti]);\n                        if (m) {\n                            if (m[1] == 'type' && m[2] == 'wiggle_0') {\n                                maybeType = 'wig';\n                            } else if (m[0] == 'name') {\n                                source.name = m[2];\n                            }\n                        }\n                    }\n\n                    finishProbeBedWig(source, maybeType);\n                    return listener(source, null);\n                }\n\n                if (line.indexOf('fixedStep') == 0) {\n                    finishProbeBedWig(source, 'wig');\n                    return listener(source, null);\n                }\n\n                if (line.indexOf('variableStep') == 0) {\n                    finishProbeBedWig(source, 'wig');\n                    return listener(source, null);\n                }\n\n                if (BED_REGEXP.test(line)) {\n                    finishProbeBedWig(source, null);\n                    return listener(source, null);\n                }\n\n                break;\n            }\n\n            return listener(source, \"Unsupported format\");\n        }\n    }, { timeout: 1500 }); // Timeout to catch mixed-origin case on Chromium.\n}\n\nfunction finishProbeBedWig(source, maybeType) {\n    source.tier_type = 'memstore';\n    var nameExtractPattern = new RegExp('/?([^/]+?)(.(bed|wig))?$');\n    var match = nameExtractPattern.exec(source.uri || source.blob.name);\n    if (match) {\n        if (!source.name) source.name = match[1];\n        if (!maybeType && match[3]) {\n            maybeType = match[3];\n        }\n    }\n    source.payload = maybeType || 'bed';\n}\n\nif (typeof module !== 'undefined') {\n    module.exports = {\n        probeResource: probeResource\n    };\n}\n\n},{\"./bam\":1,\"./bigwig\":3,\"./bin\":4,\"./encode\":15,\"./lh3utils\":27,\"./tabix\":47}],33:[function(require,module,exports){\n/* jshint esversion: 6 */\n\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\nexports.Ruler = Ruler;\nexports.rulerDrawCallback = rulerDrawCallback;\n\n\nfunction Ruler(options) {\n    var self = this;\n\n    self.value = options.value;\n    self.min = options.min;\n    self.max = options.max;\n    self.width = options.width;\n    self.color = options.color;\n\n    Object.keys(self).map(function (key) {\n        if (self[key] === undefined) {\n            console.log(\"WARNING: Ruler option \" + key + \" not set\");\n        }\n    });\n}\n\nRuler.prototype.constructor = Ruler;\n\nfunction rulerDrawCallback(canvas, tier) {\n    var rulers = tier.dasSource.rulers;\n\n    if (!rulers) {\n        console.log(\"Tier uses ruler callback but has no rulers!\");\n    } else if (!(rulers instanceof Array)) {\n        console.log(\"rulers.js: 'rulers' should be an Array\");\n    }\n\n    rulers.map(function (r) {\n        var rulerY = (r.max - r.value) * r.height;\n        var viewWidth = tier.viewport.width;\n        var oldLineWidth = canvas.lineWidth;\n\n        canvas.strokeStyle = r.color;\n        canvas.beginPath();\n        canvas.moveTo(-viewWidth, rulerY + r.offset);\n        // Other parts of the code rely on not having changed the lineWidth...\n        // So we need to change it back when we're done.\n        canvas.lineWidth = r.width;\n        canvas.lineTo(2 * viewWidth, rulerY + r.offset);\n        canvas.stroke();\n        canvas.lineWidth = oldLineWidth;\n    });\n}\n\n},{}],34:[function(require,module,exports){\n/* -*- mode: javascript; c-basic-offset: 4; indent-tabs-mode: nil -*- */\n\n// \n// Dalliance Genome Explorer\n// (c) Thomas Down 2006-2010\n//\n// sample.js: downsampling of quantitative features\n//\n\n\"use strict\";\n\nif (typeof require !== 'undefined') {\n    var das = require('./das');\n    var DASFeature = das.DASFeature;\n\n    var parseCigar = require('./cigar').parseCigar;\n\n    var shallowCopy = require('./utils').shallowCopy;\n}\n\nvar __DS_SCALES = [1, 2, 5];\n\nfunction ds_scale(n) {\n    return __DS_SCALES[n % __DS_SCALES.length] * Math.pow(10, n / __DS_SCALES.length | 0);\n}\n\nfunction DSBin(scale, min, max) {\n    this.scale = scale;\n    this.tot = 0;\n    this.cnt = 0;\n    this.hasScore = false;\n    this.min = min;this.max = max;\n    this.features = [];\n}\n\nfunction _featureOrder(a, b) {\n    if (a.min < b.min) {\n        return -1;\n    } else if (a.min > b.min) {\n        return 1;\n    } else if (a.max < b.max) {\n        return -1;\n    } else if (b.max > a.max) {\n        return 1;\n    } else {\n        return 0;\n    }\n}\n\nDSBin.prototype.score = function () {\n    if (this.cnt == 0) {\n        return 0;\n    } else if (this.hasScore) {\n        return this.tot / this.cnt;\n    } else {\n        var features = this.features;\n        features.sort(_featureOrder);\n\n        var maxSeen = -10000000000;\n        var cov = 0,\n            lap = 0;\n\n        for (var fi = 1; fi < features.length; ++fi) {\n            var f = features[fi];\n            var lMin = Math.max(f.min, this.min);\n            var lMax = Math.min(f.max, this.max);\n            lap += lMax - lMin + 1;\n\n            if (lMin > maxSeen) {\n                cov += lMax - lMin + 1;\n                maxSeen = lMax;\n            } else {\n                if (lMax > maxSeen) {\n                    cov += lMax - maxSeen;\n                    maxSeen = lMax;\n                }\n            }\n        }\n\n        if (cov > 0) return 1.0 * lap / cov;else return 0;\n    }\n};\n\nDSBin.prototype.feature = function (f) {\n    if (f.score !== undefined) {\n        this.tot += f.score;\n        this.hasScore = true;\n    }\n\n    ++this.cnt;\n    this.features.push(f);\n};\n\nfunction downsample(features, targetRez) {\n    var sn = 0;\n    while (ds_scale(sn + 1) < targetRez) {\n        ++sn;\n    }\n    var scale = ds_scale(sn);\n\n    var binTots = [];\n    var maxBin = -10000000000;\n    var minBin = 10000000000;\n    for (var fi = 0; fi < features.length; ++fi) {\n        var f = features[fi];\n        if (f.groups && f.groups.length > 0) {\n            // Don't downsample complex features (?)\n            return features;\n        }\n\n        var minLap = f.min / scale | 0;\n        var maxLap = f.max / scale | 0;\n        maxBin = Math.max(maxBin, maxLap);\n        minBin = Math.min(minBin, minLap);\n        for (var b = minLap; b <= maxLap; ++b) {\n            var bm = binTots[b];\n            if (!bm) {\n                bm = new DSBin(scale, b * scale, (b + 1) * scale - 1);\n                binTots[b] = bm;\n            }\n            bm.feature(f);\n        }\n    }\n\n    var sampledFeatures = [];\n    for (var b = minBin; b <= maxBin; ++b) {\n        var bm = binTots[b];\n        if (bm) {\n            var f = new DASFeature();\n            f.segment = features[0].segment;\n            f.min = b * scale + 1;\n            f.max = (b + 1) * scale;\n            f.score = bm.score();\n            f.type = 'density';\n            sampledFeatures.push(f);\n        }\n    }\n\n    var afterDS = Date.now();\n    return sampledFeatures;\n}\n\n/** Data structure to store information for\na base position:\n\npos: position of the base.\n*/\nfunction BaseBin(pos) {\n\n    this._pos = pos;\n    this._bases = {};\n    this._totalCount = 0;\n}\n\n/** Keep record for incidence of a base,\nwith related qual score and strand for a position.\n\nParams\n    base: base (e.g A, T, G, C, N) observed at position.\n    qual: numeric quality score.\n    strand: '+' or '-'.\n*/\nBaseBin.prototype.recordBase = function (base, qual, strand) {\n    if (!this._bases[base]) {\n        var strandComposition = { '+': 0, '-': 0 };\n        strandComposition[strand]++;\n        this._bases[base] = {\n            cnt: 1,\n            totalQual: qual,\n            strandCnt: strandComposition\n        };\n    } else {\n        var baseComposition = this._bases[base];\n        baseComposition.cnt++;\n        baseComposition.totalQual += qual;\n        baseComposition.strandCnt[strand]++;\n    }\n    this._totalCount++;\n};\n\n/** Returns count of total number of bases observed at position */\nBaseBin.prototype.totalCount = function () {\n    return this._totalCount;\n};\n\n/** Returns the base position */\nBaseBin.prototype.pos = function () {\n    return this._pos;\n};\n\n/** Creates a list of tag, info pairs in the form\n[tag]=[info] for each base, for use in feature-popup */\nBaseBin.prototype.infoList = function () {\n    var info = [];\n    var totalCount = this._totalCount;\n    var totalCountStr = \"Depth=\" + totalCount.toString();\n    info.push(totalCountStr);\n    for (var base in this._bases) {\n        var baseComposition = this._bases[base];\n        var baseCnt = baseComposition.cnt;\n        var basePercentage = baseCnt * 100 / totalCount;\n        var plusStrandCnt = baseComposition.strandCnt['+'];\n        var minusStrandCnt = baseComposition.strandCnt['-'];\n        var meanQual = baseComposition.totalQual / baseCnt;\n\n        var baseInfoString = [base, '=', baseCnt, ' (', basePercentage.toFixed(0), '%, ', plusStrandCnt, ' +, ', minusStrandCnt, ' -, Qual: ', meanQual.toFixed(0), ')'];\n        info.push(baseInfoString.join(''));\n    }\n    return info;\n};\n\n/** Return a list of objects for creating a\nhistogram showing composition of different bases at a\ngiven location.\n\nCurrent implementation is hacky: the logic involves\noverlaying BoxGlyphs on top of each other, thus the score\nis not meaningful, but only used to manipulate height.\n\nParams:\n  ref: reference base at position\n  threshold: value between 0 and 1 representing min allele frequency\n              below which the allele will be ignored in histogram.\n              (interpreted as noise)\n              Similar to 'allele threshold' parameter in IGV\n\nReturns a list of objects containing 2 properties\n    base: such as A, T, G, C, N, - (del)\n    score: a numeric score for determining height of histogram\nThe list is ordered such that a preceeding object always have a\nscore >= the current object, and the ref base will be the last item.\n\nExample: There are 50 T's and 40 A's (total depth = 90)\nat a base where ref=A. The function will return\n[T: 90, A: 40]. When creating a histogram with overlap,\nthis will give an appearance of 40 A's (bottom) and 50 T's (top):\n#######\n#  T  #\n#  T  #\n#  T  #\n#  T  #\n#  T  #\n#######\n#  A  #\n#  A  #\n#  A  #\n#  A  #\n#######\n*/\nBaseBin.prototype.baseScoreList = function (ref, threshold) {\n    var baseScoreList = [];\n    var totalCount = this._totalCount;\n    var minCount = threshold * totalCount;\n    for (var base in this._bases) {\n        var baseCount = this._bases[base].cnt;\n        if (baseCount < minCount || base == ref) continue;\n        var baseScorePair = { base: base, score: totalCount };\n        baseScoreList.push(baseScorePair);\n        totalCount -= baseCount;\n    }\n    baseScoreList.push({ base: ref, score: totalCount });\n    return baseScoreList;\n};\n\n/** Generates an aligned read from the raw sequence of a BAM record\nusing given cigar string.\n\nParams:\n  rawseq: unaligned read sequence from Bam record\n  rawquals: unaligned read quals from Bam record\n  cigar: Bam cigar string from Bam record\n\nReturns an object with 2 properties:\n  seq: string containing aligned read\n  quals: string containing printable-character representation\n         of sequencing quality score\n*/\nfunction alignSeqUsingCigar(rawseq, rawquals, cigar) {\n    var ops = parseCigar(cigar);\n    var seq = [];\n    var quals = [];\n    var cursor = 0;\n    for (var ci = 0; ci < ops.length; ++ci) {\n        var co = ops[ci];\n        if (co.op == 'M') {\n            seq.push(rawseq.substr(cursor, co.cnt));\n            quals.push(rawquals.substr(cursor, co.cnt));\n            cursor += co.cnt;\n        } else if (co.op == 'D') {\n            for (var oi = 0; oi < co.cnt; ++oi) {\n                seq.push('-');\n                quals.push('Z');\n            }\n        } else if (co.op == 'I') {\n            cursor += co.cnt;\n        } else if (co.op == 'S') {\n            cursor += co.cnt;\n        } else {\n            console.log('unknown cigop' + co.op);\n        }\n    }\n    var processedSeq = { seq: seq.join(''), quals: quals.join('') };\n    return processedSeq;\n}\n\n/** Constructs the reference sequence for a given window.\n\nParams\n    currentSequence: DasSequence object containing ref sequence\n                     in current browser view.\n    min, max: min and max position for window.\n\nReturns a string containing the refseq, padded with 'N' where sequence is not\n    available.\n*/\nfunction getRefSeq(currentSequence, min, max) {\n    var refSeq = [];\n    if (currentSequence) {\n        var csStart = currentSequence.start | 0;\n        var csEnd = currentSequence.end | 0;\n        if (csStart <= max && csEnd >= min) {\n            var sfMin = Math.max(min, csStart);\n            var sfMax = Math.min(max, csEnd);\n\n            for (var i = 0; i < sfMin - min; i++) {\n                refSeq.push('N');\n            }refSeq.push(currentSequence.seq.substr(sfMin - csStart, sfMax - sfMin + 1));\n            for (var i = 0; i < max - sfMax; i++) {\n                refSeq.push('N');\n            }\n        }\n    }\n    return refSeq.join('');\n}\n\n/** Constructs features necessary for a coverage track showing\nbase composition for BAM reads\n\nParams\n    features: a list of features from BAM records.\n    currentRefSeq: a DASSequence object containing reference sequence.\n    baseColors: an object mapping base to desired colors.\n\nReturns a list of features of type base-coverage.\n*/\nfunction getBaseCoverage(features, currentRefSeq, baseColors) {\n    var minBin = null;\n    var maxBin = null;\n\n    var allBins = [];\n\n    // Populate BaseBins\n    for (var fi = 0; fi < features.length; ++fi) {\n        var f = features[fi];\n        if (f.groups && f.groups.length > 0) {\n            // Don't downsample complex features\n            return features;\n        }\n        var processedSeq = alignSeqUsingCigar(f.seq, f.quals, f.cigar);\n        var seq = processedSeq.seq;\n        var quals = processedSeq.quals;\n        var strand = f.orientation;\n        var minForFeature = f.min || 0;\n        var maxForFeature = f.max || 0;\n        var ind = 0;\n\n        for (var b = minForFeature; b <= maxForFeature; ++b) {\n            var bm = allBins[b];\n            if (!bm) {\n                bm = new BaseBin(b);\n                allBins[b] = bm;\n            }\n            var base = seq.charAt(ind);\n            var qual = quals.charCodeAt(ind) - 33; // Generate numeric qual score\n            bm.recordBase(base, qual, strand);\n            ind++;\n        }\n\n        if (!minBin) minBin = minForFeature;else minBin = Math.min(minBin, minForFeature);\n        if (!maxBin) maxBin = maxForFeature;else maxBin = Math.max(maxBin, maxForFeature);\n    }\n\n    // Generate coverage features\n    var refSeq = getRefSeq(currentRefSeq, minBin, maxBin);\n    var baseFeatures = [];\n    var ind = 0;\n    for (var b = minBin; b <= maxBin; ++b) {\n        var bm = allBins[b];\n        if (bm) {\n            var f = new DASFeature();\n            f.segment = features[0].segment;\n            f.min = bm.pos();\n            f.max = f.min;\n            f.notes = [];\n            f.notes = f.notes.concat(bm.infoList());\n            f.type = 'base-coverage';\n            f.suppressScore = true;\n            if (refSeq) {\n                var refBase = refSeq.charAt(ind);\n                var refString = 'Ref=' + refBase;\n                f.notes.unshift(refString);\n                var baseScoreList = bm.baseScoreList(refBase, 0.2);\n                // TODO: shift 0.2 threshold to a config parameter\n                for (var i = 0; i < baseScoreList.length; i++) {\n                    var base = baseScoreList[i].base;\n                    var score = baseScoreList[i].score;\n                    var fBase = shallowCopy(f);\n                    fBase.score = score;\n                    // Color by baseColor when mismatch occurs\n                    // otherwise, BoxGlyph to COLOR1 in style\n                    if (baseScoreList.length > 1 || base != refBase) fBase.itemRgb = baseColors[base];\n\n                    baseFeatures.push(fBase);\n                }\n            } else {\n                // No refSeq, only show coverage height.\n                baseFeatures.push(f);\n            }\n        }\n        ind++;\n    }\n    return baseFeatures;\n}\n\nif (typeof module !== 'undefined') {\n    module.exports = {\n        downsample: downsample,\n        getBaseCoverage: getBaseCoverage\n    };\n}\n\n},{\"./cigar\":8,\"./das\":11,\"./utils\":56}],35:[function(require,module,exports){\n/* -*- mode: javascript; c-basic-offset: 4; indent-tabs-mode: nil -*- */\n\n// \n// Dalliance Genome Explorer\n// (c) Thomas Down 2006-2011\n//\n// bin.js general binary data support\n//\n\n\"use strict\";\n\nfunction _toConsumableArray(arr) { if (Array.isArray(arr)) { for (var i = 0, arr2 = Array(arr.length); i < arr.length; i++) { arr2[i] = arr[i]; } return arr2; } else { return Array.from(arr); } }\n\nif (typeof require !== 'undefined') {\n    var browser = require('./cbrowser');\n    var Browser = browser.Browser;\n\n    var bin = require('./bin');\n    var URLFetchable = bin.URLFetchable;\n\n    var connectTrix = require('./trix').connectTrix;\n}\n\nvar REGION_PATTERN = /^([\\d+,\\w,\\.,\\_,\\-]+)[\\s:]+([0-9,\\.]+?)([KkMmGg])?((-|\\.\\.|\\s)+([0-9,\\.]+)([KkMmGg])?)?$/;\n\nfunction parseLocCardinal(n, m) {\n    var i = parseFloat(n.replace(/,/g, ''));\n    if (m === 'k' || m === 'K') {\n        return i * 1000 | 0;\n    } else if (m == 'm' || m === 'M') {\n        return i * 1000000 | 0;\n    } else {\n        return i | 0;\n    }\n}\n\nBrowser.prototype.search = function (g, statusCallback, opts) {\n    var thisB = this;\n    opts = opts || {};\n    var srPadding = opts.padding || this.defaultSearchRegionPadding;\n\n    var m = REGION_PATTERN.exec(g);\n\n    if (m) {\n        var chr = m[1],\n            start,\n            end;\n        if (m[6]) {\n            start = parseLocCardinal(m[2], m[3]);\n            end = parseLocCardinal(m[6], m[7]);\n        } else {\n            var width = this.viewEnd - this.viewStart + 1;\n            start = parseLocCardinal(m[2], m[3]) - width / 2 | 0;\n            end = start + width - 1;\n        }\n        this.setLocation(chr, start, end, statusCallback);\n    } else {\n        if (!g || g.length == 0) {\n            return false;\n        }\n\n        var searchCount = 0;\n        var foundLatch = false;\n\n        var searchCallback = function searchCallback(found, err) {\n            --searchCount;\n            if (err) {\n                return statusCallback(err);\n            }\n\n            if (!found) found = [];\n            var min = 500000000,\n                max = -100000000;\n            var nchr = null;\n            for (var fi = 0; fi < found.length; ++fi) {\n                var f = found[fi];\n\n                if (nchr == null) {\n                    nchr = f.segment;\n                }\n                min = Math.min(min, f.min);\n                max = Math.max(max, f.max);\n            }\n\n            if (!nchr) {\n                if (searchCount == 0 && !foundLatch) return statusCallback(\"no match for '\" + g + \"'\");\n            } else {\n                foundLatch = true;\n                thisB.highlightRegion(nchr, min, max);\n\n                var mid = (max + min) / 2 | 0;\n                var padding = Math.max(srPadding, 0.3 * (max - min + 1) | 0);\n                thisB.setLocation(nchr, min - padding, max + padding, statusCallback);\n            }\n        };\n\n        var doTrixSearch = function doTrixSearch(tier, trix) {\n            trix.lookup(g, function (result, status) {\n                if (result == null || result.length < 2) {\n                    return tier.featureSource.search(g, searchCallback);\n                } else {\n                    var hit = result[1].split(',')[0];\n                    return tier.featureSource.search(hit, searchCallback);\n                }\n            });\n        };\n\n        if (this.searchEndpoint) {\n            searchCount = 1;\n            return this.doDasSearch(thisB.searchEndpoint, g, searchCallback);\n        }\n\n        var searchSources = [].concat(_toConsumableArray(this.searchOnlySourceHolders || []), _toConsumableArray(this.tiers));\n\n        for (var ti = 0; ti < searchSources.length; ++ti) {\n            (function (tier) {\n                if (thisB.sourceAdapterIsCapable(tier.featureSource, 'search')) {\n                    if (tier.dasSource.trixURI) {\n                        ++searchCount;\n                        if (tier.trix) {\n                            doTrixSearch(tier, tier.trix);\n                        } else {\n                            var ix = new URLFetchable(tier.dasSource.trixURI, { credentials: tier.dasSource.credentials,\n                                resolver: tier.dasSource.resolver });\n\n                            var ixx = new URLFetchable(tier.dasSource.trixxURI || tier.dasSource.trixURI + 'x', { credentials: tier.dasSource.credentials,\n                                resolver: tier.dasSource.resolver });\n\n                            connectTrix(ix, ixx, function (trix) {\n                                tier.trix = trix;\n                                doTrixSearch(tier, trix);\n                            });\n                        }\n                    } else {\n                        ++searchCount;\n                        tier.featureSource.search(g, searchCallback);\n                    }\n                } else if (tier.dasSource.provides_search) {\n                    ++searchCount;\n                    thisB.doDasSearch(tier.dasSource, g, searchCallback);\n                }\n            })(searchSources[ti]);\n        }\n    }\n};\n\nBrowser.prototype.doDasSearch = function (source, g, searchCallback) {\n    var thisB = this;\n    source.features(null, { group: g, type: 'transcript' }, function (found) {\n        if (!found) found = [];\n        var min = 500000000,\n            max = -100000000;\n        var nchr = null;\n\n        var found2 = [];\n        for (var fi = 0; fi < found.length; ++fi) {\n            var f = found[fi];\n\n            if (f.label.toLowerCase() != g.toLowerCase()) {\n                // ...because Dazzle can return spurious overlapping features.\n                continue;\n            }\n            found2.push(f);\n        }\n\n        return searchCallback(found2);\n    }, false);\n};\n\n},{\"./bin\":4,\"./cbrowser\":6,\"./trix\":54}],36:[function(require,module,exports){\n/* -*- mode: javascript; c-basic-offset: 4; indent-tabs-mode: nil -*- */\n\n// \n// Dalliance Genome Explorer\n// (c) Thomas Down 2006-2012\n//\n// sequence-draw.js: renderers for sequence-related data\n//\n\n\"use strict\";\n\nif (typeof require !== 'undefined') {\n    var utils = require('./utils');\n    var formatLongInt = utils.formatLongInt;\n    var makeElementNS = utils.makeElementNS;\n\n    var svgu = require('./svg-utils');\n    var NS_SVG = svgu.NS_SVG;\n    var NS_XLINK = svgu.NS_XLINK;\n    var SVGPath = svgu.SVGPath;\n\n    var nf = require('./numformats');\n    var formatLongInt = nf.formatLongInt;\n}\n\nvar MIN_TILE = 100;\nvar rulerTileColors = ['black', 'white'];\n\nvar steps = [1, 2, 5];\n\nvar NS_SVG = 'http://www.w3.org/2000/svg';\n\nfunction tileSizeForScale(scale, min) {\n    if (!min) {\n        min = MIN_TILE;\n    }\n\n    function ts(p) {\n        return steps[p % steps.length] * Math.pow(10, p / steps.length | 0);\n    }\n    var pow = steps.length;\n    while (scale * ts(pow) < min) {\n        ++pow;\n    }\n    return ts(pow);\n}\n\nfunction drawSeqTier(tier, seq) {\n    var gc = tier.viewport.getContext('2d');\n    var retina = tier.browser.retina && window.devicePixelRatio > 1;\n    var desiredWidth = tier.browser.featurePanelWidth + 2000;\n    if (retina) {\n        desiredWidth *= 2;\n    }\n    var fpw = tier.viewport.width | 0; // this.browser.featurePanelWidth;\n    if (fpw < desiredWidth - 50) {\n        tier.viewport.width = fpw = desiredWidth;\n    }\n\n    var height = 50;\n    if (seq && seq.seq) {\n        height += 25;\n    }\n\n    var canvasHeight = height;\n    if (retina) canvasHeight *= 2;\n\n    tier.viewport.height = canvasHeight;\n    tier.viewport.style.height = '' + height + 'px';\n    tier.viewport.style.width = retina ? '' + fpw / 2 + 'px' : '' + fpw + 'px';\n    tier.layoutHeight = height;\n    tier.updateHeight();\n\n    if (tier.background) {\n        gc.fillStyle = tier.background;\n        gc.fillRect(0, 0, fpw, tier.viewport.height);\n    }\n    if (retina) {\n        gc.scale(2, 2);\n    }\n\n    gc.translate(1000, 0);\n    drawSeqTierGC(tier, seq, gc);\n    tier.norigin = tier.browser.viewStart;\n    tier.viewportHolder.style.left = '-1000px';\n}\n\nfunction drawSeqTierGC(tier, seq, gc) {\n    var scale = tier.browser.scale,\n        knownStart = tier.browser.viewStart - 1000 / scale | 0,\n        knownEnd = tier.browser.viewEnd + 2000 / scale,\n        currentSeqMax = tier.browser.currentSeqMax;\n\n    var seqTierMax = knownEnd;\n    if (currentSeqMax > 0 && currentSeqMax < knownEnd) {\n        seqTierMax = currentSeqMax;\n    }\n    var tile = tileSizeForScale(scale);\n    var pos = Math.max(0, (knownStart / tile | 0) * tile);\n\n    var origin = tier.browser.viewStart;\n\n    while (pos <= seqTierMax) {\n        gc.fillStyle = pos / tile % 2 == 0 ? 'white' : 'black';\n        gc.strokeStyle = 'black';\n        gc.fillRect((pos - origin) * scale, 8, tile * scale, 3);\n        gc.strokeRect((pos - origin) * scale, 8, tile * scale, 3);\n\n        gc.fillStyle = 'black';\n        gc.fillText(formatLongInt(pos), (pos - origin) * scale, 22);\n\n        pos += tile;\n    }\n\n    if (seq && seq.seq) {\n        for (var p = knownStart; p <= knownEnd; ++p) {\n            if (p >= seq.start && p <= seq.end) {\n                var base = seq.seq.substr(p - seq.start, 1).toUpperCase();\n                var color = tier.browser.baseColors[base];\n                if (!color) {\n                    color = 'gray';\n                }\n\n                gc.fillStyle = color;\n\n                if (scale >= 8) {\n                    var w = gc.measureText(base).width;\n                    // console.log(scale-w);\n                    gc.fillText(base, (p - origin) * scale + (scale - w) * 0.5, 52);\n                } else {\n                    gc.fillRect((p - origin) * scale, 42, scale, 12);\n                }\n            }\n        }\n    }\n}\n\nfunction svgSeqTier(tier, seq) {\n    var scale = tier.browser.scale,\n        knownStart = tier.browser.viewStart - 1000 / scale | 0,\n        knownEnd = tier.browser.viewEnd + 2000 / scale,\n        currentSeqMax = tier.browser.currentSeqMax;\n\n    var fpw = tier.viewport.width | 0;\n\n    var seqTierMax = knownEnd;\n    if (currentSeqMax > 0 && currentSeqMax < knownEnd) {\n        seqTierMax = currentSeqMax;\n    }\n    var tile = tileSizeForScale(scale);\n    var pos = Math.max(0, (knownStart / tile | 0) * tile);\n\n    var origin = tier.browser.viewStart;\n\n    var g = makeElementNS(NS_SVG, 'g', [], { fontSize: '8pt' });\n    while (pos <= seqTierMax) {\n        g.appendChild(makeElementNS(NS_SVG, 'rect', null, { x: (pos - origin) * scale,\n            y: 8,\n            width: tile * scale,\n            height: 3,\n            fill: pos / tile % 2 == 0 ? 'white' : 'black',\n            stroke: 'black' }));\n\n        g.appendChild(makeElementNS(NS_SVG, 'text', formatLongInt(pos), { x: (pos - origin) * scale,\n            y: 28,\n            fill: 'black', stroke: 'none' }));\n\n        pos += tile;\n    }\n\n    if (seq && seq.seq) {\n        for (var p = knownStart; p <= knownEnd; ++p) {\n            if (p >= seq.start && p <= seq.end) {\n                var base = seq.seq.substr(p - seq.start, 1).toUpperCase();\n                var color = tier.browser.baseColors[base];\n                if (!color) {\n                    color = 'gray';\n                }\n\n                if (scale >= 8) {\n                    g.appendChild(makeElementNS(NS_SVG, 'text', base, {\n                        x: (0.5 + p - origin) * scale,\n                        y: 52,\n                        textAnchor: 'middle',\n                        fill: color }));\n                } else {\n                    g.appendChild(makeElementNS(NS_SVG, 'rect', null, {\n                        x: (p - origin) * scale,\n                        y: 42,\n                        width: scale,\n                        height: 12,\n                        fill: color }));\n                }\n            }\n        }\n    }\n\n    return g;\n}\n\nif (typeof module !== 'undefined') {\n    module.exports = {\n        drawSeqTier: drawSeqTier,\n        drawSeqTierGC: drawSeqTierGC,\n        svgSeqTier: svgSeqTier\n    };\n}\n\n},{\"./numformats\":30,\"./svg-utils\":45,\"./utils\":56}],37:[function(require,module,exports){\n/* -*- mode: javascript; c-basic-offset: 4; indent-tabs-mode: nil -*- */\n\n// \n// Dalliance Genome Explorer\n// (c) Thomas Down 2006-2013\n//\n// session.js\n//\n\n\"use strict\";\n\nif (typeof require != 'undefined') {\n    var browser = require('./cbrowser');\n    var Browser = browser.Browser;\n\n    var sc = require('./sourcecompare');\n    var sourceDataURI = sc.sourceDataURI;\n    var sourcesAreEqual = sc.sourcesAreEqual;\n\n    var VERSION = require('./version');\n\n    var utils = require('./utils');\n    var miniJSONify = utils.miniJSONify;\n\n    var sha1 = require('./sha1');\n    var hex_sha1 = sha1.hex_sha1;\n}\n\nBrowser.prototype.nukeStatus = function () {\n    delete localStorage['dalliance.' + this.cookieKey + '.view-chr'];\n    delete localStorage['dalliance.' + this.cookieKey + '.view-start'];\n    delete localStorage['dalliance.' + this.cookieKey + '.view-end'];\n    delete localStorage['dalliance.' + this.cookieKey + '.current-seq-length'];\n    delete localStorage['dalliance.' + this.cookieKey + '.showing-alt-zoom'];\n    delete localStorage['dalliance.' + this.cookieKey + '.saved-zoom'];\n\n    delete localStorage['dalliance.' + this.cookieKey + '.sources'];\n    delete localStorage['dalliance.' + this.cookieKey + '.hubs'];\n    delete localStorage['dalliance.' + this.cookieKey + '.version'];\n\n    delete localStorage['dalliance.' + this.cookieKey + '.reverse-scrolling'];\n    delete localStorage['dalliance.' + this.cookieKey + '.reverse-key-scrolling'];\n    delete localStorage['dalliance.' + this.cookieKey + '.ruler-location'];\n};\n\nBrowser.prototype.storeStatus = function () {\n    this.storeViewStatus();\n    this.storeTierStatus();\n};\n\nBrowser.prototype.storeViewStatus = function () {\n    if (!this.cookieKey || this.noPersist || this.noPersistView) {\n        return;\n    }\n\n    localStorage['dalliance.' + this.cookieKey + '.view-chr'] = this.chr;\n    localStorage['dalliance.' + this.cookieKey + '.view-start'] = this.viewStart | 0;\n    localStorage['dalliance.' + this.cookieKey + '.view-end'] = this.viewEnd | 0;\n    localStorage['dalliance.' + this.cookieKey + '.showing-alt-zoom'] = '' + this.isSnapZooming;\n    localStorage['dalliance.' + this.cookieKey + '.saved-zoom'] = this.savedZoom;\n    if (this.currentSeqMax) {\n        localStorage['dalliance.' + this.cookieKey + '.current-seq-length'] = this.currentSeqMax;\n    }\n};\n\nBrowser.prototype.storeTierStatus = function () {\n    if (!this.cookieKey || this.noPersist) {\n        return;\n    }\n\n    var currentSourceList = [];\n    for (var t = 0; t < this.tiers.length; ++t) {\n        var tt = this.tiers[t];\n        var ts = tt.dasSource;\n        if (!ts.noPersist) {\n            currentSourceList.push({ source: tt.dasSource, config: tt.config || {} });\n        }\n    }\n    localStorage['dalliance.' + this.cookieKey + '.sources'] = JSON.stringify(currentSourceList);\n\n    var coveredHubURLs = {};\n    var currentHubList = [];\n    for (var hi = 0; hi < this.hubObjects.length; ++hi) {\n        var tdb = this.hubObjects[hi];\n        var hc = { url: tdb.hub.url, genome: tdb.genome };\n        if (tdb.credentials) hc.credentials = tdb.credentials;\n        if (tdb.mapping) hc.mapping = tdb.mapping;\n        coveredHubURLs[hc.url] = true;\n        currentHubList.push(hc);\n    }\n\n    // Needed to handle hubs that failed to connect, or hubs that haven't\n    // connected yet when we're called soon after startup.\n    for (var hi = 0; hi < this.hubs.length; ++hi) {\n        var hc = this.hubs[hi];\n        if (typeof hc === 'string') hc = { url: hc };\n        if (!coveredHubURLs[hc.url]) currentHubList.push(hc);\n    }\n\n    localStorage['dalliance.' + this.cookieKey + '.hubs'] = JSON.stringify(currentHubList);\n\n    localStorage['dalliance.' + this.cookieKey + '.reverse-scrolling'] = this.reverseScrolling;\n    localStorage['dalliance.' + this.cookieKey + '.reverse-key-scrolling'] = this.reverseKeyScrolling;\n    localStorage['dalliance.' + this.cookieKey + '.single-base-highlight'] = this.singleBaseHighlight;\n    localStorage['dalliance.' + this.cookieKey + '.ruler-location'] = this.rulerLocation;\n\n    localStorage['dalliance.' + this.cookieKey + '.export-ruler'] = this.exportRuler;\n    localStorage['dalliance.' + this.cookieKey + '.export-highlights'] = this.exportHighlights;\n\n    localStorage['dalliance.' + this.cookieKey + '.version'] = VERSION.CONFIG;\n};\n\nBrowser.prototype.restoreStatus = function () {\n    if (this.noPersist) return;\n\n    var storedConfigVersion = localStorage['dalliance.' + this.cookieKey + '.version'];\n    if (storedConfigVersion) {\n        storedConfigVersion = storedConfigVersion | 0;\n    } else {\n        storedConfigVersion = -100;\n    }\n    if (VERSION.CONFIG != storedConfigVersion) {\n        return;\n    }\n\n    var storedConfigHash = localStorage['dalliance.' + this.cookieKey + '.configHash'] || '';\n    var pageConfigHash = hex_sha1(miniJSONify({\n        sources: this.sources,\n        hubs: this.hubs,\n        rulerLocation: this.rulerLocation\n    }));\n    if (pageConfigHash != storedConfigHash) {\n        localStorage['dalliance.' + this.cookieKey + '.configHash'] = pageConfigHash;\n        return;\n    }\n\n    var defaultSourcesByURI = {};\n    for (var si = 0; si < this.sources.length; ++si) {\n        var source = this.sources[si];\n        if (!source) continue;\n\n        var uri = sourceDataURI(source);\n        var ul = defaultSourcesByURI[uri];\n        if (!ul) defaultSourcesByURI[uri] = ul = [];\n        ul.push(source);\n    }\n\n    if (!this.noPersistView) {\n        var qChr = localStorage['dalliance.' + this.cookieKey + '.view-chr'];\n        var qMin = localStorage['dalliance.' + this.cookieKey + '.view-start'] | 0;\n        var qMax = localStorage['dalliance.' + this.cookieKey + '.view-end'] | 0;\n        if (qChr && qMin && qMax) {\n            this.chr = qChr;\n            this.viewStart = qMin;\n            this.viewEnd = qMax;\n\n            var csm = localStorage['dalliance.' + this.cookieKey + '.current-seq-length'];\n            if (csm) {\n                this.currentSeqMax = csm | 0;\n            }\n\n            this.isSnapZooming = localStorage['dalliance.' + this.cookieKey + '.showing-alt-zoom'] == 'true';\n\n            var sz = parseFloat(localStorage['dalliance.' + this.cookieKey + '.saved-zoom']);\n            if (typeof sz === 'number' && !isNaN(sz)) {\n                this.savedZoom = sz;\n            }\n        }\n    }\n\n    var rs = localStorage['dalliance.' + this.cookieKey + '.reverse-scrolling'];\n    this.reverseScrolling = rs && rs == 'true';\n    var rks = localStorage['dalliance.' + this.cookieKey + '.reverse-key-scrolling'];\n    this.reverseKeyScrolling = rks && rks == 'true';\n    var sbh = localStorage['dalliance.' + this.cookieKey + '.single-base-highlight'];\n    this.singleBaseHighlight = sbh && sbh == 'true';\n\n    var rl = localStorage['dalliance.' + this.cookieKey + '.ruler-location'];\n    if (rl) this.rulerLocation = rl;\n\n    var x = localStorage['dalliance.' + this.cookieKey + '.export-ruler'];\n    if (x) this.exportRuler = x === 'true';\n    var x = localStorage['dalliance.' + this.cookieKey + '.export-highlights'];\n    if (x) this.exportHighlights = x === 'true';\n\n    var sourceStr = localStorage['dalliance.' + this.cookieKey + '.sources'];\n    if (sourceStr) {\n        var storedSources = JSON.parse(sourceStr);\n        this.sources = [];\n        this.restoredConfigs = [];\n        for (var si = 0; si < storedSources.length; ++si) {\n            var source = this.sources[si] = storedSources[si].source;\n            this.restoredConfigs[si] = storedSources[si].config;\n            var uri = sourceDataURI(source);\n            var ul = defaultSourcesByURI[uri] || [];\n            for (var osi = 0; osi < ul.length; ++osi) {\n                var oldSource = ul[osi];\n                if (sourcesAreEqual(source, oldSource)) {\n                    for (var k in oldSource) {\n                        if (oldSource.hasOwnProperty(k) && (typeof oldSource[k] === 'function' || oldSource[k] instanceof Blob)) {\n                            source[k] = oldSource[k];\n                        }\n                    }\n                }\n            }\n        }\n    }\n\n    var hubStr = localStorage['dalliance.' + this.cookieKey + '.hubs'];\n    if (hubStr) {\n        this.hubs = JSON.parse(hubStr);\n    }\n\n    return true;\n};\n\nBrowser.prototype.reset = function () {\n    for (var i = this.tiers.length - 1; i >= 0; --i) {\n        this.removeTier({ index: i }, true);\n    }\n    for (var i = 0; i < this.defaultSources.length; ++i) {\n        var s = this.defaultSources[i];\n        if (!s.disabled) this.addTier(this.defaultSources[i]);\n    }\n\n    this.highlights.splice(0, this.highlights.length);\n\n    this.setLocation(this.defaultChr, this.defaultStart, this.defaultEnd);\n};\n\n},{\"./cbrowser\":6,\"./sha1\":38,\"./sourcecompare\":40,\"./utils\":56,\"./version\":58}],38:[function(require,module,exports){\n/*\r\n * A JavaScript implementation of the Secure Hash Algorithm, SHA-1, as defined\r\n * in FIPS 180-1\r\n * Version 2.2 Copyright Paul Johnston 2000 - 2009.\r\n * Other contributors: Greg Holt, Andrew Kepert, Ydnar, Lostinet\r\n * Distributed under the BSD License\r\n * See http://pajhome.org.uk/crypt/md5 for details.\r\n */\n\n\"use strict\";\n\n/*\r\n * Configurable variables. You may need to tweak these to be compatible with\r\n * the server-side, but the defaults work in most cases.\r\n */\n\nvar hexcase = 0; /* hex output format. 0 - lowercase; 1 - uppercase        */\nvar b64pad = \"\"; /* base-64 pad character. \"=\" for strict RFC compliance   */\n\n/*\r\n * These are the functions you'll usually want to call\r\n * They take string arguments and return either hex or base-64 encoded strings\r\n */\nfunction hex_sha1(s) {\n  return rstr2hex(rstr_sha1(str2rstr_utf8(s)));\n}\nfunction b64_sha1(s) {\n  return rstr2b64(rstr_sha1(str2rstr_utf8(s)));\n}\nfunction any_sha1(s, e) {\n  return rstr2any(rstr_sha1(str2rstr_utf8(s)), e);\n}\nfunction hex_hmac_sha1(k, d) {\n  return rstr2hex(rstr_hmac_sha1(str2rstr_utf8(k), str2rstr_utf8(d)));\n}\nfunction b64_hmac_sha1(k, d) {\n  return rstr2b64(rstr_hmac_sha1(str2rstr_utf8(k), str2rstr_utf8(d)));\n}\nfunction any_hmac_sha1(k, d, e) {\n  return rstr2any(rstr_hmac_sha1(str2rstr_utf8(k), str2rstr_utf8(d)), e);\n}\n\n/*\r\n * Perform a simple self-test to see if the VM is working\r\n */\nfunction sha1_vm_test() {\n  return hex_sha1(\"abc\").toLowerCase() == \"a9993e364706816aba3e25717850c26c9cd0d89d\";\n}\n\n/*\r\n * Calculate the SHA1 of a raw string\r\n */\nfunction rstr_sha1(s) {\n  return binb2rstr(binb_sha1(rstr2binb(s), s.length * 8));\n}\n\n/*\r\n * Calculate the HMAC-SHA1 of a key and some data (raw strings)\r\n */\nfunction rstr_hmac_sha1(key, data) {\n  var bkey = rstr2binb(key);\n  if (bkey.length > 16) bkey = binb_sha1(bkey, key.length * 8);\n\n  var ipad = Array(16),\n      opad = Array(16);\n  for (var i = 0; i < 16; i++) {\n    ipad[i] = bkey[i] ^ 0x36363636;\n    opad[i] = bkey[i] ^ 0x5C5C5C5C;\n  }\n\n  var hash = binb_sha1(ipad.concat(rstr2binb(data)), 512 + data.length * 8);\n  return binb2rstr(binb_sha1(opad.concat(hash), 512 + 160));\n}\n\n/*\r\n * Convert a raw string to a hex string\r\n */\nfunction rstr2hex(input) {\n  // try { hexcase } catch(e) { hexcase=0; }\n  var hex_tab = hexcase ? \"0123456789ABCDEF\" : \"0123456789abcdef\";\n  var output = \"\";\n  var x;\n  for (var i = 0; i < input.length; i++) {\n    x = input.charCodeAt(i);\n    output += hex_tab.charAt(x >>> 4 & 0x0F) + hex_tab.charAt(x & 0x0F);\n  }\n  return output;\n}\n\n/*\r\n * Convert a raw string to a base-64 string\r\n */\nfunction rstr2b64(input) {\n  // try { b64pad } catch(e) { b64pad=''; }\n  var tab = \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\";\n  var output = \"\";\n  var len = input.length;\n  for (var i = 0; i < len; i += 3) {\n    var triplet = input.charCodeAt(i) << 16 | (i + 1 < len ? input.charCodeAt(i + 1) << 8 : 0) | (i + 2 < len ? input.charCodeAt(i + 2) : 0);\n    for (var j = 0; j < 4; j++) {\n      if (i * 8 + j * 6 > input.length * 8) output += b64pad;else output += tab.charAt(triplet >>> 6 * (3 - j) & 0x3F);\n    }\n  }\n  return output;\n}\n\n/*\r\n * Convert a raw string to an arbitrary string encoding\r\n */\nfunction rstr2any(input, encoding) {\n  var divisor = encoding.length;\n  var remainders = Array();\n  var i, q, x, quotient;\n\n  /* Convert to an array of 16-bit big-endian values, forming the dividend */\n  var dividend = Array(Math.ceil(input.length / 2));\n  for (i = 0; i < dividend.length; i++) {\n    dividend[i] = input.charCodeAt(i * 2) << 8 | input.charCodeAt(i * 2 + 1);\n  }\n\n  /*\r\n   * Repeatedly perform a long division. The binary array forms the dividend,\r\n   * the length of the encoding is the divisor. Once computed, the quotient\r\n   * forms the dividend for the next step. We stop when the dividend is zero.\r\n   * All remainders are stored for later use.\r\n   */\n  while (dividend.length > 0) {\n    quotient = Array();\n    x = 0;\n    for (i = 0; i < dividend.length; i++) {\n      x = (x << 16) + dividend[i];\n      q = Math.floor(x / divisor);\n      x -= q * divisor;\n      if (quotient.length > 0 || q > 0) quotient[quotient.length] = q;\n    }\n    remainders[remainders.length] = x;\n    dividend = quotient;\n  }\n\n  /* Convert the remainders to the output string */\n  var output = \"\";\n  for (i = remainders.length - 1; i >= 0; i--) {\n    output += encoding.charAt(remainders[i]);\n  } /* Append leading zero equivalents */\n  var full_length = Math.ceil(input.length * 8 / (Math.log(encoding.length) / Math.log(2)));\n  for (i = output.length; i < full_length; i++) {\n    output = encoding[0] + output;\n  }return output;\n}\n\n/*\r\n * Encode a string as utf-8.\r\n * For efficiency, this assumes the input is valid utf-16.\r\n */\nfunction str2rstr_utf8(input) {\n  var output = \"\";\n  var i = -1;\n  var x, y;\n\n  while (++i < input.length) {\n    /* Decode utf-16 surrogate pairs */\n    x = input.charCodeAt(i);\n    y = i + 1 < input.length ? input.charCodeAt(i + 1) : 0;\n    if (0xD800 <= x && x <= 0xDBFF && 0xDC00 <= y && y <= 0xDFFF) {\n      x = 0x10000 + ((x & 0x03FF) << 10) + (y & 0x03FF);\n      i++;\n    }\n\n    /* Encode output as utf-8 */\n    if (x <= 0x7F) output += String.fromCharCode(x);else if (x <= 0x7FF) output += String.fromCharCode(0xC0 | x >>> 6 & 0x1F, 0x80 | x & 0x3F);else if (x <= 0xFFFF) output += String.fromCharCode(0xE0 | x >>> 12 & 0x0F, 0x80 | x >>> 6 & 0x3F, 0x80 | x & 0x3F);else if (x <= 0x1FFFFF) output += String.fromCharCode(0xF0 | x >>> 18 & 0x07, 0x80 | x >>> 12 & 0x3F, 0x80 | x >>> 6 & 0x3F, 0x80 | x & 0x3F);\n  }\n  return output;\n}\n\n/*\r\n * Encode a string as utf-16\r\n */\nfunction str2rstr_utf16le(input) {\n  var output = \"\";\n  for (var i = 0; i < input.length; i++) {\n    output += String.fromCharCode(input.charCodeAt(i) & 0xFF, input.charCodeAt(i) >>> 8 & 0xFF);\n  }return output;\n}\n\nfunction str2rstr_utf16be(input) {\n  var output = \"\";\n  for (var i = 0; i < input.length; i++) {\n    output += String.fromCharCode(input.charCodeAt(i) >>> 8 & 0xFF, input.charCodeAt(i) & 0xFF);\n  }return output;\n}\n\n/*\r\n * Convert a raw string to an array of big-endian words\r\n * Characters >255 have their high-byte silently ignored.\r\n */\nfunction rstr2binb(input) {\n  var output = Array(input.length >> 2);\n  for (var i = 0; i < output.length; i++) {\n    output[i] = 0;\n  }for (var i = 0; i < input.length * 8; i += 8) {\n    output[i >> 5] |= (input.charCodeAt(i / 8) & 0xFF) << 24 - i % 32;\n  }return output;\n}\n\n/*\r\n * Convert an array of big-endian words to a string\r\n */\nfunction binb2rstr(input) {\n  var output = \"\";\n  for (var i = 0; i < input.length * 32; i += 8) {\n    output += String.fromCharCode(input[i >> 5] >>> 24 - i % 32 & 0xFF);\n  }return output;\n}\n\n/*\r\n * Calculate the SHA-1 of an array of big-endian words, and a bit length\r\n */\nfunction binb_sha1(x, len) {\n  /* append padding */\n  x[len >> 5] |= 0x80 << 24 - len % 32;\n  x[(len + 64 >> 9 << 4) + 15] = len;\n\n  var w = Array(80);\n  var a = 1732584193;\n  var b = -271733879;\n  var c = -1732584194;\n  var d = 271733878;\n  var e = -1009589776;\n\n  for (var i = 0; i < x.length; i += 16) {\n    var olda = a;\n    var oldb = b;\n    var oldc = c;\n    var oldd = d;\n    var olde = e;\n\n    for (var j = 0; j < 80; j++) {\n      if (j < 16) w[j] = x[i + j];else w[j] = bit_rol(w[j - 3] ^ w[j - 8] ^ w[j - 14] ^ w[j - 16], 1);\n      var t = safe_add(safe_add(bit_rol(a, 5), sha1_ft(j, b, c, d)), safe_add(safe_add(e, w[j]), sha1_kt(j)));\n      e = d;\n      d = c;\n      c = bit_rol(b, 30);\n      b = a;\n      a = t;\n    }\n\n    a = safe_add(a, olda);\n    b = safe_add(b, oldb);\n    c = safe_add(c, oldc);\n    d = safe_add(d, oldd);\n    e = safe_add(e, olde);\n  }\n  return Array(a, b, c, d, e);\n}\n\n/*\r\n * Perform the appropriate triplet combination function for the current\r\n * iteration\r\n */\nfunction sha1_ft(t, b, c, d) {\n  if (t < 20) return b & c | ~b & d;\n  if (t < 40) return b ^ c ^ d;\n  if (t < 60) return b & c | b & d | c & d;\n  return b ^ c ^ d;\n}\n\n/*\r\n * Determine the appropriate additive constant for the current iteration\r\n */\nfunction sha1_kt(t) {\n  return t < 20 ? 1518500249 : t < 40 ? 1859775393 : t < 60 ? -1894007588 : -899497514;\n}\n\n/*\r\n * Add integers, wrapping at 2^32. This uses 16-bit operations internally\r\n * to work around bugs in some JS interpreters.\r\n */\nfunction safe_add(x, y) {\n  var lsw = (x & 0xFFFF) + (y & 0xFFFF);\n  var msw = (x >> 16) + (y >> 16) + (lsw >> 16);\n  return msw << 16 | lsw & 0xFFFF;\n}\n\n/*\r\n * Bitwise rotate a 32-bit number to the left.\r\n */\nfunction bit_rol(num, cnt) {\n  return num << cnt | num >>> 32 - cnt;\n}\n\nif (typeof module !== 'undefined') {\n  module.exports = {\n    b64_sha1: b64_sha1,\n    hex_sha1: hex_sha1\n  };\n}\n\n},{}],39:[function(require,module,exports){\n//* -*- mode: javascript; c-basic-offset: 4; indent-tabs-mode: nil -*- */\n\n// \n// Dalliance Genome Explorer\n// (c) Thomas Down 2006-2013\n//\n// sourceadapters.js\n//\n\n\"use strict\";\n\nif (typeof require !== 'undefined') {\n    var browser = require('./cbrowser');\n    var Browser = browser.Browser;\n\n    var tier = require('./tier');\n    var DasTier = tier.DasTier;\n\n    var utils = require('./utils');\n    var Awaited = utils.Awaited;\n    var arrayIndexOf = utils.arrayIndexOf;\n    var shallowCopy = utils.shallowCopy;\n    var resolveUrlToPage = utils.resolveUrlToPage;\n\n    var das = require('./das');\n    var DASStylesheet = das.DASStylesheet;\n    var DASStyle = das.DASStyle;\n    var DASSource = das.DASSource;\n    var DASSegment = das.DASSegment;\n    var DASFeature = das.DASFeature;\n    var DASSequence = das.DASSequence;\n    var DASLink = das.DASLink;\n\n    var bin = require('./bin');\n    var URLFetchable = bin.URLFetchable;\n    var BlobFetchable = bin.BlobFetchable;\n\n    var twoBit = require('./twoBit');\n    var makeTwoBit = twoBit.makeTwoBit;\n\n    var bbi = require('./bigwig');\n    var makeBwg = bbi.makeBwg;\n\n    var bam = require('./bam');\n    var makeBam = bam.makeBam;\n    var BamFlags = bam.BamFlags;\n\n    var cram = require('./cram');\n    var makeCram = cram.makeCram;\n    var CramFlags = cram.CramFlags;\n\n    var spans = require('./spans');\n    var Range = spans.Range;\n    var union = spans.union;\n\n    var parseCigar = require('./cigar').parseCigar;\n\n    var OverlayFeatureSource = require('./overlay').OverlayFeatureSource;\n\n    var JBrowseStore = require('./jbjson').JBrowseStore;\n\n    var Chainset = require('./chainset').Chainset;\n\n    var style = require('./style');\n    var StyleFilterSet = style.StyleFilterSet;\n\n    var EncodeFetchable = require('./encode').EncodeFetchable;\n}\n\nvar __dalliance_sourceAdapterFactories = {};\n\nfunction dalliance_registerSourceAdapterFactory(type, factory) {\n    __dalliance_sourceAdapterFactories[type] = factory;\n}\n\nvar __dalliance_parserFactories = {};\n\nfunction dalliance_registerParserFactory(type, factory) {\n    __dalliance_parserFactories[type] = factory;\n}\n\nfunction dalliance_makeParser(type) {\n    if (__dalliance_parserFactories[type]) {\n        return __dalliance_parserFactories[type](type);\n    }\n}\n\nDasTier.prototype.initSources = function () {\n    var thisTier = this;\n\n    var sources = this.browser.createSources(this.dasSource);\n    this.featureSource = sources.features || new DummyFeatureSource();\n    this.sequenceSource = sources.sequence;\n\n    if (this.featureSource && this.featureSource.addChangeListener) {\n        this.featureSource.addChangeListener(function () {\n            thisTier.browser.refreshTier(thisTier);\n        });\n    }\n};\n\nBrowser.prototype.createSources = function (config) {\n    var sources = this.sourceCache.get(config);\n    if (sources) return sources;\n\n    var fs, ss;\n\n    if (config.tier_type == 'sequence' || config.twoBitURI || config.twoBitBlob) {\n        if (config.twoBitURI || config.twoBitBlob) {\n            ss = new TwoBitSequenceSource(config);\n        } else if (config.ensemblURI) {\n            if (config.aminoAcids) {\n                ss = new EnsemblProteinSequenceSource(config);\n            } else {\n                ss = new EnsemblSequenceSource(config);\n            }\n        } else {\n            ss = new DASSequenceSource(config);\n        }\n    } else if (config.tier_type && __dalliance_sourceAdapterFactories[config.tier_type]) {\n        var saf = __dalliance_sourceAdapterFactories[config.tier_type];\n        var ns = saf(config);\n        fs = ns.features;\n        ss = ns.sequence;\n    } else if (config.bwgURI || config.bwgBlob) {\n        var worker = this.getWorker();\n        if (worker) fs = new RemoteBWGFeatureSource(config, worker, this);else fs = new BWGFeatureSource(config);\n    } else if (config.bamURI || config.bamBlob) {\n        var worker = this.getWorker();\n        if (worker) fs = new RemoteBAMFeatureSource(config, worker, this);else fs = new BAMFeatureSource(config);\n    } else if (config.cramURI || config.cramBlob) {\n        var worker = this.getWorker();\n        if (worker) fs = new RemoteCRAMFeatureSource(config, worker, this);else fs = new CRAMFeatureSource(config);\n    } else if (config.jbURI) {\n        fs = new JBrowseFeatureSource(config);\n    } else if (config.uri || config.features_uri) {\n        fs = new DASFeatureSource(config);\n    }\n\n    if (config.overlay) {\n        var sources = [];\n        if (fs) sources.push(new CachingFeatureSource(fs));\n\n        for (var oi = 0; oi < config.overlay.length; ++oi) {\n            var cs = this.createSources(config.overlay[oi]);\n            if (cs && cs.features) sources.push(cs.features);\n        }\n        fs = new OverlayFeatureSource(sources, config);\n    }\n\n    if (config.sequenceAliases) {\n        fs = new MappedFeatureSource(fs, new Chainset({ type: 'alias', sequenceAliases: config.sequenceAliases }));\n    }\n\n    if (config.mapping) {\n        fs = new MappedFeatureSource(fs, this.chains[config.mapping]);\n    }\n\n    if (config.name && fs && !fs.name) {\n        fs.name = config.name;\n    }\n\n    if (typeof fs !== 'undefined' && fs !== null) {\n        fs = new CachingFeatureSource(fs);\n    }\n\n    if (typeof fs !== 'undefined' && fs !== null || typeof ss !== 'undefined' && ss != null) {\n        sources = {\n            features: fs,\n            sequence: ss\n        };\n        this.sourceCache.put(config, sources);\n    }\n\n    return sources;\n};\n\nDasTier.prototype.fetchStylesheet = function (cb) {\n    var ssSource;\n    // Somewhat ugly workaround for the special case of DAS sources...\n    if (this.dasSource.stylesheet_uri || !this.dasSource.tier_type && !this.dasSource.bwgURI && !this.dasSource.bwgBlob && !this.dasSource.bamURI && !this.dasSource.bamBlob && !this.dasSource.twoBitURI && !this.dasSource.twoBitBlob && !this.dasSource.jbURI && !this.dasSource.overlay) {\n        ssSource = new DASFeatureSource(this.dasSource);\n    } else {\n        ssSource = this.getSource();\n    }\n    ssSource.getStyleSheet(cb);\n};\n\nvar __cfs_id_seed = 0;\n\nfunction CachingFeatureSource(source) {\n    var thisB = this;\n\n    this.source = source;\n    this.cfsid = 'cfs' + ++__cfs_id_seed;\n    if (source.name) {\n        this.name = source.name;\n    }\n    if (source.addChangeListener) {\n        source.addChangeListener(function () {\n            thisB.cfsid = 'cfs' + ++__cfs_id_seed;\n        });\n    }\n}\n\nCachingFeatureSource.prototype.addReadinessListener = function (listener) {\n    if (this.source.addReadinessListener) return this.source.addReadinessListener(listener);else listener(null);\n};\n\nCachingFeatureSource.prototype.removeReadinessListener = function (listener) {\n    if (this.source.removeReadinessListener) return this.source.removeReadinessListener(listener);\n};\n\nCachingFeatureSource.prototype.search = function (query, callback) {\n    if (this.source.search) return this.source.search(query, callback);\n};\n\nCachingFeatureSource.prototype.getDefaultFIPs = function (callback) {\n    if (this.source.getDefaultFIPs) return this.source.getDefaultFIPs(callback);\n};\n\nCachingFeatureSource.prototype.getStyleSheet = function (callback) {\n    this.source.getStyleSheet(callback);\n};\n\nCachingFeatureSource.prototype.getScales = function () {\n    return this.source.getScales();\n};\n\nCachingFeatureSource.prototype.addActivityListener = function (l) {\n    if (this.source.addActivityListener) {\n        this.source.addActivityListener(l);\n    }\n};\n\nCachingFeatureSource.prototype.removeActivityListener = function (l) {\n    if (this.source.removeActivityListener) {\n        this.source.removeActivityListener(l);\n    }\n};\n\nCachingFeatureSource.prototype.addChangeListener = function (l) {\n    if (this.source.addChangeListener) this.source.addChangeListener(l);\n};\n\nCachingFeatureSource.prototype.removeChangeListener = function (l) {\n    if (this.source.removeChangeListener) this.source.removeChangeListener(l);\n};\n\nCachingFeatureSource.prototype.findNextFeature = function (chr, pos, dir, callback) {\n    this.source.findNextFeature(chr, pos, dir, callback);\n};\n\nCachingFeatureSource.prototype.quantFindNextFeature = function (chr, pos, dir, threshold, callback) {\n    this.source.quantFindNextFeature(chr, pos, dir, threshold, callback);\n};\n\nCachingFeatureSource.prototype.capabilities = function () {\n    if (this.source.capabilities) {\n        return this.source.capabilities();\n    } else {\n        return {};\n    }\n};\n\nCachingFeatureSource.prototype.fetch = function (chr, min, max, scale, types, pool, callback, styleFilters) {\n    if (!pool) {\n        throw Error('Fetch pool is null');\n    }\n\n    var self = this;\n    var cacheKey = this.cfsid;\n\n    var awaitedFeatures = pool.awaitedFeatures[cacheKey];\n    if (awaitedFeatures && awaitedFeatures.started) {\n        if (awaitedFeatures.styleFilters.doesNotContain(styleFilters)) {\n            // console.log('Fetch already started with wrong parameters, skipping cache.');\n            self.source.fetch(chr, min, max, scale, types, pool, callback, styleFilters);\n            return;\n        }\n    } else if (awaitedFeatures) {\n        awaitedFeatures.styleFilters.addAll(styleFilters);\n    } else {\n        awaitedFeatures = new Awaited();\n        awaitedFeatures.styleFilters = styleFilters;\n        pool.awaitedFeatures[cacheKey] = awaitedFeatures;\n\n        pool.requestsIssued.then(function () {\n            awaitedFeatures.started = true;\n            self.source.fetch(chr, min, max, scale, awaitedFeatures.styleFilters.typeList(), pool, function (status, features, scale, coverage) {\n                if (!awaitedFeatures.res) awaitedFeatures.provide({ status: status, features: features, scale: scale, coverage: coverage });\n            }, awaitedFeatures.styleFilters);\n        }).catch(function (err) {\n            console.log(err);\n        });\n    }\n\n    awaitedFeatures.await(function (af) {\n        callback(af.status, af.features, af.scale, af.coverage);\n    });\n};\n\nfunction FeatureSourceBase() {\n    this.busy = 0;\n    this.activityListeners = [];\n    this.readinessListeners = [];\n    this.readiness = null;\n}\n\nFeatureSourceBase.prototype.addReadinessListener = function (listener) {\n    this.readinessListeners.push(listener);\n    listener(this.readiness);\n};\n\nFeatureSourceBase.prototype.removeReadinessListener = function (listener) {\n    var idx = arrayIndexOf(this.readinessListeners, listener);\n    if (idx >= 0) {\n        this.readinessListeners.splice(idx, 1);\n    }\n};\n\nFeatureSourceBase.prototype.notifyReadiness = function () {\n    for (var li = 0; li < this.readinessListeners.length; ++li) {\n        try {\n            this.readinessListeners[li](this.readiness);\n        } catch (e) {\n            console.log(e);\n        }\n    }\n};\n\nFeatureSourceBase.prototype.addActivityListener = function (listener) {\n    this.activityListeners.push(listener);\n};\n\nFeatureSourceBase.prototype.removeActivityListener = function (listener) {\n    var idx = arrayIndexOf(this.activityListeners, listener);\n    if (idx >= 0) {\n        this.activityListeners.splice(idx, 1);\n    }\n};\n\nFeatureSourceBase.prototype.notifyActivity = function () {\n    for (var li = 0; li < this.activityListeners.length; ++li) {\n        try {\n            this.activityListeners[li](this.busy);\n        } catch (e) {\n            console.log(e);\n        }\n    }\n};\n\nFeatureSourceBase.prototype.getScales = function () {\n    return null;\n};\n\nFeatureSourceBase.prototype.fetch = function (chr, min, max, scale, types, pool, cnt) {\n    return cnt(null, [], 1000000000);\n};\n\nFeatureSourceBase.prototype.getStyleSheet = function (callback) {\n    var stylesheet = new DASStylesheet();\n    var defStyle = new DASStyle();\n    defStyle.glyph = 'BOX';\n    defStyle.BGCOLOR = 'blue';\n    defStyle.FGCOLOR = 'black';\n    stylesheet.pushStyle({ type: 'default' }, null, defStyle);\n    return callback(stylesheet);\n};\n\nfunction DASFeatureSource(dasSource) {\n    this.dasSource = new DASSource(dasSource);\n    this.busy = 0;\n    this.activityListeners = [];\n}\n\nDASFeatureSource.prototype.addActivityListener = function (listener) {\n    this.activityListeners.push(listener);\n};\n\nDASFeatureSource.prototype.removeActivityListener = function (listener) {\n    var idx = arrayIndexOf(this.activityListeners, listener);\n    if (idx >= 0) this.activityListeners.splice(idx, 1);\n};\n\nDASFeatureSource.prototype.notifyActivity = function () {\n    for (var li = 0; li < this.activityListeners.length; ++li) {\n        try {\n            this.activityListeners[li](this.busy);\n        } catch (e) {\n            console.log(e);\n        }\n    }\n};\n\nDASFeatureSource.prototype.getStyleSheet = function (callback) {\n    this.dasSource.stylesheet(function (stylesheet) {\n        callback(stylesheet);\n    }, function () {\n        callback(null, \"Couldn't fetch DAS stylesheet\");\n    });\n};\n\nDASFeatureSource.prototype.fetch = function (chr, min, max, scale, types, pool, callback) {\n    if (types && types.length === 0) {\n        callback(null, [], scale);\n        return;\n    }\n\n    if (!this.dasSource.uri && !this.dasSource.features_uri) {\n        // FIXME should this be making an error callback???\n        return;\n    }\n\n    if (this.dasSource.dasStaticFeatures && this.cachedStaticFeatures) {\n        return callback(null, this.cachedStaticFeatures, this.cachedStaticScale);\n    }\n\n    var tryMaxBins = this.dasSource.maxbins !== false;\n    var fops = {\n        type: types\n    };\n    if (tryMaxBins) {\n        fops.maxbins = 1 + ((max - min) / scale | 0);\n    }\n\n    var thisB = this;\n    thisB.busy++;\n    thisB.notifyActivity();\n\n    this.dasSource.features(new DASSegment(chr, min, max), fops, function (features, status) {\n\n        thisB.busy--;\n        thisB.notifyActivity();\n\n        var retScale = scale;\n        if (!tryMaxBins) {\n            retScale = 0.1;\n        }\n        if (!status && thisB.dasSource.dasStaticFeatures) {\n            thisB.cachedStaticFeatures = features;\n            thisB.cachedStaticScale = retScale;\n        }\n        callback(status, features, retScale);\n    });\n};\n\nDASFeatureSource.prototype.findNextFeature = function (chr, pos, dir, callback) {\n    if (this.dasSource.capabilities && arrayIndexOf(this.dasSource.capabilities, 'das1:adjacent-feature') >= 0) {\n        var thisB = this;\n        if (this.dasAdjLock) {\n            return console.log('Already looking for a next feature, be patient!');\n        }\n        this.dasAdjLock = true;\n        var fops = {\n            adjacent: chr + ':' + (pos | 0) + ':' + (dir > 0 ? 'F' : 'B')\n        };\n        var types = thisTier.getDesiredTypes(thisTier.browser.scale);\n        if (types) {\n            fops.types = types;\n        }\n        thisTier.dasSource.features(null, fops, function (res) {\n            thisB.dasAdjLock = false;\n            if (res.length > 0 && res[0] !== null) {\n                callback(res[0]);\n            }\n        });\n    }\n};\n\nfunction DASSequenceSource(dasSource) {\n    this.dasSource = new DASSource(dasSource);\n    this.awaitedEntryPoints = new Awaited();\n\n    var thisB = this;\n    this.dasSource.entryPoints(function (ep) {\n        thisB.awaitedEntryPoints.provide(ep);\n    });\n}\n\nDASSequenceSource.prototype.fetch = function (chr, min, max, pool, callback) {\n    this.dasSource.sequence(new DASSegment(chr, min, max), function (seqs) {\n        if (seqs.length == 1) {\n            return callback(null, seqs[0]);\n        } else {\n            return callback(\"Didn't get sequence\");\n        }\n    });\n};\n\nDASSequenceSource.prototype.getSeqInfo = function (chr, cnt) {\n    this.awaitedEntryPoints.await(function (ep) {\n        for (var epi = 0; epi < ep.length; ++epi) {\n            if (ep[epi].name == chr) {\n                return cnt({ length: ep[epi].end });\n            }\n        }\n        return cnt();\n    });\n};\n\nfunction TwoBitSequenceSource(source) {\n    var thisB = this;\n    this.source = source;\n    this.twoBit = new Awaited();\n    var data;\n    if (source.twoBitURI) {\n        data = new URLFetchable(source.twoBitURI, { credentials: source.credentials, resolver: source.resolver });\n    } else if (source.twoBitBlob) {\n        data = new BlobFetchable(source.twoBitBlob);\n    } else {\n        throw Error(\"No twoBitURI or twoBitBlob parameter\");\n    }\n\n    makeTwoBit(data, function (tb, error) {\n        if (error) {\n            console.log(error);\n        } else {\n            thisB.twoBit.provide(tb);\n        }\n    });\n}\n\nTwoBitSequenceSource.prototype.fetch = function (chr, min, max, pool, callback) {\n    this.twoBit.await(function (tb) {\n        tb.fetch(chr, min, max, function (seq, err) {\n            if (err) {\n                return callback(err, null);\n            } else {\n                var sequence = new DASSequence(chr, min, max, 'DNA', seq);\n                return callback(null, sequence);\n            }\n        });\n    });\n};\n\nTwoBitSequenceSource.prototype.getSeqInfo = function (chr, cnt) {\n    this.twoBit.await(function (tb) {\n        var seq = tb.getSeq(chr);\n        if (seq) {\n            tb.getSeq(chr).length(function (l) {\n                cnt({ length: l });\n            });\n        } else {\n            cnt();\n        }\n    });\n};\n\nfunction EnsemblSequenceSource(source) {\n    this.source = source;\n}\n\nEnsemblSequenceSource.prototype.fetch = function (chr, min, max, pool, callback) {\n    var url = this.source.ensemblURI + '/sequence/region/' + this.source.species + '/' + chr + ':' + min + '..' + max + ':1?content-type=application/json';\n    var req = new XMLHttpRequest();\n    req.onreadystatechange = function () {\n        if (req.readyState == 4) {\n            var jr;\n            if (req.status >= 300) {\n                var err = 'Error code ' + req.status;\n                try {\n                    jr = JSON.parse(req.response);\n                    if (jr.error) {\n                        err = jr.error;\n                    }\n                } finally {\n                    callback(err, null);\n                }\n            } else {\n                jr = JSON.parse(req.response);\n                var sequence = new DASSequence(chr, min, max, 'DNA', jr.seq);\n                return callback(null, sequence);\n            }\n        }\n    };\n    req.open('GET', url, true);\n    req.responseType = 'text';\n    req.send();\n};\n\nEnsemblSequenceSource.prototype.getSeqInfo = function (chr, cnt) {\n    var url = this.source.ensemblURI + '/info/assembly/' + this.source.species + '/' + chr + '?content-type=application/json';\n    var req = new XMLHttpRequest();\n    req.onreadystatechange = function () {\n        if (req.readyState == 4) {\n            if (req.status >= 300) {\n                cnt();\n            } else {\n                var jr = JSON.parse(req.response);\n                cnt(jr);\n            }\n        }\n    };\n    req.open('GET', url, true);\n    req.responseType = 'text';\n    req.send();\n};\n\nfunction EnsemblProteinSequenceSource(source) {\n    this.source = source;\n}\n\nEnsemblProteinSequenceSource.prototype.fetch = function (chr, min, max, pool, callback) {\n    var url = this.source.ensemblURI + '/sequence/id/' + chr + '?type=protein&content-type=application/json';\n    var req = new XMLHttpRequest();\n    req.onreadystatechange = function () {\n        if (req.readyState == 4) {\n            if (req.status >= 300) {\n                var err = 'Error code ' + req.status;\n                try {\n                    var jr = JSON.parse(req.response);\n                    if (jr.error) {\n                        err = jr.error;\n                    }\n                } catch (ex) {};\n\n                callback(err, null);\n            } else {\n                var jr = JSON.parse(req.response);\n                var sequence = new DASSequence(chr, 1, jr.seq.length + 1, 'PEP', jr.seq);\n                return callback(null, sequence);\n            }\n        }\n    };\n    req.open('GET', url, true);\n    req.responseType = 'text';\n    req.send('');\n};\n\nEnsemblProteinSequenceSource.prototype.getSeqInfo = function (chr, cnt) {\n    var url = this.source.ensemblURI + '/sequence/id/' + chr + '?type=protein&content-type=application/json';\n    var req = new XMLHttpRequest();\n    req.onreadystatechange = function () {\n        if (req.readyState == 4) {\n            if (req.status >= 300) {\n                cnt();\n            } else {\n                var jr = JSON.parse(req.response);\n                cnt({ length: jr.seq.length });\n            }\n        }\n    };\n    req.open('GET', url, true);\n    req.responseType = 'text';\n    req.send('');\n};\n\nDASFeatureSource.prototype.getScales = function () {\n    return [];\n};\n\nvar bwg_preflights = {};\n\nfunction BWGFeatureSource(bwgSource) {\n    FeatureSourceBase.call(this);\n\n    var thisB = this;\n    this.readiness = 'Connecting';\n    this.bwgSource = this.opts = bwgSource;\n    thisB.bwgHolder = new Awaited();\n\n    if (this.opts.preflight) {\n        var pfs = bwg_preflights[this.opts.preflight];\n        if (!pfs) {\n            pfs = new Awaited();\n            bwg_preflights[this.opts.preflight] = pfs;\n\n            var req = new XMLHttpRequest();\n            req.onreadystatechange = function () {\n                if (req.readyState == 4) {\n                    if (req.status == 200) {\n                        pfs.provide('success');\n                    } else {\n                        pfs.provide('failure');\n                    }\n                }\n            };\n            req.open('get', this.opts.preflight + '?' + hex_sha1('salt' + Date.now()), true); // Instead, ensure we always preflight a unique URI.\n            if (this.opts.credentials) {\n                req.withCredentials = true;\n            }\n            req.send();\n        }\n        pfs.await(function (status) {\n            if (status === 'success') {\n                thisB.init();\n            }\n        });\n    } else {\n        thisB.init();\n    }\n}\n\nBWGFeatureSource.prototype = Object.create(FeatureSourceBase.prototype);\n\nBWGFeatureSource.prototype.init = function () {\n    var thisB = this;\n    var arg;\n\n    var uri = this.bwgSource.uri || this.bwgSource.bwgURI;\n    if (uri) {\n        if (this.bwgSource.transport === 'encode') {\n            arg = new EncodeFetchable(uri, { credentials: this.opts.credentials });\n        } else {\n            arg = new URLFetchable(uri, { credentials: this.opts.credentials, resolver: this.opts.resolver });\n        }\n    } else {\n        arg = new BlobFetchable(this.bwgSource.bwgBlob);\n    }\n\n    makeBwg(arg, function (bwg, err) {\n        if (err) {\n            thisB.error = err;\n            thisB.readiness = null;\n            thisB.notifyReadiness();\n            thisB.bwgHolder.provide(null);\n        } else {\n            thisB.bwgHolder.provide(bwg);\n            thisB.readiness = null;\n            thisB.notifyReadiness();\n            if (bwg.type == 'bigbed') {\n                bwg.getExtraIndices(function (ei) {\n                    thisB.extraIndices = ei;\n                });\n            }\n        }\n    });\n};\n\nBWGFeatureSource.prototype.capabilities = function () {\n    var caps = { leap: true };\n    if (this.bwgHolder.res && this.bwgHolder.res.type == 'bigwig') caps.quantLeap = true;\n    if (this.extraIndices && this.extraIndices.length > 0) {\n        caps.search = [];\n        for (var eii = 0; eii < this.extraIndices.length; ++eii) {\n            caps.search.push(this.extraIndices[eii].field);\n        }\n    }\n    return caps;\n};\n\nBWGFeatureSource.prototype.fetch = function (chr, min, max, scale, types, pool, callback) {\n    var thisB = this;\n    this.bwgHolder.await(function (bwg) {\n        if (typeof bwg === 'undefined' || bwg === null) {\n            return callback(thisB.error || \"Can't access binary file\", null, null);\n        }\n\n        var data;\n        var wantDensity = !types || types.length === 0 || arrayIndexOf(types, 'density') >= 0;\n        if (thisB.opts.clientBin) {\n            wantDensity = false;\n        }\n        var scaleFactor = thisB.opts.scaleFactor || 1.0;\n        if (bwg.type == 'bigwig' || wantDensity || typeof thisB.opts.forceReduction !== 'undefined') {\n            var zoom = -1;\n            for (var z = 0; z < bwg.zoomLevels.length; ++z) {\n                if (bwg.zoomLevels[z].reduction <= scale * scaleFactor) {\n                    zoom = z;\n                } else {\n                    break;\n                }\n            }\n            if (typeof thisB.opts.forceReduction !== 'undefined') {\n                zoom = thisB.opts.forceReduction;\n            }\n\n            if (zoom < 0) {\n                data = bwg.getUnzoomedView();\n            } else {\n                data = bwg.getZoomedView(zoom);\n            }\n        } else {\n            data = bwg.getUnzoomedView();\n        }\n\n        thisB.busy++;\n        thisB.notifyActivity();\n        data.readWigData(chr, min, max, function (features) {\n            thisB.busy--;\n            thisB.notifyActivity();\n\n            var fs = 1000000000;\n            if (bwg.type === 'bigwig') {\n                var is = (max - min) / features.length / 2;\n                if (is < fs) {\n                    fs = is;\n                }\n            }\n            if (thisB.opts.link) {\n                for (var fi = 0; fi < features.length; ++fi) {\n                    var f = features[fi];\n                    if (f.label) {\n                        f.links = [new DASLink('Link', thisB.opts.link.replace(/\\$\\$/, f.label))];\n                    }\n                }\n            }\n            callback(null, features, fs);\n        });\n    });\n};\n\nBWGFeatureSource.prototype.quantFindNextFeature = function (chr, pos, dir, threshold, callback) {\n    // var beforeQFNF = Date.now()|0;\n    var thisB = this;\n    thisB.busy++;\n    thisB.notifyActivity();\n    this.bwgHolder.res.thresholdSearch(chr, pos, dir, threshold, function (a, b) {\n        thisB.busy--;\n        thisB.notifyActivity();\n        // var afterQFNF = Date.now()|0;\n        // console.log('QFNF took ' + (afterQFNF - beforeQFNF) + 'ms');\n        return callback(a, b);\n    });\n};\n\nBWGFeatureSource.prototype.findNextFeature = function (chr, pos, dir, callback) {\n    var thisB = this;\n    thisB.busy++;\n    thisB.notifyActivity();\n    this.bwgHolder.res.getUnzoomedView().getFirstAdjacent(chr, pos, dir, function (res) {\n        thisB.busy--;\n        thisB.notifyActivity();\n        if (res.length > 0 && res[0] !== null) {\n            callback(res[0]);\n        }\n    });\n};\n\nBWGFeatureSource.prototype.getScales = function () {\n    var bwg = this.bwgHolder.res;\n    if (bwg /* && bwg.type == 'bigwig' */) {\n            var scales = [1]; // Can we be smarter about inferring baseline scale?\n            for (var z = 0; z < bwg.zoomLevels.length; ++z) {\n                scales.push(bwg.zoomLevels[z].reduction);\n            }\n            return scales;\n        } else {\n        return null;\n    }\n};\n\nBWGFeatureSource.prototype.search = function (query, callback) {\n    if (!this.extraIndices || this.extraIndices.length === 0) {\n        return callback(null, 'No indices available');\n    }\n\n    var index = this.extraIndices[0];\n    return index.lookup(query, callback);\n};\n\nBWGFeatureSource.prototype.getDefaultFIPs = function (callback) {\n    if (this.opts.noExtraFeatureInfo) return true;\n\n    this.bwgHolder.await(function (bwg) {\n        if (!bwg) return;\n\n        if (bwg.schema && bwg.definedFieldCount < bwg.schema.fields.length) {\n            var fip = function fip(feature, featureInfo) {\n                for (var hi = 0; hi < featureInfo.hit.length; ++hi) {\n                    if (featureInfo.hit[hi].isSuperGroup) return;\n                }\n                for (var fi = bwg.definedFieldCount; fi < bwg.schema.fields.length; ++fi) {\n                    var f = bwg.schema.fields[fi];\n                    featureInfo.add(f.comment, feature[f.name]);\n                }\n            };\n\n            callback(fip);\n        } else {\n            // No need to do anything.\n        }\n    });\n};\n\nBWGFeatureSource.prototype.getStyleSheet = function (callback) {\n    var thisB = this;\n\n    this.bwgHolder.await(function (bwg) {\n        if (!bwg) {\n            return callback(null, 'bbi error');\n        }\n\n        var stylesheet = new DASStylesheet();\n        if (bwg.type == 'bigbed') {\n            var wigStyle = new DASStyle();\n            wigStyle.glyph = 'BOX';\n            wigStyle.FGCOLOR = 'black';\n            wigStyle.BGCOLOR = 'blue';\n            wigStyle.HEIGHT = 8;\n            wigStyle.BUMP = true;\n            wigStyle.LABEL = true;\n            wigStyle.ZINDEX = 20;\n            stylesheet.pushStyle({ type: 'bigbed' }, null, wigStyle);\n\n            wigStyle.glyph = 'BOX';\n            wigStyle.FGCOLOR = 'black';\n            wigStyle.BGCOLOR = 'red';\n            wigStyle.HEIGHT = 10;\n            wigStyle.BUMP = true;\n            wigStyle.ZINDEX = 20;\n            stylesheet.pushStyle({ type: 'translation' }, null, wigStyle);\n\n            var tsStyle = new DASStyle();\n            tsStyle.glyph = 'BOX';\n            tsStyle.FGCOLOR = 'black';\n            tsStyle.BGCOLOR = 'white';\n            tsStyle.HEIGHT = 10;\n            tsStyle.ZINDEX = 10;\n            tsStyle.BUMP = true;\n            tsStyle.LABEL = true;\n            stylesheet.pushStyle({ type: 'transcript' }, null, tsStyle);\n\n            var densStyle = new DASStyle();\n            densStyle.glyph = 'HISTOGRAM';\n            densStyle.COLOR1 = 'white';\n            densStyle.COLOR2 = 'black';\n            densStyle.HEIGHT = 30;\n            stylesheet.pushStyle({ type: 'density' }, null, densStyle);\n        } else {\n            var wigStyle = new DASStyle();\n            wigStyle.glyph = 'HISTOGRAM';\n            wigStyle.COLOR1 = 'white';\n            wigStyle.COLOR2 = 'black';\n            wigStyle.HEIGHT = 30;\n            stylesheet.pushStyle({ type: 'default' }, null, wigStyle);\n        }\n\n        if (bwg.definedFieldCount == 12 && bwg.fieldCount >= 14) {\n            stylesheet.geneHint = true;\n        }\n\n        return callback(stylesheet);\n    });\n};\n\nfunction RemoteBWGFeatureSource(bwgSource, worker, browser) {\n    FeatureSourceBase.call(this);\n\n    var thisB = this;\n    this.worker = worker;\n    this.readiness = 'Connecting';\n    this.bwgSource = this.opts = bwgSource;\n    this.keyHolder = new Awaited();\n\n    if (bwgSource.resolver) {\n        this.resolverKey = browser.registerResolver(bwgSource.resolver);\n    }\n\n    this.init();\n}\n\nRemoteBWGFeatureSource.prototype = Object.create(FeatureSourceBase.prototype);\n\nRemoteBWGFeatureSource.prototype.init = function () {\n    var thisB = this;\n    var uri = this.uri || this.bwgSource.uri || this.bwgSource.bwgURI;\n    var blob = this.bwgSource.blob || this.bwgSource.bwgBlob;\n\n    var cnt = function cnt(key, err) {\n        thisB.readiness = null;\n        thisB.notifyReadiness();\n\n        if (key) {\n            thisB.worker.postCommand({ command: 'meta', connection: key }, function (meta, err) {\n                if (err) {\n                    thisB.error = err;\n                    thisB.keyHolder.provide(null);\n                } else {\n                    thisB.meta = meta;\n                    thisB.keyHolder.provide(key);\n                }\n            });\n        } else {\n            thisB.error = err;\n            thisB.keyHolder.provide(null);\n        }\n    };\n\n    if (blob) {\n        this.worker.postCommand({ command: 'connectBBI', blob: blob }, cnt);\n    } else {\n        this.worker.postCommand({\n            command: 'connectBBI',\n            uri: resolveUrlToPage(uri),\n            resolver: this.resolverKey,\n            transport: this.bwgSource.transport,\n            credentials: this.bwgSource.credentials }, cnt);\n    }\n};\n\nRemoteBWGFeatureSource.prototype.capabilities = function () {\n    var caps = { leap: true };\n\n    if (this.meta && this.meta.type == 'bigwig') caps.quantLeap = true;\n    if (this.meta && this.meta.extraIndices && this.meta.extraIndices.length > 0) {\n        caps.search = [];\n        for (var eii = 0; eii < this.meta.extraIndices.length; ++eii) {\n            caps.search.push(this.meta.extraIndices[eii].field);\n        }\n    }\n    return caps;\n};\n\nRemoteBWGFeatureSource.prototype.fetch = function (chr, min, max, scale, types, pool, callback) {\n    var thisB = this;\n\n    thisB.busy++;\n    thisB.notifyActivity();\n\n    this.keyHolder.await(function (key) {\n        if (!key) {\n            thisB.busy--;\n            thisB.notifyActivity();\n            return callback(thisB.error || \"Can't access binary file\", null, null);\n        }\n\n        var zoom = -1;\n        var wantDensity = !types || types.length === 0 || arrayIndexOf(types, 'density') >= 0;\n        if (thisB.opts.clientBin) {\n            wantDensity = false;\n        }\n        if (thisB.meta.type == 'bigwig' || wantDensity || typeof thisB.opts.forceReduction !== 'undefined') {\n            for (var z = 1; z < thisB.meta.zoomLevels.length; ++z) {\n                if (thisB.meta.zoomLevels[z] <= scale) {\n                    zoom = z - 1; // Scales returned in metadata start at 1, unlike \"real\" zoom levels.\n                } else {\n                    break;\n                }\n            }\n            if (typeof thisB.opts.forceReduction !== 'undefined') {\n                zoom = thisB.opts.forceReduction;\n            }\n        }\n\n        thisB.worker.postCommand({ command: 'fetch', connection: key, chr: chr, min: min, max: max, zoom: zoom }, function (features, error) {\n            thisB.busy--;\n            thisB.notifyActivity();\n\n            var fs = 1000000000;\n            if (thisB.meta.type === 'bigwig') {\n                var is = (max - min) / features.length / 2;\n                if (is < fs) {\n                    fs = is;\n                }\n            }\n            if (thisB.opts.link) {\n                for (var fi = 0; fi < features.length; ++fi) {\n                    var f = features[fi];\n                    if (f.label) {\n                        f.links = [new DASLink('Link', thisB.opts.link.replace(/\\$\\$/, f.label))];\n                    }\n                }\n            }\n            callback(error, features, fs);\n        });\n    });\n};\n\nRemoteBWGFeatureSource.prototype.quantFindNextFeature = function (chr, pos, dir, threshold, callback) {\n    var thisB = this;\n    this.busy++;\n    this.notifyActivity();\n    this.worker.postCommand({ command: 'quantLeap', connection: this.keyHolder.res, chr: chr, pos: pos, dir: dir, threshold: threshold, under: false }, function (result, err) {\n        console.log(result, err);\n        thisB.busy--;\n        thisB.notifyActivity();\n        return callback(result, err);\n    });\n};\n\nRemoteBWGFeatureSource.prototype.findNextFeature = function (chr, pos, dir, callback) {\n    var thisB = this;\n    this.busy++;\n    this.notifyActivity();\n    this.worker.postCommand({ command: 'leap', connection: this.keyHolder.res, chr: chr, pos: pos, dir: dir }, function (result, err) {\n        thisB.busy--;\n        thisB.notifyActivity();\n        if (result.length > 0 && result[0] !== null) {\n            callback(result[0]);\n        }\n    });\n};\n\nRemoteBWGFeatureSource.prototype.getScales = function () {\n    var meta = this.meta;\n    if (meta) {\n        return meta.zoomLevels;\n    } else {\n        return null;\n    }\n};\n\nRemoteBWGFeatureSource.prototype.search = function (query, callback) {\n    if (!this.meta.extraIndices || this.meta.extraIndices.length === 0) {\n        return callback(null, 'No indices available');\n    }\n\n    var thisB = this;\n    this.busy++;\n    this.notifyActivity();\n    var index = this.meta.extraIndices[0];\n    this.worker.postCommand({ command: 'search', connection: this.keyHolder.res, query: query, index: index }, function (result, err) {\n        thisB.busy--;\n        thisB.notifyActivity();\n\n        callback(result, err);\n    });\n};\n\nRemoteBWGFeatureSource.prototype.getDefaultFIPs = function (callback) {\n    if (this.opts.noExtraFeatureInfo) return true;\n\n    var thisB = this;\n    this.keyHolder.await(function (key) {\n        var bwg = thisB.meta;\n        if (!bwg) return;\n\n        if (bwg.schema && bwg.definedFieldCount < bwg.schema.fields.length) {\n            var fip = function fip(feature, featureInfo) {\n                for (var hi = 0; hi < featureInfo.hit.length; ++hi) {\n                    if (featureInfo.hit[hi].isSuperGroup) return;\n                }\n                for (var fi = bwg.definedFieldCount; fi < bwg.schema.fields.length; ++fi) {\n                    var f = bwg.schema.fields[fi];\n                    featureInfo.add(f.comment, feature[f.name]);\n                }\n            };\n\n            callback(fip);\n        } else {\n            // No need to do anything.\n        }\n    });\n};\n\nRemoteBWGFeatureSource.prototype.getStyleSheet = function (callback) {\n    var thisB = this;\n\n    this.keyHolder.await(function (key) {\n        var bwg = thisB.meta;\n        if (!bwg) {\n            return callback(null, 'bbi error');\n        }\n\n        var stylesheet = new DASStylesheet();\n        if (bwg.type == 'bigbed') {\n            var wigStyle = new DASStyle();\n            wigStyle.glyph = 'BOX';\n            wigStyle.FGCOLOR = 'black';\n            wigStyle.BGCOLOR = 'blue';\n            wigStyle.HEIGHT = 8;\n            wigStyle.BUMP = true;\n            wigStyle.LABEL = true;\n            wigStyle.ZINDEX = 20;\n            stylesheet.pushStyle({ type: 'bigbed' }, null, wigStyle);\n\n            wigStyle.glyph = 'BOX';\n            wigStyle.FGCOLOR = 'black';\n            wigStyle.BGCOLOR = 'red';\n            wigStyle.HEIGHT = 10;\n            wigStyle.BUMP = true;\n            wigStyle.ZINDEX = 20;\n            stylesheet.pushStyle({ type: 'translation' }, null, wigStyle);\n\n            var tsStyle = new DASStyle();\n            tsStyle.glyph = 'BOX';\n            tsStyle.FGCOLOR = 'black';\n            tsStyle.BGCOLOR = 'white';\n            tsStyle.HEIGHT = 10;\n            tsStyle.ZINDEX = 10;\n            tsStyle.BUMP = true;\n            tsStyle.LABEL = true;\n            stylesheet.pushStyle({ type: 'transcript' }, null, tsStyle);\n\n            var densStyle = new DASStyle();\n            densStyle.glyph = 'HISTOGRAM';\n            densStyle.COLOR1 = 'white';\n            densStyle.COLOR2 = 'black';\n            densStyle.HEIGHT = 30;\n            stylesheet.pushStyle({ type: 'density' }, null, densStyle);\n        } else {\n            var wigStyle = new DASStyle();\n            wigStyle.glyph = 'HISTOGRAM';\n            wigStyle.COLOR1 = 'white';\n            wigStyle.COLOR2 = 'black';\n            wigStyle.HEIGHT = 30;\n            stylesheet.pushStyle({ type: 'default' }, null, wigStyle);\n        }\n\n        if (bwg.definedFieldCount == 12 && bwg.fieldCount >= 14) {\n            stylesheet.geneHint = true;\n        }\n\n        return callback(stylesheet);\n    });\n};\n\nfunction bamRecordToFeature(r, group) {\n    if (r.flag & BamFlags.SEGMENT_UNMAPPED) return;\n\n    var len;\n    if (r.seq) len = r.seq.length;else len = r.seqLength;\n\n    if (r.cigar) {\n        len = 0;\n        var ops = parseCigar(r.cigar);\n        for (var ci = 0; ci < ops.length; ++ci) {\n            var co = ops[ci];\n            if (co.op == 'M' || co.op == 'D') len += co.cnt;\n        }\n    }\n\n    var f = new DASFeature();\n    f.min = r.pos + 1;\n    f.max = r.pos + len;\n    f.segment = r.segment;\n    f.type = 'bam';\n    f.id = r.readName;\n    f.notes = [/* 'Sequence=' + r.seq, 'CIGAR=' + r.cigar, */'MQ=' + r.mq];\n    f.cigar = r.cigar;\n    f.seq = r.seq;\n    f.quals = r.quals;\n    f.orientation = r.flag & BamFlags.REVERSE_COMPLEMENT ? '-' : '+';\n    f.bamRecord = r;\n\n    if (group && r.flag & BamFlags.MULTIPLE_SEGMENTS) {\n        f.groups = [{ id: r.readName,\n            type: 'readpair' }];\n    }\n\n    return f;\n}\n\nfunction BAMFeatureSource(bamSource) {\n    FeatureSourceBase.call(this);\n\n    var thisB = this;\n    this.bamSource = bamSource;\n    this.opts = { credentials: bamSource.credentials, preflight: bamSource.preflight, bamGroup: bamSource.bamGroup };\n    this.bamHolder = new Awaited();\n\n    if (this.opts.preflight) {\n        var pfs = bwg_preflights[this.opts.preflight];\n        if (!pfs) {\n            pfs = new Awaited();\n            bwg_preflights[this.opts.preflight] = pfs;\n\n            var req = new XMLHttpRequest();\n            req.onreadystatechange = function () {\n                if (req.readyState == 4) {\n                    if (req.status == 200) {\n                        pfs.provide('success');\n                    } else {\n                        pfs.provide('failure');\n                    }\n                }\n            };\n            // req.setRequestHeader('cache-control', 'no-cache');    /* Doesn't work, not an allowed request header in CORS */\n            req.open('get', this.opts.preflight + '?' + hex_sha1('salt' + Date.now()), true); // Instead, ensure we always preflight a unique URI.\n            if (this.opts.credentials) {\n                req.withCredentials = 'true';\n            }\n            req.send();\n        }\n        pfs.await(function (status) {\n            if (status === 'success') {\n                thisB.init();\n            }\n        });\n    } else {\n        thisB.init();\n    }\n}\n\nBAMFeatureSource.prototype = Object.create(FeatureSourceBase.prototype);\n\nBAMFeatureSource.prototype.init = function () {\n    var thisB = this;\n    var bamF, baiF;\n    if (this.bamSource.bamBlob) {\n        bamF = new BlobFetchable(this.bamSource.bamBlob);\n        baiF = new BlobFetchable(this.bamSource.baiBlob);\n    } else {\n        bamF = new URLFetchable(this.bamSource.bamURI, { credentials: this.opts.credentials, resolver: this.opts.resolver });\n        baiF = new URLFetchable(this.bamSource.baiURI || this.bamSource.bamURI + '.bai', { credentials: this.opts.credentials, resolver: this.opts.resolver });\n    }\n    makeBam(bamF, baiF, null, function (bam, err) {\n        thisB.readiness = null;\n        thisB.notifyReadiness();\n\n        if (bam) {\n            thisB.bamHolder.provide(bam);\n        } else {\n            thisB.error = err;\n            thisB.bamHolder.provide(null);\n        }\n    });\n};\n\nBAMFeatureSource.prototype.fetch = function (chr, min, max, scale, types, pool, callback) {\n    var light = types && types.length == 1 && types[0] == 'density';\n\n    var thisB = this;\n\n    thisB.busy++;\n    thisB.notifyActivity();\n\n    this.bamHolder.await(function (bam) {\n        if (!bam) {\n            thisB.busy--;\n            thisB.notifyActivity();\n            return callback(thisB.error || \"Couldn't fetch BAM\");\n        }\n\n        bam.fetch(chr, min, max, function (bamRecords, error) {\n            thisB.busy--;\n            thisB.notifyActivity();\n\n            if (error) {\n                callback(error, null, null);\n            } else {\n                var features = [];\n                for (var ri = 0; ri < bamRecords.length; ++ri) {\n                    var r = bamRecords[ri];\n\n                    var f = bamRecordToFeature(r, thisB.opts.bamGroup);\n                    if (f) features.push(f);\n                }\n                callback(null, features, 1000000000);\n            }\n        }, { light: light });\n    });\n};\n\nBAMFeatureSource.prototype.getScales = function () {\n    return 1000000000;\n};\n\nBAMFeatureSource.prototype.getStyleSheet = function (callback) {\n    this.bamHolder.await(function (bam) {\n        var stylesheet = new DASStylesheet();\n\n        var densStyle = new DASStyle();\n        densStyle.glyph = 'HISTOGRAM';\n        densStyle.COLOR1 = 'black';\n        densStyle.COLOR2 = 'red';\n        densStyle.HEIGHT = 30;\n        stylesheet.pushStyle({ type: 'density' }, 'low', densStyle);\n        stylesheet.pushStyle({ type: 'density' }, 'medium', densStyle);\n\n        var wigStyle = new DASStyle();\n        wigStyle.glyph = '__SEQUENCE';\n        wigStyle.FGCOLOR = 'black';\n        wigStyle.BGCOLOR = 'blue';\n        wigStyle.HEIGHT = 8;\n        wigStyle.BUMP = true;\n        wigStyle.LABEL = false;\n        wigStyle.ZINDEX = 20;\n        stylesheet.pushStyle({ type: 'bam' }, 'high', wigStyle);\n\n        return callback(stylesheet);\n    });\n};\n\nfunction RemoteBAMFeatureSource(bamSource, worker) {\n    FeatureSourceBase.call(this);\n\n    var thisB = this;\n    this.bamSource = bamSource;\n    this.worker = worker;\n    this.opts = { credentials: bamSource.credentials, preflight: bamSource.preflight, bamGroup: bamSource.bamGroup };\n    this.keyHolder = new Awaited();\n\n    if (bamSource.resolver) {\n        this.resolverKey = browser.registerResolver(bamSource.resolver);\n    }\n\n    this.init();\n}\n\nRemoteBAMFeatureSource.prototype = Object.create(FeatureSourceBase.prototype);\n\nRemoteBAMFeatureSource.prototype.init = function () {\n    var thisB = this;\n    var uri = this.bamSource.uri || this.bamSource.bamURI;\n    var indexUri = this.bamSource.indexUri || this.bamSource.baiURI || uri + '.bai';\n\n    var blob = this.bamSource.bamBlob || this.bamSource.blob;\n    var indexBlob = this.bamSource.baiBlob || this.bamSource.indexBlob;\n\n    var cnt = function cnt(result, err) {\n        thisB.readiness = null;\n        thisB.notifyReadiness();\n\n        if (result) {\n            thisB.keyHolder.provide(result);\n        } else {\n            thisB.error = err;\n            thisB.keyHolder.provide(null);\n        }\n    };\n\n    if (blob) {\n        this.worker.postCommand({ command: 'connectBAM', blob: blob, indexBlob: indexBlob }, cnt);\n    } else {\n        this.worker.postCommand({\n            command: 'connectBAM',\n            uri: resolveUrlToPage(uri),\n            resolver: this.resolverKey,\n            indexUri: resolveUrlToPage(indexUri),\n            credentials: this.bamSource.credentials,\n            indexChunks: this.bamSource.indexChunks }, cnt);\n    }\n};\n\nRemoteBAMFeatureSource.prototype.fetch = function (chr, min, max, scale, types, pool, callback) {\n    var light = types && types.length == 1 && types[0] == 'density';\n    var thisB = this;\n\n    thisB.busy++;\n    thisB.notifyActivity();\n\n    this.keyHolder.await(function (key) {\n        if (!key) {\n            thisB.busy--;\n            thisB.notifyActivity();\n            return callback(thisB.error || \"Couldn't fetch BAM\");\n        }\n\n        thisB.worker.postCommand({ command: 'fetch', connection: key, chr: chr, min: min, max: max, opts: { light: light } }, function (bamRecords, error) {\n            // console.log('retrieved ' + bamRecords.length + ' via worker.');\n\n            thisB.busy--;\n            thisB.notifyActivity();\n\n            if (error) {\n                callback(error, null, null);\n            } else {\n                var features = [];\n                for (var ri = 0; ri < bamRecords.length; ++ri) {\n                    var r = bamRecords[ri];\n                    var f = bamRecordToFeature(r, thisB.opts.bamGroup);\n                    if (f) features.push(f);\n                }\n                callback(null, features, 1000000000);\n            }\n        });\n    });\n};\n\nRemoteBAMFeatureSource.prototype.getScales = function () {\n    return 1000000000;\n};\n\nRemoteBAMFeatureSource.prototype.getStyleSheet = function (callback) {\n    this.keyHolder.await(function (bam) {\n        var stylesheet = new DASStylesheet();\n\n        var densStyle = new DASStyle();\n        densStyle.glyph = 'HISTOGRAM';\n        densStyle.COLOR1 = 'black';\n        densStyle.COLOR2 = 'red';\n        densStyle.HEIGHT = 30;\n        stylesheet.pushStyle({ type: 'density' }, 'low', densStyle);\n        stylesheet.pushStyle({ type: 'density' }, 'medium', densStyle);\n\n        var wigStyle = new DASStyle();\n        wigStyle.glyph = '__SEQUENCE';\n        wigStyle.FGCOLOR = 'black';\n        wigStyle.BGCOLOR = 'blue';\n        wigStyle.HEIGHT = 8;\n        wigStyle.BUMP = true;\n        wigStyle.LABEL = false;\n        wigStyle.ZINDEX = 20;\n        stylesheet.pushStyle({ type: 'bam' }, 'high', wigStyle);\n        return callback(stylesheet);\n    });\n};\n\nfunction CRAMFeatureSource(cramSource) {\n    FeatureSourceBase.call(this);\n\n    var thisB = this;\n    this.cramSource = cramSource;\n    this.opts = { credentials: cramSource.credentials, preflight: cramSource.preflight, cramGroup: cramSource.cramGroup };\n    this.cramHolder = new Awaited();\n\n    if (this.opts.preflight) {\n        var pfs = bwg_preflights[this.opts.preflight];\n        if (!pfs) {\n            pfs = new Awaited();\n            bwg_preflights[this.opts.preflight] = pfs;\n\n            var req = new XMLHttpRequest();\n            req.onreadystatechange = function () {\n                if (req.readyState == 4) {\n                    if (req.status == 200) {\n                        pfs.provide('success');\n                    } else {\n                        pfs.provide('failure');\n                    }\n                }\n            };\n            // req.setRequestHeader('cache-control', 'no-cache');    /* Doesn't work, not an allowed request header in CORS */\n            req.open('get', this.opts.preflight + '?' + hex_sha1('salt' + Date.now()), true); // Instead, ensure we always preflight a unique URI.\n            if (this.opts.credentials) {\n                req.withCredentials = 'true';\n            }\n            req.send();\n        }\n        pfs.await(function (status) {\n            if (status === 'success') {\n                thisB.init();\n            }\n        });\n    } else {\n        thisB.init();\n    }\n}\n\nCRAMFeatureSource.prototype = Object.create(FeatureSourceBase.prototype);\n\nCRAMFeatureSource.prototype.init = function () {\n    var thisB = this;\n    var cramF, craiF;\n    if (this.cramSource.cramBlob) {\n        cramF = new BlobFetchable(this.cramSource.cramBlob);\n        craiF = new BlobFetchable(this.cramSource.craiBlob);\n    } else {\n        cramF = new URLFetchable(this.cramSource.cramURI, { credentials: this.opts.credentials, resolver: this.opts.resolver });\n        craiF = new URLFetchable(this.cramSource.craiURI || this.cramSource.cramURI + '.crai', { credentials: this.opts.credentials, resolver: this.opts.resolver });\n    }\n    makeCram(cramF, craiF, null, function (cram, err) {\n        thisB.readiness = null;\n        thisB.notifyReadiness();\n\n        if (cram) {\n            thisB.cramHolder.provide(cram);\n        } else {\n            thisB.error = err;\n            thisB.cramHolder.provide(null);\n        }\n    });\n};\n\nCRAMFeatureSource.prototype.fetch = function (chr, min, max, scale, types, pool, callback) {\n    var light = types && types.length == 1 && types[0] == 'density';\n\n    var thisB = this;\n\n    thisB.busy++;\n    thisB.notifyActivity();\n\n    this.cramHolder.await(function (cram) {\n        if (!cram) {\n            thisB.busy--;\n            thisB.notifyActivity();\n            return callback(thisB.error || \"Couldn't fetch CRAM\");\n        }\n\n        cram.fetch(chr, min, max, function (cramRecords, error) {\n            thisB.busy--;\n            thisB.notifyActivity();\n\n            if (error) {\n                callback(error, null, null);\n            } else {\n                var features = [];\n                for (var ri = 0; ri < cramRecords.length; ++ri) {\n                    var r = cramRecords[ri];\n\n                    var f = cramRecordToFeature(r, thisB.opts.cramGroup);\n                    if (f) features.push(f);\n                }\n                callback(null, features, 1000000000);\n            }\n        }, { light: light });\n    });\n};\n\nCRAMFeatureSource.prototype.getScales = function () {\n    return 1000000000;\n};\n\nCRAMFeatureSource.prototype.getStyleSheet = function (callback) {\n    this.cramHolder.await(function (cram) {\n        var stylesheet = new DASStylesheet();\n\n        var densStyle = new DASStyle();\n        densStyle.glyph = 'HISTOGRAM';\n        densStyle.COLOR1 = 'black';\n        densStyle.COLOR2 = 'red';\n        densStyle.HEIGHT = 30;\n        stylesheet.pushStyle({ type: 'density' }, 'low', densStyle);\n        stylesheet.pushStyle({ type: 'density' }, 'medium', densStyle);\n\n        var wigStyle = new DASStyle();\n        wigStyle.glyph = '__SEQUENCE';\n        wigStyle.FGCOLOR = 'black';\n        wigStyle.BGCOLOR = 'blue';\n        wigStyle.HEIGHT = 8;\n        wigStyle.BUMP = true;\n        wigStyle.LABEL = false;\n        wigStyle.ZINDEX = 20;\n        stylesheet.pushStyle({ type: 'cram' }, 'high', wigStyle);\n\n        return callback(stylesheet);\n    });\n};\n\nfunction RemoteCRAMFeatureSource(cramSource, worker) {\n    FeatureSourceBase.call(this);\n\n    var thisB = this;\n    this.cramSource = cramSource;\n    this.worker = worker;\n    this.opts = { credentials: cramSource.credentials, preflight: cramSource.preflight, cramGroup: cramSource.cramGroup };\n    this.keyHolder = new Awaited();\n\n    if (cramSource.resolver) {\n        this.resolverKey = browser.registerResolver(cramSource.resolver);\n    }\n\n    this.init();\n}\n\nRemoteCRAMFeatureSource.prototype = Object.create(FeatureSourceBase.prototype);\n\nRemoteCRAMFeatureSource.prototype.init = function () {\n    var thisB = this;\n    var uri = this.cramSource.uri || this.cramSource.cramURI;\n    var indexUri = this.cramSource.indexUri || this.cramSource.craiURI || uri + '.crai';\n\n    var blob = this.cramSource.cramBlob || this.cramSource.blob;\n    var indexBlob = this.cramSource.craiBlob || this.cramSource.indexBlob;\n\n    var cnt = function cnt(result, err) {\n        thisB.readiness = null;\n        thisB.notifyReadiness();\n\n        if (result) {\n            thisB.keyHolder.provide(result);\n        } else {\n            thisB.error = err;\n            thisB.keyHolder.provide(null);\n        }\n    };\n\n    if (blob) {\n        this.worker.postCommand({ command: 'connectCRAM', blob: blob, indexBlob: indexBlob }, cnt);\n    } else {\n        this.worker.postCommand({\n            command: 'connectCRAM',\n            uri: resolveUrlToPage(uri),\n            resolver: this.resolverKey,\n            indexUri: resolveUrlToPage(indexUri),\n            credentials: this.cramSource.credentials,\n            indexChunks: this.cramSource.indexChunks }, cnt);\n    }\n};\n\nRemoteCRAMFeatureSource.prototype.fetch = function (chr, min, max, scale, types, pool, callback) {\n    var light = types && types.length == 1 && types[0] == 'density';\n    var thisB = this;\n\n    thisB.busy++;\n    thisB.notifyActivity();\n\n    this.keyHolder.await(function (key) {\n        if (!key) {\n            thisB.busy--;\n            thisB.notifyActivity();\n            return callback(thisB.error || \"Couldn't fetch CRAM\");\n        }\n\n        thisB.worker.postCommand({ command: 'fetch', connection: key, chr: chr, min: min, max: max, opts: { light: light } }, function (cramRecords, error) {\n            // console.log('retrieved ' + cramRecords.length + ' via worker.');\n\n            thisB.busy--;\n            thisB.notifyActivity();\n\n            if (error) {\n                callback(error, null, null);\n            } else {\n                var features = [];\n                for (var ri = 0; ri < cramRecords.length; ++ri) {\n                    var r = cramRecords[ri];\n                    var f = cramRecordToFeature(r, thisB.opts.cramGroup);\n                    if (f) features.push(f);\n                }\n                callback(null, features, 1000000000);\n            }\n        });\n    });\n};\n\nRemoteCRAMFeatureSource.prototype.getScales = function () {\n    return 1000000000;\n};\n\nRemoteCRAMFeatureSource.prototype.getStyleSheet = function (callback) {\n    this.keyHolder.await(function (cram) {\n        var stylesheet = new DASStylesheet();\n\n        var densStyle = new DASStyle();\n        densStyle.glyph = 'HISTOGRAM';\n        densStyle.COLOR1 = 'black';\n        densStyle.COLOR2 = 'red';\n        densStyle.HEIGHT = 30;\n        stylesheet.pushStyle({ type: 'density' }, 'low', densStyle);\n        stylesheet.pushStyle({ type: 'density' }, 'medium', densStyle);\n\n        var wigStyle = new DASStyle();\n        wigStyle.glyph = '__SEQUENCE';\n        wigStyle.FGCOLOR = 'black';\n        wigStyle.BGCOLOR = 'blue';\n        wigStyle.HEIGHT = 8;\n        wigStyle.BUMP = true;\n        wigStyle.LABEL = false;\n        wigStyle.ZINDEX = 20;\n        stylesheet.pushStyle({ type: 'cram' }, 'high', wigStyle);\n        return callback(stylesheet);\n    });\n};\n\nfunction MappedFeatureSource(source, mapping) {\n    this.source = source;\n    this.mapping = mapping;\n\n    this.activityListeners = [];\n    this.busy = 0;\n}\n\nMappedFeatureSource.prototype.addActivityListener = function (listener) {\n    this.activityListeners.push(listener);\n};\n\nMappedFeatureSource.prototype.removeActivityListener = function (listener) {\n    var idx = arrayIndexOf(this.activityListeners, listener);\n    if (idx >= 0) this.activityListeners.splice(idx, 0);\n};\n\nMappedFeatureSource.prototype.notifyActivity = function () {\n    for (var li = 0; li < this.activityListeners.length; ++li) {\n        try {\n            this.activityListeners[li](this.busy);\n        } catch (e) {\n            console.log(e);\n        }\n    }\n};\n\nMappedFeatureSource.prototype.getStyleSheet = function (callback) {\n    return this.source.getStyleSheet(callback);\n};\n\nMappedFeatureSource.prototype.getScales = function () {\n    return this.source.getScales();\n};\n\nMappedFeatureSource.prototype.getDefaultFIPs = function (callback) {\n    if (this.source.getDefaultFIPs) return this.source.getDefaultFIPs(callback);\n};\n\nMappedFeatureSource.prototype.simplifySegments = function (segs, minGap) {\n    if (segs.length === 0) return segs;\n\n    segs.sort(function (s1, s2) {\n        var d = s1.name - s2.name;\n        if (d) return d;\n        d = s1.start - s2.start;\n        if (d) return d;\n        return s1.end - s2.end; // Should never come to this...?\n    });\n\n    var ssegs = [];\n    var currentSeg = segs[0];\n    for (var si = 0; si < segs.length; ++si) {\n        var ns = segs[si];\n\n        // console.log(ns.name + ' ' + ns.start + ' ' + ns.end);\n        if (ns.name != currentSeg.name || ns.start > currentSeg.end + minGap) {\n            ssegs.push(currentSeg);\n            currentSeg = ns;\n        } else {\n            currentSeg = new DASSegment(currentSeg.name, Math.min(currentSeg.start, ns.start), Math.max(currentSeg.end, ns.end));\n        }\n    }\n    ssegs.push(currentSeg);\n    return ssegs;\n};\n\nMappedFeatureSource.prototype.fetch = function (chr, min, max, scale, types, pool, callback, styleFilters) {\n    var thisB = this;\n    var fetchLength = max - min + 1;\n\n    thisB.busy++;\n    thisB.notifyActivity();\n\n    this.mapping.sourceBlocksForRange(chr, min, max, function (mseg) {\n        if (mseg.length === 0) {\n            thisB.busy--;\n            thisB.notifyActivity();\n\n            callback(\"No mapping available for this regions\", [], scale);\n        } else {\n            mseg = thisB.simplifySegments(mseg, Math.max(100, 0.05 * fetchLength));\n\n            var mappedFeatures = [];\n            var mappedLoc = null;\n            var count = mseg.length;\n            var finalStatus;\n\n            mseg.map(function (seg) {\n                thisB.source.fetch(seg.name, seg.start, seg.end, scale, types, pool, function (status, features, fscale) {\n                    if (status && !finalStatus) finalStatus = status;\n\n                    if (features) {\n                        for (var fi = 0; fi < features.length; ++fi) {\n                            var f = features[fi];\n                            var sn = f.segment;\n                            if (sn.indexOf('chr') === 0) {\n                                sn = sn.substr(3);\n                            }\n\n                            var mappings = thisB.mapping.mapSegment(sn, f.min, f.max);\n\n                            if (mappings.length === 0) {\n                                if (f.parts && f.parts.length > 0) {\n                                    mappedFeatures.push(f);\n                                }\n                            } else {\n                                for (var mi = 0; mi < mappings.length; ++mi) {\n                                    var m = mappings[mi];\n                                    var mf = shallowCopy(f);\n                                    mf.segment = m.segment;\n                                    mf.min = m.min;\n                                    mf.max = m.max;\n                                    if (m.partialMin) mf.partialMin = m.partialMin;\n                                    if (m.partialMax) mf.partialMax = m.partialMax;\n\n                                    if (m.flipped) {\n                                        if (f.orientation == '-') {\n                                            mf.orientation = '+';\n                                        } else if (f.orientation == '+') {\n                                            mf.orientation = '-';\n                                        }\n                                    }\n                                    mappedFeatures.push(mf);\n                                }\n                            }\n                        }\n                    }\n\n                    var m1 = thisB.mapping.mapPoint(seg.name, seg.start);\n                    var m2 = thisB.mapping.mapPoint(seg.name, seg.end);\n\n                    if (m1 && m2) {\n                        var segDestCoverage = new Range(m1.pos, m2.pos);\n                        if (mappedLoc) mappedLoc = union(mappedLoc, segDestCoverage);else mappedLoc = segDestCoverage;\n                    }\n\n                    --count;\n                    if (count === 0) {\n                        thisB.busy--;\n                        thisB.notifyActivity();\n                        callback(finalStatus, mappedFeatures, fscale, mappedLoc);\n                    }\n                }, styleFilters);\n            });\n        }\n    });\n};\n\nfunction DummyFeatureSource() {}\n\nDummyFeatureSource.prototype.getScales = function () {\n    return null;\n};\n\nDummyFeatureSource.prototype.fetch = function (chr, min, max, scale, types, pool, cnt) {\n    return cnt(null, [], 1000000000);\n};\n\nDummyFeatureSource.prototype.getStyleSheet = function (callback) {\n    var stylesheet = new DASStylesheet();\n    var defStyle = new DASStyle();\n    defStyle.glyph = 'BOX';\n    defStyle.BGCOLOR = 'blue';\n    defStyle.FGCOLOR = 'black';\n    stylesheet.pushStyle({ type: 'default' }, null, defStyle);\n    return callback(stylesheet);\n};\n\nfunction DummySequenceSource() {}\n\nDummySequenceSource.prototype.fetch = function (chr, min, max, pool, cnt) {\n    return cnt(null, null);\n};\n\nfunction JBrowseFeatureSource(source) {\n    this.store = new JBrowseStore(source.jbURI, source.jbQuery);\n}\n\nJBrowseFeatureSource.prototype.getScales = function () {\n    return null;\n};\n\nJBrowseFeatureSource.prototype.getStyleSheet = function (callback) {\n    var stylesheet = new DASStylesheet();\n\n    var cdsStyle = new DASStyle();\n    cdsStyle.glyph = 'BOX';\n    cdsStyle.FGCOLOR = 'black';\n    cdsStyle.BGCOLOR = 'red';\n    cdsStyle.HEIGHT = 10;\n    cdsStyle.BUMP = true;\n    cdsStyle.ZINDEX = 20;\n    stylesheet.pushStyle({ type: 'translation' }, null, cdsStyle);\n\n    var tsStyle = new DASStyle();\n    tsStyle.glyph = 'BOX';\n    tsStyle.FGCOLOR = 'black';\n    tsStyle.BGCOLOR = 'white';\n    tsStyle.HEIGHT = 10;\n    tsStyle.ZINDEX = 10;\n    tsStyle.BUMP = true;\n    tsStyle.LABEL = true;\n    stylesheet.pushStyle({ type: 'transcript' }, null, tsStyle);\n\n    var wigStyle = new DASStyle();\n    wigStyle.glyph = 'BOX';\n    wigStyle.FGCOLOR = 'black';\n    wigStyle.BGCOLOR = 'green';\n    wigStyle.HEIGHT = 8;\n    wigStyle.BUMP = true;\n    wigStyle.LABEL = true;\n    wigStyle.ZINDEX = 20;\n    stylesheet.pushStyle({ type: 'default' }, null, wigStyle);\n\n    return callback(stylesheet);\n};\n\nJBrowseFeatureSource.prototype.fetch = function (chr, min, max, scale, types, pool, callback) {\n    if (types && types.length === 0) {\n        callback(null, [], scale);\n        return;\n    }\n\n    var fops = {};\n\n    this.store.features(new DASSegment(chr, min, max), fops, function (features, status) {\n        callback(status, features, 100000);\n    });\n};\n\nBrowser.prototype.sourceAdapterIsCapable = function (s, cap) {\n    if (!s.capabilities) return false;else return s.capabilities()[cap];\n};\n\nif (typeof module !== 'undefined') {\n    module.exports = {\n        FeatureSourceBase: FeatureSourceBase,\n\n        TwoBitSequenceSource: TwoBitSequenceSource,\n        EnsemblSequenceSource: EnsemblSequenceSource,\n        EnsemblProteinSequenceSource: EnsemblProteinSequenceSource,\n        DASSequenceSource: DASSequenceSource,\n        MappedFeatureSource: MappedFeatureSource,\n        CachingFeatureSource: CachingFeatureSource,\n        BWGFeatureSource: BWGFeatureSource,\n        RemoteBWGFeatureSource: RemoteBWGFeatureSource,\n        BAMFeatureSource: BAMFeatureSource,\n        RemoteBAMFeatureSource: RemoteBAMFeatureSource,\n        CRAMFeatureSource: CRAMFeatureSource,\n        RemoteCRAMFeatureSource: RemoteCRAMFeatureSource,\n        DummyFeatureSource: DummyFeatureSource,\n        DummySequenceSource: DummySequenceSource,\n\n        registerSourceAdapterFactory: dalliance_registerSourceAdapterFactory,\n        registerParserFactory: dalliance_registerParserFactory,\n        makeParser: dalliance_makeParser\n    };\n\n    // Standard set of plugins.\n    require('./ensembljson');\n    require('./tabix-source');\n    require('./memstore');\n    require('./bedwig');\n    require('./vcf');\n    require('./test-source');\n}\n\n},{\"./bam\":1,\"./bedwig\":2,\"./bigwig\":3,\"./bin\":4,\"./cbrowser\":6,\"./chainset\":7,\"./cigar\":8,\"./cram\":10,\"./das\":11,\"./encode\":15,\"./ensembljson\":16,\"./jbjson\":25,\"./memstore\":28,\"./overlay\":31,\"./spans\":41,\"./style\":42,\"./tabix-source\":46,\"./test-source\":48,\"./tier\":52,\"./twoBit\":55,\"./utils\":56,\"./vcf\":57}],40:[function(require,module,exports){\n'use strict';\n\n/* -*- mode: javascript; c-basic-offset: 4; indent-tabs-mode: nil -*- */\n\n// \n// Dalliance Genome Explorer\n// (c) Thomas Down 2006-2015\n//\n// sourcecompare.js\n//\n\n\nfunction sourceDataURI(conf) {\n    if (conf.uri) {\n        return conf.uri;\n    } else if (conf.blob) {\n        return 'file:' + conf.blob.name;\n    } else if (conf.bwgBlob) {\n        return 'file:' + conf.bwgBlob.name;\n    } else if (conf.bamBlob) {\n        return 'file:' + conf.bamBlob.name;\n    } else if (conf.twoBitBlob) {\n        return 'file:' + conf.twoBitBlob.name;\n    }\n\n    return conf.bwgURI || conf.bamURI || conf.jbURI || conf.twoBitURI || 'https://www.biodalliance.org/magic/no_uri';\n}\n\nfunction sourceStyleURI(conf) {\n    if (conf.stylesheet_uri) return conf.stylesheet_uri;else if (conf.tier_type == 'sequence' || conf.twoBitURI || conf.twoBitBlob) return 'https://www.biodalliance.org/magic/sequence';else return sourceDataURI(conf);\n}\n\nfunction sourcesAreEqualModuloStyle(a, b) {\n    if (sourceDataURI(a) != sourceDataURI(b)) return false;\n\n    if (a.mapping != b.mapping) return false;\n\n    if (a.tier_type != b.tier_type) return false;\n\n    if (a.overlay) {\n        if (!b.overlay || b.overlay.length != a.overlay.length) return false;\n        for (var oi = 0; oi < a.overlay.length; ++oi) {\n            if (!sourcesAreEqualModuloStyle(a.overlay[oi], b.overlay[oi])) return false;\n        }\n    } else {\n        if (b.overlay) return false;\n    }\n\n    return true;\n}\n\nfunction sourcesAreEqual(a, b) {\n    if (sourceDataURI(a) != sourceDataURI(b) || sourceStyleURI(a) != sourceStyleURI(b)) return false;\n\n    if (a.mapping != b.mapping) return false;\n\n    if (a.tier_type != b.tier_type) return false;\n\n    if (a.overlay) {\n        if (!b.overlay || b.overlay.length != a.overlay.length) return false;\n        for (var oi = 0; oi < a.overlay.length; ++oi) {\n            if (!sourcesAreEqual(a.overlay[oi], b.overlay[oi])) return false;\n        }\n    } else {\n        if (b.overlay) return false;\n    }\n\n    return true;\n}\n\nif (typeof module !== 'undefined') {\n    module.exports = {\n        sourcesAreEqual: sourcesAreEqual,\n        sourcesAreEqualModuloStyle: sourcesAreEqualModuloStyle,\n        sourceDataURI: sourceDataURI,\n        sourceStyleURI: sourceStyleURI\n    };\n}\n\n},{}],41:[function(require,module,exports){\n/* -*- mode: javascript; c-basic-offset: 4; indent-tabs-mode: nil -*- */\n\n// \n// Dalliance Genome Explorer\n// (c) Thomas Down 2006-2010\n//\n// spans.js: JavaScript Intset/Location port.\n//\n\n\"use strict\";\n\nfunction Range(min, max) {\n    if (typeof min != 'number' || typeof max != 'number') throw 'Bad range ' + min + ',' + max;\n    this._min = min;\n    this._max = max;\n}\n\nRange.prototype.min = function () {\n    return this._min;\n};\n\nRange.prototype.max = function () {\n    return this._max;\n};\n\nRange.prototype.contains = function (pos) {\n    return pos >= this._min && pos <= this._max;\n};\n\nRange.prototype.isContiguous = function () {\n    return true;\n};\n\nRange.prototype.ranges = function () {\n    return [this];\n};\n\nRange.prototype._pushRanges = function (ranges) {\n    ranges.push(this);\n};\n\nRange.prototype.toString = function () {\n    return '[' + this._min + '-' + this._max + ']';\n};\n\nfunction _Compound(ranges) {\n    // given: a set of unsorted possibly overlapping ranges\n    // sort the input ranges\n    var sorted = ranges.sort(_rangeOrder);\n    // merge overlaps between adjacent ranges\n    var merged = [];\n    var current = sorted.shift();\n    sorted.forEach(function (range) {\n        if (range._min <= current._max) {\n            if (range._max > current._max) {\n                current._max = range._max;\n            }\n        } else {\n            merged.push(current);\n            current = range;\n        }\n    });\n    merged.push(current);\n    this._ranges = merged;\n}\n\n_Compound.prototype.min = function () {\n    return this._ranges[0].min();\n};\n\n_Compound.prototype.max = function () {\n    return this._ranges[this._ranges.length - 1].max();\n};\n\n// returns the index of the first range that is not less than pos\n_Compound.prototype.lower_bound = function (pos) {\n    // first check if pos is out of range\n    var r = this.ranges();\n    if (pos > this.max()) return r.length;\n    if (pos < this.min()) return 0;\n    // do a binary search\n    var a = 0,\n        b = r.length - 1;\n    while (a <= b) {\n        var m = Math.floor((a + b) / 2);\n        if (pos > r[m]._max) {\n            a = m + 1;\n        } else if (pos < r[m]._min) {\n            b = m - 1;\n        } else {\n            return m;\n        }\n    }\n    return a;\n};\n\n_Compound.prototype.contains = function (pos) {\n    var lb = this.lower_bound(pos);\n    if (lb < this._ranges.length && this._ranges[lb].contains(pos)) {\n        return true;\n    }\n    return false;\n};\n\n_Compound.prototype.insertRange = function (range) {\n    var lb = this.lower_bound(range._min);\n    if (lb === this._ranges.length) {\n        // range follows this\n        this._ranges.push(range);\n        return;\n    }\n\n    var r = this.ranges();\n    if (range._max < r[lb]._min) {\n        // range preceeds lb\n        this._ranges.splice(lb, 0, range);\n        return;\n    }\n\n    // range overlaps lb (at least)\n    if (r[lb]._min < range._min) range._min = r[lb]._min;\n    var ub = lb + 1;\n    while (ub < r.length && r[ub]._min <= range._max) {\n        ub++;\n    }\n    ub--;\n    // ub is the upper bound of the new range\n    if (r[ub]._max > range._max) range._max = r[ub]._max;\n\n    // splice range into this._ranges\n    this._ranges.splice(lb, ub - lb + 1, range);\n    return;\n};\n\n_Compound.prototype.isContiguous = function () {\n    return this._ranges.length > 1;\n};\n\n_Compound.prototype.ranges = function () {\n    return this._ranges;\n};\n\n_Compound.prototype._pushRanges = function (ranges) {\n    for (var ri = 0; ri < this._ranges.length; ++ri) {\n        ranges.push(this._ranges[ri]);\n    }\n};\n\n_Compound.prototype.toString = function () {\n    var s = '';\n    for (var r = 0; r < this._ranges.length; ++r) {\n        if (r > 0) {\n            s = s + ',';\n        }\n        s = s + this._ranges[r].toString();\n    }\n    return s;\n};\n\nfunction union(s0, s1) {\n    if (!(s0 instanceof _Compound)) {\n        if (!(s0 instanceof Array)) s0 = [s0];\n        s0 = new _Compound(s0);\n    }\n\n    if (s1) s0.insertRange(s1);\n\n    return s0;\n}\n\nfunction intersection(s0, s1) {\n    var r0 = s0.ranges();\n    var r1 = s1.ranges();\n    var l0 = r0.length,\n        l1 = r1.length;\n    var i0 = 0,\n        i1 = 0;\n    var or = [];\n\n    while (i0 < l0 && i1 < l1) {\n        var s0 = r0[i0],\n            s1 = r1[i1];\n        var lapMin = Math.max(s0.min(), s1.min());\n        var lapMax = Math.min(s0.max(), s1.max());\n        if (lapMax >= lapMin) {\n            or.push(new Range(lapMin, lapMax));\n        }\n        if (s0.max() > s1.max()) {\n            ++i1;\n        } else {\n            ++i0;\n        }\n    }\n\n    if (or.length == 0) {\n        return null; // FIXME\n    } else if (or.length == 1) {\n        return or[0];\n    } else {\n        return new _Compound(or);\n    }\n}\n\nfunction coverage(s) {\n    var tot = 0;\n    var rl = s.ranges();\n    for (var ri = 0; ri < rl.length; ++ri) {\n        var r = rl[ri];\n        tot += r.max() - r.min() + 1;\n    }\n    return tot;\n}\n\nfunction rangeOrder(a, b) {\n    if (a.min() < b.min()) {\n        return -1;\n    } else if (a.min() > b.min()) {\n        return 1;\n    } else if (a.max() < b.max()) {\n        return -1;\n    } else if (b.max() > a.max()) {\n        return 1;\n    } else {\n        return 0;\n    }\n}\n\nfunction _rangeOrder(a, b) {\n    if (a._min < b._min) {\n        return -1;\n    } else if (a._min > b._min) {\n        return 1;\n    } else if (a._max < b._max) {\n        return -1;\n    } else if (b._max > a._max) {\n        return 1;\n    } else {\n        return 0;\n    }\n}\n\nif (typeof module !== 'undefined') {\n    module.exports = {\n        Range: Range,\n        union: union,\n        intersection: intersection,\n        coverage: coverage,\n        rangeOver: rangeOrder,\n        _rangeOrder: _rangeOrder\n    };\n}\n\n},{}],42:[function(require,module,exports){\n/* -*- mode: javascript; c-basic-offset: 4; indent-tabs-mode: nil -*- */\n\n// \n// Dalliance Genome Explorer\n// (c) Thomas Down 2014\n//\n// style.js\n//\n\n\"use strict\";\n\nfunction StyleFilter(type, method, label) {\n    this.type = type;\n    this.method = method;\n    this.label = label;\n}\n\nStyleFilter.prototype.equals = function (o) {\n    return this.type == o.type && this.method == o.method && this.label == o.label;\n};\n\nStyleFilter.prototype.toString = function () {\n    var fs = [];\n    if (this.type) fs.push('type=' + this.type);\n    if (this.method) fs.push('method=' + this.method);\n    if (this.label) fs.push('label=' + this.label);\n    return 'StyleFilter<' + fs.join(';') + '>';\n};\n\nfunction StyleFilterSet(filters) {\n    this._filters = {};\n    if (filters) {\n        for (var fi = 0; fi < filters.length; ++fi) {\n            this.add(filters[fi]);\n        }\n    }\n}\n\nStyleFilterSet.prototype.add = function (filter) {\n    var fs = filter.toString();\n    if (!this._filters[fs]) {\n        this._filters[fs] = filter;\n        this._list = null;\n    }\n};\n\nStyleFilterSet.prototype.addAll = function (filterSet) {\n    var l = filterSet.list();\n    for (var fi = 0; fi < l.length; ++fi) {\n        this.add(l[fi]);\n    }\n};\n\nStyleFilterSet.prototype.doesNotContain = function (filterSet) {\n    var l = filterSet.list();\n    for (var fi = 0; fi < l.length; ++fi) {\n        if (!this._filters[fi.toString()]) return true;\n    }\n    return false;\n};\n\nStyleFilterSet.prototype.list = function () {\n    if (!this._list) {\n        this._list = [];\n        for (var k in this._filters) {\n            if (this._filters.hasOwnProperty(k)) {\n                this._list.push(this._filters[k]);\n            }\n        }\n    }\n    return this._list;\n};\n\nStyleFilterSet.prototype.typeList = function () {\n    var types = [];\n    var list = this.list();\n    for (var fi = 0; fi < list.length; ++fi) {\n        var filter = list[fi];\n        var type = filter.type;\n        if (!type || type == 'default') return null;\n        if (types.indexOf(type) < 0) types.push(type);\n    }\n    return types;\n};\n\nif (typeof module !== 'undefined') {\n    module.exports = {\n        StyleFilter: StyleFilter,\n        StyleFilterSet: StyleFilterSet\n    };\n}\n\n},{}],43:[function(require,module,exports){\n/* jshint esversion: 6 */\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\nexports.renderTier = renderTier;\nexports.drawTier = drawTier;\n\n/* To be used by tiers which are to be drawn in a multitier\n   using the multi-renderer.\n\n   Subtiers are configured by adding the following to a tier's source configuration:\n       renderer: 'sub',\n       sub: {\n           multi_id: \"multi_1\",\n           offset: 130,\n           z: 2,\n       }\n   This would define a subtier that's to be rendered in the multi-tier with\n   id \"multi_1\", with the top of the subtier at 130 pixels and at z-index 2.\n */\n\nfunction renderTier(status, tier) {\n    drawTier(tier);\n    tier.updateStatus(status);\n}\n\n// drawTier is called when this tier's data has been fetched,\n// so by refreshing the multiTier from here, we can be sure that\n// there's something new worth drawing in it\nfunction drawTier(tier) {\n    var browser = tier.browser;\n\n    var multiTier = browser.tiers.filter(function (t) {\n        return t.dasSource.renderer === 'multi' && t.dasSource.multi.multi_id === tier.dasSource.sub.multi_id;\n    });\n\n    multiTier.forEach(function (t) {\n        return browser.refreshTier(t);\n    });\n}\n\n},{}],44:[function(require,module,exports){\n'use strict';\n\n/* -*- mode: javascript; c-basic-offset: 4; indent-tabs-mode: nil -*- */\n\n// \n// Dalliance Genome Explorer\n// (c) Thomas Down 2006-2013\n//\n// svg-export.js\n//\n\nif (typeof require !== 'undefined') {\n    var browser = require('./cbrowser');\n    var Browser = browser.Browser;\n\n    var utils = require('./utils');\n    var makeElement = utils.makeElement;\n    var makeElementNS = utils.makeElementNS;\n\n    var VERSION = require('./version');\n\n    var svgSeqTier = require('./sequence-draw').svgSeqTier;\n\n    var svgu = require('./svg-utils');\n    var NS_SVG = svgu.NS_SVG;\n    var NS_XLINK = svgu.NS_XLINK;\n    var SVGPath = svgu.SVGPath;\n\n    var nf = require('./numformats');\n    var formatQuantLabel = nf.formatQuantLabel;\n    var formatLongInt = nf.formatLongInt;\n}\n\nBrowser.prototype.makeSVG = function (opts) {\n    opts = opts || {};\n    var minTierHeight = opts.minTierHeight || 20;\n    var padding = 3;\n    var fpw = opts.width || this.featurePanelWidth;\n\n    var backupFPW = this.featurePanelWidth;\n    var backupScale = this.scale;\n    this.featurePanelWidth = fpw;\n    this.scale = this.featurePanelWidth / (this.viewEnd - this.viewStart);\n\n    var b = this;\n    var saveDoc = document.implementation.createDocument(NS_SVG, 'svg', null);\n\n    var saveRoot = makeElementNS(NS_SVG, 'g', null, {\n        fontFamily: 'helvetica',\n        fontSize: '8pt'\n    });\n    saveDoc.documentElement.appendChild(saveRoot);\n\n    var margin = 200;\n\n    if (opts.banner) {\n        var dallianceAnchor = makeElementNS(NS_SVG, 'a', makeElementNS(NS_SVG, 'text', 'Graphics from Biodalliance ' + VERSION, {\n            x: b.featurePanelWidth + margin - 100,\n            y: 35,\n            strokeWidth: 0,\n            fontSize: '12pt',\n            textAnchor: 'end',\n            fill: 'blue'\n        }));\n        dallianceAnchor.setAttribute('xmlns:xlink', NS_XLINK);\n        dallianceAnchor.setAttribute('xlink:href', 'http://www.biodalliance.org/');\n\n        saveRoot.appendChild(dallianceAnchor);\n    }\n\n    if (opts.region) {\n        saveRoot.appendChild(makeElementNS(NS_SVG, 'text', this.chr + ':' + formatLongInt(this.viewStart) + '..' + formatLongInt(this.viewEnd), {\n            x: margin + 100,\n            y: 35,\n            strokeWidth: 0,\n            fontSize: '12pt',\n            textAnchor: 'start'\n        }));\n    }\n\n    var clipRect = makeElementNS(NS_SVG, 'rect', null, {\n        x: margin,\n        y: 50,\n        width: b.featurePanelWidth,\n        height: 100000\n    });\n    var clip = makeElementNS(NS_SVG, 'clipPath', clipRect, { id: 'featureClip' });\n    saveRoot.appendChild(clip);\n\n    var pos = 70;\n    var tierHolder = makeElementNS(NS_SVG, 'g', null, {});\n\n    for (var ti = 0; ti < b.tiers.length; ++ti) {\n        var tier = b.tiers[ti];\n        tier.backupSubtiers = tier.subtiers;\n        tier.backupOriginHaxx = tier.originHaxx;\n        tier.backupLayoutHeight = tier.layoutHeight;\n\n        var renderer = b.getTierRenderer(tier);\n        if (renderer && renderer.prepareSubtiers) {\n            renderer.prepareSubtiers(tier, tier.viewport.getContext('2d'));\n        }\n\n        var tierSVG = makeElementNS(NS_SVG, 'g', null, { clipPath: 'url(#featureClip)', clipRule: 'nonzero' });\n        var tierLabels = makeElementNS(NS_SVG, 'g');\n        var tierTopPos = pos;\n\n        var tierBackground = makeElementNS(NS_SVG, 'rect', null, { x: 0, y: tierTopPos, width: '10000', height: 50, fill: tier.background });\n        tierSVG.appendChild(tierBackground);\n\n        if (tier.sequenceSource) {\n            var seqTrack = svgSeqTier(tier, tier.currentSequence);\n\n            tierSVG.appendChild(makeElementNS(NS_SVG, 'g', seqTrack, { transform: 'translate(' + margin + ', ' + pos + ')' }));\n            pos += 80;\n        } else {\n            if (!tier.subtiers) {\n                continue;\n            }\n\n            var offset = (tier.glyphCacheOrigin - b.viewStart) * b.scale;\n            var hasQuant = false;\n            for (var sti = 0; sti < tier.subtiers.length; ++sti) {\n                pos += padding;\n                var subtier = tier.subtiers[sti];\n\n                var glyphElements = [];\n                for (var gi = 0; gi < subtier.glyphs.length; ++gi) {\n                    var glyph = subtier.glyphs[gi];\n                    glyphElements.push(glyph.toSVG());\n                }\n\n                tierSVG.appendChild(makeElementNS(NS_SVG, 'g', glyphElements, { transform: 'translate(' + (margin + offset) + ', ' + pos + ')' }));\n\n                if (subtier.quant) {\n                    hasQuant = true;\n                    var q = subtier.quant;\n                    var h = subtier.height;\n\n                    var numTics = 2;\n                    if (h > 40) {\n                        numTics = 1 + (h / 20 | 0);\n                    }\n                    var ticSpacing = h / (numTics - 1);\n                    var ticInterval = (q.max - q.min) / (numTics - 1);\n\n                    var path = new SVGPath();\n                    path.moveTo(margin + 5, pos);\n                    path.lineTo(margin, pos);\n                    path.lineTo(margin, pos + subtier.height);\n                    path.lineTo(margin + 5, pos + subtier.height);\n                    for (var t = 1; t < numTics - 1; ++t) {\n                        var ty = t * ticSpacing;\n                        path.moveTo(margin, pos + ty);\n                        path.lineTo(margin + 3, pos + ty);\n                    }\n\n                    tierLabels.appendChild(makeElementNS(NS_SVG, 'path', null, { d: path.toPathData(), fill: 'none', stroke: 'black', strokeWidth: '2px' }));\n                    tierLabels.appendChild(makeElementNS(NS_SVG, 'text', formatQuantLabel(q.max), { x: margin - 3, y: pos + 7, textAnchor: 'end' }));\n                    tierLabels.appendChild(makeElementNS(NS_SVG, 'text', formatQuantLabel(q.min), { x: margin - 3, y: pos + subtier.height, textAnchor: 'end' }));\n                    for (var t = 1; t < numTics - 1; ++t) {\n                        var ty = t * ticSpacing;\n                        tierLabels.appendChild(makeElementNS(NS_SVG, 'text', formatQuantLabel(1.0 * q.max - t * ticInterval), { x: margin - 3, y: pos + ty + 3, textAnchor: 'end' }));\n                    }\n                }\n\n                pos += subtier.height + padding;\n            }\n\n            if (pos - tierTopPos < minTierHeight) {\n                pos = tierTopPos + minTierHeight;\n            }\n        }\n\n        var labelName;\n        if (typeof tier.config.name === 'string') labelName = tier.config.name;else labelName = tier.dasSource.name;\n        tierLabels.appendChild(makeElementNS(NS_SVG, 'text', labelName, { x: margin - (hasQuant ? 20 : 12), y: (pos + tierTopPos + 8) / 2, fontSize: '10pt', textAnchor: 'end' }));\n\n        tierBackground.setAttribute('height', pos - tierTopPos);\n        tierHolder.appendChild(makeElementNS(NS_SVG, 'g', [tierSVG, tierLabels]));\n\n        tier.subtiers = tier.backupSubtiers;\n        tier.originHaxx = tier.backupOriginHaxx;\n        tier.layoutHeight = tier.backupLayoutHeight;\n    }\n\n    if (opts.highlights) {\n        var highlights = this.highlights || [];\n        for (var hi = 0; hi < highlights.length; ++hi) {\n            var h = highlights[hi];\n            if ((h.chr == this.chr || h.chr == 'chr' + this.chr) && h.min < this.viewEnd && h.max > this.viewStart) {\n                var tmin = (Math.max(h.min, this.viewStart) - this.viewStart) * this.scale;\n                var tmax = (Math.min(h.max, this.viewEnd) - this.viewStart) * this.scale;\n\n                tierHolder.appendChild(makeElementNS(NS_SVG, 'rect', null, { x: margin + tmin, y: 70, width: tmax - tmin, height: pos - 70,\n                    stroke: 'none', fill: this.defaultHighlightFill, fillOpacity: this.defaultHighlightAlpha }));\n            }\n        }\n    }\n\n    var rulerPos = -1;\n    if (opts.ruler == 'center') {\n        rulerPos = margin + (this.viewEnd - this.viewStart) * this.scale / 2;\n    } else if (opts.ruler == 'left') {\n        rulerPos = margin;\n    } else if (opts.ruler == 'right') {\n        rulerPos = margin + (this.viewEnd - this.viewStart) * this.scale;\n    }\n    if (rulerPos >= 0) {\n        tierHolder.appendChild(makeElementNS(NS_SVG, 'line', null, { x1: rulerPos, y1: 70, x2: rulerPos, y2: pos,\n            stroke: 'blue' }));\n    }\n\n    saveRoot.appendChild(tierHolder);\n    saveDoc.documentElement.setAttribute('width', b.featurePanelWidth + 20 + margin);\n    saveDoc.documentElement.setAttribute('height', pos + 50);\n\n    this.featurePanelWidth = backupFPW;\n    this.scale = backupScale;\n\n    var svg = void 0;\n    if (typeof XMLSerializer !== 'undefined') {\n        svg = new XMLSerializer().serializeToString(saveDoc);\n    } else {\n        var root = saveDoc.documentElement;\n        root.setAttribute('xmlns', 'http://www.w3.org/2000/svg');\n        svg = root.outerHTML;\n    }\n\n    if (opts.output && opts.output === 'string') {\n        return svg;\n    } else {\n        return new Blob([svg], { type: 'image/svg+xml' });\n    }\n};\n\n},{\"./cbrowser\":6,\"./numformats\":30,\"./sequence-draw\":36,\"./svg-utils\":45,\"./utils\":56,\"./version\":58}],45:[function(require,module,exports){\n'use strict';\n\n/* -*- mode: javascript; c-basic-offset: 4; indent-tabs-mode: nil -*- */\n\n// \n// Dalliance Genome Explorer\n// (c) Thomas Down 2006-2014\n//\n// svg-utils.js\n//\n\nvar NS_SVG = 'http://www.w3.org/2000/svg';\nvar NS_XLINK = 'http://www.w3.org/1999/xlink';\n\nfunction SVGPath() {\n    this.ops = [];\n}\n\nSVGPath.prototype.moveTo = function (x, y) {\n    this.ops.push('M ' + x + ' ' + y);\n};\n\nSVGPath.prototype.lineTo = function (x, y) {\n    this.ops.push('L ' + x + ' ' + y);\n};\n\nSVGPath.prototype.closePath = function () {\n    this.ops.push('Z');\n};\n\nSVGPath.prototype.toPathData = function () {\n    return this.ops.join(' ');\n};\n\nif (typeof module !== 'undefined') {\n    module.exports = {\n        NS_SVG: NS_SVG,\n        NS_XLINK: NS_XLINK,\n        SVGPath: SVGPath\n    };\n}\n\n},{}],46:[function(require,module,exports){\n/* -*- mode: javascript; c-basic-offset: 4; indent-tabs-mode: nil -*- */\n\n// \n// Dalliance Genome Explorer\n// (c) Thomas Down 2006-2013\n//\n// tabix-source.js\n//\n\n\"use strict\";\n\nif (typeof require !== 'undefined') {\n    var sa = require('./sourceadapters');\n    var dalliance_registerSourceAdapterFactory = sa.registerSourceAdapterFactory;\n    var dalliance_makeParser = sa.makeParser;\n    var FeatureSourceBase = sa.FeatureSourceBase;\n\n    var bin = require('./bin');\n    var URLFetchable = bin.URLFetchable;\n    var BlobFetchable = bin.BlobFetchable;\n\n    var utils = require('./utils');\n    var Awaited = utils.Awaited;\n\n    var connectTabix = require('./tabix').connectTabix;\n}\n\nfunction TabixFeatureSource(source) {\n    FeatureSourceBase.call(this);\n    this.readiness = 'Connecting';\n    this.source = source;\n\n    this.tabixHolder = new Awaited();\n    var thisB = this;\n\n    var parser = dalliance_makeParser(source.payload);\n    if (!parser) {\n        throw 'Unsuported tabix payload ' + source.payload;\n    } else {\n        this.parser = parser;\n    }\n\n    var data, index;\n    if (this.source.blob) {\n        data = new BlobFetchable(this.source.blob);\n        index = new BlobFetchable(this.source.indexBlob);\n    } else {\n        data = new URLFetchable(this.source.uri, { credentials: this.source.credentials, resolver: this.source.resolver });\n        index = new URLFetchable(this.source.indexURI || this.source.uri + '.tbi', { credentials: this.source.credentials, resolver: this.source.resolver });\n    }\n    connectTabix(data, index, function (tabix, err) {\n        thisB.tabixHolder.provide(tabix);\n        tabix.fetchHeader(function (lines, err) {\n            if (lines) {\n                var session = parser.createSession(function () {/* Null sink because we shouldn't get records */});\n                for (var li = 0; li < lines.length; ++li) {\n                    session.parse(lines[li]);\n                }\n                session.flush();\n            }\n        });\n        thisB.readiness = null;\n        thisB.notifyReadiness();\n    });\n}\n\nTabixFeatureSource.prototype = Object.create(FeatureSourceBase.prototype);\n\nTabixFeatureSource.prototype.fetch = function (chr, min, max, scale, types, pool, callback) {\n    var thisB = this;\n\n    thisB.busy++;\n    thisB.notifyActivity();\n\n    this.tabixHolder.await(function (tabix) {\n        tabix.fetch(chr, min, max, function (records, error) {\n            thisB.busy--;\n            thisB.notifyActivity();\n\n            var features = [];\n            var session = thisB.parser.createSession(function (f) {\n                features.push(f);\n            });\n            for (var ri = 0; ri < records.length; ++ri) {\n                var f = session.parse(records[ri]);\n            }\n            session.flush();\n            callback(null, features, 1000000000);\n        });\n    });\n};\n\nTabixFeatureSource.prototype.getStyleSheet = function (callback) {\n    if (this.parser && this.parser.getStyleSheet) this.parser.getStyleSheet(callback);\n};\n\nTabixFeatureSource.prototype.getDefaultFIPs = function (callback) {\n    if (this.parser && this.parser.getDefaultFIPs) this.parser.getDefaultFIPs(callback);\n};\n\ndalliance_registerSourceAdapterFactory('tabix', function (source) {\n    return { features: new TabixFeatureSource(source) };\n});\n\n},{\"./bin\":4,\"./sourceadapters\":39,\"./tabix\":47,\"./utils\":56}],47:[function(require,module,exports){\n/* -*- mode: javascript; c-basic-offset: 4; indent-tabs-mode: nil -*- */\n\n// \n// Dalliance Genome Explorer\n// (c) Thomas Down 2006-2011\n//\n// tabix.js: basic support for tabix-indexed flatfiles\n//\n\n\"use strict\";\n\nvar TABIX_MAGIC = 0x01494254;\n\nif (typeof require !== 'undefined') {\n    var spans = require('./spans');\n    var Range = spans.Range;\n    var union = spans.union;\n    var intersection = spans.intersection;\n\n    var bin = require('./bin');\n    var readInt = bin.readInt;\n    var readShort = bin.readShort;\n    var readByte = bin.readByte;\n    var readInt64 = bin.readInt64;\n    var readFloat = bin.readFloat;\n\n    var lh3utils = require('./lh3utils');\n    var readVob = lh3utils.readVob;\n    var unbgzf = lh3utils.unbgzf;\n    var reg2bins = lh3utils.reg2bins;\n    var Chunk = lh3utils.Chunk;\n}\n\nfunction TabixFile() {}\n\nfunction connectTabix(data, tbi, callback) {\n    var tabix = new TabixFile();\n    tabix.data = data;\n    tabix.tbi = tbi;\n\n    tabix.tbi.fetch(function (header) {\n        // Do we really need to fetch the whole thing? :-(\n        if (!header) {\n            return callback(null, \"Couldn't access Tabix\");\n        }\n\n        var unchead = unbgzf(header, header.byteLength);\n        var uncba = new Uint8Array(unchead);\n        var magic = readInt(uncba, 0);\n        if (magic != TABIX_MAGIC) {\n            return callback(null, 'Not a tabix index');\n        }\n\n        var nref = readInt(uncba, 4);\n        tabix.format = readInt(uncba, 8);\n        tabix.colSeq = readInt(uncba, 12);\n        tabix.colStart = readInt(uncba, 16);\n        tabix.colEnd = readInt(uncba, 20);\n        tabix.meta = readInt(uncba, 24);\n        tabix.skip = readInt(uncba, 28);\n        var nameLength = readInt(uncba, 32);\n\n        tabix.indices = [];\n\n        var p = 36;\n        tabix.chrToIndex = {};\n        tabix.indexToChr = [];\n        for (var i = 0; i < nref; ++i) {\n            var name = '';\n\n            while (true) {\n                var ch = uncba[p++];\n                if (ch == 0) break;\n\n                name += String.fromCharCode(ch);\n            }\n\n            tabix.chrToIndex[name] = i;\n            if (name.indexOf('chr') == 0) {\n                tabix.chrToIndex[name.substring(3)] = i;\n            } else {\n                tabix.chrToIndex['chr' + name] = i;\n            }\n            tabix.indexToChr.push(name);\n        }\n\n        var minBlockIndex = 1000000000;\n        for (var ref = 0; ref < nref; ++ref) {\n            var blockStart = p;\n            var nbin = readInt(uncba, p);p += 4;\n            for (var b = 0; b < nbin; ++b) {\n                var bin = readInt(uncba, p);\n                var nchnk = readInt(uncba, p + 4);\n                p += 8 + nchnk * 16;\n            }\n            var nintv = readInt(uncba, p);p += 4;\n\n            var q = p;\n            for (var i = 0; i < nintv; ++i) {\n                var v = readVob(uncba, q);q += 8;\n                if (v) {\n                    var bi = v.block;\n                    if (v.offset > 0) bi += 65536;\n\n                    if (bi < minBlockIndex) minBlockIndex = bi;\n                    break;\n                }\n            }\n            p += nintv * 8;\n\n            var ub = uncba;\n            if (nbin > 0) {\n                tabix.indices[ref] = new Uint8Array(unchead, blockStart, p - blockStart);\n            }\n        }\n\n        tabix.headerMax = minBlockIndex;\n\n        callback(tabix);\n    }, { timeout: 50000 });\n}\n\n// Copy-paste from BamFile\n\nTabixFile.prototype.blocksForRange = function (refId, min, max) {\n    var index = this.indices[refId];\n    if (!index) {\n        return [];\n    }\n\n    var intBinsL = reg2bins(min, max);\n    var intBins = [];\n    for (var i = 0; i < intBinsL.length; ++i) {\n        intBins[intBinsL[i]] = true;\n    }\n    var leafChunks = [],\n        otherChunks = [];\n\n    var nbin = readInt(index, 0);\n    var p = 4;\n    for (var b = 0; b < nbin; ++b) {\n        var bin = readInt(index, p);\n        var nchnk = readInt(index, p + 4);\n        p += 8;\n        if (intBins[bin]) {\n            for (var c = 0; c < nchnk; ++c) {\n                var cs = readVob(index, p, true);\n                var ce = readVob(index, p + 8, true);\n                (bin < 4681 ? otherChunks : leafChunks).push(new Chunk(cs, ce));\n                p += 16;\n            }\n        } else {\n            p += nchnk * 16;\n        }\n    }\n\n    var nintv = readInt(index, p);\n    var lowest = null;\n    var minLin = Math.min(min >> 14, nintv - 1),\n        maxLin = Math.min(max >> 14, nintv - 1);\n    for (var i = minLin; i <= maxLin; ++i) {\n        var lb = readVob(index, p + 4 + i * 8);\n        if (!lb) {\n            continue;\n        }\n        if (!lowest || lb.block < lowest.block || lb.offset < lowest.offset) {\n            lowest = lb;\n        }\n    }\n\n    var prunedOtherChunks = [];\n    if (lowest != null) {\n        for (var i = 0; i < otherChunks.length; ++i) {\n            var chnk = otherChunks[i];\n            if (chnk.maxv.block >= lowest.block && chnk.maxv.offset >= lowest.offset) {\n                prunedOtherChunks.push(chnk);\n            }\n        }\n    }\n    otherChunks = prunedOtherChunks;\n\n    var intChunks = [];\n    for (var i = 0; i < otherChunks.length; ++i) {\n        intChunks.push(otherChunks[i]);\n    }\n    for (var i = 0; i < leafChunks.length; ++i) {\n        intChunks.push(leafChunks[i]);\n    }\n\n    intChunks.sort(function (c0, c1) {\n        var dif = c0.minv.block - c1.minv.block;\n        if (dif != 0) {\n            return dif;\n        } else {\n            return c0.minv.offset - c1.minv.offset;\n        }\n    });\n    var mergedChunks = [];\n    if (intChunks.length > 0) {\n        var cur = intChunks[0];\n        for (var i = 1; i < intChunks.length; ++i) {\n            var nc = intChunks[i];\n            if (nc.minv.block == cur.maxv.block /* && nc.minv.offset == cur.maxv.offset */) {\n                    // no point splitting mid-block\n                    cur = new Chunk(cur.minv, nc.maxv);\n                } else {\n                mergedChunks.push(cur);\n                cur = nc;\n            }\n        }\n        mergedChunks.push(cur);\n    }\n\n    return mergedChunks;\n};\n\nTabixFile.prototype.fetch = function (chr, min, max, callback) {\n    var thisB = this;\n\n    var chrId = this.chrToIndex[chr];\n    if (chrId == undefined) return callback([]);\n\n    var canonicalChr = this.indexToChr[chrId];\n\n    var chunks;\n    if (chrId === undefined) {\n        chunks = [];\n    } else {\n        chunks = this.blocksForRange(chrId, min, max);\n        if (!chunks) {\n            callback(null, 'Error in index fetch');\n        }\n    }\n\n    var records = [];\n    var index = 0;\n    var data;\n\n    function tramp() {\n        if (index >= chunks.length) {\n            return callback(records);\n        } else if (!data) {\n            var c = chunks[index];\n            var fetchMin = c.minv.block;\n            var fetchMax = c.maxv.block + (1 << 16); // *sigh*\n            thisB.data.slice(fetchMin, fetchMax - fetchMin).fetch(function (r) {\n                data = unbgzf(r, c.maxv.block - c.minv.block + 1);\n                return tramp();\n            });\n        } else {\n            var ba = new Uint8Array(data);\n            thisB.readRecords(ba, chunks[index].minv.offset, records, min, max, canonicalChr);\n            data = null;\n            ++index;\n            return tramp();\n        }\n    }\n    tramp();\n};\n\nTabixFile.prototype.readRecords = function (ba, offset, sink, min, max, chr) {\n    LINE_LOOP: while (true) {\n        var line = '';\n        while (offset < ba.length) {\n            var ch = ba[offset++];\n            if (ch == 10) {\n                var toks = line.split('\\t');\n\n                if (toks[this.colSeq - 1] == chr) {\n                    var fmin = parseInt(toks[this.colStart - 1]);\n                    var fmax = fmin;\n                    if (this.colEnd > 0) fmax = parseInt(toks[this.colEnd - 1]);\n                    if (this.format & 0x10000) ++fmin;\n\n                    if (fmin <= max && fmax >= min) sink.push(line);\n                }\n                continue LINE_LOOP;\n            } else {\n                line += String.fromCharCode(ch);\n            }\n        }\n        return;\n    }\n};\n\nTabixFile.prototype.fetchHeader = function (callback) {\n    var self = this;\n    var fetchPtr = 0,\n        ptr = 0,\n        line = '';\n    var lines = [];\n\n    self.data.slice(0, self.headerMax).fetch(function (chnk) {\n        if (!chnk) {\n            return callback(null, \"Fetch failed\");\n        }\n        var ba = new Uint8Array(unbgzf(chnk, chnk.byteLength));\n        var ptr = 0,\n            line = '',\n            lines = [];\n        while (ptr < ba.length) {\n            var ch = ba[ptr++];\n            if (ch == 10) {\n                if (line.charCodeAt(0) == self.meta) {\n                    lines.push(line);\n                    line = '';\n                } else {\n                    return callback(lines);\n                }\n            } else {\n                line += String.fromCharCode(ch);\n            }\n        }\n        callback(lines);\n    });\n};\n\nif (typeof module !== 'undefined') {\n    module.exports = {\n        connectTabix: connectTabix,\n        TABIX_MAGIC: TABIX_MAGIC\n    };\n}\n\n},{\"./bin\":4,\"./lh3utils\":27,\"./spans\":41}],48:[function(require,module,exports){\n\"use strict\";\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _sourceadapters = require(\"./sourceadapters.js\");\n\nvar _das = require(\"./das.js\");\n\nvar _ramda = require(\"ramda\");\n\nvar R = _interopRequireWildcard(_ramda);\n\nfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; } /* jshint esversion: 6 */\n\n/*\n Source that can be configured to produce any type of feature,\n useful for testing renderers.\n */\n\nvar TestSource = function (_FeatureSourceBase) {\n    _inherits(TestSource, _FeatureSourceBase);\n\n    function TestSource(source) {\n        _classCallCheck(this, TestSource);\n\n        var _this = _possibleConstructorReturn(this, (TestSource.__proto__ || Object.getPrototypeOf(TestSource)).call(this));\n\n        _this.features = R.defaultTo([], source.features);\n        return _this;\n    }\n\n    _createClass(TestSource, [{\n        key: \"genFeature\",\n        value: function genFeature(conf) {\n            var feature = new _das.DASFeature();\n\n            for (var key in conf) {\n                feature[key] = conf[key];\n            }\n        }\n    }, {\n        key: \"fetch\",\n        value: function fetch(chr, min, max, scale, types, pool, callback) {\n            var features = R.forEach(this.genFeature, this.features);\n            return callback(null, features, 1);\n        }\n    }]);\n\n    return TestSource;\n}(_sourceadapters.FeatureSourceBase);\n\n(0, _sourceadapters.registerSourceAdapterFactory)('test-source', function (source) {\n    return { features: new TestSource(source) };\n});\n\n},{\"./das.js\":11,\"./sourceadapters.js\":39,\"ramda\":73}],49:[function(require,module,exports){\n/* -*- mode: javascript; c-basic-offset: 4; indent-tabs-mode: nil -*- */\n\n// \n// Dalliance Genome Explorer\n// (c) Thomas Down 2006-2013\n//\n// thub.js: support for track-hub style registries\n//\n\n\"use strict\";\n\nif (typeof require !== 'undefined') {\n    var utils = require('./utils');\n    var textXHR = utils.textXHR;\n    var relativeURL = utils.relativeURL;\n    var shallowCopy = utils.shallowCopy;\n\n    var das = require('./das');\n    var DASStylesheet = das.DASStylesheet;\n    var DASStyle = das.DASStyle;\n}\n\nvar THUB_STANZA_REGEXP = /\\n\\s*\\n/;\nvar THUB_PARSE_REGEXP = /(\\w+) +(.+)\\n?/;\nvar THUB_SUBGROUP_REGEXP = /subGroup[1-9]/;\n\nvar THUB_PENNANT_PREFIX = 'http://genome.ucsc.edu/images/';\n\nfunction TrackHub(url) {\n    this.genomes = {};\n    this.url = url;\n}\n\nfunction TrackHubTrack() {}\n\nTrackHubTrack.prototype.get = function (k) {\n    if (this[k]) return this[k];else if (this._parent) return this._parent.get(k);\n};\n\nfunction TrackHubDB(hub) {\n    this.hub = hub;\n}\n\nTrackHubDB.prototype.getTracks = function (callback) {\n    var thisB = this;\n    if (this._tracks) {\n        return callback(this._tracks);\n    }\n\n    textXHR(this.absURL, function (trackFile, err) {\n        if (err) {\n            return callback(null, err);\n        }\n\n        // trackFile = trackFile.replace(/\\#.*/g, '');\n        trackFile = trackFile.replace('\\\\\\n', ' ');\n\n        var tracks = [];\n        var tracksById = {};\n        var stanzas = trackFile.split(THUB_STANZA_REGEXP);\n        for (var s = 0; s < stanzas.length; ++s) {\n            var toks = stanzas[s].replace(/\\#.*/g, '').split(THUB_PARSE_REGEXP);\n            var track = new TrackHubTrack();\n            track._db = thisB;\n            for (var l = 0; l < toks.length - 2; l += 3) {\n                var k = toks[l + 1],\n                    v = toks[l + 2];\n                if (k.match(THUB_SUBGROUP_REGEXP)) {\n                    if (!track.subgroups) track.subgroups = {};\n                    var sgtoks = v.split(/\\s/);\n                    var sgtag = sgtoks[0];\n                    var sgrecord = { name: sgtoks[1], tags: [], titles: [] };\n                    for (var sgti = 2; sgti < sgtoks.length; ++sgti) {\n                        var grp = sgtoks[sgti].split(/=/);\n                        sgrecord.tags.push(grp[0]);\n                        sgrecord.titles.push(grp[1]);\n                    }\n                    track.subgroups[sgtag] = sgrecord;\n                } else if (k === 'subGroups') {\n                    var sgtoks = v.split(/(\\w+)=(\\w+)/);\n                    track.sgm = {};\n                    for (var sgti = 0; sgti < sgtoks.length - 2; sgti += 3) {\n                        track.sgm[sgtoks[sgti + 1]] = sgtoks[sgti + 2];\n                    }\n                } else {\n                    track[toks[l + 1]] = toks[l + 2];\n                }\n            }\n\n            if (track.track && (track.type || track.container || track.view || track.bigDataUrl)) {\n                tracks.push(track);\n                tracksById[track.track] = track;\n            } else {\n                // console.log('skipping ', track);\n            }\n        }\n\n        var toplevels = [];\n        var composites = [];\n        for (var ti = 0; ti < tracks.length; ++ti) {\n            var track = tracks[ti];\n            var top = true;\n            if (track.parent) {\n                var ptoks = track.parent.split(/\\s+/);\n                var parent = tracksById[ptoks[0]];\n                if (parent) {\n                    track._parent = parent;\n\n                    if (!parent.children) parent.children = [];\n                    parent.children.push(track);\n\n                    if (parent) top = false;\n                } else {\n                    console.log(\"Couldn't find parent \" + ptoks[0] + '(' + track.parent + ')');\n                }\n            }\n            if (track.compositeTrack) {\n                composites.push(track);\n            } else if (top) {\n                toplevels.push(track);\n            }\n        }\n\n        for (var ci = 0; ci < composites.length; ++ci) {\n            var comp = composites[ci];\n            if (!comp.children) continue;\n\n            var parentOfViews = false;\n            for (var ki = 0; ki < comp.children.length; ++ki) {\n                var k = comp.children[ki];\n                if (k.view) {\n                    k.shortLabel = comp.shortLabel + \": \" + k.shortLabel;\n                    toplevels.push(k);\n                    parentOfViews = true;\n                }\n            }\n            if (!parentOfViews) toplevels.push(comp);\n        }\n\n        thisB._tracks = toplevels;\n        return callback(thisB._tracks, null);\n    }, { credentials: this.credentials, salt: true });\n};\n\nfunction connectTrackHub(hubURL, callback, opts) {\n    opts = opts || {};\n    opts.salt = true;\n\n    textXHR(hubURL, function (hubFile, err) {\n        if (err) {\n            return callback(null, err);\n        }\n\n        var toks = hubFile.split(THUB_PARSE_REGEXP);\n        var hub = new TrackHub(hubURL);\n        if (opts.credentials) {\n            hub.credentials = opts.credentials;\n        }\n        for (var l = 0; l < toks.length - 2; l += 3) {\n            hub[toks[l + 1]] = toks[l + 2];\n        }\n\n        if (hub.genomesFile) {\n            var genURL = relativeURL(hubURL, hub.genomesFile);\n            textXHR(genURL, function (genFile, err) {\n                if (err) {\n                    return callback(null, err);\n                }\n\n                var stanzas = genFile.split(THUB_STANZA_REGEXP);\n                for (var s = 0; s < stanzas.length; ++s) {\n                    var toks = stanzas[s].split(THUB_PARSE_REGEXP);\n                    var gprops = new TrackHubDB(hub);\n                    if (opts.credentials) {\n                        gprops.credentials = opts.credentials;\n                    }\n\n                    for (var l = 0; l < toks.length - 2; l += 3) {\n                        gprops[toks[l + 1]] = toks[l + 2];\n                    }\n\n                    if (gprops.twoBitPath) {\n                        gprops.twoBitPath = relativeURL(genURL, gprops.twoBitPath);\n                    }\n\n                    if (gprops.genome && gprops.trackDb) {\n                        gprops.absURL = relativeURL(genURL, gprops.trackDb);\n                        hub.genomes[gprops.genome] = gprops;\n                    }\n                }\n\n                callback(hub);\n            }, opts);\n        } else {\n            callback(null, 'No genomesFile');\n        }\n    }, opts);\n}\n\nTrackHubTrack.prototype.toDallianceSource = function () {\n    var source = {\n        name: this.shortLabel,\n        desc: this.longLabel\n    };\n    if (this._db.mapping) {\n        source.mapping = this._db.mapping;\n    }\n\n    var pennantIcon = this.get('pennantIcon');\n    if (pennantIcon) {\n        var ptoks = pennantIcon.split(/\\s+/);\n        source.pennant = THUB_PENNANT_PREFIX + ptoks[0];\n    }\n\n    var searchTrix = this.get('searchTrix');\n    if (searchTrix) {\n        source.trixURI = relativeURL(this._db.absURL, searchTrix);\n    }\n\n    if (this.container == 'multiWig') {\n        source.merge = 'concat';\n        source.overlay = [];\n        var children = this.children || [];\n        source.style = [];\n        source.noDownsample = true;\n\n        for (var ci = 0; ci < children.length; ++ci) {\n            var ch = children[ci];\n            var cs = ch.toDallianceSource();\n            source.overlay.push(cs);\n\n            if (cs.style) {\n                for (var si = 0; si < cs.style.length; ++si) {\n                    var style = cs.style[si];\n                    style.method = ch.shortLabel; // FIXME\n                    if (this.aggregate == 'transparentOverlay') style.style.ALPHA = 0.5;\n                    source.style.push(style);\n                }\n            }\n        }\n        return source;\n    } else {\n        var type = this.type;\n        if (!type) {\n            var p = this;\n            while (p._parent && !p.type) {\n                p = p._parent;\n            }\n            type = p.type;\n        }\n        if (!type) return;\n        var typeToks = type.split(/\\s+/);\n        if (typeToks[0] == 'bigBed' && this.bigDataUrl) {\n            var bedTokens = typeToks[1] | 0;\n            var bedPlus = typeToks[2] == '+';\n\n            source.bwgURI = relativeURL(this._db.absURL, this.bigDataUrl);\n            source.style = this.bigbedStyles();\n            if (this._db.credentials) {\n                source.credentials = true;\n            }\n            if (bedTokens >= 12 && bedPlus) source.collapseSuperGroups = true;\n            return source;\n        } else if (typeToks[0] == 'bigWig' && this.bigDataUrl) {\n            source.bwgURI = relativeURL(this._db.absURL, this.bigDataUrl);\n            source.style = this.bigwigStyles();\n            source.noDownsample = true; // FIXME seems like a blunt instrument...\n\n            if (this.yLineOnOff && this.yLineOnOff == 'on') {\n                source.quantLeapThreshold = this.yLineMark !== undefined ? 1.0 * this.yLineMark : 0.0;\n            }\n\n            if (this._db.credentials) {\n                source.credentials = true;\n            }\n\n            return source;\n        } else if (typeToks[0] == 'bam' && this.bigDataUrl) {\n            source.bamURI = relativeURL(this._db.absURL, this.bigDataUrl);\n            if (this._db.credentials) {\n                source.credentials = true;\n            }\n            return source;\n        } else if (typeToks[0] == 'cram' && this.bigDataUrl) {\n            source.cramURI = relativeURL(this._db.absURL, this.bigDataUrl);\n            if (this._db.credentials) {\n                source.credentials = true;\n            }\n            return source;\n        } else if (typeToks[0] == 'vcfTabix' && this.bigDataUrl) {\n            source.uri = relativeURL(this._db.absURL, this.bigDataUrl);\n            source.tier_type = 'tabix';\n            source.payload = 'vcf';\n            if (this._db.credentials) {\n                source.credentials = true;\n            }\n            return source;\n        } else {\n            console.log('Unsupported ' + this.type);\n        }\n    }\n};\n\nTrackHubTrack.prototype.bigwigStyles = function () {\n    var type = this.type;\n    if (!type) {\n        var p = this;\n        while (p._parent && !p.type) {\n            p = p._parent;\n        }\n        type = p.type;\n    }\n    if (!type) return;\n    var typeToks = type.split(/\\s+/);\n\n    var min, max;\n    if (typeToks.length >= 3) {\n        min = 1.0 * typeToks[1];\n        max = 1.0 * typeToks[2];\n    }\n\n    var height;\n    if (this.maxHeightPixels) {\n        var mhpToks = this.maxHeightPixels.split(/:/);\n        if (mhpToks.length == 3) {\n            height = mhpToks[1] | 0;\n        } else {\n            console.log('maxHeightPixels should be of the form max:default:min');\n        }\n    }\n\n    var gtype = 'bars';\n    if (this.graphTypeDefault) {\n        gtype = this.graphTypeDefault;\n    }\n\n    var color = 'black';\n    var altColor = null;\n    if (this.color) {\n        color = 'rgb(' + this.color + ')';\n    }\n    if (this.altColor) {\n        altColor = 'rgb(' + this.altColor + ')';\n    }\n\n    var stylesheet = new DASStylesheet();\n    var wigStyle = new DASStyle();\n    if (gtype == 'points') {\n        wigStyle.glyph = 'POINT';\n    } else {\n        wigStyle.glyph = 'HISTOGRAM';\n    }\n\n    if (altColor) {\n        wigStyle.COLOR1 = color;\n        wigStyle.COLOR2 = altColor;\n    } else {\n        wigStyle.BGCOLOR = color;\n    }\n    wigStyle.HEIGHT = height || 30;\n    if (min || max) {\n        wigStyle.MIN = min;\n        wigStyle.MAX = max;\n    }\n    stylesheet.pushStyle({ type: 'default' }, null, wigStyle);\n    return stylesheet.styles;\n};\n\nTrackHubTrack.prototype.bigbedStyles = function () {\n    var itemRgb = ('' + this.get('itemRgb')).toLowerCase() == 'on';\n    var visibility = this.get('visibility') || 'full';\n    var color = this.get('color');\n    if (color) color = 'rgb(' + color + ')';else color = 'blue';\n\n    var stylesheet = new DASStylesheet();\n    var wigStyle = new DASStyle();\n    wigStyle.glyph = 'BOX';\n    wigStyle.FGCOLOR = 'black';\n    wigStyle.BGCOLOR = color;\n    wigStyle.HEIGHT = visibility == 'full' || visibility == 'pack' ? 12 : 8;\n    wigStyle.BUMP = visibility == 'full' || visibility == 'pack';\n    wigStyle.LABEL = visibility == 'full' || visibility == 'pack';\n    wigStyle.ZINDEX = 20;\n    if (itemRgb) wigStyle.BGITEM = true;\n\n    var cbs = this.get('colorByStrand');\n    if (cbs) {\n        var cbsToks = cbs.split(/\\s+/);\n\n        var plus = shallowCopy(wigStyle);\n        plus.BGCOLOR = 'rgb(' + cbsToks[0] + ')';\n        stylesheet.pushStyle({ type: 'bigbed', orientation: '+' }, null, plus);\n\n        var minus = shallowCopy(wigStyle);\n        minus.BGCOLOR = 'rgb(' + cbsToks[1] + ')';\n        stylesheet.pushStyle({ type: 'bigbed', orientation: '-' }, null, minus);\n    } else {\n        stylesheet.pushStyle({ type: 'bigbed' }, null, wigStyle);\n    }\n\n    var tlStyle = new DASStyle();\n    tlStyle.glyph = 'BOX';\n    tlStyle.FGCOLOR = 'black';\n    if (itemRgb) tlStyle.BGITEM = true;\n    tlStyle.BGCOLOR = 'red';\n    tlStyle.HEIGHT = 10;\n    tlStyle.BUMP = true;\n    tlStyle.ZINDEX = 20;\n    stylesheet.pushStyle({ type: 'translation' }, null, tlStyle);\n\n    var tsStyle = new DASStyle();\n    tsStyle.glyph = 'BOX';\n    tsStyle.FGCOLOR = 'black';\n    tsStyle.BGCOLOR = 'white';\n    tsStyle.HEIGHT = 10;\n    tsStyle.ZINDEX = 10;\n    tsStyle.BUMP = true;\n    tsStyle.LABEL = true;\n    stylesheet.pushStyle({ type: 'transcript' }, null, tsStyle);\n\n    return stylesheet.styles;\n};\n\nfunction THUB_COMPARE(g, h) {\n    if (g.priority && h.priority) {\n        return 1.0 * g.priority - 1.0 * h.priority;\n    } else if (g.priority) {\n        return 1;\n    } else if (h.priority) {\n        return -1;\n    } else {\n        return g.shortLabel.localeCompare(h.shortLabel);\n    }\n}\n\nif (typeof module !== 'undefined') {\n    module.exports = {\n        connectTrackHub: connectTrackHub,\n        THUB_COMPARE: THUB_COMPARE\n    };\n}\n\n},{\"./das\":11,\"./utils\":56}],50:[function(require,module,exports){\n/* -*- mode: javascript; c-basic-offset: 4; indent-tabs-mode: nil -*- */\n\n// \n// Dalliance Genome Explorer\n// (c) Thomas Down 2006-2013\n//\n// tier-actions.js\n//\n\n\"use strict\";\n\nif (typeof require !== 'undefined') {\n    var browser = require('./cbrowser');\n    var Browser = browser.Browser;\n\n    var utils = require('./utils');\n    var shallowCopy = utils.shallowCopy;\n}\n\nBrowser.prototype.mergeSelectedTiers = function () {\n    var sources = [];\n    var styles = [];\n\n    for (var sti = 0; sti < this.selectedTiers.length; ++sti) {\n        var tier = this.tiers[this.selectedTiers[sti]];\n        sources.push(shallowCopy(tier.dasSource));\n        var ss = tier.stylesheet.styles;\n        for (var si = 0; si < ss.length; ++si) {\n            var sh = ss[si];\n            var nsh = shallowCopy(sh);\n            nsh.method = tier.dasSource.name.replace(/[()+*?]/g, '\\\\$&');\n            nsh._methodRE = null;\n            nsh.style = shallowCopy(sh.style);\n            if (nsh.style.ZINDEX === undefined) nsh.style.ZINDEX = sti;\n\n            if (tier.forceMin) {\n                nsh.style.MIN = tier.forceMin;\n            }\n            if (tier.forceMax) {\n                nsh.style.MAX = tier.forceMax;\n            }\n\n            styles.push(nsh);\n        }\n    }\n\n    this.addTier({ name: 'Merged',\n        merge: 'concat',\n        overlay: sources,\n        noDownsample: true,\n        style: styles });\n\n    this.setSelectedTier(this.tiers.length - 1);\n};\n\n},{\"./cbrowser\":6,\"./utils\":56}],51:[function(require,module,exports){\n/* -*- mode: javascript; c-basic-offset: 4; indent-tabs-mode: nil -*- */\n\n// \n// Dalliance Genome Explorer\n// (c) Thomas Down 2006-2013\n//\n// tier-edit.js\n//\n\n\"use strict\";\n\nif (typeof require !== 'undefined') {\n    var browser = require('./cbrowser');\n    var Browser = browser.Browser;\n\n    var utils = require('./utils');\n    var makeElement = utils.makeElement;\n\n    var das = require('./das');\n    var isDasBooleanTrue = das.isDasBooleanTrue;\n    var isDasBooleanNotFalse = das.isDasBooleanNotFalse;\n    var copyStylesheet = das.copyStylesheet;\n\n    var color = require('./color');\n    var dasColourForName = color.dasColourForName;\n\n    var sourceDataURI = require('./sourcecompare').sourceDataURI;\n}\n\nvar __dalliance_smallGlyphs = {\n    DOT: true,\n    EX: true,\n    STAR: true,\n    SQUARE: true,\n    CROSS: true,\n    TRIANGLE: true,\n    PLIMSOLL: true\n};\n\nBrowser.prototype.openTierPanel = function (tier) {\n    var b = this;\n\n    if (this.uiMode === 'tier' && this.manipulatingTier === tier) {\n        this.hideToolPanel();\n        this.setUiMode('none');\n    } else if (!tier) {\n        return;\n    } else {\n        var setStyleColors = function setStyleColors(style) {\n            if (style.BGGRAD) return;\n\n            if (numColors == 1) {\n                if (style.glyph == 'LINEPLOT' || __dalliance_smallGlyphs[style.glyph]) {\n                    style.FGCOLOR = tierColorField.value;\n                } else {\n                    style.BGCOLOR = tierColorField.value;\n                }\n                style.COLOR1 = style.COLOR2 = style.COLOR3 = null;\n            } else {\n                style.COLOR1 = tierColorField.value;\n                style.COLOR2 = tierColorField2.value;\n                if (numColors > 2) {\n                    style.COLOR3 = tierColorField3.value;\n                } else {\n                    style.COLOR3 = null;\n                }\n            }\n            style._gradient = null;\n            style._plusColor = tierPlusColorField.value;\n            style._minusColor = tierMinusColorField.value;\n        };\n\n        var mutateStylesheet = function mutateStylesheet(visitor) {\n            var nss = copyStylesheet(tier.stylesheet);\n            var ssScale = tier.browser.zoomForCurrentScale();\n\n            for (var i = 0; i < nss.styles.length; ++i) {\n                var sh = nss.styles[i];\n                if (sh.zoom && sh.zoom != ssScale) {\n                    continue;\n                }\n\n                visitor(sh.style);\n            }\n\n            return nss;\n        };\n\n        var changeColor = function changeColor(ev) {\n            tier.mergeStylesheet(mutateStylesheet(setStyleColors));\n        };\n\n        this.manipulatingTier = tier;\n\n        var tierForm = makeElement('div', null, { className: 'tier-edit' });\n\n        var aboutBanner = makeElement('div', \"About '\" + (tier.config.Name || tier.dasSource.name) + \"'\", null, { background: 'gray', paddingBottom: '5px', marginBottom: '5px', textAlign: 'center' });\n        tierForm.appendChild(aboutBanner);\n\n        var about = makeElement('div', [makeElement('p', tier.dasSource.desc)]);\n        var aboutNotes = [];\n        var sduri = sourceDataURI(tier.dasSource);\n        if (sduri && (sduri.indexOf('http://') == 0 || sduri.indexOf('https://') == 0 || sduri.indexOf('//') == 0) && sduri !== 'https://www.biodalliance.org/magic/no_uri') {\n            aboutNotes.push(makeElement('li', makeElement('a', '(Download data)', { href: sduri })));\n        }\n\n        if (tier.dasSource.mapping) {\n            var coords = this.chains[tier.dasSource.mapping].coords;\n            aboutNotes.push(makeElement('li', 'Mapped from ' + coords.auth + coords.version));\n        }\n\n        if (aboutNotes.length > 0) {\n            about.appendChild(makeElement('ul', aboutNotes));\n        }\n\n        tierForm.appendChild(about);\n\n        var semanticBanner = makeElement('span', ' (styles for current zoom level)', null, { display: 'none' });\n        var editBanner = makeElement('div', ['Edit', semanticBanner], null, { background: 'gray', paddingBottom: '5px', marginBottom: '5px', textAlign: 'center' });\n        tierForm.appendChild(editBanner);\n\n        var tierNameField = makeElement('input', null, { type: 'text' });\n        var tierPinnedToggle = makeElement('input', null, { type: 'checkbox', disabled: this.disablePinning });\n\n        var glyphField = makeElement('select');\n        glyphField.appendChild(makeElement('option', 'Histogram', { value: 'HISTOGRAM' }));\n        glyphField.appendChild(makeElement('option', 'Line Plot', { value: 'LINEPLOT' }));\n        glyphField.appendChild(makeElement('option', 'Ribbon', { value: 'GRADIENT' }));\n        glyphField.appendChild(makeElement('option', 'Scatter', { value: 'SCATTER' }));\n\n        var tierColorField = makeElement('input', null, { type: 'text', value: '#dd00dd' });\n        var tierColorField2 = makeElement('input', null, { type: 'text', value: '#dd00dd' });\n        var tierColorField3 = makeElement('input', null, { type: 'text', value: '#dd00dd' });\n\n        var tierPlusColorField = makeElement('input', null, { type: 'text', value: '#ffa07a' });\n        var tierMinusColorField = makeElement('input', null, { type: 'text', value: '#87cefa' });\n\n        try {\n            tierColorField.type = tierColorField2.type = tierColorField3.type = 'color';\n            tierPlusColorField.type = tierMinusColorField.type = 'color';\n        } catch (e) {\n            // IE throws if attempt to set type to 'color'.\n        }\n\n        var tierColorFields = [tierColorField, tierColorField2, tierColorField3];\n        var colorListPlus = makeElement('i', null, { className: 'fa fa-plus-circle' });\n        var colorListMinus = makeElement('i', null, { className: 'fa fa-minus-circle' });\n        var numColors = 1;\n        var colorListElement = makeElement('td', tierColorFields);\n        var setNumColors = function setNumColors(n) {\n            numColors = n;\n            for (var i = 0; i < n; ++i) {\n                tierColorFields[i].style.display = 'block';\n            }for (var i = n; i < tierColorFields.length; ++i) {\n                tierColorFields[i].style.display = 'none';\n            }\n        };\n        colorListPlus.addEventListener('click', function (ev) {\n            if (numColors < 3) {\n                setNumColors(numColors + 1);\n                changeColor(null);\n            }\n        }, false);\n        colorListMinus.addEventListener('click', function (ev) {\n            if (numColors > 1) {\n                setNumColors(numColors - 1);\n                changeColor(null);\n            }\n        }, false);\n\n        var tierMinField = makeElement('input', null, { type: 'text', value: '0.0' });\n        var tierMaxField = makeElement('input', null, { type: 'text', value: '10.0' });\n        var tierMinToggle = makeElement('input', null, { type: 'checkbox' });\n        var tierMaxToggle = makeElement('input', null, { type: 'checkbox' });\n\n        var quantLeapToggle = makeElement('input', null, { type: 'checkbox', checked: tier.quantLeapThreshold !== undefined });\n        var quantLeapThreshField = makeElement('input', null, { type: 'text', value: tier.quantLeapThreshold, disabled: !quantLeapToggle.checked });\n\n        var tierHeightField = makeElement('input', null, { type: 'text', value: '50' });\n\n        var bumpToggle = makeElement('input', null, { type: 'checkbox' });\n        var bumpLimit = makeElement('input', null, { type: 'text' });\n        var labelToggle = makeElement('input', null, { type: 'checkbox' });\n\n        var mainStyle = null;\n        if (tier.stylesheet.styles.length > 0) {\n            var s = mainStyle = tier.stylesheet.styles[0].style;\n        }\n\n        var refresh = function refresh() {\n            if (typeof tier.config.name === 'string') tierNameField.value = tier.config.name;else tierNameField.value = tier.dasSource.name;\n\n            tierPinnedToggle.checked = tier.pinned;\n\n            if (tier.forceHeight) {\n                tierHeightField.value = '' + tier.forceHeight;\n            } else if (mainStyle && mainStyle.HEIGHT) {\n                tierHeightField.value = '' + mainStyle.HEIGHT;\n            }\n\n            if (typeof tier.quantLeapThreshold == 'number') {\n                quantLeapToggle.checked = true;\n                quantLeapThreshField.disabled = false;\n                if (parseFloat(quantLeapThreshField.value) != tier.quantLeapThreshold) quantLeapThreshField.value = tier.quantLeapThreshold;\n            } else {\n                quantLeapToggle.checked = false;\n                quantLeapThreshField.disabled = true;\n            }\n\n            if (typeof tier.subtierMax == 'number') {\n                bumpLimit.value = '' + tier.subtierMax;\n            } else {\n                bumpLimit.value = '' + (tier.dasSource.subtierMax || tier.browser.defaultSubtierMax);\n            }\n\n            if (tier.stylesheet.styles.length > 0) {\n                var s = null;\n                var isQuantitative = false,\n                    isSimpleQuantitative = false;\n                var ssScale = tier.browser.zoomForCurrentScale();\n                var activeStyleCount = 0;\n\n                for (var si = 0; si < tier.stylesheet.styles.length; ++si) {\n                    var sh = tier.stylesheet.styles[si];\n                    if (sh.zoom && sh.zoom != ssScale) {\n                        continue;\n                    }\n                    ++activeStyleCount;\n                    var ss = tier.stylesheet.styles[si].style;\n\n                    if (!s) {\n                        s = mainStyle = ss;\n                    }\n\n                    if (ss.glyph == 'LINEPLOT' || ss.glyph == 'HISTOGRAM' || ss.glyph == 'GRADIENT' || isDasBooleanTrue(ss.SCATTER)) {\n                        if (!isQuantitative) s = mainStyle = ss;\n                        isQuantitative = true;\n                    }\n                }\n                if (!s) {\n                    return;\n                }\n\n                semanticBanner.style.display = activeStyleCount == tier.stylesheet.styles.length ? 'none' : 'inline';\n\n                isSimpleQuantitative = isQuantitative && activeStyleCount == 1;\n                var isGradient = s.COLOR2 || s.BGGRAD;\n\n                if (isQuantitative) {\n                    minRow.style.display = 'table-row';\n                    maxRow.style.display = 'table-row';\n                    bumpRow.style.display = 'none';\n                    labelRow.style.display = 'none';\n                } else {\n                    minRow.style.display = 'none';\n                    maxRow.style.display = 'none';\n                    bumpRow.style.display = 'table-row';\n                    bumpToggle.checked = isDasBooleanTrue(mainStyle.BUMP);\n                    bumpLimit.disabled = !isDasBooleanTrue(mainStyle.BUMP);\n                    labelRow.style.display = 'table-row';\n                    labelToggle.checked = isDasBooleanTrue(mainStyle.LABEL);\n                }\n\n                if (isSimpleQuantitative) {\n                    styleRow.style.display = 'table-row';\n                    colorRow.style.display = 'table-row';\n                } else {\n                    styleRow.style.display = 'none';\n                    colorRow.style.display = 'none';\n                }\n\n                var numColors = 1;\n                if (s.COLOR1) {\n                    tierColorField.value = dasColourForName(s.COLOR1).toHexString();\n                    if (s.COLOR2) {\n                        tierColorField2.value = dasColourForName(s.COLOR2).toHexString();\n                        if (s.COLOR3) {\n                            tierColorField3.value = dasColourForName(s.COLOR3).toHexString();\n                            numColors = 3;\n                        } else {\n                            numColors = 2;\n                        }\n                    }\n                } else {\n                    if (s.glyph == 'LINEPLOT' || s.glyph == 'DOT' && s.FGCOLOR) {\n                        tierColorField.value = dasColourForName(s.FGCOLOR).toHexString();\n                    } else if (s.BGCOLOR) {\n                        tierColorField.value = dasColourForName(s.BGCOLOR).toHexString();\n                    }\n                }\n                setNumColors(numColors);\n\n                if (s._plusColor) tierPlusColorField.value = dasColourForName(s._plusColor).toHexString() || s._plusColor;\n                if (s._minusColor) tierMinusColorField.value = dasColourForName(s._minusColor).toHexString() || s._minusColor;\n                if (isDasBooleanTrue(s.SCATTER)) {\n                    glyphField.value = 'SCATTER';\n                } else {\n                    glyphField.value = s.glyph;\n                }\n\n                var setMinValue, setMaxValue;\n                if (s.MIN !== undefined) {\n                    var x = parseFloat(s.MIN);\n                    if (!isNaN(x)) setMinValue = x;\n                }\n                if (!tier.forceMinDynamic && (s.MIN !== undefined || tier.forceMin !== undefined)) {\n                    tierMinToggle.checked = true;\n                    tierMinField.disabled = false;\n                } else {\n                    tierMinToggle.checked = false;\n                    tierMinField.disabled = true;\n                }\n\n                if (s.MAX !== undefined) {\n                    var x = parseFloat(s.MAX);\n                    if (!isNaN(x)) setMaxValue = x;\n                }\n                if (!tier.forceMaxDynamic && (s.MAX !== undefined || tier.forceMax !== undefined)) {\n                    tierMaxToggle.checked = true;\n                    tierMaxField.disabled = false;\n                } else {\n                    tierMaxToggle.checked = false;\n                    tierMaxField.disabled = true;\n                }\n\n                if (tier.forceMin != undefined) {\n                    setMinValue = tier.forceMin;\n                }\n                if (tier.forceMax != undefined) {\n                    setMaxValue = tier.forceMax;\n                }\n                if (typeof setMinValue == 'number' && setMinValue != parseFloat(tierMinField.value)) {\n                    tierMinField.value = setMinValue;\n                }\n                if (typeof setMaxValue == 'number' && setMaxValue != parseFloat(tierMaxField.value)) {\n                    tierMaxField.value = setMaxValue;\n                }\n\n                var seqStyle = getSeqStyle(tier.stylesheet);\n                if (seqStyle) {\n                    seqMismatchRow.style.display = 'table-row';\n                    seqMismatchToggle.checked = seqStyle.__SEQCOLOR === 'mismatch';\n                    seqInsertRow.style.display = 'table-row';\n                    seqInsertToggle.checked = isDasBooleanTrue(seqStyle.__INSERTIONS);\n                    seqIgnoreQualsRow.style.display = 'table-row';\n                    seqIgnoreQualsToggle.checked = seqStyle.__disableQuals === undefined || seqStyle.__disableQuals === false;\n                    console.log(seqStyle.__disableQuals);\n                } else {\n                    seqMismatchRow.style.display = 'none';\n                    seqInsertRow.style.display = 'none';\n                    seqIgnoreQualsRow.style.display = 'none';\n                }\n\n                if (seqStyle && seqMismatchToggle.checked && !isSimpleQuantitative) {\n                    plusStrandColorRow.style.display = 'table-row';\n                    minusStrandColorRow.style.display = 'table-row';\n                } else {\n                    plusStrandColorRow.style.display = 'none';\n                    minusStrandColorRow.style.display = 'none';\n                }\n            }\n\n            if (isQuantitative && tier.browser.sourceAdapterIsCapable(tier.featureSource, 'quantLeap')) quantLeapRow.style.display = 'table-row';else quantLeapRow.style.display = 'none';\n        };\n\n        var seqMismatchToggle = makeElement('input', null, { type: 'checkbox' });\n        var seqMismatchRow = makeElement('tr', [makeElement('th', 'Highlight mismatches & strands'), makeElement('td', seqMismatchToggle)]);\n        seqMismatchToggle.addEventListener('change', function (ev) {\n            var nss = copyStylesheet(tier.stylesheet);\n            var seqStyle = getSeqStyle(nss);\n            seqStyle.__SEQCOLOR = seqMismatchToggle.checked ? 'mismatch' : 'base';\n            tier.mergeStylesheet(nss);\n        });\n\n        var seqInsertToggle = makeElement('input', null, { type: 'checkbox' });\n        var seqInsertRow = makeElement('tr', [makeElement('th', 'Show insertions'), makeElement('td', seqInsertToggle)]);\n        seqInsertToggle.addEventListener('change', function (ev) {\n            var nss = copyStylesheet(tier.stylesheet);\n            var seqStyle = getSeqStyle(nss);\n            seqStyle.__INSERTIONS = seqInsertToggle.checked ? 'yes' : 'no';\n            tier.mergeStylesheet(nss);\n        });\n\n        var seqIgnoreQualsToggle = makeElement('input', null, { type: 'checkbox' });\n        var seqIgnoreQualsRow = makeElement('tr', [makeElement('th', 'Reflect base quality as base color transparency'), makeElement('td', seqIgnoreQualsToggle)]);\n        seqIgnoreQualsToggle.addEventListener('change', function (ev) {\n            var nss = copyStylesheet(tier.stylesheet);\n            var seqStyle = getSeqStyle(nss);\n            seqStyle.__disableQuals = !seqIgnoreQualsToggle.checked;\n            console.log(seqStyle.__disableQuals);\n            tier.mergeStylesheet(nss);\n        });\n\n        var styleRow = makeElement('tr', [makeElement('th', 'Style'), makeElement('td', glyphField)]);\n        var colorRow = makeElement('tr', [makeElement('th', ['Colour(s)', colorListPlus, colorListMinus]), colorListElement]);\n        var plusStrandColorRow = makeElement('tr', [makeElement('th', 'Plus Strand Color'), makeElement('td', tierPlusColorField)]);\n        var minusStrandColorRow = makeElement('tr', [makeElement('th', 'Minus Strand Color'), makeElement('td', tierMinusColorField)]);\n        var minRow = makeElement('tr', [makeElement('th', 'Min value'), makeElement('td', [tierMinToggle, ' ', tierMinField])]);\n        var maxRow = makeElement('tr', [makeElement('th', 'Max value'), makeElement('td', [tierMaxToggle, ' ', tierMaxField])]);\n        var quantLeapRow = makeElement('tr', [makeElement('th', 'Threshold leap:'), makeElement('td', [quantLeapToggle, ' ', quantLeapThreshField])]);\n        var bumpRow = makeElement('tr', [makeElement('th', 'Bump overlaps'), makeElement('td', [bumpToggle, ' limit: ', bumpLimit])]);\n        var labelRow = makeElement('tr', [makeElement('th', 'Label features'), makeElement('td', labelToggle)]);\n\n        var tierTable = makeElement('table', [makeElement('tr', [makeElement('th', 'Name', {}, { width: '150px', textAlign: 'right' }), tierNameField]), makeElement('tr', [makeElement('th', 'Pin to top'), tierPinnedToggle]), makeElement('tr', [makeElement('th', 'Height'), makeElement('td', tierHeightField)]), styleRow, colorRow, plusStrandColorRow, minusStrandColorRow, minRow, maxRow, quantLeapRow, bumpRow, labelRow, seqMismatchRow, seqInsertRow, seqIgnoreQualsRow]);\n\n        refresh();\n\n        tierForm.appendChild(tierTable);\n\n        var resetButton = makeElement('button', 'Reset track', { className: 'btn' }, { marginLeft: 'auto', marginRight: 'auto', display: 'block' });\n        resetButton.addEventListener('click', function (ev) {\n            tier.setConfig({});\n        }, false);\n        tierForm.appendChild(resetButton);\n\n        tierNameField.addEventListener('input', function (ev) {\n            tier.mergeConfig({ name: tierNameField.value });\n        }, false);\n\n        tierPinnedToggle.addEventListener('change', function (ev) {\n            tier.mergeConfig({ pinned: tierPinnedToggle.checked });\n        }, false);\n\n        for (var ci = 0; ci < tierColorFields.length; ++ci) {\n            tierColorFields[ci].addEventListener('change', changeColor, false);\n        }\n\n        tierPlusColorField.addEventListener('change', changeColor, false);\n        tierMinusColorField.addEventListener('change', changeColor, false);\n\n        glyphField.addEventListener('change', function (ev) {\n            var nss = mutateStylesheet(function (ts) {\n                if (glyphField.value === 'SCATTER') {\n                    ts.SCATTER = true;\n                    ts.glyph = 'DOT';\n                    ts.SIZE = '3';\n                } else {\n                    ts.glyph = glyphField.value;\n                    ts.SCATTER = undefined;\n                }\n                setStyleColors(ts);\n            });\n            tier.mergeStylesheet(nss);\n        }, false);\n\n        tierMinToggle.addEventListener('change', function (ev) {\n            var conf = { forceMinDynamic: !tierMinToggle.checked };\n            tierMinField.disabled = !tierMinToggle.checked;\n            var x = parseFloat(tierMinField.value);\n            if (tierMinToggle.checked && typeof x == 'number' && !isNaN(x)) conf.forceMin = parseFloat(x);\n            tier.mergeConfig(conf);\n        });\n        tierMinField.addEventListener('input', function (ev) {\n            var x = parseFloat(tierMinField.value);\n            if (typeof x == 'number' && !isNaN(x)) tier.mergeConfig({ forceMin: x });\n        }, false);\n\n        tierMaxToggle.addEventListener('change', function (ev) {\n            var conf = { forceMaxDynamic: !tierMaxToggle.checked };\n            tierMaxField.disabled = !tierMaxToggle.checked;\n            var x = parseFloat(tierMaxField.value);\n            if (tierMaxToggle.checked && typeof x == 'number' && !isNaN(x)) conf.forceMax = parseFloat(x);\n            tier.mergeConfig(conf);\n        });\n        tierMaxField.addEventListener('input', function (ev) {\n            var x = parseFloat(tierMaxField.value);\n            if (typeof x == 'number' && !isNaN(x)) tier.mergeConfig({ forceMax: x });\n        }, false);\n\n        tierHeightField.addEventListener('input', function (ev) {\n            var x = parseFloat(tierHeightField.value);\n            if (typeof x == 'number' && !isNaN(x)) tier.mergeConfig({ height: Math.min(500, x | 0) });\n        }, false);\n\n        var updateQuant = function updateQuant() {\n            quantLeapThreshField.disabled = !quantLeapToggle.checked;\n            if (quantLeapToggle.checked) {\n                var x = parseFloat(quantLeapThreshField.value);\n                if (typeof x == 'number' && !isNaN(x)) {\n                    tier.mergeConfig({ quantLeapThreshold: parseFloat(quantLeapThreshField.value) });\n                }\n            } else {\n                tier.mergeConfig({ quantLeapThreshold: null });\n            }\n        };\n        quantLeapToggle.addEventListener('change', function (ev) {\n            updateQuant();\n        }, false);\n        quantLeapThreshField.addEventListener('input', function (ev) {\n            updateQuant();\n        }, false);\n\n        labelToggle.addEventListener('change', function (ev) {\n            var nss = mutateStylesheet(function (style) {\n                style.LABEL = labelToggle.checked ? 'yes' : 'no';\n            });\n            tier.mergeStylesheet(nss);\n        }, false);\n        bumpToggle.addEventListener('change', function (ev) {\n            var nss = mutateStylesheet(function (style) {\n                style.BUMP = bumpToggle.checked ? 'yes' : 'no';\n            });\n            tier.mergeStylesheet(nss);\n        }, false);\n        bumpLimit.addEventListener('input', function (ev) {\n            var x = parseInt(bumpLimit.value);\n            if (typeof x == 'number' && x > 0) {\n                tier.mergeConfig({ subtierMax: x });\n            }\n        }, false);\n\n        this.showToolPanel(tierForm);\n        this.setUiMode('tier');\n\n        tier.addTierListener(refresh);\n\n        var currentScale = tier.browser.scale;\n        tier.browser.addViewListener(function () {\n            if (tier.browser.scale != currentScale) {\n                currentScale = tier.browser.scale;\n                refresh();\n            }\n        });\n    }\n};\n\nfunction getSeqStyle(stylesheet) {\n    for (var si = 0; si < stylesheet.styles.length; ++si) {\n        var ss = stylesheet.styles[si].style;\n        if (ss.glyph === '__SEQUENCE') {\n            return ss;\n        }\n    }\n}\n\n},{\"./cbrowser\":6,\"./color\":9,\"./das\":11,\"./sourcecompare\":40,\"./utils\":56}],52:[function(require,module,exports){\n/* -*- mode: javascript; c-basic-offset: 4; indent-tabs-mode: nil -*- */\n\n// \n// Dalliance Genome Explorer\n// (c) Thomas Down 2006-2010\n//\n// tier.js: (try) to encapsulate the functionality of a browser tier.\n//\n\n\"use strict\";\n\nvar _typeof = typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; };\n\nif (typeof require !== 'undefined') {\n    var utils = require('./utils');\n    var makeElement = utils.makeElement;\n    var removeChildren = utils.removeChildren;\n    var shallowCopy = utils.shallowCopy;\n    var pushnew = utils.pushnew;\n    var miniJSONify = utils.miniJSONify;\n    var arrayIndexOf = utils.arrayIndexOf;\n\n    var das = require('./das');\n    var DASStylesheet = das.DASStylesheet;\n    var DASStyle = das.DASStyle;\n\n    var sha1 = require('./sha1');\n    var b64_sha1 = sha1.b64_sha1;\n\n    var style = require('./style');\n    var StyleFilter = style.StyleFilter;\n    var StyleFilterSet = style.StyleFilterSet;\n\n    var sc = require('./sourcecompare');\n    var sourceDataURI = sc.sourceDataURI;\n\n    var Promise = require('es6-promise').Promise;\n\n    var sortFeatures = require('./features').sortFeatures;\n}\n\nvar __tier_idSeed = 0;\n\nfunction DasTier(browser, source, config, background) {\n    var _this = this;\n\n    this.config = config || {};\n    this.id = 'tier' + ++__tier_idSeed;\n    this.browser = browser;\n    this.dasSource = shallowCopy(source);\n    this.background = background;\n\n    this.viewport = makeElement('canvas', null, { width: '' + ((this.browser.featurePanelWidth | 0) + 2000),\n        height: \"30\",\n        className: 'viewport_12_5' }, { position: 'inline-block',\n        margin: '0px', border: '0px' });\n    this.viewportHolder = makeElement('div', this.viewport, { className: 'viewport-holder_12_5' }, { background: background,\n        position: 'absolute',\n        padding: '0px', margin: '0px',\n        border: '0px',\n        left: '-1000px',\n        minHeight: '200px' });\n    this.overlay = makeElement('canvas', null, { width: +(this.browser.featurePanelWidth | 0),\n        height: \"30\",\n        className: 'viewport-overlay' });\n\n    this.notifier = makeElement('div', '', { className: 'notifier' });\n    this.notifierHolder = makeElement('div', this.notifier, { className: 'notifier-holder' });\n    this.quantOverlay = makeElement('canvas', null, { width: '50', height: \"56\",\n        className: 'quant-overlay' });\n\n    this.removeButton = makeElement('i', null, { className: 'fa fa-times' });\n    this.bumpButton = makeElement('i', null, { className: 'fa fa-plus-circle' });\n    this.loaderButton = browser.makeLoader(16);\n    this.loaderButton.style.display = 'none';\n    this.infoElement = makeElement('div', this.dasSource.desc, { className: 'track-label-info' });\n    this.nameButton = makeElement('div', [], { className: 'tier-tab' });\n    this.nameButton.appendChild(this.removeButton);\n    if (source.pennant) {\n        this.nameButton.appendChild(makeElement('img', null, { src: source.pennant, width: '16', height: '16' }));\n    } else if (source.mapping) {\n        var version = null;\n        if (this.browser.chains[source.mapping]) version = this.browser.chains[source.mapping].coords.version;\n        if (version) this.nameButton.appendChild(makeElement('span', '' + version, null, { fontSize: '8pt', background: 'black', color: 'white', paddingLeft: '3px', paddingRight: '3px', paddingTop: '1px', paddingBottom: '1px', marginLeft: '2px', borderRadius: '10px' }));\n    }\n    this.nameElement = makeElement('span', source.name);\n    this.nameButton.appendChild(makeElement('span', [this.nameElement, this.infoElement], { className: 'track-name-holder' }));\n    this.nameButton.appendChild(this.bumpButton);\n    this.nameButton.appendChild(this.loaderButton);\n\n    this.label = makeElement('span', [this.nameButton], { className: 'btn-group track-label' });\n\n    var classes = 'tier' + (source.className ? ' ' + source.className : '');\n    this.row = makeElement('div', [this.viewportHolder, this.overlay, this.quantOverlay], { className: classes });\n\n    if (!background) {\n        this.row.style.background = 'none';\n    }\n\n    if (!browser.noDefaultLabels) this.row.appendChild(this.label);\n    this.row.appendChild(this.notifierHolder);\n\n    this.layoutHeight = 25;\n    this.bumped = true;\n    this.styleIdSeed = 0;\n    if (source.quantLeapThreshold) {\n        this.quantLeapThreshold = source.quantLeapThreshold;\n    }\n    if (this.dasSource.collapseSuperGroups) {\n        this.bumped = false;\n    }\n    this.layoutWasDone = false;\n\n    if (source.featureInfoPlugin) {\n        this.addFeatureInfoPlugin(source.featureInfoPlugin);\n    }\n\n    this.initSources();\n\n    var thisB = this;\n    if (this.featureSource && this.featureSource.getDefaultFIPs && !source.noSourceFeatureInfo) {\n        this.featureSource.getDefaultFIPs(function (fip) {\n            if (fip) thisB.addFeatureInfoPlugin(fip);\n        });\n    }\n\n    if (this.featureSource && this.featureSource.addReadinessListener) {\n        this.readinessListener = function (ready) {\n            thisB.notify(ready, -1);\n        };\n        this.featureSource.addReadinessListener(this.readinessListener);\n    }\n\n    if (this.featureSource && this.featureSource.addActivityListener) {\n        this.activityListener = function (busy) {\n            if (busy > 0) {\n                thisB.loaderButton.style.display = 'inline-block';\n            } else {\n                thisB.loaderButton.style.display = 'none';\n            }\n            thisB.browser.pingActivity();\n        };\n        this.featureSource.addActivityListener(this.activityListener);\n    }\n\n    this.listeners = [];\n    this.featuresLoadedListeners = [];\n    this.firstRenderPromise = new Promise(function (resolve, reject) {\n        return _this._resolveFirstRenderPromise = resolve;\n    });\n}\n\nDasTier.prototype.destroy = function () {\n    if (this.featureSource.removeReadinessListener) {\n        this.featureSource.removeReadinessListener(this.readinessListener);\n    }\n    if (this.featureSource.removeActivityListener) {\n        this.featureSource.removeActivityListener(this.activityListener);\n    }\n};\n\nDasTier.prototype.setBackground = function (b) {\n    this.background = b;\n    this.viewportHolder.style.background = b;\n};\n\nDasTier.prototype.toString = function () {\n    return this.id;\n};\n\nDasTier.prototype.addFeatureInfoPlugin = function (p) {\n    if (!this.featureInfoPlugins) this.featureInfoPlugins = [];\n    this.featureInfoPlugins.push(p);\n};\n\nDasTier.prototype.init = function () {\n    var tier = this;\n    return new Promise(function (resolve, reject) {\n\n        if (tier.dasSource.style) {\n            tier.setStylesheet({ styles: tier.dasSource.style });\n            resolve(tier);\n        } else {\n            tier.status = 'Fetching stylesheet';\n            tier.fetchStylesheet(function (ss, err) {\n                if (err || !ss) {\n                    tier.error = 'No stylesheet';\n                    var ss = new DASStylesheet();\n                    var defStyle = new DASStyle();\n                    defStyle.glyph = 'BOX';\n                    defStyle.BGCOLOR = 'blue';\n                    defStyle.FGCOLOR = 'black';\n                    ss.pushStyle({ type: 'default' }, null, defStyle);\n                    tier.setStylesheet(ss);\n                } else {\n                    tier.setStylesheet(ss);\n                    if (ss.geneHint) {\n                        tier.dasSource.collapseSuperGroups = true;\n                        tier.bumped = false;\n                        tier.updateLabel();\n                    }\n                    tier._updateFromConfig();\n                }\n                resolve(tier);\n            });\n        }\n    });\n};\n\nDasTier.prototype.setStylesheet = function (ss) {\n    this.baseStylesheet = shallowCopy(ss);\n    for (var si = 0; si < this.baseStylesheet.styles.length; ++si) {\n        var sh = this.baseStylesheet.styles[si] = shallowCopy(this.baseStylesheet.styles[si]);\n        sh._methodRE = sh._labelRE = sh._typeRE = null;\n        sh.style = shallowCopy(sh.style);\n        sh.style.id = 'style' + ++this.styleIdSeed;\n    }\n    this.baseStylesheetValidity = b64_sha1(miniJSONify(this.baseStylesheet));\n    this._updateFromConfig();\n};\n\nDasTier.prototype.getSource = function () {\n    return this.featureSource;\n};\n\nDasTier.prototype.getDesiredTypes = function (scale) {\n    var sfs = this.getActiveStyleFilters(scale);\n    if (sfs) return sfs.typeList();\n};\n\nDasTier.prototype.getActiveStyleFilters = function (scale) {\n    var ssScale = this.browser.zoomForCurrentScale();\n\n    if (this.stylesheet) {\n        var styles = new StyleFilterSet();\n        var ss = this.stylesheet.styles;\n        for (var si = 0; si < ss.length; ++si) {\n            var sh = ss[si];\n            if (!sh.zoom || sh.zoom == ssScale) {\n                styles.add(new StyleFilter(sh.type, sh.method, sh.label));\n            }\n        }\n        return styles;\n    }\n};\n\nDasTier.prototype.needsSequence = function (scale) {\n    var sourceConfigNeedsSeq = function sourceConfigNeedsSeq(s) {\n        if (s.bamURI || s.bamBlob || s.bwgURI || s.bwgBlob) {\n            return true;\n        } else if (s.overlay) {\n            return s.overlay.some(sourceConfigNeedsSeq);\n        } else {\n            return false;\n        }\n    };\n\n    if (this.sequenceSource && scale < 5) {\n        return true;\n    } else if (sourceConfigNeedsSeq(this.dasSource) && scale < 20) {\n        return true;\n    }\n    return false;\n};\n\nDasTier.prototype.setFeatures = function (chr, coverage, scale, features, sequence) {\n    this.currentFeatures = features;\n    this.currentSequence = sequence;\n    this.knownChr = chr;\n    this.knownCoverage = coverage;\n\n    // only notify features loaded, if they are valid\n    if (features) {\n        sortFeatures(this);\n        this.notifyFeaturesLoaded();\n    }\n};\n\nDasTier.prototype.draw = function () {\n    console.log(\"Use browser.getTierRenderer(tier).drawTier(tier)\");\n};\n\nDasTier.prototype.findNextFeature = function (chr, pos, dir, fedge, callback) {\n    if (this.quantLeapThreshold) {\n        var width = this.browser.viewEnd - this.browser.viewStart + 1;\n        pos = pos + width * dir / 2 | 0;\n        this.featureSource.quantFindNextFeature(chr, pos, dir, this.quantLeapThreshold, callback);\n    } else {\n        if (this.knownCoverage && pos >= this.knownCoverage.min() && pos <= this.knownCoverage.max()) {\n            if (this.currentFeatures) {\n                var bestFeature = null;\n                for (var fi = 0; fi < this.currentFeatures.length; ++fi) {\n                    var f = this.currentFeatures[fi];\n                    if (!f.min || !f.max) {\n                        continue;\n                    }\n                    if (f.parents && f.parents.length > 0) {\n                        continue;\n                    }\n                    if (dir < 0) {\n                        if (fedge == 1 && f.max >= pos && f.min < pos) {\n                            if (!bestFeature || f.min > bestFeature.min || f.min == bestFeature.min && f.max < bestFeature.max) {\n                                bestFeature = f;\n                            }\n                        } else if (f.max < pos) {\n                            if (!bestFeature || f.max > bestFeature.max || f.max == bestFeature.max && f.min < bestFeature.min || f.min == bestFeature.mmin && bestFeature.max >= pos) {\n                                bestFeature = f;\n                            }\n                        }\n                    } else {\n                        if (fedge == 1 && f.min <= pos && f.max > pos) {\n                            if (!bestFeature || f.max < bestFeature.max || f.max == bestFeature.max && f.min > bestFeature.min) {\n                                bestFeature = f;\n                            }\n                        } else if (f.min > pos) {\n                            if (!bestFeature || f.min < bestFeature.min || f.min == bestFeature.min && f.max > bestFeature.max || f.max == bestFeature.max && bestFeature.min <= pos) {\n                                bestFeature = f;\n                            }\n                        }\n                    }\n                }\n                if (bestFeature) {\n                    return callback(bestFeature);\n                }\n                if (dir < 0) {\n                    pos = this.browser.knownSpace.min;\n                } else {\n                    pos = this.browser.knownSpace.max;\n                }\n            }\n        }\n\n        this.trySourceFNF(chr, pos, dir, callback);\n    }\n};\n\nDasTier.prototype.trySourceFNF = function (chr, pos, dir, callback) {\n    var self = this;\n    this.featureSource.findNextFeature(chr, pos, dir, function (feature) {\n        if (!feature) callback(feature);\n\n        var ss = self.browser.getSequenceSource();\n        if (!ss) // We're probably in trouble, but return anyway.\n            callback(feature);\n\n        ss.getSeqInfo(feature.segment, function (si) {\n            if (si) callback(feature);else self.trySourceFNF(feature.segment, dir > 0 ? 10000000000 : 0, dir, callback);\n        });\n    });\n};\n\nDasTier.prototype.updateLabel = function () {\n    this.bumpButton.className = this.bumped ? 'fa fa-minus-circle' : 'fa fa-plus-circle';\n    if (this.dasSource.collapseSuperGroups) {\n        this.bumpButton.style.display = 'inline-block';\n    } else {\n        this.bumpButton.style.display = 'none';\n    }\n};\n\nDasTier.prototype.updateHeight = function () {\n    this.currentHeight = Math.max(Math.max(this.layoutHeight, this.label.clientHeight + 2), this.browser.minTierHeight);\n    this.row.style.height = '' + this.currentHeight + 'px';\n    this.browser.updateHeight();\n};\n\nDasTier.prototype.drawOverlay = function () {\n    var t = this;\n    var b = this.browser;\n    var retina = b.retina && window.devicePixelRatio > 1;\n\n    t.overlay.height = t.viewport.height;\n    t.overlay.width = retina ? b.featurePanelWidth * 2 : b.featurePanelWidth;\n\n    var g = t.overlay.getContext('2d');\n    if (retina) {\n        g.scale(2, 2);\n    }\n\n    var origin = b.viewStart;\n    var visStart = b.viewStart;\n    var visEnd = b.viewEnd;\n\n    if (this.overlayLabelCanvas) {\n        var offset = (this.glyphCacheOrigin - this.browser.viewStart) * this.browser.scale;\n        g.save();\n        g.translate(offset, 0);\n        var drawStart = -offset + 2;\n        if (this.dasSource.tierGroup) drawStart += 15;\n        this.overlayLabelCanvas.draw(g, drawStart, b.featurePanelWidth - offset);\n        g.restore();\n    }\n\n    for (var hi = 0; hi < b.highlights.length; ++hi) {\n        var h = b.highlights[hi];\n        if ((h.chr === b.chr || h.chr === 'chr' + b.chr) && h.min < visEnd && h.max > visStart) {\n            g.globalAlpha = b.defaultHighlightAlpha;\n            g.fillStyle = b.defaultHighlightFill;\n            g.fillRect((h.min - origin) * b.scale, 0, (h.max - h.min) * b.scale, t.overlay.height);\n        }\n    }\n\n    // t.oorigin = b.viewStart;\n    t.overlay.style.width = b.featurePanelWidth;\n    t.overlay.style.height = t.viewport.style.height;\n    t.overlay.style.left = '0px';\n};\n\nDasTier.prototype.updateStatus = function (status) {\n    var self = this;\n    if (status) {\n        this.status = status;\n        this._notifierToStatus();\n        var sd = sourceDataURI(this.dasSource);\n        if (window.location.protocol === 'https:' && sourceDataURI(this.dasSource).indexOf('http:') == 0 && !this.checkedHTTP) {\n            this.checkedHTTP = true;\n            this.browser.canFetchPlainHTTP().then(function (can) {\n                if (!can) {\n                    self.warnHTTP = true;\n                    self._notifierToStatus();\n                }\n            });\n        }\n    } else {\n        if (this.status) {\n            this.status = null;\n            this._notifierToStatus();\n        }\n    }\n};\n\nDasTier.prototype.notify = function (message, timeout) {\n    if (typeof timeout !== 'number') timeout = 2000;\n\n    if (this.notifierFadeTimeout) {\n        clearTimeout(this.notifierFadeTimeout);\n        this.notifierFadeTimeout = null;\n    }\n\n    if (message) {\n        this._notifierOn(message);\n        if (timeout > 0) {\n            var thisB = this;\n            this.notifierFadeTimeout = setTimeout(function () {\n                thisB._notifierToStatus();\n            }, timeout);\n        }\n    } else {\n        this._notifierToStatus();\n    }\n};\n\nDasTier.prototype._notifierOn = function (message, warnHTTP) {\n    removeChildren(this.notifier);\n    if (warnHTTP) {\n        this.notifier.appendChild(makeElement('span', [makeElement('a', '[HTTP Warning] ', { href: this.browser.httpWarningURL, target: \"_blank\" }), message]));\n    } else {\n        this.notifier.textContent = message;\n    }\n    this.notifier.style.opacity = 0.8;\n};\n\nDasTier.prototype._notifierOff = function () {\n    this.notifier.style.opacity = 0;\n};\n\nDasTier.prototype._notifierToStatus = function () {\n    if (this.status) {\n        this._notifierOn(this.status, this.warnHTTP);\n    } else {\n        this._notifierOff();\n    }\n};\n\nDasTier.prototype.setConfig = function (config) {\n    this.config = config || {};\n    this._updateFromConfig();\n    this.notifyTierListeners();\n};\n\nDasTier.prototype.mergeStylesheet = function (newStyle) {\n    this.mergeConfig({\n        stylesheet: newStyle,\n        stylesheetValidity: this.baseStylesheetValidity\n    });\n};\n\nDasTier.prototype.mergeConfig = function (newConfig) {\n    for (var k in newConfig) {\n        this.config[k] = newConfig[k];\n    }\n    this._updateFromConfig();\n    this.notifyTierListeners();\n};\n\nDasTier.prototype._updateFromConfig = function () {\n    var needsRefresh = false;\n    var needsReorder = false;\n\n    if (typeof this.config.name === 'string') this.nameElement.textContent = this.config.name;else this.nameElement.textContent = this.dasSource.name;\n\n    var wantedHeight = this.config.height || this.dasSource.forceHeight;\n    if (wantedHeight != this.forceHeight) {\n        this.forceHeight = wantedHeight;\n        needsRefresh = true;\n    }\n\n    if (this.forceMinDynamic != this.config.forceMinDynamic) {\n        this.forceMinDynamic = this.config.forceMinDynamic;\n        needsRefresh = true;\n    }\n\n    var forceMin = this.config.forceMin != undefined ? this.config.forceMin : this.dasSource.forceMin;\n    if (this.forceMin != forceMin) {\n        this.forceMin = forceMin;\n        needsRefresh = true;\n    }\n\n    if (this.forceMaxDynamic != this.config.forceMaxDynamic) {\n        this.forceMaxDynamic = this.config.forceMaxDynamic;\n        needsRefresh = true;\n    }\n\n    var forceMax = this.config.forceMax != undefined ? this.config.forceMax : this.dasSource.forceMax;\n    if (this.forceMax != forceMax) {\n        this.forceMax = forceMax;\n        needsRefresh = true;\n    }\n\n    var quantLeapThreshold = null;\n    if (this.config.quantLeapThreshold !== undefined) quantLeapThreshold = this.config.quantLeapThreshold;else if (this.dasSource.quantLeapThreshold !== undefined) quantLeapThreshold = this.dasSource.quantLeapThreshold;\n    if (quantLeapThreshold != this.quantLeapThreshold) {\n        this.quantLeapThreshold = quantLeapThreshold;\n        needsRefresh = true;\n    }\n\n    // Possible FIXME -- are there cases where style IDs need to be reassigned?\n    var stylesheet = null;\n    if (this.config.stylesheetValidity == this.baseStylesheetValidity) stylesheet = this.config.stylesheet;\n    stylesheet = stylesheet || this.baseStylesheet;\n    if (this.stylesheet !== stylesheet) {\n        this.stylesheet = stylesheet;\n        needsRefresh = true;\n    }\n\n    var wantedPinned = this.config.pinned !== undefined ? this.config.pinned : this.dasSource.pinned;\n    if (wantedPinned !== this.pinned) {\n        this.pinned = wantedPinned;\n        needsReorder = true;\n    }\n\n    var wantedSubtierMax = _typeof(this.config.subtierMax === 'number') ? this.config.subtierMax : this.dasSource.subtierMax || this.browser.defaultSubtierMax;\n    if (wantedSubtierMax != this.subtierMax) {\n        this.subtierMax = wantedSubtierMax;\n        needsRefresh = true;\n    }\n\n    var wantedBumped;\n    if (this.config.bumped !== undefined) {\n        wantedBumped = this.config.bumped;\n    } else if (this.dasSource.bumped !== undefined) {\n        wantedBumped = this.dasSource.bumped;\n    } else {\n        wantedBumped = this.dasSource.collapseSuperGroups ? false : true;\n    }\n    if (wantedBumped !== this.bumped) {\n        this.bumped = wantedBumped;\n        needsRefresh = true;\n        this.updateLabel();\n    }\n\n    if (needsRefresh) this.scheduleRedraw();\n\n    if (needsReorder) this.browser.reorderTiers();\n};\n\nDasTier.prototype.scheduleRedraw = function () {\n    if (!this.currentFeatures) return;\n\n    var tier = this;\n\n    if (!this.redrawTimeout) {\n        this.redrawTimeout = setTimeout(function () {\n            sortFeatures(tier); // Some render actions mutate the results of this,\n            // => need to re-run before refreshing.\n            var renderer = tier.browser.getTierRenderer(tier);\n            renderer.drawTier(tier);\n            tier.redrawTimeout = null;\n        }, 10);\n    }\n};\nDasTier.prototype.clearTierListeners = function () {\n    this.listeners = [];\n};\n\nDasTier.prototype.addTierListener = function (l) {\n    this.listeners.push(l);\n};\n\nDasTier.prototype.removeTierListener = function (l) {\n    var idx = arrayIndexOf(this.listeners, l);\n    if (idx >= 0) {\n        this.listeners.splice(idx, 1);\n    }\n};\n\nDasTier.prototype.notifyTierListeners = function (change) {\n    for (var li = 0; li < this.listeners.length; ++li) {\n        try {\n            this.listeners[li](change);\n        } catch (e) {\n            console.log(e);\n        }\n    }\n    this.browser.notifyTier();\n};\n\nDasTier.prototype.clearFeaturesLoadedListeners = function () {\n    this.featuresLoadedListeners = [];\n};\n\nDasTier.prototype.addFeaturesLoadedListener = function (handler) {\n    this.featuresLoadedListeners.push(handler);\n};\n\nDasTier.prototype.removeFeaturesLoadedListener = function (handler) {\n    var idx = arrayIndexOf(this.featuresLoadedListeners, handler);\n    if (idx >= 0) {\n        this.featuresLoadedListeners.splice(idx, 1);\n    }\n};\n\nDasTier.prototype.notifyFeaturesLoaded = function () {\n    for (var li = 0; li < this.featuresLoadedListeners.length; ++li) {\n        try {\n            this.featuresLoadedListeners[li].call(this);\n        } catch (e) {\n            console.log(e);\n        }\n    }\n};\n\nDasTier.prototype.wasRendered = function () {\n    this._resolveFirstRenderPromise();\n};\n\nif (typeof module !== 'undefined') {\n    module.exports = {\n        DasTier: DasTier\n    };\n\n    // Imported for side effects\n    var fd = require('./feature-draw');\n}\n\n},{\"./das\":11,\"./feature-draw\":21,\"./features\":23,\"./sha1\":38,\"./sourcecompare\":40,\"./style\":42,\"./utils\":56,\"es6-promise\":60}],53:[function(require,module,exports){\n/* -*- mode: javascript; c-basic-offset: 4; indent-tabs-mode: nil -*- */\n\n// \n// Dalliance Genome Explorer\n// (c) Thomas Down 2006-2010\n//\n// track-adder.js\n//\n\n\"use strict\";\n\nif (typeof require !== 'undefined') {\n    var browser = require('./cbrowser');\n    var Browser = browser.Browser;\n\n    var sc = require('./sourcecompare');\n    var sourcesAreEqual = sc.sourcesAreEqual;\n\n    var utils = require('./utils');\n    var makeElement = utils.makeElement;\n    var removeChildren = utils.removeChildren;\n    var Observed = utils.Observed;\n\n    var thub = require('./thub');\n    var THUB_COMPARE = thub.THUB_COMPARE;\n    var connectTrackHub = thub.connectTrackHub;\n\n    var domui = require('./domui');\n    var makeTreeTableSection = domui.makeTreeTableSection;\n\n    var probeResource = require('./probe').probeResource;\n\n    // Most of this could disappear if we leave all probing to the probe module...\n    var bin = require('./bin');\n    var URLFetchable = bin.URLFetchable;\n    var BlobFetchable = bin.BlobFetchable;\n    var readInt = bin.readInt;\n\n    var lh3utils = require('./lh3utils');\n    var unbgzf = lh3utils.unbgzf;\n\n    var bam = require('./bam');\n    var BAM_MAGIC = bam.BAM_MAGIC;\n    var BAI_MAGIC = bam.BAI_MAGIC;\n\n    var tbi = require('./tabix');\n    var TABIX_MAGIC = tbi.TABIX_MAGIC;\n\n    var das = require('./das');\n    var DASSource = das.DASSource;\n    var DASSegment = das.DASSegment;\n    var DASRegistry = das.DASRegistry;\n    var coordsMatch = das.coordsMatch;\n\n    var EncodeFetchable = require('./encode').EncodeFetchable;\n}\n\nBrowser.prototype.currentlyActive = function (source) {\n    for (var ti = 0; ti < this.tiers.length; ++ti) {\n        if (sourcesAreEqual(this.tiers[ti].dasSource, source)) return this.tiers[ti];\n    }\n    return false;\n};\n\nBrowser.prototype.makeButton = function (name, tooltip) {\n    var regButton = makeElement('a', name, { href: '#' });\n    if (tooltip) {\n        this.makeTooltip(regButton, tooltip);\n    }\n    return makeElement('li', regButton);\n};\n\nfunction activateButton(addModeButtons, which) {\n    for (var i = 0; i < addModeButtons.length; ++i) {\n        var b = addModeButtons[i];\n        if (b === which) {\n            b.classList.add('active');\n        } else {\n            b.classList.remove('active');\n        }\n    }\n}\n\nBrowser.prototype.showTrackAdder = function (ev) {\n    if (this.uiMode === 'add') {\n        this.hideToolPanel();\n        this.setUiMode('none');\n        return;\n    }\n\n    var thisB = this;\n\n    var popup = makeElement('div', null, { className: 'dalliance' }, { width: '100%', display: 'inline-block', boxSizing: 'border-box', MozBoxSizing: 'border-box', verticalAlign: 'top', paddingRight: '15px' });\n\n    var addModeButtons = [];\n    var makeStab, makeStabObserver;\n\n    if (!this.noRegistryTabs) {\n        var regButton = this.makeButton('Registry', 'Browse compatible datasources from the DAS registry');\n        addModeButtons.push(regButton);\n\n        for (var m in this.mappableSources) {\n            var mf = function mf(mm) {\n                var mapButton = thisB.makeButton(thisB.chains[mm].srcTag, 'Browse datasources mapped from ' + thisB.chains[mm].srcTag);\n                addModeButtons.push(mapButton);\n                mapButton.addEventListener('click', function (ev) {\n                    ev.preventDefault();ev.stopPropagation();\n                    activateButton(addModeButtons, mapButton);\n                    makeStab(thisB.mappableSources[mm], mm);\n                }, false);\n            };mf(m);\n        }\n    }\n\n    var groupedDefaults = {};\n    for (var si = 0; si < this.defaultSources.length; ++si) {\n        var s = this.defaultSources[si];\n        var g = s.group || 'Defaults';\n        if (groupedDefaults[g]) {\n            groupedDefaults[g].push(s);\n        } else {\n            groupedDefaults[g] = [s];\n        }\n    }\n\n    var makeHubButton = function makeHubButton(tdb) {\n        var hub = tdb.hub;\n        var hubMenuButton = makeElement('i', null, { className: 'fa fa-list-alt' }, { cursor: 'context-menu' });\n        var label = hub.altLabel || hub.shortLabel || 'Unknown';\n        if (tdb.mapping) label = label + ' (' + tdb.genome + ')';\n        var hbContent = makeElement('span', [label, ' ', hubMenuButton]);\n        var hubButton = thisB.makeButton(hbContent, hub.longLabel);\n        hubButton.hub = tdb;\n        addModeButtons.push(hubButton);\n\n        hubButton.addEventListener('click', function (ev) {\n            ev.preventDefault();ev.stopPropagation();\n            activateButton(addModeButtons, hubButton);\n            removeChildren(stabHolder);\n            var loader = thisB.makeLoader(24);\n            loader.style.marginLeft = 'auto';\n            loader.style.marginRight = 'auto';\n            loader.style.marginTop = '100px';\n            stabHolder.appendChild(makeElement('div', loader, null, { textAlign: 'center' }));\n\n            refreshButton.style.display = 'none';\n            addButton.style.display = 'none';\n            canButton.style.display = 'none';\n\n            tdb.getTracks(function (tracks, err) {\n                if (err) {\n                    console.log(err);\n                }\n\n                makeHubStab(tracks);\n            });\n        }, false);\n\n        hubMenuButton.addEventListener('click', function (ev) {\n            ev.preventDefault();ev.stopPropagation();\n\n            var removeHubItem = makeElement('li', makeElement('a', 'Remove hub'));\n            var allOnItem = makeElement('li', makeElement('a', 'Enable all'));\n            var allOffItem = makeElement('li', makeElement('a', 'Disable all'));\n            var hubMenu = makeElement('ul', [removeHubItem, allOnItem, allOffItem], { className: 'dropdown-menu' }, { display: 'block' });\n\n            var mx = ev.clientX,\n                my = ev.clientY;\n            mx += document.documentElement.scrollLeft || document.body.scrollLeft;\n            my += document.documentElement.scrollTop || document.body.scrollTop;\n\n            hubMenu.style.position = 'absolute';\n            hubMenu.style.top = '' + (my + 10) + 'px';\n            hubMenu.style.left = '' + (mx - 30) + 'px';\n            thisB.hPopupHolder.appendChild(hubMenu);\n\n            var clickCatcher = function clickCatcher(ev) {\n                console.log('cc');\n                document.body.removeEventListener('click', clickCatcher, true);\n                thisB.hPopupHolder.removeChild(hubMenu);\n            };\n            document.body.addEventListener('click', clickCatcher, true);\n\n            removeHubItem.addEventListener('click', function (ev) {\n                for (var hi = 0; hi < thisB.hubObjects.length; ++hi) {\n                    if (thisB.hubObjects[hi].absURL == tdb.absURL) {\n                        thisB.hubObjects.splice(hi, 1);\n                        break;\n                    }\n                }\n                for (var hi = 0; hi < thisB.hubs.length; ++hi) {\n                    var hc = thisB.hubs[hi];\n                    if (typeof hc === 'string') hc = { url: hc };\n                    if (hc.url == tdb.hub.url && !hc.genome || hc.genome == tdb.genome) {\n                        thisB.hubs.splice(hi, 1);\n                        break;\n                    }\n                }\n\n                thisB.notifyTier();\n\n                modeButtonHolder.removeChild(hubButton);\n                activateButton(addModeButtons, addHubButton);\n                switchToHubConnectMode();\n            }, false);\n\n            allOnItem.addEventListener('click', function (ev) {\n                tdb.getTracks(function (tracks, err) {\n                    if (err) {\n                        console.log(err);\n                    }\n\n                    for (var ti = 0; ti < tracks.length; ++ti) {\n                        var ds = tracks[ti].toDallianceSource();\n                        if (!thisB.currentlyActive(ds)) {\n                            thisB.addTier(ds);\n                        }\n                    }\n                });\n            }, false);\n\n            allOffItem.addEventListener('click', function (ev) {\n                tdb.getTracks(function (tracks, err) {\n                    if (err) {\n                        console.log(err);\n                    }\n\n                    for (var ti = 0; ti < tracks.length; ++ti) {\n                        var ds = tracks[ti].toDallianceSource();\n                        if (thisB.currentlyActive(ds)) {\n                            thisB.removeTier(ds);\n                        }\n                    }\n                });\n            }, false);\n        }, false);\n\n        return hubButton;\n    };\n\n    var firstDefButton = null;\n    var firstDefSources = null;\n    for (var g in groupedDefaults) {\n        (function (g, ds) {\n            var defButton = thisB.makeButton(g, 'Browse the default set of data for this browser');\n            defButton.addEventListener('click', function (ev) {\n                ev.preventDefault();ev.stopPropagation();\n                activateButton(addModeButtons, defButton);\n                makeStab(new Observed(ds));\n            }, false);\n            addModeButtons.push(defButton);\n\n            if (!firstDefButton || thisB.defaultTrackAdderTab && thisB.defaultTrackAdderTab == g) {\n                firstDefButton = defButton;\n                firstDefSources = ds;\n            }\n        })(g, groupedDefaults[g]);\n    }\n    var custButton = this.makeButton('DAS', 'Add data using the DAS protocol');\n    addModeButtons.push(custButton);\n    var binButton = this.makeButton('Files', 'Add data from files on disk or the web');\n    addModeButtons.push(binButton);\n\n    for (var hi = 0; hi < this.hubObjects.length; ++hi) {\n        var hub = this.hubObjects[hi];\n        makeHubButton(hub);\n    }\n\n    var addHubButton = this.makeButton('+', 'Connect to a new track-hub');\n    addModeButtons.push(addHubButton);\n\n    var modeButtonHolder = makeElement('ul', addModeButtons, { className: 'nav nav-tabs' }, { marginBottom: '0px' });\n    popup.appendChild(modeButtonHolder);\n\n    var custURL, custName, custCS, custQuant, custFile, custUser, custPass;\n    var customMode = false;\n    var dataToFinalize = null;\n\n    var asform = makeElement('form', null, {}, { display: 'inline-block', width: '100%' });\n    asform.addEventListener('submit', function (ev) {\n        ev.stopPropagation();ev.preventDefault();\n        doAdd();\n        return false;\n    }, true);\n    var stabHolder = makeElement('div');\n    stabHolder.style.position = 'relative';\n    stabHolder.style.overflow = 'scroll';\n    // stabHolder.style.height = '500px';\n    asform.appendChild(stabHolder);\n\n    var __mapping;\n    var __sourceHolder;\n\n    makeStab = function makeStab(msources, mapping) {\n        refreshButton.style.display = 'none';\n        addButton.style.display = 'none';\n        canButton.style.display = 'none';\n        if (__sourceHolder) {\n            __sourceHolder.removeListener(makeStabObserver);\n        }\n        __mapping = mapping;\n        __sourceHolder = msources;\n        __sourceHolder.addListenerAndFire(makeStabObserver);\n    };\n\n    makeStabObserver = function makeStabObserver(msources) {\n        customMode = false;\n        var buttons = [];\n        removeChildren(stabHolder);\n        if (!msources) {\n            stabHolder.appendChild(makeElement('p', 'Dalliance was unable to retrieve data source information from the DAS registry, please try again later'));\n            return;\n        }\n\n        var stabBody = makeElement('tbody', null, { className: 'table table-striped table-condensed' }, { width: '100%' });\n        var stab = makeElement('table', stabBody, { className: 'table table-striped table-condensed' }, { width: '100%', tableLayout: 'fixed' });\n        var idx = 0;\n\n        var sources = [];\n        for (var i = 0; i < msources.length; ++i) {\n            sources.push(msources[i]);\n        }\n\n        sources.sort(function (a, b) {\n            return a.name.toLowerCase().trim().localeCompare(b.name.toLowerCase().trim());\n        });\n\n        for (var i = 0; i < sources.length; ++i) {\n            var source = sources[i];\n            var r = makeElement('tr');\n\n            var bd = makeElement('td', null, {}, { width: '30px' });\n            bd.style.textAlign = 'center';\n            if (!source.props || source.props.cors) {\n                var b = makeElement('input');\n                b.type = 'checkbox';\n                b.dalliance_source = source;\n                b.id = 'sourcecb' + i;\n                if (__mapping) {\n                    b.dalliance_mapping = __mapping;\n                }\n                // b.checked = thisB.currentlyActive(source);\n                bd.appendChild(b);\n                buttons.push(b);\n                b.addEventListener('change', function (ev) {\n                    if (ev.target.checked) {\n                        thisB.addTier(ev.target.dalliance_source);\n                    } else {\n                        thisB.removeTier(ev.target.dalliance_source);\n                    }\n                });\n            } else {\n                bd.appendChild(document.createTextNode('!'));\n                thisB.makeTooltip(bd, makeElement('span', [\"This data source isn't accessible because it doesn't support \", makeElement('a', \"CORS\", { href: 'http://www.w3.org/TR/cors/' }), \".\"]));\n            }\n            r.appendChild(bd);\n            var ld = makeElement('label', null, { htmlFor: 'sourcecb' + i });\n            ld.appendChild(document.createTextNode(source.name));\n            if (source.desc && source.desc.length > 0) {\n                thisB.makeTooltip(ld, source.desc);\n            }\n            r.appendChild(makeElement('td', ld));\n            stabBody.appendChild(r);\n            ++idx;\n        }\n\n        var setChecks = function setChecks() {\n            for (var bi = 0; bi < buttons.length; ++bi) {\n                var b = buttons[bi];\n                var t = thisB.currentlyActive(b.dalliance_source);\n                if (t) {\n                    b.checked = true;\n                } else {\n                    b.checked = false;\n                }\n            }\n        };\n        setChecks();\n        thisB.addTierListener(function (l) {\n            setChecks();\n        });\n\n        stabHolder.appendChild(stab);\n    };\n\n    function makeHubStab(tracks) {\n        refreshButton.style.display = 'none';\n        addButton.style.display = 'none';\n        canButton.style.display = 'none';\n\n        customMode = false;\n        removeChildren(stabHolder);\n\n        var buttonIdSeed = 0;\n\n        var ttab = makeElement('div', null, {}, { width: '100%' });\n        var sources = [];\n        for (var i = 0; i < tracks.length; ++i) {\n            sources.push(tracks[i]);\n        }\n\n        sources.sort(function (a, b) {\n            return a.shortLabel.toLowerCase().trim().localeCompare(b.shortLabel.toLowerCase().trim());\n        });\n\n        var groups = [];\n        var tops = [];\n\n        for (var ti = 0; ti < sources.length; ++ti) {\n            var track = sources[ti];\n            if (track.children && track.children.length > 0 && track.container != 'multiWig') {\n                groups.push(track);\n            } else {\n                tops.push(track);\n            }\n        }\n        if (tops.length > 0) {\n            groups.push({\n                shortLabel: 'Others',\n                priority: -100000000,\n                children: tops });\n        }\n\n        groups.sort(THUB_COMPARE);\n\n        var buttons = [];\n        for (var gi = 0; gi < groups.length; ++gi) {\n            var group = groups[gi];\n            var dg = group;\n            if (!dg.dimensions && dg._parent && dg._parent.dimensions) dg = dg._parent;\n\n            var dprops = {};\n            if (dg.dimensions) {\n                var dtoks = dg.dimensions.split(/(\\w+)=(\\w+)/);\n                for (var dti = 0; dti < dtoks.length - 2; dti += 3) {\n                    dprops[dtoks[dti + 1]] = dtoks[dti + 2];\n                }\n            }\n\n            if (dprops.dimX && dprops.dimY) {\n                var dimX = dprops.dimX,\n                    dimY = dprops.dimY;\n                var sgX = dg.subgroups[dimX];\n                var sgY = dg.subgroups[dimY];\n\n                var trks = {};\n                for (var ci = 0; ci < group.children.length; ++ci) {\n                    var child = group.children[ci];\n                    var vX = child.sgm[dimX],\n                        vY = child.sgm[dimY];\n                    if (!trks[vX]) trks[vX] = {};\n                    trks[vX][vY] = child;\n                }\n\n                var matrix = makeElement('table', null, { className: 'table table-striped table-condensed' }, { tableLayout: 'fixed' });\n                {\n                    var header = makeElement('tr');\n                    header.appendChild(makeElement('th', null, {}, { width: '150px', height: '100px' })); // blank corner element\n                    for (var si = 0; si < sgX.titles.length; ++si) {\n                        var h = makeElement('th', makeElement('div', sgX.titles[si], {}, { transform: 'rotate(-60deg)',\n                            transformOrigin: '0% 100%',\n                            webkitTransform: 'rotate(-60deg) translate(20px,10px)',\n                            webkitTransformOrigin: '0% 100%',\n                            textAlign: 'left' }), {}, { width: '35px',\n                            height: '100px',\n                            verticalAlign: 'bottom' });\n                        header.appendChild(h);\n                    }\n                    matrix.appendChild(header);\n                }\n\n                var mbody = makeElement('tbody', null, { className: 'table table-striped table-condensed' });\n                for (var yi = 0; yi < sgY.titles.length; ++yi) {\n                    var vY = sgY.tags[yi];\n                    var row = makeElement('tr');\n                    row.appendChild(makeElement('th', sgY.titles[yi]), {});\n\n                    for (var xi = 0; xi < sgX.titles.length; ++xi) {\n                        var vX = sgX.tags[xi];\n                        var cell = makeElement('td');\n                        if (trks[vX] && trks[vX][vY]) {\n                            var track = trks[vX][vY];\n                            var ds = track.toDallianceSource();\n                            if (!ds) continue;\n\n                            var r = makeElement('tr');\n                            var bd = makeElement('td');\n                            bd.style.textAlign = 'center';\n\n                            var b = makeElement('input');\n                            b.type = 'checkbox';\n                            b.dalliance_source = ds;\n                            if (__mapping) {\n                                b.dalliance_mapping = __mapping;\n                            }\n                            buttons.push(b);\n                            cell.appendChild(b);\n                            b.addEventListener('change', function (ev) {\n                                if (ev.target.checked) {\n                                    thisB.addTier(ev.target.dalliance_source);\n                                } else {\n                                    thisB.removeTier(ev.target.dalliance_source);\n                                }\n                            });\n                        }\n                        row.appendChild(cell);\n                    }\n                    mbody.appendChild(row);\n                }\n                matrix.appendChild(mbody);\n                ttab.appendChild(makeTreeTableSection(group.shortLabel, matrix, gi == 0));\n            } else {\n                var stabBody = makeElement('tbody', null, { className: 'table table-striped table-condensed' });\n                var stab = makeElement('table', stabBody, { className: 'table table-striped table-condensed' }, { width: '100%', tableLayout: 'fixed' });\n                var idx = 0;\n\n                group.children.sort(THUB_COMPARE);\n                for (var i = 0; i < group.children.length; ++i) {\n                    var buttonId = 'hb' + ++buttonIdSeed;\n\n                    var track = group.children[i];\n                    var ds = track.toDallianceSource();\n                    if (!ds) continue;\n\n                    var r = makeElement('tr');\n                    var bd = makeElement('td', null, {}, { width: '30px' });\n                    bd.style.textAlign = 'center';\n\n                    var b = makeElement('input');\n                    b.type = 'checkbox';\n                    b.dalliance_source = ds;\n                    b.id = buttonId;\n                    if (__mapping) {\n                        b.dalliance_mapping = __mapping;\n                    }\n                    buttons.push(b);\n                    bd.appendChild(b);\n                    b.addEventListener('change', function (ev) {\n                        if (ev.target.checked) {\n                            thisB.addTier(ev.target.dalliance_source);\n                        } else {\n                            thisB.removeTier(ev.target.dalliance_source);\n                        }\n                    });\n\n                    r.appendChild(bd);\n                    var ld = makeElement('label', null, { htmlFor: buttonId });\n                    ld.appendChild(document.createTextNode(track.shortLabel));\n                    if (track.longLabel && track.longLabel.length > 0) {\n                        thisB.makeTooltip(ld, track.longLabel);\n                    }\n                    r.appendChild(makeElement('td', ld));\n                    stabBody.appendChild(r);\n                    ++idx;\n                }\n\n                if (groups.length > 1 || group.shortLabel !== 'Others') {\n                    ttab.appendChild(makeTreeTableSection(group.shortLabel, stab, gi == 0));\n                } else {\n                    ttab.appendChild(stab);\n                }\n            }\n        }\n\n        var setChecks = function setChecks() {\n            for (var bi = 0; bi < buttons.length; ++bi) {\n                var b = buttons[bi];\n                var t = thisB.currentlyActive(b.dalliance_source);\n                if (t) {\n                    b.checked = true;\n                    b.disabled = t.sequenceSource != null;\n                } else {\n                    b.checked = false;\n                }\n            }\n        };\n        setChecks();\n        thisB.addTierListener(function (l) {\n            setChecks();\n        });\n\n        stabHolder.appendChild(ttab);\n    }\n\n    if (regButton) {\n        regButton.addEventListener('click', function (ev) {\n            ev.preventDefault();ev.stopPropagation();\n            activateButton(addModeButtons, regButton);\n            makeStab(thisB.availableSources);\n        }, false);\n    }\n\n    binButton.addEventListener('click', function (ev) {\n        ev.preventDefault();ev.stopPropagation();\n        switchToBinMode();\n    }, false);\n    addHubButton.addEventListener('click', function (ev) {\n        ev.preventDefault();ev.stopPropagation();\n        switchToHubConnectMode();\n    }, false);\n\n    function switchToBinMode() {\n        activateButton(addModeButtons, binButton);\n        customMode = 'bin';\n\n        refreshButton.style.display = 'none';\n        addButton.style.display = 'inline';\n        canButton.style.display = 'none';\n\n        removeChildren(stabHolder);\n        var pageHolder = makeElement('div', null, {}, { paddingLeft: '10px', paddingRight: '10px' });\n        pageHolder.appendChild(makeElement('h3', 'Add custom URL-based data'));\n        pageHolder.appendChild(makeElement('p', ['You can add indexed binary data hosted on an web server that supports CORS (', makeElement('a', 'full details', { href: 'http://www.biodalliance.org/bin.html' }), ').  Currently supported formats are bigwig, bigbed, and indexed BAM.']));\n\n        pageHolder.appendChild(makeElement('br'));\n        pageHolder.appendChild(document.createTextNode('URL: '));\n        custURL = makeElement('input', '', { size: 80, value: 'http://www.biodalliance.org/datasets/ensGene.bb' }, { width: '100%' });\n        pageHolder.appendChild(custURL);\n\n        pageHolder.appendChild(makeElement('br'));\n        pageHolder.appendChild(makeElement('b', '- or -'));\n        pageHolder.appendChild(makeElement('br'));\n        pageHolder.appendChild(document.createTextNode('File: '));\n        custFile = makeElement('input', null, { type: 'file', multiple: 'multiple' });\n        pageHolder.appendChild(custFile);\n\n        pageHolder.appendChild(makeElement('p', 'Clicking the \"Add\" button below will initiate a series of test queries.'));\n\n        stabHolder.appendChild(pageHolder);\n        custURL.focus();\n    }\n\n    function switchToHubConnectMode() {\n        activateButton(addModeButtons, addHubButton);\n        refreshButton.style.display = 'none';\n        addButton.style.display = 'inline';\n        canButton.style.display = 'none';\n\n        customMode = 'hub-connect';\n        refreshButton.style.visibility = 'hidden';\n\n        removeChildren(stabHolder);\n\n        var pageHolder = makeElement('div', null, {}, { paddingLeft: '10px', paddingRight: '10px' });\n        pageHolder.appendChild(makeElement('h3', 'Connect to a track hub.'));\n        pageHolder.appendChild(makeElement('p', ['Enter the top-level URL (usually points to a file called \"hub.txt\") of a UCSC-style track hub']));\n\n        custURL = makeElement('input', '', { size: 120, value: 'http://www.biodalliance.org/datasets/testhub/hub.txt' }, { width: '100%' });\n        pageHolder.appendChild(custURL);\n\n        stabHolder.appendChild(pageHolder);\n\n        custURL.focus();\n    }\n\n    custButton.addEventListener('click', function (ev) {\n        ev.preventDefault();ev.stopPropagation();\n        switchToCustomMode();\n    }, false);\n\n    function switchToCustomMode() {\n        activateButton(addModeButtons, custButton);\n        refreshButton.style.display = 'none';\n        addButton.style.display = 'inline';\n        canButton.style.display = 'none';\n\n        customMode = 'das';\n\n        removeChildren(stabHolder);\n\n        var customForm = makeElement('div', null, {}, { paddingLeft: '10px', paddingRight: '10px' });\n        customForm.appendChild(makeElement('h3', 'Add custom DAS data'));\n        customForm.appendChild(makeElement('p', 'This interface is intended for adding custom or lab-specific data.  Public data can be added more easily via the registry interface.'));\n\n        customForm.appendChild(document.createTextNode('URL: '));\n        customForm.appendChild(makeElement('br'));\n        custURL = makeElement('input', '', { size: 80, value: 'http://www.derkholm.net:8080/das/medipseq_reads/' }, { width: '100%' });\n        customForm.appendChild(custURL);\n\n        customForm.appendChild(makeElement('p', 'Clicking the \"Add\" button below will initiate a series of test queries.  If the source is password-protected, you may be prompted to enter credentials.'));\n        stabHolder.appendChild(customForm);\n\n        custURL.focus();\n    }\n\n    var addButton = makeElement('button', 'Add', { className: 'btn btn-primary' });\n    addButton.addEventListener('click', function (ev) {\n        ev.stopPropagation();ev.preventDefault();\n        doAdd();\n    }, false);\n\n    function doAdd() {\n        if (customMode) {\n            if (customMode === 'das') {\n                var curi = custURL.value.trim();\n                if (!/^.+:\\/\\//.exec(curi)) {\n                    curi = 'http://' + curi;\n                }\n                var nds = new DASSource({ name: 'temporary', uri: curi });\n                tryAddDAS(nds);\n            } else if (customMode === 'bin') {\n                var fileList = custFile.files;\n\n                if (fileList && fileList.length > 0) {\n                    tryAddMultiple(fileList);\n                } else {\n                    var curi = custURL.value.trim();\n                    if (!/^.+:\\/\\//.exec(curi)) {\n                        curi = 'http://' + curi;\n                    }\n                    var source = { uri: curi };\n                    var lcuri = curi.toLowerCase();\n                    if (lcuri.indexOf(\"https://www.encodeproject.org/\") == 0 && lcuri.indexOf(\"@@download\") >= 0) {\n                        source.transport = 'encode';\n                    }\n                    tryAddBin(source);\n                }\n            } else if (customMode === 'reset') {\n                switchToCustomMode();\n            } else if (customMode === 'reset-bin') {\n                switchToBinMode();\n            } else if (customMode === 'reset-hub') {\n                switchToHubConnectMode();\n            } else if (customMode === 'prompt-bai') {\n                var fileList = custFile.files;\n                if (fileList && fileList.length > 0 && fileList[0]) {\n                    dataToFinalize.baiBlob = fileList[0];\n                    completeBAM(dataToFinalize);\n                } else {\n                    promptForBAI(dataToFinalize);\n                }\n            } else if (customMode === 'prompt-tbi') {\n                var fileList = custFile.files;\n                if (fileList && fileList.length > 0 && fileList[0]) {\n                    dataToFinalize.indexBlob = fileList[0];\n                    completeTabixVCF(dataToFinalize);\n                } else {\n                    promptForTabix(dataToFinalize);\n                }\n            } else if (customMode === 'finalize' || customMode === 'finalize-bin') {\n                dataToFinalize.name = custName.value;\n                var m = custCS.value;\n                if (m != '__default__') {\n                    dataToFinalize.mapping = m;\n                } else {\n                    dataToFinalize.mapping = undefined;\n                }\n                if (custQuant) {\n                    dataToFinalize.maxbins = custQuant.checked;\n                }\n\n                if (custUser.value.length > 1 && custPass.value.length > 1) {\n                    dataToFinalize.xUser = custUser.value;\n                    dataToFinalize.xPass = custPass.value;\n                }\n\n                thisB.addTier(dataToFinalize);\n\n                if (customMode == 'finalize-bin') switchToBinMode();else switchToCustomMode();\n            } else if (customMode === 'hub-connect') {\n                var curi = custURL.value.trim();\n                if (!/^.+:\\/\\//.exec(curi)) {\n                    curi = 'http://' + curi;\n                }\n\n                tryAddHub(curi);\n            } else if (customMode === 'multiple') {\n                for (var mi = 0; mi < multipleSet.length; ++mi) {\n                    var s = multipleSet[mi];\n                    if (s.hidden) continue;\n\n                    if (s.tier_type == 'bam' && !s.indexBlob && !s.indexUri) continue;\n                    if (s.tier_type == 'tabix' && !s.indexBlob && !s.indexUri) continue;\n\n                    var nds = makeSourceConfig(s);\n                    if (nds) {\n                        nds.noPersist = true;\n                        thisB.addTier(nds);\n                    }\n                }\n\n                switchToBinMode();\n            }\n        } else {\n            thisB.removeAllPopups();\n        }\n    };\n\n    function tryAddHub(curi, opts, retry) {\n        opts = opts || {};\n        for (var hi = 0; hi < thisB.hubObjects.length; ++hi) {\n            var h = thisB.hubObjects[hi];\n            if (h.hub.url == curi) {\n                for (var bi = 0; bi < addModeButtons.length; ++bi) {\n                    if (addModeButtons[bi].hub == h) {\n                        activateButton(addModeButtons, addModeButtons[bi]);\n                    }\n                }\n                h.getTracks(function (tracks, err) {\n                    if (err) {\n                        console.log(err);\n                    }\n                    makeHubStab(tracks);\n                });\n                return;\n            }\n        }\n\n        connectTrackHub(curi, function (hub, err) {\n            if (err) {\n                if (!retry) {\n                    return tryAddHub(curi, { credentials: true }, true);\n                }\n                removeChildren(stabHolder);\n                stabHolder.appendChild(makeElement('h2', 'Error connecting to track hub'));\n                stabHolder.appendChild(makeElement('p', err));\n                customMode = 'reset-hub';\n                return;\n            } else {\n                var bestHub = null;\n                var bestHubButton = null;\n                for (var genome in hub.genomes) {\n                    var mapping = null;\n                    var okay = false;\n\n                    if (genome == thisB.coordSystem.ucscName) {\n                        okay = true;\n                    } else {\n                        for (var mid in thisB.chains) {\n                            var m = thisB.chains[mid];\n                            if (genome == m.coords.ucscName) {\n                                mapping = mid;\n                                okay = true;\n                            }\n                        }\n                    }\n\n                    if (okay) {\n                        var hc = { url: curi, genome: genome };\n                        if (opts.credentials) hc.credentials = true;\n                        if (mapping) {\n                            hc.mapping = mapping;\n                            hub.genomes[genome].mapping = mapping;\n                        }\n                        thisB.hubs.push(hc);\n                        thisB.hubObjects.push(hub.genomes[genome]);\n\n                        var hubButton = makeHubButton(hub.genomes[genome]);\n                        modeButtonHolder.appendChild(hubButton);\n\n                        if (!mapping || !bestHub) {\n                            bestHub = hub.genomes[genome];\n                            bestHubButton = hubButton;\n                        }\n                    }\n                }\n\n                if (bestHub) {\n                    thisB.notifyTier();\n                    activateButton(addModeButtons, bestHubButton);\n                    bestHub.getTracks(function (tracks, err) {\n                        makeHubStab(tracks);\n                    });\n                } else {\n                    removeChildren(stabHolder);\n                    stabHolder.appendChild(makeElement('h2', 'No data for this genome'));\n                    stabHolder.appendChild(makeElement('p', 'This URL appears to be a valid track-hub, but it doesn\\'t contain any data for the coordinate system of this browser'));\n                    stabHolder.appendChild(makeElement('p', 'coordSystem.ucscName = ' + thisB.coordSystem.ucscName));\n                    customMode = 'reset-hub';\n                    return;\n                }\n            }\n        }, opts);\n    }\n\n    var tryAddDAS = function tryAddDAS(nds, retry) {\n        var knownSpace = thisB.knownSpace;\n        if (!knownSpace) {\n            alert(\"Can't confirm track-addition to an uninit browser.\");\n            return;\n        }\n        var tsm = Math.max(knownSpace.min, (knownSpace.min + knownSpace.max - 100) / 2) | 0;\n        var testSegment = new DASSegment(knownSpace.chr, tsm, Math.min(tsm + 99, knownSpace.max));\n        nds.features(testSegment, {}, function (features, status) {\n            if (status) {\n                if (!retry) {\n                    nds.credentials = true;\n                    tryAddDAS(nds, true);\n                } else {\n                    removeChildren(stabHolder);\n                    stabHolder.appendChild(makeElement('h2', 'Custom data not found'));\n                    stabHolder.appendChild(makeElement('p', 'DAS uri: ' + nds.uri + ' is not answering features requests'));\n                    customMode = 'reset';\n                    return;\n                }\n            } else {\n                var nameExtractPattern = new RegExp('/([^/]+)/?$');\n                var match = nameExtractPattern.exec(nds.uri);\n                if (match) {\n                    nds.name = match[1];\n                }\n\n                tryAddDASxSources(nds);\n                return;\n            }\n        });\n    };\n\n    function tryAddDASxSources(nds, retry) {\n        var uri = nds.uri;\n        if (retry) {\n            var match = /(.+)\\/[^\\/]+\\/?/.exec(uri);\n            if (match) {\n                uri = match[1] + '/sources';\n            }\n        }\n        function sqfail() {\n            if (!retry) {\n                return tryAddDASxSources(nds, true);\n            } else {\n                return addDasCompletionPage(nds);\n            }\n        }\n        new DASRegistry(uri, { credentials: nds.credentials }).sources(function (sources) {\n            if (!sources || sources.length == 0) {\n                return sqfail();\n            }\n\n            var fs = null;\n            if (sources.length == 1) {\n                fs = sources[0];\n            } else {\n                for (var i = 0; i < sources.length; ++i) {\n                    if (sources[i].uri === nds.uri) {\n                        fs = sources[i];\n                        break;\n                    }\n                }\n            }\n\n            var coordsDetermined = false,\n                quantDetermined = false;\n            if (fs) {\n                nds.name = fs.name;\n                nds.desc = fs.desc;\n                if (fs.maxbins) {\n                    nds.maxbins = true;\n                } else {\n                    nds.maxbins = false;\n                }\n                if (fs.capabilities) {\n                    nds.capabilities = fs.capabilities;\n                }\n                quantDetermined = true;\n\n                if (fs.coords && fs.coords.length == 1) {\n                    var coords = fs.coords[0];\n                    if (coordsMatch(coords, thisB.coordSystem)) {\n                        coordsDetermined = true;\n                    } else if (thisB.chains) {\n                        for (var k in thisB.chains) {\n                            if (coordsMatch(coords, thisB.chains[k].coords)) {\n                                nds.mapping = k;\n                                coordsDetermined = true;\n                            }\n                        }\n                    }\n                }\n            }\n            return addDasCompletionPage(nds, coordsDetermined, quantDetermined);\n        }, function () {\n            return sqfail();\n        });\n    }\n\n    var makeSourceConfig = function makeSourceConfig(s) {\n        var nds = { name: s.name };\n        if (s.credentials) nds.credentials = s.credentials;\n\n        if (s.mapping && s.mapping != '__default__') nds.mapping = s.mapping;\n\n        if (s.transport) nds.transport = s.transport;\n\n        if (s.tier_type == 'bwg') {\n            if (s.blob) nds.bwgBlob = s.blob;else if (s.uri) nds.bwgURI = s.uri;\n            return nds;\n        } else if (s.tier_type == 'bam') {\n            if (s.blob) {\n                nds.bamBlob = s.blob;\n                nds.baiBlob = s.indexBlob;\n            } else {\n                nds.bamURI = s.uri;\n                nds.baiURI = s.indexUri;\n            }\n            return nds;\n        } else if (s.tier_type == 'tabix') {\n            nds.tier_type = 'tabix';\n            nds.payload = s.payload;\n            if (s.blob) {\n                nds.blob = s.blob;\n                nds.indexBlob = s.indexBlob;\n            } else {\n                nds.uri = s.uri;\n                nds.indexUri = s.indexUri;\n            }\n            return nds;\n        } else if (s.tier_type == 'memstore') {\n            nds.tier_type = 'memstore';\n            nds.payload = s.payload;\n            if (s.blob) nds.blob = s.blob;else nds.uri = s.uri;\n            return nds;\n        }\n    };\n\n    var tryAddBin = function tryAddBin(source) {\n        probeResource(source, function (source, err) {\n            if (err) {\n                removeChildren(stabHolder);\n                var tabError = makeElement('div');\n                tabError.appendChild(makeElement('h2', \"Couldn't access custom data\"));\n                tabError.appendChild(makeElement('p', '' + err));\n                stabHolder.appendChild(tabError);\n                console.log(source);\n                if (window.location.protocol === 'https:' && source.uri.indexOf('http:') == 0) {\n                    thisB.canFetchPlainHTTP().then(function (can) {\n                        if (!can) {\n                            tabError.appendChild(makeElement('p', [makeElement('strong', 'HTTP warning: '), 'you may not be able to access HTTP resources from an instance of Biodalliance which you are accessing via HTTPS.', makeElement('a', '[More info]', { href: thisB.httpWarningURL, target: \"_blank\" })]));\n                        }\n                    });\n                }\n                customMode = 'reset-bin';\n            } else {\n                var nds = makeSourceConfig(source);\n                if (source.tier_type == 'bam') {\n                    return completeBAM(nds);\n                } else if (source.tier_type == 'tabix') {\n                    return completeTabixVCF(nds);\n                } else {\n                    return addDasCompletionPage(nds, false, false, true);\n                }\n            }\n        });\n    };\n\n    function promptForBAI(nds) {\n        refreshButton.style.display = 'none';\n        addButton.style.display = 'inline';\n        canButton.style.display = 'inline';\n\n        removeChildren(stabHolder);\n        customMode = 'prompt-bai';\n        stabHolder.appendChild(makeElement('h2', 'Select an index file'));\n        stabHolder.appendChild(makeElement('p', 'Dalliance requires a BAM index (.bai) file when displaying BAM data.  These normally accompany BAM files.  For security reasons, web applications like Dalliance can only access local files which you have explicity selected.  Please use the file chooser below to select the appropriate BAI file'));\n\n        stabHolder.appendChild(document.createTextNode('Index file: '));\n        custFile = makeElement('input', null, { type: 'file' });\n        stabHolder.appendChild(custFile);\n        dataToFinalize = nds;\n    }\n\n    function promptForTabix(nds) {\n        refreshButton.style.display = 'none';\n        addButton.style.display = 'inline';\n        canButton.style.display = 'inline';\n\n        removeChildren(stabHolder);\n        customMode = 'prompt-tbi';\n        stabHolder.appendChild(makeElement('h2', 'Select an index file'));\n        stabHolder.appendChild(makeElement('p', 'Dalliance requires a Tabix index (.tbi) file when displaying VCF data.  For security reasons, web applications like Dalliance can only access local files which you have explicity selected.  Please use the file chooser below to select the appropriate BAI file'));\n\n        stabHolder.appendChild(document.createTextNode('Index file: '));\n        custFile = makeElement('input', null, { type: 'file' });\n        stabHolder.appendChild(custFile);\n        dataToFinalize = nds;\n    }\n\n    function completeBAM(nds) {\n        var indexF;\n        if (nds.baiBlob) indexF = new BlobFetchable(nds.baiBlob);else if (nds.transport == 'encode') indexF = new EncodeFetchable(nds.bamURI + '.bai');else indexF = new URLFetchable(nds.bamURI + '.bai', { credentials: nds.credentials });\n\n        indexF.slice(0, 256).fetch(function (r) {\n            var hasBAI = false;\n            if (r) {\n                var ba = new Uint8Array(r);\n                var magic2 = readInt(ba, 0);\n                hasBAI = magic2 == BAI_MAGIC;\n            }\n            if (hasBAI) {\n                return addDasCompletionPage(nds, false, false, true);\n            } else {\n                return binFormatErrorPage('You have selected a valid BAM file, but a corresponding index (.bai) file was not found.  Please index your BAM (samtools index) and place the BAI file in the same directory');\n            }\n        });\n    }\n\n    function completeTabixVCF(nds) {\n        var indexF;\n        if (nds.indexBlob) {\n            indexF = new BlobFetchable(nds.indexBlob);\n        } else {\n            indexF = new URLFetchable(nds.uri + '.tbi');\n        }\n        indexF.slice(0, 1 << 16).fetch(function (r) {\n            var hasTabix = false;\n            if (r) {\n                var ba = new Uint8Array(r);\n                if (ba[0] == 31 || ba[1] == 139) {\n                    var unc = unbgzf(r);\n                    ba = new Uint8Array(unc);\n                    var m2 = readInt(ba, 0);\n                    hasTabix = m2 == TABIX_MAGIC;\n                }\n            }\n            if (hasTabix) {\n                return addDasCompletionPage(nds, false, false, true);\n            } else {\n                return binFormatErrorPage('You have selected a valid VCF file, but a corresponding index (.tbi) file was not found.  Please index your VCF (\"tabix -p vcf -f myfile.vcf.gz\") and place the .tbi file in the same directory');\n            }\n        });\n    }\n\n    function binFormatErrorPage(message) {\n        refreshButton.style.display = 'none';\n        addButton.style.display = 'inline';\n        canButton.style.display = 'inline';\n\n        removeChildren(stabHolder);\n        message = message || 'Custom data format not recognized';\n        stabHolder.appendChild(makeElement('h2', 'Error adding custom data'));\n        stabHolder.appendChild(makeElement('p', message));\n        stabHolder.appendChild(makeElement('p', 'Currently supported formats are bigBed, bigWig, and BAM.'));\n        customMode = 'reset-bin';\n        return;\n    }\n\n    var addDasCompletionPage = function addDasCompletionPage(nds, coordsDetermined, quantDetermined, quantIrrelevant) {\n        refreshButton.style.display = 'none';\n        addButton.style.display = 'inline';\n        canButton.style.display = 'inline';\n\n        removeChildren(stabHolder);\n        stabHolder.appendChild(makeElement('h2', 'Add custom data: step 2'));\n        stabHolder.appendChild(document.createTextNode('Label: '));\n        custName = makeElement('input', '', { value: nds.name });\n        stabHolder.appendChild(custName);\n\n        // stabHolder.appendChild(document.createTextNode('User: '));\n        custUser = makeElement('input', '');\n        // stabHolder.appendChild(custUser);\n        //stabHolder.appendChild(document.createTextNode('Pass: '));\n        custPass = makeElement('input', '');\n        // stabHolder.appendChild(custPass);\n\n\n        stabHolder.appendChild(makeElement('br'));\n        stabHolder.appendChild(makeElement('br'));\n        stabHolder.appendChild(makeElement('h4', 'Coordinate system: '));\n        custCS = makeElement('select', null);\n        custCS.appendChild(makeElement('option', thisB.nameForCoordSystem(thisB.coordSystem), { value: '__default__' }));\n        if (thisB.chains) {\n            for (var csk in thisB.chains) {\n                var cs = thisB.chains[csk].coords;\n                custCS.appendChild(makeElement('option', thisB.nameForCoordSystem(cs), { value: csk }));\n            }\n        }\n        custCS.value = nds.mapping || '__default__';\n        stabHolder.appendChild(custCS);\n\n        if (coordsDetermined) {\n            stabHolder.appendChild(makeElement('p', \"(Based on server response, probably doesn't need changing.)\"));\n        } else {\n            stabHolder.appendChild(makeElement('p', [makeElement('b', 'Warning: '), \"unable to determine the correct value from server responses.  Please check carefully.\"]));\n            stabHolder.appendChild(makeElement('p', \"If you don't see the mapping you're looking for, please contact thomas@biodalliance.org\"));\n        }\n\n        if (!quantIrrelevant) {\n            stabHolder.appendChild(document.createTextNode('Quantitative: '));\n            custQuant = makeElement('input', null, { type: 'checkbox', checked: true });\n            if (typeof nds.maxbins !== 'undefined') {\n                custQuant.checked = nds.maxbins;\n            }\n            stabHolder.appendChild(custQuant);\n            if (quantDetermined) {\n                stabHolder.appendChild(makeElement('p', \"(Based on server response, probably doesn't need changing.)\"));\n            } else {\n                stabHolder.appendChild(makeElement('p', [makeElement('b', \"Warning: \"), \"unable to determine correct value.  If in doubt, leave checked.\"]));\n            }\n        }\n\n        if (nds.bwgBlob) {\n            stabHolder.appendChild(makeElement('p', [makeElement('b', 'Warning: '), 'data added from local file.  Due to the browser security model, the track will disappear if you reload Dalliance.']));\n        }\n\n        custName.focus();\n\n        if (customMode === 'bin' || customMode === 'prompt-bai' || customMode === 'prompt-tbi') customMode = 'finalize-bin';else customMode = 'finalize';\n        dataToFinalize = nds;\n    };\n\n    var multipleSet = null;\n    var tryAddMultiple = function tryAddMultiple(fileList) {\n        var newSources = multipleSet = [];\n        customMode = 'multiple';\n        for (var fi = 0; fi < fileList.length; ++fi) {\n            var f = fileList[fi];\n            if (f) {\n                newSources.push({ blob: f });\n            }\n        }\n\n        for (var fi = 0; fi < newSources.length; ++fi) {\n            probeMultiple(newSources[fi]);\n        }\n        updateMultipleStatus();\n    };\n\n    var probeMultiple = function probeMultiple(ns) {\n        probeResource(ns, function (source, err) {\n            if (err) {\n                source.error = err;\n            }\n\n            var usedIndices = [];\n            var bams = {},\n                tabixes = {};\n            for (var si = 0; si < multipleSet.length; ++si) {\n                var s = multipleSet[si];\n                if (s.tier_type == 'bam' && !s.indexBlob) {\n                    bams[s.blob.name] = s;\n                }\n                if (s.tier_type == 'tabix' && !s.indexBlob) {\n                    tabixes[s.blob.name] = s;\n                }\n            }\n\n            for (var si = 0; si < multipleSet.length; ++si) {\n                var s = multipleSet[si];\n                if (s.tier_type === 'bai') {\n                    var baiPattern = new RegExp('(.+)\\\\.bai$');\n                    var match = baiPattern.exec(s.blob.name);\n                    if (match && bams[match[1]]) {\n                        bams[match[1]].indexBlob = s.blob;\n                        usedIndices.push(si);\n                    }\n                } else if (s.tier_type === 'tabix-index') {\n                    var tbiPattern = new RegExp('(.+)\\\\.tbi$');\n                    var match = tbiPattern.exec(s.blob.name);\n                    if (match && tabixes[match[1]]) {\n                        tabixes[match[1]].indexBlob = s.blob;\n                        usedIndices.push(si);\n                    }\n                }\n            }\n\n            for (var bi = usedIndices.length - 1; bi >= 0; --bi) {\n                multipleSet.splice(usedIndices[bi], 1);\n            }\n\n            updateMultipleStatus();\n        });\n    };\n\n    var updateMultipleStatus = function updateMultipleStatus() {\n        removeChildren(stabHolder);\n        var needsIndex = false;\n        var multTable = makeElement('table', multipleSet.filter(function (s) {\n            return !s.hidden;\n        }).map(function (s) {\n            var row = makeElement('tr');\n            row.appendChild(makeElement('td', s.name || s.blob.name));\n            var typeContent;\n            if (s.error) {\n                typeContent = makeElement('span', 'Error', null, { color: 'red' });\n            } else if (s.tier_type) {\n                typeContent = s.payload || s.tier_type;\n            } else {\n                typeContent = thisB.makeLoader(16);\n            }\n\n            var ccs;\n            var state = 'unknown';\n            if (s.tier_type == 'bwg' || s.tier_type == 'memstore') {\n                state = 'okay';\n            } else if (s.tier_type == 'bam') {\n                state = s.indexBlob ? 'okay' : 'needs-index';\n            } else if (s.tier_type == 'tabix') {\n                state = s.indexBlob ? 'okay' : 'needs-index';\n            }\n\n            if (state == 'okay') {\n                ccs = makeElement('select', null, null, { width: '150px' });\n                ccs.appendChild(makeElement('option', thisB.nameForCoordSystem(thisB.coordSystem), { value: '__default__' }));\n                if (thisB.chains) {\n                    for (var csk in thisB.chains) {\n                        var cs = thisB.chains[csk].coords;\n                        ccs.appendChild(makeElement('option', thisB.nameForCoordSystem(cs), { value: csk }));\n                    }\n                }\n                ccs.value = s.mapping || '__default__';\n\n                ccs.addEventListener('change', function (ev) {\n                    s.mapping = ccs.value;\n                    console.log(s);\n                }, false);\n            } else if (state == 'needs-index') {\n                ccs = makeElement('span', 'Needs index', {}, { color: 'red' });\n                needsIndex = true;\n            }\n\n            return makeElement('tr', [makeElement('td', s.name || s.blob.name), makeElement('td', typeContent), makeElement('td', ccs)]);\n        }), { className: 'table table-striped table-condensed' });\n        stabHolder.appendChild(multTable);\n\n        if (needsIndex) {\n            stabHolder.appendChild(makeElement('p', 'Some of these files are missing required index (.bai or .tbi) files.  For security reasons, web applications like Dalliance can only access local files which you have explicity selected.  Please use the file chooser below to select the appropriate index file'));\n            stabHolder.appendChild(document.createTextNode('Index file(s): '));\n            var indexFile = makeElement('input', null, { type: 'file', multiple: 'multiple' });\n            stabHolder.appendChild(indexFile);\n            indexFile.addEventListener('change', function (ev) {\n                console.log('fileset changed');\n                var fileList = indexFile.files || [];\n                for (var fi = 0; fi < fileList.length; ++fi) {\n                    var f = fileList[fi];\n                    if (f) {\n                        var ns = { blob: f, hidden: true };\n                        multipleSet.push(ns);\n                        probeMultiple(ns);\n                    }\n                }\n            }, false);\n        }\n    };\n\n    var canButton = makeElement('button', 'Cancel', { className: 'btn' });\n    canButton.addEventListener('click', function (ev) {\n        ev.stopPropagation();ev.preventDefault();\n        if (customMode === 'finalize-bin') switchToBinMode();else switchToCustomMode();\n    }, false);\n\n    var refreshButton = makeElement('button', 'Refresh', { className: 'btn' });\n    refreshButton.addEventListener('click', function (ev) {\n        ev.stopPropagation();ev.preventDefault();\n        thisB.queryRegistry(__mapping);\n    }, false);\n    this.makeTooltip(refreshButton, 'Click to re-fetch data from the DAS registry');\n\n    var buttonHolder = makeElement('div', [addButton, ' ', canButton, ' ', refreshButton]);\n    buttonHolder.style.margin = '10px';\n    asform.appendChild(buttonHolder);\n\n    popup.appendChild(asform);\n    makeStab(thisB.availableSources);\n\n    this.showToolPanel(popup);\n    this.setUiMode('add');\n\n    if (firstDefButton) {\n        activateButton(addModeButtons, firstDefButton);\n        makeStab(new Observed(firstDefSources));\n    }\n};\n\n},{\"./bam\":1,\"./bin\":4,\"./cbrowser\":6,\"./das\":11,\"./domui\":13,\"./encode\":15,\"./lh3utils\":27,\"./probe\":32,\"./sourcecompare\":40,\"./tabix\":47,\"./thub\":49,\"./utils\":56}],54:[function(require,module,exports){\n/* -*- mode: javascript; c-basic-offset: 4; indent-tabs-mode: nil -*- */\n\n// \n// Dalliance Genome Explorer\n// (c) Thomas Down 2006-2010\n//\n// trix.js: UCSC-style free text indices\n//\n\n\"use strict\";\n\nfunction connectTrix(ix, ixx, callback) {\n    ixx.fetchAsText(function (ixxData) {\n        if (!ixxData) return callback(null, \"Couldn't fetch index-index\");\n\n        var toks = ixxData.split(/(.+)([0-9A-F]{10})\\n/);\n\n        var keys = [];\n        var offsets = [];\n        for (var ti = 1; ti < toks.length; ti += 3) {\n            keys.push(toks[ti]);\n            offsets.push(parseInt(toks[ti + 1], 16));\n        }\n\n        return callback(new TrixIndex(keys, offsets, ix));\n    });\n}\n\nfunction TrixIndex(keys, offsets, ix) {\n    this.keys = keys;\n    this.offsets = offsets;\n    this.ix = ix;\n}\n\nTrixIndex.prototype.lookup = function (query, callback) {\n    var ixslice;\n\n    var qtag = (query + '     ').substring(0, 5).toLowerCase();\n    for (var i = 0; i < this.keys.length; ++i) {\n        if (qtag.localeCompare(this.keys[i]) < 0) {\n            ixslice = this.ix.slice(this.offsets[i - 1], this.offsets[i] - this.offsets[i - 1]);\n            break;\n        }\n    }\n\n    if (!ixslice) {\n        ixslice = this.ix.slice(this.offsets[this.offsets.length - 1]);\n    }\n\n    ixslice.fetchAsText(function (ist) {\n        var lines = ist.split('\\n');\n        for (var li = 0; li < lines.length; ++li) {\n            if (lines[li].indexOf(query.toLowerCase() + ' ') == 0) {\n                return callback(lines[li].split(' '));\n            }\n        }\n        return callback(null);\n    });\n};\n\nif (typeof module !== 'undefined') {\n    module.exports = {\n        connectTrix: connectTrix\n    };\n}\n\n},{}],55:[function(require,module,exports){\n/* -*- mode: javascript; c-basic-offset: 4; indent-tabs-mode: nil -*- */\n\n// \n// Dalliance Genome Explorer\n// (c) Thomas Down 2006-2010\n//\n// twoBit.js: packed-binary reference sequences\n//\n\n\"use strict\";\n\nif (typeof require !== 'undefined') {\n    var bin = require('./bin');\n    var readInt = bin.readInt;\n    var readIntBE = bin.readIntBE;\n\n    var spans = require('./spans');\n    var Range = spans.Range;\n    var union = spans.union;\n    var intersection = spans.intersection;\n}\n\nvar TWOBIT_MAGIC = 0x1a412743;\nvar TWOBIT_MAGIC_BE = 0x4327411a;\nvar HEADER_BLOCK_SIZE = 12500;\n\nfunction TwoBitFile() {}\n\nfunction makeTwoBit(fetchable, cnt) {\n    var tb = new TwoBitFile();\n    tb.data = fetchable;\n    var headerBlockSize = HEADER_BLOCK_SIZE;\n    var headerBlocksFetched = 0;\n\n    tb.data.slice(0, headerBlockSize).fetch(function (r) {\n        if (!r) {\n            return cnt(null, \"Couldn't access data\");\n        }\n        var ba = new Uint8Array(r);\n        var magic = readInt(ba, 0);\n        if (magic == TWOBIT_MAGIC) {\n            tb.readInt = readInt;\n        } else if (magic == TWOBIT_MAGIC_BE) {\n            tb.readInt = readIntBE;\n        } else {\n            return cnt(null, \"Not a .2bit file, magic=0x\" + magic.toString(16));\n        }\n\n        var version = tb.readInt(ba, 4);\n        if (version != 0) {\n            return cnt(null, 'Unsupported version ' + version);\n        }\n\n        tb.seqCount = tb.readInt(ba, 8);\n        tb.seqDict = {};\n\n        var p = 16,\n            i = 0;\n        var o = 0; // Offset of the current block if we need to fetch multiple header blocks.\n\n        var parseSeqInfo = function parseSeqInfo() {\n            while (i < tb.seqCount) {\n                var ns = ba[p];\n                if (p + ns + 6 >= ba.length) {\n                    headerBlocksFetched += headerBlockSize;\n                    headerBlockSize = Math.max(HEADER_BLOCK_SIZE, Math.floor(headerBlocksFetched * tb.seqCount / i));\n                    return tb.data.slice(o + p, headerBlockSize).fetch(function (r) {\n                        o += p;\n                        p = 0;\n                        ba = new Uint8Array(r);\n                        parseSeqInfo();\n                    });\n                } else {\n                    ++p;\n                    var name = '';\n                    for (var j = 1; j <= ns; ++j) {\n                        name += String.fromCharCode(ba[p++]);\n                    }\n                    var offset = tb.readInt(ba, p);\n                    p += 4;\n                    tb.seqDict[name] = new TwoBitSeq(tb, offset);\n                    ++i;\n                }\n            }\n            return cnt(tb);\n        };\n\n        parseSeqInfo();\n    });\n}\n\nTwoBitFile.prototype.getSeq = function (chr) {\n    var seq = this.seqDict[chr];\n    if (!seq) {\n        seq = this.seqDict['chr' + chr];\n    }\n    return seq;\n};\n\nTwoBitFile.prototype.fetch = function (chr, min, max, cnt) {\n    var seq = this.getSeq(chr);\n    if (!seq) {\n        return cnt(null, \"Couldn't find \" + chr);\n    } else if (max <= min) {\n        return cnt('');\n    } else {\n        seq.fetch(min, max, cnt);\n    }\n};\n\nfunction TwoBitSeq(tbf, offset) {\n    this.tbf = tbf;\n    this.offset = offset;\n}\n\nTwoBitSeq.prototype.init = function (cnt) {\n    if (this.seqOffset) {\n        return cnt();\n    }\n\n    var thisB = this;\n    thisB.tbf.data.slice(thisB.offset, 8).fetch(function (r1) {\n        if (!r1) {\n            return cnt('Fetch failed');\n        }\n        var ba = new Uint8Array(r1);\n        thisB._length = thisB.tbf.readInt(ba, 0);\n        thisB.nBlockCnt = thisB.tbf.readInt(ba, 4);\n        thisB.tbf.data.slice(thisB.offset + 8, thisB.nBlockCnt * 8 + 4).fetch(function (r2) {\n            if (!r2) {\n                return cnt('Fetch failed');\n            }\n            var ba = new Uint8Array(r2);\n            var nbs = null;\n            for (var b = 0; b < thisB.nBlockCnt; ++b) {\n                var nbMin = thisB.tbf.readInt(ba, b * 4);\n                var nbLen = thisB.tbf.readInt(ba, (b + thisB.nBlockCnt) * 4);\n                var nb = new Range(nbMin, nbMin + nbLen - 1);\n                if (!nbs) {\n                    nbs = nb;\n                } else {\n                    nbs = union(nbs, nb);\n                }\n            }\n            thisB.nBlocks = nbs;\n            thisB.mBlockCnt = thisB.tbf.readInt(ba, thisB.nBlockCnt * 8);\n            thisB.seqLength = (thisB._length + 3) / 4 | 0;\n            thisB.seqOffset = thisB.offset + 16 + (thisB.nBlockCnt + thisB.mBlockCnt) * 8;\n            return cnt();\n        });\n    });\n};\n\nvar TWOBIT_TABLE = ['T', 'C', 'A', 'G'];\n\nTwoBitSeq.prototype.fetch = function (min, max, cnt) {\n    --min;--max; // Switch to zero-based.\n    var thisB = this;\n    this.init(function (error) {\n        if (error) {\n            return cnt(null, error);\n        }\n\n        var fetchMin = min >> 2;\n        var fetchMax = max + 3 >> 2;\n        if (fetchMin < 0 || fetchMax > thisB.seqLength) {\n            return cnt('Coordinates out of bounds: ' + min + ':' + max);\n        }\n\n        thisB.tbf.data.slice(thisB.seqOffset + fetchMin, fetchMax - fetchMin).salted().fetch(function (r) {\n            if (r == null) {\n                return cnt('SeqFetch failed');\n            }\n            var seqData = new Uint8Array(r);\n\n            var nSpans = [];\n            if (thisB.nBlocks) {\n                var intr = intersection(new Range(min, max), thisB.nBlocks);\n                if (intr) {\n                    nSpans = intr.ranges();\n                }\n            }\n\n            var seqstr = '';\n            var ptr = min;\n            function fillSeq(fsm) {\n                while (ptr <= fsm) {\n                    var bb = (ptr >> 2) - fetchMin;\n                    var ni = ptr & 0x3;\n                    var bv = seqData[bb];\n                    var n;\n                    if (ni == 0) {\n                        n = bv >> 6 & 0x3;\n                    } else if (ni == 1) {\n                        n = bv >> 4 & 0x3;\n                    } else if (ni == 2) {\n                        n = bv >> 2 & 0x3;\n                    } else {\n                        n = bv & 0x3;\n                    }\n                    seqstr += TWOBIT_TABLE[n];\n                    ++ptr;\n                }\n            }\n\n            for (var b = 0; b < nSpans.length; ++b) {\n                var nb = nSpans[b];\n                if (ptr > nb.min()) {\n                    throw 'N mismatch...';\n                }\n                if (ptr < nb.min()) {\n                    fillSeq(nb.min() - 1);\n                }\n                while (ptr <= nb.max()) {\n                    seqstr += 'N';\n                    ++ptr;\n                }\n            }\n            if (ptr <= max) {\n                fillSeq(max);\n            }\n            return cnt(seqstr);\n        });\n    });\n};\n\nTwoBitSeq.prototype.length = function (cnt) {\n    var thisB = this;\n    this.init(function (error) {\n        if (error) {\n            return cnt(null, error);\n        } else {\n            return cnt(thisB._length);\n        }\n    });\n};\n\nif (typeof module !== 'undefined') {\n    module.exports = {\n        makeTwoBit: makeTwoBit\n    };\n}\n\n},{\"./bin\":4,\"./spans\":41}],56:[function(require,module,exports){\n/* -*- mode: javascript; c-basic-offset: 4; indent-tabs-mode: nil -*- */\n\n// \n// Dalliance Genome Explorer\n// (c) Thomas Down 2006-2010\n//\n// utils.js: odds, sods, and ends.\n//\n\n\"use strict\";\n\nvar _typeof = typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; };\n\nif (typeof require !== 'undefined') {\n    var sha1 = require('./sha1');\n    var b64_sha1 = sha1.b64_sha1;\n}\n\nvar NUM_REGEXP = new RegExp('[0-9]+');\n\nfunction stringToNumbersArray(str) {\n    var nums = new Array();\n    var m;\n    while (m = NUM_REGEXP.exec(str)) {\n        nums.push(m[0]);\n        str = str.substring(m.index + m[0].length);\n    }\n    return nums;\n}\n\nvar STRICT_NUM_REGEXP = new RegExp('^[0-9]+$');\n\nfunction stringToInt(str) {\n    str = str.replace(new RegExp(',', 'g'), '');\n    if (!STRICT_NUM_REGEXP.test(str)) {\n        return null;\n    }\n    return str | 0;\n}\n\nfunction pushnew(a, v) {\n    for (var i = 0; i < a.length; ++i) {\n        if (a[i] == v) {\n            return;\n        }\n    }\n    a.push(v);\n}\n\nfunction pusho(obj, k, v) {\n    if (obj[k]) {\n        obj[k].push(v);\n    } else {\n        obj[k] = [v];\n    }\n}\n\nfunction pushnewo(obj, k, v) {\n    var a = obj[k];\n    if (a) {\n        for (var i = 0; i < a.length; ++i) {\n            // indexOf requires JS16 :-(.\n            if (a[i] == v) {\n                return;\n            }\n        }\n        a.push(v);\n    } else {\n        obj[k] = [v];\n    }\n}\n\nfunction pick(a, b, c, d) {\n    if (a) {\n        return a;\n    } else if (b) {\n        return b;\n    } else if (c) {\n        return c;\n    } else if (d) {\n        return d;\n    }\n}\n\nfunction pushnew(l, o) {\n    for (var i = 0; i < l.length; ++i) {\n        if (l[i] == o) {\n            return;\n        }\n    }\n    l.push(o);\n}\n\nfunction arrayIndexOf(a, x) {\n    if (!a) {\n        return -1;\n    }\n\n    for (var i = 0; i < a.length; ++i) {\n        if (a[i] === x) {\n            return i;\n        }\n    }\n    return -1;\n}\n\nfunction arrayRemove(a, x) {\n    var i = arrayIndexOf(a, x);\n    if (i >= 0) {\n        a.splice(i, 1);\n        return true;\n    }\n    return false;\n}\n\n//\n// DOM utilities\n//\n\n\nfunction makeElement(tag, children, attribs, styles) {\n    var ele = document.createElement(tag);\n    if (children) {\n        if (!(children instanceof Array)) {\n            children = [children];\n        }\n        for (var i = 0; i < children.length; ++i) {\n            var c = children[i];\n            if (c) {\n                if (typeof c == 'string') {\n                    c = document.createTextNode(c);\n                } else if (typeof c == 'number') {\n                    c = document.createTextNode('' + c);\n                }\n                ele.appendChild(c);\n            }\n        }\n    }\n\n    if (attribs) {\n        for (var l in attribs) {\n            try {\n                ele[l] = attribs[l];\n            } catch (e) {\n                console.log('error setting ' + l);\n                throw e;\n            }\n        }\n    }\n    if (styles) {\n        for (var l in styles) {\n            ele.style[l] = styles[l];\n        }\n    }\n    return ele;\n}\n\nfunction makeElementNS(namespace, tag, children, attribs) {\n    var ele = document.createElementNS(namespace, tag);\n    if (children) {\n        if (!(children instanceof Array)) {\n            children = [children];\n        }\n        for (var i = 0; i < children.length; ++i) {\n            var c = children[i];\n            if (typeof c == 'string') {\n                c = document.createTextNode(c);\n            }\n            ele.appendChild(c);\n        }\n    }\n\n    setAttrs(ele, attribs);\n    return ele;\n}\n\nvar attr_name_cache = {};\n\nfunction setAttr(node, key, value) {\n    var attr = attr_name_cache[key];\n    if (!attr) {\n        var _attr = '';\n        for (var c = 0; c < key.length; ++c) {\n            var cc = key.substring(c, c + 1);\n            var lcc = cc.toLowerCase();\n            if (lcc != cc) {\n                _attr = _attr + '-' + lcc;\n            } else {\n                _attr = _attr + cc;\n            }\n        }\n        attr_name_cache[key] = _attr;\n        attr = _attr;\n    }\n    node.setAttribute(attr, value);\n}\n\nfunction setAttrs(node, attribs) {\n    if (attribs) {\n        for (var l in attribs) {\n            setAttr(node, l, attribs[l]);\n        }\n    }\n}\n\nfunction removeChildren(node) {\n    if (!node || !node.childNodes) {\n        return;\n    }\n\n    while (node.childNodes.length > 0) {\n        node.removeChild(node.firstChild);\n    }\n}\n\n//\n// WARNING: not for general use!\n//\n\nfunction miniJSONify(o, exc) {\n    if (typeof o === 'undefined') {\n        return 'undefined';\n    } else if (o == null) {\n        return 'null';\n    } else if (typeof o == 'string') {\n        return \"'\" + o + \"'\";\n    } else if (typeof o == 'number') {\n        return \"\" + o;\n    } else if (typeof o == 'boolean') {\n        return \"\" + o;\n    } else if ((typeof o === 'undefined' ? 'undefined' : _typeof(o)) == 'object') {\n        if (o instanceof Array) {\n            var s = null;\n            for (var i = 0; i < o.length; ++i) {\n                s = (s == null ? '' : s + ', ') + miniJSONify(o[i], exc);\n            }\n            return '[' + (s ? s : '') + ']';\n        } else {\n            exc = exc || {};\n            var s = null;\n            for (var k in o) {\n                if (exc[k]) continue;\n                if (k != undefined && typeof o[k] != 'function') {\n                    s = (s == null ? '' : s + ', ') + k + ': ' + miniJSONify(o[k], exc);\n                }\n            }\n            return '{' + (s ? s : '') + '}';\n        }\n    } else {\n        return typeof o === 'undefined' ? 'undefined' : _typeof(o);\n    }\n}\n\nfunction shallowCopy(o) {\n    var n = {};\n    for (var k in o) {\n        n[k] = o[k];\n    }\n    return n;\n}\n\nfunction Observed(x) {\n    this.value = x;\n    this.listeners = [];\n}\n\nObserved.prototype.addListener = function (f) {\n    this.listeners.push(f);\n};\n\nObserved.prototype.addListenerAndFire = function (f) {\n    this.listeners.push(f);\n    f(this.value);\n};\n\nObserved.prototype.removeListener = function (f) {\n    arrayRemove(this.listeners, f);\n};\n\nObserved.prototype.get = function () {\n    return this.value;\n};\n\nObserved.prototype.set = function (x) {\n    this.value = x;\n    for (var i = 0; i < this.listeners.length; ++i) {\n        this.listeners[i](x);\n    }\n};\n\nfunction Awaited() {\n    this.queue = [];\n}\n\nAwaited.prototype.provide = function (x) {\n    if (this.res !== undefined) {\n        throw \"Resource has already been provided.\";\n    }\n\n    this.res = x;\n    for (var i = 0; i < this.queue.length; ++i) {\n        this.queue[i](x);\n    }\n    this.queue = null; // avoid leaking closures.\n};\n\nAwaited.prototype.await = function (f) {\n    if (this.res !== undefined) {\n        f(this.res);\n        return this.res;\n    } else {\n        this.queue.push(f);\n    }\n};\n\nvar __dalliance_saltSeed = 0;\n\nfunction saltURL(url) {\n    return url + '?salt=' + b64_sha1('' + Date.now() + ',' + ++__dalliance_saltSeed);\n}\n\nfunction textXHR(url, callback, opts) {\n    if (opts && opts.salt) url = saltURL(url);\n\n    try {\n        var timeout;\n        if (opts && opts.timeout) {\n            timeout = setTimeout(function () {\n                console.log('timing out ' + url);\n                req.abort();\n                return callback(null, 'Timeout');\n            }, opts.timeout);\n        }\n\n        var req = new XMLHttpRequest();\n        req.onreadystatechange = function () {\n            if (req.readyState == 4) {\n                if (timeout) clearTimeout(timeout);\n                if (req.status < 200 || req.status >= 300) {\n                    callback(null, 'Error code ' + req.status);\n                } else {\n                    callback(req.responseText);\n                }\n            }\n        };\n\n        req.open('GET', url, true);\n        req.responseType = 'text';\n\n        if (opts && opts.credentials) {\n            req.withCredentials = true;\n        }\n        req.send();\n    } catch (e) {\n        callback(null, 'Exception ' + e);\n    }\n}\n\nfunction relativeURL(base, rel) {\n    // FIXME quite naive -- good enough for trackhubs?\n\n    if (rel.indexOf('http:') == 0 || rel.indexOf('https:') == 0) {\n        return rel;\n    }\n\n    var li = base.lastIndexOf('/');\n    if (li >= 0) {\n        return base.substr(0, li + 1) + rel;\n    } else {\n        return rel;\n    }\n}\n\nvar AMINO_ACID_TRANSLATION = {\n    'TTT': 'F',\n    'TTC': 'F',\n    'TTA': 'L',\n    'TTG': 'L',\n    'CTT': 'L',\n    'CTC': 'L',\n    'CTA': 'L',\n    'CTG': 'L',\n    'ATT': 'I',\n    'ATC': 'I',\n    'ATA': 'I',\n    'ATG': 'M',\n    'GTT': 'V',\n    'GTC': 'V',\n    'GTA': 'V',\n    'GTG': 'V',\n    'TCT': 'S',\n    'TCC': 'S',\n    'TCA': 'S',\n    'TCG': 'S',\n    'CCT': 'P',\n    'CCC': 'P',\n    'CCA': 'P',\n    'CCG': 'P',\n    'ACT': 'T',\n    'ACC': 'T',\n    'ACA': 'T',\n    'ACG': 'T',\n    'GCT': 'A',\n    'GCC': 'A',\n    'GCA': 'A',\n    'GCG': 'A',\n    'TAT': 'Y',\n    'TAC': 'Y',\n    'TAA': '*', // stop\n    'TAG': '*', // stop\n    'CAT': 'H',\n    'CAC': 'H',\n    'CAA': 'Q',\n    'CAG': 'Q',\n    'AAT': 'N',\n    'AAC': 'N',\n    'AAA': 'K',\n    'AAG': 'K',\n    'GAT': 'D',\n    'GAC': 'D',\n    'GAA': 'E',\n    'GAG': 'E',\n    'TGT': 'C',\n    'TGC': 'C',\n    'TGA': '*', // stop\n    'TGG': 'W',\n    'CGT': 'R',\n    'CGC': 'R',\n    'CGA': 'R',\n    'CGG': 'R',\n    'AGT': 'S',\n    'AGC': 'S',\n    'AGA': 'R',\n    'AGG': 'R',\n    'GGT': 'G',\n    'GGC': 'G',\n    'GGA': 'G',\n    'GGG': 'G'\n};\n\nfunction resolveUrlToPage(rel) {\n    return makeElement('a', null, { href: rel }).href;\n}\n\n//\n// Missing APIs\n// \n\nif (!('trim' in String.prototype)) {\n    String.prototype.trim = function () {\n        return this.replace(/^\\s+/, '').replace(/\\s+$/, '');\n    };\n}\n\nif (typeof module !== 'undefined') {\n    module.exports = {\n        textXHR: textXHR,\n        relativeURL: relativeURL,\n        resolveUrlToPage: resolveUrlToPage,\n        shallowCopy: shallowCopy,\n        pusho: pusho,\n        pushnew: pushnew,\n        pushnewo: pushnewo,\n        arrayIndexOf: arrayIndexOf,\n        pick: pick,\n\n        makeElement: makeElement,\n        makeElementNS: makeElementNS,\n        removeChildren: removeChildren,\n\n        miniJSONify: miniJSONify,\n\n        Observed: Observed,\n        Awaited: Awaited,\n\n        AMINO_ACID_TRANSLATION: AMINO_ACID_TRANSLATION\n    };\n}\n\n},{\"./sha1\":38}],57:[function(require,module,exports){\n/* -*- mode: javascript; c-basic-offset: 4; indent-tabs-mode: nil -*- */\n\n// \n// Dalliance Genome Explorer\n// (c) Thomas Down 2006-2014\n//\n// vcf.js\n//\n\n\"use strict\";\n\nif (typeof require !== 'undefined') {\n    var sa = require('./sourceadapters');\n    var dalliance_registerParserFactory = sa.registerParserFactory;\n\n    var das = require('./das');\n    var DASStylesheet = das.DASStylesheet;\n    var DASStyle = das.DASStyle;\n    var DASFeature = das.DASFeature;\n    var DASGroup = das.DASGroup;\n\n    var revalidator = require('revalidator');\n}\n\nfunction VCFParser() {\n    this.info = [];\n}\n\nvar VCF_INFO_RE = /([^;=]+)(=([^;]+))?;?/;\nvar VCF_INFO_HEADER = /##INFO=<([^>]+)>/;\nvar VCF_INFO_HEADER_TOK = /([^,=]+)=([^,]+|\"[^\"]+\"),?/;\n\nVCFParser.prototype.createSession = function (sink) {\n    return new VCFParseSession(this, sink);\n};\n\nfunction VCFParseSession(parser, sink) {\n    this.parser = parser;\n    this.sink = sink;\n}\n\nVCFParseSession.prototype.parse = function (line) {\n    if (line.length == 0) return;\n    if (line[0] == '#') {\n        if (line.length > 1 && line[1] == '#') {\n            var m = VCF_INFO_HEADER.exec(line);\n            if (m) {\n                var toks = m[1].split(VCF_INFO_HEADER_TOK);\n                var id = null,\n                    desc = null;\n                for (var ti = 0; ti < toks.length - 1; ti += 3) {\n                    var key = toks[ti + 1];\n                    var value = toks[ti + 2].replace(/\"/g, '');\n                    if (key == 'ID') {\n                        id = value;\n                    } else if (key == 'Description') {\n                        desc = value;\n                    }\n                }\n                if (id && desc) {\n                    this.parser.info.push({ id: id,\n                        desc: desc });\n                }\n            }\n            return;\n        } else {\n            return;\n        }\n    }\n\n    var toks = line.split('\\t');\n    var f = new DASFeature();\n    f.segment = toks[0];\n    f.id = toks[2];\n    f.refAllele = toks[3];\n    f.altAlleles = toks[4].split(',');\n    f.min = parseInt(toks[1]);\n    f.max = f.min + f.refAllele.length - 1;\n\n    var infoToks = toks[7].split(VCF_INFO_RE);\n    f.info = {};\n    for (var ti = 0; ti < infoToks.length; ti += 4) {\n        f.info[infoToks[ti + 1]] = infoToks[ti + 3];\n    }\n\n    var alt = f.altAlleles[0];\n    var ref = f.refAllele;\n    if (alt.length > ref.length) {\n        f.type = \"insertion\";\n        if (alt.indexOf(ref) == 0) {\n            f.insertion = alt.substr(ref.length);\n            f.min += ref.length;\n            f.max = f.min - 1; // Effectively \"between\" bases.\n        } else {\n            f.insertion = alt;\n        }\n    } else if (alt.length < ref.length) {\n        f.type = \"deletion\";\n    } else {\n        f.type = 'substitution';\n    }\n\n    this.sink(f);\n};\n\nVCFParseSession.prototype.flush = function () {};\n\nVCFParseSession.prototype.schema = {\n    properties: {\n        segment: {\n            description: 'the name of the region containing the variation',\n            type: 'string',\n            required: true\n        },\n        min: {\n            description: 'the start position',\n            type: 'integer',\n            minimum: 1,\n            required: true\n        },\n        max: {\n            description: 'the end position',\n            type: 'integer',\n            required: true\n        },\n        id: {\n            description: 'identifier of variant',\n            type: 'string',\n            required: true\n        },\n        refAllele: {\n            description: 'reference allele',\n            type: 'string',\n            required: true\n        },\n        altAlleles: {\n            description: 'list of alternate alleles',\n            type: 'array',\n            items: { type: 'string' },\n            required: true\n        },\n        info: {\n            description: 'info',\n            type: 'object',\n            required: true\n        },\n        type: {\n            description: 'type of variation',\n            type: 'string',\n            enum: ['insertion', 'deletion', 'substitution'],\n            required: true\n        },\n        insertion: {\n            description: 'the actual insertion',\n            type: 'string'\n        }\n    }\n};\n\nVCFParseSession.prototype.validate = function (f) {\n    // use revalidator.validate to check if feature f is valid\n    var check = revalidator.validate(f, this.schema);\n    if (check.valid) {\n        this.sink(f);\n    } else {\n        console.log(check.errors);\n    }\n};\n\nVCFParser.prototype.getStyleSheet = function (callback) {\n    var stylesheet = new DASStylesheet();\n\n    {\n        var varStyle = new DASStyle();\n        varStyle.glyph = '__INSERTION';\n        varStyle.BUMP = 'yes';\n        varStyle.LABEL = 'no';\n        varStyle.FGCOLOR = 'rgb(50,80,255)';\n        varStyle.BGCOLOR = '#888888';\n        varStyle.STROKECOLOR = 'black';\n        stylesheet.pushStyle({ type: 'insertion' }, null, varStyle);\n    }\n    {\n        var varStyle = new DASStyle();\n        varStyle.glyph = 'PLIMSOLL';\n        varStyle.BUMP = 'yes';\n        varStyle.LABEL = 'no';\n        varStyle.FGCOLOR = 'rgb(255, 60, 60)';\n        varStyle.BGCOLOR = '#888888';\n        varStyle.STROKECOLOR = 'black';\n        stylesheet.pushStyle({ type: 'deletion' }, null, varStyle);\n    }\n    {\n        var varStyle = new DASStyle();\n        varStyle.glyph = 'PLIMSOLL';\n        varStyle.BUMP = 'yes';\n        varStyle.LABEL = 'no';\n        varStyle.FGCOLOR = 'rgb(50,80,255)';\n        varStyle.BGCOLOR = '#888888';\n        varStyle.STROKECOLOR = 'black';\n        stylesheet.pushStyle({ type: 'default' }, null, varStyle);\n    }\n\n    return callback(stylesheet);\n};\n\nVCFParser.prototype.getDefaultFIPs = function (callback) {\n    var self = this;\n    var fip = function fip(feature, featureInfo) {\n        featureInfo.add(\"Ref. allele\", feature.refAllele);\n        featureInfo.add(\"Alt. alleles\", feature.altAlleles.join(','));\n\n        if (feature.info) {\n            for (var ii = 0; ii < self.info.length; ++ii) {\n                var info = self.info[ii];\n                var val = feature.info[info.id];\n                if (val !== undefined) {\n                    featureInfo.add(info.desc, val);\n                }\n            }\n        }\n    };\n    callback(fip);\n};\n\ndalliance_registerParserFactory('vcf', function () {\n    return new VCFParser();\n});\n\n},{\"./das\":11,\"./sourceadapters\":39,\"revalidator\":74}],58:[function(require,module,exports){\n/* -*- mode: javascript; c-basic-offset: 4; indent-tabs-mode: nil -*- */\n\n// \n// Dalliance Genome Explorer\n// (c) Thomas Down 2006-2010\n//\n// version.js\n//\n\n\"use strict\";\n\nvar VERSION = {\n    CONFIG: 5,\n    MAJOR: 0,\n    MINOR: 13,\n    MICRO: 7,\n    BRANCH: 'dev'\n};\n\nVERSION.toString = function () {\n    var vs = '' + this.MAJOR + '.' + this.MINOR + '.' + this.MICRO;\n    if (this.PATCH) {\n        vs = vs + this.PATCH;\n    }\n    if (this.BRANCH && this.BRANCH != '') {\n        vs = vs + '-' + this.BRANCH;\n    }\n    return vs;\n};\n\nif (typeof module !== 'undefined') {\n    module.exports = VERSION;\n}\n\n},{}],59:[function(require,module,exports){\n/* -*- mode: javascript; c-basic-offset: 4; indent-tabs-mode: nil -*- */\n\n// \n// Dalliance Genome Explorer\n// (c) Thomas Down 2006-2014\n//\n// zoomslider.js: custom slider component\n//\n\n\n\"use strict\";\n\nif (typeof require !== 'undefined') {\n    var utils = require('./utils');\n    var makeElement = utils.makeElement;\n}\n\nfunction makeZoomSlider(opts) {\n    opts = opts || {};\n\n    var minPos = 0,\n        maxPos = opts.width || 200;\n    var min = 0,\n        max = 200;\n    var pos = 50,\n        pos2 = 100;\n    var labels = [];\n    var track = makeElement('hr', null, { className: 'slider-track' }, { width: '' + (maxPos | 0) + 'px' });\n    var thumb = makeElement('hr', null, { className: 'slider-thumb active' });\n    var thumb2 = makeElement('hr', null, { className: 'slider-thumb' });\n    var slider = makeElement('div', [track, thumb, thumb2], { className: 'slider' }, { width: '' + ((maxPos | 0) + 10) + 'px' });\n\n    slider.removeLabels = function () {\n        for (var li = 0; li < labels.length; ++li) {\n            slider.removeChild(labels[li]);\n        }\n        labels = [];\n    };\n\n    slider.addLabel = function (val, txt) {\n        var pos = minPos + (val - min) * (maxPos - minPos) / (max - min) | 0;\n        var label = makeElement('div', txt, { className: 'slider-label' }, {\n            left: '' + (minPos + (val - min) * (maxPos - minPos) / (max - min) | 0) + 'px'\n        });\n        slider.appendChild(label);\n        labels.push(label);\n    };\n\n    var onChange = document.createEvent('HTMLEvents');\n    onChange.initEvent('change', true, false);\n\n    function setPos(np) {\n        np = Math.min(np, maxPos);\n        np = Math.max(np, minPos);\n        pos = np;\n        thumb.style.left = '' + pos + 'px';\n    }\n\n    function setPos2(np) {\n        np = Math.min(np, maxPos);\n        np = Math.max(np, minPos);\n        pos2 = np;\n        thumb2.style.left = '' + pos2 + 'px';\n    }\n\n    Object.defineProperty(slider, 'value', {\n        get: function get() {\n            return min + (pos - minPos) * (max - min) / (maxPos - minPos);\n        },\n        set: function set(v) {\n            var np = minPos + (v - min) * (maxPos - minPos) / (max - min);\n            setPos(np);\n        }\n    });\n\n    Object.defineProperty(slider, 'value2', {\n        get: function get() {\n            return min + (pos2 - minPos) * (max - min) / (maxPos - minPos);\n        },\n        set: function set(v) {\n            var np = minPos + (v - min) * (maxPos - minPos) / (max - min);\n            setPos2(np);\n        }\n    });\n\n    Object.defineProperty(slider, 'active', {\n        get: function get() {\n            return thumb.classList.contains('active') ? 1 : 2;\n        },\n        set: function set(x) {\n            if (x == 1) {\n                thumb.classList.add('active');\n                thumb2.classList.remove('active');\n            } else {\n                thumb2.classList.add('active');\n                thumb.classList.remove('active');\n            }\n        }\n    });\n\n    Object.defineProperty(slider, 'min', {\n        get: function get() {\n            return min;\n        },\n        set: function set(v) {\n            min = v;\n        }\n    });\n\n    Object.defineProperty(slider, 'max', {\n        get: function get() {\n            return max;\n        },\n        set: function set(v) {\n            max = v;\n        }\n    });\n\n    var offset;\n    var which;\n\n    var thumbMouseDown = function thumbMouseDown(ev) {\n        which = this == thumb ? 1 : 2;\n        if (which != slider.active) {\n            slider.active = which;\n            slider.dispatchEvent(onChange);\n        }\n        ev.stopPropagation();ev.preventDefault();\n        window.addEventListener('mousemove', thumbDragHandler, false);\n        window.addEventListener('mouseup', thumbDragEndHandler, false);\n        offset = ev.clientX - (which == 1 ? pos : pos2);\n    };\n\n    thumb.addEventListener('mousedown', thumbMouseDown, false);\n    thumb2.addEventListener('mousedown', thumbMouseDown, false);\n\n    var thumbDragHandler = function thumbDragHandler(ev) {\n        if (which == 1) setPos(ev.clientX - offset);else setPos2(ev.clientX - offset);\n        slider.dispatchEvent(onChange);\n    };\n\n    var thumbDragEndHandler = function thumbDragEndHandler(ev) {\n        window.removeEventListener('mousemove', thumbDragHandler, false);\n        window.removeEventListener('mouseup', thumbDragEndHandler, false);\n    };\n\n    return slider;\n}\n\nif (typeof module !== 'undefined') {\n    module.exports = makeZoomSlider;\n}\n\n},{\"./utils\":56}],60:[function(require,module,exports){\n\"use strict\";\nvar Promise = require(\"./promise/promise\").Promise;\nvar polyfill = require(\"./promise/polyfill\").polyfill;\nexports.Promise = Promise;\nexports.polyfill = polyfill;\n},{\"./promise/polyfill\":65,\"./promise/promise\":66}],61:[function(require,module,exports){\n\"use strict\";\n/* global toString */\n\nvar isArray = require(\"./utils\").isArray;\nvar isFunction = require(\"./utils\").isFunction;\n\n/**\n  Returns a promise that is fulfilled when all the given promises have been\n  fulfilled, or rejected if any of them become rejected. The return promise\n  is fulfilled with an array that gives all the values in the order they were\n  passed in the `promises` array argument.\n\n  Example:\n\n  ```javascript\n  var promise1 = RSVP.resolve(1);\n  var promise2 = RSVP.resolve(2);\n  var promise3 = RSVP.resolve(3);\n  var promises = [ promise1, promise2, promise3 ];\n\n  RSVP.all(promises).then(function(array){\n    // The array here would be [ 1, 2, 3 ];\n  });\n  ```\n\n  If any of the `promises` given to `RSVP.all` are rejected, the first promise\n  that is rejected will be given as an argument to the returned promises's\n  rejection handler. For example:\n\n  Example:\n\n  ```javascript\n  var promise1 = RSVP.resolve(1);\n  var promise2 = RSVP.reject(new Error(\"2\"));\n  var promise3 = RSVP.reject(new Error(\"3\"));\n  var promises = [ promise1, promise2, promise3 ];\n\n  RSVP.all(promises).then(function(array){\n    // Code here never runs because there are rejected promises!\n  }, function(error) {\n    // error.message === \"2\"\n  });\n  ```\n\n  @method all\n  @for RSVP\n  @param {Array} promises\n  @param {String} label\n  @return {Promise} promise that is fulfilled when all `promises` have been\n  fulfilled, or rejected if any of them become rejected.\n*/\nfunction all(promises) {\n  /*jshint validthis:true */\n  var Promise = this;\n\n  if (!isArray(promises)) {\n    throw new TypeError('You must pass an array to all.');\n  }\n\n  return new Promise(function(resolve, reject) {\n    var results = [], remaining = promises.length,\n    promise;\n\n    if (remaining === 0) {\n      resolve([]);\n    }\n\n    function resolver(index) {\n      return function(value) {\n        resolveAll(index, value);\n      };\n    }\n\n    function resolveAll(index, value) {\n      results[index] = value;\n      if (--remaining === 0) {\n        resolve(results);\n      }\n    }\n\n    for (var i = 0; i < promises.length; i++) {\n      promise = promises[i];\n\n      if (promise && isFunction(promise.then)) {\n        promise.then(resolver(i), reject);\n      } else {\n        resolveAll(i, promise);\n      }\n    }\n  });\n}\n\nexports.all = all;\n},{\"./utils\":70}],62:[function(require,module,exports){\n(function (process,global){\n\"use strict\";\nvar browserGlobal = (typeof window !== 'undefined') ? window : {};\nvar BrowserMutationObserver = browserGlobal.MutationObserver || browserGlobal.WebKitMutationObserver;\nvar local = (typeof global !== 'undefined') ? global : (this === undefined? window:this);\n\n// node\nfunction useNextTick() {\n  return function() {\n    process.nextTick(flush);\n  };\n}\n\nfunction useMutationObserver() {\n  var iterations = 0;\n  var observer = new BrowserMutationObserver(flush);\n  var node = document.createTextNode('');\n  observer.observe(node, { characterData: true });\n\n  return function() {\n    node.data = (iterations = ++iterations % 2);\n  };\n}\n\nfunction useSetTimeout() {\n  return function() {\n    local.setTimeout(flush, 1);\n  };\n}\n\nvar queue = [];\nfunction flush() {\n  for (var i = 0; i < queue.length; i++) {\n    var tuple = queue[i];\n    var callback = tuple[0], arg = tuple[1];\n    callback(arg);\n  }\n  queue = [];\n}\n\nvar scheduleFlush;\n\n// Decide what async method to use to triggering processing of queued callbacks:\nif (typeof process !== 'undefined' && {}.toString.call(process) === '[object process]') {\n  scheduleFlush = useNextTick();\n} else if (BrowserMutationObserver) {\n  scheduleFlush = useMutationObserver();\n} else {\n  scheduleFlush = useSetTimeout();\n}\n\nfunction asap(callback, arg) {\n  var length = queue.push([callback, arg]);\n  if (length === 1) {\n    // If length is 1, that means that we need to schedule an async flush.\n    // If additional callbacks are queued before the queue is flushed, they\n    // will be processed by this flush that we are scheduling.\n    scheduleFlush();\n  }\n}\n\nexports.asap = asap;\n}).call(this,require('_process'),typeof global !== \"undefined\" ? global : typeof self !== \"undefined\" ? self : typeof window !== \"undefined\" ? window : {})\n\n},{\"_process\":72}],63:[function(require,module,exports){\n\"use strict\";\n/**\n  `RSVP.Promise.cast` returns the same promise if that promise shares a constructor\n  with the promise being casted.\n\n  Example:\n\n  ```javascript\n  var promise = RSVP.resolve(1);\n  var casted = RSVP.Promise.cast(promise);\n\n  console.log(promise === casted); // true\n  ```\n\n  In the case of a promise whose constructor does not match, it is assimilated.\n  The resulting promise will fulfill or reject based on the outcome of the\n  promise being casted.\n\n  In the case of a non-promise, a promise which will fulfill with that value is\n  returned.\n\n  Example:\n\n  ```javascript\n  var value = 1; // could be a number, boolean, string, undefined...\n  var casted = RSVP.Promise.cast(value);\n\n  console.log(value === casted); // false\n  console.log(casted instanceof RSVP.Promise) // true\n\n  casted.then(function(val) {\n    val === value // => true\n  });\n  ```\n\n  `RSVP.Promise.cast` is similar to `RSVP.resolve`, but `RSVP.Promise.cast` differs in the\n  following ways:\n  * `RSVP.Promise.cast` serves as a memory-efficient way of getting a promise, when you\n  have something that could either be a promise or a value. RSVP.resolve\n  will have the same effect but will create a new promise wrapper if the\n  argument is a promise.\n  * `RSVP.Promise.cast` is a way of casting incoming thenables or promise subclasses to\n  promises of the exact class specified, so that the resulting object's `then` is\n  ensured to have the behavior of the constructor you are calling cast on (i.e., RSVP.Promise).\n\n  @method cast\n  @for RSVP\n  @param {Object} object to be casted\n  @return {Promise} promise that is fulfilled when all properties of `promises`\n  have been fulfilled, or rejected if any of them become rejected.\n*/\n\n\nfunction cast(object) {\n  /*jshint validthis:true */\n  if (object && typeof object === 'object' && object.constructor === this) {\n    return object;\n  }\n\n  var Promise = this;\n\n  return new Promise(function(resolve) {\n    resolve(object);\n  });\n}\n\nexports.cast = cast;\n},{}],64:[function(require,module,exports){\n\"use strict\";\nvar config = {\n  instrument: false\n};\n\nfunction configure(name, value) {\n  if (arguments.length === 2) {\n    config[name] = value;\n  } else {\n    return config[name];\n  }\n}\n\nexports.config = config;\nexports.configure = configure;\n},{}],65:[function(require,module,exports){\n(function (global){\n\"use strict\";\n/*global self*/\nvar RSVPPromise = require(\"./promise\").Promise;\nvar isFunction = require(\"./utils\").isFunction;\n\nfunction polyfill() {\n  var local;\n\n  if (typeof global !== 'undefined') {\n    local = global;\n  } else if (typeof window !== 'undefined' && window.document) {\n    local = window;\n  } else {\n    local = self;\n  }\n\n  var es6PromiseSupport = \n    \"Promise\" in local &&\n    // Some of these methods are missing from\n    // Firefox/Chrome experimental implementations\n    \"cast\" in local.Promise &&\n    \"resolve\" in local.Promise &&\n    \"reject\" in local.Promise &&\n    \"all\" in local.Promise &&\n    \"race\" in local.Promise &&\n    // Older version of the spec had a resolver object\n    // as the arg rather than a function\n    (function() {\n      var resolve;\n      new local.Promise(function(r) { resolve = r; });\n      return isFunction(resolve);\n    }());\n\n  if (!es6PromiseSupport) {\n    local.Promise = RSVPPromise;\n  }\n}\n\nexports.polyfill = polyfill;\n}).call(this,typeof global !== \"undefined\" ? global : typeof self !== \"undefined\" ? self : typeof window !== \"undefined\" ? window : {})\n\n},{\"./promise\":66,\"./utils\":70}],66:[function(require,module,exports){\n\"use strict\";\nvar config = require(\"./config\").config;\nvar configure = require(\"./config\").configure;\nvar objectOrFunction = require(\"./utils\").objectOrFunction;\nvar isFunction = require(\"./utils\").isFunction;\nvar now = require(\"./utils\").now;\nvar cast = require(\"./cast\").cast;\nvar all = require(\"./all\").all;\nvar race = require(\"./race\").race;\nvar staticResolve = require(\"./resolve\").resolve;\nvar staticReject = require(\"./reject\").reject;\nvar asap = require(\"./asap\").asap;\n\nvar counter = 0;\n\nconfig.async = asap; // default async is asap;\n\nfunction Promise(resolver) {\n  if (!isFunction(resolver)) {\n    throw new TypeError('You must pass a resolver function as the first argument to the promise constructor');\n  }\n\n  if (!(this instanceof Promise)) {\n    throw new TypeError(\"Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.\");\n  }\n\n  this._subscribers = [];\n\n  invokeResolver(resolver, this);\n}\n\nfunction invokeResolver(resolver, promise) {\n  function resolvePromise(value) {\n    resolve(promise, value);\n  }\n\n  function rejectPromise(reason) {\n    reject(promise, reason);\n  }\n\n  try {\n    resolver(resolvePromise, rejectPromise);\n  } catch(e) {\n    rejectPromise(e);\n  }\n}\n\nfunction invokeCallback(settled, promise, callback, detail) {\n  var hasCallback = isFunction(callback),\n      value, error, succeeded, failed;\n\n  if (hasCallback) {\n    try {\n      value = callback(detail);\n      succeeded = true;\n    } catch(e) {\n      failed = true;\n      error = e;\n    }\n  } else {\n    value = detail;\n    succeeded = true;\n  }\n\n  if (handleThenable(promise, value)) {\n    return;\n  } else if (hasCallback && succeeded) {\n    resolve(promise, value);\n  } else if (failed) {\n    reject(promise, error);\n  } else if (settled === FULFILLED) {\n    resolve(promise, value);\n  } else if (settled === REJECTED) {\n    reject(promise, value);\n  }\n}\n\nvar PENDING   = void 0;\nvar SEALED    = 0;\nvar FULFILLED = 1;\nvar REJECTED  = 2;\n\nfunction subscribe(parent, child, onFulfillment, onRejection) {\n  var subscribers = parent._subscribers;\n  var length = subscribers.length;\n\n  subscribers[length] = child;\n  subscribers[length + FULFILLED] = onFulfillment;\n  subscribers[length + REJECTED]  = onRejection;\n}\n\nfunction publish(promise, settled) {\n  var child, callback, subscribers = promise._subscribers, detail = promise._detail;\n\n  for (var i = 0; i < subscribers.length; i += 3) {\n    child = subscribers[i];\n    callback = subscribers[i + settled];\n\n    invokeCallback(settled, child, callback, detail);\n  }\n\n  promise._subscribers = null;\n}\n\nPromise.prototype = {\n  constructor: Promise,\n\n  _state: undefined,\n  _detail: undefined,\n  _subscribers: undefined,\n\n  then: function(onFulfillment, onRejection) {\n    var promise = this;\n\n    var thenPromise = new this.constructor(function() {});\n\n    if (this._state) {\n      var callbacks = arguments;\n      config.async(function invokePromiseCallback() {\n        invokeCallback(promise._state, thenPromise, callbacks[promise._state - 1], promise._detail);\n      });\n    } else {\n      subscribe(this, thenPromise, onFulfillment, onRejection);\n    }\n\n    return thenPromise;\n  },\n\n  'catch': function(onRejection) {\n    return this.then(null, onRejection);\n  }\n};\n\nPromise.all = all;\nPromise.cast = cast;\nPromise.race = race;\nPromise.resolve = staticResolve;\nPromise.reject = staticReject;\n\nfunction handleThenable(promise, value) {\n  var then = null,\n  resolved;\n\n  try {\n    if (promise === value) {\n      throw new TypeError(\"A promises callback cannot return that same promise.\");\n    }\n\n    if (objectOrFunction(value)) {\n      then = value.then;\n\n      if (isFunction(then)) {\n        then.call(value, function(val) {\n          if (resolved) { return true; }\n          resolved = true;\n\n          if (value !== val) {\n            resolve(promise, val);\n          } else {\n            fulfill(promise, val);\n          }\n        }, function(val) {\n          if (resolved) { return true; }\n          resolved = true;\n\n          reject(promise, val);\n        });\n\n        return true;\n      }\n    }\n  } catch (error) {\n    if (resolved) { return true; }\n    reject(promise, error);\n    return true;\n  }\n\n  return false;\n}\n\nfunction resolve(promise, value) {\n  if (promise === value) {\n    fulfill(promise, value);\n  } else if (!handleThenable(promise, value)) {\n    fulfill(promise, value);\n  }\n}\n\nfunction fulfill(promise, value) {\n  if (promise._state !== PENDING) { return; }\n  promise._state = SEALED;\n  promise._detail = value;\n\n  config.async(publishFulfillment, promise);\n}\n\nfunction reject(promise, reason) {\n  if (promise._state !== PENDING) { return; }\n  promise._state = SEALED;\n  promise._detail = reason;\n\n  config.async(publishRejection, promise);\n}\n\nfunction publishFulfillment(promise) {\n  publish(promise, promise._state = FULFILLED);\n}\n\nfunction publishRejection(promise) {\n  publish(promise, promise._state = REJECTED);\n}\n\nexports.Promise = Promise;\n},{\"./all\":61,\"./asap\":62,\"./cast\":63,\"./config\":64,\"./race\":67,\"./reject\":68,\"./resolve\":69,\"./utils\":70}],67:[function(require,module,exports){\n\"use strict\";\n/* global toString */\nvar isArray = require(\"./utils\").isArray;\n\n/**\n  `RSVP.race` allows you to watch a series of promises and act as soon as the\n  first promise given to the `promises` argument fulfills or rejects.\n\n  Example:\n\n  ```javascript\n  var promise1 = new RSVP.Promise(function(resolve, reject){\n    setTimeout(function(){\n      resolve(\"promise 1\");\n    }, 200);\n  });\n\n  var promise2 = new RSVP.Promise(function(resolve, reject){\n    setTimeout(function(){\n      resolve(\"promise 2\");\n    }, 100);\n  });\n\n  RSVP.race([promise1, promise2]).then(function(result){\n    // result === \"promise 2\" because it was resolved before promise1\n    // was resolved.\n  });\n  ```\n\n  `RSVP.race` is deterministic in that only the state of the first completed\n  promise matters. For example, even if other promises given to the `promises`\n  array argument are resolved, but the first completed promise has become\n  rejected before the other promises became fulfilled, the returned promise\n  will become rejected:\n\n  ```javascript\n  var promise1 = new RSVP.Promise(function(resolve, reject){\n    setTimeout(function(){\n      resolve(\"promise 1\");\n    }, 200);\n  });\n\n  var promise2 = new RSVP.Promise(function(resolve, reject){\n    setTimeout(function(){\n      reject(new Error(\"promise 2\"));\n    }, 100);\n  });\n\n  RSVP.race([promise1, promise2]).then(function(result){\n    // Code here never runs because there are rejected promises!\n  }, function(reason){\n    // reason.message === \"promise2\" because promise 2 became rejected before\n    // promise 1 became fulfilled\n  });\n  ```\n\n  @method race\n  @for RSVP\n  @param {Array} promises array of promises to observe\n  @param {String} label optional string for describing the promise returned.\n  Useful for tooling.\n  @return {Promise} a promise that becomes fulfilled with the value the first\n  completed promises is resolved with if the first completed promise was\n  fulfilled, or rejected with the reason that the first completed promise\n  was rejected with.\n*/\nfunction race(promises) {\n  /*jshint validthis:true */\n  var Promise = this;\n\n  if (!isArray(promises)) {\n    throw new TypeError('You must pass an array to race.');\n  }\n  return new Promise(function(resolve, reject) {\n    var results = [], promise;\n\n    for (var i = 0; i < promises.length; i++) {\n      promise = promises[i];\n\n      if (promise && typeof promise.then === 'function') {\n        promise.then(resolve, reject);\n      } else {\n        resolve(promise);\n      }\n    }\n  });\n}\n\nexports.race = race;\n},{\"./utils\":70}],68:[function(require,module,exports){\n\"use strict\";\n/**\n  `RSVP.reject` returns a promise that will become rejected with the passed\n  `reason`. `RSVP.reject` is essentially shorthand for the following:\n\n  ```javascript\n  var promise = new RSVP.Promise(function(resolve, reject){\n    reject(new Error('WHOOPS'));\n  });\n\n  promise.then(function(value){\n    // Code here doesn't run because the promise is rejected!\n  }, function(reason){\n    // reason.message === 'WHOOPS'\n  });\n  ```\n\n  Instead of writing the above, your code now simply becomes the following:\n\n  ```javascript\n  var promise = RSVP.reject(new Error('WHOOPS'));\n\n  promise.then(function(value){\n    // Code here doesn't run because the promise is rejected!\n  }, function(reason){\n    // reason.message === 'WHOOPS'\n  });\n  ```\n\n  @method reject\n  @for RSVP\n  @param {Any} reason value that the returned promise will be rejected with.\n  @param {String} label optional string for identifying the returned promise.\n  Useful for tooling.\n  @return {Promise} a promise that will become rejected with the given\n  `reason`.\n*/\nfunction reject(reason) {\n  /*jshint validthis:true */\n  var Promise = this;\n\n  return new Promise(function (resolve, reject) {\n    reject(reason);\n  });\n}\n\nexports.reject = reject;\n},{}],69:[function(require,module,exports){\n\"use strict\";\n/**\n  `RSVP.resolve` returns a promise that will become fulfilled with the passed\n  `value`. `RSVP.resolve` is essentially shorthand for the following:\n\n  ```javascript\n  var promise = new RSVP.Promise(function(resolve, reject){\n    resolve(1);\n  });\n\n  promise.then(function(value){\n    // value === 1\n  });\n  ```\n\n  Instead of writing the above, your code now simply becomes the following:\n\n  ```javascript\n  var promise = RSVP.resolve(1);\n\n  promise.then(function(value){\n    // value === 1\n  });\n  ```\n\n  @method resolve\n  @for RSVP\n  @param {Any} value value that the returned promise will be resolved with\n  @param {String} label optional string for identifying the returned promise.\n  Useful for tooling.\n  @return {Promise} a promise that will become fulfilled with the given\n  `value`\n*/\nfunction resolve(value) {\n  /*jshint validthis:true */\n  var Promise = this;\n  return new Promise(function(resolve, reject) {\n    resolve(value);\n  });\n}\n\nexports.resolve = resolve;\n},{}],70:[function(require,module,exports){\n\"use strict\";\nfunction objectOrFunction(x) {\n  return isFunction(x) || (typeof x === \"object\" && x !== null);\n}\n\nfunction isFunction(x) {\n  return typeof x === \"function\";\n}\n\nfunction isArray(x) {\n  return Object.prototype.toString.call(x) === \"[object Array]\";\n}\n\n// Date.now is not available in browsers < IE9\n// https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Date/now#Compatibility\nvar now = Date.now || function() { return new Date().getTime(); };\n\n\nexports.objectOrFunction = objectOrFunction;\nexports.isFunction = isFunction;\nexports.isArray = isArray;\nexports.now = now;\n},{}],71:[function(require,module,exports){\n/* -*- mode: javascript; c-basic-offset: 4; indent-tabs-mode: nil -*- */\n\n// \n// Javascript ZLib\n// By Thomas Down 2010-2011\n//\n// Based very heavily on portions of jzlib (by ymnk@jcraft.com), who in\n// turn credits Jean-loup Gailly and Mark Adler for the original zlib code.\n//\n// inflate.js: ZLib inflate code\n//\n\n//\n// Shared constants\n//\n\nvar MAX_WBITS=15; // 32K LZ77 window\nvar DEF_WBITS=MAX_WBITS;\nvar MAX_MEM_LEVEL=9;\nvar MANY=1440;\nvar BMAX = 15;\n\n// preset dictionary flag in zlib header\nvar PRESET_DICT=0x20;\n\nvar Z_NO_FLUSH=0;\nvar Z_PARTIAL_FLUSH=1;\nvar Z_SYNC_FLUSH=2;\nvar Z_FULL_FLUSH=3;\nvar Z_FINISH=4;\n\nvar Z_DEFLATED=8;\n\nvar Z_OK=0;\nvar Z_STREAM_END=1;\nvar Z_NEED_DICT=2;\nvar Z_ERRNO=-1;\nvar Z_STREAM_ERROR=-2;\nvar Z_DATA_ERROR=-3;\nvar Z_MEM_ERROR=-4;\nvar Z_BUF_ERROR=-5;\nvar Z_VERSION_ERROR=-6;\n\nvar METHOD=0;   // waiting for method byte\nvar FLAG=1;     // waiting for flag byte\nvar DICT4=2;    // four dictionary check bytes to go\nvar DICT3=3;    // three dictionary check bytes to go\nvar DICT2=4;    // two dictionary check bytes to go\nvar DICT1=5;    // one dictionary check byte to go\nvar DICT0=6;    // waiting for inflateSetDictionary\nvar BLOCKS=7;   // decompressing blocks\nvar CHECK4=8;   // four check bytes to go\nvar CHECK3=9;   // three check bytes to go\nvar CHECK2=10;  // two check bytes to go\nvar CHECK1=11;  // one check byte to go\nvar DONE=12;    // finished check, done\nvar BAD=13;     // got an error--stay here\n\nvar inflate_mask = [0x00000000, 0x00000001, 0x00000003, 0x00000007, 0x0000000f, 0x0000001f, 0x0000003f, 0x0000007f, 0x000000ff, 0x000001ff, 0x000003ff, 0x000007ff, 0x00000fff, 0x00001fff, 0x00003fff, 0x00007fff, 0x0000ffff];\n\nvar IB_TYPE=0;  // get type bits (3, including end bit)\nvar IB_LENS=1;  // get lengths for stored\nvar IB_STORED=2;// processing stored block\nvar IB_TABLE=3; // get table lengths\nvar IB_BTREE=4; // get bit lengths tree for a dynamic block\nvar IB_DTREE=5; // get length, distance trees for a dynamic block\nvar IB_CODES=6; // processing fixed or dynamic block\nvar IB_DRY=7;   // output remaining window bytes\nvar IB_DONE=8;  // finished last block, done\nvar IB_BAD=9;   // ot a data error--stuck here\n\nvar fixed_bl = 9;\nvar fixed_bd = 5;\n\nvar fixed_tl = [\n    96,7,256, 0,8,80, 0,8,16, 84,8,115,\n    82,7,31, 0,8,112, 0,8,48, 0,9,192,\n    80,7,10, 0,8,96, 0,8,32, 0,9,160,\n    0,8,0, 0,8,128, 0,8,64, 0,9,224,\n    80,7,6, 0,8,88, 0,8,24, 0,9,144,\n    83,7,59, 0,8,120, 0,8,56, 0,9,208,\n    81,7,17, 0,8,104, 0,8,40, 0,9,176,\n    0,8,8, 0,8,136, 0,8,72, 0,9,240,\n    80,7,4, 0,8,84, 0,8,20, 85,8,227,\n    83,7,43, 0,8,116, 0,8,52, 0,9,200,\n    81,7,13, 0,8,100, 0,8,36, 0,9,168,\n    0,8,4, 0,8,132, 0,8,68, 0,9,232,\n    80,7,8, 0,8,92, 0,8,28, 0,9,152,\n    84,7,83, 0,8,124, 0,8,60, 0,9,216,\n    82,7,23, 0,8,108, 0,8,44, 0,9,184,\n    0,8,12, 0,8,140, 0,8,76, 0,9,248,\n    80,7,3, 0,8,82, 0,8,18, 85,8,163,\n    83,7,35, 0,8,114, 0,8,50, 0,9,196,\n    81,7,11, 0,8,98, 0,8,34, 0,9,164,\n    0,8,2, 0,8,130, 0,8,66, 0,9,228,\n    80,7,7, 0,8,90, 0,8,26, 0,9,148,\n    84,7,67, 0,8,122, 0,8,58, 0,9,212,\n    82,7,19, 0,8,106, 0,8,42, 0,9,180,\n    0,8,10, 0,8,138, 0,8,74, 0,9,244,\n    80,7,5, 0,8,86, 0,8,22, 192,8,0,\n    83,7,51, 0,8,118, 0,8,54, 0,9,204,\n    81,7,15, 0,8,102, 0,8,38, 0,9,172,\n    0,8,6, 0,8,134, 0,8,70, 0,9,236,\n    80,7,9, 0,8,94, 0,8,30, 0,9,156,\n    84,7,99, 0,8,126, 0,8,62, 0,9,220,\n    82,7,27, 0,8,110, 0,8,46, 0,9,188,\n    0,8,14, 0,8,142, 0,8,78, 0,9,252,\n    96,7,256, 0,8,81, 0,8,17, 85,8,131,\n    82,7,31, 0,8,113, 0,8,49, 0,9,194,\n    80,7,10, 0,8,97, 0,8,33, 0,9,162,\n    0,8,1, 0,8,129, 0,8,65, 0,9,226,\n    80,7,6, 0,8,89, 0,8,25, 0,9,146,\n    83,7,59, 0,8,121, 0,8,57, 0,9,210,\n    81,7,17, 0,8,105, 0,8,41, 0,9,178,\n    0,8,9, 0,8,137, 0,8,73, 0,9,242,\n    80,7,4, 0,8,85, 0,8,21, 80,8,258,\n    83,7,43, 0,8,117, 0,8,53, 0,9,202,\n    81,7,13, 0,8,101, 0,8,37, 0,9,170,\n    0,8,5, 0,8,133, 0,8,69, 0,9,234,\n    80,7,8, 0,8,93, 0,8,29, 0,9,154,\n    84,7,83, 0,8,125, 0,8,61, 0,9,218,\n    82,7,23, 0,8,109, 0,8,45, 0,9,186,\n    0,8,13, 0,8,141, 0,8,77, 0,9,250,\n    80,7,3, 0,8,83, 0,8,19, 85,8,195,\n    83,7,35, 0,8,115, 0,8,51, 0,9,198,\n    81,7,11, 0,8,99, 0,8,35, 0,9,166,\n    0,8,3, 0,8,131, 0,8,67, 0,9,230,\n    80,7,7, 0,8,91, 0,8,27, 0,9,150,\n    84,7,67, 0,8,123, 0,8,59, 0,9,214,\n    82,7,19, 0,8,107, 0,8,43, 0,9,182,\n    0,8,11, 0,8,139, 0,8,75, 0,9,246,\n    80,7,5, 0,8,87, 0,8,23, 192,8,0,\n    83,7,51, 0,8,119, 0,8,55, 0,9,206,\n    81,7,15, 0,8,103, 0,8,39, 0,9,174,\n    0,8,7, 0,8,135, 0,8,71, 0,9,238,\n    80,7,9, 0,8,95, 0,8,31, 0,9,158,\n    84,7,99, 0,8,127, 0,8,63, 0,9,222,\n    82,7,27, 0,8,111, 0,8,47, 0,9,190,\n    0,8,15, 0,8,143, 0,8,79, 0,9,254,\n    96,7,256, 0,8,80, 0,8,16, 84,8,115,\n    82,7,31, 0,8,112, 0,8,48, 0,9,193,\n\n    80,7,10, 0,8,96, 0,8,32, 0,9,161,\n    0,8,0, 0,8,128, 0,8,64, 0,9,225,\n    80,7,6, 0,8,88, 0,8,24, 0,9,145,\n    83,7,59, 0,8,120, 0,8,56, 0,9,209,\n    81,7,17, 0,8,104, 0,8,40, 0,9,177,\n    0,8,8, 0,8,136, 0,8,72, 0,9,241,\n    80,7,4, 0,8,84, 0,8,20, 85,8,227,\n    83,7,43, 0,8,116, 0,8,52, 0,9,201,\n    81,7,13, 0,8,100, 0,8,36, 0,9,169,\n    0,8,4, 0,8,132, 0,8,68, 0,9,233,\n    80,7,8, 0,8,92, 0,8,28, 0,9,153,\n    84,7,83, 0,8,124, 0,8,60, 0,9,217,\n    82,7,23, 0,8,108, 0,8,44, 0,9,185,\n    0,8,12, 0,8,140, 0,8,76, 0,9,249,\n    80,7,3, 0,8,82, 0,8,18, 85,8,163,\n    83,7,35, 0,8,114, 0,8,50, 0,9,197,\n    81,7,11, 0,8,98, 0,8,34, 0,9,165,\n    0,8,2, 0,8,130, 0,8,66, 0,9,229,\n    80,7,7, 0,8,90, 0,8,26, 0,9,149,\n    84,7,67, 0,8,122, 0,8,58, 0,9,213,\n    82,7,19, 0,8,106, 0,8,42, 0,9,181,\n    0,8,10, 0,8,138, 0,8,74, 0,9,245,\n    80,7,5, 0,8,86, 0,8,22, 192,8,0,\n    83,7,51, 0,8,118, 0,8,54, 0,9,205,\n    81,7,15, 0,8,102, 0,8,38, 0,9,173,\n    0,8,6, 0,8,134, 0,8,70, 0,9,237,\n    80,7,9, 0,8,94, 0,8,30, 0,9,157,\n    84,7,99, 0,8,126, 0,8,62, 0,9,221,\n    82,7,27, 0,8,110, 0,8,46, 0,9,189,\n    0,8,14, 0,8,142, 0,8,78, 0,9,253,\n    96,7,256, 0,8,81, 0,8,17, 85,8,131,\n    82,7,31, 0,8,113, 0,8,49, 0,9,195,\n    80,7,10, 0,8,97, 0,8,33, 0,9,163,\n    0,8,1, 0,8,129, 0,8,65, 0,9,227,\n    80,7,6, 0,8,89, 0,8,25, 0,9,147,\n    83,7,59, 0,8,121, 0,8,57, 0,9,211,\n    81,7,17, 0,8,105, 0,8,41, 0,9,179,\n    0,8,9, 0,8,137, 0,8,73, 0,9,243,\n    80,7,4, 0,8,85, 0,8,21, 80,8,258,\n    83,7,43, 0,8,117, 0,8,53, 0,9,203,\n    81,7,13, 0,8,101, 0,8,37, 0,9,171,\n    0,8,5, 0,8,133, 0,8,69, 0,9,235,\n    80,7,8, 0,8,93, 0,8,29, 0,9,155,\n    84,7,83, 0,8,125, 0,8,61, 0,9,219,\n    82,7,23, 0,8,109, 0,8,45, 0,9,187,\n    0,8,13, 0,8,141, 0,8,77, 0,9,251,\n    80,7,3, 0,8,83, 0,8,19, 85,8,195,\n    83,7,35, 0,8,115, 0,8,51, 0,9,199,\n    81,7,11, 0,8,99, 0,8,35, 0,9,167,\n    0,8,3, 0,8,131, 0,8,67, 0,9,231,\n    80,7,7, 0,8,91, 0,8,27, 0,9,151,\n    84,7,67, 0,8,123, 0,8,59, 0,9,215,\n    82,7,19, 0,8,107, 0,8,43, 0,9,183,\n    0,8,11, 0,8,139, 0,8,75, 0,9,247,\n    80,7,5, 0,8,87, 0,8,23, 192,8,0,\n    83,7,51, 0,8,119, 0,8,55, 0,9,207,\n    81,7,15, 0,8,103, 0,8,39, 0,9,175,\n    0,8,7, 0,8,135, 0,8,71, 0,9,239,\n    80,7,9, 0,8,95, 0,8,31, 0,9,159,\n    84,7,99, 0,8,127, 0,8,63, 0,9,223,\n    82,7,27, 0,8,111, 0,8,47, 0,9,191,\n    0,8,15, 0,8,143, 0,8,79, 0,9,255\n];\nvar fixed_td = [\n    80,5,1, 87,5,257, 83,5,17, 91,5,4097,\n    81,5,5, 89,5,1025, 85,5,65, 93,5,16385,\n    80,5,3, 88,5,513, 84,5,33, 92,5,8193,\n    82,5,9, 90,5,2049, 86,5,129, 192,5,24577,\n    80,5,2, 87,5,385, 83,5,25, 91,5,6145,\n    81,5,7, 89,5,1537, 85,5,97, 93,5,24577,\n    80,5,4, 88,5,769, 84,5,49, 92,5,12289,\n    82,5,13, 90,5,3073, 86,5,193, 192,5,24577\n];\n\n  // Tables for deflate from PKZIP's appnote.txt.\n  var cplens = [ // Copy lengths for literal codes 257..285\n        3, 4, 5, 6, 7, 8, 9, 10, 11, 13, 15, 17, 19, 23, 27, 31,\n        35, 43, 51, 59, 67, 83, 99, 115, 131, 163, 195, 227, 258, 0, 0\n  ];\n\n  // see note #13 above about 258\n  var cplext = [ // Extra bits for literal codes 257..285\n        0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 2, 2, 2, 2,\n        3, 3, 3, 3, 4, 4, 4, 4, 5, 5, 5, 5, 0, 112, 112  // 112==invalid\n  ];\n\n var cpdist = [ // Copy offsets for distance codes 0..29\n        1, 2, 3, 4, 5, 7, 9, 13, 17, 25, 33, 49, 65, 97, 129, 193,\n        257, 385, 513, 769, 1025, 1537, 2049, 3073, 4097, 6145,\n        8193, 12289, 16385, 24577\n  ];\n\n  var cpdext = [ // Extra bits for distance codes\n        0, 0, 0, 0, 1, 1, 2, 2, 3, 3, 4, 4, 5, 5, 6, 6,\n        7, 7, 8, 8, 9, 9, 10, 10, 11, 11,\n        12, 12, 13, 13];\n\n//\n// ZStream.java\n//\n\nfunction ZStream() {\n}\n\n\nZStream.prototype.inflateInit = function(w, nowrap) {\n    if (!w) {\n\tw = DEF_WBITS;\n    }\n    if (nowrap) {\n\tnowrap = false;\n    }\n    this.istate = new Inflate();\n    return this.istate.inflateInit(this, nowrap?-w:w);\n}\n\nZStream.prototype.inflate = function(f) {\n    if(this.istate==null) return Z_STREAM_ERROR;\n    return this.istate.inflate(this, f);\n}\n\nZStream.prototype.inflateEnd = function(){\n    if(this.istate==null) return Z_STREAM_ERROR;\n    var ret=istate.inflateEnd(this);\n    this.istate = null;\n    return ret;\n}\nZStream.prototype.inflateSync = function(){\n    // if(istate == null) return Z_STREAM_ERROR;\n    return istate.inflateSync(this);\n}\nZStream.prototype.inflateSetDictionary = function(dictionary, dictLength){\n    // if(istate == null) return Z_STREAM_ERROR;\n    return istate.inflateSetDictionary(this, dictionary, dictLength);\n}\n\n/*\n\n  public int deflateInit(int level){\n    return deflateInit(level, MAX_WBITS);\n  }\n  public int deflateInit(int level, boolean nowrap){\n    return deflateInit(level, MAX_WBITS, nowrap);\n  }\n  public int deflateInit(int level, int bits){\n    return deflateInit(level, bits, false);\n  }\n  public int deflateInit(int level, int bits, boolean nowrap){\n    dstate=new Deflate();\n    return dstate.deflateInit(this, level, nowrap?-bits:bits);\n  }\n  public int deflate(int flush){\n    if(dstate==null){\n      return Z_STREAM_ERROR;\n    }\n    return dstate.deflate(this, flush);\n  }\n  public int deflateEnd(){\n    if(dstate==null) return Z_STREAM_ERROR;\n    int ret=dstate.deflateEnd();\n    dstate=null;\n    return ret;\n  }\n  public int deflateParams(int level, int strategy){\n    if(dstate==null) return Z_STREAM_ERROR;\n    return dstate.deflateParams(this, level, strategy);\n  }\n  public int deflateSetDictionary (byte[] dictionary, int dictLength){\n    if(dstate == null)\n      return Z_STREAM_ERROR;\n    return dstate.deflateSetDictionary(this, dictionary, dictLength);\n  }\n\n*/\n\n/*\n  // Flush as much pending output as possible. All deflate() output goes\n  // through this function so some applications may wish to modify it\n  // to avoid allocating a large strm->next_out buffer and copying into it.\n  // (See also read_buf()).\n  void flush_pending(){\n    int len=dstate.pending;\n\n    if(len>avail_out) len=avail_out;\n    if(len==0) return;\n\n    if(dstate.pending_buf.length<=dstate.pending_out ||\n       next_out.length<=next_out_index ||\n       dstate.pending_buf.length<(dstate.pending_out+len) ||\n       next_out.length<(next_out_index+len)){\n      System.out.println(dstate.pending_buf.length+\", \"+dstate.pending_out+\n\t\t\t \", \"+next_out.length+\", \"+next_out_index+\", \"+len);\n      System.out.println(\"avail_out=\"+avail_out);\n    }\n\n    System.arraycopy(dstate.pending_buf, dstate.pending_out,\n\t\t     next_out, next_out_index, len);\n\n    next_out_index+=len;\n    dstate.pending_out+=len;\n    total_out+=len;\n    avail_out-=len;\n    dstate.pending-=len;\n    if(dstate.pending==0){\n      dstate.pending_out=0;\n    }\n  }\n\n  // Read a new buffer from the current input stream, update the adler32\n  // and total number of bytes read.  All deflate() input goes through\n  // this function so some applications may wish to modify it to avoid\n  // allocating a large strm->next_in buffer and copying from it.\n  // (See also flush_pending()).\n  int read_buf(byte[] buf, int start, int size) {\n    int len=avail_in;\n\n    if(len>size) len=size;\n    if(len==0) return 0;\n\n    avail_in-=len;\n\n    if(dstate.noheader==0) {\n      adler=_adler.adler32(adler, next_in, next_in_index, len);\n    }\n    System.arraycopy(next_in, next_in_index, buf, start, len);\n    next_in_index  += len;\n    total_in += len;\n    return len;\n  }\n\n  public void free(){\n    next_in=null;\n    next_out=null;\n    msg=null;\n    _adler=null;\n  }\n}\n*/\n\n\n//\n// Inflate.java\n//\n\nfunction Inflate() {\n    this.was = [0];\n}\n\nInflate.prototype.inflateReset = function(z) {\n    if(z == null || z.istate == null) return Z_STREAM_ERROR;\n    \n    z.total_in = z.total_out = 0;\n    z.msg = null;\n    z.istate.mode = z.istate.nowrap!=0 ? BLOCKS : METHOD;\n    z.istate.blocks.reset(z, null);\n    return Z_OK;\n}\n\nInflate.prototype.inflateEnd = function(z){\n    if(this.blocks != null)\n      this.blocks.free(z);\n    this.blocks=null;\n    return Z_OK;\n}\n\nInflate.prototype.inflateInit = function(z, w){\n    z.msg = null;\n    this.blocks = null;\n\n    // handle undocumented nowrap option (no zlib header or check)\n    nowrap = 0;\n    if(w < 0){\n      w = - w;\n      nowrap = 1;\n    }\n\n    // set window size\n    if(w<8 ||w>15){\n      this.inflateEnd(z);\n      return Z_STREAM_ERROR;\n    }\n    this.wbits=w;\n\n    z.istate.blocks=new InfBlocks(z, \n\t\t\t\t  z.istate.nowrap!=0 ? null : this,\n\t\t\t\t  1<<w);\n\n    // reset state\n    this.inflateReset(z);\n    return Z_OK;\n  }\n\nInflate.prototype.inflate = function(z, f){\n    var r, b;\n\n    if(z == null || z.istate == null || z.next_in == null)\n      return Z_STREAM_ERROR;\n    f = f == Z_FINISH ? Z_BUF_ERROR : Z_OK;\n    r = Z_BUF_ERROR;\n    while (true){\n      switch (z.istate.mode){\n      case METHOD:\n\n        if(z.avail_in==0)return r;r=f;\n\n        z.avail_in--; z.total_in++;\n        if(((z.istate.method = z.next_in[z.next_in_index++])&0xf)!=Z_DEFLATED){\n          z.istate.mode = BAD;\n          z.msg=\"unknown compression method\";\n          z.istate.marker = 5;       // can't try inflateSync\n          break;\n        }\n        if((z.istate.method>>4)+8>z.istate.wbits){\n          z.istate.mode = BAD;\n          z.msg=\"invalid window size\";\n          z.istate.marker = 5;       // can't try inflateSync\n          break;\n        }\n        z.istate.mode=FLAG;\n      case FLAG:\n\n        if(z.avail_in==0)return r;r=f;\n\n        z.avail_in--; z.total_in++;\n        b = (z.next_in[z.next_in_index++])&0xff;\n\n        if((((z.istate.method << 8)+b) % 31)!=0){\n          z.istate.mode = BAD;\n          z.msg = \"incorrect header check\";\n          z.istate.marker = 5;       // can't try inflateSync\n          break;\n        }\n\n        if((b&PRESET_DICT)==0){\n          z.istate.mode = BLOCKS;\n          break;\n        }\n        z.istate.mode = DICT4;\n      case DICT4:\n\n        if(z.avail_in==0)return r;r=f;\n\n        z.avail_in--; z.total_in++;\n        z.istate.need=((z.next_in[z.next_in_index++]&0xff)<<24)&0xff000000;\n        z.istate.mode=DICT3;\n      case DICT3:\n\n        if(z.avail_in==0)return r;r=f;\n\n        z.avail_in--; z.total_in++;\n        z.istate.need+=((z.next_in[z.next_in_index++]&0xff)<<16)&0xff0000;\n        z.istate.mode=DICT2;\n      case DICT2:\n\n        if(z.avail_in==0)return r;r=f;\n\n        z.avail_in--; z.total_in++;\n        z.istate.need+=((z.next_in[z.next_in_index++]&0xff)<<8)&0xff00;\n        z.istate.mode=DICT1;\n      case DICT1:\n\n        if(z.avail_in==0)return r;r=f;\n\n        z.avail_in--; z.total_in++;\n        z.istate.need += (z.next_in[z.next_in_index++]&0xff);\n        z.adler = z.istate.need;\n        z.istate.mode = DICT0;\n        return Z_NEED_DICT;\n      case DICT0:\n        z.istate.mode = BAD;\n        z.msg = \"need dictionary\";\n        z.istate.marker = 0;       // can try inflateSync\n        return Z_STREAM_ERROR;\n      case BLOCKS:\n\n        r = z.istate.blocks.proc(z, r);\n        if(r == Z_DATA_ERROR){\n          z.istate.mode = BAD;\n          z.istate.marker = 0;     // can try inflateSync\n          break;\n        }\n        if(r == Z_OK){\n          r = f;\n        }\n        if(r != Z_STREAM_END){\n          return r;\n        }\n        r = f;\n        z.istate.blocks.reset(z, z.istate.was);\n        if(z.istate.nowrap!=0){\n          z.istate.mode=DONE;\n          break;\n        }\n        z.istate.mode=CHECK4;\n      case CHECK4:\n\n        if(z.avail_in==0)return r;r=f;\n\n        z.avail_in--; z.total_in++;\n        z.istate.need=((z.next_in[z.next_in_index++]&0xff)<<24)&0xff000000;\n        z.istate.mode=CHECK3;\n      case CHECK3:\n\n        if(z.avail_in==0)return r;r=f;\n\n        z.avail_in--; z.total_in++;\n        z.istate.need+=((z.next_in[z.next_in_index++]&0xff)<<16)&0xff0000;\n        z.istate.mode = CHECK2;\n      case CHECK2:\n\n        if(z.avail_in==0)return r;r=f;\n\n        z.avail_in--; z.total_in++;\n        z.istate.need+=((z.next_in[z.next_in_index++]&0xff)<<8)&0xff00;\n        z.istate.mode = CHECK1;\n      case CHECK1:\n\n        if(z.avail_in==0)return r;r=f;\n\n        z.avail_in--; z.total_in++;\n        z.istate.need+=(z.next_in[z.next_in_index++]&0xff);\n\n        if(((z.istate.was[0])) != ((z.istate.need))){\n          z.istate.mode = BAD;\n          z.msg = \"incorrect data check\";\n          z.istate.marker = 5;       // can't try inflateSync\n          break;\n        }\n\n        z.istate.mode = DONE;\n      case DONE:\n        return Z_STREAM_END;\n      case BAD:\n        return Z_DATA_ERROR;\n      default:\n        return Z_STREAM_ERROR;\n      }\n    }\n  }\n\n\nInflate.prototype.inflateSetDictionary = function(z,  dictionary, dictLength) {\n    var index=0;\n    var length = dictLength;\n    if(z==null || z.istate == null|| z.istate.mode != DICT0)\n      return Z_STREAM_ERROR;\n\n    if(z._adler.adler32(1, dictionary, 0, dictLength)!=z.adler){\n      return Z_DATA_ERROR;\n    }\n\n    z.adler = z._adler.adler32(0, null, 0, 0);\n\n    if(length >= (1<<z.istate.wbits)){\n      length = (1<<z.istate.wbits)-1;\n      index=dictLength - length;\n    }\n    z.istate.blocks.set_dictionary(dictionary, index, length);\n    z.istate.mode = BLOCKS;\n    return Z_OK;\n  }\n\n//  static private byte[] mark = {(byte)0, (byte)0, (byte)0xff, (byte)0xff};\nvar mark = [0, 0, 255, 255]\n\nInflate.prototype.inflateSync = function(z){\n    var n;       // number of bytes to look at\n    var p;       // pointer to bytes\n    var m;       // number of marker bytes found in a row\n    var r, w;   // temporaries to save total_in and total_out\n\n    // set up\n    if(z == null || z.istate == null)\n      return Z_STREAM_ERROR;\n    if(z.istate.mode != BAD){\n      z.istate.mode = BAD;\n      z.istate.marker = 0;\n    }\n    if((n=z.avail_in)==0)\n      return Z_BUF_ERROR;\n    p=z.next_in_index;\n    m=z.istate.marker;\n\n    // search\n    while (n!=0 && m < 4){\n      if(z.next_in[p] == mark[m]){\n        m++;\n      }\n      else if(z.next_in[p]!=0){\n        m = 0;\n      }\n      else{\n        m = 4 - m;\n      }\n      p++; n--;\n    }\n\n    // restore\n    z.total_in += p-z.next_in_index;\n    z.next_in_index = p;\n    z.avail_in = n;\n    z.istate.marker = m;\n\n    // return no joy or set up to restart on a new block\n    if(m != 4){\n      return Z_DATA_ERROR;\n    }\n    r=z.total_in;  w=z.total_out;\n    this.inflateReset(z);\n    z.total_in=r;  z.total_out = w;\n    z.istate.mode = BLOCKS;\n    return Z_OK;\n}\n\n  // Returns true if inflate is currently at the end of a block generated\n  // by Z_SYNC_FLUSH or Z_FULL_FLUSH. This function is used by one PPP\n  // implementation to provide an additional safety check. PPP uses Z_SYNC_FLUSH\n  // but removes the length bytes of the resulting empty stored block. When\n  // decompressing, PPP checks that at the end of input packet, inflate is\n  // waiting for these length bytes.\nInflate.prototype.inflateSyncPoint = function(z){\n    if(z == null || z.istate == null || z.istate.blocks == null)\n      return Z_STREAM_ERROR;\n    return z.istate.blocks.sync_point();\n}\n\n\n//\n// InfBlocks.java\n//\n\nvar INFBLOCKS_BORDER = [16, 17, 18, 0, 8, 7, 9, 6, 10, 5, 11, 4, 12, 3, 13, 2, 14, 1, 15];\n\nfunction InfBlocks(z, checkfn, w) {\n    this.hufts=new Int32Array(MANY*3);\n    this.window=new Uint8Array(w);\n    this.end=w;\n    this.checkfn = checkfn;\n    this.mode = IB_TYPE;\n    this.reset(z, null);\n\n    this.left = 0;            // if STORED, bytes left to copy \n\n    this.table = 0;           // table lengths (14 bits) \n    this.index = 0;           // index into blens (or border) \n    this.blens = null;         // bit lengths of codes \n    this.bb=new Int32Array(1); // bit length tree depth \n    this.tb=new Int32Array(1); // bit length decoding tree \n\n    this.codes = new InfCodes();\n\n    this.last = 0;            // true if this block is the last block \n\n  // mode independent information \n    this.bitk = 0;            // bits in bit buffer \n    this.bitb = 0;            // bit buffer \n    this.read = 0;            // window read pointer \n    this.write = 0;           // window write pointer \n    this.check = 0;          // check on output \n\n    this.inftree=new InfTree();\n}\n\n\n\n\nInfBlocks.prototype.reset = function(z, c){\n    if(c) c[0]=this.check;\n    if(this.mode==IB_CODES){\n      this.codes.free(z);\n    }\n    this.mode=IB_TYPE;\n    this.bitk=0;\n    this.bitb=0;\n    this.read=this.write=0;\n\n    if(this.checkfn)\n      z.adler=this.check=z._adler.adler32(0, null, 0, 0);\n  }\n\n InfBlocks.prototype.proc = function(z, r){\n    var t;              // temporary storage\n    var b;              // bit buffer\n    var k;              // bits in bit buffer\n    var p;              // input data pointer\n    var n;              // bytes available there\n    var q;              // output window write pointer\n    var m;              // bytes to end of window or read pointer\n\n    // copy input/output information to locals (UPDATE macro restores)\n    {p=z.next_in_index;n=z.avail_in;b=this.bitb;k=this.bitk;}\n    {q=this.write;m=(q<this.read ? this.read-q-1 : this.end-q);}\n\n    // process input based on current state\n    while(true){\n      switch (this.mode){\n      case IB_TYPE:\n\n\twhile(k<(3)){\n\t  if(n!=0){\n\t    r=Z_OK;\n\t  }\n\t  else{\n\t    this.bitb=b; this.bitk=k; \n\t    z.avail_in=n;\n\t    z.total_in+=p-z.next_in_index;z.next_in_index=p;\n\t    this.write=q;\n\t    return this.inflate_flush(z,r);\n\t  };\n\t  n--;\n\t  b|=(z.next_in[p++]&0xff)<<k;\n\t  k+=8;\n\t}\n\tt = (b & 7);\n\tthis.last = t & 1;\n\n\tswitch (t >>> 1){\n        case 0:                         // stored \n          {b>>>=(3);k-=(3);}\n          t = k & 7;                    // go to byte boundary\n\n          {b>>>=(t);k-=(t);}\n          this.mode = IB_LENS;                  // get length of stored block\n          break;\n        case 1:                         // fixed\n          {\n              var bl=new Int32Array(1);\n\t      var bd=new Int32Array(1);\n              var tl=[];\n\t      var td=[];\n\n\t      inflate_trees_fixed(bl, bd, tl, td, z);\n              this.codes.init(bl[0], bd[0], tl[0], 0, td[0], 0, z);\n          }\n\n          {b>>>=(3);k-=(3);}\n\n          this.mode = IB_CODES;\n          break;\n        case 2:                         // dynamic\n\n          {b>>>=(3);k-=(3);}\n\n          this.mode = IB_TABLE;\n          break;\n        case 3:                         // illegal\n\n          {b>>>=(3);k-=(3);}\n          this.mode = BAD;\n          z.msg = \"invalid block type\";\n          r = Z_DATA_ERROR;\n\n\t  this.bitb=b; this.bitk=k; \n\t  z.avail_in=n;z.total_in+=p-z.next_in_index;z.next_in_index=p;\n\t  this.write=q;\n\t  return this.inflate_flush(z,r);\n\t}\n\tbreak;\n      case IB_LENS:\n\twhile(k<(32)){\n\t  if(n!=0){\n\t    r=Z_OK;\n\t  }\n\t  else{\n\t    this.bitb=b; this.bitk=k; \n\t    z.avail_in=n;\n\t    z.total_in+=p-z.next_in_index;z.next_in_index=p;\n\t    this.write=q;\n\t    return this.inflate_flush(z,r);\n\t  };\n\t  n--;\n\t  b|=(z.next_in[p++]&0xff)<<k;\n\t  k+=8;\n\t}\n\n\tif ((((~b) >>> 16) & 0xffff) != (b & 0xffff)){\n\t  this.mode = BAD;\n\t  z.msg = \"invalid stored block lengths\";\n\t  r = Z_DATA_ERROR;\n\n\t  this.bitb=b; this.bitk=k; \n\t  z.avail_in=n;z.total_in+=p-z.next_in_index;z.next_in_index=p;\n\t  this.write=q;\n\t  return this.inflate_flush(z,r);\n\t}\n\tthis.left = (b & 0xffff);\n\tb = k = 0;                       // dump bits\n\tthis.mode = this.left!=0 ? IB_STORED : (this.last!=0 ? IB_DRY : IB_TYPE);\n\tbreak;\n      case IB_STORED:\n\tif (n == 0){\n\t  this.bitb=b; this.bitk=k; \n\t  z.avail_in=n;z.total_in+=p-z.next_in_index;z.next_in_index=p;\n\t  write=q;\n\t  return this.inflate_flush(z,r);\n\t}\n\n\tif(m==0){\n\t  if(q==end&&read!=0){\n\t    q=0; m=(q<this.read ? this.read-q-1 : this.end-q);\n\t  }\n\t  if(m==0){\n\t    this.write=q; \n\t    r=this.inflate_flush(z,r);\n\t    q=this.write; m = (q < this.read ? this.read-q-1 : this.end-q);\n\t    if(q==this.end && this.read != 0){\n\t      q=0; m = (q < this.read ? this.read-q-1 : this.end-q);\n\t    }\n\t    if(m==0){\n\t      this.bitb=b; this.bitk=k; \n\t      z.avail_in=n;z.total_in+=p-z.next_in_index;z.next_in_index=p;\n\t      this.write=q;\n\t      return this.inflate_flush(z,r);\n\t    }\n\t  }\n\t}\n\tr=Z_OK;\n\n\tt = this.left;\n\tif(t>n) t = n;\n\tif(t>m) t = m;\n\tarrayCopy(z.next_in, p, this.window, q, t);\n\tp += t;  n -= t;\n\tq += t;  m -= t;\n\tif ((this.left -= t) != 0)\n\t  break;\n\tthis.mode = (this.last != 0 ? IB_DRY : IB_TYPE);\n\tbreak;\n      case IB_TABLE:\n\n\twhile(k<(14)){\n\t  if(n!=0){\n\t    r=Z_OK;\n\t  }\n\t  else{\n\t    this.bitb=b; this.bitk=k; \n\t    z.avail_in=n;\n\t    z.total_in+=p-z.next_in_index;z.next_in_index=p;\n\t    this.write=q;\n\t    return this.inflate_flush(z,r);\n\t  };\n\t  n--;\n\t  b|=(z.next_in[p++]&0xff)<<k;\n\t  k+=8;\n\t}\n\n\tthis.table = t = (b & 0x3fff);\n\tif ((t & 0x1f) > 29 || ((t >> 5) & 0x1f) > 29)\n\t  {\n\t    this.mode = IB_BAD;\n\t    z.msg = \"too many length or distance symbols\";\n\t    r = Z_DATA_ERROR;\n\n\t    this.bitb=b; this.bitk=k; \n\t    z.avail_in=n;z.total_in+=p-z.next_in_index;z.next_in_index=p;\n\t    this.write=q;\n\t    return this.inflate_flush(z,r);\n\t  }\n\tt = 258 + (t & 0x1f) + ((t >> 5) & 0x1f);\n\tif(this.blens==null || this.blens.length<t){\n\t    this.blens=new Int32Array(t);\n\t}\n\telse{\n\t  for(var i=0; i<t; i++){\n              this.blens[i]=0;\n          }\n\t}\n\n\t{b>>>=(14);k-=(14);}\n\n\tthis.index = 0;\n\tmode = IB_BTREE;\n      case IB_BTREE:\n\twhile (this.index < 4 + (this.table >>> 10)){\n\t  while(k<(3)){\n\t    if(n!=0){\n\t      r=Z_OK;\n\t    }\n\t    else{\n\t      this.bitb=b; this.bitk=k; \n\t      z.avail_in=n;\n\t      z.total_in+=p-z.next_in_index;z.next_in_index=p;\n\t      this.write=q;\n\t      return this.inflate_flush(z,r);\n\t    };\n\t    n--;\n\t    b|=(z.next_in[p++]&0xff)<<k;\n\t    k+=8;\n\t  }\n\n\t  this.blens[INFBLOCKS_BORDER[this.index++]] = b&7;\n\n\t  {b>>>=(3);k-=(3);}\n\t}\n\n\twhile(this.index < 19){\n\t  this.blens[INFBLOCKS_BORDER[this.index++]] = 0;\n\t}\n\n\tthis.bb[0] = 7;\n\tt = this.inftree.inflate_trees_bits(this.blens, this.bb, this.tb, this.hufts, z);\n\tif (t != Z_OK){\n\t  r = t;\n\t  if (r == Z_DATA_ERROR){\n\t    this.blens=null;\n\t    this.mode = IB_BAD;\n\t  }\n\n\t  this.bitb=b; this.bitk=k; \n\t  z.avail_in=n;z.total_in+=p-z.next_in_index;z.next_in_index=p;\n\t  write=q;\n\t  return this.inflate_flush(z,r);\n\t}\n\n\tthis.index = 0;\n\tthis.mode = IB_DTREE;\n      case IB_DTREE:\n\twhile (true){\n\t  t = this.table;\n\t  if(!(this.index < 258 + (t & 0x1f) + ((t >> 5) & 0x1f))){\n\t    break;\n\t  }\n\n\t  var h; //int[]\n\t  var i, j, c;\n\n\t  t = this.bb[0];\n\n\t  while(k<(t)){\n\t    if(n!=0){\n\t      r=Z_OK;\n\t    }\n\t    else{\n\t      this.bitb=b; this.bitk=k; \n\t      z.avail_in=n;\n\t      z.total_in+=p-z.next_in_index;z.next_in_index=p;\n\t      this.write=q;\n\t      return this.inflate_flush(z,r);\n\t    };\n\t    n--;\n\t    b|=(z.next_in[p++]&0xff)<<k;\n\t    k+=8;\n\t  }\n\n//\t  if (this.tb[0]==-1){\n//            dlog(\"null...\");\n//\t  }\n\n\t  t=this.hufts[(this.tb[0]+(b & inflate_mask[t]))*3+1];\n\t  c=this.hufts[(this.tb[0]+(b & inflate_mask[t]))*3+2];\n\n\t  if (c < 16){\n\t    b>>>=(t);k-=(t);\n\t    this.blens[this.index++] = c;\n\t  }\n\t  else { // c == 16..18\n\t    i = c == 18 ? 7 : c - 14;\n\t    j = c == 18 ? 11 : 3;\n\n\t    while(k<(t+i)){\n\t      if(n!=0){\n\t\tr=Z_OK;\n\t      }\n\t      else{\n\t\tthis.bitb=b; this.bitk=k; \n\t\tz.avail_in=n;\n\t\tz.total_in+=p-z.next_in_index;z.next_in_index=p;\n\t\tthis.write=q;\n\t\treturn this.inflate_flush(z,r);\n\t      };\n\t      n--;\n\t      b|=(z.next_in[p++]&0xff)<<k;\n\t      k+=8;\n\t    }\n\n\t    b>>>=(t);k-=(t);\n\n\t    j += (b & inflate_mask[i]);\n\n\t    b>>>=(i);k-=(i);\n\n\t    i = this.index;\n\t    t = this.table;\n\t    if (i + j > 258 + (t & 0x1f) + ((t >> 5) & 0x1f) ||\n\t\t(c == 16 && i < 1)){\n\t      this.blens=null;\n\t      this.mode = IB_BAD;\n\t      z.msg = \"invalid bit length repeat\";\n\t      r = Z_DATA_ERROR;\n\n\t      this.bitb=b; this.bitk=k; \n\t      z.avail_in=n;z.total_in+=p-z.next_in_index;z.next_in_index=p;\n\t      this.write=q;\n\t      return this.inflate_flush(z,r);\n\t    }\n\n\t    c = c == 16 ? this.blens[i-1] : 0;\n\t    do{\n\t      this.blens[i++] = c;\n\t    }\n\t    while (--j!=0);\n\t    this.index = i;\n\t  }\n\t}\n\n\tthis.tb[0]=-1;\n\t{\n\t    var bl=new Int32Array(1);\n\t    var bd=new Int32Array(1);\n\t    var tl=new Int32Array(1);\n\t    var td=new Int32Array(1);\n\t    bl[0] = 9;         // must be <= 9 for lookahead assumptions\n\t    bd[0] = 6;         // must be <= 9 for lookahead assumptions\n\n\t    t = this.table;\n\t    t = this.inftree.inflate_trees_dynamic(257 + (t & 0x1f), \n\t\t\t\t\t      1 + ((t >> 5) & 0x1f),\n\t\t\t\t\t      this.blens, bl, bd, tl, td, this.hufts, z);\n\n\t    if (t != Z_OK){\n\t        if (t == Z_DATA_ERROR){\n\t            this.blens=null;\n\t            this.mode = BAD;\n\t        }\n\t        r = t;\n\n\t        this.bitb=b; this.bitk=k; \n\t        z.avail_in=n;z.total_in+=p-z.next_in_index;z.next_in_index=p;\n\t        this.write=q;\n\t        return this.inflate_flush(z,r);\n\t    }\n\t    this.codes.init(bl[0], bd[0], this.hufts, tl[0], this.hufts, td[0], z);\n\t}\n\tthis.mode = IB_CODES;\n      case IB_CODES:\n\tthis.bitb=b; this.bitk=k;\n\tz.avail_in=n; z.total_in+=p-z.next_in_index;z.next_in_index=p;\n\tthis.write=q;\n\n\tif ((r = this.codes.proc(this, z, r)) != Z_STREAM_END){\n\t  return this.inflate_flush(z, r);\n\t}\n\tr = Z_OK;\n\tthis.codes.free(z);\n\n\tp=z.next_in_index; n=z.avail_in;b=this.bitb;k=this.bitk;\n\tq=this.write;m = (q < this.read ? this.read-q-1 : this.end-q);\n\n\tif (this.last==0){\n\t  this.mode = IB_TYPE;\n\t  break;\n\t}\n\tthis.mode = IB_DRY;\n      case IB_DRY:\n\tthis.write=q; \n\tr = this.inflate_flush(z, r); \n\tq=this.write; m = (q < this.read ? this.read-q-1 : this.end-q);\n\tif (this.read != this.write){\n\t  this.bitb=b; this.bitk=k; \n\t  z.avail_in=n;z.total_in+=p-z.next_in_index;z.next_in_index=p;\n\t  this.write=q;\n\t  return this.inflate_flush(z, r);\n\t}\n\tmode = DONE;\n      case IB_DONE:\n\tr = Z_STREAM_END;\n\n\tthis.bitb=b; this.bitk=k; \n\tz.avail_in=n;z.total_in+=p-z.next_in_index;z.next_in_index=p;\n\tthis.write=q;\n\treturn this.inflate_flush(z, r);\n      case IB_BAD:\n\tr = Z_DATA_ERROR;\n\n\tthis.bitb=b; this.bitk=k; \n\tz.avail_in=n;z.total_in+=p-z.next_in_index;z.next_in_index=p;\n\tthis.write=q;\n\treturn this.inflate_flush(z, r);\n\n      default:\n\tr = Z_STREAM_ERROR;\n\n\tthis.bitb=b; this.bitk=k; \n\tz.avail_in=n;z.total_in+=p-z.next_in_index;z.next_in_index=p;\n\tthis.write=q;\n\treturn this.inflate_flush(z, r);\n      }\n    }\n  }\n\nInfBlocks.prototype.free = function(z){\n    this.reset(z, null);\n    this.window=null;\n    this.hufts=null;\n}\n\nInfBlocks.prototype.set_dictionary = function(d, start, n){\n    arrayCopy(d, start, window, 0, n);\n    this.read = this.write = n;\n}\n\n  // Returns true if inflate is currently at the end of a block generated\n  // by Z_SYNC_FLUSH or Z_FULL_FLUSH. \nInfBlocks.prototype.sync_point = function(){\n    return this.mode == IB_LENS;\n}\n\n  // copy as much as possible from the sliding window to the output area\nInfBlocks.prototype.inflate_flush = function(z, r){\n    var n;\n    var p;\n    var q;\n\n    // local copies of source and destination pointers\n    p = z.next_out_index;\n    q = this.read;\n\n    // compute number of bytes to copy as far as end of window\n    n = ((q <= this.write ? this.write : this.end) - q);\n    if (n > z.avail_out) n = z.avail_out;\n    if (n!=0 && r == Z_BUF_ERROR) r = Z_OK;\n\n    // update counters\n    z.avail_out -= n;\n    z.total_out += n;\n\n    // update check information\n    if(this.checkfn != null)\n      z.adler=this.check=z._adler.adler32(this.check, this.window, q, n);\n\n    // copy as far as end of window\n    arrayCopy(this.window, q, z.next_out, p, n);\n    p += n;\n    q += n;\n\n    // see if more to copy at beginning of window\n    if (q == this.end){\n      // wrap pointers\n      q = 0;\n      if (this.write == this.end)\n        this.write = 0;\n\n      // compute bytes to copy\n      n = this.write - q;\n      if (n > z.avail_out) n = z.avail_out;\n      if (n!=0 && r == Z_BUF_ERROR) r = Z_OK;\n\n      // update counters\n      z.avail_out -= n;\n      z.total_out += n;\n\n      // update check information\n      if(this.checkfn != null)\n\tz.adler=this.check=z._adler.adler32(this.check, this.window, q, n);\n\n      // copy\n      arrayCopy(this.window, q, z.next_out, p, n);\n      p += n;\n      q += n;\n    }\n\n    // update pointers\n    z.next_out_index = p;\n    this.read = q;\n\n    // done\n    return r;\n  }\n\n//\n// InfCodes.java\n//\n\nvar IC_START=0;  // x: set up for LEN\nvar IC_LEN=1;    // i: get length/literal/eob next\nvar IC_LENEXT=2; // i: getting length extra (have base)\nvar IC_DIST=3;   // i: get distance next\nvar IC_DISTEXT=4;// i: getting distance extra\nvar IC_COPY=5;   // o: copying bytes in window, waiting for space\nvar IC_LIT=6;    // o: got literal, waiting for output space\nvar IC_WASH=7;   // o: got eob, possibly still output waiting\nvar IC_END=8;    // x: got eob and all data flushed\nvar IC_BADCODE=9;// x: got error\n\nfunction InfCodes() {\n}\n\nInfCodes.prototype.init = function(bl, bd, tl, tl_index, td, td_index, z) {\n    this.mode=IC_START;\n    this.lbits=bl;\n    this.dbits=bd;\n    this.ltree=tl;\n    this.ltree_index=tl_index;\n    this.dtree = td;\n    this.dtree_index=td_index;\n    this.tree=null;\n}\n\nInfCodes.prototype.proc = function(s, z, r){ \n    var j;              // temporary storage\n    var t;              // temporary pointer (int[])\n    var tindex;         // temporary pointer\n    var e;              // extra bits or operation\n    var b=0;            // bit buffer\n    var k=0;            // bits in bit buffer\n    var p=0;            // input data pointer\n    var n;              // bytes available there\n    var q;              // output window write pointer\n    var m;              // bytes to end of window or read pointer\n    var f;              // pointer to copy strings from\n\n    // copy input/output information to locals (UPDATE macro restores)\n    p=z.next_in_index;n=z.avail_in;b=s.bitb;k=s.bitk;\n    q=s.write;m=q<s.read?s.read-q-1:s.end-q;\n\n    // process input and output based on current state\n    while (true){\n      switch (this.mode){\n\t// waiting for \"i:\"=input, \"o:\"=output, \"x:\"=nothing\n      case IC_START:         // x: set up for LEN\n\tif (m >= 258 && n >= 10){\n\n\t  s.bitb=b;s.bitk=k;\n\t  z.avail_in=n;z.total_in+=p-z.next_in_index;z.next_in_index=p;\n\t  s.write=q;\n\t  r = this.inflate_fast(this.lbits, this.dbits, \n\t\t\t   this.ltree, this.ltree_index, \n\t\t\t   this.dtree, this.dtree_index,\n\t\t\t   s, z);\n\n\t  p=z.next_in_index;n=z.avail_in;b=s.bitb;k=s.bitk;\n\t  q=s.write;m=q<s.read?s.read-q-1:s.end-q;\n\n\t  if (r != Z_OK){\n\t    this.mode = r == Z_STREAM_END ? IC_WASH : IC_BADCODE;\n\t    break;\n\t  }\n\t}\n\tthis.need = this.lbits;\n\tthis.tree = this.ltree;\n\tthis.tree_index=this.ltree_index;\n\n\tthis.mode = IC_LEN;\n      case IC_LEN:           // i: get length/literal/eob next\n\tj = this.need;\n\n\twhile(k<(j)){\n\t  if(n!=0)r=Z_OK;\n\t  else{\n\n\t    s.bitb=b;s.bitk=k;\n\t    z.avail_in=n;z.total_in+=p-z.next_in_index;z.next_in_index=p;\n\t    s.write=q;\n\t    return s.inflate_flush(z,r);\n\t  }\n\t  n--;\n\t  b|=(z.next_in[p++]&0xff)<<k;\n\t  k+=8;\n\t}\n\n\ttindex=(this.tree_index+(b&inflate_mask[j]))*3;\n\n\tb>>>=(this.tree[tindex+1]);\n\tk-=(this.tree[tindex+1]);\n\n\te=this.tree[tindex];\n\n\tif(e == 0){               // literal\n\t  this.lit = this.tree[tindex+2];\n\t  this.mode = IC_LIT;\n\t  break;\n\t}\n\tif((e & 16)!=0 ){          // length\n\t  this.get = e & 15;\n\t  this.len = this.tree[tindex+2];\n\t  this.mode = IC_LENEXT;\n\t  break;\n\t}\n\tif ((e & 64) == 0){        // next table\n\t  this.need = e;\n\t  this.tree_index = tindex/3 + this.tree[tindex+2];\n\t  break;\n\t}\n\tif ((e & 32)!=0){               // end of block\n\t  this.mode = IC_WASH;\n\t  break;\n\t}\n\tthis.mode = IC_BADCODE;        // invalid code\n\tz.msg = \"invalid literal/length code\";\n\tr = Z_DATA_ERROR;\n\n\ts.bitb=b;s.bitk=k;\n\tz.avail_in=n;z.total_in+=p-z.next_in_index;z.next_in_index=p;\n\ts.write=q;\n\treturn s.inflate_flush(z,r);\n\n      case IC_LENEXT:        // i: getting length extra (have base)\n\tj = this.get;\n\n\twhile(k<(j)){\n\t  if(n!=0)r=Z_OK;\n\t  else{\n\n\t    s.bitb=b;s.bitk=k;\n\t    z.avail_in=n;z.total_in+=p-z.next_in_index;z.next_in_index=p;\n\t    s.write=q;\n\t    return s.inflate_flush(z,r);\n\t  }\n\t  n--; b|=(z.next_in[p++]&0xff)<<k;\n\t  k+=8;\n\t}\n\n\tthis.len += (b & inflate_mask[j]);\n\n\tb>>=j;\n\tk-=j;\n\n\tthis.need = this.dbits;\n\tthis.tree = this.dtree;\n\tthis.tree_index = this.dtree_index;\n\tthis.mode = IC_DIST;\n      case IC_DIST:          // i: get distance next\n\tj = this.need;\n\n\twhile(k<(j)){\n\t  if(n!=0)r=Z_OK;\n\t  else{\n\n\t    s.bitb=b;s.bitk=k;\n\t    z.avail_in=n;z.total_in+=p-z.next_in_index;z.next_in_index=p;\n\t    s.write=q;\n\t    return s.inflate_flush(z,r);\n\t  }\n\t  n--; b|=(z.next_in[p++]&0xff)<<k;\n\t  k+=8;\n\t}\n\n\ttindex=(this.tree_index+(b & inflate_mask[j]))*3;\n\n\tb>>=this.tree[tindex+1];\n\tk-=this.tree[tindex+1];\n\n\te = (this.tree[tindex]);\n\tif((e & 16)!=0){               // distance\n\t  this.get = e & 15;\n\t  this.dist = this.tree[tindex+2];\n\t  this.mode = IC_DISTEXT;\n\t  break;\n\t}\n\tif ((e & 64) == 0){        // next table\n\t  this.need = e;\n\t  this.tree_index = tindex/3 + this.tree[tindex+2];\n\t  break;\n\t}\n\tthis.mode = IC_BADCODE;        // invalid code\n\tz.msg = \"invalid distance code\";\n\tr = Z_DATA_ERROR;\n\n\ts.bitb=b;s.bitk=k;\n\tz.avail_in=n;z.total_in+=p-z.next_in_index;z.next_in_index=p;\n\ts.write=q;\n\treturn s.inflate_flush(z,r);\n\n      case IC_DISTEXT:       // i: getting distance extra\n\tj = this.get;\n\n\twhile(k<(j)){\n\t  if(n!=0)r=Z_OK;\n\t  else{\n\n\t    s.bitb=b;s.bitk=k;\n\t    z.avail_in=n;z.total_in+=p-z.next_in_index;z.next_in_index=p;\n\t    s.write=q;\n\t    return s.inflate_flush(z,r);\n\t  }\n\t  n--; b|=(z.next_in[p++]&0xff)<<k;\n\t  k+=8;\n\t}\n\n\tthis.dist += (b & inflate_mask[j]);\n\n\tb>>=j;\n\tk-=j;\n\n\tthis.mode = IC_COPY;\n      case IC_COPY:          // o: copying bytes in window, waiting for space\n        f = q - this.dist;\n        while(f < 0){     // modulo window size-\"while\" instead\n          f += s.end;     // of \"if\" handles invalid distances\n\t}\n\twhile (this.len!=0){\n\n\t  if(m==0){\n\t    if(q==s.end&&s.read!=0){q=0;m=q<s.read?s.read-q-1:s.end-q;}\n\t    if(m==0){\n\t      s.write=q; r=s.inflate_flush(z,r);\n\t      q=s.write;m=q<s.read?s.read-q-1:s.end-q;\n\n\t      if(q==s.end&&s.read!=0){q=0;m=q<s.read?s.read-q-1:s.end-q;}\n\n\t      if(m==0){\n\t\ts.bitb=b;s.bitk=k;\n\t\tz.avail_in=n;z.total_in+=p-z.next_in_index;z.next_in_index=p;\n\t\ts.write=q;\n\t\treturn s.inflate_flush(z,r);\n\t      }  \n\t    }\n\t  }\n\n\t  s.window[q++]=s.window[f++]; m--;\n\n\t  if (f == s.end)\n            f = 0;\n\t  this.len--;\n\t}\n\tthis.mode = IC_START;\n\tbreak;\n      case IC_LIT:           // o: got literal, waiting for output space\n\tif(m==0){\n\t  if(q==s.end&&s.read!=0){q=0;m=q<s.read?s.read-q-1:s.end-q;}\n\t  if(m==0){\n\t    s.write=q; r=s.inflate_flush(z,r);\n\t    q=s.write;m=q<s.read?s.read-q-1:s.end-q;\n\n\t    if(q==s.end&&s.read!=0){q=0;m=q<s.read?s.read-q-1:s.end-q;}\n\t    if(m==0){\n\t      s.bitb=b;s.bitk=k;\n\t      z.avail_in=n;z.total_in+=p-z.next_in_index;z.next_in_index=p;\n\t      s.write=q;\n\t      return s.inflate_flush(z,r);\n\t    }\n\t  }\n\t}\n\tr=Z_OK;\n\n\ts.window[q++]=this.lit; m--;\n\n\tthis.mode = IC_START;\n\tbreak;\n      case IC_WASH:           // o: got eob, possibly more output\n\tif (k > 7){        // return unused byte, if any\n\t  k -= 8;\n\t  n++;\n\t  p--;             // can always return one\n\t}\n\n\ts.write=q; r=s.inflate_flush(z,r);\n\tq=s.write;m=q<s.read?s.read-q-1:s.end-q;\n\n\tif (s.read != s.write){\n\t  s.bitb=b;s.bitk=k;\n\t  z.avail_in=n;z.total_in+=p-z.next_in_index;z.next_in_index=p;\n\t  s.write=q;\n\t  return s.inflate_flush(z,r);\n\t}\n\tthis.mode = IC_END;\n      case IC_END:\n\tr = Z_STREAM_END;\n\ts.bitb=b;s.bitk=k;\n\tz.avail_in=n;z.total_in+=p-z.next_in_index;z.next_in_index=p;\n\ts.write=q;\n\treturn s.inflate_flush(z,r);\n\n      case IC_BADCODE:       // x: got error\n\n\tr = Z_DATA_ERROR;\n\n\ts.bitb=b;s.bitk=k;\n\tz.avail_in=n;z.total_in+=p-z.next_in_index;z.next_in_index=p;\n\ts.write=q;\n\treturn s.inflate_flush(z,r);\n\n      default:\n\tr = Z_STREAM_ERROR;\n\n\ts.bitb=b;s.bitk=k;\n\tz.avail_in=n;z.total_in+=p-z.next_in_index;z.next_in_index=p;\n\ts.write=q;\n\treturn s.inflate_flush(z,r);\n      }\n    }\n  }\n\nInfCodes.prototype.free = function(z){\n    //  ZFREE(z, c);\n}\n\n  // Called with number of bytes left to write in window at least 258\n  // (the maximum string length) and number of input bytes available\n  // at least ten.  The ten bytes are six bytes for the longest length/\n  // distance pair plus four bytes for overloading the bit buffer.\n\nInfCodes.prototype.inflate_fast = function(bl, bd, tl, tl_index, td, td_index, s, z) {\n    var t;                // temporary pointer\n    var   tp;             // temporary pointer (int[])\n    var tp_index;         // temporary pointer\n    var e;                // extra bits or operation\n    var b;                // bit buffer\n    var k;                // bits in bit buffer\n    var p;                // input data pointer\n    var n;                // bytes available there\n    var q;                // output window write pointer\n    var m;                // bytes to end of window or read pointer\n    var ml;               // mask for literal/length tree\n    var md;               // mask for distance tree\n    var c;                // bytes to copy\n    var d;                // distance back to copy from\n    var r;                // copy source pointer\n\n    var tp_index_t_3;     // (tp_index+t)*3\n\n    // load input, output, bit values\n    p=z.next_in_index;n=z.avail_in;b=s.bitb;k=s.bitk;\n    q=s.write;m=q<s.read?s.read-q-1:s.end-q;\n\n    // initialize masks\n    ml = inflate_mask[bl];\n    md = inflate_mask[bd];\n\n    // do until not enough input or output space for fast loop\n    do {                          // assume called with m >= 258 && n >= 10\n      // get literal/length code\n      while(k<(20)){              // max bits for literal/length code\n\tn--;\n\tb|=(z.next_in[p++]&0xff)<<k;k+=8;\n      }\n\n      t= b&ml;\n      tp=tl; \n      tp_index=tl_index;\n      tp_index_t_3=(tp_index+t)*3;\n      if ((e = tp[tp_index_t_3]) == 0){\n\tb>>=(tp[tp_index_t_3+1]); k-=(tp[tp_index_t_3+1]);\n\n\ts.window[q++] = tp[tp_index_t_3+2];\n\tm--;\n\tcontinue;\n      }\n      do {\n\n\tb>>=(tp[tp_index_t_3+1]); k-=(tp[tp_index_t_3+1]);\n\n\tif((e&16)!=0){\n\t  e &= 15;\n\t  c = tp[tp_index_t_3+2] + (b & inflate_mask[e]);\n\n\t  b>>=e; k-=e;\n\n\t  // decode distance base of block to copy\n\t  while(k<(15)){           // max bits for distance code\n\t    n--;\n\t    b|=(z.next_in[p++]&0xff)<<k;k+=8;\n\t  }\n\n\t  t= b&md;\n\t  tp=td;\n\t  tp_index=td_index;\n          tp_index_t_3=(tp_index+t)*3;\n\t  e = tp[tp_index_t_3];\n\n\t  do {\n\n\t    b>>=(tp[tp_index_t_3+1]); k-=(tp[tp_index_t_3+1]);\n\n\t    if((e&16)!=0){\n\t      // get extra bits to add to distance base\n\t      e &= 15;\n\t      while(k<(e)){         // get extra bits (up to 13)\n\t\tn--;\n\t\tb|=(z.next_in[p++]&0xff)<<k;k+=8;\n\t      }\n\n\t      d = tp[tp_index_t_3+2] + (b&inflate_mask[e]);\n\n\t      b>>=(e); k-=(e);\n\n\t      // do the copy\n\t      m -= c;\n\t      if (q >= d){                // offset before dest\n\t\t//  just copy\n\t\tr=q-d;\n\t\tif(q-r>0 && 2>(q-r)){           \n\t\t  s.window[q++]=s.window[r++]; // minimum count is three,\n\t\t  s.window[q++]=s.window[r++]; // so unroll loop a little\n\t\t  c-=2;\n\t\t}\n\t\telse{\n\t\t  s.window[q++]=s.window[r++]; // minimum count is three,\n\t\t  s.window[q++]=s.window[r++]; // so unroll loop a little\n\t\t  c-=2;\n\t\t}\n\t      }\n\t      else{                  // else offset after destination\n                r=q-d;\n                do{\n                  r+=s.end;          // force pointer in window\n                }while(r<0);         // covers invalid distances\n\t\te=s.end-r;\n\t\tif(c>e){             // if source crosses,\n\t\t  c-=e;              // wrapped copy\n\t\t  if(q-r>0 && e>(q-r)){           \n\t\t    do{s.window[q++] = s.window[r++];}\n\t\t    while(--e!=0);\n\t\t  }\n\t\t  else{\n\t\t    arrayCopy(s.window, r, s.window, q, e);\n\t\t    q+=e; r+=e; e=0;\n\t\t  }\n\t\t  r = 0;                  // copy rest from start of window\n\t\t}\n\n\t      }\n\n\t      // copy all or what's left\n              do{s.window[q++] = s.window[r++];}\n\t\twhile(--c!=0);\n\t      break;\n\t    }\n\t    else if((e&64)==0){\n\t      t+=tp[tp_index_t_3+2];\n\t      t+=(b&inflate_mask[e]);\n\t      tp_index_t_3=(tp_index+t)*3;\n\t      e=tp[tp_index_t_3];\n\t    }\n\t    else{\n\t      z.msg = \"invalid distance code\";\n\n\t      c=z.avail_in-n;c=(k>>3)<c?k>>3:c;n+=c;p-=c;k-=c<<3;\n\n\t      s.bitb=b;s.bitk=k;\n\t      z.avail_in=n;z.total_in+=p-z.next_in_index;z.next_in_index=p;\n\t      s.write=q;\n\n\t      return Z_DATA_ERROR;\n\t    }\n\t  }\n\t  while(true);\n\t  break;\n\t}\n\n\tif((e&64)==0){\n\t  t+=tp[tp_index_t_3+2];\n\t  t+=(b&inflate_mask[e]);\n\t  tp_index_t_3=(tp_index+t)*3;\n\t  if((e=tp[tp_index_t_3])==0){\n\n\t    b>>=(tp[tp_index_t_3+1]); k-=(tp[tp_index_t_3+1]);\n\n\t    s.window[q++]=tp[tp_index_t_3+2];\n\t    m--;\n\t    break;\n\t  }\n\t}\n\telse if((e&32)!=0){\n\n\t  c=z.avail_in-n;c=(k>>3)<c?k>>3:c;n+=c;p-=c;k-=c<<3;\n \n\t  s.bitb=b;s.bitk=k;\n\t  z.avail_in=n;z.total_in+=p-z.next_in_index;z.next_in_index=p;\n\t  s.write=q;\n\n\t  return Z_STREAM_END;\n\t}\n\telse{\n\t  z.msg=\"invalid literal/length code\";\n\n\t  c=z.avail_in-n;c=(k>>3)<c?k>>3:c;n+=c;p-=c;k-=c<<3;\n\n\t  s.bitb=b;s.bitk=k;\n\t  z.avail_in=n;z.total_in+=p-z.next_in_index;z.next_in_index=p;\n\t  s.write=q;\n\n\t  return Z_DATA_ERROR;\n\t}\n      } \n      while(true);\n    } \n    while(m>=258 && n>= 10);\n\n    // not enough input or output--restore pointers and return\n    c=z.avail_in-n;c=(k>>3)<c?k>>3:c;n+=c;p-=c;k-=c<<3;\n\n    s.bitb=b;s.bitk=k;\n    z.avail_in=n;z.total_in+=p-z.next_in_index;z.next_in_index=p;\n    s.write=q;\n\n    return Z_OK;\n}\n\n//\n// InfTree.java\n//\n\nfunction InfTree() {\n}\n\nInfTree.prototype.huft_build = function(b, bindex, n, s, d, e, t, m, hp, hn, v) {\n\n    // Given a list of code lengths and a maximum table size, make a set of\n    // tables to decode that set of codes.  Return Z_OK on success, Z_BUF_ERROR\n    // if the given code set is incomplete (the tables are still built in this\n    // case), Z_DATA_ERROR if the input is invalid (an over-subscribed set of\n    // lengths), or Z_MEM_ERROR if not enough memory.\n\n    var a;                       // counter for codes of length k\n    var f;                       // i repeats in table every f entries\n    var g;                       // maximum code length\n    var h;                       // table level\n    var i;                       // counter, current code\n    var j;                       // counter\n    var k;                       // number of bits in current code\n    var l;                       // bits per table (returned in m)\n    var mask;                    // (1 << w) - 1, to avoid cc -O bug on HP\n    var p;                       // pointer into c[], b[], or v[]\n    var q;                       // points to current table\n    var w;                       // bits before this table == (l * h)\n    var xp;                      // pointer into x\n    var y;                       // number of dummy codes added\n    var z;                       // number of entries in current table\n\n    // Generate counts for each bit length\n\n    p = 0; i = n;\n    do {\n      this.c[b[bindex+p]]++; p++; i--;   // assume all entries <= BMAX\n    }while(i!=0);\n\n    if(this.c[0] == n){                // null input--all zero length codes\n      t[0] = -1;\n      m[0] = 0;\n      return Z_OK;\n    }\n\n    // Find minimum and maximum length, bound *m by those\n    l = m[0];\n    for (j = 1; j <= BMAX; j++)\n      if(this.c[j]!=0) break;\n    k = j;                        // minimum code length\n    if(l < j){\n      l = j;\n    }\n    for (i = BMAX; i!=0; i--){\n      if(this.c[i]!=0) break;\n    }\n    g = i;                        // maximum code length\n    if(l > i){\n      l = i;\n    }\n    m[0] = l;\n\n    // Adjust last length count to fill out codes, if needed\n    for (y = 1 << j; j < i; j++, y <<= 1){\n      if ((y -= this.c[j]) < 0){\n        return Z_DATA_ERROR;\n      }\n    }\n    if ((y -= this.c[i]) < 0){\n      return Z_DATA_ERROR;\n    }\n    this.c[i] += y;\n\n    // Generate starting offsets into the value table for each length\n    this.x[1] = j = 0;\n    p = 1;  xp = 2;\n    while (--i!=0) {                 // note that i == g from above\n      this.x[xp] = (j += this.c[p]);\n      xp++;\n      p++;\n    }\n\n    // Make a table of values in order of bit lengths\n    i = 0; p = 0;\n    do {\n      if ((j = b[bindex+p]) != 0){\n        this.v[this.x[j]++] = i;\n      }\n      p++;\n    }\n    while (++i < n);\n    n = this.x[g];                     // set n to length of v\n\n    // Generate the Huffman codes and for each, make the table entries\n    this.x[0] = i = 0;                 // first Huffman code is zero\n    p = 0;                        // grab values in bit order\n    h = -1;                       // no tables yet--level -1\n    w = -l;                       // bits decoded == (l * h)\n    this.u[0] = 0;                     // just to keep compilers happy\n    q = 0;                        // ditto\n    z = 0;                        // ditto\n\n    // go through the bit lengths (k already is bits in shortest code)\n    for (; k <= g; k++){\n      a = this.c[k];\n      while (a--!=0){\n\t// here i is the Huffman code of length k bits for value *p\n\t// make tables up to required level\n        while (k > w + l){\n          h++;\n          w += l;                 // previous table always l bits\n\t  // compute minimum size table less than or equal to l bits\n          z = g - w;\n          z = (z > l) ? l : z;        // table size upper limit\n          if((f=1<<(j=k-w))>a+1){     // try a k-w bit table\n                                      // too few codes for k-w bit table\n            f -= a + 1;               // deduct codes from patterns left\n            xp = k;\n            if(j < z){\n              while (++j < z){        // try smaller tables up to z bits\n                if((f <<= 1) <= this.c[++xp])\n                  break;              // enough codes to use up j bits\n                f -= this.c[xp];           // else deduct codes from patterns\n              }\n\t    }\n          }\n          z = 1 << j;                 // table entries for j-bit table\n\n\t  // allocate new table\n          if (this.hn[0] + z > MANY){       // (note: doesn't matter for fixed)\n            return Z_DATA_ERROR;       // overflow of MANY\n          }\n          this.u[h] = q = /*hp+*/ this.hn[0];   // DEBUG\n          this.hn[0] += z;\n \n\t  // connect to last table, if there is one\n\t  if(h!=0){\n            this.x[h]=i;           // save pattern for backing up\n            this.r[0]=j;     // bits in this table\n            this.r[1]=l;     // bits to dump before this table\n            j=i>>>(w - l);\n            this.r[2] = (q - this.u[h-1] - j);               // offset to this table\n            arrayCopy(this.r, 0, hp, (this.u[h-1]+j)*3, 3); // connect to last table\n          }\n          else{\n            t[0] = q;               // first table is returned result\n\t  }\n        }\n\n\t// set up table entry in r\n        this.r[1] = (k - w);\n        if (p >= n){\n          this.r[0] = 128 + 64;      // out of values--invalid code\n\t}\n        else if (v[p] < s){\n          this.r[0] = (this.v[p] < 256 ? 0 : 32 + 64);  // 256 is end-of-block\n          this.r[2] = this.v[p++];          // simple code is just the value\n        }\n        else{\n          this.r[0]=(e[this.v[p]-s]+16+64); // non-simple--look up in lists\n          this.r[2]=d[this.v[p++] - s];\n        }\n\n        // fill code-like entries with r\n        f=1<<(k-w);\n        for (j=i>>>w;j<z;j+=f){\n          arrayCopy(this.r, 0, hp, (q+j)*3, 3);\n\t}\n\n\t// backwards increment the k-bit code i\n        for (j = 1 << (k - 1); (i & j)!=0; j >>>= 1){\n          i ^= j;\n\t}\n        i ^= j;\n\n\t// backup over finished tables\n        mask = (1 << w) - 1;      // needed on HP, cc -O bug\n        while ((i & mask) != this.x[h]){\n          h--;                    // don't need to update q\n          w -= l;\n          mask = (1 << w) - 1;\n        }\n      }\n    }\n    // Return Z_BUF_ERROR if we were given an incomplete table\n    return y != 0 && g != 1 ? Z_BUF_ERROR : Z_OK;\n}\n\nInfTree.prototype.inflate_trees_bits = function(c, bb, tb, hp, z) {\n    var result;\n    this.initWorkArea(19);\n    this.hn[0]=0;\n    result = this.huft_build(c, 0, 19, 19, null, null, tb, bb, hp, this.hn, this.v);\n\n    if(result == Z_DATA_ERROR){\n      z.msg = \"oversubscribed dynamic bit lengths tree\";\n    }\n    else if(result == Z_BUF_ERROR || bb[0] == 0){\n      z.msg = \"incomplete dynamic bit lengths tree\";\n      result = Z_DATA_ERROR;\n    }\n    return result;\n}\n\nInfTree.prototype.inflate_trees_dynamic = function(nl, nd, c, bl, bd, tl, td, hp, z) {\n    var result;\n\n    // build literal/length tree\n    this.initWorkArea(288);\n    this.hn[0]=0;\n    result = this.huft_build(c, 0, nl, 257, cplens, cplext, tl, bl, hp, this.hn, this.v);\n    if (result != Z_OK || bl[0] == 0){\n      if(result == Z_DATA_ERROR){\n        z.msg = \"oversubscribed literal/length tree\";\n      }\n      else if (result != Z_MEM_ERROR){\n        z.msg = \"incomplete literal/length tree\";\n        result = Z_DATA_ERROR;\n      }\n      return result;\n    }\n\n    // build distance tree\n    this.initWorkArea(288);\n    result = this.huft_build(c, nl, nd, 0, cpdist, cpdext, td, bd, hp, this.hn, this.v);\n\n    if (result != Z_OK || (bd[0] == 0 && nl > 257)){\n      if (result == Z_DATA_ERROR){\n        z.msg = \"oversubscribed distance tree\";\n      }\n      else if (result == Z_BUF_ERROR) {\n        z.msg = \"incomplete distance tree\";\n        result = Z_DATA_ERROR;\n      }\n      else if (result != Z_MEM_ERROR){\n        z.msg = \"empty distance tree with lengths\";\n        result = Z_DATA_ERROR;\n      }\n      return result;\n    }\n\n    return Z_OK;\n}\n/*\n  static int inflate_trees_fixed(int[] bl,  //literal desired/actual bit depth\n                                 int[] bd,  //distance desired/actual bit depth\n                                 int[][] tl,//literal/length tree result\n                                 int[][] td,//distance tree result \n                                 ZStream z  //for memory allocation\n\t\t\t\t ){\n\n*/\n\nfunction inflate_trees_fixed(bl, bd, tl, td, z) {\n    bl[0]=fixed_bl;\n    bd[0]=fixed_bd;\n    tl[0]=fixed_tl;\n    td[0]=fixed_td;\n    return Z_OK;\n}\n\nInfTree.prototype.initWorkArea = function(vsize){\n    if(this.hn==null){\n        this.hn=new Int32Array(1);\n        this.v=new Int32Array(vsize);\n        this.c=new Int32Array(BMAX+1);\n        this.r=new Int32Array(3);\n        this.u=new Int32Array(BMAX);\n        this.x=new Int32Array(BMAX+1);\n    }\n    if(this.v.length<vsize){ \n        this.v=new Int32Array(vsize); \n    }\n    for(var i=0; i<vsize; i++){this.v[i]=0;}\n    for(var i=0; i<BMAX+1; i++){this.c[i]=0;}\n    for(var i=0; i<3; i++){this.r[i]=0;}\n//  for(int i=0; i<BMAX; i++){u[i]=0;}\n    arrayCopy(this.c, 0, this.u, 0, BMAX);\n//  for(int i=0; i<BMAX+1; i++){x[i]=0;}\n    arrayCopy(this.c, 0, this.x, 0, BMAX+1);\n}\n\nvar testArray = new Uint8Array(1);\nvar hasSubarray = (typeof testArray.subarray === 'function');\nvar hasSlice = false; /* (typeof testArray.slice === 'function'); */ // Chrome slice performance is so dire that we're currently not using it...\n\nfunction arrayCopy(src, srcOffset, dest, destOffset, count) {\n    if (count == 0) {\n        return;\n    } \n    if (!src) {\n        throw \"Undef src\";\n    } else if (!dest) {\n        throw \"Undef dest\";\n    }\n\n    if (srcOffset == 0 && count == src.length) {\n        arrayCopy_fast(src, dest, destOffset);\n    } else if (hasSubarray) {\n        arrayCopy_fast(src.subarray(srcOffset, srcOffset + count), dest, destOffset); \n    } else if (src.BYTES_PER_ELEMENT == 1 && count > 100) {\n        arrayCopy_fast(new Uint8Array(src.buffer, src.byteOffset + srcOffset, count), dest, destOffset);\n    } else { \n        arrayCopy_slow(src, srcOffset, dest, destOffset, count);\n    }\n\n}\n\nfunction arrayCopy_slow(src, srcOffset, dest, destOffset, count) {\n\n    // dlog('_slow call: srcOffset=' + srcOffset + '; destOffset=' + destOffset + '; count=' + count);\n\n     for (var i = 0; i < count; ++i) {\n        dest[destOffset + i] = src[srcOffset + i];\n    }\n}\n\nfunction arrayCopy_fast(src, dest, destOffset) {\n    dest.set(src, destOffset);\n}\n\n\n  // largest prime smaller than 65536\nvar ADLER_BASE=65521; \n  // NMAX is the largest n such that 255n(n+1)/2 + (n+1)(BASE-1) <= 2^32-1\nvar ADLER_NMAX=5552;\n\nfunction adler32(adler, /* byte[] */ buf,  index, len){\n    if(buf == null){ return 1; }\n\n    var s1=adler&0xffff;\n    var s2=(adler>>16)&0xffff;\n    var k;\n\n    while(len > 0) {\n      k=len<ADLER_NMAX?len:ADLER_NMAX;\n      len-=k;\n      while(k>=16){\n        s1+=buf[index++]&0xff; s2+=s1;\n        s1+=buf[index++]&0xff; s2+=s1;\n        s1+=buf[index++]&0xff; s2+=s1;\n        s1+=buf[index++]&0xff; s2+=s1;\n        s1+=buf[index++]&0xff; s2+=s1;\n        s1+=buf[index++]&0xff; s2+=s1;\n        s1+=buf[index++]&0xff; s2+=s1;\n        s1+=buf[index++]&0xff; s2+=s1;\n        s1+=buf[index++]&0xff; s2+=s1;\n        s1+=buf[index++]&0xff; s2+=s1;\n        s1+=buf[index++]&0xff; s2+=s1;\n        s1+=buf[index++]&0xff; s2+=s1;\n        s1+=buf[index++]&0xff; s2+=s1;\n        s1+=buf[index++]&0xff; s2+=s1;\n        s1+=buf[index++]&0xff; s2+=s1;\n        s1+=buf[index++]&0xff; s2+=s1;\n        k-=16;\n      }\n      if(k!=0){\n        do{\n          s1+=buf[index++]&0xff; s2+=s1;\n        }\n        while(--k!=0);\n      }\n      s1%=ADLER_BASE;\n      s2%=ADLER_BASE;\n    }\n    return (s2<<16)|s1;\n}\n\n\n\nfunction jszlib_inflate_buffer(buffer, start, length, afterUncOffset) {\n    if (!start) {\n        buffer = new Uint8Array(buffer);\n    } else if (!length) {\n        buffer = new Uint8Array(buffer, start, buffer.byteLength - start);\n    } else {\n        buffer = new Uint8Array(buffer, start, length);\n    }\n\n    var z = new ZStream();\n    z.inflateInit(DEF_WBITS, true);\n    z.next_in = buffer;\n    z.next_in_index = 0;\n    z.avail_in = buffer.length;\n\n    var oBlockList = [];\n    var totalSize = 0;\n    while (true) {\n        var obuf = new Uint8Array(32000);\n        z.next_out = obuf;\n        z.next_out_index = 0;\n        z.avail_out = obuf.length;\n        var status = z.inflate(Z_NO_FLUSH);\n        if (status != Z_OK && status != Z_STREAM_END && status != Z_BUF_ERROR) {\n            throw z.msg;\n        }\n        if (z.avail_out != 0) {\n            var newob = new Uint8Array(obuf.length - z.avail_out);\n            arrayCopy(obuf, 0, newob, 0, (obuf.length - z.avail_out));\n            obuf = newob;\n        }\n        oBlockList.push(obuf);\n        totalSize += obuf.length;\n        if (status == Z_STREAM_END || status == Z_BUF_ERROR) {\n            break;\n        }\n    }\n\n    if (afterUncOffset) {\n        afterUncOffset[0] = (start || 0) + z.next_in_index;\n    }\n\n    if (oBlockList.length == 1) {\n        return oBlockList[0].buffer;\n    } else {\n        var out = new Uint8Array(totalSize);\n        var cursor = 0;\n        for (var i = 0; i < oBlockList.length; ++i) {\n            var b = oBlockList[i];\n            arrayCopy(b, 0, out, cursor, b.length);\n            cursor += b.length;\n        }\n        return out.buffer;\n    }\n}\n\nif (typeof(module) !== 'undefined') {\n  module.exports = {\n    inflateBuffer: jszlib_inflate_buffer,\n    arrayCopy: arrayCopy\n  };\n}\n\n},{}],72:[function(require,module,exports){\n// shim for using process in browser\nvar process = module.exports = {};\n\n// cached from whatever global is present so that test runners that stub it\n// don't break things.  But we need to wrap it in a try catch in case it is\n// wrapped in strict mode code which doesn't define any globals.  It's inside a\n// function because try/catches deoptimize in certain engines.\n\nvar cachedSetTimeout;\nvar cachedClearTimeout;\n\nfunction defaultSetTimout() {\n    throw new Error('setTimeout has not been defined');\n}\nfunction defaultClearTimeout () {\n    throw new Error('clearTimeout has not been defined');\n}\n(function () {\n    try {\n        if (typeof setTimeout === 'function') {\n            cachedSetTimeout = setTimeout;\n        } else {\n            cachedSetTimeout = defaultSetTimout;\n        }\n    } catch (e) {\n        cachedSetTimeout = defaultSetTimout;\n    }\n    try {\n        if (typeof clearTimeout === 'function') {\n            cachedClearTimeout = clearTimeout;\n        } else {\n            cachedClearTimeout = defaultClearTimeout;\n        }\n    } catch (e) {\n        cachedClearTimeout = defaultClearTimeout;\n    }\n} ())\nfunction runTimeout(fun) {\n    if (cachedSetTimeout === setTimeout) {\n        //normal enviroments in sane situations\n        return setTimeout(fun, 0);\n    }\n    // if setTimeout wasn't available but was latter defined\n    if ((cachedSetTimeout === defaultSetTimout || !cachedSetTimeout) && setTimeout) {\n        cachedSetTimeout = setTimeout;\n        return setTimeout(fun, 0);\n    }\n    try {\n        // when when somebody has screwed with setTimeout but no I.E. maddness\n        return cachedSetTimeout(fun, 0);\n    } catch(e){\n        try {\n            // When we are in I.E. but the script has been evaled so I.E. doesn't trust the global object when called normally\n            return cachedSetTimeout.call(null, fun, 0);\n        } catch(e){\n            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error\n            return cachedSetTimeout.call(this, fun, 0);\n        }\n    }\n\n\n}\nfunction runClearTimeout(marker) {\n    if (cachedClearTimeout === clearTimeout) {\n        //normal enviroments in sane situations\n        return clearTimeout(marker);\n    }\n    // if clearTimeout wasn't available but was latter defined\n    if ((cachedClearTimeout === defaultClearTimeout || !cachedClearTimeout) && clearTimeout) {\n        cachedClearTimeout = clearTimeout;\n        return clearTimeout(marker);\n    }\n    try {\n        // when when somebody has screwed with setTimeout but no I.E. maddness\n        return cachedClearTimeout(marker);\n    } catch (e){\n        try {\n            // When we are in I.E. but the script has been evaled so I.E. doesn't  trust the global object when called normally\n            return cachedClearTimeout.call(null, marker);\n        } catch (e){\n            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error.\n            // Some versions of I.E. have different rules for clearTimeout vs setTimeout\n            return cachedClearTimeout.call(this, marker);\n        }\n    }\n\n\n\n}\nvar queue = [];\nvar draining = false;\nvar currentQueue;\nvar queueIndex = -1;\n\nfunction cleanUpNextTick() {\n    if (!draining || !currentQueue) {\n        return;\n    }\n    draining = false;\n    if (currentQueue.length) {\n        queue = currentQueue.concat(queue);\n    } else {\n        queueIndex = -1;\n    }\n    if (queue.length) {\n        drainQueue();\n    }\n}\n\nfunction drainQueue() {\n    if (draining) {\n        return;\n    }\n    var timeout = runTimeout(cleanUpNextTick);\n    draining = true;\n\n    var len = queue.length;\n    while(len) {\n        currentQueue = queue;\n        queue = [];\n        while (++queueIndex < len) {\n            if (currentQueue) {\n                currentQueue[queueIndex].run();\n            }\n        }\n        queueIndex = -1;\n        len = queue.length;\n    }\n    currentQueue = null;\n    draining = false;\n    runClearTimeout(timeout);\n}\n\nprocess.nextTick = function (fun) {\n    var args = new Array(arguments.length - 1);\n    if (arguments.length > 1) {\n        for (var i = 1; i < arguments.length; i++) {\n            args[i - 1] = arguments[i];\n        }\n    }\n    queue.push(new Item(fun, args));\n    if (queue.length === 1 && !draining) {\n        runTimeout(drainQueue);\n    }\n};\n\n// v8 likes predictible objects\nfunction Item(fun, array) {\n    this.fun = fun;\n    this.array = array;\n}\nItem.prototype.run = function () {\n    this.fun.apply(null, this.array);\n};\nprocess.title = 'browser';\nprocess.browser = true;\nprocess.env = {};\nprocess.argv = [];\nprocess.version = ''; // empty string to avoid regexp issues\nprocess.versions = {};\n\nfunction noop() {}\n\nprocess.on = noop;\nprocess.addListener = noop;\nprocess.once = noop;\nprocess.off = noop;\nprocess.removeListener = noop;\nprocess.removeAllListeners = noop;\nprocess.emit = noop;\n\nprocess.binding = function (name) {\n    throw new Error('process.binding is not supported');\n};\n\nprocess.cwd = function () { return '/' };\nprocess.chdir = function (dir) {\n    throw new Error('process.chdir is not supported');\n};\nprocess.umask = function() { return 0; };\n\n},{}],73:[function(require,module,exports){\n//  Ramda v0.21.0\n//  https://github.com/ramda/ramda\n//  (c) 2013-2016 Scott Sauyet, Michael Hurley, and David Chambers\n//  Ramda may be freely distributed under the MIT license.\n\n;(function() {\n\n  'use strict';\n\n  /**\n     * A special placeholder value used to specify \"gaps\" within curried functions,\n     * allowing partial application of any combination of arguments, regardless of\n     * their positions.\n     *\n     * If `g` is a curried ternary function and `_` is `R.__`, the following are\n     * equivalent:\n     *\n     *   - `g(1, 2, 3)`\n     *   - `g(_, 2, 3)(1)`\n     *   - `g(_, _, 3)(1)(2)`\n     *   - `g(_, _, 3)(1, 2)`\n     *   - `g(_, 2, _)(1, 3)`\n     *   - `g(_, 2)(1)(3)`\n     *   - `g(_, 2)(1, 3)`\n     *   - `g(_, 2)(_, 3)(1)`\n     *\n     * @constant\n     * @memberOf R\n     * @since v0.6.0\n     * @category Function\n     * @example\n     *\n     *      var greet = R.replace('{name}', R.__, 'Hello, {name}!');\n     *      greet('Alice'); //=> 'Hello, Alice!'\n     */\n    var __ = { '@@functional/placeholder': true };\n\n    /* eslint-disable no-unused-vars */\n    var _arity = function _arity(n, fn) {\n        /* eslint-disable no-unused-vars */\n        switch (n) {\n        case 0:\n            return function () {\n                return fn.apply(this, arguments);\n            };\n        case 1:\n            return function (a0) {\n                return fn.apply(this, arguments);\n            };\n        case 2:\n            return function (a0, a1) {\n                return fn.apply(this, arguments);\n            };\n        case 3:\n            return function (a0, a1, a2) {\n                return fn.apply(this, arguments);\n            };\n        case 4:\n            return function (a0, a1, a2, a3) {\n                return fn.apply(this, arguments);\n            };\n        case 5:\n            return function (a0, a1, a2, a3, a4) {\n                return fn.apply(this, arguments);\n            };\n        case 6:\n            return function (a0, a1, a2, a3, a4, a5) {\n                return fn.apply(this, arguments);\n            };\n        case 7:\n            return function (a0, a1, a2, a3, a4, a5, a6) {\n                return fn.apply(this, arguments);\n            };\n        case 8:\n            return function (a0, a1, a2, a3, a4, a5, a6, a7) {\n                return fn.apply(this, arguments);\n            };\n        case 9:\n            return function (a0, a1, a2, a3, a4, a5, a6, a7, a8) {\n                return fn.apply(this, arguments);\n            };\n        case 10:\n            return function (a0, a1, a2, a3, a4, a5, a6, a7, a8, a9) {\n                return fn.apply(this, arguments);\n            };\n        default:\n            throw new Error('First argument to _arity must be a non-negative integer no greater than ten');\n        }\n    };\n\n    var _arrayFromIterator = function _arrayFromIterator(iter) {\n        var list = [];\n        var next;\n        while (!(next = iter.next()).done) {\n            list.push(next.value);\n        }\n        return list;\n    };\n\n    var _arrayOf = function _arrayOf() {\n        return Array.prototype.slice.call(arguments);\n    };\n\n    var _cloneRegExp = function _cloneRegExp(pattern) {\n        return new RegExp(pattern.source, (pattern.global ? 'g' : '') + (pattern.ignoreCase ? 'i' : '') + (pattern.multiline ? 'm' : '') + (pattern.sticky ? 'y' : '') + (pattern.unicode ? 'u' : ''));\n    };\n\n    var _complement = function _complement(f) {\n        return function () {\n            return !f.apply(this, arguments);\n        };\n    };\n\n    /**\n     * Private `concat` function to merge two array-like objects.\n     *\n     * @private\n     * @param {Array|Arguments} [set1=[]] An array-like object.\n     * @param {Array|Arguments} [set2=[]] An array-like object.\n     * @return {Array} A new, merged array.\n     * @example\n     *\n     *      _concat([4, 5, 6], [1, 2, 3]); //=> [4, 5, 6, 1, 2, 3]\n     */\n    var _concat = function _concat(set1, set2) {\n        set1 = set1 || [];\n        set2 = set2 || [];\n        var idx;\n        var len1 = set1.length;\n        var len2 = set2.length;\n        var result = [];\n        idx = 0;\n        while (idx < len1) {\n            result[result.length] = set1[idx];\n            idx += 1;\n        }\n        idx = 0;\n        while (idx < len2) {\n            result[result.length] = set2[idx];\n            idx += 1;\n        }\n        return result;\n    };\n\n    var _containsWith = function _containsWith(pred, x, list) {\n        var idx = 0;\n        var len = list.length;\n        while (idx < len) {\n            if (pred(x, list[idx])) {\n                return true;\n            }\n            idx += 1;\n        }\n        return false;\n    };\n\n    var _filter = function _filter(fn, list) {\n        var idx = 0;\n        var len = list.length;\n        var result = [];\n        while (idx < len) {\n            if (fn(list[idx])) {\n                result[result.length] = list[idx];\n            }\n            idx += 1;\n        }\n        return result;\n    };\n\n    var _forceReduced = function _forceReduced(x) {\n        return {\n            '@@transducer/value': x,\n            '@@transducer/reduced': true\n        };\n    };\n\n    // String(x => x) evaluates to \"x => x\", so the pattern may not match.\n    var _functionName = function _functionName(f) {\n        // String(x => x) evaluates to \"x => x\", so the pattern may not match.\n        var match = String(f).match(/^function (\\w*)/);\n        return match == null ? '' : match[1];\n    };\n\n    var _has = function _has(prop, obj) {\n        return Object.prototype.hasOwnProperty.call(obj, prop);\n    };\n\n    var _identity = function _identity(x) {\n        return x;\n    };\n\n    var _isArguments = function () {\n        var toString = Object.prototype.toString;\n        return toString.call(arguments) === '[object Arguments]' ? function _isArguments(x) {\n            return toString.call(x) === '[object Arguments]';\n        } : function _isArguments(x) {\n            return _has('callee', x);\n        };\n    }();\n\n    /**\n     * Tests whether or not an object is an array.\n     *\n     * @private\n     * @param {*} val The object to test.\n     * @return {Boolean} `true` if `val` is an array, `false` otherwise.\n     * @example\n     *\n     *      _isArray([]); //=> true\n     *      _isArray(null); //=> false\n     *      _isArray({}); //=> false\n     */\n    var _isArray = Array.isArray || function _isArray(val) {\n        return val != null && val.length >= 0 && Object.prototype.toString.call(val) === '[object Array]';\n    };\n\n    var _isFunction = function _isNumber(x) {\n        return Object.prototype.toString.call(x) === '[object Function]';\n    };\n\n    /**\n     * Determine if the passed argument is an integer.\n     *\n     * @private\n     * @param {*} n\n     * @category Type\n     * @return {Boolean}\n     */\n    var _isInteger = Number.isInteger || function _isInteger(n) {\n        return n << 0 === n;\n    };\n\n    var _isNumber = function _isNumber(x) {\n        return Object.prototype.toString.call(x) === '[object Number]';\n    };\n\n    var _isObject = function _isObject(x) {\n        return Object.prototype.toString.call(x) === '[object Object]';\n    };\n\n    var _isPlaceholder = function _isPlaceholder(a) {\n        return a != null && typeof a === 'object' && a['@@functional/placeholder'] === true;\n    };\n\n    var _isRegExp = function _isRegExp(x) {\n        return Object.prototype.toString.call(x) === '[object RegExp]';\n    };\n\n    var _isString = function _isString(x) {\n        return Object.prototype.toString.call(x) === '[object String]';\n    };\n\n    var _isTransformer = function _isTransformer(obj) {\n        return typeof obj['@@transducer/step'] === 'function';\n    };\n\n    var _map = function _map(fn, functor) {\n        var idx = 0;\n        var len = functor.length;\n        var result = Array(len);\n        while (idx < len) {\n            result[idx] = fn(functor[idx]);\n            idx += 1;\n        }\n        return result;\n    };\n\n    // Based on https://developer.mozilla.org/en/docs/Web/JavaScript/Reference/Global_Objects/Object/assign\n    var _objectAssign = function _objectAssign(target) {\n        if (target == null) {\n            throw new TypeError('Cannot convert undefined or null to object');\n        }\n        var output = Object(target);\n        var idx = 1;\n        var length = arguments.length;\n        while (idx < length) {\n            var source = arguments[idx];\n            if (source != null) {\n                for (var nextKey in source) {\n                    if (_has(nextKey, source)) {\n                        output[nextKey] = source[nextKey];\n                    }\n                }\n            }\n            idx += 1;\n        }\n        return output;\n    };\n\n    var _of = function _of(x) {\n        return [x];\n    };\n\n    var _pipe = function _pipe(f, g) {\n        return function () {\n            return g.call(this, f.apply(this, arguments));\n        };\n    };\n\n    var _pipeP = function _pipeP(f, g) {\n        return function () {\n            var ctx = this;\n            return f.apply(ctx, arguments).then(function (x) {\n                return g.call(ctx, x);\n            });\n        };\n    };\n\n    // \\b matches word boundary; [\\b] matches backspace\n    var _quote = function _quote(s) {\n        var escaped = s.replace(/\\\\/g, '\\\\\\\\').replace(/[\\b]/g, '\\\\b')    // \\b matches word boundary; [\\b] matches backspace\n    .replace(/\\f/g, '\\\\f').replace(/\\n/g, '\\\\n').replace(/\\r/g, '\\\\r').replace(/\\t/g, '\\\\t').replace(/\\v/g, '\\\\v').replace(/\\0/g, '\\\\0');\n        return '\"' + escaped.replace(/\"/g, '\\\\\"') + '\"';\n    };\n\n    var _reduced = function _reduced(x) {\n        return x && x['@@transducer/reduced'] ? x : {\n            '@@transducer/value': x,\n            '@@transducer/reduced': true\n        };\n    };\n\n    /**\n     * An optimized, private array `slice` implementation.\n     *\n     * @private\n     * @param {Arguments|Array} args The array or arguments object to consider.\n     * @param {Number} [from=0] The array index to slice from, inclusive.\n     * @param {Number} [to=args.length] The array index to slice to, exclusive.\n     * @return {Array} A new, sliced array.\n     * @example\n     *\n     *      _slice([1, 2, 3, 4, 5], 1, 3); //=> [2, 3]\n     *\n     *      var firstThreeArgs = function(a, b, c, d) {\n     *        return _slice(arguments, 0, 3);\n     *      };\n     *      firstThreeArgs(1, 2, 3, 4); //=> [1, 2, 3]\n     */\n    var _slice = function _slice(args, from, to) {\n        switch (arguments.length) {\n        case 1:\n            return _slice(args, 0, args.length);\n        case 2:\n            return _slice(args, from, args.length);\n        default:\n            var list = [];\n            var idx = 0;\n            var len = Math.max(0, Math.min(args.length, to) - from);\n            while (idx < len) {\n                list[idx] = args[from + idx];\n                idx += 1;\n            }\n            return list;\n        }\n    };\n\n    /**\n     * Polyfill from <https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Date/toISOString>.\n     */\n    var _toISOString = function () {\n        var pad = function pad(n) {\n            return (n < 10 ? '0' : '') + n;\n        };\n        return typeof Date.prototype.toISOString === 'function' ? function _toISOString(d) {\n            return d.toISOString();\n        } : function _toISOString(d) {\n            return d.getUTCFullYear() + '-' + pad(d.getUTCMonth() + 1) + '-' + pad(d.getUTCDate()) + 'T' + pad(d.getUTCHours()) + ':' + pad(d.getUTCMinutes()) + ':' + pad(d.getUTCSeconds()) + '.' + (d.getUTCMilliseconds() / 1000).toFixed(3).slice(2, 5) + 'Z';\n        };\n    }();\n\n    var _xfBase = {\n        init: function () {\n            return this.xf['@@transducer/init']();\n        },\n        result: function (result) {\n            return this.xf['@@transducer/result'](result);\n        }\n    };\n\n    var _xwrap = function () {\n        function XWrap(fn) {\n            this.f = fn;\n        }\n        XWrap.prototype['@@transducer/init'] = function () {\n            throw new Error('init not implemented on XWrap');\n        };\n        XWrap.prototype['@@transducer/result'] = function (acc) {\n            return acc;\n        };\n        XWrap.prototype['@@transducer/step'] = function (acc, x) {\n            return this.f(acc, x);\n        };\n        return function _xwrap(fn) {\n            return new XWrap(fn);\n        };\n    }();\n\n    var _aperture = function _aperture(n, list) {\n        var idx = 0;\n        var limit = list.length - (n - 1);\n        var acc = new Array(limit >= 0 ? limit : 0);\n        while (idx < limit) {\n            acc[idx] = _slice(list, idx, idx + n);\n            idx += 1;\n        }\n        return acc;\n    };\n\n    var _assign = typeof Object.assign === 'function' ? Object.assign : _objectAssign;\n\n    /**\n     * Similar to hasMethod, this checks whether a function has a [methodname]\n     * function. If it isn't an array it will execute that function otherwise it\n     * will default to the ramda implementation.\n     *\n     * @private\n     * @param {Function} fn ramda implemtation\n     * @param {String} methodname property to check for a custom implementation\n     * @return {Object} Whatever the return value of the method is.\n     */\n    var _checkForMethod = function _checkForMethod(methodname, fn) {\n        return function () {\n            var length = arguments.length;\n            if (length === 0) {\n                return fn();\n            }\n            var obj = arguments[length - 1];\n            return _isArray(obj) || typeof obj[methodname] !== 'function' ? fn.apply(this, arguments) : obj[methodname].apply(obj, _slice(arguments, 0, length - 1));\n        };\n    };\n\n    /**\n     * Optimized internal one-arity curry function.\n     *\n     * @private\n     * @category Function\n     * @param {Function} fn The function to curry.\n     * @return {Function} The curried function.\n     */\n    var _curry1 = function _curry1(fn) {\n        return function f1(a) {\n            if (arguments.length === 0 || _isPlaceholder(a)) {\n                return f1;\n            } else {\n                return fn.apply(this, arguments);\n            }\n        };\n    };\n\n    /**\n     * Optimized internal two-arity curry function.\n     *\n     * @private\n     * @category Function\n     * @param {Function} fn The function to curry.\n     * @return {Function} The curried function.\n     */\n    var _curry2 = function _curry2(fn) {\n        return function f2(a, b) {\n            switch (arguments.length) {\n            case 0:\n                return f2;\n            case 1:\n                return _isPlaceholder(a) ? f2 : _curry1(function (_b) {\n                    return fn(a, _b);\n                });\n            default:\n                return _isPlaceholder(a) && _isPlaceholder(b) ? f2 : _isPlaceholder(a) ? _curry1(function (_a) {\n                    return fn(_a, b);\n                }) : _isPlaceholder(b) ? _curry1(function (_b) {\n                    return fn(a, _b);\n                }) : fn(a, b);\n            }\n        };\n    };\n\n    /**\n     * Optimized internal three-arity curry function.\n     *\n     * @private\n     * @category Function\n     * @param {Function} fn The function to curry.\n     * @return {Function} The curried function.\n     */\n    var _curry3 = function _curry3(fn) {\n        return function f3(a, b, c) {\n            switch (arguments.length) {\n            case 0:\n                return f3;\n            case 1:\n                return _isPlaceholder(a) ? f3 : _curry2(function (_b, _c) {\n                    return fn(a, _b, _c);\n                });\n            case 2:\n                return _isPlaceholder(a) && _isPlaceholder(b) ? f3 : _isPlaceholder(a) ? _curry2(function (_a, _c) {\n                    return fn(_a, b, _c);\n                }) : _isPlaceholder(b) ? _curry2(function (_b, _c) {\n                    return fn(a, _b, _c);\n                }) : _curry1(function (_c) {\n                    return fn(a, b, _c);\n                });\n            default:\n                return _isPlaceholder(a) && _isPlaceholder(b) && _isPlaceholder(c) ? f3 : _isPlaceholder(a) && _isPlaceholder(b) ? _curry2(function (_a, _b) {\n                    return fn(_a, _b, c);\n                }) : _isPlaceholder(a) && _isPlaceholder(c) ? _curry2(function (_a, _c) {\n                    return fn(_a, b, _c);\n                }) : _isPlaceholder(b) && _isPlaceholder(c) ? _curry2(function (_b, _c) {\n                    return fn(a, _b, _c);\n                }) : _isPlaceholder(a) ? _curry1(function (_a) {\n                    return fn(_a, b, c);\n                }) : _isPlaceholder(b) ? _curry1(function (_b) {\n                    return fn(a, _b, c);\n                }) : _isPlaceholder(c) ? _curry1(function (_c) {\n                    return fn(a, b, _c);\n                }) : fn(a, b, c);\n            }\n        };\n    };\n\n    /**\n     * Internal curryN function.\n     *\n     * @private\n     * @category Function\n     * @param {Number} length The arity of the curried function.\n     * @param {Array} received An array of arguments received thus far.\n     * @param {Function} fn The function to curry.\n     * @return {Function} The curried function.\n     */\n    var _curryN = function _curryN(length, received, fn) {\n        return function () {\n            var combined = [];\n            var argsIdx = 0;\n            var left = length;\n            var combinedIdx = 0;\n            while (combinedIdx < received.length || argsIdx < arguments.length) {\n                var result;\n                if (combinedIdx < received.length && (!_isPlaceholder(received[combinedIdx]) || argsIdx >= arguments.length)) {\n                    result = received[combinedIdx];\n                } else {\n                    result = arguments[argsIdx];\n                    argsIdx += 1;\n                }\n                combined[combinedIdx] = result;\n                if (!_isPlaceholder(result)) {\n                    left -= 1;\n                }\n                combinedIdx += 1;\n            }\n            return left <= 0 ? fn.apply(this, combined) : _arity(left, _curryN(length, combined, fn));\n        };\n    };\n\n    /**\n     * Returns a function that dispatches with different strategies based on the\n     * object in list position (last argument). If it is an array, executes [fn].\n     * Otherwise, if it has a function with [methodname], it will execute that\n     * function (functor case). Otherwise, if it is a transformer, uses transducer\n     * [xf] to return a new transformer (transducer case). Otherwise, it will\n     * default to executing [fn].\n     *\n     * @private\n     * @param {String} methodname property to check for a custom implementation\n     * @param {Function} xf transducer to initialize if object is transformer\n     * @param {Function} fn default ramda implementation\n     * @return {Function} A function that dispatches on object in list position\n     */\n    var _dispatchable = function _dispatchable(methodname, xf, fn) {\n        return function () {\n            var length = arguments.length;\n            if (length === 0) {\n                return fn();\n            }\n            var obj = arguments[length - 1];\n            if (!_isArray(obj)) {\n                var args = _slice(arguments, 0, length - 1);\n                if (typeof obj[methodname] === 'function') {\n                    return obj[methodname].apply(obj, args);\n                }\n                if (_isTransformer(obj)) {\n                    var transducer = xf.apply(null, args);\n                    return transducer(obj);\n                }\n            }\n            return fn.apply(this, arguments);\n        };\n    };\n\n    var _dropLastWhile = function dropLastWhile(pred, list) {\n        var idx = list.length - 1;\n        while (idx >= 0 && pred(list[idx])) {\n            idx -= 1;\n        }\n        return _slice(list, 0, idx + 1);\n    };\n\n    var _xall = function () {\n        function XAll(f, xf) {\n            this.xf = xf;\n            this.f = f;\n            this.all = true;\n        }\n        XAll.prototype['@@transducer/init'] = _xfBase.init;\n        XAll.prototype['@@transducer/result'] = function (result) {\n            if (this.all) {\n                result = this.xf['@@transducer/step'](result, true);\n            }\n            return this.xf['@@transducer/result'](result);\n        };\n        XAll.prototype['@@transducer/step'] = function (result, input) {\n            if (!this.f(input)) {\n                this.all = false;\n                result = _reduced(this.xf['@@transducer/step'](result, false));\n            }\n            return result;\n        };\n        return _curry2(function _xall(f, xf) {\n            return new XAll(f, xf);\n        });\n    }();\n\n    var _xany = function () {\n        function XAny(f, xf) {\n            this.xf = xf;\n            this.f = f;\n            this.any = false;\n        }\n        XAny.prototype['@@transducer/init'] = _xfBase.init;\n        XAny.prototype['@@transducer/result'] = function (result) {\n            if (!this.any) {\n                result = this.xf['@@transducer/step'](result, false);\n            }\n            return this.xf['@@transducer/result'](result);\n        };\n        XAny.prototype['@@transducer/step'] = function (result, input) {\n            if (this.f(input)) {\n                this.any = true;\n                result = _reduced(this.xf['@@transducer/step'](result, true));\n            }\n            return result;\n        };\n        return _curry2(function _xany(f, xf) {\n            return new XAny(f, xf);\n        });\n    }();\n\n    var _xaperture = function () {\n        function XAperture(n, xf) {\n            this.xf = xf;\n            this.pos = 0;\n            this.full = false;\n            this.acc = new Array(n);\n        }\n        XAperture.prototype['@@transducer/init'] = _xfBase.init;\n        XAperture.prototype['@@transducer/result'] = function (result) {\n            this.acc = null;\n            return this.xf['@@transducer/result'](result);\n        };\n        XAperture.prototype['@@transducer/step'] = function (result, input) {\n            this.store(input);\n            return this.full ? this.xf['@@transducer/step'](result, this.getCopy()) : result;\n        };\n        XAperture.prototype.store = function (input) {\n            this.acc[this.pos] = input;\n            this.pos += 1;\n            if (this.pos === this.acc.length) {\n                this.pos = 0;\n                this.full = true;\n            }\n        };\n        XAperture.prototype.getCopy = function () {\n            return _concat(_slice(this.acc, this.pos), _slice(this.acc, 0, this.pos));\n        };\n        return _curry2(function _xaperture(n, xf) {\n            return new XAperture(n, xf);\n        });\n    }();\n\n    var _xdrop = function () {\n        function XDrop(n, xf) {\n            this.xf = xf;\n            this.n = n;\n        }\n        XDrop.prototype['@@transducer/init'] = _xfBase.init;\n        XDrop.prototype['@@transducer/result'] = _xfBase.result;\n        XDrop.prototype['@@transducer/step'] = function (result, input) {\n            if (this.n > 0) {\n                this.n -= 1;\n                return result;\n            }\n            return this.xf['@@transducer/step'](result, input);\n        };\n        return _curry2(function _xdrop(n, xf) {\n            return new XDrop(n, xf);\n        });\n    }();\n\n    var _xdropLast = function () {\n        function XDropLast(n, xf) {\n            this.xf = xf;\n            this.pos = 0;\n            this.full = false;\n            this.acc = new Array(n);\n        }\n        XDropLast.prototype['@@transducer/init'] = _xfBase.init;\n        XDropLast.prototype['@@transducer/result'] = function (result) {\n            this.acc = null;\n            return this.xf['@@transducer/result'](result);\n        };\n        XDropLast.prototype['@@transducer/step'] = function (result, input) {\n            if (this.full) {\n                result = this.xf['@@transducer/step'](result, this.acc[this.pos]);\n            }\n            this.store(input);\n            return result;\n        };\n        XDropLast.prototype.store = function (input) {\n            this.acc[this.pos] = input;\n            this.pos += 1;\n            if (this.pos === this.acc.length) {\n                this.pos = 0;\n                this.full = true;\n            }\n        };\n        return _curry2(function _xdropLast(n, xf) {\n            return new XDropLast(n, xf);\n        });\n    }();\n\n    var _xdropRepeatsWith = function () {\n        function XDropRepeatsWith(pred, xf) {\n            this.xf = xf;\n            this.pred = pred;\n            this.lastValue = undefined;\n            this.seenFirstValue = false;\n        }\n        XDropRepeatsWith.prototype['@@transducer/init'] = function () {\n            return this.xf['@@transducer/init']();\n        };\n        XDropRepeatsWith.prototype['@@transducer/result'] = function (result) {\n            return this.xf['@@transducer/result'](result);\n        };\n        XDropRepeatsWith.prototype['@@transducer/step'] = function (result, input) {\n            var sameAsLast = false;\n            if (!this.seenFirstValue) {\n                this.seenFirstValue = true;\n            } else if (this.pred(this.lastValue, input)) {\n                sameAsLast = true;\n            }\n            this.lastValue = input;\n            return sameAsLast ? result : this.xf['@@transducer/step'](result, input);\n        };\n        return _curry2(function _xdropRepeatsWith(pred, xf) {\n            return new XDropRepeatsWith(pred, xf);\n        });\n    }();\n\n    var _xdropWhile = function () {\n        function XDropWhile(f, xf) {\n            this.xf = xf;\n            this.f = f;\n        }\n        XDropWhile.prototype['@@transducer/init'] = _xfBase.init;\n        XDropWhile.prototype['@@transducer/result'] = _xfBase.result;\n        XDropWhile.prototype['@@transducer/step'] = function (result, input) {\n            if (this.f) {\n                if (this.f(input)) {\n                    return result;\n                }\n                this.f = null;\n            }\n            return this.xf['@@transducer/step'](result, input);\n        };\n        return _curry2(function _xdropWhile(f, xf) {\n            return new XDropWhile(f, xf);\n        });\n    }();\n\n    var _xfilter = function () {\n        function XFilter(f, xf) {\n            this.xf = xf;\n            this.f = f;\n        }\n        XFilter.prototype['@@transducer/init'] = _xfBase.init;\n        XFilter.prototype['@@transducer/result'] = _xfBase.result;\n        XFilter.prototype['@@transducer/step'] = function (result, input) {\n            return this.f(input) ? this.xf['@@transducer/step'](result, input) : result;\n        };\n        return _curry2(function _xfilter(f, xf) {\n            return new XFilter(f, xf);\n        });\n    }();\n\n    var _xfind = function () {\n        function XFind(f, xf) {\n            this.xf = xf;\n            this.f = f;\n            this.found = false;\n        }\n        XFind.prototype['@@transducer/init'] = _xfBase.init;\n        XFind.prototype['@@transducer/result'] = function (result) {\n            if (!this.found) {\n                result = this.xf['@@transducer/step'](result, void 0);\n            }\n            return this.xf['@@transducer/result'](result);\n        };\n        XFind.prototype['@@transducer/step'] = function (result, input) {\n            if (this.f(input)) {\n                this.found = true;\n                result = _reduced(this.xf['@@transducer/step'](result, input));\n            }\n            return result;\n        };\n        return _curry2(function _xfind(f, xf) {\n            return new XFind(f, xf);\n        });\n    }();\n\n    var _xfindIndex = function () {\n        function XFindIndex(f, xf) {\n            this.xf = xf;\n            this.f = f;\n            this.idx = -1;\n            this.found = false;\n        }\n        XFindIndex.prototype['@@transducer/init'] = _xfBase.init;\n        XFindIndex.prototype['@@transducer/result'] = function (result) {\n            if (!this.found) {\n                result = this.xf['@@transducer/step'](result, -1);\n            }\n            return this.xf['@@transducer/result'](result);\n        };\n        XFindIndex.prototype['@@transducer/step'] = function (result, input) {\n            this.idx += 1;\n            if (this.f(input)) {\n                this.found = true;\n                result = _reduced(this.xf['@@transducer/step'](result, this.idx));\n            }\n            return result;\n        };\n        return _curry2(function _xfindIndex(f, xf) {\n            return new XFindIndex(f, xf);\n        });\n    }();\n\n    var _xfindLast = function () {\n        function XFindLast(f, xf) {\n            this.xf = xf;\n            this.f = f;\n        }\n        XFindLast.prototype['@@transducer/init'] = _xfBase.init;\n        XFindLast.prototype['@@transducer/result'] = function (result) {\n            return this.xf['@@transducer/result'](this.xf['@@transducer/step'](result, this.last));\n        };\n        XFindLast.prototype['@@transducer/step'] = function (result, input) {\n            if (this.f(input)) {\n                this.last = input;\n            }\n            return result;\n        };\n        return _curry2(function _xfindLast(f, xf) {\n            return new XFindLast(f, xf);\n        });\n    }();\n\n    var _xfindLastIndex = function () {\n        function XFindLastIndex(f, xf) {\n            this.xf = xf;\n            this.f = f;\n            this.idx = -1;\n            this.lastIdx = -1;\n        }\n        XFindLastIndex.prototype['@@transducer/init'] = _xfBase.init;\n        XFindLastIndex.prototype['@@transducer/result'] = function (result) {\n            return this.xf['@@transducer/result'](this.xf['@@transducer/step'](result, this.lastIdx));\n        };\n        XFindLastIndex.prototype['@@transducer/step'] = function (result, input) {\n            this.idx += 1;\n            if (this.f(input)) {\n                this.lastIdx = this.idx;\n            }\n            return result;\n        };\n        return _curry2(function _xfindLastIndex(f, xf) {\n            return new XFindLastIndex(f, xf);\n        });\n    }();\n\n    var _xmap = function () {\n        function XMap(f, xf) {\n            this.xf = xf;\n            this.f = f;\n        }\n        XMap.prototype['@@transducer/init'] = _xfBase.init;\n        XMap.prototype['@@transducer/result'] = _xfBase.result;\n        XMap.prototype['@@transducer/step'] = function (result, input) {\n            return this.xf['@@transducer/step'](result, this.f(input));\n        };\n        return _curry2(function _xmap(f, xf) {\n            return new XMap(f, xf);\n        });\n    }();\n\n    var _xtake = function () {\n        function XTake(n, xf) {\n            this.xf = xf;\n            this.n = n;\n        }\n        XTake.prototype['@@transducer/init'] = _xfBase.init;\n        XTake.prototype['@@transducer/result'] = _xfBase.result;\n        XTake.prototype['@@transducer/step'] = function (result, input) {\n            if (this.n === 0) {\n                return _reduced(result);\n            } else {\n                this.n -= 1;\n                return this.xf['@@transducer/step'](result, input);\n            }\n        };\n        return _curry2(function _xtake(n, xf) {\n            return new XTake(n, xf);\n        });\n    }();\n\n    var _xtakeWhile = function () {\n        function XTakeWhile(f, xf) {\n            this.xf = xf;\n            this.f = f;\n        }\n        XTakeWhile.prototype['@@transducer/init'] = _xfBase.init;\n        XTakeWhile.prototype['@@transducer/result'] = _xfBase.result;\n        XTakeWhile.prototype['@@transducer/step'] = function (result, input) {\n            return this.f(input) ? this.xf['@@transducer/step'](result, input) : _reduced(result);\n        };\n        return _curry2(function _xtakeWhile(f, xf) {\n            return new XTakeWhile(f, xf);\n        });\n    }();\n\n    /**\n     * Adds two values.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.1.0\n     * @category Math\n     * @sig Number -> Number -> Number\n     * @param {Number} a\n     * @param {Number} b\n     * @return {Number}\n     * @see R.subtract\n     * @example\n     *\n     *      R.add(2, 3);       //=>  5\n     *      R.add(7)(10);      //=> 17\n     */\n    var add = _curry2(function add(a, b) {\n        return Number(a) + Number(b);\n    });\n\n    /**\n     * Applies a function to the value at the given index of an array, returning a\n     * new copy of the array with the element at the given index replaced with the\n     * result of the function application.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.14.0\n     * @category List\n     * @sig (a -> a) -> Number -> [a] -> [a]\n     * @param {Function} fn The function to apply.\n     * @param {Number} idx The index.\n     * @param {Array|Arguments} list An array-like object whose value\n     *        at the supplied index will be replaced.\n     * @return {Array} A copy of the supplied array-like object with\n     *         the element at index `idx` replaced with the value\n     *         returned by applying `fn` to the existing element.\n     * @see R.update\n     * @example\n     *\n     *      R.adjust(R.add(10), 1, [0, 1, 2]);     //=> [0, 11, 2]\n     *      R.adjust(R.add(10))(1)([0, 1, 2]);     //=> [0, 11, 2]\n     */\n    var adjust = _curry3(function adjust(fn, idx, list) {\n        if (idx >= list.length || idx < -list.length) {\n            return list;\n        }\n        var start = idx < 0 ? list.length : 0;\n        var _idx = start + idx;\n        var _list = _concat(list);\n        _list[_idx] = fn(list[_idx]);\n        return _list;\n    });\n\n    /**\n     * Returns `true` if all elements of the list match the predicate, `false` if\n     * there are any that don't.\n     *\n     * Dispatches to the `all` method of the second argument, if present.\n     *\n     * Acts as a transducer if a transformer is given in list position.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.1.0\n     * @category List\n     * @sig (a -> Boolean) -> [a] -> Boolean\n     * @param {Function} fn The predicate function.\n     * @param {Array} list The array to consider.\n     * @return {Boolean} `true` if the predicate is satisfied by every element, `false`\n     *         otherwise.\n     * @see R.any, R.none, R.transduce\n     * @example\n     *\n     *      var lessThan2 = R.flip(R.lt)(2);\n     *      var lessThan3 = R.flip(R.lt)(3);\n     *      R.all(lessThan2)([1, 2]); //=> false\n     *      R.all(lessThan3)([1, 2]); //=> true\n     */\n    var all = _curry2(_dispatchable('all', _xall, function all(fn, list) {\n        var idx = 0;\n        while (idx < list.length) {\n            if (!fn(list[idx])) {\n                return false;\n            }\n            idx += 1;\n        }\n        return true;\n    }));\n\n    /**\n     * Returns a function that always returns the given value. Note that for\n     * non-primitives the value returned is a reference to the original value.\n     *\n     * This function is known as `const`, `constant`, or `K` (for K combinator) in\n     * other languages and libraries.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.1.0\n     * @category Function\n     * @sig a -> (* -> a)\n     * @param {*} val The value to wrap in a function\n     * @return {Function} A Function :: * -> val.\n     * @example\n     *\n     *      var t = R.always('Tee');\n     *      t(); //=> 'Tee'\n     */\n    var always = _curry1(function always(val) {\n        return function () {\n            return val;\n        };\n    });\n\n    /**\n     * Returns `true` if both arguments are `true`; `false` otherwise.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.1.0\n     * @category Logic\n     * @sig * -> * -> *\n     * @param {Boolean} a A boolean value\n     * @param {Boolean} b A boolean value\n     * @return {Boolean} `true` if both arguments are `true`, `false` otherwise\n     * @see R.both\n     * @example\n     *\n     *      R.and(true, true); //=> true\n     *      R.and(true, false); //=> false\n     *      R.and(false, true); //=> false\n     *      R.and(false, false); //=> false\n     */\n    var and = _curry2(function and(a, b) {\n        return a && b;\n    });\n\n    /**\n     * Returns `true` if at least one of elements of the list match the predicate,\n     * `false` otherwise.\n     *\n     * Dispatches to the `any` method of the second argument, if present.\n     *\n     * Acts as a transducer if a transformer is given in list position.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.1.0\n     * @category List\n     * @sig (a -> Boolean) -> [a] -> Boolean\n     * @param {Function} fn The predicate function.\n     * @param {Array} list The array to consider.\n     * @return {Boolean} `true` if the predicate is satisfied by at least one element, `false`\n     *         otherwise.\n     * @see R.all, R.none, R.transduce\n     * @example\n     *\n     *      var lessThan0 = R.flip(R.lt)(0);\n     *      var lessThan2 = R.flip(R.lt)(2);\n     *      R.any(lessThan0)([1, 2]); //=> false\n     *      R.any(lessThan2)([1, 2]); //=> true\n     */\n    var any = _curry2(_dispatchable('any', _xany, function any(fn, list) {\n        var idx = 0;\n        while (idx < list.length) {\n            if (fn(list[idx])) {\n                return true;\n            }\n            idx += 1;\n        }\n        return false;\n    }));\n\n    /**\n     * Returns a new list, composed of n-tuples of consecutive elements If `n` is\n     * greater than the length of the list, an empty list is returned.\n     *\n     * Dispatches to the `aperture` method of the second argument, if present.\n     *\n     * Acts as a transducer if a transformer is given in list position.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.12.0\n     * @category List\n     * @sig Number -> [a] -> [[a]]\n     * @param {Number} n The size of the tuples to create\n     * @param {Array} list The list to split into `n`-tuples\n     * @return {Array} The new list.\n     * @see R.transduce\n     * @example\n     *\n     *      R.aperture(2, [1, 2, 3, 4, 5]); //=> [[1, 2], [2, 3], [3, 4], [4, 5]]\n     *      R.aperture(3, [1, 2, 3, 4, 5]); //=> [[1, 2, 3], [2, 3, 4], [3, 4, 5]]\n     *      R.aperture(7, [1, 2, 3, 4, 5]); //=> []\n     */\n    var aperture = _curry2(_dispatchable('aperture', _xaperture, _aperture));\n\n    /**\n     * Returns a new list containing the contents of the given list, followed by\n     * the given element.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.1.0\n     * @category List\n     * @sig a -> [a] -> [a]\n     * @param {*} el The element to add to the end of the new list.\n     * @param {Array} list The list whose contents will be added to the beginning of the output\n     *        list.\n     * @return {Array} A new list containing the contents of the old list followed by `el`.\n     * @see R.prepend\n     * @example\n     *\n     *      R.append('tests', ['write', 'more']); //=> ['write', 'more', 'tests']\n     *      R.append('tests', []); //=> ['tests']\n     *      R.append(['tests'], ['write', 'more']); //=> ['write', 'more', ['tests']]\n     */\n    var append = _curry2(function append(el, list) {\n        return _concat(list, [el]);\n    });\n\n    /**\n     * Applies function `fn` to the argument list `args`. This is useful for\n     * creating a fixed-arity function from a variadic function. `fn` should be a\n     * bound function if context is significant.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.7.0\n     * @category Function\n     * @sig (*... -> a) -> [*] -> a\n     * @param {Function} fn\n     * @param {Array} args\n     * @return {*}\n     * @see R.call, R.unapply\n     * @example\n     *\n     *      var nums = [1, 2, 3, -99, 42, 6, 7];\n     *      R.apply(Math.max, nums); //=> 42\n     */\n    var apply = _curry2(function apply(fn, args) {\n        return fn.apply(this, args);\n    });\n\n    /**\n     * Makes a shallow clone of an object, setting or overriding the specified\n     * property with the given value. Note that this copies and flattens prototype\n     * properties onto the new object as well. All non-primitive properties are\n     * copied by reference.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.8.0\n     * @category Object\n     * @sig String -> a -> {k: v} -> {k: v}\n     * @param {String} prop the property name to set\n     * @param {*} val the new value\n     * @param {Object} obj the object to clone\n     * @return {Object} a new object similar to the original except for the specified property.\n     * @see R.dissoc\n     * @example\n     *\n     *      R.assoc('c', 3, {a: 1, b: 2}); //=> {a: 1, b: 2, c: 3}\n     */\n    var assoc = _curry3(function assoc(prop, val, obj) {\n        var result = {};\n        for (var p in obj) {\n            result[p] = obj[p];\n        }\n        result[prop] = val;\n        return result;\n    });\n\n    /**\n     * Makes a shallow clone of an object, setting or overriding the nodes required\n     * to create the given path, and placing the specific value at the tail end of\n     * that path. Note that this copies and flattens prototype properties onto the\n     * new object as well. All non-primitive properties are copied by reference.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.8.0\n     * @category Object\n     * @sig [String] -> a -> {k: v} -> {k: v}\n     * @param {Array} path the path to set\n     * @param {*} val the new value\n     * @param {Object} obj the object to clone\n     * @return {Object} a new object similar to the original except along the specified path.\n     * @see R.dissocPath\n     * @example\n     *\n     *      R.assocPath(['a', 'b', 'c'], 42, {a: {b: {c: 0}}}); //=> {a: {b: {c: 42}}}\n     */\n    var assocPath = _curry3(function assocPath(path, val, obj) {\n        switch (path.length) {\n        case 0:\n            return val;\n        case 1:\n            return assoc(path[0], val, obj);\n        default:\n            return assoc(path[0], assocPath(_slice(path, 1), val, Object(obj[path[0]])), obj);\n        }\n    });\n\n    /**\n     * Creates a function that is bound to a context.\n     * Note: `R.bind` does not provide the additional argument-binding capabilities of\n     * [Function.prototype.bind](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function/bind).\n     *\n     * @func\n     * @memberOf R\n     * @since v0.6.0\n     * @category Function\n     * @category Object\n     * @sig (* -> *) -> {*} -> (* -> *)\n     * @param {Function} fn The function to bind to context\n     * @param {Object} thisObj The context to bind `fn` to\n     * @return {Function} A function that will execute in the context of `thisObj`.\n     * @see R.partial\n     */\n    var bind = _curry2(function bind(fn, thisObj) {\n        return _arity(fn.length, function () {\n            return fn.apply(thisObj, arguments);\n        });\n    });\n\n    /**\n     * Restricts a number to be within a range.\n     *\n     * Also works for other ordered types such as Strings and Dates.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.20.0\n     * @category Relation\n     * @sig Ord a => a -> a -> a -> a\n     * @param {Number} minimum number\n     * @param {Number} maximum number\n     * @param {Number} value to be clamped\n     * @return {Number} Returns the clamped value\n     * @example\n     *\n     *      R.clamp(1, 10, -1) // => 1\n     *      R.clamp(1, 10, 11) // => 10\n     *      R.clamp(1, 10, 4)  // => 4\n     */\n    var clamp = _curry3(function clamp(min, max, value) {\n        if (min > max) {\n            throw new Error('min must not be greater than max in clamp(min, max, value)');\n        }\n        return value < min ? min : value > max ? max : value;\n    });\n\n    /**\n     * Makes a comparator function out of a function that reports whether the first\n     * element is less than the second.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.1.0\n     * @category Function\n     * @sig (a, b -> Boolean) -> (a, b -> Number)\n     * @param {Function} pred A predicate function of arity two.\n     * @return {Function} A Function :: a -> b -> Int that returns `-1` if a < b, `1` if b < a, otherwise `0`.\n     * @example\n     *\n     *      var cmp = R.comparator((a, b) => a.age < b.age);\n     *      var people = [\n     *        // ...\n     *      ];\n     *      R.sort(cmp, people);\n     */\n    var comparator = _curry1(function comparator(pred) {\n        return function (a, b) {\n            return pred(a, b) ? -1 : pred(b, a) ? 1 : 0;\n        };\n    });\n\n    /**\n     * Returns a curried equivalent of the provided function, with the specified\n     * arity. The curried function has two unusual capabilities. First, its\n     * arguments needn't be provided one at a time. If `g` is `R.curryN(3, f)`, the\n     * following are equivalent:\n     *\n     *   - `g(1)(2)(3)`\n     *   - `g(1)(2, 3)`\n     *   - `g(1, 2)(3)`\n     *   - `g(1, 2, 3)`\n     *\n     * Secondly, the special placeholder value `R.__` may be used to specify\n     * \"gaps\", allowing partial application of any combination of arguments,\n     * regardless of their positions. If `g` is as above and `_` is `R.__`, the\n     * following are equivalent:\n     *\n     *   - `g(1, 2, 3)`\n     *   - `g(_, 2, 3)(1)`\n     *   - `g(_, _, 3)(1)(2)`\n     *   - `g(_, _, 3)(1, 2)`\n     *   - `g(_, 2)(1)(3)`\n     *   - `g(_, 2)(1, 3)`\n     *   - `g(_, 2)(_, 3)(1)`\n     *\n     * @func\n     * @memberOf R\n     * @since v0.5.0\n     * @category Function\n     * @sig Number -> (* -> a) -> (* -> a)\n     * @param {Number} length The arity for the returned function.\n     * @param {Function} fn The function to curry.\n     * @return {Function} A new, curried function.\n     * @see R.curry\n     * @example\n     *\n     *      var sumArgs = (...args) => R.sum(args);\n     *\n     *      var curriedAddFourNumbers = R.curryN(4, sumArgs);\n     *      var f = curriedAddFourNumbers(1, 2);\n     *      var g = f(3);\n     *      g(4); //=> 10\n     */\n    var curryN = _curry2(function curryN(length, fn) {\n        if (length === 1) {\n            return _curry1(fn);\n        }\n        return _arity(length, _curryN(length, [], fn));\n    });\n\n    /**\n     * Decrements its argument.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.9.0\n     * @category Math\n     * @sig Number -> Number\n     * @param {Number} n\n     * @return {Number}\n     * @see R.inc\n     * @example\n     *\n     *      R.dec(42); //=> 41\n     */\n    var dec = add(-1);\n\n    /**\n     * Returns the second argument if it is not `null`, `undefined` or `NaN`\n     * otherwise the first argument is returned.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.10.0\n     * @category Logic\n     * @sig a -> b -> a | b\n     * @param {a} val The default value.\n     * @param {b} val The value to return if it is not null or undefined\n     * @return {*} The the second value or the default value\n     * @example\n     *\n     *      var defaultTo42 = R.defaultTo(42);\n     *\n     *      defaultTo42(null);  //=> 42\n     *      defaultTo42(undefined);  //=> 42\n     *      defaultTo42('Ramda');  //=> 'Ramda'\n     *      defaultTo42(parseInt('string')); //=> 42\n     */\n    var defaultTo = _curry2(function defaultTo(d, v) {\n        return v == null || v !== v ? d : v;\n    });\n\n    /**\n     * Finds the set (i.e. no duplicates) of all elements in the first list not\n     * contained in the second list. Duplication is determined according to the\n     * value returned by applying the supplied predicate to two list elements.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.1.0\n     * @category Relation\n     * @sig (a -> a -> Boolean) -> [*] -> [*] -> [*]\n     * @param {Function} pred A predicate used to test whether two items are equal.\n     * @param {Array} list1 The first list.\n     * @param {Array} list2 The second list.\n     * @return {Array} The elements in `list1` that are not in `list2`.\n     * @see R.difference\n     * @example\n     *\n     *      var cmp = (x, y) => x.a === y.a;\n     *      var l1 = [{a: 1}, {a: 2}, {a: 3}];\n     *      var l2 = [{a: 3}, {a: 4}];\n     *      R.differenceWith(cmp, l1, l2); //=> [{a: 1}, {a: 2}]\n     */\n    var differenceWith = _curry3(function differenceWith(pred, first, second) {\n        var out = [];\n        var idx = 0;\n        var firstLen = first.length;\n        while (idx < firstLen) {\n            if (!_containsWith(pred, first[idx], second) && !_containsWith(pred, first[idx], out)) {\n                out.push(first[idx]);\n            }\n            idx += 1;\n        }\n        return out;\n    });\n\n    /**\n     * Returns a new object that does not contain a `prop` property.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.10.0\n     * @category Object\n     * @sig String -> {k: v} -> {k: v}\n     * @param {String} prop the name of the property to dissociate\n     * @param {Object} obj the object to clone\n     * @return {Object} a new object similar to the original but without the specified property\n     * @see R.assoc\n     * @example\n     *\n     *      R.dissoc('b', {a: 1, b: 2, c: 3}); //=> {a: 1, c: 3}\n     */\n    var dissoc = _curry2(function dissoc(prop, obj) {\n        var result = {};\n        for (var p in obj) {\n            if (p !== prop) {\n                result[p] = obj[p];\n            }\n        }\n        return result;\n    });\n\n    /**\n     * Makes a shallow clone of an object, omitting the property at the given path.\n     * Note that this copies and flattens prototype properties onto the new object\n     * as well. All non-primitive properties are copied by reference.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.11.0\n     * @category Object\n     * @sig [String] -> {k: v} -> {k: v}\n     * @param {Array} path the path to set\n     * @param {Object} obj the object to clone\n     * @return {Object} a new object without the property at path\n     * @see R.assocPath\n     * @example\n     *\n     *      R.dissocPath(['a', 'b', 'c'], {a: {b: {c: 42}}}); //=> {a: {b: {}}}\n     */\n    var dissocPath = _curry2(function dissocPath(path, obj) {\n        switch (path.length) {\n        case 0:\n            return obj;\n        case 1:\n            return dissoc(path[0], obj);\n        default:\n            var head = path[0];\n            var tail = _slice(path, 1);\n            return obj[head] == null ? obj : assoc(head, dissocPath(tail, obj[head]), obj);\n        }\n    });\n\n    /**\n     * Divides two numbers. Equivalent to `a / b`.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.1.0\n     * @category Math\n     * @sig Number -> Number -> Number\n     * @param {Number} a The first value.\n     * @param {Number} b The second value.\n     * @return {Number} The result of `a / b`.\n     * @see R.multiply\n     * @example\n     *\n     *      R.divide(71, 100); //=> 0.71\n     *\n     *      var half = R.divide(R.__, 2);\n     *      half(42); //=> 21\n     *\n     *      var reciprocal = R.divide(1);\n     *      reciprocal(4);   //=> 0.25\n     */\n    var divide = _curry2(function divide(a, b) {\n        return a / b;\n    });\n\n    /**\n     * Returns a new list containing the last `n` elements of a given list, passing\n     * each value to the supplied predicate function, skipping elements while the\n     * predicate function returns `true`. The predicate function is passed one\n     * argument: *(value)*.\n     *\n     * Dispatches to the `dropWhile` method of the second argument, if present.\n     *\n     * Acts as a transducer if a transformer is given in list position.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.9.0\n     * @category List\n     * @sig (a -> Boolean) -> [a] -> [a]\n     * @param {Function} fn The function called per iteration.\n     * @param {Array} list The collection to iterate over.\n     * @return {Array} A new array.\n     * @see R.takeWhile, R.transduce, R.addIndex\n     * @example\n     *\n     *      var lteTwo = x => x <= 2;\n     *\n     *      R.dropWhile(lteTwo, [1, 2, 3, 4, 3, 2, 1]); //=> [3, 4, 3, 2, 1]\n     */\n    var dropWhile = _curry2(_dispatchable('dropWhile', _xdropWhile, function dropWhile(pred, list) {\n        var idx = 0;\n        var len = list.length;\n        while (idx < len && pred(list[idx])) {\n            idx += 1;\n        }\n        return _slice(list, idx);\n    }));\n\n    /**\n     * Returns the empty value of its argument's type. Ramda defines the empty\n     * value of Array (`[]`), Object (`{}`), String (`''`), and Arguments. Other\n     * types are supported if they define `<Type>.empty` and/or\n     * `<Type>.prototype.empty`.\n     *\n     * Dispatches to the `empty` method of the first argument, if present.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.3.0\n     * @category Function\n     * @sig a -> a\n     * @param {*} x\n     * @return {*}\n     * @example\n     *\n     *      R.empty(Just(42));      //=> Nothing()\n     *      R.empty([1, 2, 3]);     //=> []\n     *      R.empty('unicorns');    //=> ''\n     *      R.empty({x: 1, y: 2});  //=> {}\n     */\n    // else\n    var empty = _curry1(function empty(x) {\n        return x != null && typeof x.empty === 'function' ? x.empty() : x != null && x.constructor != null && typeof x.constructor.empty === 'function' ? x.constructor.empty() : _isArray(x) ? [] : _isString(x) ? '' : _isObject(x) ? {} : _isArguments(x) ? function () {\n            return arguments;\n        }() : // else\n        void 0;\n    });\n\n    /**\n     * Creates a new object by recursively evolving a shallow copy of `object`,\n     * according to the `transformation` functions. All non-primitive properties\n     * are copied by reference.\n     *\n     * A `transformation` function will not be invoked if its corresponding key\n     * does not exist in the evolved object.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.9.0\n     * @category Object\n     * @sig {k: (v -> v)} -> {k: v} -> {k: v}\n     * @param {Object} transformations The object specifying transformation functions to apply\n     *        to the object.\n     * @param {Object} object The object to be transformed.\n     * @return {Object} The transformed object.\n     * @example\n     *\n     *      var tomato  = {firstName: '  Tomato ', data: {elapsed: 100, remaining: 1400}, id:123};\n     *      var transformations = {\n     *        firstName: R.trim,\n     *        lastName: R.trim, // Will not get invoked.\n     *        data: {elapsed: R.add(1), remaining: R.add(-1)}\n     *      };\n     *      R.evolve(transformations, tomato); //=> {firstName: 'Tomato', data: {elapsed: 101, remaining: 1399}, id:123}\n     */\n    var evolve = _curry2(function evolve(transformations, object) {\n        var result = {};\n        var transformation, key, type;\n        for (key in object) {\n            transformation = transformations[key];\n            type = typeof transformation;\n            result[key] = type === 'function' ? transformation(object[key]) : type === 'object' ? evolve(transformations[key], object[key]) : object[key];\n        }\n        return result;\n    });\n\n    /**\n     * Returns the first element of the list which matches the predicate, or\n     * `undefined` if no element matches.\n     *\n     * Dispatches to the `find` method of the second argument, if present.\n     *\n     * Acts as a transducer if a transformer is given in list position.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.1.0\n     * @category List\n     * @sig (a -> Boolean) -> [a] -> a | undefined\n     * @param {Function} fn The predicate function used to determine if the element is the\n     *        desired one.\n     * @param {Array} list The array to consider.\n     * @return {Object} The element found, or `undefined`.\n     * @see R.transduce\n     * @example\n     *\n     *      var xs = [{a: 1}, {a: 2}, {a: 3}];\n     *      R.find(R.propEq('a', 2))(xs); //=> {a: 2}\n     *      R.find(R.propEq('a', 4))(xs); //=> undefined\n     */\n    var find = _curry2(_dispatchable('find', _xfind, function find(fn, list) {\n        var idx = 0;\n        var len = list.length;\n        while (idx < len) {\n            if (fn(list[idx])) {\n                return list[idx];\n            }\n            idx += 1;\n        }\n    }));\n\n    /**\n     * Returns the index of the first element of the list which matches the\n     * predicate, or `-1` if no element matches.\n     *\n     * Dispatches to the `findIndex` method of the second argument, if present.\n     *\n     * Acts as a transducer if a transformer is given in list position.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.1.1\n     * @category List\n     * @sig (a -> Boolean) -> [a] -> Number\n     * @param {Function} fn The predicate function used to determine if the element is the\n     * desired one.\n     * @param {Array} list The array to consider.\n     * @return {Number} The index of the element found, or `-1`.\n     * @see R.transduce\n     * @example\n     *\n     *      var xs = [{a: 1}, {a: 2}, {a: 3}];\n     *      R.findIndex(R.propEq('a', 2))(xs); //=> 1\n     *      R.findIndex(R.propEq('a', 4))(xs); //=> -1\n     */\n    var findIndex = _curry2(_dispatchable('findIndex', _xfindIndex, function findIndex(fn, list) {\n        var idx = 0;\n        var len = list.length;\n        while (idx < len) {\n            if (fn(list[idx])) {\n                return idx;\n            }\n            idx += 1;\n        }\n        return -1;\n    }));\n\n    /**\n     * Returns the last element of the list which matches the predicate, or\n     * `undefined` if no element matches.\n     *\n     * Dispatches to the `findLast` method of the second argument, if present.\n     *\n     * Acts as a transducer if a transformer is given in list position.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.1.1\n     * @category List\n     * @sig (a -> Boolean) -> [a] -> a | undefined\n     * @param {Function} fn The predicate function used to determine if the element is the\n     * desired one.\n     * @param {Array} list The array to consider.\n     * @return {Object} The element found, or `undefined`.\n     * @see R.transduce\n     * @example\n     *\n     *      var xs = [{a: 1, b: 0}, {a:1, b: 1}];\n     *      R.findLast(R.propEq('a', 1))(xs); //=> {a: 1, b: 1}\n     *      R.findLast(R.propEq('a', 4))(xs); //=> undefined\n     */\n    var findLast = _curry2(_dispatchable('findLast', _xfindLast, function findLast(fn, list) {\n        var idx = list.length - 1;\n        while (idx >= 0) {\n            if (fn(list[idx])) {\n                return list[idx];\n            }\n            idx -= 1;\n        }\n    }));\n\n    /**\n     * Returns the index of the last element of the list which matches the\n     * predicate, or `-1` if no element matches.\n     *\n     * Dispatches to the `findLastIndex` method of the second argument, if present.\n     *\n     * Acts as a transducer if a transformer is given in list position.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.1.1\n     * @category List\n     * @sig (a -> Boolean) -> [a] -> Number\n     * @param {Function} fn The predicate function used to determine if the element is the\n     * desired one.\n     * @param {Array} list The array to consider.\n     * @return {Number} The index of the element found, or `-1`.\n     * @see R.transduce\n     * @example\n     *\n     *      var xs = [{a: 1, b: 0}, {a:1, b: 1}];\n     *      R.findLastIndex(R.propEq('a', 1))(xs); //=> 1\n     *      R.findLastIndex(R.propEq('a', 4))(xs); //=> -1\n     */\n    var findLastIndex = _curry2(_dispatchable('findLastIndex', _xfindLastIndex, function findLastIndex(fn, list) {\n        var idx = list.length - 1;\n        while (idx >= 0) {\n            if (fn(list[idx])) {\n                return idx;\n            }\n            idx -= 1;\n        }\n        return -1;\n    }));\n\n    /**\n     * Iterate over an input `list`, calling a provided function `fn` for each\n     * element in the list.\n     *\n     * `fn` receives one argument: *(value)*.\n     *\n     * Note: `R.forEach` does not skip deleted or unassigned indices (sparse\n     * arrays), unlike the native `Array.prototype.forEach` method. For more\n     * details on this behavior, see:\n     * https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/forEach#Description\n     *\n     * Also note that, unlike `Array.prototype.forEach`, Ramda's `forEach` returns\n     * the original array. In some libraries this function is named `each`.\n     *\n     * Dispatches to the `forEach` method of the second argument, if present.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.1.1\n     * @category List\n     * @sig (a -> *) -> [a] -> [a]\n     * @param {Function} fn The function to invoke. Receives one argument, `value`.\n     * @param {Array} list The list to iterate over.\n     * @return {Array} The original list.\n     * @see R.addIndex\n     * @example\n     *\n     *      var printXPlusFive = x => console.log(x + 5);\n     *      R.forEach(printXPlusFive, [1, 2, 3]); //=> [1, 2, 3]\n     *      //-> 6\n     *      //-> 7\n     *      //-> 8\n     */\n    var forEach = _curry2(_checkForMethod('forEach', function forEach(fn, list) {\n        var len = list.length;\n        var idx = 0;\n        while (idx < len) {\n            fn(list[idx]);\n            idx += 1;\n        }\n        return list;\n    }));\n\n    /**\n     * Creates a new object out of a list key-value pairs.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.3.0\n     * @category List\n     * @sig [[k,v]] -> {k: v}\n     * @param {Array} pairs An array of two-element arrays that will be the keys and values of the output object.\n     * @return {Object} The object made by pairing up `keys` and `values`.\n     * @see R.toPairs, R.pair\n     * @example\n     *\n     *      R.fromPairs([['a', 1], ['b', 2],  ['c', 3]]); //=> {a: 1, b: 2, c: 3}\n     */\n    var fromPairs = _curry1(function fromPairs(pairs) {\n        var idx = 0;\n        var len = pairs.length;\n        var out = {};\n        while (idx < len) {\n            if (_isArray(pairs[idx]) && pairs[idx].length) {\n                out[pairs[idx][0]] = pairs[idx][1];\n            }\n            idx += 1;\n        }\n        return out;\n    });\n\n    /**\n     * Takes a list and returns a list of lists where each sublist's elements are\n     * all \"equal\" according to the provided equality function.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.21.0\n     * @category List\n     * @sig (a, a -> Boolean) -> [a] -> [[a]]\n     * @param {Function} fn Function for determining whether two given (adjacent)\n     *        elements should be in the same group\n     * @param {Array} list The array to group. Also accepts a string, which will be\n     *        treated as a list of characters.\n     * @return {List} A list that contains sublists of equal elements,\n     *         whose concatenations is equal to the original list.\n     * @example\n     *\n     *    groupWith(R.equals, [0, 1, 1, 2, 3, 5, 8, 13, 21])\n     *    // [[0], [1, 1], [2, 3, 5, 8, 13, 21]]\n     *\n     *    groupWith((a, b) => a % 2 === b % 2, [0, 1, 1, 2, 3, 5, 8, 13, 21])\n     *    // [[0], [1, 1], [2], [3, 5], [8], [13, 21]]\n     *\n     *    R.groupWith(R.eqBy(isVowel), 'aestiou')\n     *    // ['ae', 'st', 'iou']\n     */\n    var groupWith = _curry2(function (fn, list) {\n        var res = [];\n        var idx = 0;\n        var len = list.length;\n        while (idx < len) {\n            var nextidx = idx + 1;\n            while (nextidx < len && fn(list[idx], list[nextidx])) {\n                nextidx += 1;\n            }\n            res.push(list.slice(idx, nextidx));\n            idx = nextidx;\n        }\n        return res;\n    });\n\n    /**\n     * Returns `true` if the first argument is greater than the second; `false`\n     * otherwise.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.1.0\n     * @category Relation\n     * @sig Ord a => a -> a -> Boolean\n     * @param {*} a\n     * @param {*} b\n     * @return {Boolean}\n     * @see R.lt\n     * @example\n     *\n     *      R.gt(2, 1); //=> true\n     *      R.gt(2, 2); //=> false\n     *      R.gt(2, 3); //=> false\n     *      R.gt('a', 'z'); //=> false\n     *      R.gt('z', 'a'); //=> true\n     */\n    var gt = _curry2(function gt(a, b) {\n        return a > b;\n    });\n\n    /**\n     * Returns `true` if the first argument is greater than or equal to the second;\n     * `false` otherwise.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.1.0\n     * @category Relation\n     * @sig Ord a => a -> a -> Boolean\n     * @param {Number} a\n     * @param {Number} b\n     * @return {Boolean}\n     * @see R.lte\n     * @example\n     *\n     *      R.gte(2, 1); //=> true\n     *      R.gte(2, 2); //=> true\n     *      R.gte(2, 3); //=> false\n     *      R.gte('a', 'z'); //=> false\n     *      R.gte('z', 'a'); //=> true\n     */\n    var gte = _curry2(function gte(a, b) {\n        return a >= b;\n    });\n\n    /**\n     * Returns whether or not an object has an own property with the specified name\n     *\n     * @func\n     * @memberOf R\n     * @since v0.7.0\n     * @category Object\n     * @sig s -> {s: x} -> Boolean\n     * @param {String} prop The name of the property to check for.\n     * @param {Object} obj The object to query.\n     * @return {Boolean} Whether the property exists.\n     * @example\n     *\n     *      var hasName = R.has('name');\n     *      hasName({name: 'alice'});   //=> true\n     *      hasName({name: 'bob'});     //=> true\n     *      hasName({});                //=> false\n     *\n     *      var point = {x: 0, y: 0};\n     *      var pointHas = R.has(R.__, point);\n     *      pointHas('x');  //=> true\n     *      pointHas('y');  //=> true\n     *      pointHas('z');  //=> false\n     */\n    var has = _curry2(_has);\n\n    /**\n     * Returns whether or not an object or its prototype chain has a property with\n     * the specified name\n     *\n     * @func\n     * @memberOf R\n     * @since v0.7.0\n     * @category Object\n     * @sig s -> {s: x} -> Boolean\n     * @param {String} prop The name of the property to check for.\n     * @param {Object} obj The object to query.\n     * @return {Boolean} Whether the property exists.\n     * @example\n     *\n     *      function Rectangle(width, height) {\n     *        this.width = width;\n     *        this.height = height;\n     *      }\n     *      Rectangle.prototype.area = function() {\n     *        return this.width * this.height;\n     *      };\n     *\n     *      var square = new Rectangle(2, 2);\n     *      R.hasIn('width', square);  //=> true\n     *      R.hasIn('area', square);  //=> true\n     */\n    var hasIn = _curry2(function hasIn(prop, obj) {\n        return prop in obj;\n    });\n\n    /**\n     * Returns true if its arguments are identical, false otherwise. Values are\n     * identical if they reference the same memory. `NaN` is identical to `NaN`;\n     * `0` and `-0` are not identical.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.15.0\n     * @category Relation\n     * @sig a -> a -> Boolean\n     * @param {*} a\n     * @param {*} b\n     * @return {Boolean}\n     * @example\n     *\n     *      var o = {};\n     *      R.identical(o, o); //=> true\n     *      R.identical(1, 1); //=> true\n     *      R.identical(1, '1'); //=> false\n     *      R.identical([], []); //=> false\n     *      R.identical(0, -0); //=> false\n     *      R.identical(NaN, NaN); //=> true\n     */\n    // SameValue algorithm\n    // Steps 1-5, 7-10\n    // Steps 6.b-6.e: +0 != -0\n    // Step 6.a: NaN == NaN\n    var identical = _curry2(function identical(a, b) {\n        // SameValue algorithm\n        if (a === b) {\n            // Steps 1-5, 7-10\n            // Steps 6.b-6.e: +0 != -0\n            return a !== 0 || 1 / a === 1 / b;\n        } else {\n            // Step 6.a: NaN == NaN\n            return a !== a && b !== b;\n        }\n    });\n\n    /**\n     * A function that does nothing but return the parameter supplied to it. Good\n     * as a default or placeholder function.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.1.0\n     * @category Function\n     * @sig a -> a\n     * @param {*} x The value to return.\n     * @return {*} The input value, `x`.\n     * @example\n     *\n     *      R.identity(1); //=> 1\n     *\n     *      var obj = {};\n     *      R.identity(obj) === obj; //=> true\n     */\n    var identity = _curry1(_identity);\n\n    /**\n     * Creates a function that will process either the `onTrue` or the `onFalse`\n     * function depending upon the result of the `condition` predicate.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.8.0\n     * @category Logic\n     * @sig (*... -> Boolean) -> (*... -> *) -> (*... -> *) -> (*... -> *)\n     * @param {Function} condition A predicate function\n     * @param {Function} onTrue A function to invoke when the `condition` evaluates to a truthy value.\n     * @param {Function} onFalse A function to invoke when the `condition` evaluates to a falsy value.\n     * @return {Function} A new unary function that will process either the `onTrue` or the `onFalse`\n     *                    function depending upon the result of the `condition` predicate.\n     * @see R.unless, R.when\n     * @example\n     *\n     *      var incCount = R.ifElse(\n     *        R.has('count'),\n     *        R.over(R.lensProp('count'), R.inc),\n     *        R.assoc('count', 1)\n     *      );\n     *      incCount({});           //=> { count: 1 }\n     *      incCount({ count: 1 }); //=> { count: 2 }\n     */\n    var ifElse = _curry3(function ifElse(condition, onTrue, onFalse) {\n        return curryN(Math.max(condition.length, onTrue.length, onFalse.length), function _ifElse() {\n            return condition.apply(this, arguments) ? onTrue.apply(this, arguments) : onFalse.apply(this, arguments);\n        });\n    });\n\n    /**\n     * Increments its argument.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.9.0\n     * @category Math\n     * @sig Number -> Number\n     * @param {Number} n\n     * @return {Number}\n     * @see R.dec\n     * @example\n     *\n     *      R.inc(42); //=> 43\n     */\n    var inc = add(1);\n\n    /**\n     * Inserts the supplied element into the list, at index `index`. _Note that\n     * this is not destructive_: it returns a copy of the list with the changes.\n     * <small>No lists have been harmed in the application of this function.</small>\n     *\n     * @func\n     * @memberOf R\n     * @since v0.2.2\n     * @category List\n     * @sig Number -> a -> [a] -> [a]\n     * @param {Number} index The position to insert the element\n     * @param {*} elt The element to insert into the Array\n     * @param {Array} list The list to insert into\n     * @return {Array} A new Array with `elt` inserted at `index`.\n     * @example\n     *\n     *      R.insert(2, 'x', [1,2,3,4]); //=> [1,2,'x',3,4]\n     */\n    var insert = _curry3(function insert(idx, elt, list) {\n        idx = idx < list.length && idx >= 0 ? idx : list.length;\n        var result = _slice(list);\n        result.splice(idx, 0, elt);\n        return result;\n    });\n\n    /**\n     * Inserts the sub-list into the list, at index `index`. _Note that this is not\n     * destructive_: it returns a copy of the list with the changes.\n     * <small>No lists have been harmed in the application of this function.</small>\n     *\n     * @func\n     * @memberOf R\n     * @since v0.9.0\n     * @category List\n     * @sig Number -> [a] -> [a] -> [a]\n     * @param {Number} index The position to insert the sub-list\n     * @param {Array} elts The sub-list to insert into the Array\n     * @param {Array} list The list to insert the sub-list into\n     * @return {Array} A new Array with `elts` inserted starting at `index`.\n     * @example\n     *\n     *      R.insertAll(2, ['x','y','z'], [1,2,3,4]); //=> [1,2,'x','y','z',3,4]\n     */\n    var insertAll = _curry3(function insertAll(idx, elts, list) {\n        idx = idx < list.length && idx >= 0 ? idx : list.length;\n        return _concat(_concat(_slice(list, 0, idx), elts), _slice(list, idx));\n    });\n\n    /**\n     * Creates a new list with the separator interposed between elements.\n     *\n     * Dispatches to the `intersperse` method of the second argument, if present.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.14.0\n     * @category List\n     * @sig a -> [a] -> [a]\n     * @param {*} separator The element to add to the list.\n     * @param {Array} list The list to be interposed.\n     * @return {Array} The new list.\n     * @example\n     *\n     *      R.intersperse('n', ['ba', 'a', 'a']); //=> ['ba', 'n', 'a', 'n', 'a']\n     */\n    var intersperse = _curry2(_checkForMethod('intersperse', function intersperse(separator, list) {\n        var out = [];\n        var idx = 0;\n        var length = list.length;\n        while (idx < length) {\n            if (idx === length - 1) {\n                out.push(list[idx]);\n            } else {\n                out.push(list[idx], separator);\n            }\n            idx += 1;\n        }\n        return out;\n    }));\n\n    /**\n     * See if an object (`val`) is an instance of the supplied constructor. This\n     * function will check up the inheritance chain, if any.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.3.0\n     * @category Type\n     * @sig (* -> {*}) -> a -> Boolean\n     * @param {Object} ctor A constructor\n     * @param {*} val The value to test\n     * @return {Boolean}\n     * @example\n     *\n     *      R.is(Object, {}); //=> true\n     *      R.is(Number, 1); //=> true\n     *      R.is(Object, 1); //=> false\n     *      R.is(String, 's'); //=> true\n     *      R.is(String, new String('')); //=> true\n     *      R.is(Object, new String('')); //=> true\n     *      R.is(Object, 's'); //=> false\n     *      R.is(Number, {}); //=> false\n     */\n    var is = _curry2(function is(Ctor, val) {\n        return val != null && val.constructor === Ctor || val instanceof Ctor;\n    });\n\n    /**\n     * Tests whether or not an object is similar to an array.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.5.0\n     * @category Type\n     * @category List\n     * @sig * -> Boolean\n     * @param {*} x The object to test.\n     * @return {Boolean} `true` if `x` has a numeric length property and extreme indices defined; `false` otherwise.\n     * @example\n     *\n     *      R.isArrayLike([]); //=> true\n     *      R.isArrayLike(true); //=> false\n     *      R.isArrayLike({}); //=> false\n     *      R.isArrayLike({length: 10}); //=> false\n     *      R.isArrayLike({0: 'zero', 9: 'nine', length: 10}); //=> true\n     */\n    var isArrayLike = _curry1(function isArrayLike(x) {\n        if (_isArray(x)) {\n            return true;\n        }\n        if (!x) {\n            return false;\n        }\n        if (typeof x !== 'object') {\n            return false;\n        }\n        if (x instanceof String) {\n            return false;\n        }\n        if (x.nodeType === 1) {\n            return !!x.length;\n        }\n        if (x.length === 0) {\n            return true;\n        }\n        if (x.length > 0) {\n            return x.hasOwnProperty(0) && x.hasOwnProperty(x.length - 1);\n        }\n        return false;\n    });\n\n    /**\n     * Checks if the input value is `null` or `undefined`.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.9.0\n     * @category Type\n     * @sig * -> Boolean\n     * @param {*} x The value to test.\n     * @return {Boolean} `true` if `x` is `undefined` or `null`, otherwise `false`.\n     * @example\n     *\n     *      R.isNil(null); //=> true\n     *      R.isNil(undefined); //=> true\n     *      R.isNil(0); //=> false\n     *      R.isNil([]); //=> false\n     */\n    var isNil = _curry1(function isNil(x) {\n        return x == null;\n    });\n\n    /**\n     * Returns a list containing the names of all the enumerable own properties of\n     * the supplied object.\n     * Note that the order of the output array is not guaranteed to be consistent\n     * across different JS platforms.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.1.0\n     * @category Object\n     * @sig {k: v} -> [k]\n     * @param {Object} obj The object to extract properties from\n     * @return {Array} An array of the object's own properties.\n     * @example\n     *\n     *      R.keys({a: 1, b: 2, c: 3}); //=> ['a', 'b', 'c']\n     */\n    // cover IE < 9 keys issues\n    // Safari bug\n    var keys = function () {\n        // cover IE < 9 keys issues\n        var hasEnumBug = !{ toString: null }.propertyIsEnumerable('toString');\n        var nonEnumerableProps = [\n            'constructor',\n            'valueOf',\n            'isPrototypeOf',\n            'toString',\n            'propertyIsEnumerable',\n            'hasOwnProperty',\n            'toLocaleString'\n        ];\n        // Safari bug\n        var hasArgsEnumBug = function () {\n            'use strict';\n            return arguments.propertyIsEnumerable('length');\n        }();\n        var contains = function contains(list, item) {\n            var idx = 0;\n            while (idx < list.length) {\n                if (list[idx] === item) {\n                    return true;\n                }\n                idx += 1;\n            }\n            return false;\n        };\n        return typeof Object.keys === 'function' && !hasArgsEnumBug ? _curry1(function keys(obj) {\n            return Object(obj) !== obj ? [] : Object.keys(obj);\n        }) : _curry1(function keys(obj) {\n            if (Object(obj) !== obj) {\n                return [];\n            }\n            var prop, nIdx;\n            var ks = [];\n            var checkArgsLength = hasArgsEnumBug && _isArguments(obj);\n            for (prop in obj) {\n                if (_has(prop, obj) && (!checkArgsLength || prop !== 'length')) {\n                    ks[ks.length] = prop;\n                }\n            }\n            if (hasEnumBug) {\n                nIdx = nonEnumerableProps.length - 1;\n                while (nIdx >= 0) {\n                    prop = nonEnumerableProps[nIdx];\n                    if (_has(prop, obj) && !contains(ks, prop)) {\n                        ks[ks.length] = prop;\n                    }\n                    nIdx -= 1;\n                }\n            }\n            return ks;\n        });\n    }();\n\n    /**\n     * Returns a list containing the names of all the properties of the supplied\n     * object, including prototype properties.\n     * Note that the order of the output array is not guaranteed to be consistent\n     * across different JS platforms.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.2.0\n     * @category Object\n     * @sig {k: v} -> [k]\n     * @param {Object} obj The object to extract properties from\n     * @return {Array} An array of the object's own and prototype properties.\n     * @example\n     *\n     *      var F = function() { this.x = 'X'; };\n     *      F.prototype.y = 'Y';\n     *      var f = new F();\n     *      R.keysIn(f); //=> ['x', 'y']\n     */\n    var keysIn = _curry1(function keysIn(obj) {\n        var prop;\n        var ks = [];\n        for (prop in obj) {\n            ks[ks.length] = prop;\n        }\n        return ks;\n    });\n\n    /**\n     * Returns the number of elements in the array by returning `list.length`.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.3.0\n     * @category List\n     * @sig [a] -> Number\n     * @param {Array} list The array to inspect.\n     * @return {Number} The length of the array.\n     * @example\n     *\n     *      R.length([]); //=> 0\n     *      R.length([1, 2, 3]); //=> 3\n     */\n    var length = _curry1(function length(list) {\n        return list != null && is(Number, list.length) ? list.length : NaN;\n    });\n\n    /**\n     * Returns `true` if the first argument is less than the second; `false`\n     * otherwise.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.1.0\n     * @category Relation\n     * @sig Ord a => a -> a -> Boolean\n     * @param {*} a\n     * @param {*} b\n     * @return {Boolean}\n     * @see R.gt\n     * @example\n     *\n     *      R.lt(2, 1); //=> false\n     *      R.lt(2, 2); //=> false\n     *      R.lt(2, 3); //=> true\n     *      R.lt('a', 'z'); //=> true\n     *      R.lt('z', 'a'); //=> false\n     */\n    var lt = _curry2(function lt(a, b) {\n        return a < b;\n    });\n\n    /**\n     * Returns `true` if the first argument is less than or equal to the second;\n     * `false` otherwise.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.1.0\n     * @category Relation\n     * @sig Ord a => a -> a -> Boolean\n     * @param {Number} a\n     * @param {Number} b\n     * @return {Boolean}\n     * @see R.gte\n     * @example\n     *\n     *      R.lte(2, 1); //=> false\n     *      R.lte(2, 2); //=> true\n     *      R.lte(2, 3); //=> true\n     *      R.lte('a', 'z'); //=> true\n     *      R.lte('z', 'a'); //=> false\n     */\n    var lte = _curry2(function lte(a, b) {\n        return a <= b;\n    });\n\n    /**\n     * The mapAccum function behaves like a combination of map and reduce; it\n     * applies a function to each element of a list, passing an accumulating\n     * parameter from left to right, and returning a final value of this\n     * accumulator together with the new list.\n     *\n     * The iterator function receives two arguments, *acc* and *value*, and should\n     * return a tuple *[acc, value]*.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.10.0\n     * @category List\n     * @sig (acc -> x -> (acc, y)) -> acc -> [x] -> (acc, [y])\n     * @param {Function} fn The function to be called on every element of the input `list`.\n     * @param {*} acc The accumulator value.\n     * @param {Array} list The list to iterate over.\n     * @return {*} The final, accumulated value.\n     * @see R.addIndex\n     * @example\n     *\n     *      var digits = ['1', '2', '3', '4'];\n     *      var appender = (a, b) => [a + b, a + b];\n     *\n     *      R.mapAccum(appender, 0, digits); //=> ['01234', ['01', '012', '0123', '01234']]\n     */\n    var mapAccum = _curry3(function mapAccum(fn, acc, list) {\n        var idx = 0;\n        var len = list.length;\n        var result = [];\n        var tuple = [acc];\n        while (idx < len) {\n            tuple = fn(tuple[0], list[idx]);\n            result[idx] = tuple[1];\n            idx += 1;\n        }\n        return [\n            tuple[0],\n            result\n        ];\n    });\n\n    /**\n     * The mapAccumRight function behaves like a combination of map and reduce; it\n     * applies a function to each element of a list, passing an accumulating\n     * parameter from right to left, and returning a final value of this\n     * accumulator together with the new list.\n     *\n     * Similar to `mapAccum`, except moves through the input list from the right to\n     * the left.\n     *\n     * The iterator function receives two arguments, *acc* and *value*, and should\n     * return a tuple *[acc, value]*.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.10.0\n     * @category List\n     * @sig (acc -> x -> (acc, y)) -> acc -> [x] -> (acc, [y])\n     * @param {Function} fn The function to be called on every element of the input `list`.\n     * @param {*} acc The accumulator value.\n     * @param {Array} list The list to iterate over.\n     * @return {*} The final, accumulated value.\n     * @see R.addIndex\n     * @example\n     *\n     *      var digits = ['1', '2', '3', '4'];\n     *      var append = (a, b) => [a + b, a + b];\n     *\n     *      R.mapAccumRight(append, 0, digits); //=> ['04321', ['04321', '0432', '043', '04']]\n     */\n    var mapAccumRight = _curry3(function mapAccumRight(fn, acc, list) {\n        var idx = list.length - 1;\n        var result = [];\n        var tuple = [acc];\n        while (idx >= 0) {\n            tuple = fn(tuple[0], list[idx]);\n            result[idx] = tuple[1];\n            idx -= 1;\n        }\n        return [\n            tuple[0],\n            result\n        ];\n    });\n\n    /**\n     * Tests a regular expression against a String. Note that this function will\n     * return an empty array when there are no matches. This differs from\n     * [`String.prototype.match`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/match)\n     * which returns `null` when there are no matches.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.1.0\n     * @category String\n     * @sig RegExp -> String -> [String | Undefined]\n     * @param {RegExp} rx A regular expression.\n     * @param {String} str The string to match against\n     * @return {Array} The list of matches or empty array.\n     * @see R.test\n     * @example\n     *\n     *      R.match(/([a-z]a)/g, 'bananas'); //=> ['ba', 'na', 'na']\n     *      R.match(/a/, 'b'); //=> []\n     *      R.match(/a/, null); //=> TypeError: null does not have a method named \"match\"\n     */\n    var match = _curry2(function match(rx, str) {\n        return str.match(rx) || [];\n    });\n\n    /**\n     * mathMod behaves like the modulo operator should mathematically, unlike the\n     * `%` operator (and by extension, R.modulo). So while \"-17 % 5\" is -2,\n     * mathMod(-17, 5) is 3. mathMod requires Integer arguments, and returns NaN\n     * when the modulus is zero or negative.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.3.0\n     * @category Math\n     * @sig Number -> Number -> Number\n     * @param {Number} m The dividend.\n     * @param {Number} p the modulus.\n     * @return {Number} The result of `b mod a`.\n     * @example\n     *\n     *      R.mathMod(-17, 5);  //=> 3\n     *      R.mathMod(17, 5);   //=> 2\n     *      R.mathMod(17, -5);  //=> NaN\n     *      R.mathMod(17, 0);   //=> NaN\n     *      R.mathMod(17.2, 5); //=> NaN\n     *      R.mathMod(17, 5.3); //=> NaN\n     *\n     *      var clock = R.mathMod(R.__, 12);\n     *      clock(15); //=> 3\n     *      clock(24); //=> 0\n     *\n     *      var seventeenMod = R.mathMod(17);\n     *      seventeenMod(3);  //=> 2\n     *      seventeenMod(4);  //=> 1\n     *      seventeenMod(10); //=> 7\n     */\n    var mathMod = _curry2(function mathMod(m, p) {\n        if (!_isInteger(m)) {\n            return NaN;\n        }\n        if (!_isInteger(p) || p < 1) {\n            return NaN;\n        }\n        return (m % p + p) % p;\n    });\n\n    /**\n     * Returns the larger of its two arguments.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.1.0\n     * @category Relation\n     * @sig Ord a => a -> a -> a\n     * @param {*} a\n     * @param {*} b\n     * @return {*}\n     * @see R.maxBy, R.min\n     * @example\n     *\n     *      R.max(789, 123); //=> 789\n     *      R.max('a', 'b'); //=> 'b'\n     */\n    var max = _curry2(function max(a, b) {\n        return b > a ? b : a;\n    });\n\n    /**\n     * Takes a function and two values, and returns whichever value produces the\n     * larger result when passed to the provided function.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.8.0\n     * @category Relation\n     * @sig Ord b => (a -> b) -> a -> a -> a\n     * @param {Function} f\n     * @param {*} a\n     * @param {*} b\n     * @return {*}\n     * @see R.max, R.minBy\n     * @example\n     *\n     *      //  square :: Number -> Number\n     *      var square = n => n * n;\n     *\n     *      R.maxBy(square, -3, 2); //=> -3\n     *\n     *      R.reduce(R.maxBy(square), 0, [3, -5, 4, 1, -2]); //=> -5\n     *      R.reduce(R.maxBy(square), 0, []); //=> 0\n     */\n    var maxBy = _curry3(function maxBy(f, a, b) {\n        return f(b) > f(a) ? b : a;\n    });\n\n    /**\n     * Create a new object with the own properties of the first object merged with\n     * the own properties of the second object. If a key exists in both objects,\n     * the value from the second object will be used.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.1.0\n     * @category Object\n     * @sig {k: v} -> {k: v} -> {k: v}\n     * @param {Object} l\n     * @param {Object} r\n     * @return {Object}\n     * @see R.mergeWith, R.mergeWithKey\n     * @example\n     *\n     *      R.merge({ 'name': 'fred', 'age': 10 }, { 'age': 40 });\n     *      //=> { 'name': 'fred', 'age': 40 }\n     *\n     *      var resetToDefault = R.merge(R.__, {x: 0});\n     *      resetToDefault({x: 5, y: 2}); //=> {x: 0, y: 2}\n     */\n    var merge = _curry2(function merge(l, r) {\n        return _assign({}, l, r);\n    });\n\n    /**\n     * Merges a list of objects together into one object.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.10.0\n     * @category List\n     * @sig [{k: v}] -> {k: v}\n     * @param {Array} list An array of objects\n     * @return {Object} A merged object.\n     * @see R.reduce\n     * @example\n     *\n     *      R.mergeAll([{foo:1},{bar:2},{baz:3}]); //=> {foo:1,bar:2,baz:3}\n     *      R.mergeAll([{foo:1},{foo:2},{bar:2}]); //=> {foo:2,bar:2}\n     */\n    var mergeAll = _curry1(function mergeAll(list) {\n        return _assign.apply(null, [{}].concat(list));\n    });\n\n    /**\n     * Creates a new object with the own properties of the two provided objects. If\n     * a key exists in both objects, the provided function is applied to the key\n     * and the values associated with the key in each object, with the result being\n     * used as the value associated with the key in the returned object. The key\n     * will be excluded from the returned object if the resulting value is\n     * `undefined`.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.19.0\n     * @category Object\n     * @sig (String -> a -> a -> a) -> {a} -> {a} -> {a}\n     * @param {Function} fn\n     * @param {Object} l\n     * @param {Object} r\n     * @return {Object}\n     * @see R.merge, R.mergeWith\n     * @example\n     *\n     *      let concatValues = (k, l, r) => k == 'values' ? R.concat(l, r) : r\n     *      R.mergeWithKey(concatValues,\n     *                     { a: true, thing: 'foo', values: [10, 20] },\n     *                     { b: true, thing: 'bar', values: [15, 35] });\n     *      //=> { a: true, b: true, thing: 'bar', values: [10, 20, 15, 35] }\n     */\n    var mergeWithKey = _curry3(function mergeWithKey(fn, l, r) {\n        var result = {};\n        var k;\n        for (k in l) {\n            if (_has(k, l)) {\n                result[k] = _has(k, r) ? fn(k, l[k], r[k]) : l[k];\n            }\n        }\n        for (k in r) {\n            if (_has(k, r) && !_has(k, result)) {\n                result[k] = r[k];\n            }\n        }\n        return result;\n    });\n\n    /**\n     * Returns the smaller of its two arguments.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.1.0\n     * @category Relation\n     * @sig Ord a => a -> a -> a\n     * @param {*} a\n     * @param {*} b\n     * @return {*}\n     * @see R.minBy, R.max\n     * @example\n     *\n     *      R.min(789, 123); //=> 123\n     *      R.min('a', 'b'); //=> 'a'\n     */\n    var min = _curry2(function min(a, b) {\n        return b < a ? b : a;\n    });\n\n    /**\n     * Takes a function and two values, and returns whichever value produces the\n     * smaller result when passed to the provided function.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.8.0\n     * @category Relation\n     * @sig Ord b => (a -> b) -> a -> a -> a\n     * @param {Function} f\n     * @param {*} a\n     * @param {*} b\n     * @return {*}\n     * @see R.min, R.maxBy\n     * @example\n     *\n     *      //  square :: Number -> Number\n     *      var square = n => n * n;\n     *\n     *      R.minBy(square, -3, 2); //=> 2\n     *\n     *      R.reduce(R.minBy(square), Infinity, [3, -5, 4, 1, -2]); //=> 1\n     *      R.reduce(R.minBy(square), Infinity, []); //=> Infinity\n     */\n    var minBy = _curry3(function minBy(f, a, b) {\n        return f(b) < f(a) ? b : a;\n    });\n\n    /**\n     * Divides the second parameter by the first and returns the remainder. Note\n     * that this function preserves the JavaScript-style behavior for modulo. For\n     * mathematical modulo see `mathMod`.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.1.1\n     * @category Math\n     * @sig Number -> Number -> Number\n     * @param {Number} a The value to the divide.\n     * @param {Number} b The pseudo-modulus\n     * @return {Number} The result of `b % a`.\n     * @see R.mathMod\n     * @example\n     *\n     *      R.modulo(17, 3); //=> 2\n     *      // JS behavior:\n     *      R.modulo(-17, 3); //=> -2\n     *      R.modulo(17, -3); //=> 2\n     *\n     *      var isOdd = R.modulo(R.__, 2);\n     *      isOdd(42); //=> 0\n     *      isOdd(21); //=> 1\n     */\n    var modulo = _curry2(function modulo(a, b) {\n        return a % b;\n    });\n\n    /**\n     * Multiplies two numbers. Equivalent to `a * b` but curried.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.1.0\n     * @category Math\n     * @sig Number -> Number -> Number\n     * @param {Number} a The first value.\n     * @param {Number} b The second value.\n     * @return {Number} The result of `a * b`.\n     * @see R.divide\n     * @example\n     *\n     *      var double = R.multiply(2);\n     *      var triple = R.multiply(3);\n     *      double(3);       //=>  6\n     *      triple(4);       //=> 12\n     *      R.multiply(2, 5);  //=> 10\n     */\n    var multiply = _curry2(function multiply(a, b) {\n        return a * b;\n    });\n\n    /**\n     * Wraps a function of any arity (including nullary) in a function that accepts\n     * exactly `n` parameters. Any extraneous parameters will not be passed to the\n     * supplied function.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.1.0\n     * @category Function\n     * @sig Number -> (* -> a) -> (* -> a)\n     * @param {Number} n The desired arity of the new function.\n     * @param {Function} fn The function to wrap.\n     * @return {Function} A new function wrapping `fn`. The new function is guaranteed to be of\n     *         arity `n`.\n     * @example\n     *\n     *      var takesTwoArgs = (a, b) => [a, b];\n     *\n     *      takesTwoArgs.length; //=> 2\n     *      takesTwoArgs(1, 2); //=> [1, 2]\n     *\n     *      var takesOneArg = R.nAry(1, takesTwoArgs);\n     *      takesOneArg.length; //=> 1\n     *      // Only `n` arguments are passed to the wrapped function\n     *      takesOneArg(1, 2); //=> [1, undefined]\n     */\n    var nAry = _curry2(function nAry(n, fn) {\n        switch (n) {\n        case 0:\n            return function () {\n                return fn.call(this);\n            };\n        case 1:\n            return function (a0) {\n                return fn.call(this, a0);\n            };\n        case 2:\n            return function (a0, a1) {\n                return fn.call(this, a0, a1);\n            };\n        case 3:\n            return function (a0, a1, a2) {\n                return fn.call(this, a0, a1, a2);\n            };\n        case 4:\n            return function (a0, a1, a2, a3) {\n                return fn.call(this, a0, a1, a2, a3);\n            };\n        case 5:\n            return function (a0, a1, a2, a3, a4) {\n                return fn.call(this, a0, a1, a2, a3, a4);\n            };\n        case 6:\n            return function (a0, a1, a2, a3, a4, a5) {\n                return fn.call(this, a0, a1, a2, a3, a4, a5);\n            };\n        case 7:\n            return function (a0, a1, a2, a3, a4, a5, a6) {\n                return fn.call(this, a0, a1, a2, a3, a4, a5, a6);\n            };\n        case 8:\n            return function (a0, a1, a2, a3, a4, a5, a6, a7) {\n                return fn.call(this, a0, a1, a2, a3, a4, a5, a6, a7);\n            };\n        case 9:\n            return function (a0, a1, a2, a3, a4, a5, a6, a7, a8) {\n                return fn.call(this, a0, a1, a2, a3, a4, a5, a6, a7, a8);\n            };\n        case 10:\n            return function (a0, a1, a2, a3, a4, a5, a6, a7, a8, a9) {\n                return fn.call(this, a0, a1, a2, a3, a4, a5, a6, a7, a8, a9);\n            };\n        default:\n            throw new Error('First argument to nAry must be a non-negative integer no greater than ten');\n        }\n    });\n\n    /**\n     * Negates its argument.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.9.0\n     * @category Math\n     * @sig Number -> Number\n     * @param {Number} n\n     * @return {Number}\n     * @example\n     *\n     *      R.negate(42); //=> -42\n     */\n    var negate = _curry1(function negate(n) {\n        return -n;\n    });\n\n    /**\n     * Returns `true` if no elements of the list match the predicate, `false`\n     * otherwise.\n     *\n     * Dispatches to the `any` method of the second argument, if present.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.12.0\n     * @category List\n     * @sig (a -> Boolean) -> [a] -> Boolean\n     * @param {Function} fn The predicate function.\n     * @param {Array} list The array to consider.\n     * @return {Boolean} `true` if the predicate is not satisfied by every element, `false` otherwise.\n     * @see R.all, R.any\n     * @example\n     *\n     *      var isEven = n => n % 2 === 0;\n     *\n     *      R.none(isEven, [1, 3, 5, 7, 9, 11]); //=> true\n     *      R.none(isEven, [1, 3, 5, 7, 8, 11]); //=> false\n     */\n    var none = _curry2(_complement(_dispatchable('any', _xany, any)));\n\n    /**\n     * A function that returns the `!` of its argument. It will return `true` when\n     * passed false-y value, and `false` when passed a truth-y one.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.1.0\n     * @category Logic\n     * @sig * -> Boolean\n     * @param {*} a any value\n     * @return {Boolean} the logical inverse of passed argument.\n     * @see R.complement\n     * @example\n     *\n     *      R.not(true); //=> false\n     *      R.not(false); //=> true\n     *      R.not(0); => true\n     *      R.not(1); => false\n     */\n    var not = _curry1(function not(a) {\n        return !a;\n    });\n\n    /**\n     * Returns the nth element of the given list or string. If n is negative the\n     * element at index length + n is returned.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.1.0\n     * @category List\n     * @sig Number -> [a] -> a | Undefined\n     * @sig Number -> String -> String\n     * @param {Number} offset\n     * @param {*} list\n     * @return {*}\n     * @example\n     *\n     *      var list = ['foo', 'bar', 'baz', 'quux'];\n     *      R.nth(1, list); //=> 'bar'\n     *      R.nth(-1, list); //=> 'quux'\n     *      R.nth(-99, list); //=> undefined\n     *\n     *      R.nth(2, 'abc'); //=> 'c'\n     *      R.nth(3, 'abc'); //=> ''\n     */\n    var nth = _curry2(function nth(offset, list) {\n        var idx = offset < 0 ? list.length + offset : offset;\n        return _isString(list) ? list.charAt(idx) : list[idx];\n    });\n\n    /**\n     * Returns a function which returns its nth argument.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.9.0\n     * @category Function\n     * @sig Number -> *... -> *\n     * @param {Number} n\n     * @return {Function}\n     * @example\n     *\n     *      R.nthArg(1)('a', 'b', 'c'); //=> 'b'\n     *      R.nthArg(-1)('a', 'b', 'c'); //=> 'c'\n     */\n    var nthArg = _curry1(function nthArg(n) {\n        return function () {\n            return nth(n, arguments);\n        };\n    });\n\n    /**\n     * Creates an object containing a single key:value pair.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.18.0\n     * @category Object\n     * @sig String -> a -> {String:a}\n     * @param {String} key\n     * @param {*} val\n     * @return {Object}\n     * @see R.pair\n     * @example\n     *\n     *      var matchPhrases = R.compose(\n     *        R.objOf('must'),\n     *        R.map(R.objOf('match_phrase'))\n     *      );\n     *      matchPhrases(['foo', 'bar', 'baz']); //=> {must: [{match_phrase: 'foo'}, {match_phrase: 'bar'}, {match_phrase: 'baz'}]}\n     */\n    var objOf = _curry2(function objOf(key, val) {\n        var obj = {};\n        obj[key] = val;\n        return obj;\n    });\n\n    /**\n     * Returns a singleton array containing the value provided.\n     *\n     * Note this `of` is different from the ES6 `of`; See\n     * https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/of\n     *\n     * @func\n     * @memberOf R\n     * @since v0.3.0\n     * @category Function\n     * @sig a -> [a]\n     * @param {*} x any value\n     * @return {Array} An array wrapping `x`.\n     * @example\n     *\n     *      R.of(null); //=> [null]\n     *      R.of([42]); //=> [[42]]\n     */\n    var of = _curry1(_of);\n\n    /**\n     * Accepts a function `fn` and returns a function that guards invocation of\n     * `fn` such that `fn` can only ever be called once, no matter how many times\n     * the returned function is invoked. The first value calculated is returned in\n     * subsequent invocations.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.1.0\n     * @category Function\n     * @sig (a... -> b) -> (a... -> b)\n     * @param {Function} fn The function to wrap in a call-only-once wrapper.\n     * @return {Function} The wrapped function.\n     * @example\n     *\n     *      var addOneOnce = R.once(x => x + 1);\n     *      addOneOnce(10); //=> 11\n     *      addOneOnce(addOneOnce(50)); //=> 11\n     */\n    var once = _curry1(function once(fn) {\n        var called = false;\n        var result;\n        return _arity(fn.length, function () {\n            if (called) {\n                return result;\n            }\n            called = true;\n            result = fn.apply(this, arguments);\n            return result;\n        });\n    });\n\n    /**\n     * Returns `true` if one or both of its arguments are `true`. Returns `false`\n     * if both arguments are `false`.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.1.0\n     * @category Logic\n     * @sig * -> * -> *\n     * @param {Boolean} a A boolean value\n     * @param {Boolean} b A boolean value\n     * @return {Boolean} `true` if one or both arguments are `true`, `false` otherwise\n     * @see R.either\n     * @example\n     *\n     *      R.or(true, true); //=> true\n     *      R.or(true, false); //=> true\n     *      R.or(false, true); //=> true\n     *      R.or(false, false); //=> false\n     */\n    var or = _curry2(function or(a, b) {\n        return a || b;\n    });\n\n    /**\n     * Returns the result of \"setting\" the portion of the given data structure\n     * focused by the given lens to the result of applying the given function to\n     * the focused value.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.16.0\n     * @category Object\n     * @typedefn Lens s a = Functor f => (a -> f a) -> s -> f s\n     * @sig Lens s a -> (a -> a) -> s -> s\n     * @param {Lens} lens\n     * @param {*} v\n     * @param {*} x\n     * @return {*}\n     * @see R.prop, R.lensIndex, R.lensProp\n     * @example\n     *\n     *      var headLens = R.lensIndex(0);\n     *\n     *      R.over(headLens, R.toUpper, ['foo', 'bar', 'baz']); //=> ['FOO', 'bar', 'baz']\n     */\n    // `Identity` is a functor that holds a single value, where `map` simply\n    // transforms the held value with the provided function.\n    // The value returned by the getter function is first transformed with `f`,\n    // then set as the value of an `Identity`. This is then mapped over with the\n    // setter function of the lens.\n    var over = function () {\n        // `Identity` is a functor that holds a single value, where `map` simply\n        // transforms the held value with the provided function.\n        var Identity = function (x) {\n            return {\n                value: x,\n                map: function (f) {\n                    return Identity(f(x));\n                }\n            };\n        };\n        return _curry3(function over(lens, f, x) {\n            // The value returned by the getter function is first transformed with `f`,\n            // then set as the value of an `Identity`. This is then mapped over with the\n            // setter function of the lens.\n            return lens(function (y) {\n                return Identity(f(y));\n            })(x).value;\n        });\n    }();\n\n    /**\n     * Takes two arguments, `fst` and `snd`, and returns `[fst, snd]`.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.18.0\n     * @category List\n     * @sig a -> b -> (a,b)\n     * @param {*} fst\n     * @param {*} snd\n     * @return {Array}\n     * @see R.objOf, R.of\n     * @example\n     *\n     *      R.pair('foo', 'bar'); //=> ['foo', 'bar']\n     */\n    var pair = _curry2(function pair(fst, snd) {\n        return [\n            fst,\n            snd\n        ];\n    });\n\n    /**\n     * Retrieve the value at a given path.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.2.0\n     * @category Object\n     * @sig [String] -> {k: v} -> v | Undefined\n     * @param {Array} path The path to use.\n     * @param {Object} obj The object to retrieve the nested property from.\n     * @return {*} The data at `path`.\n     * @example\n     *\n     *      R.path(['a', 'b'], {a: {b: 2}}); //=> 2\n     *      R.path(['a', 'b'], {c: {b: 2}}); //=> undefined\n     */\n    var path = _curry2(function path(paths, obj) {\n        var val = obj;\n        var idx = 0;\n        while (idx < paths.length) {\n            if (val == null) {\n                return;\n            }\n            val = val[paths[idx]];\n            idx += 1;\n        }\n        return val;\n    });\n\n    /**\n     * If the given, non-null object has a value at the given path, returns the\n     * value at that path. Otherwise returns the provided default value.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.18.0\n     * @category Object\n     * @sig a -> [String] -> Object -> a\n     * @param {*} d The default value.\n     * @param {Array} p The path to use.\n     * @param {Object} obj The object to retrieve the nested property from.\n     * @return {*} The data at `path` of the supplied object or the default value.\n     * @example\n     *\n     *      R.pathOr('N/A', ['a', 'b'], {a: {b: 2}}); //=> 2\n     *      R.pathOr('N/A', ['a', 'b'], {c: {b: 2}}); //=> \"N/A\"\n     */\n    var pathOr = _curry3(function pathOr(d, p, obj) {\n        return defaultTo(d, path(p, obj));\n    });\n\n    /**\n     * Returns `true` if the specified object property at given path satisfies the\n     * given predicate; `false` otherwise.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.19.0\n     * @category Logic\n     * @sig (a -> Boolean) -> [String] -> Object -> Boolean\n     * @param {Function} pred\n     * @param {Array} propPath\n     * @param {*} obj\n     * @return {Boolean}\n     * @see R.propSatisfies, R.path\n     * @example\n     *\n     *      R.pathSatisfies(y => y > 0, ['x', 'y'], {x: {y: 2}}); //=> true\n     */\n    var pathSatisfies = _curry3(function pathSatisfies(pred, propPath, obj) {\n        return propPath.length > 0 && pred(path(propPath, obj));\n    });\n\n    /**\n     * Returns a partial copy of an object containing only the keys specified. If\n     * the key does not exist, the property is ignored.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.1.0\n     * @category Object\n     * @sig [k] -> {k: v} -> {k: v}\n     * @param {Array} names an array of String property names to copy onto a new object\n     * @param {Object} obj The object to copy from\n     * @return {Object} A new object with only properties from `names` on it.\n     * @see R.omit, R.props\n     * @example\n     *\n     *      R.pick(['a', 'd'], {a: 1, b: 2, c: 3, d: 4}); //=> {a: 1, d: 4}\n     *      R.pick(['a', 'e', 'f'], {a: 1, b: 2, c: 3, d: 4}); //=> {a: 1}\n     */\n    var pick = _curry2(function pick(names, obj) {\n        var result = {};\n        var idx = 0;\n        while (idx < names.length) {\n            if (names[idx] in obj) {\n                result[names[idx]] = obj[names[idx]];\n            }\n            idx += 1;\n        }\n        return result;\n    });\n\n    /**\n     * Similar to `pick` except that this one includes a `key: undefined` pair for\n     * properties that don't exist.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.1.0\n     * @category Object\n     * @sig [k] -> {k: v} -> {k: v}\n     * @param {Array} names an array of String property names to copy onto a new object\n     * @param {Object} obj The object to copy from\n     * @return {Object} A new object with only properties from `names` on it.\n     * @see R.pick\n     * @example\n     *\n     *      R.pickAll(['a', 'd'], {a: 1, b: 2, c: 3, d: 4}); //=> {a: 1, d: 4}\n     *      R.pickAll(['a', 'e', 'f'], {a: 1, b: 2, c: 3, d: 4}); //=> {a: 1, e: undefined, f: undefined}\n     */\n    var pickAll = _curry2(function pickAll(names, obj) {\n        var result = {};\n        var idx = 0;\n        var len = names.length;\n        while (idx < len) {\n            var name = names[idx];\n            result[name] = obj[name];\n            idx += 1;\n        }\n        return result;\n    });\n\n    /**\n     * Returns a partial copy of an object containing only the keys that satisfy\n     * the supplied predicate.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.8.0\n     * @category Object\n     * @sig (v, k -> Boolean) -> {k: v} -> {k: v}\n     * @param {Function} pred A predicate to determine whether or not a key\n     *        should be included on the output object.\n     * @param {Object} obj The object to copy from\n     * @return {Object} A new object with only properties that satisfy `pred`\n     *         on it.\n     * @see R.pick, R.filter\n     * @example\n     *\n     *      var isUpperCase = (val, key) => key.toUpperCase() === key;\n     *      R.pickBy(isUpperCase, {a: 1, b: 2, A: 3, B: 4}); //=> {A: 3, B: 4}\n     */\n    var pickBy = _curry2(function pickBy(test, obj) {\n        var result = {};\n        for (var prop in obj) {\n            if (test(obj[prop], prop, obj)) {\n                result[prop] = obj[prop];\n            }\n        }\n        return result;\n    });\n\n    /**\n     * Returns a new list with the given element at the front, followed by the\n     * contents of the list.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.1.0\n     * @category List\n     * @sig a -> [a] -> [a]\n     * @param {*} el The item to add to the head of the output list.\n     * @param {Array} list The array to add to the tail of the output list.\n     * @return {Array} A new array.\n     * @see R.append\n     * @example\n     *\n     *      R.prepend('fee', ['fi', 'fo', 'fum']); //=> ['fee', 'fi', 'fo', 'fum']\n     */\n    var prepend = _curry2(function prepend(el, list) {\n        return _concat([el], list);\n    });\n\n    /**\n     * Returns a function that when supplied an object returns the indicated\n     * property of that object, if it exists.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.1.0\n     * @category Object\n     * @sig s -> {s: a} -> a | Undefined\n     * @param {String} p The property name\n     * @param {Object} obj The object to query\n     * @return {*} The value at `obj.p`.\n     * @example\n     *\n     *      R.prop('x', {x: 100}); //=> 100\n     *      R.prop('x', {}); //=> undefined\n     */\n    var prop = _curry2(function prop(p, obj) {\n        return obj[p];\n    });\n\n    /**\n     * If the given, non-null object has an own property with the specified name,\n     * returns the value of that property. Otherwise returns the provided default\n     * value.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.6.0\n     * @category Object\n     * @sig a -> String -> Object -> a\n     * @param {*} val The default value.\n     * @param {String} p The name of the property to return.\n     * @param {Object} obj The object to query.\n     * @return {*} The value of given property of the supplied object or the default value.\n     * @example\n     *\n     *      var alice = {\n     *        name: 'ALICE',\n     *        age: 101\n     *      };\n     *      var favorite = R.prop('favoriteLibrary');\n     *      var favoriteWithDefault = R.propOr('Ramda', 'favoriteLibrary');\n     *\n     *      favorite(alice);  //=> undefined\n     *      favoriteWithDefault(alice);  //=> 'Ramda'\n     */\n    var propOr = _curry3(function propOr(val, p, obj) {\n        return obj != null && _has(p, obj) ? obj[p] : val;\n    });\n\n    /**\n     * Returns `true` if the specified object property satisfies the given\n     * predicate; `false` otherwise.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.16.0\n     * @category Logic\n     * @sig (a -> Boolean) -> String -> {String: a} -> Boolean\n     * @param {Function} pred\n     * @param {String} name\n     * @param {*} obj\n     * @return {Boolean}\n     * @see R.propEq, R.propIs\n     * @example\n     *\n     *      R.propSatisfies(x => x > 0, 'x', {x: 1, y: 2}); //=> true\n     */\n    var propSatisfies = _curry3(function propSatisfies(pred, name, obj) {\n        return pred(obj[name]);\n    });\n\n    /**\n     * Acts as multiple `prop`: array of keys in, array of values out. Preserves\n     * order.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.1.0\n     * @category Object\n     * @sig [k] -> {k: v} -> [v]\n     * @param {Array} ps The property names to fetch\n     * @param {Object} obj The object to query\n     * @return {Array} The corresponding values or partially applied function.\n     * @example\n     *\n     *      R.props(['x', 'y'], {x: 1, y: 2}); //=> [1, 2]\n     *      R.props(['c', 'a', 'b'], {b: 2, a: 1}); //=> [undefined, 1, 2]\n     *\n     *      var fullName = R.compose(R.join(' '), R.props(['first', 'last']));\n     *      fullName({last: 'Bullet-Tooth', age: 33, first: 'Tony'}); //=> 'Tony Bullet-Tooth'\n     */\n    var props = _curry2(function props(ps, obj) {\n        var len = ps.length;\n        var out = [];\n        var idx = 0;\n        while (idx < len) {\n            out[idx] = obj[ps[idx]];\n            idx += 1;\n        }\n        return out;\n    });\n\n    /**\n     * Returns a list of numbers from `from` (inclusive) to `to` (exclusive).\n     *\n     * @func\n     * @memberOf R\n     * @since v0.1.0\n     * @category List\n     * @sig Number -> Number -> [Number]\n     * @param {Number} from The first number in the list.\n     * @param {Number} to One more than the last number in the list.\n     * @return {Array} The list of numbers in tthe set `[a, b)`.\n     * @example\n     *\n     *      R.range(1, 5);    //=> [1, 2, 3, 4]\n     *      R.range(50, 53);  //=> [50, 51, 52]\n     */\n    var range = _curry2(function range(from, to) {\n        if (!(_isNumber(from) && _isNumber(to))) {\n            throw new TypeError('Both arguments to range must be numbers');\n        }\n        var result = [];\n        var n = from;\n        while (n < to) {\n            result.push(n);\n            n += 1;\n        }\n        return result;\n    });\n\n    /**\n     * Returns a single item by iterating through the list, successively calling\n     * the iterator function and passing it an accumulator value and the current\n     * value from the array, and then passing the result to the next call.\n     *\n     * Similar to `reduce`, except moves through the input list from the right to\n     * the left.\n     *\n     * The iterator function receives two values: *(acc, value)*\n     *\n     * Note: `R.reduceRight` does not skip deleted or unassigned indices (sparse\n     * arrays), unlike the native `Array.prototype.reduce` method. For more details\n     * on this behavior, see:\n     * https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/reduceRight#Description\n     *\n     * @func\n     * @memberOf R\n     * @since v0.1.0\n     * @category List\n     * @sig (a,b -> a) -> a -> [b] -> a\n     * @param {Function} fn The iterator function. Receives two values, the accumulator and the\n     *        current element from the array.\n     * @param {*} acc The accumulator value.\n     * @param {Array} list The list to iterate over.\n     * @return {*} The final, accumulated value.\n     * @see R.addIndex\n     * @example\n     *\n     *      var pairs = [ ['a', 1], ['b', 2], ['c', 3] ];\n     *      var flattenPairs = (acc, pair) => acc.concat(pair);\n     *\n     *      R.reduceRight(flattenPairs, [], pairs); //=> [ 'c', 3, 'b', 2, 'a', 1 ]\n     */\n    var reduceRight = _curry3(function reduceRight(fn, acc, list) {\n        var idx = list.length - 1;\n        while (idx >= 0) {\n            acc = fn(acc, list[idx]);\n            idx -= 1;\n        }\n        return acc;\n    });\n\n    /**\n     * Returns a value wrapped to indicate that it is the final value of the reduce\n     * and transduce functions. The returned value should be considered a black\n     * box: the internal structure is not guaranteed to be stable.\n     *\n     * Note: this optimization is unavailable to functions not explicitly listed\n     * above. For instance, it is not currently supported by reduceRight.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.15.0\n     * @category List\n     * @sig a -> *\n     * @param {*} x The final value of the reduce.\n     * @return {*} The wrapped value.\n     * @see R.reduce, R.transduce\n     * @example\n     *\n     *      R.reduce(\n     *        R.pipe(R.add, R.when(R.gte(R.__, 10), R.reduced)),\n     *        0,\n     *        [1, 2, 3, 4, 5]) // 10\n     */\n    var reduced = _curry1(_reduced);\n\n    /**\n     * Removes the sub-list of `list` starting at index `start` and containing\n     * `count` elements. _Note that this is not destructive_: it returns a copy of\n     * the list with the changes.\n     * <small>No lists have been harmed in the application of this function.</small>\n     *\n     * @func\n     * @memberOf R\n     * @since v0.2.2\n     * @category List\n     * @sig Number -> Number -> [a] -> [a]\n     * @param {Number} start The position to start removing elements\n     * @param {Number} count The number of elements to remove\n     * @param {Array} list The list to remove from\n     * @return {Array} A new Array with `count` elements from `start` removed.\n     * @example\n     *\n     *      R.remove(2, 3, [1,2,3,4,5,6,7,8]); //=> [1,2,6,7,8]\n     */\n    var remove = _curry3(function remove(start, count, list) {\n        return _concat(_slice(list, 0, Math.min(start, list.length)), _slice(list, Math.min(list.length, start + count)));\n    });\n\n    /**\n     * Replace a substring or regex match in a string with a replacement.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.7.0\n     * @category String\n     * @sig RegExp|String -> String -> String -> String\n     * @param {RegExp|String} pattern A regular expression or a substring to match.\n     * @param {String} replacement The string to replace the matches with.\n     * @param {String} str The String to do the search and replacement in.\n     * @return {String} The result.\n     * @example\n     *\n     *      R.replace('foo', 'bar', 'foo foo foo'); //=> 'bar foo foo'\n     *      R.replace(/foo/, 'bar', 'foo foo foo'); //=> 'bar foo foo'\n     *\n     *      // Use the \"g\" (global) flag to replace all occurrences:\n     *      R.replace(/foo/g, 'bar', 'foo foo foo'); //=> 'bar bar bar'\n     */\n    var replace = _curry3(function replace(regex, replacement, str) {\n        return str.replace(regex, replacement);\n    });\n\n    /**\n     * Returns a new list or string with the elements or characters in reverse\n     * order.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.1.0\n     * @category List\n     * @sig [a] -> [a]\n     * @sig String -> String\n     * @param {Array|String} list\n     * @return {Array|String}\n     * @example\n     *\n     *      R.reverse([1, 2, 3]);  //=> [3, 2, 1]\n     *      R.reverse([1, 2]);     //=> [2, 1]\n     *      R.reverse([1]);        //=> [1]\n     *      R.reverse([]);         //=> []\n     *\n     *      R.reverse('abc');      //=> 'cba'\n     *      R.reverse('ab');       //=> 'ba'\n     *      R.reverse('a');        //=> 'a'\n     *      R.reverse('');         //=> ''\n     */\n    var reverse = _curry1(function reverse(list) {\n        return _isString(list) ? list.split('').reverse().join('') : _slice(list).reverse();\n    });\n\n    /**\n     * Scan is similar to reduce, but returns a list of successively reduced values\n     * from the left\n     *\n     * @func\n     * @memberOf R\n     * @since v0.10.0\n     * @category List\n     * @sig (a,b -> a) -> a -> [b] -> [a]\n     * @param {Function} fn The iterator function. Receives two values, the accumulator and the\n     *        current element from the array\n     * @param {*} acc The accumulator value.\n     * @param {Array} list The list to iterate over.\n     * @return {Array} A list of all intermediately reduced values.\n     * @example\n     *\n     *      var numbers = [1, 2, 3, 4];\n     *      var factorials = R.scan(R.multiply, 1, numbers); //=> [1, 1, 2, 6, 24]\n     */\n    var scan = _curry3(function scan(fn, acc, list) {\n        var idx = 0;\n        var len = list.length;\n        var result = [acc];\n        while (idx < len) {\n            acc = fn(acc, list[idx]);\n            result[idx + 1] = acc;\n            idx += 1;\n        }\n        return result;\n    });\n\n    /**\n     * Returns the result of \"setting\" the portion of the given data structure\n     * focused by the given lens to the given value.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.16.0\n     * @category Object\n     * @typedefn Lens s a = Functor f => (a -> f a) -> s -> f s\n     * @sig Lens s a -> a -> s -> s\n     * @param {Lens} lens\n     * @param {*} v\n     * @param {*} x\n     * @return {*}\n     * @see R.prop, R.lensIndex, R.lensProp\n     * @example\n     *\n     *      var xLens = R.lensProp('x');\n     *\n     *      R.set(xLens, 4, {x: 1, y: 2});  //=> {x: 4, y: 2}\n     *      R.set(xLens, 8, {x: 1, y: 2});  //=> {x: 8, y: 2}\n     */\n    var set = _curry3(function set(lens, v, x) {\n        return over(lens, always(v), x);\n    });\n\n    /**\n     * Returns the elements of the given list or string (or object with a `slice`\n     * method) from `fromIndex` (inclusive) to `toIndex` (exclusive).\n     *\n     * Dispatches to the `slice` method of the third argument, if present.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.1.4\n     * @category List\n     * @sig Number -> Number -> [a] -> [a]\n     * @sig Number -> Number -> String -> String\n     * @param {Number} fromIndex The start index (inclusive).\n     * @param {Number} toIndex The end index (exclusive).\n     * @param {*} list\n     * @return {*}\n     * @example\n     *\n     *      R.slice(1, 3, ['a', 'b', 'c', 'd']);        //=> ['b', 'c']\n     *      R.slice(1, Infinity, ['a', 'b', 'c', 'd']); //=> ['b', 'c', 'd']\n     *      R.slice(0, -1, ['a', 'b', 'c', 'd']);       //=> ['a', 'b', 'c']\n     *      R.slice(-3, -1, ['a', 'b', 'c', 'd']);      //=> ['b', 'c']\n     *      R.slice(0, 3, 'ramda');                     //=> 'ram'\n     */\n    var slice = _curry3(_checkForMethod('slice', function slice(fromIndex, toIndex, list) {\n        return Array.prototype.slice.call(list, fromIndex, toIndex);\n    }));\n\n    /**\n     * Returns a copy of the list, sorted according to the comparator function,\n     * which should accept two values at a time and return a negative number if the\n     * first value is smaller, a positive number if it's larger, and zero if they\n     * are equal. Please note that this is a **copy** of the list. It does not\n     * modify the original.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.1.0\n     * @category List\n     * @sig (a,a -> Number) -> [a] -> [a]\n     * @param {Function} comparator A sorting function :: a -> b -> Int\n     * @param {Array} list The list to sort\n     * @return {Array} a new array with its elements sorted by the comparator function.\n     * @example\n     *\n     *      var diff = function(a, b) { return a - b; };\n     *      R.sort(diff, [4,2,7,5]); //=> [2, 4, 5, 7]\n     */\n    var sort = _curry2(function sort(comparator, list) {\n        return _slice(list).sort(comparator);\n    });\n\n    /**\n     * Sorts the list according to the supplied function.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.1.0\n     * @category Relation\n     * @sig Ord b => (a -> b) -> [a] -> [a]\n     * @param {Function} fn\n     * @param {Array} list The list to sort.\n     * @return {Array} A new list sorted by the keys generated by `fn`.\n     * @example\n     *\n     *      var sortByFirstItem = R.sortBy(R.prop(0));\n     *      var sortByNameCaseInsensitive = R.sortBy(R.compose(R.toLower, R.prop('name')));\n     *      var pairs = [[-1, 1], [-2, 2], [-3, 3]];\n     *      sortByFirstItem(pairs); //=> [[-3, 3], [-2, 2], [-1, 1]]\n     *      var alice = {\n     *        name: 'ALICE',\n     *        age: 101\n     *      };\n     *      var bob = {\n     *        name: 'Bob',\n     *        age: -10\n     *      };\n     *      var clara = {\n     *        name: 'clara',\n     *        age: 314.159\n     *      };\n     *      var people = [clara, bob, alice];\n     *      sortByNameCaseInsensitive(people); //=> [alice, bob, clara]\n     */\n    var sortBy = _curry2(function sortBy(fn, list) {\n        return _slice(list).sort(function (a, b) {\n            var aa = fn(a);\n            var bb = fn(b);\n            return aa < bb ? -1 : aa > bb ? 1 : 0;\n        });\n    });\n\n    /**\n     * Splits a given list or string at a given index.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.19.0\n     * @category List\n     * @sig Number -> [a] -> [[a], [a]]\n     * @sig Number -> String -> [String, String]\n     * @param {Number} index The index where the array/string is split.\n     * @param {Array|String} array The array/string to be split.\n     * @return {Array}\n     * @example\n     *\n     *      R.splitAt(1, [1, 2, 3]);          //=> [[1], [2, 3]]\n     *      R.splitAt(5, 'hello world');      //=> ['hello', ' world']\n     *      R.splitAt(-1, 'foobar');          //=> ['fooba', 'r']\n     */\n    var splitAt = _curry2(function splitAt(index, array) {\n        return [\n            slice(0, index, array),\n            slice(index, length(array), array)\n        ];\n    });\n\n    /**\n     * Splits a collection into slices of the specified length.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.16.0\n     * @category List\n     * @sig Number -> [a] -> [[a]]\n     * @sig Number -> String -> [String]\n     * @param {Number} n\n     * @param {Array} list\n     * @return {Array}\n     * @example\n     *\n     *      R.splitEvery(3, [1, 2, 3, 4, 5, 6, 7]); //=> [[1, 2, 3], [4, 5, 6], [7]]\n     *      R.splitEvery(3, 'foobarbaz'); //=> ['foo', 'bar', 'baz']\n     */\n    var splitEvery = _curry2(function splitEvery(n, list) {\n        if (n <= 0) {\n            throw new Error('First argument to splitEvery must be a positive integer');\n        }\n        var result = [];\n        var idx = 0;\n        while (idx < list.length) {\n            result.push(slice(idx, idx += n, list));\n        }\n        return result;\n    });\n\n    /**\n     * Takes a list and a predicate and returns a pair of lists with the following properties:\n     *\n     *  - the result of concatenating the two output lists is equivalent to the input list;\n     *  - none of the elements of the first output list satisfies the predicate; and\n     *  - if the second output list is non-empty, its first element satisfies the predicate.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.19.0\n     * @category List\n     * @sig (a -> Boolean) -> [a] -> [[a], [a]]\n     * @param {Function} pred The predicate that determines where the array is split.\n     * @param {Array} list The array to be split.\n     * @return {Array}\n     * @example\n     *\n     *      R.splitWhen(R.equals(2), [1, 2, 3, 1, 2, 3]);   //=> [[1], [2, 3, 1, 2, 3]]\n     */\n    var splitWhen = _curry2(function splitWhen(pred, list) {\n        var idx = 0;\n        var len = list.length;\n        var prefix = [];\n        while (idx < len && !pred(list[idx])) {\n            prefix.push(list[idx]);\n            idx += 1;\n        }\n        return [\n            prefix,\n            _slice(list, idx)\n        ];\n    });\n\n    /**\n     * Subtracts its second argument from its first argument.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.1.0\n     * @category Math\n     * @sig Number -> Number -> Number\n     * @param {Number} a The first value.\n     * @param {Number} b The second value.\n     * @return {Number} The result of `a - b`.\n     * @see R.add\n     * @example\n     *\n     *      R.subtract(10, 8); //=> 2\n     *\n     *      var minus5 = R.subtract(R.__, 5);\n     *      minus5(17); //=> 12\n     *\n     *      var complementaryAngle = R.subtract(90);\n     *      complementaryAngle(30); //=> 60\n     *      complementaryAngle(72); //=> 18\n     */\n    var subtract = _curry2(function subtract(a, b) {\n        return Number(a) - Number(b);\n    });\n\n    /**\n     * Returns all but the first element of the given list or string (or object\n     * with a `tail` method).\n     *\n     * Dispatches to the `slice` method of the first argument, if present.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.1.0\n     * @category List\n     * @sig [a] -> [a]\n     * @sig String -> String\n     * @param {*} list\n     * @return {*}\n     * @see R.head, R.init, R.last\n     * @example\n     *\n     *      R.tail([1, 2, 3]);  //=> [2, 3]\n     *      R.tail([1, 2]);     //=> [2]\n     *      R.tail([1]);        //=> []\n     *      R.tail([]);         //=> []\n     *\n     *      R.tail('abc');  //=> 'bc'\n     *      R.tail('ab');   //=> 'b'\n     *      R.tail('a');    //=> ''\n     *      R.tail('');     //=> ''\n     */\n    var tail = _checkForMethod('tail', slice(1, Infinity));\n\n    /**\n     * Returns the first `n` elements of the given list, string, or\n     * transducer/transformer (or object with a `take` method).\n     *\n     * Dispatches to the `take` method of the second argument, if present.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.1.0\n     * @category List\n     * @sig Number -> [a] -> [a]\n     * @sig Number -> String -> String\n     * @param {Number} n\n     * @param {*} list\n     * @return {*}\n     * @see R.drop\n     * @example\n     *\n     *      R.take(1, ['foo', 'bar', 'baz']); //=> ['foo']\n     *      R.take(2, ['foo', 'bar', 'baz']); //=> ['foo', 'bar']\n     *      R.take(3, ['foo', 'bar', 'baz']); //=> ['foo', 'bar', 'baz']\n     *      R.take(4, ['foo', 'bar', 'baz']); //=> ['foo', 'bar', 'baz']\n     *      R.take(3, 'ramda');               //=> 'ram'\n     *\n     *      var personnel = [\n     *        'Dave Brubeck',\n     *        'Paul Desmond',\n     *        'Eugene Wright',\n     *        'Joe Morello',\n     *        'Gerry Mulligan',\n     *        'Bob Bates',\n     *        'Joe Dodge',\n     *        'Ron Crotty'\n     *      ];\n     *\n     *      var takeFive = R.take(5);\n     *      takeFive(personnel);\n     *      //=> ['Dave Brubeck', 'Paul Desmond', 'Eugene Wright', 'Joe Morello', 'Gerry Mulligan']\n     */\n    var take = _curry2(_dispatchable('take', _xtake, function take(n, xs) {\n        return slice(0, n < 0 ? Infinity : n, xs);\n    }));\n\n    /**\n     * Returns a new list containing the last `n` elements of a given list, passing\n     * each value to the supplied predicate function, and terminating when the\n     * predicate function returns `false`. Excludes the element that caused the\n     * predicate function to fail. The predicate function is passed one argument:\n     * *(value)*.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.16.0\n     * @category List\n     * @sig (a -> Boolean) -> [a] -> [a]\n     * @param {Function} fn The function called per iteration.\n     * @param {Array} list The collection to iterate over.\n     * @return {Array} A new array.\n     * @see R.dropLastWhile, R.addIndex\n     * @example\n     *\n     *      var isNotOne = x => x !== 1;\n     *\n     *      R.takeLastWhile(isNotOne, [1, 2, 3, 4]); //=> [2, 3, 4]\n     */\n    var takeLastWhile = _curry2(function takeLastWhile(fn, list) {\n        var idx = list.length - 1;\n        while (idx >= 0 && fn(list[idx])) {\n            idx -= 1;\n        }\n        return _slice(list, idx + 1, Infinity);\n    });\n\n    /**\n     * Returns a new list containing the first `n` elements of a given list,\n     * passing each value to the supplied predicate function, and terminating when\n     * the predicate function returns `false`. Excludes the element that caused the\n     * predicate function to fail. The predicate function is passed one argument:\n     * *(value)*.\n     *\n     * Dispatches to the `takeWhile` method of the second argument, if present.\n     *\n     * Acts as a transducer if a transformer is given in list position.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.1.0\n     * @category List\n     * @sig (a -> Boolean) -> [a] -> [a]\n     * @param {Function} fn The function called per iteration.\n     * @param {Array} list The collection to iterate over.\n     * @return {Array} A new array.\n     * @see R.dropWhile, R.transduce, R.addIndex\n     * @example\n     *\n     *      var isNotFour = x => x !== 4;\n     *\n     *      R.takeWhile(isNotFour, [1, 2, 3, 4, 3, 2, 1]); //=> [1, 2, 3]\n     */\n    var takeWhile = _curry2(_dispatchable('takeWhile', _xtakeWhile, function takeWhile(fn, list) {\n        var idx = 0;\n        var len = list.length;\n        while (idx < len && fn(list[idx])) {\n            idx += 1;\n        }\n        return _slice(list, 0, idx);\n    }));\n\n    /**\n     * Runs the given function with the supplied object, then returns the object.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.1.0\n     * @category Function\n     * @sig (a -> *) -> a -> a\n     * @param {Function} fn The function to call with `x`. The return value of `fn` will be thrown away.\n     * @param {*} x\n     * @return {*} `x`.\n     * @example\n     *\n     *      var sayX = x => console.log('x is ' + x);\n     *      R.tap(sayX, 100); //=> 100\n     *      //-> 'x is 100'\n     */\n    var tap = _curry2(function tap(fn, x) {\n        fn(x);\n        return x;\n    });\n\n    /**\n     * Calls an input function `n` times, returning an array containing the results\n     * of those function calls.\n     *\n     * `fn` is passed one argument: The current value of `n`, which begins at `0`\n     * and is gradually incremented to `n - 1`.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.2.3\n     * @category List\n     * @sig (Number -> a) -> Number -> [a]\n     * @param {Function} fn The function to invoke. Passed one argument, the current value of `n`.\n     * @param {Number} n A value between `0` and `n - 1`. Increments after each function call.\n     * @return {Array} An array containing the return values of all calls to `fn`.\n     * @example\n     *\n     *      R.times(R.identity, 5); //=> [0, 1, 2, 3, 4]\n     */\n    var times = _curry2(function times(fn, n) {\n        var len = Number(n);\n        var idx = 0;\n        var list;\n        if (len < 0 || isNaN(len)) {\n            throw new RangeError('n must be a non-negative number');\n        }\n        list = new Array(len);\n        while (idx < len) {\n            list[idx] = fn(idx);\n            idx += 1;\n        }\n        return list;\n    });\n\n    /**\n     * Converts an object into an array of key, value arrays. Only the object's\n     * own properties are used.\n     * Note that the order of the output array is not guaranteed to be consistent\n     * across different JS platforms.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.4.0\n     * @category Object\n     * @sig {String: *} -> [[String,*]]\n     * @param {Object} obj The object to extract from\n     * @return {Array} An array of key, value arrays from the object's own properties.\n     * @see R.fromPairs\n     * @example\n     *\n     *      R.toPairs({a: 1, b: 2, c: 3}); //=> [['a', 1], ['b', 2], ['c', 3]]\n     */\n    var toPairs = _curry1(function toPairs(obj) {\n        var pairs = [];\n        for (var prop in obj) {\n            if (_has(prop, obj)) {\n                pairs[pairs.length] = [\n                    prop,\n                    obj[prop]\n                ];\n            }\n        }\n        return pairs;\n    });\n\n    /**\n     * Converts an object into an array of key, value arrays. The object's own\n     * properties and prototype properties are used. Note that the order of the\n     * output array is not guaranteed to be consistent across different JS\n     * platforms.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.4.0\n     * @category Object\n     * @sig {String: *} -> [[String,*]]\n     * @param {Object} obj The object to extract from\n     * @return {Array} An array of key, value arrays from the object's own\n     *         and prototype properties.\n     * @example\n     *\n     *      var F = function() { this.x = 'X'; };\n     *      F.prototype.y = 'Y';\n     *      var f = new F();\n     *      R.toPairsIn(f); //=> [['x','X'], ['y','Y']]\n     */\n    var toPairsIn = _curry1(function toPairsIn(obj) {\n        var pairs = [];\n        for (var prop in obj) {\n            pairs[pairs.length] = [\n                prop,\n                obj[prop]\n            ];\n        }\n        return pairs;\n    });\n\n    /**\n     * Transposes the rows and columns of a 2D list.\n     * When passed a list of `n` lists of length `x`,\n     * returns a list of `x` lists of length `n`.\n     *\n     *\n     * @func\n     * @memberOf R\n     * @since v0.19.0\n     * @category List\n     * @sig [[a]] -> [[a]]\n     * @param {Array} list A 2D list\n     * @return {Array} A 2D list\n     * @example\n     *\n     *      R.transpose([[1, 'a'], [2, 'b'], [3, 'c']]) //=> [[1, 2, 3], ['a', 'b', 'c']]\n     *      R.transpose([[1, 2, 3], ['a', 'b', 'c']]) //=> [[1, 'a'], [2, 'b'], [3, 'c']]\n     *\n     * If some of the rows are shorter than the following rows, their elements are skipped:\n     *\n     *      R.transpose([[10, 11], [20], [], [30, 31, 32]]) //=> [[10, 20, 30], [11, 31], [32]]\n     */\n    var transpose = _curry1(function transpose(outerlist) {\n        var i = 0;\n        var result = [];\n        while (i < outerlist.length) {\n            var innerlist = outerlist[i];\n            var j = 0;\n            while (j < innerlist.length) {\n                if (typeof result[j] === 'undefined') {\n                    result[j] = [];\n                }\n                result[j].push(innerlist[j]);\n                j += 1;\n            }\n            i += 1;\n        }\n        return result;\n    });\n\n    /**\n     * Removes (strips) whitespace from both ends of the string.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.6.0\n     * @category String\n     * @sig String -> String\n     * @param {String} str The string to trim.\n     * @return {String} Trimmed version of `str`.\n     * @example\n     *\n     *      R.trim('   xyz  '); //=> 'xyz'\n     *      R.map(R.trim, R.split(',', 'x, y, z')); //=> ['x', 'y', 'z']\n     */\n    var trim = function () {\n        var ws = '\\t\\n\\x0B\\f\\r \\xA0\\u1680\\u180E\\u2000\\u2001\\u2002\\u2003' + '\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200A\\u202F\\u205F\\u3000\\u2028' + '\\u2029\\uFEFF';\n        var zeroWidth = '\\u200B';\n        var hasProtoTrim = typeof String.prototype.trim === 'function';\n        if (!hasProtoTrim || (ws.trim() || !zeroWidth.trim())) {\n            return _curry1(function trim(str) {\n                var beginRx = new RegExp('^[' + ws + '][' + ws + ']*');\n                var endRx = new RegExp('[' + ws + '][' + ws + ']*$');\n                return str.replace(beginRx, '').replace(endRx, '');\n            });\n        } else {\n            return _curry1(function trim(str) {\n                return str.trim();\n            });\n        }\n    }();\n\n    /**\n     * `tryCatch` takes two functions, a `tryer` and a `catcher`. The returned\n     * function evaluates the `tryer`; if it does not throw, it simply returns the\n     * result. If the `tryer` *does* throw, the returned function evaluates the\n     * `catcher` function and returns its result. Note that for effective\n     * composition with this function, both the `tryer` and `catcher` functions\n     * must return the same type of results.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.20.0\n     * @category Function\n     * @sig (...x -> a) -> ((e, ...x) -> a) -> (...x -> a)\n     * @param {Function} tryer The function that may throw.\n     * @param {Function} catcher The function that will be evaluated if `tryer` throws.\n     * @return {Function} A new function that will catch exceptions and send then to the catcher.\n     * @example\n     *\n     *      R.tryCatch(R.prop('x'), R.F, {x: true}); //=> true\n     *      R.tryCatch(R.prop('x'), R.F, null);      //=> false\n     */\n    var tryCatch = _curry2(function _tryCatch(tryer, catcher) {\n        return _arity(tryer.length, function () {\n            try {\n                return tryer.apply(this, arguments);\n            } catch (e) {\n                return catcher.apply(this, _concat([e], arguments));\n            }\n        });\n    });\n\n    /**\n     * Gives a single-word string description of the (native) type of a value,\n     * returning such answers as 'Object', 'Number', 'Array', or 'Null'. Does not\n     * attempt to distinguish user Object types any further, reporting them all as\n     * 'Object'.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.8.0\n     * @category Type\n     * @sig (* -> {*}) -> String\n     * @param {*} val The value to test\n     * @return {String}\n     * @example\n     *\n     *      R.type({}); //=> \"Object\"\n     *      R.type(1); //=> \"Number\"\n     *      R.type(false); //=> \"Boolean\"\n     *      R.type('s'); //=> \"String\"\n     *      R.type(null); //=> \"Null\"\n     *      R.type([]); //=> \"Array\"\n     *      R.type(/[A-z]/); //=> \"RegExp\"\n     */\n    var type = _curry1(function type(val) {\n        return val === null ? 'Null' : val === undefined ? 'Undefined' : Object.prototype.toString.call(val).slice(8, -1);\n    });\n\n    /**\n     * Takes a function `fn`, which takes a single array argument, and returns a\n     * function which:\n     *\n     *   - takes any number of positional arguments;\n     *   - passes these arguments to `fn` as an array; and\n     *   - returns the result.\n     *\n     * In other words, R.unapply derives a variadic function from a function which\n     * takes an array. R.unapply is the inverse of R.apply.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.8.0\n     * @category Function\n     * @sig ([*...] -> a) -> (*... -> a)\n     * @param {Function} fn\n     * @return {Function}\n     * @see R.apply\n     * @example\n     *\n     *      R.unapply(JSON.stringify)(1, 2, 3); //=> '[1,2,3]'\n     */\n    var unapply = _curry1(function unapply(fn) {\n        return function () {\n            return fn(_slice(arguments));\n        };\n    });\n\n    /**\n     * Wraps a function of any arity (including nullary) in a function that accepts\n     * exactly 1 parameter. Any extraneous parameters will not be passed to the\n     * supplied function.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.2.0\n     * @category Function\n     * @sig (* -> b) -> (a -> b)\n     * @param {Function} fn The function to wrap.\n     * @return {Function} A new function wrapping `fn`. The new function is guaranteed to be of\n     *         arity 1.\n     * @example\n     *\n     *      var takesTwoArgs = function(a, b) {\n     *        return [a, b];\n     *      };\n     *      takesTwoArgs.length; //=> 2\n     *      takesTwoArgs(1, 2); //=> [1, 2]\n     *\n     *      var takesOneArg = R.unary(takesTwoArgs);\n     *      takesOneArg.length; //=> 1\n     *      // Only 1 argument is passed to the wrapped function\n     *      takesOneArg(1, 2); //=> [1, undefined]\n     */\n    var unary = _curry1(function unary(fn) {\n        return nAry(1, fn);\n    });\n\n    /**\n     * Returns a function of arity `n` from a (manually) curried function.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.14.0\n     * @category Function\n     * @sig Number -> (a -> b) -> (a -> c)\n     * @param {Number} length The arity for the returned function.\n     * @param {Function} fn The function to uncurry.\n     * @return {Function} A new function.\n     * @see R.curry\n     * @example\n     *\n     *      var addFour = a => b => c => d => a + b + c + d;\n     *\n     *      var uncurriedAddFour = R.uncurryN(4, addFour);\n     *      uncurriedAddFour(1, 2, 3, 4); //=> 10\n     */\n    var uncurryN = _curry2(function uncurryN(depth, fn) {\n        return curryN(depth, function () {\n            var currentDepth = 1;\n            var value = fn;\n            var idx = 0;\n            var endIdx;\n            while (currentDepth <= depth && typeof value === 'function') {\n                endIdx = currentDepth === depth ? arguments.length : idx + value.length;\n                value = value.apply(this, _slice(arguments, idx, endIdx));\n                currentDepth += 1;\n                idx = endIdx;\n            }\n            return value;\n        });\n    });\n\n    /**\n     * Builds a list from a seed value. Accepts an iterator function, which returns\n     * either false to stop iteration or an array of length 2 containing the value\n     * to add to the resulting list and the seed to be used in the next call to the\n     * iterator function.\n     *\n     * The iterator function receives one argument: *(seed)*.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.10.0\n     * @category List\n     * @sig (a -> [b]) -> * -> [b]\n     * @param {Function} fn The iterator function. receives one argument, `seed`, and returns\n     *        either false to quit iteration or an array of length two to proceed. The element\n     *        at index 0 of this array will be added to the resulting array, and the element\n     *        at index 1 will be passed to the next call to `fn`.\n     * @param {*} seed The seed value.\n     * @return {Array} The final list.\n     * @example\n     *\n     *      var f = n => n > 50 ? false : [-n, n + 10];\n     *      R.unfold(f, 10); //=> [-10, -20, -30, -40, -50]\n     */\n    var unfold = _curry2(function unfold(fn, seed) {\n        var pair = fn(seed);\n        var result = [];\n        while (pair && pair.length) {\n            result[result.length] = pair[0];\n            pair = fn(pair[1]);\n        }\n        return result;\n    });\n\n    /**\n     * Returns a new list containing only one copy of each element in the original\n     * list, based upon the value returned by applying the supplied predicate to\n     * two list elements. Prefers the first item if two items compare equal based\n     * on the predicate.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.2.0\n     * @category List\n     * @sig (a, a -> Boolean) -> [a] -> [a]\n     * @param {Function} pred A predicate used to test whether two items are equal.\n     * @param {Array} list The array to consider.\n     * @return {Array} The list of unique items.\n     * @example\n     *\n     *      var strEq = R.eqBy(String);\n     *      R.uniqWith(strEq)([1, '1', 2, 1]); //=> [1, 2]\n     *      R.uniqWith(strEq)([{}, {}]);       //=> [{}]\n     *      R.uniqWith(strEq)([1, '1', 1]);    //=> [1]\n     *      R.uniqWith(strEq)(['1', 1, 1]);    //=> ['1']\n     */\n    var uniqWith = _curry2(function uniqWith(pred, list) {\n        var idx = 0;\n        var len = list.length;\n        var result = [];\n        var item;\n        while (idx < len) {\n            item = list[idx];\n            if (!_containsWith(pred, item, result)) {\n                result[result.length] = item;\n            }\n            idx += 1;\n        }\n        return result;\n    });\n\n    /**\n     * Tests the final argument by passing it to the given predicate function. If\n     * the predicate is not satisfied, the function will return the result of\n     * calling the `whenFalseFn` function with the same argument. If the predicate\n     * is satisfied, the argument is returned as is.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.18.0\n     * @category Logic\n     * @sig (a -> Boolean) -> (a -> a) -> a -> a\n     * @param {Function} pred        A predicate function\n     * @param {Function} whenFalseFn A function to invoke when the `pred` evaluates\n     *                               to a falsy value.\n     * @param {*}        x           An object to test with the `pred` function and\n     *                               pass to `whenFalseFn` if necessary.\n     * @return {*} Either `x` or the result of applying `x` to `whenFalseFn`.\n     * @see R.ifElse, R.when\n     * @example\n     *\n     *      // coerceArray :: (a|[a]) -> [a]\n     *      var coerceArray = R.unless(R.isArrayLike, R.of);\n     *      coerceArray([1, 2, 3]); //=> [1, 2, 3]\n     *      coerceArray(1);         //=> [1]\n     */\n    var unless = _curry3(function unless(pred, whenFalseFn, x) {\n        return pred(x) ? x : whenFalseFn(x);\n    });\n\n    /**\n     * Takes a predicate, a transformation function, and an initial value,\n     * and returns a value of the same type as the initial value.\n     * It does so by applying the transformation until the predicate is satisfied,\n     * at which point it returns the satisfactory value.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.20.0\n     * @category Logic\n     * @sig (a -> Boolean) -> (a -> a) -> a -> a\n     * @param {Function} pred A predicate function\n     * @param {Function} fn The iterator function\n     * @param {*} init Initial value\n     * @return {*} Final value that satisfies predicate\n     * @example\n     *\n     *      R.until(R.gt(R.__, 100), R.multiply(2))(1) // => 128\n     */\n    var until = _curry3(function until(pred, fn, init) {\n        var val = init;\n        while (!pred(val)) {\n            val = fn(val);\n        }\n        return val;\n    });\n\n    /**\n     * Returns a new copy of the array with the element at the provided index\n     * replaced with the given value.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.14.0\n     * @category List\n     * @sig Number -> a -> [a] -> [a]\n     * @param {Number} idx The index to update.\n     * @param {*} x The value to exist at the given index of the returned array.\n     * @param {Array|Arguments} list The source array-like object to be updated.\n     * @return {Array} A copy of `list` with the value at index `idx` replaced with `x`.\n     * @see R.adjust\n     * @example\n     *\n     *      R.update(1, 11, [0, 1, 2]);     //=> [0, 11, 2]\n     *      R.update(1)(11)([0, 1, 2]);     //=> [0, 11, 2]\n     */\n    var update = _curry3(function update(idx, x, list) {\n        return adjust(always(x), idx, list);\n    });\n\n    /**\n     * Accepts a function `fn` and a list of transformer functions and returns a\n     * new curried function. When the new function is invoked, it calls the\n     * function `fn` with parameters consisting of the result of calling each\n     * supplied handler on successive arguments to the new function.\n     *\n     * If more arguments are passed to the returned function than transformer\n     * functions, those arguments are passed directly to `fn` as additional\n     * parameters. If you expect additional arguments that don't need to be\n     * transformed, although you can ignore them, it's best to pass an identity\n     * function so that the new function reports the correct arity.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.1.0\n     * @category Function\n     * @sig (x1 -> x2 -> ... -> z) -> [(a -> x1), (b -> x2), ...] -> (a -> b -> ... -> z)\n     * @param {Function} fn The function to wrap.\n     * @param {Array} transformers A list of transformer functions\n     * @return {Function} The wrapped function.\n     * @example\n     *\n     *      R.useWith(Math.pow, [R.identity, R.identity])(3, 4); //=> 81\n     *      R.useWith(Math.pow, [R.identity, R.identity])(3)(4); //=> 81\n     *      R.useWith(Math.pow, [R.dec, R.inc])(3, 4); //=> 32\n     *      R.useWith(Math.pow, [R.dec, R.inc])(3)(4); //=> 32\n     */\n    var useWith = _curry2(function useWith(fn, transformers) {\n        return curryN(transformers.length, function () {\n            var args = [];\n            var idx = 0;\n            while (idx < transformers.length) {\n                args.push(transformers[idx].call(this, arguments[idx]));\n                idx += 1;\n            }\n            return fn.apply(this, args.concat(_slice(arguments, transformers.length)));\n        });\n    });\n\n    /**\n     * Returns a list of all the enumerable own properties of the supplied object.\n     * Note that the order of the output array is not guaranteed across different\n     * JS platforms.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.1.0\n     * @category Object\n     * @sig {k: v} -> [v]\n     * @param {Object} obj The object to extract values from\n     * @return {Array} An array of the values of the object's own properties.\n     * @example\n     *\n     *      R.values({a: 1, b: 2, c: 3}); //=> [1, 2, 3]\n     */\n    var values = _curry1(function values(obj) {\n        var props = keys(obj);\n        var len = props.length;\n        var vals = [];\n        var idx = 0;\n        while (idx < len) {\n            vals[idx] = obj[props[idx]];\n            idx += 1;\n        }\n        return vals;\n    });\n\n    /**\n     * Returns a list of all the properties, including prototype properties, of the\n     * supplied object.\n     * Note that the order of the output array is not guaranteed to be consistent\n     * across different JS platforms.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.2.0\n     * @category Object\n     * @sig {k: v} -> [v]\n     * @param {Object} obj The object to extract values from\n     * @return {Array} An array of the values of the object's own and prototype properties.\n     * @example\n     *\n     *      var F = function() { this.x = 'X'; };\n     *      F.prototype.y = 'Y';\n     *      var f = new F();\n     *      R.valuesIn(f); //=> ['X', 'Y']\n     */\n    var valuesIn = _curry1(function valuesIn(obj) {\n        var prop;\n        var vs = [];\n        for (prop in obj) {\n            vs[vs.length] = obj[prop];\n        }\n        return vs;\n    });\n\n    /**\n     * Returns a \"view\" of the given data structure, determined by the given lens.\n     * The lens's focus determines which portion of the data structure is visible.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.16.0\n     * @category Object\n     * @typedefn Lens s a = Functor f => (a -> f a) -> s -> f s\n     * @sig Lens s a -> s -> a\n     * @param {Lens} lens\n     * @param {*} x\n     * @return {*}\n     * @see R.prop, R.lensIndex, R.lensProp\n     * @example\n     *\n     *      var xLens = R.lensProp('x');\n     *\n     *      R.view(xLens, {x: 1, y: 2});  //=> 1\n     *      R.view(xLens, {x: 4, y: 2});  //=> 4\n     */\n    // `Const` is a functor that effectively ignores the function given to `map`.\n    // Using `Const` effectively ignores the setter function of the `lens`,\n    // leaving the value returned by the getter function unmodified.\n    var view = function () {\n        // `Const` is a functor that effectively ignores the function given to `map`.\n        var Const = function (x) {\n            return {\n                value: x,\n                map: function () {\n                    return this;\n                }\n            };\n        };\n        return _curry2(function view(lens, x) {\n            // Using `Const` effectively ignores the setter function of the `lens`,\n            // leaving the value returned by the getter function unmodified.\n            return lens(Const)(x).value;\n        });\n    }();\n\n    /**\n     * Tests the final argument by passing it to the given predicate function. If\n     * the predicate is satisfied, the function will return the result of calling\n     * the `whenTrueFn` function with the same argument. If the predicate is not\n     * satisfied, the argument is returned as is.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.18.0\n     * @category Logic\n     * @sig (a -> Boolean) -> (a -> a) -> a -> a\n     * @param {Function} pred       A predicate function\n     * @param {Function} whenTrueFn A function to invoke when the `condition`\n     *                              evaluates to a truthy value.\n     * @param {*}        x          An object to test with the `pred` function and\n     *                              pass to `whenTrueFn` if necessary.\n     * @return {*} Either `x` or the result of applying `x` to `whenTrueFn`.\n     * @see R.ifElse, R.unless\n     * @example\n     *\n     *      // truncate :: String -> String\n     *      var truncate = R.when(\n     *        R.propSatisfies(R.gt(R.__, 10), 'length'),\n     *        R.pipe(R.take(10), R.append('…'), R.join(''))\n     *      );\n     *      truncate('12345');         //=> '12345'\n     *      truncate('0123456789ABC'); //=> '0123456789…'\n     */\n    var when = _curry3(function when(pred, whenTrueFn, x) {\n        return pred(x) ? whenTrueFn(x) : x;\n    });\n\n    /**\n     * Takes a spec object and a test object; returns true if the test satisfies\n     * the spec. Each of the spec's own properties must be a predicate function.\n     * Each predicate is applied to the value of the corresponding property of the\n     * test object. `where` returns true if all the predicates return true, false\n     * otherwise.\n     *\n     * `where` is well suited to declaratively expressing constraints for other\n     * functions such as `filter` and `find`.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.1.1\n     * @category Object\n     * @sig {String: (* -> Boolean)} -> {String: *} -> Boolean\n     * @param {Object} spec\n     * @param {Object} testObj\n     * @return {Boolean}\n     * @example\n     *\n     *      // pred :: Object -> Boolean\n     *      var pred = R.where({\n     *        a: R.equals('foo'),\n     *        b: R.complement(R.equals('bar')),\n     *        x: R.gt(_, 10),\n     *        y: R.lt(_, 20)\n     *      });\n     *\n     *      pred({a: 'foo', b: 'xxx', x: 11, y: 19}); //=> true\n     *      pred({a: 'xxx', b: 'xxx', x: 11, y: 19}); //=> false\n     *      pred({a: 'foo', b: 'bar', x: 11, y: 19}); //=> false\n     *      pred({a: 'foo', b: 'xxx', x: 10, y: 19}); //=> false\n     *      pred({a: 'foo', b: 'xxx', x: 11, y: 20}); //=> false\n     */\n    var where = _curry2(function where(spec, testObj) {\n        for (var prop in spec) {\n            if (_has(prop, spec) && !spec[prop](testObj[prop])) {\n                return false;\n            }\n        }\n        return true;\n    });\n\n    /**\n     * Wrap a function inside another to allow you to make adjustments to the\n     * parameters, or do other processing either before the internal function is\n     * called or with its results.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.1.0\n     * @category Function\n     * @sig (a... -> b) -> ((a... -> b) -> a... -> c) -> (a... -> c)\n     * @param {Function} fn The function to wrap.\n     * @param {Function} wrapper The wrapper function.\n     * @return {Function} The wrapped function.\n     * @example\n     *\n     *      var greet = name => 'Hello ' + name;\n     *\n     *      var shoutedGreet = R.wrap(greet, (gr, name) => gr(name).toUpperCase());\n     *\n     *      shoutedGreet(\"Kathy\"); //=> \"HELLO KATHY\"\n     *\n     *      var shortenedGreet = R.wrap(greet, function(gr, name) {\n     *        return gr(name.substring(0, 3));\n     *      });\n     *      shortenedGreet(\"Robert\"); //=> \"Hello Rob\"\n     */\n    var wrap = _curry2(function wrap(fn, wrapper) {\n        return curryN(fn.length, function () {\n            return wrapper.apply(this, _concat([fn], arguments));\n        });\n    });\n\n    /**\n     * Creates a new list out of the two supplied by creating each possible pair\n     * from the lists.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.1.0\n     * @category List\n     * @sig [a] -> [b] -> [[a,b]]\n     * @param {Array} as The first list.\n     * @param {Array} bs The second list.\n     * @return {Array} The list made by combining each possible pair from\n     *         `as` and `bs` into pairs (`[a, b]`).\n     * @example\n     *\n     *      R.xprod([1, 2], ['a', 'b']); //=> [[1, 'a'], [1, 'b'], [2, 'a'], [2, 'b']]\n     */\n    // = xprodWith(prepend); (takes about 3 times as long...)\n    var xprod = _curry2(function xprod(a, b) {\n        // = xprodWith(prepend); (takes about 3 times as long...)\n        var idx = 0;\n        var ilen = a.length;\n        var j;\n        var jlen = b.length;\n        var result = [];\n        while (idx < ilen) {\n            j = 0;\n            while (j < jlen) {\n                result[result.length] = [\n                    a[idx],\n                    b[j]\n                ];\n                j += 1;\n            }\n            idx += 1;\n        }\n        return result;\n    });\n\n    /**\n     * Creates a new list out of the two supplied by pairing up equally-positioned\n     * items from both lists. The returned list is truncated to the length of the\n     * shorter of the two input lists.\n     * Note: `zip` is equivalent to `zipWith(function(a, b) { return [a, b] })`.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.1.0\n     * @category List\n     * @sig [a] -> [b] -> [[a,b]]\n     * @param {Array} list1 The first array to consider.\n     * @param {Array} list2 The second array to consider.\n     * @return {Array} The list made by pairing up same-indexed elements of `list1` and `list2`.\n     * @example\n     *\n     *      R.zip([1, 2, 3], ['a', 'b', 'c']); //=> [[1, 'a'], [2, 'b'], [3, 'c']]\n     */\n    var zip = _curry2(function zip(a, b) {\n        var rv = [];\n        var idx = 0;\n        var len = Math.min(a.length, b.length);\n        while (idx < len) {\n            rv[idx] = [\n                a[idx],\n                b[idx]\n            ];\n            idx += 1;\n        }\n        return rv;\n    });\n\n    /**\n     * Creates a new object out of a list of keys and a list of values.\n     * Key/value pairing is truncated to the length of the shorter of the two lists.\n     * Note: `zipObj` is equivalent to `pipe(zipWith(pair), fromPairs)`.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.3.0\n     * @category List\n     * @sig [String] -> [*] -> {String: *}\n     * @param {Array} keys The array that will be properties on the output object.\n     * @param {Array} values The list of values on the output object.\n     * @return {Object} The object made by pairing up same-indexed elements of `keys` and `values`.\n     * @example\n     *\n     *      R.zipObj(['a', 'b', 'c'], [1, 2, 3]); //=> {a: 1, b: 2, c: 3}\n     */\n    var zipObj = _curry2(function zipObj(keys, values) {\n        var idx = 0;\n        var len = Math.min(keys.length, values.length);\n        var out = {};\n        while (idx < len) {\n            out[keys[idx]] = values[idx];\n            idx += 1;\n        }\n        return out;\n    });\n\n    /**\n     * Creates a new list out of the two supplied by applying the function to each\n     * equally-positioned pair in the lists. The returned list is truncated to the\n     * length of the shorter of the two input lists.\n     *\n     * @function\n     * @memberOf R\n     * @since v0.1.0\n     * @category List\n     * @sig (a,b -> c) -> [a] -> [b] -> [c]\n     * @param {Function} fn The function used to combine the two elements into one value.\n     * @param {Array} list1 The first array to consider.\n     * @param {Array} list2 The second array to consider.\n     * @return {Array} The list made by combining same-indexed elements of `list1` and `list2`\n     *         using `fn`.\n     * @example\n     *\n     *      var f = (x, y) => {\n     *        // ...\n     *      };\n     *      R.zipWith(f, [1, 2, 3], ['a', 'b', 'c']);\n     *      //=> [f(1, 'a'), f(2, 'b'), f(3, 'c')]\n     */\n    var zipWith = _curry3(function zipWith(fn, a, b) {\n        var rv = [];\n        var idx = 0;\n        var len = Math.min(a.length, b.length);\n        while (idx < len) {\n            rv[idx] = fn(a[idx], b[idx]);\n            idx += 1;\n        }\n        return rv;\n    });\n\n    /**\n     * A function that always returns `false`. Any passed in parameters are ignored.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.9.0\n     * @category Function\n     * @sig * -> Boolean\n     * @param {*}\n     * @return {Boolean}\n     * @see R.always, R.T\n     * @example\n     *\n     *      R.F(); //=> false\n     */\n    var F = always(false);\n\n    /**\n     * A function that always returns `true`. Any passed in parameters are ignored.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.9.0\n     * @category Function\n     * @sig * -> Boolean\n     * @param {*}\n     * @return {Boolean}\n     * @see R.always, R.F\n     * @example\n     *\n     *      R.T(); //=> true\n     */\n    var T = always(true);\n\n    /**\n     * Copies an object.\n     *\n     * @private\n     * @param {*} value The value to be copied\n     * @param {Array} refFrom Array containing the source references\n     * @param {Array} refTo Array containing the copied source references\n     * @param {Boolean} deep Whether or not to perform deep cloning.\n     * @return {*} The copied value.\n     */\n    var _clone = function _clone(value, refFrom, refTo, deep) {\n        var copy = function copy(copiedValue) {\n            var len = refFrom.length;\n            var idx = 0;\n            while (idx < len) {\n                if (value === refFrom[idx]) {\n                    return refTo[idx];\n                }\n                idx += 1;\n            }\n            refFrom[idx + 1] = value;\n            refTo[idx + 1] = copiedValue;\n            for (var key in value) {\n                copiedValue[key] = deep ? _clone(value[key], refFrom, refTo, true) : value[key];\n            }\n            return copiedValue;\n        };\n        switch (type(value)) {\n        case 'Object':\n            return copy({});\n        case 'Array':\n            return copy([]);\n        case 'Date':\n            return new Date(value.valueOf());\n        case 'RegExp':\n            return _cloneRegExp(value);\n        default:\n            return value;\n        }\n    };\n\n    var _createPartialApplicator = function _createPartialApplicator(concat) {\n        return _curry2(function (fn, args) {\n            return _arity(Math.max(0, fn.length - args.length), function () {\n                return fn.apply(this, concat(args, arguments));\n            });\n        });\n    };\n\n    var _dropLast = function dropLast(n, xs) {\n        return take(n < xs.length ? xs.length - n : 0, xs);\n    };\n\n    // Values of other types are only equal if identical.\n    var _equals = function _equals(a, b, stackA, stackB) {\n        if (identical(a, b)) {\n            return true;\n        }\n        if (type(a) !== type(b)) {\n            return false;\n        }\n        if (a == null || b == null) {\n            return false;\n        }\n        if (typeof a.equals === 'function' || typeof b.equals === 'function') {\n            return typeof a.equals === 'function' && a.equals(b) && typeof b.equals === 'function' && b.equals(a);\n        }\n        switch (type(a)) {\n        case 'Arguments':\n        case 'Array':\n        case 'Object':\n            if (typeof a.constructor === 'function' && _functionName(a.constructor) === 'Promise') {\n                return a === b;\n            }\n            break;\n        case 'Boolean':\n        case 'Number':\n        case 'String':\n            if (!(typeof a === typeof b && identical(a.valueOf(), b.valueOf()))) {\n                return false;\n            }\n            break;\n        case 'Date':\n            if (!identical(a.valueOf(), b.valueOf())) {\n                return false;\n            }\n            break;\n        case 'Error':\n            return a.name === b.name && a.message === b.message;\n        case 'RegExp':\n            if (!(a.source === b.source && a.global === b.global && a.ignoreCase === b.ignoreCase && a.multiline === b.multiline && a.sticky === b.sticky && a.unicode === b.unicode)) {\n                return false;\n            }\n            break;\n        case 'Map':\n        case 'Set':\n            if (!_equals(_arrayFromIterator(a.entries()), _arrayFromIterator(b.entries()), stackA, stackB)) {\n                return false;\n            }\n            break;\n        case 'Int8Array':\n        case 'Uint8Array':\n        case 'Uint8ClampedArray':\n        case 'Int16Array':\n        case 'Uint16Array':\n        case 'Int32Array':\n        case 'Uint32Array':\n        case 'Float32Array':\n        case 'Float64Array':\n            break;\n        case 'ArrayBuffer':\n            break;\n        default:\n            // Values of other types are only equal if identical.\n            return false;\n        }\n        var keysA = keys(a);\n        if (keysA.length !== keys(b).length) {\n            return false;\n        }\n        var idx = stackA.length - 1;\n        while (idx >= 0) {\n            if (stackA[idx] === a) {\n                return stackB[idx] === b;\n            }\n            idx -= 1;\n        }\n        stackA.push(a);\n        stackB.push(b);\n        idx = keysA.length - 1;\n        while (idx >= 0) {\n            var key = keysA[idx];\n            if (!(_has(key, b) && _equals(b[key], a[key], stackA, stackB))) {\n                return false;\n            }\n            idx -= 1;\n        }\n        stackA.pop();\n        stackB.pop();\n        return true;\n    };\n\n    /**\n     * `_makeFlat` is a helper function that returns a one-level or fully recursive\n     * function based on the flag passed in.\n     *\n     * @private\n     */\n    var _makeFlat = function _makeFlat(recursive) {\n        return function flatt(list) {\n            var value, jlen, j;\n            var result = [];\n            var idx = 0;\n            var ilen = list.length;\n            while (idx < ilen) {\n                if (isArrayLike(list[idx])) {\n                    value = recursive ? flatt(list[idx]) : list[idx];\n                    j = 0;\n                    jlen = value.length;\n                    while (j < jlen) {\n                        result[result.length] = value[j];\n                        j += 1;\n                    }\n                } else {\n                    result[result.length] = list[idx];\n                }\n                idx += 1;\n            }\n            return result;\n        };\n    };\n\n    var _reduce = function () {\n        function _arrayReduce(xf, acc, list) {\n            var idx = 0;\n            var len = list.length;\n            while (idx < len) {\n                acc = xf['@@transducer/step'](acc, list[idx]);\n                if (acc && acc['@@transducer/reduced']) {\n                    acc = acc['@@transducer/value'];\n                    break;\n                }\n                idx += 1;\n            }\n            return xf['@@transducer/result'](acc);\n        }\n        function _iterableReduce(xf, acc, iter) {\n            var step = iter.next();\n            while (!step.done) {\n                acc = xf['@@transducer/step'](acc, step.value);\n                if (acc && acc['@@transducer/reduced']) {\n                    acc = acc['@@transducer/value'];\n                    break;\n                }\n                step = iter.next();\n            }\n            return xf['@@transducer/result'](acc);\n        }\n        function _methodReduce(xf, acc, obj) {\n            return xf['@@transducer/result'](obj.reduce(bind(xf['@@transducer/step'], xf), acc));\n        }\n        var symIterator = typeof Symbol !== 'undefined' ? Symbol.iterator : '@@iterator';\n        return function _reduce(fn, acc, list) {\n            if (typeof fn === 'function') {\n                fn = _xwrap(fn);\n            }\n            if (isArrayLike(list)) {\n                return _arrayReduce(fn, acc, list);\n            }\n            if (typeof list.reduce === 'function') {\n                return _methodReduce(fn, acc, list);\n            }\n            if (list[symIterator] != null) {\n                return _iterableReduce(fn, acc, list[symIterator]());\n            }\n            if (typeof list.next === 'function') {\n                return _iterableReduce(fn, acc, list);\n            }\n            throw new TypeError('reduce: list must be array or iterable');\n        };\n    }();\n\n    var _stepCat = function () {\n        var _stepCatArray = {\n            '@@transducer/init': Array,\n            '@@transducer/step': function (xs, x) {\n                xs.push(x);\n                return xs;\n            },\n            '@@transducer/result': _identity\n        };\n        var _stepCatString = {\n            '@@transducer/init': String,\n            '@@transducer/step': function (a, b) {\n                return a + b;\n            },\n            '@@transducer/result': _identity\n        };\n        var _stepCatObject = {\n            '@@transducer/init': Object,\n            '@@transducer/step': function (result, input) {\n                return _assign(result, isArrayLike(input) ? objOf(input[0], input[1]) : input);\n            },\n            '@@transducer/result': _identity\n        };\n        return function _stepCat(obj) {\n            if (_isTransformer(obj)) {\n                return obj;\n            }\n            if (isArrayLike(obj)) {\n                return _stepCatArray;\n            }\n            if (typeof obj === 'string') {\n                return _stepCatString;\n            }\n            if (typeof obj === 'object') {\n                return _stepCatObject;\n            }\n            throw new Error('Cannot create transformer for ' + obj);\n        };\n    }();\n\n    var _xdropLastWhile = function () {\n        function XDropLastWhile(fn, xf) {\n            this.f = fn;\n            this.retained = [];\n            this.xf = xf;\n        }\n        XDropLastWhile.prototype['@@transducer/init'] = _xfBase.init;\n        XDropLastWhile.prototype['@@transducer/result'] = function (result) {\n            this.retained = null;\n            return this.xf['@@transducer/result'](result);\n        };\n        XDropLastWhile.prototype['@@transducer/step'] = function (result, input) {\n            return this.f(input) ? this.retain(result, input) : this.flush(result, input);\n        };\n        XDropLastWhile.prototype.flush = function (result, input) {\n            result = _reduce(this.xf['@@transducer/step'], result, this.retained);\n            this.retained = [];\n            return this.xf['@@transducer/step'](result, input);\n        };\n        XDropLastWhile.prototype.retain = function (result, input) {\n            this.retained.push(input);\n            return result;\n        };\n        return _curry2(function _xdropLastWhile(fn, xf) {\n            return new XDropLastWhile(fn, xf);\n        });\n    }();\n\n    var _xgroupBy = function () {\n        function XGroupBy(f, xf) {\n            this.xf = xf;\n            this.f = f;\n            this.inputs = {};\n        }\n        XGroupBy.prototype['@@transducer/init'] = _xfBase.init;\n        XGroupBy.prototype['@@transducer/result'] = function (result) {\n            var key;\n            for (key in this.inputs) {\n                if (_has(key, this.inputs)) {\n                    result = this.xf['@@transducer/step'](result, this.inputs[key]);\n                    if (result['@@transducer/reduced']) {\n                        result = result['@@transducer/value'];\n                        break;\n                    }\n                }\n            }\n            this.inputs = null;\n            return this.xf['@@transducer/result'](result);\n        };\n        XGroupBy.prototype['@@transducer/step'] = function (result, input) {\n            var key = this.f(input);\n            this.inputs[key] = this.inputs[key] || [\n                key,\n                []\n            ];\n            this.inputs[key][1] = append(input, this.inputs[key][1]);\n            return result;\n        };\n        return _curry2(function _xgroupBy(f, xf) {\n            return new XGroupBy(f, xf);\n        });\n    }();\n\n    /**\n     * Creates a new list iteration function from an existing one by adding two new\n     * parameters to its callback function: the current index, and the entire list.\n     *\n     * This would turn, for instance, Ramda's simple `map` function into one that\n     * more closely resembles `Array.prototype.map`. Note that this will only work\n     * for functions in which the iteration callback function is the first\n     * parameter, and where the list is the last parameter. (This latter might be\n     * unimportant if the list parameter is not used.)\n     *\n     * @func\n     * @memberOf R\n     * @since v0.15.0\n     * @category Function\n     * @category List\n     * @sig ((a ... -> b) ... -> [a] -> *) -> (a ..., Int, [a] -> b) ... -> [a] -> *)\n     * @param {Function} fn A list iteration function that does not pass index or list to its callback\n     * @return {Function} An altered list iteration function that passes (item, index, list) to its callback\n     * @example\n     *\n     *      var mapIndexed = R.addIndex(R.map);\n     *      mapIndexed((val, idx) => idx + '-' + val, ['f', 'o', 'o', 'b', 'a', 'r']);\n     *      //=> ['0-f', '1-o', '2-o', '3-b', '4-a', '5-r']\n     */\n    var addIndex = _curry1(function addIndex(fn) {\n        return curryN(fn.length, function () {\n            var idx = 0;\n            var origFn = arguments[0];\n            var list = arguments[arguments.length - 1];\n            var args = _slice(arguments);\n            args[0] = function () {\n                var result = origFn.apply(this, _concat(arguments, [\n                    idx,\n                    list\n                ]));\n                idx += 1;\n                return result;\n            };\n            return fn.apply(this, args);\n        });\n    });\n\n    /**\n     * Wraps a function of any arity (including nullary) in a function that accepts\n     * exactly 2 parameters. Any extraneous parameters will not be passed to the\n     * supplied function.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.2.0\n     * @category Function\n     * @sig (* -> c) -> (a, b -> c)\n     * @param {Function} fn The function to wrap.\n     * @return {Function} A new function wrapping `fn`. The new function is guaranteed to be of\n     *         arity 2.\n     * @example\n     *\n     *      var takesThreeArgs = function(a, b, c) {\n     *        return [a, b, c];\n     *      };\n     *      takesThreeArgs.length; //=> 3\n     *      takesThreeArgs(1, 2, 3); //=> [1, 2, 3]\n     *\n     *      var takesTwoArgs = R.binary(takesThreeArgs);\n     *      takesTwoArgs.length; //=> 2\n     *      // Only 2 arguments are passed to the wrapped function\n     *      takesTwoArgs(1, 2, 3); //=> [1, 2, undefined]\n     */\n    var binary = _curry1(function binary(fn) {\n        return nAry(2, fn);\n    });\n\n    /**\n     * Creates a deep copy of the value which may contain (nested) `Array`s and\n     * `Object`s, `Number`s, `String`s, `Boolean`s and `Date`s. `Function`s are not\n     * copied, but assigned by their reference.\n     *\n     * Dispatches to a `clone` method if present.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.1.0\n     * @category Object\n     * @sig {*} -> {*}\n     * @param {*} value The object or array to clone\n     * @return {*} A new object or array.\n     * @example\n     *\n     *      var objects = [{}, {}, {}];\n     *      var objectsClone = R.clone(objects);\n     *      objects[0] === objectsClone[0]; //=> false\n     */\n    var clone = _curry1(function clone(value) {\n        return value != null && typeof value.clone === 'function' ? value.clone() : _clone(value, [], [], true);\n    });\n\n    /**\n     * Returns a curried equivalent of the provided function. The curried function\n     * has two unusual capabilities. First, its arguments needn't be provided one\n     * at a time. If `f` is a ternary function and `g` is `R.curry(f)`, the\n     * following are equivalent:\n     *\n     *   - `g(1)(2)(3)`\n     *   - `g(1)(2, 3)`\n     *   - `g(1, 2)(3)`\n     *   - `g(1, 2, 3)`\n     *\n     * Secondly, the special placeholder value `R.__` may be used to specify\n     * \"gaps\", allowing partial application of any combination of arguments,\n     * regardless of their positions. If `g` is as above and `_` is `R.__`, the\n     * following are equivalent:\n     *\n     *   - `g(1, 2, 3)`\n     *   - `g(_, 2, 3)(1)`\n     *   - `g(_, _, 3)(1)(2)`\n     *   - `g(_, _, 3)(1, 2)`\n     *   - `g(_, 2)(1)(3)`\n     *   - `g(_, 2)(1, 3)`\n     *   - `g(_, 2)(_, 3)(1)`\n     *\n     * @func\n     * @memberOf R\n     * @since v0.1.0\n     * @category Function\n     * @sig (* -> a) -> (* -> a)\n     * @param {Function} fn The function to curry.\n     * @return {Function} A new, curried function.\n     * @see R.curryN\n     * @example\n     *\n     *      var addFourNumbers = (a, b, c, d) => a + b + c + d;\n     *\n     *      var curriedAddFourNumbers = R.curry(addFourNumbers);\n     *      var f = curriedAddFourNumbers(1, 2);\n     *      var g = f(3);\n     *      g(4); //=> 10\n     */\n    var curry = _curry1(function curry(fn) {\n        return curryN(fn.length, fn);\n    });\n\n    /**\n     * Returns all but the first `n` elements of the given list, string, or\n     * transducer/transformer (or object with a `drop` method).\n     *\n     * Dispatches to the `drop` method of the second argument, if present.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.1.0\n     * @category List\n     * @sig Number -> [a] -> [a]\n     * @sig Number -> String -> String\n     * @param {Number} n\n     * @param {*} list\n     * @return {*}\n     * @see R.take, R.transduce\n     * @example\n     *\n     *      R.drop(1, ['foo', 'bar', 'baz']); //=> ['bar', 'baz']\n     *      R.drop(2, ['foo', 'bar', 'baz']); //=> ['baz']\n     *      R.drop(3, ['foo', 'bar', 'baz']); //=> []\n     *      R.drop(4, ['foo', 'bar', 'baz']); //=> []\n     *      R.drop(3, 'ramda');               //=> 'da'\n     */\n    var drop = _curry2(_dispatchable('drop', _xdrop, function drop(n, xs) {\n        return slice(Math.max(0, n), Infinity, xs);\n    }));\n\n    /**\n     * Returns a list containing all but the last `n` elements of the given `list`.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.16.0\n     * @category List\n     * @sig Number -> [a] -> [a]\n     * @sig Number -> String -> String\n     * @param {Number} n The number of elements of `xs` to skip.\n     * @param {Array} xs The collection to consider.\n     * @return {Array}\n     * @see R.takeLast\n     * @example\n     *\n     *      R.dropLast(1, ['foo', 'bar', 'baz']); //=> ['foo', 'bar']\n     *      R.dropLast(2, ['foo', 'bar', 'baz']); //=> ['foo']\n     *      R.dropLast(3, ['foo', 'bar', 'baz']); //=> []\n     *      R.dropLast(4, ['foo', 'bar', 'baz']); //=> []\n     *      R.dropLast(3, 'ramda');               //=> 'ra'\n     */\n    var dropLast = _curry2(_dispatchable('dropLast', _xdropLast, _dropLast));\n\n    /**\n     * Returns a new list containing all but last the`n` elements of a given list,\n     * passing each value from the right to the supplied predicate function,\n     * skipping elements while the predicate function returns `true`. The predicate\n     * function is passed one argument: (value)*.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.16.0\n     * @category List\n     * @sig (a -> Boolean) -> [a] -> [a]\n     * @param {Function} fn The function called per iteration.\n     * @param {Array} list The collection to iterate over.\n     * @return {Array} A new array.\n     * @see R.takeLastWhile, R.addIndex\n     * @example\n     *\n     *      var lteThree = x => x <= 3;\n     *\n     *      R.dropLastWhile(lteThree, [1, 2, 3, 4, 3, 2, 1]); //=> [1, 2, 3, 4]\n     */\n    var dropLastWhile = _curry2(_dispatchable('dropLastWhile', _xdropLastWhile, _dropLastWhile));\n\n    /**\n     * Returns `true` if its arguments are equivalent, `false` otherwise. Handles\n     * cyclical data structures.\n     *\n     * Dispatches symmetrically to the `equals` methods of both arguments, if\n     * present.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.15.0\n     * @category Relation\n     * @sig a -> b -> Boolean\n     * @param {*} a\n     * @param {*} b\n     * @return {Boolean}\n     * @example\n     *\n     *      R.equals(1, 1); //=> true\n     *      R.equals(1, '1'); //=> false\n     *      R.equals([1, 2, 3], [1, 2, 3]); //=> true\n     *\n     *      var a = {}; a.v = a;\n     *      var b = {}; b.v = b;\n     *      R.equals(a, b); //=> true\n     */\n    var equals = _curry2(function equals(a, b) {\n        return _equals(a, b, [], []);\n    });\n\n    /**\n     * Takes a predicate and a \"filterable\", and returns a new filterable of the\n     * same type containing the members of the given filterable which satisfy the\n     * given predicate.\n     *\n     * Dispatches to the `filter` method of the second argument, if present.\n     *\n     * Acts as a transducer if a transformer is given in list position.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.1.0\n     * @category List\n     * @sig Filterable f => (a -> Boolean) -> f a -> f a\n     * @param {Function} pred\n     * @param {Array} filterable\n     * @return {Array}\n     * @see R.reject, R.transduce, R.addIndex\n     * @example\n     *\n     *      var isEven = n => n % 2 === 0;\n     *\n     *      R.filter(isEven, [1, 2, 3, 4]); //=> [2, 4]\n     *\n     *      R.filter(isEven, {a: 1, b: 2, c: 3, d: 4}); //=> {b: 2, d: 4}\n     */\n    // else\n    var filter = _curry2(_dispatchable('filter', _xfilter, function (pred, filterable) {\n        return _isObject(filterable) ? _reduce(function (acc, key) {\n            if (pred(filterable[key])) {\n                acc[key] = filterable[key];\n            }\n            return acc;\n        }, {}, keys(filterable)) : // else\n        _filter(pred, filterable);\n    }));\n\n    /**\n     * Returns a new list by pulling every item out of it (and all its sub-arrays)\n     * and putting them in a new array, depth-first.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.1.0\n     * @category List\n     * @sig [a] -> [b]\n     * @param {Array} list The array to consider.\n     * @return {Array} The flattened list.\n     * @see R.unnest\n     * @example\n     *\n     *      R.flatten([1, 2, [3, 4], 5, [6, [7, 8, [9, [10, 11], 12]]]]);\n     *      //=> [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12]\n     */\n    var flatten = _curry1(_makeFlat(true));\n\n    /**\n     * Returns a new function much like the supplied one, except that the first two\n     * arguments' order is reversed.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.1.0\n     * @category Function\n     * @sig (a -> b -> c -> ... -> z) -> (b -> a -> c -> ... -> z)\n     * @param {Function} fn The function to invoke with its first two parameters reversed.\n     * @return {*} The result of invoking `fn` with its first two parameters' order reversed.\n     * @example\n     *\n     *      var mergeThree = (a, b, c) => [].concat(a, b, c);\n     *\n     *      mergeThree(1, 2, 3); //=> [1, 2, 3]\n     *\n     *      R.flip(mergeThree)(1, 2, 3); //=> [2, 1, 3]\n     */\n    var flip = _curry1(function flip(fn) {\n        return curry(function (a, b) {\n            var args = _slice(arguments);\n            args[0] = b;\n            args[1] = a;\n            return fn.apply(this, args);\n        });\n    });\n\n    /**\n     * Returns the first element of the given list or string. In some libraries\n     * this function is named `first`.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.1.0\n     * @category List\n     * @sig [a] -> a | Undefined\n     * @sig String -> String\n     * @param {Array|String} list\n     * @return {*}\n     * @see R.tail, R.init, R.last\n     * @example\n     *\n     *      R.head(['fi', 'fo', 'fum']); //=> 'fi'\n     *      R.head([]); //=> undefined\n     *\n     *      R.head('abc'); //=> 'a'\n     *      R.head(''); //=> ''\n     */\n    var head = nth(0);\n\n    /**\n     * Returns all but the last element of the given list or string.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.9.0\n     * @category List\n     * @sig [a] -> [a]\n     * @sig String -> String\n     * @param {*} list\n     * @return {*}\n     * @see R.last, R.head, R.tail\n     * @example\n     *\n     *      R.init([1, 2, 3]);  //=> [1, 2]\n     *      R.init([1, 2]);     //=> [1]\n     *      R.init([1]);        //=> []\n     *      R.init([]);         //=> []\n     *\n     *      R.init('abc');  //=> 'ab'\n     *      R.init('ab');   //=> 'a'\n     *      R.init('a');    //=> ''\n     *      R.init('');     //=> ''\n     */\n    var init = slice(0, -1);\n\n    /**\n     * Combines two lists into a set (i.e. no duplicates) composed of those\n     * elements common to both lists. Duplication is determined according to the\n     * value returned by applying the supplied predicate to two list elements.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.1.0\n     * @category Relation\n     * @sig (a -> a -> Boolean) -> [*] -> [*] -> [*]\n     * @param {Function} pred A predicate function that determines whether\n     *        the two supplied elements are equal.\n     * @param {Array} list1 One list of items to compare\n     * @param {Array} list2 A second list of items to compare\n     * @return {Array} A new list containing those elements common to both lists.\n     * @see R.intersection\n     * @example\n     *\n     *      var buffaloSpringfield = [\n     *        {id: 824, name: 'Richie Furay'},\n     *        {id: 956, name: 'Dewey Martin'},\n     *        {id: 313, name: 'Bruce Palmer'},\n     *        {id: 456, name: 'Stephen Stills'},\n     *        {id: 177, name: 'Neil Young'}\n     *      ];\n     *      var csny = [\n     *        {id: 204, name: 'David Crosby'},\n     *        {id: 456, name: 'Stephen Stills'},\n     *        {id: 539, name: 'Graham Nash'},\n     *        {id: 177, name: 'Neil Young'}\n     *      ];\n     *\n     *      R.intersectionWith(R.eqBy(R.prop('id')), buffaloSpringfield, csny);\n     *      //=> [{id: 456, name: 'Stephen Stills'}, {id: 177, name: 'Neil Young'}]\n     */\n    var intersectionWith = _curry3(function intersectionWith(pred, list1, list2) {\n        var lookupList, filteredList;\n        if (list1.length > list2.length) {\n            lookupList = list1;\n            filteredList = list2;\n        } else {\n            lookupList = list2;\n            filteredList = list1;\n        }\n        var results = [];\n        var idx = 0;\n        while (idx < filteredList.length) {\n            if (_containsWith(pred, filteredList[idx], lookupList)) {\n                results[results.length] = filteredList[idx];\n            }\n            idx += 1;\n        }\n        return uniqWith(pred, results);\n    });\n\n    /**\n     * Transforms the items of the list with the transducer and appends the\n     * transformed items to the accumulator using an appropriate iterator function\n     * based on the accumulator type.\n     *\n     * The accumulator can be an array, string, object or a transformer. Iterated\n     * items will be appended to arrays and concatenated to strings. Objects will\n     * be merged directly or 2-item arrays will be merged as key, value pairs.\n     *\n     * The accumulator can also be a transformer object that provides a 2-arity\n     * reducing iterator function, step, 0-arity initial value function, init, and\n     * 1-arity result extraction function result. The step function is used as the\n     * iterator function in reduce. The result function is used to convert the\n     * final accumulator into the return type and in most cases is R.identity. The\n     * init function is used to provide the initial accumulator.\n     *\n     * The iteration is performed with R.reduce after initializing the transducer.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.12.0\n     * @category List\n     * @sig a -> (b -> b) -> [c] -> a\n     * @param {*} acc The initial accumulator value.\n     * @param {Function} xf The transducer function. Receives a transformer and returns a transformer.\n     * @param {Array} list The list to iterate over.\n     * @return {*} The final, accumulated value.\n     * @example\n     *\n     *      var numbers = [1, 2, 3, 4];\n     *      var transducer = R.compose(R.map(R.add(1)), R.take(2));\n     *\n     *      R.into([], transducer, numbers); //=> [2, 3]\n     *\n     *      var intoArray = R.into([]);\n     *      intoArray(transducer, numbers); //=> [2, 3]\n     */\n    var into = _curry3(function into(acc, xf, list) {\n        return _isTransformer(acc) ? _reduce(xf(acc), acc['@@transducer/init'](), list) : _reduce(xf(_stepCat(acc)), _clone(acc, [], [], false), list);\n    });\n\n    /**\n     * Same as R.invertObj, however this accounts for objects with duplicate values\n     * by putting the values into an array.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.9.0\n     * @category Object\n     * @sig {s: x} -> {x: [ s, ... ]}\n     * @param {Object} obj The object or array to invert\n     * @return {Object} out A new object with keys\n     * in an array.\n     * @example\n     *\n     *      var raceResultsByFirstName = {\n     *        first: 'alice',\n     *        second: 'jake',\n     *        third: 'alice',\n     *      };\n     *      R.invert(raceResultsByFirstName);\n     *      //=> { 'alice': ['first', 'third'], 'jake':['second'] }\n     */\n    var invert = _curry1(function invert(obj) {\n        var props = keys(obj);\n        var len = props.length;\n        var idx = 0;\n        var out = {};\n        while (idx < len) {\n            var key = props[idx];\n            var val = obj[key];\n            var list = _has(val, out) ? out[val] : out[val] = [];\n            list[list.length] = key;\n            idx += 1;\n        }\n        return out;\n    });\n\n    /**\n     * Returns a new object with the keys of the given object as values, and the\n     * values of the given object, which are coerced to strings, as keys. Note\n     * that the last key found is preferred when handling the same value.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.9.0\n     * @category Object\n     * @sig {s: x} -> {x: s}\n     * @param {Object} obj The object or array to invert\n     * @return {Object} out A new object\n     * @example\n     *\n     *      var raceResults = {\n     *        first: 'alice',\n     *        second: 'jake'\n     *      };\n     *      R.invertObj(raceResults);\n     *      //=> { 'alice': 'first', 'jake':'second' }\n     *\n     *      // Alternatively:\n     *      var raceResults = ['alice', 'jake'];\n     *      R.invertObj(raceResults);\n     *      //=> { 'alice': '0', 'jake':'1' }\n     */\n    var invertObj = _curry1(function invertObj(obj) {\n        var props = keys(obj);\n        var len = props.length;\n        var idx = 0;\n        var out = {};\n        while (idx < len) {\n            var key = props[idx];\n            out[obj[key]] = key;\n            idx += 1;\n        }\n        return out;\n    });\n\n    /**\n     * Returns `true` if the given value is its type's empty value; `false`\n     * otherwise.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.1.0\n     * @category Logic\n     * @sig a -> Boolean\n     * @param {*} x\n     * @return {Boolean}\n     * @see R.empty\n     * @example\n     *\n     *      R.isEmpty([1, 2, 3]);   //=> false\n     *      R.isEmpty([]);          //=> true\n     *      R.isEmpty('');          //=> true\n     *      R.isEmpty(null);        //=> false\n     *      R.isEmpty({});          //=> true\n     *      R.isEmpty({length: 0}); //=> false\n     */\n    var isEmpty = _curry1(function isEmpty(x) {\n        return x != null && equals(x, empty(x));\n    });\n\n    /**\n     * Returns the last element of the given list or string.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.1.4\n     * @category List\n     * @sig [a] -> a | Undefined\n     * @sig String -> String\n     * @param {*} list\n     * @return {*}\n     * @see R.init, R.head, R.tail\n     * @example\n     *\n     *      R.last(['fi', 'fo', 'fum']); //=> 'fum'\n     *      R.last([]); //=> undefined\n     *\n     *      R.last('abc'); //=> 'c'\n     *      R.last(''); //=> ''\n     */\n    var last = nth(-1);\n\n    /**\n     * Returns the position of the last occurrence of an item in an array, or -1 if\n     * the item is not included in the array. `R.equals` is used to determine\n     * equality.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.1.0\n     * @category List\n     * @sig a -> [a] -> Number\n     * @param {*} target The item to find.\n     * @param {Array} xs The array to search in.\n     * @return {Number} the index of the target, or -1 if the target is not found.\n     * @see R.indexOf\n     * @example\n     *\n     *      R.lastIndexOf(3, [-1,3,3,0,1,2,3,4]); //=> 6\n     *      R.lastIndexOf(10, [1,2,3,4]); //=> -1\n     */\n    var lastIndexOf = _curry2(function lastIndexOf(target, xs) {\n        if (typeof xs.lastIndexOf === 'function' && !_isArray(xs)) {\n            return xs.lastIndexOf(target);\n        } else {\n            var idx = xs.length - 1;\n            while (idx >= 0) {\n                if (equals(xs[idx], target)) {\n                    return idx;\n                }\n                idx -= 1;\n            }\n            return -1;\n        }\n    });\n\n    /**\n     * Takes a function and\n     * a [functor](https://github.com/fantasyland/fantasy-land#functor),\n     * applies the function to each of the functor's values, and returns\n     * a functor of the same shape.\n     *\n     * Ramda provides suitable `map` implementations for `Array` and `Object`,\n     * so this function may be applied to `[1, 2, 3]` or `{x: 1, y: 2, z: 3}`.\n     *\n     * Dispatches to the `map` method of the second argument, if present.\n     *\n     * Acts as a transducer if a transformer is given in list position.\n     *\n     * Also treats functions as functors and will compose them together.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.1.0\n     * @category List\n     * @sig Functor f => (a -> b) -> f a -> f b\n     * @param {Function} fn The function to be called on every element of the input `list`.\n     * @param {Array} list The list to be iterated over.\n     * @return {Array} The new list.\n     * @see R.transduce, R.addIndex\n     * @example\n     *\n     *      var double = x => x * 2;\n     *\n     *      R.map(double, [1, 2, 3]); //=> [2, 4, 6]\n     *\n     *      R.map(double, {x: 1, y: 2, z: 3}); //=> {x: 2, y: 4, z: 6}\n     */\n    var map = _curry2(_dispatchable('map', _xmap, function map(fn, functor) {\n        switch (Object.prototype.toString.call(functor)) {\n        case '[object Function]':\n            return curryN(functor.length, function () {\n                return fn.call(this, functor.apply(this, arguments));\n            });\n        case '[object Object]':\n            return _reduce(function (acc, key) {\n                acc[key] = fn(functor[key]);\n                return acc;\n            }, {}, keys(functor));\n        default:\n            return _map(fn, functor);\n        }\n    }));\n\n    /**\n     * An Object-specific version of `map`. The function is applied to three\n     * arguments: *(value, key, obj)*. If only the value is significant, use\n     * `map` instead.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.9.0\n     * @category Object\n     * @sig ((*, String, Object) -> *) -> Object -> Object\n     * @param {Function} fn\n     * @param {Object} obj\n     * @return {Object}\n     * @see R.map\n     * @example\n     *\n     *      var values = { x: 1, y: 2, z: 3 };\n     *      var prependKeyAndDouble = (num, key, obj) => key + (num * 2);\n     *\n     *      R.mapObjIndexed(prependKeyAndDouble, values); //=> { x: 'x2', y: 'y4', z: 'z6' }\n     */\n    var mapObjIndexed = _curry2(function mapObjIndexed(fn, obj) {\n        return _reduce(function (acc, key) {\n            acc[key] = fn(obj[key], key, obj);\n            return acc;\n        }, {}, keys(obj));\n    });\n\n    /**\n     * Creates a new object with the own properties of the two provided objects. If\n     * a key exists in both objects, the provided function is applied to the values\n     * associated with the key in each object, with the result being used as the\n     * value associated with the key in the returned object. The key will be\n     * excluded from the returned object if the resulting value is `undefined`.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.19.0\n     * @category Object\n     * @sig (a -> a -> a) -> {a} -> {a} -> {a}\n     * @param {Function} fn\n     * @param {Object} l\n     * @param {Object} r\n     * @return {Object}\n     * @see R.merge, R.mergeWithKey\n     * @example\n     *\n     *      R.mergeWith(R.concat,\n     *                  { a: true, values: [10, 20] },\n     *                  { b: true, values: [15, 35] });\n     *      //=> { a: true, b: true, values: [10, 20, 15, 35] }\n     */\n    var mergeWith = _curry3(function mergeWith(fn, l, r) {\n        return mergeWithKey(function (_, _l, _r) {\n            return fn(_l, _r);\n        }, l, r);\n    });\n\n    /**\n     * Takes a function `f` and a list of arguments, and returns a function `g`.\n     * When applied, `g` returns the result of applying `f` to the arguments\n     * provided initially followed by the arguments provided to `g`.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.10.0\n     * @category Function\n     * @sig ((a, b, c, ..., n) -> x) -> [a, b, c, ...] -> ((d, e, f, ..., n) -> x)\n     * @param {Function} f\n     * @param {Array} args\n     * @return {Function}\n     * @see R.partialRight\n     * @example\n     *\n     *      var multiply = (a, b) => a * b;\n     *      var double = R.partial(multiply, [2]);\n     *      double(2); //=> 4\n     *\n     *      var greet = (salutation, title, firstName, lastName) =>\n     *        salutation + ', ' + title + ' ' + firstName + ' ' + lastName + '!';\n     *\n     *      var sayHello = R.partial(greet, ['Hello']);\n     *      var sayHelloToMs = R.partial(sayHello, ['Ms.']);\n     *      sayHelloToMs('Jane', 'Jones'); //=> 'Hello, Ms. Jane Jones!'\n     */\n    var partial = _createPartialApplicator(_concat);\n\n    /**\n     * Takes a function `f` and a list of arguments, and returns a function `g`.\n     * When applied, `g` returns the result of applying `f` to the arguments\n     * provided to `g` followed by the arguments provided initially.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.10.0\n     * @category Function\n     * @sig ((a, b, c, ..., n) -> x) -> [d, e, f, ..., n] -> ((a, b, c, ...) -> x)\n     * @param {Function} f\n     * @param {Array} args\n     * @return {Function}\n     * @see R.partial\n     * @example\n     *\n     *      var greet = (salutation, title, firstName, lastName) =>\n     *        salutation + ', ' + title + ' ' + firstName + ' ' + lastName + '!';\n     *\n     *      var greetMsJaneJones = R.partialRight(greet, ['Ms.', 'Jane', 'Jones']);\n     *\n     *      greetMsJaneJones('Hello'); //=> 'Hello, Ms. Jane Jones!'\n     */\n    var partialRight = _createPartialApplicator(flip(_concat));\n\n    /**\n     * Determines whether a nested path on an object has a specific value, in\n     * `R.equals` terms. Most likely used to filter a list.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.7.0\n     * @category Relation\n     * @sig [String] -> * -> {String: *} -> Boolean\n     * @param {Array} path The path of the nested property to use\n     * @param {*} val The value to compare the nested property with\n     * @param {Object} obj The object to check the nested property in\n     * @return {Boolean} `true` if the value equals the nested object property,\n     *         `false` otherwise.\n     * @example\n     *\n     *      var user1 = { address: { zipCode: 90210 } };\n     *      var user2 = { address: { zipCode: 55555 } };\n     *      var user3 = { name: 'Bob' };\n     *      var users = [ user1, user2, user3 ];\n     *      var isFamous = R.pathEq(['address', 'zipCode'], 90210);\n     *      R.filter(isFamous, users); //=> [ user1 ]\n     */\n    var pathEq = _curry3(function pathEq(_path, val, obj) {\n        return equals(path(_path, obj), val);\n    });\n\n    /**\n     * Returns a new list by plucking the same named property off all objects in\n     * the list supplied.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.1.0\n     * @category List\n     * @sig k -> [{k: v}] -> [v]\n     * @param {Number|String} key The key name to pluck off of each object.\n     * @param {Array} list The array to consider.\n     * @return {Array} The list of values for the given key.\n     * @see R.props\n     * @example\n     *\n     *      R.pluck('a')([{a: 1}, {a: 2}]); //=> [1, 2]\n     *      R.pluck(0)([[1, 2], [3, 4]]);   //=> [1, 3]\n     */\n    var pluck = _curry2(function pluck(p, list) {\n        return map(prop(p), list);\n    });\n\n    /**\n     * Reasonable analog to SQL `select` statement.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.1.0\n     * @category Object\n     * @category Relation\n     * @sig [k] -> [{k: v}] -> [{k: v}]\n     * @param {Array} props The property names to project\n     * @param {Array} objs The objects to query\n     * @return {Array} An array of objects with just the `props` properties.\n     * @example\n     *\n     *      var abby = {name: 'Abby', age: 7, hair: 'blond', grade: 2};\n     *      var fred = {name: 'Fred', age: 12, hair: 'brown', grade: 7};\n     *      var kids = [abby, fred];\n     *      R.project(['name', 'grade'], kids); //=> [{name: 'Abby', grade: 2}, {name: 'Fred', grade: 7}]\n     */\n    // passing `identity` gives correct arity\n    var project = useWith(_map, [\n        pickAll,\n        identity\n    ]);\n\n    /**\n     * Returns `true` if the specified object property is equal, in `R.equals`\n     * terms, to the given value; `false` otherwise.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.1.0\n     * @category Relation\n     * @sig String -> a -> Object -> Boolean\n     * @param {String} name\n     * @param {*} val\n     * @param {*} obj\n     * @return {Boolean}\n     * @see R.equals, R.propSatisfies\n     * @example\n     *\n     *      var abby = {name: 'Abby', age: 7, hair: 'blond'};\n     *      var fred = {name: 'Fred', age: 12, hair: 'brown'};\n     *      var rusty = {name: 'Rusty', age: 10, hair: 'brown'};\n     *      var alois = {name: 'Alois', age: 15, disposition: 'surly'};\n     *      var kids = [abby, fred, rusty, alois];\n     *      var hasBrownHair = R.propEq('hair', 'brown');\n     *      R.filter(hasBrownHair, kids); //=> [fred, rusty]\n     */\n    var propEq = _curry3(function propEq(name, val, obj) {\n        return propSatisfies(equals(val), name, obj);\n    });\n\n    /**\n     * Returns `true` if the specified object property is of the given type;\n     * `false` otherwise.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.16.0\n     * @category Type\n     * @sig Type -> String -> Object -> Boolean\n     * @param {Function} type\n     * @param {String} name\n     * @param {*} obj\n     * @return {Boolean}\n     * @see R.is, R.propSatisfies\n     * @example\n     *\n     *      R.propIs(Number, 'x', {x: 1, y: 2});  //=> true\n     *      R.propIs(Number, 'x', {x: 'foo'});    //=> false\n     *      R.propIs(Number, 'x', {});            //=> false\n     */\n    var propIs = _curry3(function propIs(type, name, obj) {\n        return propSatisfies(is(type), name, obj);\n    });\n\n    /**\n     * Returns a single item by iterating through the list, successively calling\n     * the iterator function and passing it an accumulator value and the current\n     * value from the array, and then passing the result to the next call.\n     *\n     * The iterator function receives two values: *(acc, value)*. It may use\n     * `R.reduced` to shortcut the iteration.\n     *\n     * Note: `R.reduce` does not skip deleted or unassigned indices (sparse\n     * arrays), unlike the native `Array.prototype.reduce` method. For more details\n     * on this behavior, see:\n     * https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/reduce#Description\n     *\n     * Dispatches to the `reduce` method of the third argument, if present.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.1.0\n     * @category List\n     * @sig ((a, b) -> a) -> a -> [b] -> a\n     * @param {Function} fn The iterator function. Receives two values, the accumulator and the\n     *        current element from the array.\n     * @param {*} acc The accumulator value.\n     * @param {Array} list The list to iterate over.\n     * @return {*} The final, accumulated value.\n     * @see R.reduced, R.addIndex\n     * @example\n     *\n     *      var numbers = [1, 2, 3];\n     *      var add = (a, b) => a + b;\n     *\n     *      R.reduce(add, 10, numbers); //=> 16\n     */\n    var reduce = _curry3(_reduce);\n\n    /**\n     * Groups the elements of the list according to the result of calling\n     * the String-returning function `keyFn` on each element and reduces the elements\n     * of each group to a single value via the reducer function `valueFn`.\n     *\n     * This function is basically a more general `groupBy` function.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.20.0\n     * @category List\n     * @sig ((a, b) -> a) -> a -> (b -> String) -> [b] -> {String: a}\n     * @param {Function} valueFn The function that reduces the elements of each group to a single\n     *        value. Receives two values, accumulator for a particular group and the current element.\n     * @param {*} acc The (initial) accumulator value for each group.\n     * @param {Function} keyFn The function that maps the list's element into a key.\n     * @param {Array} list The array to group.\n     * @return {Object} An object with the output of `keyFn` for keys, mapped to the output of\n     *         `valueFn` for elements which produced that key when passed to `keyFn`.\n     * @see R.groupBy, R.reduce\n     * @example\n     *\n     *      var reduceToNamesBy = R.reduceBy((acc, student) => acc.concat(student.name), []);\n     *      var namesByGrade = reduceToNamesBy(function(student) {\n     *        var score = student.score;\n     *        return score < 65 ? 'F' :\n     *               score < 70 ? 'D' :\n     *               score < 80 ? 'C' :\n     *               score < 90 ? 'B' : 'A';\n     *      });\n     *      var students = [{name: 'Lucy', score: 92},\n     *                      {name: 'Drew', score: 85},\n     *                      // ...\n     *                      {name: 'Bart', score: 62}];\n     *      namesByGrade(students);\n     *      // {\n     *      //   'A': ['Lucy'],\n     *      //   'B': ['Drew']\n     *      //   // ...,\n     *      //   'F': ['Bart']\n     *      // }\n     */\n    var reduceBy = _curryN(4, [], function reduceBy(valueFn, valueAcc, keyFn, list) {\n        return _reduce(function (acc, elt) {\n            var key = keyFn(elt);\n            acc[key] = valueFn(_has(key, acc) ? acc[key] : valueAcc, elt);\n            return acc;\n        }, {}, list);\n    });\n\n    /**\n     * The complement of `filter`.\n     *\n     * Acts as a transducer if a transformer is given in list position.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.1.0\n     * @category List\n     * @sig Filterable f => (a -> Boolean) -> f a -> f a\n     * @param {Function} pred\n     * @param {Array} filterable\n     * @return {Array}\n     * @see R.filter, R.transduce, R.addIndex\n     * @example\n     *\n     *      var isOdd = (n) => n % 2 === 1;\n     *\n     *      R.reject(isOdd, [1, 2, 3, 4]); //=> [2, 4]\n     *\n     *      R.reject(isOdd, {a: 1, b: 2, c: 3, d: 4}); //=> {b: 2, d: 4}\n     */\n    var reject = _curry2(function reject(pred, filterable) {\n        return filter(_complement(pred), filterable);\n    });\n\n    /**\n     * Returns a fixed list of size `n` containing a specified identical value.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.1.1\n     * @category List\n     * @sig a -> n -> [a]\n     * @param {*} value The value to repeat.\n     * @param {Number} n The desired size of the output list.\n     * @return {Array} A new array containing `n` `value`s.\n     * @example\n     *\n     *      R.repeat('hi', 5); //=> ['hi', 'hi', 'hi', 'hi', 'hi']\n     *\n     *      var obj = {};\n     *      var repeatedObjs = R.repeat(obj, 5); //=> [{}, {}, {}, {}, {}]\n     *      repeatedObjs[0] === repeatedObjs[1]; //=> true\n     */\n    var repeat = _curry2(function repeat(value, n) {\n        return times(always(value), n);\n    });\n\n    /**\n     * Adds together all the elements of a list.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.1.0\n     * @category Math\n     * @sig [Number] -> Number\n     * @param {Array} list An array of numbers\n     * @return {Number} The sum of all the numbers in the list.\n     * @see R.reduce\n     * @example\n     *\n     *      R.sum([2,4,6,8,100,1]); //=> 121\n     */\n    var sum = reduce(add, 0);\n\n    /**\n     * Returns a new list containing the last `n` elements of the given list.\n     * If `n > list.length`, returns a list of `list.length` elements.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.16.0\n     * @category List\n     * @sig Number -> [a] -> [a]\n     * @sig Number -> String -> String\n     * @param {Number} n The number of elements to return.\n     * @param {Array} xs The collection to consider.\n     * @return {Array}\n     * @see R.dropLast\n     * @example\n     *\n     *      R.takeLast(1, ['foo', 'bar', 'baz']); //=> ['baz']\n     *      R.takeLast(2, ['foo', 'bar', 'baz']); //=> ['bar', 'baz']\n     *      R.takeLast(3, ['foo', 'bar', 'baz']); //=> ['foo', 'bar', 'baz']\n     *      R.takeLast(4, ['foo', 'bar', 'baz']); //=> ['foo', 'bar', 'baz']\n     *      R.takeLast(3, 'ramda');               //=> 'mda'\n     */\n    var takeLast = _curry2(function takeLast(n, xs) {\n        return drop(n >= 0 ? xs.length - n : 0, xs);\n    });\n\n    /**\n     * Initializes a transducer using supplied iterator function. Returns a single\n     * item by iterating through the list, successively calling the transformed\n     * iterator function and passing it an accumulator value and the current value\n     * from the array, and then passing the result to the next call.\n     *\n     * The iterator function receives two values: *(acc, value)*. It will be\n     * wrapped as a transformer to initialize the transducer. A transformer can be\n     * passed directly in place of an iterator function. In both cases, iteration\n     * may be stopped early with the `R.reduced` function.\n     *\n     * A transducer is a function that accepts a transformer and returns a\n     * transformer and can be composed directly.\n     *\n     * A transformer is an an object that provides a 2-arity reducing iterator\n     * function, step, 0-arity initial value function, init, and 1-arity result\n     * extraction function, result. The step function is used as the iterator\n     * function in reduce. The result function is used to convert the final\n     * accumulator into the return type and in most cases is R.identity. The init\n     * function can be used to provide an initial accumulator, but is ignored by\n     * transduce.\n     *\n     * The iteration is performed with R.reduce after initializing the transducer.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.12.0\n     * @category List\n     * @sig (c -> c) -> (a,b -> a) -> a -> [b] -> a\n     * @param {Function} xf The transducer function. Receives a transformer and returns a transformer.\n     * @param {Function} fn The iterator function. Receives two values, the accumulator and the\n     *        current element from the array. Wrapped as transformer, if necessary, and used to\n     *        initialize the transducer\n     * @param {*} acc The initial accumulator value.\n     * @param {Array} list The list to iterate over.\n     * @return {*} The final, accumulated value.\n     * @see R.reduce, R.reduced, R.into\n     * @example\n     *\n     *      var numbers = [1, 2, 3, 4];\n     *      var transducer = R.compose(R.map(R.add(1)), R.take(2));\n     *\n     *      R.transduce(transducer, R.flip(R.append), [], numbers); //=> [2, 3]\n     */\n    var transduce = curryN(4, function transduce(xf, fn, acc, list) {\n        return _reduce(xf(typeof fn === 'function' ? _xwrap(fn) : fn), acc, list);\n    });\n\n    /**\n     * Combines two lists into a set (i.e. no duplicates) composed of the elements\n     * of each list. Duplication is determined according to the value returned by\n     * applying the supplied predicate to two list elements.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.1.0\n     * @category Relation\n     * @sig (a -> a -> Boolean) -> [*] -> [*] -> [*]\n     * @param {Function} pred A predicate used to test whether two items are equal.\n     * @param {Array} list1 The first list.\n     * @param {Array} list2 The second list.\n     * @return {Array} The first and second lists concatenated, with\n     *         duplicates removed.\n     * @see R.union\n     * @example\n     *\n     *      var l1 = [{a: 1}, {a: 2}];\n     *      var l2 = [{a: 1}, {a: 4}];\n     *      R.unionWith(R.eqBy(R.prop('a')), l1, l2); //=> [{a: 1}, {a: 2}, {a: 4}]\n     */\n    var unionWith = _curry3(function unionWith(pred, list1, list2) {\n        return uniqWith(pred, _concat(list1, list2));\n    });\n\n    /**\n     * Takes a spec object and a test object; returns true if the test satisfies\n     * the spec, false otherwise. An object satisfies the spec if, for each of the\n     * spec's own properties, accessing that property of the object gives the same\n     * value (in `R.equals` terms) as accessing that property of the spec.\n     *\n     * `whereEq` is a specialization of [`where`](#where).\n     *\n     * @func\n     * @memberOf R\n     * @since v0.14.0\n     * @category Object\n     * @sig {String: *} -> {String: *} -> Boolean\n     * @param {Object} spec\n     * @param {Object} testObj\n     * @return {Boolean}\n     * @see R.where\n     * @example\n     *\n     *      // pred :: Object -> Boolean\n     *      var pred = R.whereEq({a: 1, b: 2});\n     *\n     *      pred({a: 1});              //=> false\n     *      pred({a: 1, b: 2});        //=> true\n     *      pred({a: 1, b: 2, c: 3});  //=> true\n     *      pred({a: 1, b: 1});        //=> false\n     */\n    var whereEq = _curry2(function whereEq(spec, testObj) {\n        return where(map(equals, spec), testObj);\n    });\n\n    var _flatCat = function () {\n        var preservingReduced = function (xf) {\n            return {\n                '@@transducer/init': _xfBase.init,\n                '@@transducer/result': function (result) {\n                    return xf['@@transducer/result'](result);\n                },\n                '@@transducer/step': function (result, input) {\n                    var ret = xf['@@transducer/step'](result, input);\n                    return ret['@@transducer/reduced'] ? _forceReduced(ret) : ret;\n                }\n            };\n        };\n        return function _xcat(xf) {\n            var rxf = preservingReduced(xf);\n            return {\n                '@@transducer/init': _xfBase.init,\n                '@@transducer/result': function (result) {\n                    return rxf['@@transducer/result'](result);\n                },\n                '@@transducer/step': function (result, input) {\n                    return !isArrayLike(input) ? _reduce(rxf, result, [input]) : _reduce(rxf, result, input);\n                }\n            };\n        };\n    }();\n\n    // Array.prototype.indexOf doesn't exist below IE9\n    // manually crawl the list to distinguish between +0 and -0\n    // NaN\n    // non-zero numbers can utilise Set\n    // all these types can utilise Set\n    // null can utilise Set\n    // anything else not covered above, defer to R.equals\n    var _indexOf = function _indexOf(list, a, idx) {\n        var inf, item;\n        // Array.prototype.indexOf doesn't exist below IE9\n        if (typeof list.indexOf === 'function') {\n            switch (typeof a) {\n            case 'number':\n                if (a === 0) {\n                    // manually crawl the list to distinguish between +0 and -0\n                    inf = 1 / a;\n                    while (idx < list.length) {\n                        item = list[idx];\n                        if (item === 0 && 1 / item === inf) {\n                            return idx;\n                        }\n                        idx += 1;\n                    }\n                    return -1;\n                } else if (a !== a) {\n                    // NaN\n                    while (idx < list.length) {\n                        item = list[idx];\n                        if (typeof item === 'number' && item !== item) {\n                            return idx;\n                        }\n                        idx += 1;\n                    }\n                    return -1;\n                }\n                // non-zero numbers can utilise Set\n                return list.indexOf(a, idx);\n            // all these types can utilise Set\n            case 'string':\n            case 'boolean':\n            case 'function':\n            case 'undefined':\n                return list.indexOf(a, idx);\n            case 'object':\n                if (a === null) {\n                    // null can utilise Set\n                    return list.indexOf(a, idx);\n                }\n            }\n        }\n        // anything else not covered above, defer to R.equals\n        while (idx < list.length) {\n            if (equals(list[idx], a)) {\n                return idx;\n            }\n            idx += 1;\n        }\n        return -1;\n    };\n\n    var _xchain = _curry2(function _xchain(f, xf) {\n        return map(f, _flatCat(xf));\n    });\n\n    /**\n     * Takes a list of predicates and returns a predicate that returns true for a\n     * given list of arguments if every one of the provided predicates is satisfied\n     * by those arguments.\n     *\n     * The function returned is a curried function whose arity matches that of the\n     * highest-arity predicate.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.9.0\n     * @category Logic\n     * @sig [(*... -> Boolean)] -> (*... -> Boolean)\n     * @param {Array} preds\n     * @return {Function}\n     * @see R.anyPass\n     * @example\n     *\n     *      var isQueen = R.propEq('rank', 'Q');\n     *      var isSpade = R.propEq('suit', '♠︎');\n     *      var isQueenOfSpades = R.allPass([isQueen, isSpade]);\n     *\n     *      isQueenOfSpades({rank: 'Q', suit: '♣︎'}); //=> false\n     *      isQueenOfSpades({rank: 'Q', suit: '♠︎'}); //=> true\n     */\n    var allPass = _curry1(function allPass(preds) {\n        return curryN(reduce(max, 0, pluck('length', preds)), function () {\n            var idx = 0;\n            var len = preds.length;\n            while (idx < len) {\n                if (!preds[idx].apply(this, arguments)) {\n                    return false;\n                }\n                idx += 1;\n            }\n            return true;\n        });\n    });\n\n    /**\n     * Returns `true` if all elements are unique, in `R.equals` terms, otherwise\n     * `false`.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.18.0\n     * @category List\n     * @sig [a] -> Boolean\n     * @param {Array} list The array to consider.\n     * @return {Boolean} `true` if all elements are unique, else `false`.\n     * @deprecated since v0.20.0\n     * @example\n     *\n     *      R.allUniq(['1', 1]); //=> true\n     *      R.allUniq([1, 1]);   //=> false\n     *      R.allUniq([[42], [42]]); //=> false\n     */\n    var allUniq = _curry1(function allUniq(list) {\n        var len = list.length;\n        var idx = 0;\n        while (idx < len) {\n            if (_indexOf(list, list[idx], idx + 1) >= 0) {\n                return false;\n            }\n            idx += 1;\n        }\n        return true;\n    });\n\n    /**\n     * Takes a list of predicates and returns a predicate that returns true for a\n     * given list of arguments if at least one of the provided predicates is\n     * satisfied by those arguments.\n     *\n     * The function returned is a curried function whose arity matches that of the\n     * highest-arity predicate.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.9.0\n     * @category Logic\n     * @sig [(*... -> Boolean)] -> (*... -> Boolean)\n     * @param {Array} preds\n     * @return {Function}\n     * @see R.allPass\n     * @example\n     *\n     *      var gte = R.anyPass([R.gt, R.equals]);\n     *\n     *      gte(3, 2); //=> true\n     *      gte(2, 2); //=> true\n     *      gte(2, 3); //=> false\n     */\n    var anyPass = _curry1(function anyPass(preds) {\n        return curryN(reduce(max, 0, pluck('length', preds)), function () {\n            var idx = 0;\n            var len = preds.length;\n            while (idx < len) {\n                if (preds[idx].apply(this, arguments)) {\n                    return true;\n                }\n                idx += 1;\n            }\n            return false;\n        });\n    });\n\n    /**\n     * ap applies a list of functions to a list of values.\n     *\n     * Dispatches to the `ap` method of the second argument, if present. Also\n     * treats functions as applicatives.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.3.0\n     * @category Function\n     * @sig [f] -> [a] -> [f a]\n     * @param {Array} fns An array of functions\n     * @param {Array} vs An array of values\n     * @return {Array} An array of results of applying each of `fns` to all of `vs` in turn.\n     * @example\n     *\n     *      R.ap([R.multiply(2), R.add(3)], [1,2,3]); //=> [2, 4, 6, 4, 5, 6]\n     */\n    // else\n    var ap = _curry2(function ap(applicative, fn) {\n        return typeof applicative.ap === 'function' ? applicative.ap(fn) : typeof applicative === 'function' ? curryN(Math.max(applicative.length, fn.length), function () {\n            return applicative.apply(this, arguments)(fn.apply(this, arguments));\n        }) : // else\n        _reduce(function (acc, f) {\n            return _concat(acc, map(f, fn));\n        }, [], applicative);\n    });\n\n    /**\n     * Given a spec object recursively mapping properties to functions, creates a\n     * function producing an object of the same structure, by mapping each property\n     * to the result of calling its associated function with the supplied arguments.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.20.0\n     * @category Function\n     * @sig {k: ((a, b, ..., m) -> v)} -> ((a, b, ..., m) -> {k: v})\n     * @param {Object} spec an object recursively mapping properties to functions for\n     *        producing the values for these properties.\n     * @return {Function} A function that returns an object of the same structure\n     * as `spec', with each property set to the value returned by calling its\n     * associated function with the supplied arguments.\n     * @see R.juxt\n     * @example\n     *\n     *      var getMetrics = R.applySpec({\n     *                                      sum: R.add,\n     *                                      nested: { mul: R.multiply }\n     *                                   });\n     *      getMetrics(2, 4); // => { sum: 6, nested: { mul: 8 } }\n     */\n    var applySpec = _curry1(function applySpec(spec) {\n        spec = map(function (v) {\n            return typeof v == 'function' ? v : applySpec(v);\n        }, spec);\n        return curryN(reduce(max, 0, pluck('length', values(spec))), function () {\n            var args = arguments;\n            return map(function (f) {\n                return apply(f, args);\n            }, spec);\n        });\n    });\n\n    /**\n     * Returns the result of calling its first argument with the remaining\n     * arguments. This is occasionally useful as a converging function for\n     * `R.converge`: the left branch can produce a function while the right branch\n     * produces a value to be passed to that function as an argument.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.9.0\n     * @category Function\n     * @sig (*... -> a),*... -> a\n     * @param {Function} fn The function to apply to the remaining arguments.\n     * @param {...*} args Any number of positional arguments.\n     * @return {*}\n     * @see R.apply\n     * @example\n     *\n     *      var indentN = R.pipe(R.times(R.always(' ')),\n     *                           R.join(''),\n     *                           R.replace(/^(?!$)/gm));\n     *\n     *      var format = R.converge(R.call, [\n     *                                  R.pipe(R.prop('indent'), indentN),\n     *                                  R.prop('value')\n     *                              ]);\n     *\n     *      format({indent: 2, value: 'foo\\nbar\\nbaz\\n'}); //=> '  foo\\n  bar\\n  baz\\n'\n     */\n    var call = curry(function call(fn) {\n        return fn.apply(this, _slice(arguments, 1));\n    });\n\n    /**\n     * `chain` maps a function over a list and concatenates the results. `chain`\n     * is also known as `flatMap` in some libraries\n     *\n     * Dispatches to the `chain` method of the second argument, if present.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.3.0\n     * @category List\n     * @sig (a -> [b]) -> [a] -> [b]\n     * @param {Function} fn\n     * @param {Array} list\n     * @return {Array}\n     * @example\n     *\n     *      var duplicate = n => [n, n];\n     *      R.chain(duplicate, [1, 2, 3]); //=> [1, 1, 2, 2, 3, 3]\n     */\n    var chain = _curry2(_dispatchable('chain', _xchain, function chain(fn, monad) {\n        if (typeof monad === 'function') {\n            return function () {\n                return monad.call(this, fn.apply(this, arguments)).apply(this, arguments);\n            };\n        }\n        return _makeFlat(false)(map(fn, monad));\n    }));\n\n    /**\n     * Returns a function, `fn`, which encapsulates if/else-if/else logic.\n     * `R.cond` takes a list of [predicate, transform] pairs. All of the arguments\n     * to `fn` are applied to each of the predicates in turn until one returns a\n     * \"truthy\" value, at which point `fn` returns the result of applying its\n     * arguments to the corresponding transformer. If none of the predicates\n     * matches, `fn` returns undefined.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.6.0\n     * @category Logic\n     * @sig [[(*... -> Boolean),(*... -> *)]] -> (*... -> *)\n     * @param {Array} pairs\n     * @return {Function}\n     * @example\n     *\n     *      var fn = R.cond([\n     *        [R.equals(0),   R.always('water freezes at 0°C')],\n     *        [R.equals(100), R.always('water boils at 100°C')],\n     *        [R.T,           temp => 'nothing special happens at ' + temp + '°C']\n     *      ]);\n     *      fn(0); //=> 'water freezes at 0°C'\n     *      fn(50); //=> 'nothing special happens at 50°C'\n     *      fn(100); //=> 'water boils at 100°C'\n     */\n    var cond = _curry1(function cond(pairs) {\n        var arity = reduce(max, 0, map(function (pair) {\n            return pair[0].length;\n        }, pairs));\n        return _arity(arity, function () {\n            var idx = 0;\n            while (idx < pairs.length) {\n                if (pairs[idx][0].apply(this, arguments)) {\n                    return pairs[idx][1].apply(this, arguments);\n                }\n                idx += 1;\n            }\n        });\n    });\n\n    /**\n     * Wraps a constructor function inside a curried function that can be called\n     * with the same arguments and returns the same type. The arity of the function\n     * returned is specified to allow using variadic constructor functions.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.4.0\n     * @category Function\n     * @sig Number -> (* -> {*}) -> (* -> {*})\n     * @param {Number} n The arity of the constructor function.\n     * @param {Function} Fn The constructor function to wrap.\n     * @return {Function} A wrapped, curried constructor function.\n     * @example\n     *\n     *      // Variadic constructor function\n     *      var Widget = () => {\n     *        this.children = Array.prototype.slice.call(arguments);\n     *        // ...\n     *      };\n     *      Widget.prototype = {\n     *        // ...\n     *      };\n     *      var allConfigs = [\n     *        // ...\n     *      ];\n     *      R.map(R.constructN(1, Widget), allConfigs); // a list of Widgets\n     */\n    var constructN = _curry2(function constructN(n, Fn) {\n        if (n > 10) {\n            throw new Error('Constructor with greater than ten arguments');\n        }\n        if (n === 0) {\n            return function () {\n                return new Fn();\n            };\n        }\n        return curry(nAry(n, function ($0, $1, $2, $3, $4, $5, $6, $7, $8, $9) {\n            switch (arguments.length) {\n            case 1:\n                return new Fn($0);\n            case 2:\n                return new Fn($0, $1);\n            case 3:\n                return new Fn($0, $1, $2);\n            case 4:\n                return new Fn($0, $1, $2, $3);\n            case 5:\n                return new Fn($0, $1, $2, $3, $4);\n            case 6:\n                return new Fn($0, $1, $2, $3, $4, $5);\n            case 7:\n                return new Fn($0, $1, $2, $3, $4, $5, $6);\n            case 8:\n                return new Fn($0, $1, $2, $3, $4, $5, $6, $7);\n            case 9:\n                return new Fn($0, $1, $2, $3, $4, $5, $6, $7, $8);\n            case 10:\n                return new Fn($0, $1, $2, $3, $4, $5, $6, $7, $8, $9);\n            }\n        }));\n    });\n\n    /**\n     * Accepts a converging function and a list of branching functions and returns\n     * a new function. When invoked, this new function is applied to some\n     * arguments, each branching function is applied to those same arguments. The\n     * results of each branching function are passed as arguments to the converging\n     * function to produce the return value.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.4.2\n     * @category Function\n     * @sig (x1 -> x2 -> ... -> z) -> [(a -> b -> ... -> x1), (a -> b -> ... -> x2), ...] -> (a -> b -> ... -> z)\n     * @param {Function} after A function. `after` will be invoked with the return values of\n     *        `fn1` and `fn2` as its arguments.\n     * @param {Array} functions A list of functions.\n     * @return {Function} A new function.\n     * @example\n     *\n     *      var add = (a, b) => a + b;\n     *      var multiply = (a, b) => a * b;\n     *      var subtract = (a, b) => a - b;\n     *\n     *      //≅ multiply( add(1, 2), subtract(1, 2) );\n     *      R.converge(multiply, [add, subtract])(1, 2); //=> -3\n     *\n     *      var add3 = (a, b, c) => a + b + c;\n     *      R.converge(add3, [multiply, add, subtract])(1, 2); //=> 4\n     */\n    var converge = _curry2(function converge(after, fns) {\n        return curryN(reduce(max, 0, pluck('length', fns)), function () {\n            var args = arguments;\n            var context = this;\n            return after.apply(context, _map(function (fn) {\n                return fn.apply(context, args);\n            }, fns));\n        });\n    });\n\n    /**\n     * Counts the elements of a list according to how many match each value of a\n     * key generated by the supplied function. Returns an object mapping the keys\n     * produced by `fn` to the number of occurrences in the list. Note that all\n     * keys are coerced to strings because of how JavaScript objects work.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.1.0\n     * @category Relation\n     * @sig (a -> String) -> [a] -> {*}\n     * @param {Function} fn The function used to map values to keys.\n     * @param {Array} list The list to count elements from.\n     * @return {Object} An object mapping keys to number of occurrences in the list.\n     * @example\n     *\n     *      var numbers = [1.0, 1.1, 1.2, 2.0, 3.0, 2.2];\n     *      var letters = R.split('', 'abcABCaaaBBc');\n     *      R.countBy(Math.floor)(numbers);    //=> {'1': 3, '2': 2, '3': 1}\n     *      R.countBy(R.toLower)(letters);   //=> {'a': 5, 'b': 4, 'c': 3}\n     */\n    var countBy = reduceBy(function (acc, elem) {\n        return acc + 1;\n    }, 0);\n\n    /**\n     * Returns a new list without any consecutively repeating elements. Equality is\n     * determined by applying the supplied predicate two consecutive elements. The\n     * first element in a series of equal element is the one being preserved.\n     *\n     * Dispatches to the `dropRepeatsWith` method of the second argument, if present.\n     *\n     * Acts as a transducer if a transformer is given in list position.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.14.0\n     * @category List\n     * @sig (a, a -> Boolean) -> [a] -> [a]\n     * @param {Function} pred A predicate used to test whether two items are equal.\n     * @param {Array} list The array to consider.\n     * @return {Array} `list` without repeating elements.\n     * @see R.transduce\n     * @example\n     *\n     *      var l = [1, -1, 1, 3, 4, -4, -4, -5, 5, 3, 3];\n     *      R.dropRepeatsWith(R.eqBy(Math.abs), l); //=> [1, 3, 4, -5, 3]\n     */\n    var dropRepeatsWith = _curry2(_dispatchable('dropRepeatsWith', _xdropRepeatsWith, function dropRepeatsWith(pred, list) {\n        var result = [];\n        var idx = 1;\n        var len = list.length;\n        if (len !== 0) {\n            result[0] = list[0];\n            while (idx < len) {\n                if (!pred(last(result), list[idx])) {\n                    result[result.length] = list[idx];\n                }\n                idx += 1;\n            }\n        }\n        return result;\n    }));\n\n    /**\n     * Takes a function and two values in its domain and returns `true` if the\n     * values map to the same value in the codomain; `false` otherwise.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.18.0\n     * @category Relation\n     * @sig (a -> b) -> a -> a -> Boolean\n     * @param {Function} f\n     * @param {*} x\n     * @param {*} y\n     * @return {Boolean}\n     * @example\n     *\n     *      R.eqBy(Math.abs, 5, -5); //=> true\n     */\n    var eqBy = _curry3(function eqBy(f, x, y) {\n        return equals(f(x), f(y));\n    });\n\n    /**\n     * Reports whether two objects have the same value, in `R.equals` terms, for\n     * the specified property. Useful as a curried predicate.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.1.0\n     * @category Object\n     * @sig k -> {k: v} -> {k: v} -> Boolean\n     * @param {String} prop The name of the property to compare\n     * @param {Object} obj1\n     * @param {Object} obj2\n     * @return {Boolean}\n     *\n     * @example\n     *\n     *      var o1 = { a: 1, b: 2, c: 3, d: 4 };\n     *      var o2 = { a: 10, b: 20, c: 3, d: 40 };\n     *      R.eqProps('a', o1, o2); //=> false\n     *      R.eqProps('c', o1, o2); //=> true\n     */\n    var eqProps = _curry3(function eqProps(prop, obj1, obj2) {\n        return equals(obj1[prop], obj2[prop]);\n    });\n\n    /**\n     * Splits a list into sub-lists stored in an object, based on the result of\n     * calling a String-returning function on each element, and grouping the\n     * results according to values returned.\n     *\n     * Dispatches to the `groupBy` method of the second argument, if present.\n     *\n     * Acts as a transducer if a transformer is given in list position.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.1.0\n     * @category List\n     * @sig (a -> String) -> [a] -> {String: [a]}\n     * @param {Function} fn Function :: a -> String\n     * @param {Array} list The array to group\n     * @return {Object} An object with the output of `fn` for keys, mapped to arrays of elements\n     *         that produced that key when passed to `fn`.\n     * @see R.transduce\n     * @example\n     *\n     *      var byGrade = R.groupBy(function(student) {\n     *        var score = student.score;\n     *        return score < 65 ? 'F' :\n     *               score < 70 ? 'D' :\n     *               score < 80 ? 'C' :\n     *               score < 90 ? 'B' : 'A';\n     *      });\n     *      var students = [{name: 'Abby', score: 84},\n     *                      {name: 'Eddy', score: 58},\n     *                      // ...\n     *                      {name: 'Jack', score: 69}];\n     *      byGrade(students);\n     *      // {\n     *      //   'A': [{name: 'Dianne', score: 99}],\n     *      //   'B': [{name: 'Abby', score: 84}]\n     *      //   // ...,\n     *      //   'F': [{name: 'Eddy', score: 58}]\n     *      // }\n     */\n    var groupBy = _curry2(_dispatchable('groupBy', _xgroupBy, reduceBy(function (acc, item) {\n        if (acc == null) {\n            acc = [];\n        }\n        acc.push(item);\n        return acc;\n    }, null)));\n\n    /**\n     * Given a function that generates a key, turns a list of objects into an\n     * object indexing the objects by the given key. Note that if multiple\n     * objects generate the same value for the indexing key only the last value\n     * will be included in the generated object.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.19.0\n     * @category List\n     * @sig (a -> String) -> [{k: v}] -> {k: {k: v}}\n     * @param {Function} fn Function :: a -> String\n     * @param {Array} array The array of objects to index\n     * @return {Object} An object indexing each array element by the given property.\n     * @example\n     *\n     *      var list = [{id: 'xyz', title: 'A'}, {id: 'abc', title: 'B'}];\n     *      R.indexBy(R.prop('id'), list);\n     *      //=> {abc: {id: 'abc', title: 'B'}, xyz: {id: 'xyz', title: 'A'}}\n     */\n    var indexBy = reduceBy(function (acc, elem) {\n        return elem;\n    }, null);\n\n    /**\n     * Returns the position of the first occurrence of an item in an array, or -1\n     * if the item is not included in the array. `R.equals` is used to determine\n     * equality.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.1.0\n     * @category List\n     * @sig a -> [a] -> Number\n     * @param {*} target The item to find.\n     * @param {Array} xs The array to search in.\n     * @return {Number} the index of the target, or -1 if the target is not found.\n     * @see R.lastIndexOf\n     * @example\n     *\n     *      R.indexOf(3, [1,2,3,4]); //=> 2\n     *      R.indexOf(10, [1,2,3,4]); //=> -1\n     */\n    var indexOf = _curry2(function indexOf(target, xs) {\n        return typeof xs.indexOf === 'function' && !_isArray(xs) ? xs.indexOf(target) : _indexOf(xs, target, 0);\n    });\n\n    /**\n     * juxt applies a list of functions to a list of values.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.19.0\n     * @category Function\n     * @sig [(a, b, ..., m) -> n] -> ((a, b, ..., m) -> [n])\n     * @param {Array} fns An array of functions\n     * @return {Function} A function that returns a list of values after applying each of the original `fns` to its parameters.\n     * @see R.applySpec\n     * @example\n     *\n     *      var range = R.juxt([Math.min, Math.max]);\n     *      range(3, 4, 9, -3); //=> [-3, 9]\n     */\n    var juxt = _curry1(function juxt(fns) {\n        return converge(_arrayOf, fns);\n    });\n\n    /**\n     * Returns a lens for the given getter and setter functions. The getter \"gets\"\n     * the value of the focus; the setter \"sets\" the value of the focus. The setter\n     * should not mutate the data structure.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.8.0\n     * @category Object\n     * @typedefn Lens s a = Functor f => (a -> f a) -> s -> f s\n     * @sig (s -> a) -> ((a, s) -> s) -> Lens s a\n     * @param {Function} getter\n     * @param {Function} setter\n     * @return {Lens}\n     * @see R.view, R.set, R.over, R.lensIndex, R.lensProp\n     * @example\n     *\n     *      var xLens = R.lens(R.prop('x'), R.assoc('x'));\n     *\n     *      R.view(xLens, {x: 1, y: 2});            //=> 1\n     *      R.set(xLens, 4, {x: 1, y: 2});          //=> {x: 4, y: 2}\n     *      R.over(xLens, R.negate, {x: 1, y: 2});  //=> {x: -1, y: 2}\n     */\n    var lens = _curry2(function lens(getter, setter) {\n        return function (toFunctorFn) {\n            return function (target) {\n                return map(function (focus) {\n                    return setter(focus, target);\n                }, toFunctorFn(getter(target)));\n            };\n        };\n    });\n\n    /**\n     * Returns a lens whose focus is the specified index.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.14.0\n     * @category Object\n     * @typedefn Lens s a = Functor f => (a -> f a) -> s -> f s\n     * @sig Number -> Lens s a\n     * @param {Number} n\n     * @return {Lens}\n     * @see R.view, R.set, R.over\n     * @example\n     *\n     *      var headLens = R.lensIndex(0);\n     *\n     *      R.view(headLens, ['a', 'b', 'c']);            //=> 'a'\n     *      R.set(headLens, 'x', ['a', 'b', 'c']);        //=> ['x', 'b', 'c']\n     *      R.over(headLens, R.toUpper, ['a', 'b', 'c']); //=> ['A', 'b', 'c']\n     */\n    var lensIndex = _curry1(function lensIndex(n) {\n        return lens(nth(n), update(n));\n    });\n\n    /**\n     * Returns a lens whose focus is the specified path.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.19.0\n     * @category Object\n     * @typedefn Lens s a = Functor f => (a -> f a) -> s -> f s\n     * @sig [String] -> Lens s a\n     * @param {Array} path The path to use.\n     * @return {Lens}\n     * @see R.view, R.set, R.over\n     * @example\n     *\n     *      var xyLens = R.lensPath(['x', 'y']);\n     *\n     *      R.view(xyLens, {x: {y: 2, z: 3}});            //=> 2\n     *      R.set(xyLens, 4, {x: {y: 2, z: 3}});          //=> {x: {y: 4, z: 3}}\n     *      R.over(xyLens, R.negate, {x: {y: 2, z: 3}});  //=> {x: {y: -2, z: 3}}\n     */\n    var lensPath = _curry1(function lensPath(p) {\n        return lens(path(p), assocPath(p));\n    });\n\n    /**\n     * Returns a lens whose focus is the specified property.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.14.0\n     * @category Object\n     * @typedefn Lens s a = Functor f => (a -> f a) -> s -> f s\n     * @sig String -> Lens s a\n     * @param {String} k\n     * @return {Lens}\n     * @see R.view, R.set, R.over\n     * @example\n     *\n     *      var xLens = R.lensProp('x');\n     *\n     *      R.view(xLens, {x: 1, y: 2});            //=> 1\n     *      R.set(xLens, 4, {x: 1, y: 2});          //=> {x: 4, y: 2}\n     *      R.over(xLens, R.negate, {x: 1, y: 2});  //=> {x: -1, y: 2}\n     */\n    var lensProp = _curry1(function lensProp(k) {\n        return lens(prop(k), assoc(k));\n    });\n\n    /**\n     * \"lifts\" a function to be the specified arity, so that it may \"map over\" that\n     * many lists, Functions or other objects that satisfy the [FantasyLand Apply spec](https://github.com/fantasyland/fantasy-land#apply).\n     *\n     * @func\n     * @memberOf R\n     * @since v0.7.0\n     * @category Function\n     * @sig Number -> (*... -> *) -> ([*]... -> [*])\n     * @param {Function} fn The function to lift into higher context\n     * @return {Function} The lifted function.\n     * @see R.lift, R.ap\n     * @example\n     *\n     *      var madd3 = R.liftN(3, R.curryN(3, (...args) => R.sum(args)));\n     *      madd3([1,2,3], [1,2,3], [1]); //=> [3, 4, 5, 4, 5, 6, 5, 6, 7]\n     */\n    var liftN = _curry2(function liftN(arity, fn) {\n        var lifted = curryN(arity, fn);\n        return curryN(arity, function () {\n            return _reduce(ap, map(lifted, arguments[0]), _slice(arguments, 1));\n        });\n    });\n\n    /**\n     * Returns the mean of the given list of numbers.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.14.0\n     * @category Math\n     * @sig [Number] -> Number\n     * @param {Array} list\n     * @return {Number}\n     * @example\n     *\n     *      R.mean([2, 7, 9]); //=> 6\n     *      R.mean([]); //=> NaN\n     */\n    var mean = _curry1(function mean(list) {\n        return sum(list) / list.length;\n    });\n\n    /**\n     * Returns the median of the given list of numbers.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.14.0\n     * @category Math\n     * @sig [Number] -> Number\n     * @param {Array} list\n     * @return {Number}\n     * @example\n     *\n     *      R.median([2, 9, 7]); //=> 7\n     *      R.median([7, 2, 10, 9]); //=> 8\n     *      R.median([]); //=> NaN\n     */\n    var median = _curry1(function median(list) {\n        var len = list.length;\n        if (len === 0) {\n            return NaN;\n        }\n        var width = 2 - len % 2;\n        var idx = (len - width) / 2;\n        return mean(_slice(list).sort(function (a, b) {\n            return a < b ? -1 : a > b ? 1 : 0;\n        }).slice(idx, idx + width));\n    });\n\n    /**\n     * Takes a predicate and a list or other \"filterable\" object and returns the\n     * pair of filterable objects of the same type of elements which do and do not\n     * satisfy, the predicate, respectively.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.1.4\n     * @category List\n     * @sig Filterable f => (a -> Boolean) -> f a -> [f a, f a]\n     * @param {Function} pred A predicate to determine which side the element belongs to.\n     * @param {Array} filterable the list (or other filterable) to partition.\n     * @return {Array} An array, containing first the subset of elements that satisfy the\n     *         predicate, and second the subset of elements that do not satisfy.\n     * @see R.filter, R.reject\n     * @example\n     *\n     *      R.partition(R.contains('s'), ['sss', 'ttt', 'foo', 'bars']);\n     *      // => [ [ 'sss', 'bars' ],  [ 'ttt', 'foo' ] ]\n     *\n     *      R.partition(R.contains('s'), { a: 'sss', b: 'ttt', foo: 'bars' });\n     *      // => [ { a: 'sss', foo: 'bars' }, { b: 'ttt' }  ]\n     */\n    var partition = juxt([\n        filter,\n        reject\n    ]);\n\n    /**\n     * Performs left-to-right function composition. The leftmost function may have\n     * any arity; the remaining functions must be unary.\n     *\n     * In some libraries this function is named `sequence`.\n     *\n     * **Note:** The result of pipe is not automatically curried.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.1.0\n     * @category Function\n     * @sig (((a, b, ..., n) -> o), (o -> p), ..., (x -> y), (y -> z)) -> ((a, b, ..., n) -> z)\n     * @param {...Function} functions\n     * @return {Function}\n     * @see R.compose\n     * @example\n     *\n     *      var f = R.pipe(Math.pow, R.negate, R.inc);\n     *\n     *      f(3, 4); // -(3^4) + 1\n     */\n    var pipe = function pipe() {\n        if (arguments.length === 0) {\n            throw new Error('pipe requires at least one argument');\n        }\n        return _arity(arguments[0].length, reduce(_pipe, arguments[0], tail(arguments)));\n    };\n\n    /**\n     * Performs left-to-right composition of one or more Promise-returning\n     * functions. The leftmost function may have any arity; the remaining functions\n     * must be unary.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.10.0\n     * @category Function\n     * @sig ((a -> Promise b), (b -> Promise c), ..., (y -> Promise z)) -> (a -> Promise z)\n     * @param {...Function} functions\n     * @return {Function}\n     * @see R.composeP\n     * @example\n     *\n     *      //  followersForUser :: String -> Promise [User]\n     *      var followersForUser = R.pipeP(db.getUserById, db.getFollowers);\n     */\n    var pipeP = function pipeP() {\n        if (arguments.length === 0) {\n            throw new Error('pipeP requires at least one argument');\n        }\n        return _arity(arguments[0].length, reduce(_pipeP, arguments[0], tail(arguments)));\n    };\n\n    /**\n     * Multiplies together all the elements of a list.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.1.0\n     * @category Math\n     * @sig [Number] -> Number\n     * @param {Array} list An array of numbers\n     * @return {Number} The product of all the numbers in the list.\n     * @see R.reduce\n     * @example\n     *\n     *      R.product([2,4,6,8,100,1]); //=> 38400\n     */\n    var product = reduce(multiply, 1);\n\n    /**\n     * Transforms a [Traversable](https://github.com/fantasyland/fantasy-land#traversable)\n     * of [Applicative](https://github.com/fantasyland/fantasy-land#applicative) into an\n     * Applicative of Traversable.\n     *\n     * Dispatches to the `sequence` method of the second argument, if present.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.19.0\n     * @category List\n     * @sig (Applicative f, Traversable t) => (a -> f a) -> t (f a) -> f (t a)\n     * @param {Function} of\n     * @param {*} traversable\n     * @return {*}\n     * @see R.traverse\n     * @example\n     *\n     *      R.sequence(Maybe.of, [Just(1), Just(2), Just(3)]);   //=> Just([1, 2, 3])\n     *      R.sequence(Maybe.of, [Just(1), Just(2), Nothing()]); //=> Nothing()\n     *\n     *      R.sequence(R.of, Just([1, 2, 3])); //=> [Just(1), Just(2), Just(3)]\n     *      R.sequence(R.of, Nothing());       //=> [Nothing()]\n     */\n    var sequence = _curry2(function sequence(of, traversable) {\n        return typeof traversable.sequence === 'function' ? traversable.sequence(of) : reduceRight(function (acc, x) {\n            return ap(map(prepend, x), acc);\n        }, of([]), traversable);\n    });\n\n    /**\n     * Maps an [Applicative](https://github.com/fantasyland/fantasy-land#applicative)-returning\n     * function over a [Traversable](https://github.com/fantasyland/fantasy-land#traversable),\n     * then uses [`sequence`](#sequence) to transform the resulting Traversable of Applicative\n     * into an Applicative of Traversable.\n     *\n     * Dispatches to the `sequence` method of the third argument, if present.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.19.0\n     * @category List\n     * @sig (Applicative f, Traversable t) => (a -> f a) -> (a -> f b) -> t a -> f (t b)\n     * @param {Function} of\n     * @param {Function} f\n     * @param {*} traversable\n     * @return {*}\n     * @see R.sequence\n     * @example\n     *\n     *      // Returns `Nothing` if the given divisor is `0`\n     *      safeDiv = n => d => d === 0 ? Nothing() : Just(n / d)\n     *\n     *      R.traverse(Maybe.of, safeDiv(10), [2, 4, 5]); //=> Just([5, 2.5, 2])\n     *      R.traverse(Maybe.of, safeDiv(10), [2, 0, 5]); //=> Nothing\n     */\n    var traverse = _curry3(function traverse(of, f, traversable) {\n        return sequence(of, map(f, traversable));\n    });\n\n    /**\n     * Shorthand for `R.chain(R.identity)`, which removes one level of nesting from\n     * any [Chain](https://github.com/fantasyland/fantasy-land#chain).\n     *\n     * @func\n     * @memberOf R\n     * @since v0.3.0\n     * @category List\n     * @sig Chain c => c (c a) -> c a\n     * @param {*} list\n     * @return {*}\n     * @see R.flatten, R.chain\n     * @example\n     *\n     *      R.unnest([1, [2], [[3]]]); //=> [1, 2, [3]]\n     *      R.unnest([[1, 2], [3, 4], [5, 6]]); //=> [1, 2, 3, 4, 5, 6]\n     */\n    var unnest = chain(_identity);\n\n    var _contains = function _contains(a, list) {\n        return _indexOf(list, a, 0) >= 0;\n    };\n\n    //  mapPairs :: (Object, [String]) -> [String]\n    var _toString = function _toString(x, seen) {\n        var recur = function recur(y) {\n            var xs = seen.concat([x]);\n            return _contains(y, xs) ? '<Circular>' : _toString(y, xs);\n        };\n        //  mapPairs :: (Object, [String]) -> [String]\n        var mapPairs = function (obj, keys) {\n            return _map(function (k) {\n                return _quote(k) + ': ' + recur(obj[k]);\n            }, keys.slice().sort());\n        };\n        switch (Object.prototype.toString.call(x)) {\n        case '[object Arguments]':\n            return '(function() { return arguments; }(' + _map(recur, x).join(', ') + '))';\n        case '[object Array]':\n            return '[' + _map(recur, x).concat(mapPairs(x, reject(function (k) {\n                return /^\\d+$/.test(k);\n            }, keys(x)))).join(', ') + ']';\n        case '[object Boolean]':\n            return typeof x === 'object' ? 'new Boolean(' + recur(x.valueOf()) + ')' : x.toString();\n        case '[object Date]':\n            return 'new Date(' + (isNaN(x.valueOf()) ? recur(NaN) : _quote(_toISOString(x))) + ')';\n        case '[object Null]':\n            return 'null';\n        case '[object Number]':\n            return typeof x === 'object' ? 'new Number(' + recur(x.valueOf()) + ')' : 1 / x === -Infinity ? '-0' : x.toString(10);\n        case '[object String]':\n            return typeof x === 'object' ? 'new String(' + recur(x.valueOf()) + ')' : _quote(x);\n        case '[object Undefined]':\n            return 'undefined';\n        default:\n            if (typeof x.toString === 'function') {\n                var repr = x.toString();\n                if (repr !== '[object Object]') {\n                    return repr;\n                }\n            }\n            return '{' + mapPairs(x, keys(x)).join(', ') + '}';\n        }\n    };\n\n    /**\n     * Performs right-to-left function composition. The rightmost function may have\n     * any arity; the remaining functions must be unary.\n     *\n     * **Note:** The result of compose is not automatically curried.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.1.0\n     * @category Function\n     * @sig ((y -> z), (x -> y), ..., (o -> p), ((a, b, ..., n) -> o)) -> ((a, b, ..., n) -> z)\n     * @param {...Function} functions\n     * @return {Function}\n     * @see R.pipe\n     * @example\n     *\n     *      var f = R.compose(R.inc, R.negate, Math.pow);\n     *\n     *      f(3, 4); // -(3^4) + 1\n     */\n    var compose = function compose() {\n        if (arguments.length === 0) {\n            throw new Error('compose requires at least one argument');\n        }\n        return pipe.apply(this, reverse(arguments));\n    };\n\n    /**\n     * Returns the right-to-left Kleisli composition of the provided functions,\n     * each of which must return a value of a type supported by [`chain`](#chain).\n     *\n     * `R.composeK(h, g, f)` is equivalent to `R.compose(R.chain(h), R.chain(g), R.chain(f))`.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.16.0\n     * @category Function\n     * @sig Chain m => ((y -> m z), (x -> m y), ..., (a -> m b)) -> (m a -> m z)\n     * @param {...Function}\n     * @return {Function}\n     * @see R.pipeK\n     * @example\n     *\n     *      //  parseJson :: String -> Maybe *\n     *      //  get :: String -> Object -> Maybe *\n     *\n     *      //  getStateCode :: Maybe String -> Maybe String\n     *      var getStateCode = R.composeK(\n     *        R.compose(Maybe.of, R.toUpper),\n     *        get('state'),\n     *        get('address'),\n     *        get('user'),\n     *        parseJson\n     *      );\n     *\n     *      getStateCode(Maybe.of('{\"user\":{\"address\":{\"state\":\"ny\"}}}'));\n     *      //=> Just('NY')\n     *      getStateCode(Maybe.of('[Invalid JSON]'));\n     *      //=> Nothing()\n     */\n    var composeK = function composeK() {\n        return compose.apply(this, prepend(identity, map(chain, arguments)));\n    };\n\n    /**\n     * Performs right-to-left composition of one or more Promise-returning\n     * functions. The rightmost function may have any arity; the remaining\n     * functions must be unary.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.10.0\n     * @category Function\n     * @sig ((y -> Promise z), (x -> Promise y), ..., (a -> Promise b)) -> (a -> Promise z)\n     * @param {...Function} functions\n     * @return {Function}\n     * @see R.pipeP\n     * @example\n     *\n     *      //  followersForUser :: String -> Promise [User]\n     *      var followersForUser = R.composeP(db.getFollowers, db.getUserById);\n     */\n    var composeP = function composeP() {\n        if (arguments.length === 0) {\n            throw new Error('composeP requires at least one argument');\n        }\n        return pipeP.apply(this, reverse(arguments));\n    };\n\n    /**\n     * Wraps a constructor function inside a curried function that can be called\n     * with the same arguments and returns the same type.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.1.0\n     * @category Function\n     * @sig (* -> {*}) -> (* -> {*})\n     * @param {Function} Fn The constructor function to wrap.\n     * @return {Function} A wrapped, curried constructor function.\n     * @example\n     *\n     *      // Constructor function\n     *      var Widget = config => {\n     *        // ...\n     *      };\n     *      Widget.prototype = {\n     *        // ...\n     *      };\n     *      var allConfigs = [\n     *        // ...\n     *      ];\n     *      R.map(R.construct(Widget), allConfigs); // a list of Widgets\n     */\n    var construct = _curry1(function construct(Fn) {\n        return constructN(Fn.length, Fn);\n    });\n\n    /**\n     * Returns `true` if the specified value is equal, in `R.equals` terms, to at\n     * least one element of the given list; `false` otherwise.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.1.0\n     * @category List\n     * @sig a -> [a] -> Boolean\n     * @param {Object} a The item to compare against.\n     * @param {Array} list The array to consider.\n     * @return {Boolean} `true` if the item is in the list, `false` otherwise.\n     * @see R.any\n     * @example\n     *\n     *      R.contains(3, [1, 2, 3]); //=> true\n     *      R.contains(4, [1, 2, 3]); //=> false\n     *      R.contains([42], [[42]]); //=> true\n     */\n    var contains = _curry2(_contains);\n\n    /**\n     * Finds the set (i.e. no duplicates) of all elements in the first list not\n     * contained in the second list.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.1.0\n     * @category Relation\n     * @sig [*] -> [*] -> [*]\n     * @param {Array} list1 The first list.\n     * @param {Array} list2 The second list.\n     * @return {Array} The elements in `list1` that are not in `list2`.\n     * @see R.differenceWith\n     * @example\n     *\n     *      R.difference([1,2,3,4], [7,6,5,4,3]); //=> [1,2]\n     *      R.difference([7,6,5,4,3], [1,2,3,4]); //=> [7,6,5]\n     */\n    var difference = _curry2(function difference(first, second) {\n        var out = [];\n        var idx = 0;\n        var firstLen = first.length;\n        while (idx < firstLen) {\n            if (!_contains(first[idx], second) && !_contains(first[idx], out)) {\n                out[out.length] = first[idx];\n            }\n            idx += 1;\n        }\n        return out;\n    });\n\n    /**\n     * Returns a new list without any consecutively repeating elements. `R.equals`\n     * is used to determine equality.\n     *\n     * Dispatches to the `dropRepeats` method of the first argument, if present.\n     *\n     * Acts as a transducer if a transformer is given in list position.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.14.0\n     * @category List\n     * @sig [a] -> [a]\n     * @param {Array} list The array to consider.\n     * @return {Array} `list` without repeating elements.\n     * @see R.transduce\n     * @example\n     *\n     *     R.dropRepeats([1, 1, 1, 2, 3, 4, 4, 2, 2]); //=> [1, 2, 3, 4, 2]\n     */\n    var dropRepeats = _curry1(_dispatchable('dropRepeats', _xdropRepeatsWith(equals), dropRepeatsWith(equals)));\n\n    /**\n     * \"lifts\" a function of arity > 1 so that it may \"map over\" a list, Function or other\n     * object that satisfies the [FantasyLand Apply spec](https://github.com/fantasyland/fantasy-land#apply).\n     *\n     * @func\n     * @memberOf R\n     * @since v0.7.0\n     * @category Function\n     * @sig (*... -> *) -> ([*]... -> [*])\n     * @param {Function} fn The function to lift into higher context\n     * @return {Function} The lifted function.\n     * @see R.liftN\n     * @example\n     *\n     *      var madd3 = R.lift(R.curry((a, b, c) => a + b + c));\n     *\n     *      madd3([1,2,3], [1,2,3], [1]); //=> [3, 4, 5, 4, 5, 6, 5, 6, 7]\n     *\n     *      var madd5 = R.lift(R.curry((a, b, c, d, e) => a + b + c + d + e));\n     *\n     *      madd5([1,2], [3], [4, 5], [6], [7, 8]); //=> [21, 22, 22, 23, 22, 23, 23, 24]\n     */\n    var lift = _curry1(function lift(fn) {\n        return liftN(fn.length, fn);\n    });\n\n    /**\n     * Returns a partial copy of an object omitting the keys specified.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.1.0\n     * @category Object\n     * @sig [String] -> {String: *} -> {String: *}\n     * @param {Array} names an array of String property names to omit from the new object\n     * @param {Object} obj The object to copy from\n     * @return {Object} A new object with properties from `names` not on it.\n     * @see R.pick\n     * @example\n     *\n     *      R.omit(['a', 'd'], {a: 1, b: 2, c: 3, d: 4}); //=> {b: 2, c: 3}\n     */\n    var omit = _curry2(function omit(names, obj) {\n        var result = {};\n        for (var prop in obj) {\n            if (!_contains(prop, names)) {\n                result[prop] = obj[prop];\n            }\n        }\n        return result;\n    });\n\n    /**\n     * Returns the left-to-right Kleisli composition of the provided functions,\n     * each of which must return a value of a type supported by [`chain`](#chain).\n     *\n     * `R.pipeK(f, g, h)` is equivalent to `R.pipe(R.chain(f), R.chain(g), R.chain(h))`.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.16.0\n     * @category Function\n     * @sig Chain m => ((a -> m b), (b -> m c), ..., (y -> m z)) -> (m a -> m z)\n     * @param {...Function}\n     * @return {Function}\n     * @see R.composeK\n     * @example\n     *\n     *      //  parseJson :: String -> Maybe *\n     *      //  get :: String -> Object -> Maybe *\n     *\n     *      //  getStateCode :: Maybe String -> Maybe String\n     *      var getStateCode = R.pipeK(\n     *        parseJson,\n     *        get('user'),\n     *        get('address'),\n     *        get('state'),\n     *        R.compose(Maybe.of, R.toUpper)\n     *      );\n     *\n     *      getStateCode(Maybe.of('{\"user\":{\"address\":{\"state\":\"ny\"}}}'));\n     *      //=> Just('NY')\n     *      getStateCode(Maybe.of('[Invalid JSON]'));\n     *      //=> Nothing()\n     */\n    var pipeK = function pipeK() {\n        return composeK.apply(this, reverse(arguments));\n    };\n\n    /**\n     * Returns the string representation of the given value. `eval`'ing the output\n     * should result in a value equivalent to the input value. Many of the built-in\n     * `toString` methods do not satisfy this requirement.\n     *\n     * If the given value is an `[object Object]` with a `toString` method other\n     * than `Object.prototype.toString`, this method is invoked with no arguments\n     * to produce the return value. This means user-defined constructor functions\n     * can provide a suitable `toString` method. For example:\n     *\n     *     function Point(x, y) {\n     *       this.x = x;\n     *       this.y = y;\n     *     }\n     *\n     *     Point.prototype.toString = function() {\n     *       return 'new Point(' + this.x + ', ' + this.y + ')';\n     *     };\n     *\n     *     R.toString(new Point(1, 2)); //=> 'new Point(1, 2)'\n     *\n     * @func\n     * @memberOf R\n     * @since v0.14.0\n     * @category String\n     * @sig * -> String\n     * @param {*} val\n     * @return {String}\n     * @example\n     *\n     *      R.toString(42); //=> '42'\n     *      R.toString('abc'); //=> '\"abc\"'\n     *      R.toString([1, 2, 3]); //=> '[1, 2, 3]'\n     *      R.toString({foo: 1, bar: 2, baz: 3}); //=> '{\"bar\": 2, \"baz\": 3, \"foo\": 1}'\n     *      R.toString(new Date('2001-02-03T04:05:06Z')); //=> 'new Date(\"2001-02-03T04:05:06.000Z\")'\n     */\n    var toString = _curry1(function toString(val) {\n        return _toString(val, []);\n    });\n\n    /**\n     * Returns a new list without values in the first argument.\n     * `R.equals` is used to determine equality.\n     *\n     * Acts as a transducer if a transformer is given in list position.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.19.0\n     * @category List\n     * @sig [a] -> [a] -> [a]\n     * @param {Array} list1 The values to be removed from `list2`.\n     * @param {Array} list2 The array to remove values from.\n     * @return {Array} The new array without values in `list1`.\n     * @see R.transduce\n     * @example\n     *\n     *      R.without([1, 2], [1, 2, 1, 3, 4]); //=> [3, 4]\n     */\n    var without = _curry2(function (xs, list) {\n        return reject(flip(_contains)(xs), list);\n    });\n\n    // A simple Set type that honours R.equals semantics\n    /* globals Set */\n    /**\n       * Combines the logic for checking whether an item is a member of the set and\n       * for adding a new item to the set.\n       *\n       * @param item       The item to check or add to the Set instance.\n       * @param shouldAdd  If true, the item will be added to the set if it doesn't\n       *                   already exist.\n       * @param set        The set instance to check or add to.\n       * @return {boolean} When shouldAdd is true, this will return true when a new\n       *                   item was added otherwise false. When shouldAdd is false,\n       *                   this will return true if the item already exists, otherwise\n       *                   false.\n       */\n    // distinguish between +0 and -0\n    // these types can all utilise Set\n    // set._items['boolean'] holds a two element array\n    // representing [ falseExists, trueExists ]\n    // compare functions for reference equality\n    /* falls through */\n    // reduce the search size of heterogeneous sets by creating buckets\n    // for each type.\n    // scan through all previously applied items\n    var _Set = function () {\n        function _Set() {\n            /* globals Set */\n            this._nativeSet = typeof Set === 'function' ? new Set() : null;\n            this._items = {};\n        }\n        _Set.prototype.add = function (item) {\n            return hasOrAdd(item, true, this);\n        };\n        _Set.prototype.has = function (item) {\n            return hasOrAdd(item, false, this);\n        };\n        /**\n       * Combines the logic for checking whether an item is a member of the set and\n       * for adding a new item to the set.\n       *\n       * @param item       The item to check or add to the Set instance.\n       * @param shouldAdd  If true, the item will be added to the set if it doesn't\n       *                   already exist.\n       * @param set        The set instance to check or add to.\n       * @return {boolean} When shouldAdd is true, this will return true when a new\n       *                   item was added otherwise false. When shouldAdd is false,\n       *                   this will return true if the item already exists, otherwise\n       *                   false.\n       */\n        function hasOrAdd(item, shouldAdd, set) {\n            var type = typeof item;\n            var prevSize, newSize;\n            switch (type) {\n            case 'string':\n            case 'number':\n                // distinguish between +0 and -0\n                if (item === 0 && !set._items['-0'] && 1 / item === -Infinity) {\n                    if (shouldAdd) {\n                        set._items['-0'] = true;\n                    }\n                    return shouldAdd;\n                }\n                // these types can all utilise Set\n                if (set._nativeSet !== null) {\n                    if (shouldAdd) {\n                        prevSize = set._nativeSet.size;\n                        set._nativeSet.add(item);\n                        newSize = set._nativeSet.size;\n                        return newSize > prevSize;\n                    } else {\n                        return set._nativeSet.has(item);\n                    }\n                } else {\n                    if (!(type in set._items)) {\n                        if (shouldAdd) {\n                            set._items[type] = {};\n                            set._items[type][item] = true;\n                        }\n                        return shouldAdd;\n                    } else if (item in set._items[type]) {\n                        return !shouldAdd;\n                    } else {\n                        if (shouldAdd) {\n                            set._items[type][item] = true;\n                        }\n                        return shouldAdd;\n                    }\n                }\n            case 'boolean':\n                // set._items['boolean'] holds a two element array\n                // representing [ falseExists, trueExists ]\n                if (type in set._items) {\n                    var bIdx = item ? 1 : 0;\n                    if (set._items[type][bIdx]) {\n                        return !shouldAdd;\n                    } else {\n                        if (shouldAdd) {\n                            set._items[type][bIdx] = true;\n                        }\n                        return shouldAdd;\n                    }\n                } else {\n                    if (shouldAdd) {\n                        set._items[type] = item ? [\n                            false,\n                            true\n                        ] : [\n                            true,\n                            false\n                        ];\n                    }\n                    return shouldAdd;\n                }\n            case 'function':\n                // compare functions for reference equality\n                if (set._nativeSet !== null) {\n                    if (shouldAdd) {\n                        prevSize = set._nativeSet.size;\n                        set._nativeSet.add(item);\n                        newSize = set._nativeSet.size;\n                        return newSize > prevSize;\n                    } else {\n                        return set._nativeSet.has(item);\n                    }\n                } else {\n                    if (!(type in set._items)) {\n                        if (shouldAdd) {\n                            set._items[type] = [item];\n                        }\n                        return shouldAdd;\n                    }\n                    if (!_contains(item, set._items[type])) {\n                        if (shouldAdd) {\n                            set._items[type].push(item);\n                        }\n                        return shouldAdd;\n                    }\n                }\n                return !shouldAdd;\n            case 'undefined':\n                if (set._items[type]) {\n                    return !shouldAdd;\n                } else {\n                    if (shouldAdd) {\n                        set._items[type] = true;\n                    }\n                    return shouldAdd;\n                }\n            case 'object':\n                if (item === null) {\n                    if (!set._items['null']) {\n                        if (shouldAdd) {\n                            set._items['null'] = true;\n                        }\n                        return shouldAdd;\n                    }\n                    return !shouldAdd;\n                }\n            /* falls through */\n            default:\n                // reduce the search size of heterogeneous sets by creating buckets\n                // for each type.\n                type = Object.prototype.toString.call(item);\n                if (!(type in set._items)) {\n                    if (shouldAdd) {\n                        set._items[type] = [item];\n                    }\n                    return shouldAdd;\n                }\n                // scan through all previously applied items\n                if (!_contains(item, set._items[type])) {\n                    if (shouldAdd) {\n                        set._items[type].push(item);\n                    }\n                    return shouldAdd;\n                }\n                return !shouldAdd;\n            }\n        }\n        return _Set;\n    }();\n\n    /**\n     * A function wrapping calls to the two functions in an `&&` operation,\n     * returning the result of the first function if it is false-y and the result\n     * of the second function otherwise. Note that this is short-circuited,\n     * meaning that the second function will not be invoked if the first returns a\n     * false-y value.\n     *\n     * In addition to functions, `R.both` also accepts any fantasy-land compatible\n     * applicative functor.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.12.0\n     * @category Logic\n     * @sig (*... -> Boolean) -> (*... -> Boolean) -> (*... -> Boolean)\n     * @param {Function} f a predicate\n     * @param {Function} g another predicate\n     * @return {Function} a function that applies its arguments to `f` and `g` and `&&`s their outputs together.\n     * @see R.and\n     * @example\n     *\n     *      var gt10 = x => x > 10;\n     *      var even = x => x % 2 === 0;\n     *      var f = R.both(gt10, even);\n     *      f(100); //=> true\n     *      f(101); //=> false\n     */\n    var both = _curry2(function both(f, g) {\n        return _isFunction(f) ? function _both() {\n            return f.apply(this, arguments) && g.apply(this, arguments);\n        } : lift(and)(f, g);\n    });\n\n    /**\n     * Takes a function `f` and returns a function `g` such that:\n     *\n     *   - applying `g` to zero or more arguments will give __true__ if applying\n     *     the same arguments to `f` gives a logical __false__ value; and\n     *\n     *   - applying `g` to zero or more arguments will give __false__ if applying\n     *     the same arguments to `f` gives a logical __true__ value.\n     *\n     * `R.complement` will work on all other functors as well.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.12.0\n     * @category Logic\n     * @sig (*... -> *) -> (*... -> Boolean)\n     * @param {Function} f\n     * @return {Function}\n     * @see R.not\n     * @example\n     *\n     *      var isEven = n => n % 2 === 0;\n     *      var isOdd = R.complement(isEven);\n     *      isOdd(21); //=> true\n     *      isOdd(42); //=> false\n     */\n    var complement = lift(not);\n\n    /**\n     * A function wrapping calls to the two functions in an `||` operation,\n     * returning the result of the first function if it is truth-y and the result\n     * of the second function otherwise. Note that this is short-circuited,\n     * meaning that the second function will not be invoked if the first returns a\n     * truth-y value.\n     *\n     * In addition to functions, `R.either` also accepts any fantasy-land compatible\n     * applicative functor.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.12.0\n     * @category Logic\n     * @sig (*... -> Boolean) -> (*... -> Boolean) -> (*... -> Boolean)\n     * @param {Function} f a predicate\n     * @param {Function} g another predicate\n     * @return {Function} a function that applies its arguments to `f` and `g` and `||`s their outputs together.\n     * @see R.or\n     * @example\n     *\n     *      var gt10 = x => x > 10;\n     *      var even = x => x % 2 === 0;\n     *      var f = R.either(gt10, even);\n     *      f(101); //=> true\n     *      f(8); //=> true\n     */\n    var either = _curry2(function either(f, g) {\n        return _isFunction(f) ? function _either() {\n            return f.apply(this, arguments) || g.apply(this, arguments);\n        } : lift(or)(f, g);\n    });\n\n    /**\n     * Turns a named method with a specified arity into a function that can be\n     * called directly supplied with arguments and a target object.\n     *\n     * The returned function is curried and accepts `arity + 1` parameters where\n     * the final parameter is the target object.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.1.0\n     * @category Function\n     * @sig Number -> String -> (a -> b -> ... -> n -> Object -> *)\n     * @param {Number} arity Number of arguments the returned function should take\n     *        before the target object.\n     * @param {String} method Name of the method to call.\n     * @return {Function} A new curried function.\n     * @example\n     *\n     *      var sliceFrom = R.invoker(1, 'slice');\n     *      sliceFrom(6, 'abcdefghijklm'); //=> 'ghijklm'\n     *      var sliceFrom6 = R.invoker(2, 'slice')(6);\n     *      sliceFrom6(8, 'abcdefghijklm'); //=> 'gh'\n     */\n    var invoker = _curry2(function invoker(arity, method) {\n        return curryN(arity + 1, function () {\n            var target = arguments[arity];\n            if (target != null && is(Function, target[method])) {\n                return target[method].apply(target, _slice(arguments, 0, arity));\n            }\n            throw new TypeError(toString(target) + ' does not have a method named \"' + method + '\"');\n        });\n    });\n\n    /**\n     * Returns a string made by inserting the `separator` between each element and\n     * concatenating all the elements into a single string.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.1.0\n     * @category List\n     * @sig String -> [a] -> String\n     * @param {Number|String} separator The string used to separate the elements.\n     * @param {Array} xs The elements to join into a string.\n     * @return {String} str The string made by concatenating `xs` with `separator`.\n     * @see R.split\n     * @example\n     *\n     *      var spacer = R.join(' ');\n     *      spacer(['a', 2, 3.4]);   //=> 'a 2 3.4'\n     *      R.join('|', [1, 2, 3]);    //=> '1|2|3'\n     */\n    var join = invoker(1, 'join');\n\n    /**\n     * Creates a new function that, when invoked, caches the result of calling `fn`\n     * for a given argument set and returns the result. Subsequent calls to the\n     * memoized `fn` with the same argument set will not result in an additional\n     * call to `fn`; instead, the cached result for that set of arguments will be\n     * returned.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.1.0\n     * @category Function\n     * @sig (*... -> a) -> (*... -> a)\n     * @param {Function} fn The function to memoize.\n     * @return {Function} Memoized version of `fn`.\n     * @example\n     *\n     *      var count = 0;\n     *      var factorial = R.memoize(n => {\n     *        count += 1;\n     *        return R.product(R.range(1, n + 1));\n     *      });\n     *      factorial(5); //=> 120\n     *      factorial(5); //=> 120\n     *      factorial(5); //=> 120\n     *      count; //=> 1\n     */\n    var memoize = _curry1(function memoize(fn) {\n        var cache = {};\n        return _arity(fn.length, function () {\n            var key = toString(arguments);\n            if (!_has(key, cache)) {\n                cache[key] = fn.apply(this, arguments);\n            }\n            return cache[key];\n        });\n    });\n\n    /**\n     * Splits a string into an array of strings based on the given\n     * separator.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.1.0\n     * @category String\n     * @sig (String | RegExp) -> String -> [String]\n     * @param {String|RegExp} sep The pattern.\n     * @param {String} str The string to separate into an array.\n     * @return {Array} The array of strings from `str` separated by `str`.\n     * @see R.join\n     * @example\n     *\n     *      var pathComponents = R.split('/');\n     *      R.tail(pathComponents('/usr/local/bin/node')); //=> ['usr', 'local', 'bin', 'node']\n     *\n     *      R.split('.', 'a.b.c.xyz.d'); //=> ['a', 'b', 'c', 'xyz', 'd']\n     */\n    var split = invoker(1, 'split');\n\n    /**\n     * Determines whether a given string matches a given regular expression.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.12.0\n     * @category String\n     * @sig RegExp -> String -> Boolean\n     * @param {RegExp} pattern\n     * @param {String} str\n     * @return {Boolean}\n     * @see R.match\n     * @example\n     *\n     *      R.test(/^x/, 'xyz'); //=> true\n     *      R.test(/^y/, 'xyz'); //=> false\n     */\n    var test = _curry2(function test(pattern, str) {\n        if (!_isRegExp(pattern)) {\n            throw new TypeError('\\u2018test\\u2019 requires a value of type RegExp as its first argument; received ' + toString(pattern));\n        }\n        return _cloneRegExp(pattern).test(str);\n    });\n\n    /**\n     * The lower case version of a string.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.9.0\n     * @category String\n     * @sig String -> String\n     * @param {String} str The string to lower case.\n     * @return {String} The lower case version of `str`.\n     * @see R.toUpper\n     * @example\n     *\n     *      R.toLower('XYZ'); //=> 'xyz'\n     */\n    var toLower = invoker(0, 'toLowerCase');\n\n    /**\n     * The upper case version of a string.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.9.0\n     * @category String\n     * @sig String -> String\n     * @param {String} str The string to upper case.\n     * @return {String} The upper case version of `str`.\n     * @see R.toLower\n     * @example\n     *\n     *      R.toUpper('abc'); //=> 'ABC'\n     */\n    var toUpper = invoker(0, 'toUpperCase');\n\n    /**\n     * Returns a new list containing only one copy of each element in the original\n     * list, based upon the value returned by applying the supplied function to\n     * each list element. Prefers the first item if the supplied function produces\n     * the same value on two items. `R.equals` is used for comparison.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.16.0\n     * @category List\n     * @sig (a -> b) -> [a] -> [a]\n     * @param {Function} fn A function used to produce a value to use during comparisons.\n     * @param {Array} list The array to consider.\n     * @return {Array} The list of unique items.\n     * @example\n     *\n     *      R.uniqBy(Math.abs, [-1, -5, 2, 10, 1, 2]); //=> [-1, -5, 2, 10]\n     */\n    var uniqBy = _curry2(function uniqBy(fn, list) {\n        var set = new _Set();\n        var result = [];\n        var idx = 0;\n        var appliedItem, item;\n        while (idx < list.length) {\n            item = list[idx];\n            appliedItem = fn(item);\n            if (set.add(appliedItem)) {\n                result.push(item);\n            }\n            idx += 1;\n        }\n        return result;\n    });\n\n    /**\n     * Returns the result of concatenating the given lists or strings.\n     *\n     * Dispatches to the `concat` method of the first argument, if present.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.1.0\n     * @category List\n     * @sig [a] -> [a] -> [a]\n     * @sig String -> String -> String\n     * @param {Array|String} a\n     * @param {Array|String} b\n     * @return {Array|String}\n     *\n     * @example\n     *\n     *      R.concat([], []); //=> []\n     *      R.concat([4, 5, 6], [1, 2, 3]); //=> [4, 5, 6, 1, 2, 3]\n     *      R.concat('ABC', 'DEF'); // 'ABCDEF'\n     */\n    var concat = flip(invoker(1, 'concat'));\n\n    /**\n     * Finds the set (i.e. no duplicates) of all elements contained in the first or\n     * second list, but not both.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.19.0\n     * @category Relation\n     * @sig [*] -> [*] -> [*]\n     * @param {Array} list1 The first list.\n     * @param {Array} list2 The second list.\n     * @return {Array} The elements in `list1` or `list2`, but not both.\n     * @see R.symmetricDifferenceWith\n     * @example\n     *\n     *      R.symmetricDifference([1,2,3,4], [7,6,5,4,3]); //=> [1,2,7,6,5]\n     *      R.symmetricDifference([7,6,5,4,3], [1,2,3,4]); //=> [7,6,5,1,2]\n     */\n    var symmetricDifference = _curry2(function symmetricDifference(list1, list2) {\n        return concat(difference(list1, list2), difference(list2, list1));\n    });\n\n    /**\n     * Finds the set (i.e. no duplicates) of all elements contained in the first or\n     * second list, but not both. Duplication is determined according to the value\n     * returned by applying the supplied predicate to two list elements.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.19.0\n     * @category Relation\n     * @sig (a -> a -> Boolean) -> [a] -> [a] -> [a]\n     * @param {Function} pred A predicate used to test whether two items are equal.\n     * @param {Array} list1 The first list.\n     * @param {Array} list2 The second list.\n     * @return {Array} The elements in `list1` or `list2`, but not both.\n     * @see R.symmetricDifference\n     * @example\n     *\n     *      var eqA = R.eqBy(R.prop('a'));\n     *      var l1 = [{a: 1}, {a: 2}, {a: 3}, {a: 4}];\n     *      var l2 = [{a: 3}, {a: 4}, {a: 5}, {a: 6}];\n     *      R.symmetricDifferenceWith(eqA, l1, l2); //=> [{a: 1}, {a: 2}, {a: 5}, {a: 6}]\n     */\n    var symmetricDifferenceWith = _curry3(function symmetricDifferenceWith(pred, list1, list2) {\n        return concat(differenceWith(pred, list1, list2), differenceWith(pred, list2, list1));\n    });\n\n    /**\n     * Returns a new list containing only one copy of each element in the original\n     * list. `R.equals` is used to determine equality.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.1.0\n     * @category List\n     * @sig [a] -> [a]\n     * @param {Array} list The array to consider.\n     * @return {Array} The list of unique items.\n     * @example\n     *\n     *      R.uniq([1, 1, 2, 1]); //=> [1, 2]\n     *      R.uniq([1, '1']);     //=> [1, '1']\n     *      R.uniq([[42], [42]]); //=> [[42]]\n     */\n    var uniq = uniqBy(identity);\n\n    /**\n     * Combines two lists into a set (i.e. no duplicates) composed of those\n     * elements common to both lists.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.1.0\n     * @category Relation\n     * @sig [*] -> [*] -> [*]\n     * @param {Array} list1 The first list.\n     * @param {Array} list2 The second list.\n     * @return {Array} The list of elements found in both `list1` and `list2`.\n     * @see R.intersectionWith\n     * @example\n     *\n     *      R.intersection([1,2,3,4], [7,6,5,4,3]); //=> [4, 3]\n     */\n    var intersection = _curry2(function intersection(list1, list2) {\n        var lookupList, filteredList;\n        if (list1.length > list2.length) {\n            lookupList = list1;\n            filteredList = list2;\n        } else {\n            lookupList = list2;\n            filteredList = list1;\n        }\n        return uniq(_filter(flip(_contains)(lookupList), filteredList));\n    });\n\n    /**\n     * Combines two lists into a set (i.e. no duplicates) composed of the elements\n     * of each list.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.1.0\n     * @category Relation\n     * @sig [*] -> [*] -> [*]\n     * @param {Array} as The first list.\n     * @param {Array} bs The second list.\n     * @return {Array} The first and second lists concatenated, with\n     *         duplicates removed.\n     * @example\n     *\n     *      R.union([1, 2, 3], [2, 3, 4]); //=> [1, 2, 3, 4]\n     */\n    var union = _curry2(compose(uniq, _concat));\n\n    var R = {\n        F: F,\n        T: T,\n        __: __,\n        add: add,\n        addIndex: addIndex,\n        adjust: adjust,\n        all: all,\n        allPass: allPass,\n        allUniq: allUniq,\n        always: always,\n        and: and,\n        any: any,\n        anyPass: anyPass,\n        ap: ap,\n        aperture: aperture,\n        append: append,\n        apply: apply,\n        applySpec: applySpec,\n        assoc: assoc,\n        assocPath: assocPath,\n        binary: binary,\n        bind: bind,\n        both: both,\n        call: call,\n        chain: chain,\n        clamp: clamp,\n        clone: clone,\n        comparator: comparator,\n        complement: complement,\n        compose: compose,\n        composeK: composeK,\n        composeP: composeP,\n        concat: concat,\n        cond: cond,\n        construct: construct,\n        constructN: constructN,\n        contains: contains,\n        converge: converge,\n        countBy: countBy,\n        curry: curry,\n        curryN: curryN,\n        dec: dec,\n        defaultTo: defaultTo,\n        difference: difference,\n        differenceWith: differenceWith,\n        dissoc: dissoc,\n        dissocPath: dissocPath,\n        divide: divide,\n        drop: drop,\n        dropLast: dropLast,\n        dropLastWhile: dropLastWhile,\n        dropRepeats: dropRepeats,\n        dropRepeatsWith: dropRepeatsWith,\n        dropWhile: dropWhile,\n        either: either,\n        empty: empty,\n        eqBy: eqBy,\n        eqProps: eqProps,\n        equals: equals,\n        evolve: evolve,\n        filter: filter,\n        find: find,\n        findIndex: findIndex,\n        findLast: findLast,\n        findLastIndex: findLastIndex,\n        flatten: flatten,\n        flip: flip,\n        forEach: forEach,\n        fromPairs: fromPairs,\n        groupBy: groupBy,\n        groupWith: groupWith,\n        gt: gt,\n        gte: gte,\n        has: has,\n        hasIn: hasIn,\n        head: head,\n        identical: identical,\n        identity: identity,\n        ifElse: ifElse,\n        inc: inc,\n        indexBy: indexBy,\n        indexOf: indexOf,\n        init: init,\n        insert: insert,\n        insertAll: insertAll,\n        intersection: intersection,\n        intersectionWith: intersectionWith,\n        intersperse: intersperse,\n        into: into,\n        invert: invert,\n        invertObj: invertObj,\n        invoker: invoker,\n        is: is,\n        isArrayLike: isArrayLike,\n        isEmpty: isEmpty,\n        isNil: isNil,\n        join: join,\n        juxt: juxt,\n        keys: keys,\n        keysIn: keysIn,\n        last: last,\n        lastIndexOf: lastIndexOf,\n        length: length,\n        lens: lens,\n        lensIndex: lensIndex,\n        lensPath: lensPath,\n        lensProp: lensProp,\n        lift: lift,\n        liftN: liftN,\n        lt: lt,\n        lte: lte,\n        map: map,\n        mapAccum: mapAccum,\n        mapAccumRight: mapAccumRight,\n        mapObjIndexed: mapObjIndexed,\n        match: match,\n        mathMod: mathMod,\n        max: max,\n        maxBy: maxBy,\n        mean: mean,\n        median: median,\n        memoize: memoize,\n        merge: merge,\n        mergeAll: mergeAll,\n        mergeWith: mergeWith,\n        mergeWithKey: mergeWithKey,\n        min: min,\n        minBy: minBy,\n        modulo: modulo,\n        multiply: multiply,\n        nAry: nAry,\n        negate: negate,\n        none: none,\n        not: not,\n        nth: nth,\n        nthArg: nthArg,\n        objOf: objOf,\n        of: of,\n        omit: omit,\n        once: once,\n        or: or,\n        over: over,\n        pair: pair,\n        partial: partial,\n        partialRight: partialRight,\n        partition: partition,\n        path: path,\n        pathEq: pathEq,\n        pathOr: pathOr,\n        pathSatisfies: pathSatisfies,\n        pick: pick,\n        pickAll: pickAll,\n        pickBy: pickBy,\n        pipe: pipe,\n        pipeK: pipeK,\n        pipeP: pipeP,\n        pluck: pluck,\n        prepend: prepend,\n        product: product,\n        project: project,\n        prop: prop,\n        propEq: propEq,\n        propIs: propIs,\n        propOr: propOr,\n        propSatisfies: propSatisfies,\n        props: props,\n        range: range,\n        reduce: reduce,\n        reduceBy: reduceBy,\n        reduceRight: reduceRight,\n        reduced: reduced,\n        reject: reject,\n        remove: remove,\n        repeat: repeat,\n        replace: replace,\n        reverse: reverse,\n        scan: scan,\n        sequence: sequence,\n        set: set,\n        slice: slice,\n        sort: sort,\n        sortBy: sortBy,\n        split: split,\n        splitAt: splitAt,\n        splitEvery: splitEvery,\n        splitWhen: splitWhen,\n        subtract: subtract,\n        sum: sum,\n        symmetricDifference: symmetricDifference,\n        symmetricDifferenceWith: symmetricDifferenceWith,\n        tail: tail,\n        take: take,\n        takeLast: takeLast,\n        takeLastWhile: takeLastWhile,\n        takeWhile: takeWhile,\n        tap: tap,\n        test: test,\n        times: times,\n        toLower: toLower,\n        toPairs: toPairs,\n        toPairsIn: toPairsIn,\n        toString: toString,\n        toUpper: toUpper,\n        transduce: transduce,\n        transpose: transpose,\n        traverse: traverse,\n        trim: trim,\n        tryCatch: tryCatch,\n        type: type,\n        unapply: unapply,\n        unary: unary,\n        uncurryN: uncurryN,\n        unfold: unfold,\n        union: union,\n        unionWith: unionWith,\n        uniq: uniq,\n        uniqBy: uniqBy,\n        uniqWith: uniqWith,\n        unless: unless,\n        unnest: unnest,\n        until: until,\n        update: update,\n        useWith: useWith,\n        values: values,\n        valuesIn: valuesIn,\n        view: view,\n        when: when,\n        where: where,\n        whereEq: whereEq,\n        without: without,\n        wrap: wrap,\n        xprod: xprod,\n        zip: zip,\n        zipObj: zipObj,\n        zipWith: zipWith\n    };\n  /* eslint-env amd */\n\n  /* TEST_ENTRY_POINT */\n\n  if (typeof exports === 'object') {\n    module.exports = R;\n  } else if (typeof define === 'function' && define.amd) {\n    define(function() { return R; });\n  } else {\n    this.R = R;\n  }\n\n}.call(this));\n\n},{}],74:[function(require,module,exports){\n(function (exports) {\n  exports.validate = validate;\n  exports.mixin = mixin;\n\n  //\n  // ### function validate (object, schema, options)\n  // #### {Object} object the object to validate.\n  // #### {Object} schema (optional) the JSON Schema to validate against.\n  // #### {Object} options (optional) options controlling the validation\n  //      process. See {@link #validate.defaults) for details.\n  // Validate <code>object</code> against a JSON Schema.\n  // If <code>object</code> is self-describing (i.e. has a\n  // <code>$schema</code> property), it will also be validated\n  // against the referenced schema. [TODO]: This behaviour bay be\n  // suppressed by setting the {@link #validate.options.???}\n  // option to <code>???</code>.[/TODO]\n  //\n  // If <code>schema</code> is not specified, and <code>object</code>\n  // is not self-describing, validation always passes.\n  //\n  // <strong>Note:</strong> in order to pass options but no schema,\n  // <code>schema</code> <em>must</em> be specified in the call to\n  // <code>validate()</code>; otherwise, <code>options</code> will\n  // be interpreted as the schema. <code>schema</code> may be passed\n  // as <code>null</code>, <code>undefinded</code>, or the empty object\n  // (<code>{}</code>) in this case.\n  //\n  function validate(object, schema, options) {\n    options = mixin({}, validate.defaults, options);\n    var errors = [];\n\n    if (schema.type === 'array')\n      validateProperty(object, object, '', schema, options, errors);\n    else\n      validateObject(object, schema, options, errors);\n\n    //\n    // TODO: self-described validation\n    // if (! options.selfDescribing) { ... }\n    //\n\n    return {\n      valid: !(errors.length),\n      errors: errors\n    };\n  };\n\n  /**\n   * Default validation options. Defaults can be overridden by\n   * passing an 'options' hash to {@link #validate}. They can\n   * also be set globally be changing the values in\n   * <code>validate.defaults</code> directly.\n   */\n  validate.defaults = {\n      /**\n       * <p>\n       * Enforce 'format' constraints.\n       * </p><p>\n       * <em>Default: <code>true</code></em>\n       * </p>\n       */\n      validateFormats: true,\n      /**\n       * <p>\n       * When {@link #validateFormats} is <code>true</code>,\n       * treat unrecognized formats as validation errors.\n       * </p><p>\n       * <em>Default: <code>false</code></em>\n       * </p>\n       *\n       * @see validation.formats for default supported formats.\n       */\n      validateFormatsStrict: false,\n      /**\n       * <p>\n       * When {@link #validateFormats} is <code>true</code>,\n       * also validate formats defined in {@link #validate.formatExtensions}.\n       * </p><p>\n       * <em>Default: <code>true</code></em>\n       * </p>\n       */\n      validateFormatExtensions: true,\n      /**\n       * <p>\n       * When {@link #additionalProperties} is <code>true</code>,\n       * allow additional unvisited properties on the object.\n       * </p><p>\n       * <em>Default: <code>true</code></em>\n       * </p>\n       */\n      additionalProperties: true\n  };\n\n  /**\n   * Default messages to include with validation errors.\n   */\n  validate.messages = {\n      required:             \"is required\",\n      allowEmpty:           \"must not be empty\",\n      minLength:            \"is too short (minimum is %{expected} characters)\",\n      maxLength:            \"is too long (maximum is %{expected} characters)\",\n      pattern:              \"invalid input\",\n      minimum:              \"must be greater than or equal to %{expected}\",\n      maximum:              \"must be less than or equal to %{expected}\",\n      exclusiveMinimum:     \"must be greater than %{expected}\",\n      exclusiveMaximum:     \"must be less than %{expected}\",\n      divisibleBy:          \"must be divisible by %{expected}\",\n      minItems:             \"must contain more than %{expected} items\",\n      maxItems:             \"must contain less than %{expected} items\",\n      uniqueItems:          \"must hold a unique set of values\",\n      format:               \"is not a valid %{expected}\",\n      conform:              \"must conform to given constraint\",\n      type:                 \"must be of %{expected} type\",\n      additionalProperties: \"must not exist\"\n  };\n  validate.messages['enum'] = \"must be present in given enumerator\";\n\n  /**\n   *\n   */\n  validate.formats = {\n    'email':          /^((([a-z]|\\d|[!#\\$%&'\\*\\+\\-\\/=\\?\\^_`{\\|}~]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])+(\\.([a-z]|\\d|[!#\\$%&'\\*\\+\\-\\/=\\?\\^_`{\\|}~]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])+)*)|((\\x22)((((\\x20|\\x09)*(\\x0d\\x0a))?(\\x20|\\x09)+)?(([\\x01-\\x08\\x0b\\x0c\\x0e-\\x1f\\x7f]|\\x21|[\\x23-\\x5b]|[\\x5d-\\x7e]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])|(\\\\([\\x01-\\x09\\x0b\\x0c\\x0d-\\x7f]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF]))))*(((\\x20|\\x09)*(\\x0d\\x0a))?(\\x20|\\x09)+)?(\\x22)))@((([a-z]|\\d|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])|(([a-z]|\\d|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])([a-z]|\\d|-|\\.|_|~|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])*([a-z]|\\d|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])))\\.)+(([a-z]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])|(([a-z]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])([a-z]|\\d|-|\\.|_|~|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])*([a-z]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])))\\.?$/i,\n    'ip-address':     /^(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/i,\n    'ipv6':           /^([0-9A-Fa-f]{1,4}:){7}[0-9A-Fa-f]{1,4}$/,\n    'date-time':      /^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}(?:.\\d{1,3})?Z$/,\n    'date':           /^\\d{4}-\\d{2}-\\d{2}$/,\n    'time':           /^\\d{2}:\\d{2}:\\d{2}$/,\n    'color':          /^#[a-z0-9]{6}|#[a-z0-9]{3}|(?:rgb\\(\\s*(?:[+-]?\\d+%?)\\s*,\\s*(?:[+-]?\\d+%?)\\s*,\\s*(?:[+-]?\\d+%?)\\s*\\))aqua|black|blue|fuchsia|gray|green|lime|maroon|navy|olive|orange|purple|red|silver|teal|white|yellow$/i,\n    //'style':        (not supported)\n    //'phone':        (not supported)\n    //'uri':          (not supported)\n    'host-name':      /^(([a-zA-Z]|[a-zA-Z][a-zA-Z0-9\\-]*[a-zA-Z0-9])\\.)*([A-Za-z]|[A-Za-z][A-Za-z0-9\\-]*[A-Za-z0-9])/,\n    'utc-millisec':   {\n      test: function (value) {\n        return typeof(value) === 'number' && value >= 0;\n      }\n    },\n    'regex':          {\n      test: function (value) {\n        try { new RegExp(value) }\n        catch (e) { return false }\n\n        return true;\n      }\n    }\n  };\n\n  /**\n   *\n   */\n  validate.formatExtensions = {\n    'url': /^(https?|ftp|git):\\/\\/(((([a-z]|\\d|-|\\.|_|~|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])|(%[\\da-f]{2})|[!\\$&'\\(\\)\\*\\+,;=]|:)*@)?(((\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])\\.(\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])\\.(\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])\\.(\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5]))|((([a-z]|\\d|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])|(([a-z]|\\d|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])([a-z]|\\d|-|\\.|_|~|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])*([a-z]|\\d|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])))\\.)+(([a-z]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])|(([a-z]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])([a-z]|\\d|-|\\.|_|~|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])*([a-z]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])))\\.?)(:\\d*)?)(\\/((([a-z]|\\d|-|\\.|_|~|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])|(%[\\da-f]{2})|[!\\$&'\\(\\)\\*\\+,;=]|:|@)+(\\/(([a-z]|\\d|-|\\.|_|~|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])|(%[\\da-f]{2})|[!\\$&'\\(\\)\\*\\+,;=]|:|@)*)*)?)?(\\?((([a-z]|\\d|-|\\.|_|~|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])|(%[\\da-f]{2})|[!\\$&'\\(\\)\\*\\+,;=]|:|@)|[\\uE000-\\uF8FF]|\\/|\\?)*)?(\\#((([a-z]|\\d|-|\\.|_|~|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])|(%[\\da-f]{2})|[!\\$&'\\(\\)\\*\\+,;=]|:|@)|\\/|\\?)*)?$/i\n  };\n\n  function mixin(obj) {\n    var sources = Array.prototype.slice.call(arguments, 1);\n    while (sources.length) {\n      var source = sources.shift();\n      if (!source) { continue }\n\n      if (typeof(source) !== 'object') {\n        throw new TypeError('mixin non-object');\n      }\n\n      for (var p in source) {\n        if (source.hasOwnProperty(p)) {\n          obj[p] = source[p];\n        }\n      }\n    }\n\n    return obj;\n  };\n\n  function validateObject(object, schema, options, errors) {\n    var props, allProps = Object.keys(object),\n        visitedProps = [];\n\n    // see 5.2\n    if (schema.properties) {\n      props = schema.properties;\n      for (var p in props) {\n        if (props.hasOwnProperty(p)) {\n          visitedProps.push(p);\n          validateProperty(object, object[p], p, props[p], options, errors);\n        }\n      }\n    }\n\n    // see 5.3\n    if (schema.patternProperties) {\n      props = schema.patternProperties;\n      for (var p in props) {\n        if (props.hasOwnProperty(p)) {\n          var re = new RegExp(p);\n\n          // Find all object properties that are matching `re`\n          for (var k in object) {\n            if (object.hasOwnProperty(k)) {\n              if (re.exec(k) !== null) {\n                validateProperty(object, object[k], k, props[p], options, errors);\n                visitedProps.push(k);\n              }\n            }\n          }\n        }\n      }\n    }\n\n    //if additionalProperties is not defined set default value\n    if (schema.additionalProperties === undefined) {\n      schema.additionalProperties = options.additionalProperties;\n    }\n\n    // see 5.4\n    if (undefined !== schema.additionalProperties) {\n      var i, l;\n\n      var unvisitedProps = allProps.filter(function(k){\n        return -1 === visitedProps.indexOf(k);\n      });\n\n      // Prevent additional properties; each unvisited property is therefore an error\n      if (schema.additionalProperties === false && unvisitedProps.length > 0) {\n        for (i = 0, l = unvisitedProps.length; i < l; i++) {\n          error(\"additionalProperties\", unvisitedProps[i], object[unvisitedProps[i]], false, errors);\n        }\n      }\n      // additionalProperties is a schema and validate unvisited properties against that schema\n      else if (typeof schema.additionalProperties == \"object\" && unvisitedProps.length > 0) {\n        for (i = 0, l = unvisitedProps.length; i < l; i++) {\n          validateProperty(object, object[unvisitedProps[i]], unvisitedProps[i], schema.unvisitedProperties, options, errors);\n        }\n      }\n    }\n\n  };\n\n  function validateProperty(object, value, property, schema, options, errors) {\n    var format,\n        valid,\n        spec,\n        type;\n\n    function constrain(name, value, assert) {\n      if (schema[name] !== undefined && !assert(value, schema[name])) {\n        error(name, property, value, schema, errors);\n      }\n    }\n\n    if (value === undefined) {\n      if (schema.required && schema.type !== 'any') {\n        return error('required', property, undefined, schema, errors);\n      } else {\n        return;\n      }\n    }\n\n    if (options.cast) {\n      if (('integer' === schema.type || 'number' === schema.type) && value == +value) {\n        value = +value;\n        object[property] = value;\n      }\n\n      if ('boolean' === schema.type) {\n        if ('true' === value || '1' === value || 1 === value) {\n          value = true;\n          object[property] = value;\n        }\n\n        if ('false' === value || '0' === value || 0 === value) {\n          value = false;\n          object[property] = value;\n        }\n      }\n    }\n\n    if (schema.format && options.validateFormats) {\n      format = schema.format;\n\n      if (options.validateFormatExtensions) { spec = validate.formatExtensions[format] }\n      if (!spec) { spec = validate.formats[format] }\n      if (!spec) {\n        if (options.validateFormatsStrict) {\n          return error('format', property, value, schema, errors);\n        }\n      }\n      else {\n        if (!spec.test(value)) {\n          return error('format', property, value, schema, errors);\n        }\n      }\n    }\n\n    if (schema['enum'] && schema['enum'].indexOf(value) === -1) {\n      error('enum', property, value, schema, errors);\n    }\n\n    // Dependencies (see 5.8)\n    if (typeof schema.dependencies === 'string' &&\n        object[schema.dependencies] === undefined) {\n      error('dependencies', property, null, schema, errors);\n    }\n\n    if (isArray(schema.dependencies)) {\n      for (var i = 0, l = schema.dependencies.length; i < l; i++) {\n        if (object[schema.dependencies[i]] === undefined) {\n          error('dependencies', property, null, schema, errors);\n        }\n      }\n    }\n\n    if (typeof schema.dependencies === 'object') {\n      validateObject(object, schema.dependencies, options, errors);\n    }\n\n    checkType(value, schema.type, function(err, type) {\n      if (err) return error('type', property, typeof value, schema, errors);\n\n      constrain('conform', value, function (a, e) { return e(a, object) });\n\n      switch (type || (isArray(value) ? 'array' : typeof value)) {\n        case 'string':\n          constrain('allowEmpty', value,        function (a, e) { return e ? e : a !== '' });\n          constrain('minLength',  value.length, function (a, e) { return a >= e });\n          constrain('maxLength',  value.length, function (a, e) { return a <= e });\n          constrain('pattern',    value,        function (a, e) {\n            e = typeof e === 'string'\n              ? e = new RegExp(e)\n              : e;\n            return e.test(a)\n          });\n          break;\n        case 'integer':\n        case 'number':\n          constrain('minimum',     value, function (a, e) { return a >= e });\n          constrain('maximum',     value, function (a, e) { return a <= e });\n          constrain('exclusiveMinimum', value, function (a, e) { return a > e });\n          constrain('exclusiveMaximum', value, function (a, e) { return a < e });\n          constrain('divisibleBy', value, function (a, e) {\n            var multiplier = Math.max((a - Math.floor(a)).toString().length - 2, (e - Math.floor(e)).toString().length - 2);\n            multiplier = multiplier > 0 ? Math.pow(10, multiplier) : 1;\n            return (a * multiplier) % (e * multiplier) === 0\n          });\n          break;\n        case 'array':\n          constrain('items', value, function (a, e) {\n            var nestedErrors;\n            for (var i = 0, l = a.length; i < l; i++) {\n              nestedErrors = [];\n              validateProperty(object, a[i], property, e, options, nestedErrors);\n              nestedErrors.forEach(function (err) {\n                err.property =\n                  (property ? property + '.' : '') +\n                  i +\n                  (err.property ? '.' + err.property.replace(property + '.', '') : '');\n              });\n              nestedErrors.unshift(0, 0);\n              Array.prototype.splice.apply(errors, nestedErrors);\n            }\n            return true;\n          });\n          constrain('minItems', value, function (a, e) { return a.length >= e });\n          constrain('maxItems', value, function (a, e) { return a.length <= e });\n          constrain('uniqueItems', value, function (a, e) {\n            if (!e) return true;\n\n            var h = {};\n\n            for (var i = 0, l = a.length; i < l; i++) {\n              var key = JSON.stringify(a[i]);\n              if (h[key]) return false;\n              h[key] = true;\n            }\n\n            return true;\n          });\n          break;\n        case 'object':\n          // Recursive validation\n          if (schema.properties || schema.patternProperties || schema.additionalProperties) {\n            var nestedErrors = [];\n            validateObject(value, schema, options, nestedErrors);\n            nestedErrors.forEach(function (e) {\n              e.property = property + '.' + e.property\n            });\n            nestedErrors.unshift(0, 0);\n            Array.prototype.splice.apply(errors, nestedErrors);\n          }\n          break;\n      }\n    });\n  };\n\n  function checkType(val, type, callback) {\n    var result = false,\n        types = isArray(type) ? type : [type];\n\n    // No type - no check\n    if (type === undefined) return callback(null, type);\n\n    // Go through available types\n    // And fine first matching\n    for (var i = 0, l = types.length; i < l; i++) {\n      type = types[i].toLowerCase().trim();\n      if (type === 'string' ? typeof val === 'string' :\n          type === 'array' ? isArray(val) :\n          type === 'object' ? val && typeof val === 'object' &&\n                             !isArray(val) :\n          type === 'number' ? typeof val === 'number' :\n          type === 'integer' ? typeof val === 'number' && Math.floor(val) === val :\n          type === 'null' ? val === null :\n          type === 'boolean'? typeof val === 'boolean' :\n          type === 'date' ? isDate(val) :\n          type === 'any' ? typeof val !== 'undefined' : false) {\n        return callback(null, type);\n      }\n    };\n\n    callback(true);\n  };\n\n  function error(attribute, property, actual, schema, errors) {\n    var lookup = { expected: schema[attribute], actual: actual, attribute: attribute, property: property };\n    var message = schema.messages && schema.messages[attribute] || schema.message || validate.messages[attribute] || \"no default message\";\n    message = message.replace(/%\\{([a-z]+)\\}/ig, function (_, match) { return lookup[match.toLowerCase()] || ''; });\n    errors.push({\n      attribute: attribute,\n      property:  property,\n      expected:  schema[attribute],\n      actual:    actual,\n      message:   message\n    });\n  };\n\n  function isArray(value) {\n    var s = typeof value;\n    if (s === 'object') {\n      if (value) {\n        if (typeof value.length === 'number' &&\n           !(value.propertyIsEnumerable('length')) &&\n           typeof value.splice === 'function') {\n           return true;\n        }\n      }\n    }\n    return false;\n  }\n\n  function isDate(value) {\n    var s = typeof value;\n    if (s === 'object') {\n      if (value) {\n        if (typeof value.getTime === 'function') {\n          return true;\n        }\n      }\n    }\n\n    return false;\n  }\n\n})(typeof module === 'object' && module && module.exports ? module.exports : window);\n\n},{}]},{},[20])\n\n","/* -*- mode: javascript; c-basic-offset: 4; indent-tabs-mode: nil -*- */\n\n// \n// Dalliance Genome Explorer\n// (c) Thomas Down 2006-2014\n//\n// bedwig.js\n//\n\n\"use strict\";\n\nif (typeof(require) !== 'undefined') {\n    var spans = require('./spans');\n    var Range = spans.Range;\n    var union = spans.union;\n    var intersection = spans.intersection;\n\n    var sa = require('./sourceadapters');\n    var dalliance_registerParserFactory = sa.registerParserFactory;\n\n    var das = require('./das');\n    var DASStylesheet = das.DASStylesheet;\n    var DASStyle = das.DASStyle;\n    var DASFeature = das.DASFeature;\n    var DASGroup = das.DASGroup;\n\n    var utils = require('./utils');\n    var shallowCopy = utils.shallowCopy;\n    \n    var revalidator = require('revalidator');\n}\n\n\nfunction BedWigParser(type) {\n    this.type = type;\n}\n\nBedWigParser.prototype.createSession = function(sink) {\n    if (this.type == 'wig')\n        return new WigParseSession(this, sink);\n    else\n        return new BedParseSession(this, sink);\n}\n\nvar __KV_REGEXP=/([^=]+)=(.+)/;\nvar __SPACE_REGEXP=/\\s/;\nvar BED_COLOR_REGEXP = new RegExp(\"^[0-9]+,[0-9]+,[0-9]+\");\n\nfunction BedParseSession(parser, sink) {\n    this.parser = parser;\n    this.sink = sink;\n}\n\nBedParseSession.prototype.parse = function(line) {\n    var toks = line.split(__SPACE_REGEXP);\n    if (toks.length < 3)\n        return;\n\n    var start = parseInt(toks[1]) + 1;\n    var end = parseInt(toks[2]);\n\n    var f = {segment: toks[0], \n             min: start,\n             max: end};\n\n    if (toks.length > 3 && toks[3] !== '.') {\n        f.label = toks[3];\n    }\n\n    if (toks.length > 4) {\n        f.score = parseFloat(toks[4])\n    }\n\n    if (toks.length > 5) {\n        f.orientation = toks[5];\n    }\n\n    if (toks.length > 8) {\n        var color = toks[8];\n        if (BED_COLOR_REGEXP.test(color)) {\n            f.itemRgb = 'rgb(' + color + ')';\n        }\n    }\n\n    if (toks.length >= 12) {\n        var thickStart = parseInt(toks[6]);\n        var thickEnd   = parseInt(toks[7]);\n        var blockCount = parseInt(toks[9]);\n        var blockSizes = toks[10].split(',').map(function(x) {return parseInt(x)});\n        var blockStarts = toks[11].split(',').map(function(x) {return parseInt(x)});\n\n        f.type = 'transcript'\n        var grp = new DASGroup();\n        grp.id = toks[3];\n        grp.type = 'transcript'\n        grp.notes = [];\n        f.groups = [grp];\n\n        if (toks.length > 12) {\n            var geneId = toks[12];\n            var geneName = geneId;\n            if (toks.length > 13) {\n                geneName = toks[13];\n            }\n            var gg = new DASGroup();\n            gg.id = geneId;\n            gg.label = geneName;\n            gg.type = 'gene';\n            f.groups.push(gg);\n        }  \n\n        var spans = null;\n        for (var b = 0; b < blockCount; ++b) {\n            var bmin = blockStarts[b] + start;\n            var bmax = bmin + blockSizes[b];\n            var span = new Range(bmin, bmax);\n            if (spans) {\n                spans = union(spans, span);\n            } else {\n                spans = span;\n            }\n        }\n                    \n        var tsList = spans.ranges();\n        for (var s = 0; s < tsList.length; ++s) {\n            var ts = tsList[s];\n            var bf = shallowCopy(f);\n            bf.min = ts.min();\n            bf.max = ts.max();\n            this.sink(bf);\n        }\n\n        if (thickEnd > thickStart) {\n            var codingRegion = (f.orientation == '+') ? \n                new Range(thickStart, thickEnd + 3) : \n                new Range(thickStart - 3, thickEnd);\n                // +/- 3 to account for stop codon\n\n            var tl = intersection(spans, codingRegion);\n            if (tl) {\n                f.type = 'translation';\n                var tlList = tl.ranges();\n                var readingFrame = 0;\n                for (var s = 0; s < tlList.length; ++s) {\n                    // Record reading frame for every exon\n                    var index = s;\n                    if (f.orientation == '-')\n                        index = tlList.length - s - 1;\n                    var ts = tlList[index];\n                    var bf = shallowCopy(f);\n                    bf.min = ts.min();\n                    bf.max = ts.max();\n                    f.readframe = readingFrame;\n                    var length = ts.max() - ts.min();\n                    readingFrame = (readingFrame + length) % 3;\n                    this.sink(bf);\n                }\n            }\n        }\n    } else {\n        this.sink(f);\n    }\n}\n\nBedParseSession.prototype.flush = function() {};\n\nBedParseSession.prototype.schema = {\n  properties: {\n    segment: {\n      description: 'the name of the region containing the feature',\n      type: 'string',\n      required: true\n    },\n    min: {\n      description: 'the start position of the feature (0-based)',\n      type: 'integer',\n      minimum: 1,\n      required: true\n    },\n    max: {\n      description: 'the end position of the feature (1-based)',\n      type: 'integer',\n      required: true\n    },\n    label: {\n      description: 'the label for a feature',\n      type: 'string'\n    },\n    score: {\n      description: 'score of a feature',\n      type: 'float'\n    },\n    orientation: {\n      description: 'strand of feature',\n      type: 'string',\n      enum: ['+','-','.']\n    },\n    itemRGB: {\n      description: 'rgb color to draw feature',\n      type: 'string',\n      pattern: '^rgb\\([0-9]+,[0-9]+,[0-9]+)$'\n    },\n    type: {\n      description: 'type of feature',\n      type: 'string',\n      enum: ['transcript','translation']\n    },\n    readingFrame: {\n      description: 'open reading frame at the start of the interval',\n      type: 'integer',\n      minimum: 0,\n      maximum: 2\n    },\n    groups: {\n      description: 'list of groups that a feature belongs to',\n      type: 'array',\n      items: {\n        type: 'object',\n        properties: {\n          id: {\n            type: 'string',\n            required: true\n          },\n          label: {\n            type: 'string',\n            required: true\n          },\n          type: {\n            type: 'string',\n            required: true\n          }\n        }\n      }\n    }\n  }\n};\n\nBedParseSession.prototype.validate = function(f) {\n  // use revalidator.validate to check if feature f is valid\n  var check = revalidator.validate(f, this.schema);\n  if (check.valid) {\n    this.sink(f);\n  } else {\n    console.log(check.errors);\n  }\n}\n\nfunction WigParseSession(parser, sink) {\n    this.parser = parser;\n    this.sink = sink;\n    this.wigState = null;\n}\n\nWigParseSession.prototype.parse = function(line) {\n    var toks = line.split(__SPACE_REGEXP);\n\n    if (toks[0] == 'fixedStep') {\n        this.wigState = 'fixedStep';\n        this.chr = this.pos = this.step = null;\n        this.span = 1;\n\n        for (var ti = 1; ti < toks.length; ++ti) {\n            var m = __KV_REGEXP.exec(toks[ti]);\n            if (m) {\n                if (m[1] == 'chrom') {\n                    this.chr = m[2];\n                } else if (m[1] == 'start') {\n                    this.pos = parseInt(m[2]);\n                } else if (m[1] == 'step') {\n                    this.step = parseInt(m[2]);\n                } else if (m[1] == 'span') {\n                    this.span = parseInt(m[2]);\n                }\n            }\n        }\n    } else if (toks[0] == 'variableStep') {\n        this.wigState = 'variableStep';\n        this.chr = null;\n        this.span = 1;\n\n        for (var ti = 1; ti < toks.length; ++ti) {\n            var m = __KV_REGEXP.exec(toks[ti]);\n            if (m[1] == 'chrom') {\n                this.chr = m[2];\n            } else if (m[1] == 'span') {\n                this.span = parseInt(m[2]);\n            }\n        }\n    } else {\n        if (!this.wigState) {\n            if (toks.length < 4)\n                return;\n\n            var f = {segment: toks[0], \n                     min: parseInt(toks[1]) + 1, \n                     max: parseInt(toks[2]),\n                     score: parseFloat(toks[3])};\n\n            this.sink(f);\n        } else if (this.wigState == 'fixedStep') {\n            if (toks.length != 1)\n                return;\n            var score = parseFloat(toks[0]);\n            var f = {segment: this.chr, min: this.pos, max: this.pos + this.span - 1, score: score};\n            this.pos += this.step;\n            this.sink(f);\n        } else if (this.wigState == 'variableStep') {\n            if (toks.length != 2)\n                return;\n            var pos = parseInt(toks[0]);\n            var score = parseFloat(toks[1]);\n            var f = {segment: this.chr, min: pos, max: pos + this.span - 1, score: score};\n            this.sink(f);\n        }\n    }\n}\n\nWigParseSession.prototype.flush = function() {};\n\nWigParseSession.prototype.schema = {\n  properties: {\n    segment: {\n      description: 'the name of the region containing the feature',\n      type: 'string',\n      required: true\n    },\n    min: {\n      description: 'the start position of the feature',\n      type: 'integer',\n      minimum: 1,\n      required: true\n    },\n    max: {\n      description: 'the end position of the feature',\n      type: 'integer',\n      required: true\n    },\n    score: {\n      description: 'score of a feature',\n      type: 'float',\n      required: true\n    }\n  }\n};\n\nWigParseSession.prototype.validate = function(f) {\n  // use revalidator.validate to check if feature f is valid\n  var check = revalidator.validate(f, this.schema);\n  if (check.valid) {\n    this.sink(f);\n  } else {\n    console.log(check.errors);\n  }\n}\n\nBedWigParser.prototype.getStyleSheet = function(callback) {\n    var thisB = this;\n    var stylesheet = new DASStylesheet();\n\n    if (this.type == 'wig') {\n        var wigStyle = new DASStyle();\n        wigStyle.glyph = 'HISTOGRAM';\n        wigStyle.BGCOLOR = 'blue';\n        wigStyle.HEIGHT=30;\n        stylesheet.pushStyle({type: 'default'}, null, wigStyle);\n    } else {\n        var wigStyle = new DASStyle();\n        wigStyle.glyph = 'BOX';\n        wigStyle.FGCOLOR = 'black';\n        wigStyle.BGCOLOR = 'blue'\n        wigStyle.HEIGHT = 8;\n        wigStyle.BUMP = true;\n        wigStyle.LABEL = true;\n        wigStyle.ZINDEX = 20;\n        stylesheet.pushStyle({type: 'default'}, null, wigStyle);\n\n        var wigStyle = new DASStyle();\n        wigStyle.glyph = 'BOX';\n        wigStyle.FGCOLOR = 'black';\n        wigStyle.BGCOLOR = 'red'\n        wigStyle.HEIGHT = 10;\n        wigStyle.BUMP = true;\n        wigStyle.ZINDEX = 20;\n        stylesheet.pushStyle({type: 'translation'}, null, wigStyle);\n                \n        var tsStyle = new DASStyle();\n        tsStyle.glyph = 'BOX';\n        tsStyle.FGCOLOR = 'black';\n        tsStyle.BGCOLOR = 'white';\n        tsStyle.HEIGHT = 10;\n        tsStyle.ZINDEX = 10;\n        tsStyle.BUMP = true;\n        tsStyle.LABEL = true;\n        stylesheet.pushStyle({type: 'transcript'}, null, tsStyle);\n\n        var densStyle = new DASStyle();\n        densStyle.glyph = 'HISTOGRAM';\n        densStyle.COLOR1 = 'white';\n        densStyle.COLOR2 = 'black';\n        densStyle.HEIGHT=30;\n        stylesheet.pushStyle({type: 'density'}, null, densStyle);\n    }\n\n    return callback(stylesheet);\n}\n\ndalliance_registerParserFactory('bed', function(t) {return new BedWigParser(t)});\ndalliance_registerParserFactory('wig', function(t) {return new BedWigParser(t)});\n","/* -*- mode: javascript; c-basic-offset: 4; indent-tabs-mode: nil -*- */\n\n// \n// Dalliance Genome Explorer\n// (c) Thomas Down 2006-2010\n//\n// bigwig.js: indexed binary WIG (and BED) files\n//\n\n\"use strict\";\n\n\nif (typeof(require) !== 'undefined') {\n    var spans = require('./spans');\n    var Range = spans.Range;\n    var union = spans.union;\n    var intersection = spans.intersection;\n\n    var das = require('./das');\n    var DASFeature = das.DASFeature;\n    var DASGroup = das.DASGroup;\n\n    var utils = require('./utils');\n    var shallowCopy = utils.shallowCopy;\n\n    var bin = require('./bin');\n    var readInt = bin.readInt;\n\n    var jszlib = require('jszlib');\n    var jszlib_inflate_buffer = jszlib.inflateBuffer;\n    var arrayCopy = jszlib.arrayCopy;\n}\n\nvar BIG_WIG_MAGIC = 0x888FFC26;\nvar BIG_WIG_MAGIC_BE = 0x26FC8F88;\nvar BIG_BED_MAGIC = 0x8789F2EB;\nvar BIG_BED_MAGIC_BE = 0xEBF28987;\n\n\nvar BIG_WIG_TYPE_GRAPH = 1;\nvar BIG_WIG_TYPE_VSTEP = 2;\nvar BIG_WIG_TYPE_FSTEP = 3;\n  \nvar M1 = 256;\nvar M2 = 256*256;\nvar M3 = 256*256*256;\nvar M4 = 256*256*256*256;\n\nvar BED_COLOR_REGEXP = new RegExp(\"^[0-9]+,[0-9]+,[0-9]+\");\n\nfunction bwg_readOffset(ba, o) {\n    var offset = ba[o] + ba[o+1]*M1 + ba[o+2]*M2 + ba[o+3]*M3 + ba[o+4]*M4;\n    return offset;\n}\n\nfunction BigWig() {\n}\n\nBigWig.prototype.readChromTree = function(callback) {\n    var thisB = this;\n    this.chromsToIDs = {};\n    this.idsToChroms = {};\n    this.maxID = 0;\n\n    var udo = this.unzoomedDataOffset;\n    var eb = (udo - this.chromTreeOffset) & 3;\n    udo = udo + 4 - eb;\n\n    this.data.slice(this.chromTreeOffset, udo - this.chromTreeOffset).fetch(function(bpt) {\n        var ba = new Uint8Array(bpt);\n        var sa = new Int16Array(bpt);\n        var la = new Int32Array(bpt);\n        var bptMagic = la[0];\n        var blockSize = la[1];\n        var keySize = la[2];\n        var valSize = la[3];\n        var itemCount = bwg_readOffset(ba, 16);\n        var rootNodeOffset = 32;\n\n        var bptReadNode = function(offset) {\n            var nodeType = ba[offset];\n            var cnt = sa[(offset/2) + 1];\n            offset += 4;\n            for (var n = 0; n < cnt; ++n) {\n                if (nodeType == 0) {\n                    offset += keySize;\n                    var childOffset = bwg_readOffset(ba, offset);\n                    offset += 8;\n                    childOffset -= thisB.chromTreeOffset;\n                    bptReadNode(childOffset);\n                } else {\n                    var key = '';\n                    for (var ki = 0; ki < keySize; ++ki) {\n                        var charCode = ba[offset++];\n                        if (charCode != 0) {\n                            key += String.fromCharCode(charCode);\n                        }\n                    }\n                    var chromId = (ba[offset+3]<<24) | (ba[offset+2]<<16) | (ba[offset+1]<<8) | (ba[offset+0]);\n                    var chromSize = (ba[offset + 7]<<24) | (ba[offset+6]<<16) | (ba[offset+5]<<8) | (ba[offset+4]);\n                    offset += 8;\n\n                    thisB.chromsToIDs[key] = chromId;\n                    if (key.indexOf('chr') == 0) {\n                        thisB.chromsToIDs[key.substr(3)] = chromId;\n                    }\n                    thisB.idsToChroms[chromId] = key;\n                    thisB.maxID = Math.max(thisB.maxID, chromId);\n                }\n            }\n        };\n        bptReadNode(rootNodeOffset);\n\n        callback(thisB);\n    });\n}\n\nfunction BigWigView(bwg, cirTreeOffset, cirTreeLength, isSummary) {\n    this.bwg = bwg;\n    this.cirTreeOffset = cirTreeOffset;\n    this.cirTreeLength = cirTreeLength;\n    this.isSummary = isSummary;\n}\n\n\n\nBigWigView.prototype.readWigData = function(chrName, min, max, callback) {\n    var chr = this.bwg.chromsToIDs[chrName];\n    if (chr === undefined) {\n        // Not an error because some .bwgs won't have data for all chromosomes.\n        return callback([]);\n    } else {\n        this.readWigDataById(chr, min, max, callback);\n    }\n}\n\nBigWigView.prototype.readWigDataById = function(chr, min, max, callback) {\n    var thisB = this;\n    if (!this.cirHeader) {\n        this.bwg.data.slice(this.cirTreeOffset, 48).fetch(function(result) {\n            thisB.cirHeader = result;\n            var la = new Int32Array(thisB.cirHeader);\n            thisB.cirBlockSize = la[1];\n            thisB.readWigDataById(chr, min, max, callback);\n        });\n        return;\n    }\n\n    var blocksToFetch = [];\n    var outstanding = 0;\n\n    var beforeBWG = Date.now();\n\n    var filter = function(chromId, fmin, fmax, toks) {\n        return ((chr < 0 || chromId == chr) && fmin <= max && fmax >= min);\n    }\n\n    var cirFobRecur = function(offset, level) {\n        if (thisB.bwg.instrument)\n            console.log('level=' + level + '; offset=' + offset + '; time=' + (Date.now()|0));\n\n        outstanding += offset.length;\n\n        if (offset.length == 1 && offset[0] - thisB.cirTreeOffset == 48 && thisB.cachedCirRoot) {\n            cirFobRecur2(thisB.cachedCirRoot, 0, level);\n            --outstanding;\n            if (outstanding == 0) {\n                thisB.fetchFeatures(filter, blocksToFetch, callback);\n            }\n            return;\n        }\n\n        var maxCirBlockSpan = 4 +  (thisB.cirBlockSize * 32);   // Upper bound on size, based on a completely full leaf node.\n        var spans;\n        for (var i = 0; i < offset.length; ++i) {\n            var blockSpan = new Range(offset[i], offset[i] + maxCirBlockSpan);\n            spans = spans ? union(spans, blockSpan) : blockSpan;\n        }\n        \n        var fetchRanges = spans.ranges();\n        for (var r = 0; r < fetchRanges.length; ++r) {\n            var fr = fetchRanges[r];\n            cirFobStartFetch(offset, fr, level);\n        }\n    }\n\n    var cirFobStartFetch = function(offset, fr, level, attempts) {\n        var length = fr.max() - fr.min();\n        thisB.bwg.data.slice(fr.min(), fr.max() - fr.min()).fetch(function(resultBuffer) {\n            for (var i = 0; i < offset.length; ++i) {\n                if (fr.contains(offset[i])) {\n                    cirFobRecur2(resultBuffer, offset[i] - fr.min(), level);\n\n                    if (offset[i] - thisB.cirTreeOffset == 48 && offset[i] - fr.min() == 0)\n                        thisB.cachedCirRoot = resultBuffer;\n\n                    --outstanding;\n                    if (outstanding == 0) {\n                        thisB.fetchFeatures(filter, blocksToFetch, callback);\n                    }\n                }\n            }\n        });\n    }\n\n    var cirFobRecur2 = function(cirBlockData, offset, level) {\n        var ba = new Uint8Array(cirBlockData);\n        var sa = new Int16Array(cirBlockData);\n        var la = new Int32Array(cirBlockData);\n\n        var isLeaf = ba[offset];\n        var cnt = sa[offset/2 + 1];\n        offset += 4;\n\n        if (isLeaf != 0) {\n            for (var i = 0; i < cnt; ++i) {\n                var lo = offset/4;\n                var startChrom = la[lo];\n                var startBase = la[lo + 1];\n                var endChrom = la[lo + 2];\n                var endBase = la[lo + 3];\n                var blockOffset = bwg_readOffset(ba, offset+16);\n                var blockSize = bwg_readOffset(ba, offset+24);\n                if (((chr < 0 || startChrom < chr) || (startChrom == chr && startBase <= max)) &&\n                    ((chr < 0 || endChrom   > chr) || (endChrom == chr && endBase >= min)))\n                {\n                    blocksToFetch.push({offset: blockOffset, size: blockSize});\n                }\n                offset += 32;\n            }\n        } else {\n            var recurOffsets = [];\n            for (var i = 0; i < cnt; ++i) {\n                var lo = offset/4;\n                var startChrom = la[lo];\n                var startBase = la[lo + 1];\n                var endChrom = la[lo + 2];\n                var endBase = la[lo + 3];\n                var blockOffset = bwg_readOffset(ba, offset+16);\n                if ((chr < 0 || startChrom < chr || (startChrom == chr && startBase <= max)) &&\n                    (chr < 0 || endChrom   > chr || (endChrom == chr && endBase >= min)))\n                {\n                    recurOffsets.push(blockOffset);\n                }\n                offset += 24;\n            }\n            if (recurOffsets.length > 0) {\n                cirFobRecur(recurOffsets, level + 1);\n            }\n        }\n    };\n\n    cirFobRecur([thisB.cirTreeOffset + 48], 1);\n}\n\n\nBigWigView.prototype.fetchFeatures = function(filter, blocksToFetch, callback) {\n    var thisB = this;\n\n    blocksToFetch.sort(function(b0, b1) {\n        return (b0.offset|0) - (b1.offset|0);\n    });\n\n    if (blocksToFetch.length == 0) {\n        callback([]);\n    } else {\n        var features = [];\n        var createFeature = function(chr, fmin, fmax, opts) {\n            if (!opts) {\n                opts = {};\n            }\n        \n            var f = new DASFeature();\n            f._chromId = chr;\n            f.segment = thisB.bwg.idsToChroms[chr];\n            f.min = fmin;\n            f.max = fmax;\n            f.type = thisB.bwg.type;\n            \n            for (var k in opts) {\n                f[k] = opts[k];\n            }\n            \n            features.push(f);\n        };\n\n        var tramp = function() {\n            if (blocksToFetch.length == 0) {\n                var afterBWG = Date.now();\n                // dlog('BWG fetch took ' + (afterBWG - beforeBWG) + 'ms');\n                callback(features);\n                return;  // just in case...\n            } else {\n                var block = blocksToFetch[0];\n                if (block.data) {\n                    thisB.parseFeatures(block.data, createFeature, filter);\n                    blocksToFetch.splice(0, 1);\n                    tramp();\n                } else {\n                    var fetchStart = block.offset;\n                    var fetchSize = block.size;\n                    var bi = 1;\n                    while (bi < blocksToFetch.length && blocksToFetch[bi].offset == (fetchStart + fetchSize)) {\n                        fetchSize += blocksToFetch[bi].size;\n                        ++bi;\n                    }\n\n                    thisB.bwg.data.slice(fetchStart, fetchSize).fetch(function(result) {\n                        var offset = 0;\n                        var bi = 0;\n                        while (offset < fetchSize) {\n                            var fb = blocksToFetch[bi];\n                        \n                            var data;\n                            if (thisB.bwg.uncompressBufSize > 0) {\n                                data = jszlib_inflate_buffer(result, offset + 2, fb.size - 2);\n                            } else {\n                                var tmp = new Uint8Array(fb.size);    // FIXME is this really the best we can do?\n                                arrayCopy(new Uint8Array(result, offset, fb.size), 0, tmp, 0, fb.size);\n                                data = tmp.buffer;\n                            }\n                            fb.data = data;\n                            \n                            offset += fb.size;\n                            ++bi;\n                        }\n                        tramp();\n                    });\n                }\n            }\n        }\n        tramp();\n    }\n}\n\nBigWigView.prototype.parseFeatures = function(data, createFeature, filter) {\n    var ba = new Uint8Array(data);\n\n    if (this.isSummary) {\n        var sa = new Int16Array(data);\n        var la = new Int32Array(data);\n        var fa = new Float32Array(data);\n\n        var itemCount = data.byteLength/32;\n        for (var i = 0; i < itemCount; ++i) {\n            var chromId =   la[(i*8)];\n            var start =     la[(i*8)+1];\n            var end =       la[(i*8)+2];\n            var validCnt =  la[(i*8)+3];\n            var minVal    = fa[(i*8)+4];\n            var maxVal    = fa[(i*8)+5];\n            var sumData   = fa[(i*8)+6];\n            var sumSqData = fa[(i*8)+7];\n            \n            if (filter(chromId, start + 1, end)) {\n                var summaryOpts = {type: 'bigwig', score: sumData/validCnt, maxScore: maxVal};\n                if (this.bwg.type == 'bigbed') {\n                    summaryOpts.type = 'density';\n                }\n                createFeature(chromId, start + 1, end, summaryOpts);\n            }\n        }\n    } else if (this.bwg.type == 'bigwig') {\n        var sa = new Int16Array(data);\n        var la = new Int32Array(data);\n        var fa = new Float32Array(data);\n\n        var chromId = la[0];\n        var blockStart = la[1];\n        var blockEnd = la[2];\n        var itemStep = la[3];\n        var itemSpan = la[4];\n        var blockType = ba[20];\n        var itemCount = sa[11];\n        \n        if (blockType == BIG_WIG_TYPE_FSTEP) {\n            for (var i = 0; i < itemCount; ++i) {\n                var score = fa[i + 6];\n                var fmin = blockStart + (i*itemStep) + 1, fmax = blockStart + (i*itemStep) + itemSpan;\n                if (filter(chromId, fmin, fmax))\n                    createFeature(chromId, fmin, fmax, {score: score});\n            }\n        } else if (blockType == BIG_WIG_TYPE_VSTEP) {\n            for (var i = 0; i < itemCount; ++i) {\n                var start = la[(i*2) + 6] + 1;\n                var end = start + itemSpan - 1;\n                var score = fa[(i*2) + 7];\n                if (filter(chromId, start, end))\n                    createFeature(chromId, start, end, {score: score});\n            }\n        } else if (blockType == BIG_WIG_TYPE_GRAPH) {\n            for (var i = 0; i < itemCount; ++i) {\n                var start = la[(i*3) + 6] + 1;\n                var end   = la[(i*3) + 7];\n                var score = fa[(i*3) + 8];\n                if (start > end) {\n                    start = end;\n                }\n                if (filter(chromId, start, end))\n                    createFeature(chromId, start, end, {score: score});\n            }\n        } else {\n            console.log('Currently not handling bwgType=' + blockType);\n        }\n    } else if (this.bwg.type == 'bigbed') {\n        var offset = 0;\n        var dfc = this.bwg.definedFieldCount;\n        var schema = this.bwg.schema;\n\n        while (offset < ba.length) {\n            var chromId = (ba[offset+3]<<24) | (ba[offset+2]<<16) | (ba[offset+1]<<8) | (ba[offset+0]);\n            var start = (ba[offset+7]<<24) | (ba[offset+6]<<16) | (ba[offset+5]<<8) | (ba[offset+4]);\n            var end = (ba[offset+11]<<24) | (ba[offset+10]<<16) | (ba[offset+9]<<8) | (ba[offset+8]);\n            offset += 12;\n            var rest = '';\n            while (true) {\n                var ch = ba[offset++];\n                if (ch != 0) {\n                    rest += String.fromCharCode(ch);\n                } else {\n                    break;\n                }\n            }\n\n            var featureOpts = {};\n            \n            var bedColumns;\n            if (rest.length > 0) {\n                bedColumns = rest.split('\\t');\n            } else {\n                bedColumns = [];\n            }\n            if (bedColumns.length > 0 && dfc > 3) {\n                featureOpts.label = bedColumns[0];\n            }\n            if (bedColumns.length > 1 && dfc > 4) {\n                var score = parseInt(bedColumns[1]);\n                if (!isNaN(score))\n                    featureOpts.score = score;\n            }\n            if (bedColumns.length > 2 && dfc > 5) {\n                featureOpts.orientation = bedColumns[2];\n            }\n            if (bedColumns.length > 5 && dfc > 8) {\n                var color = bedColumns[5];\n                if (BED_COLOR_REGEXP.test(color)) {\n                    featureOpts.itemRgb = 'rgb(' + color + ')';\n                }\n            }\n\n            if (bedColumns.length > dfc-3 && schema) {\n                for (var col = dfc - 3; col < bedColumns.length; ++col) {\n                    featureOpts[schema.fields[col+3].name] = bedColumns[col];\n                }\n            }\n\n            if (filter(chromId, start + 1, end, bedColumns)) {\n                if (dfc < 12) {\n                    createFeature(chromId, start + 1, end, featureOpts);\n                } else {\n                    var thickStart = bedColumns[3]|0;\n                    var thickEnd   = bedColumns[4]|0;\n                    var blockCount = bedColumns[6]|0;\n                    var blockSizes = bedColumns[7].split(',');\n                    var blockStarts = bedColumns[8].split(',');\n\n                    if (featureOpts.exonFrames) {\n                        var exonFrames = featureOpts.exonFrames.split(',');\n                        featureOpts.exonFrames = undefined;\n                    }\n                    \n                    featureOpts.type = 'transcript'\n                    var grp = new DASGroup();\n                    for (var k in featureOpts) {\n                        grp[k] = featureOpts[k];\n                    }\n                    grp.id = bedColumns[0];\n                    grp.segment = this.bwg.idsToChroms[chromId];\n                    grp.min = start + 1;\n                    grp.max = end;\n                    grp.notes = [];\n                    featureOpts.groups = [grp];\n\n                    // Moving towards using bigGenePred model, but will\n                    // still support old Dalliance-style BED12+gene-name for the\n                    // foreseeable future.\n                    if (bedColumns.length > 9) {\n                        var geneId = featureOpts.geneName || bedColumns[9];\n                        var geneName = geneId;\n                        if (bedColumns.length > 10) {\n                            geneName = bedColumns[10];\n                        }\n                        if (featureOpts.geneName2)\n                            geneName = featureOpts.geneName2;\n\n                        var gg = shallowCopy(grp);\n                        gg.id = geneId;\n                        gg.label = geneName;\n                        gg.type = 'gene';\n                        featureOpts.groups.push(gg);\n                    }\n\n                    var spanList = [];\n                    for (var b = 0; b < blockCount; ++b) {\n                        var bmin = (blockStarts[b]|0) + start;\n                        var bmax = bmin + (blockSizes[b]|0);\n                        var span = new Range(bmin, bmax);\n                        spanList.push(span);\n                    }\n                    var spans = union(spanList);\n                    \n                    var tsList = spans.ranges();\n                    for (var s = 0; s < tsList.length; ++s) {\n                        var ts = tsList[s];\n                        createFeature(chromId, ts.min() + 1, ts.max(), featureOpts);\n                    }\n\n                    if (thickEnd > thickStart) {\n                        var codingRegion = (featureOpts.orientation == '+') ?\n                            new Range(thickStart, thickEnd + 3) :\n                            new Range(thickStart - 3, thickEnd);\n                            // +/- 3 to account for stop codon\n\n                        var tl = intersection(spans, codingRegion);\n                        if (tl) {\n                            featureOpts.type = 'translation';\n                            var tlList = tl.ranges();\n                            var readingFrame = 0;\n\n                            var tlOffset = 0;\n                            while (tlList[0].min() > tsList[tlOffset].max())\n                                tlOffset++;\n\n                            for (var s = 0; s < tlList.length; ++s) {\n                                // Record reading frame for every exon\n                                var index = s;\n                                if (featureOpts.orientation == '-')\n                                    index = tlList.length - s - 1;\n                                var ts = tlList[index];\n                                featureOpts.readframe = readingFrame;\n                                if (exonFrames) {\n                                    var brf = parseInt(exonFrames[index + tlOffset]);\n                                    if (typeof(brf) === 'number' && brf >= 0 && brf <= 2) {\n                                        featureOpts.readframe = brf;\n                                        featureOpts.readframeExplicit = true;\n                                    }\n                                }\n                                var length = ts.max() - ts.min();\n                                readingFrame = (readingFrame + length) % 3;\n                                createFeature(chromId, ts.min() + 1, ts.max(), featureOpts);\n                            }\n                        }\n                    }\n                }\n            }\n        }\n    } else {\n        throw Error(\"Don't know what to do with \" + this.bwg.type);\n    }\n}\n\n//\n// nasty cut/paste, should roll back in!\n//\n\nBigWigView.prototype.getFirstAdjacent = function(chrName, pos, dir, callback) {\n    var chr = this.bwg.chromsToIDs[chrName];\n    if (chr === undefined) {\n        // Not an error because some .bwgs won't have data for all chromosomes.\n        return callback([]);\n    } else {\n        this.getFirstAdjacentById(chr, pos, dir, callback);\n    }\n}\n\nBigWigView.prototype.getFirstAdjacentById = function(chr, pos, dir, callback) {\n    var thisB = this;\n    if (!this.cirHeader) {\n        this.bwg.data.slice(this.cirTreeOffset, 48).fetch(function(result) {\n            thisB.cirHeader = result;\n            var la = new Int32Array(thisB.cirHeader);\n            thisB.cirBlockSize = la[1];\n            thisB.getFirstAdjacentById(chr, pos, dir, callback);\n        });\n        return;\n    }\n\n    var blockToFetch = null;\n    var bestBlockChr = -1;\n    var bestBlockOffset = -1;\n\n    var outstanding = 0;\n\n    var beforeBWG = Date.now();\n\n    var cirFobRecur = function(offset, level) {\n        outstanding += offset.length;\n\n        var maxCirBlockSpan = 4 +  (thisB.cirBlockSize * 32);   // Upper bound on size, based on a completely full leaf node.\n        var spans;\n        for (var i = 0; i < offset.length; ++i) {\n            var blockSpan = new Range(offset[i], offset[i] + maxCirBlockSpan);\n            spans = spans ? union(spans, blockSpan) : blockSpan;\n        }\n        \n        var fetchRanges = spans.ranges();\n        for (var r = 0; r < fetchRanges.length; ++r) {\n            var fr = fetchRanges[r];\n            cirFobStartFetch(offset, fr, level);\n        }\n    }\n\n    var cirFobStartFetch = function(offset, fr, level, attempts) {\n        var length = fr.max() - fr.min();\n        thisB.bwg.data.slice(fr.min(), fr.max() - fr.min()).fetch(function(resultBuffer) {\n            for (var i = 0; i < offset.length; ++i) {\n                if (fr.contains(offset[i])) {\n                    cirFobRecur2(resultBuffer, offset[i] - fr.min(), level);\n                    --outstanding;\n                    if (outstanding == 0) {\n                        if (!blockToFetch) {\n                            if (dir > 0 && (chr != 0 || pos > 0)) {\n                                return thisB.getFirstAdjacentById(0, 0, dir, callback);\n                            } else if (dir < 0 && (chr != thisB.bwg.maxID || pos < 1000000000)) {\n                                return thisB.getFirstAdjacentById(thisB.bwg.maxID, 1000000000, dir, callback);\n                            }\n                            return callback([]);\n                        }\n\n                        thisB.fetchFeatures(function(chrx, fmin, fmax, toks) {\n                            return (dir < 0 && (chrx < chr || fmax < pos)) || (dir > 0 && (chrx > chr || fmin > pos));\n                        }, [blockToFetch], function(features) {\n                            var bestFeature = null;\n                            var bestChr = -1;\n                            var bestPos = -1;\n                            for (var fi = 0; fi < features.length; ++fi) {\n                                var f = features[fi];\n                                var chrx = f._chromId, fmin = f.min, fmax = f.max;\n                                if (bestFeature == null || ((dir < 0) && (chrx > bestChr || fmax > bestPos)) || ((dir > 0) && (chrx < bestChr || fmin < bestPos))) {\n                                    bestFeature = f;\n                                    bestPos = (dir < 0) ? fmax : fmin;\n                                    bestChr = chrx;\n                                }\n                            }\n\n                            if (bestFeature != null) \n                                return callback([bestFeature]);\n                            else\n                                return callback([]);\n                        });\n                    }\n                }\n            }\n        });\n    }\n\n    var cirFobRecur2 = function(cirBlockData, offset, level) {\n        var ba = new Uint8Array(cirBlockData);\n        var sa = new Int16Array(cirBlockData);\n        var la = new Int32Array(cirBlockData);\n\n        var isLeaf = ba[offset];\n        var cnt = sa[offset/2 + 1];\n        offset += 4;\n\n        if (isLeaf != 0) {\n            for (var i = 0; i < cnt; ++i) {\n                var lo = offset/4;\n                var startChrom = la[lo];\n                var startBase = la[lo + 1];\n                var endChrom = la[lo + 2];\n                var endBase = la[lo + 3];\n                var blockOffset = bwg_readOffset(ba, offset+16);\n                var blockSize = bwg_readOffset(ba, offset+24);\n                if ((dir < 0 && ((startChrom < chr || (startChrom == chr && startBase <= pos)))) ||\n                    (dir > 0 && ((endChrom > chr || (endChrom == chr && endBase >= pos)))))\n                {\n                    // console.log('Got an interesting block: startBase=' + startChrom + ':' + startBase + '; endBase=' + endChrom + ':' + endBase + '; offset=' + blockOffset + '; size=' + blockSize);\n                    if (/_random/.exec(thisB.bwg.idsToChroms[startChrom])) {\n                        // dlog('skipping random: ' + thisB.bwg.idsToChroms[startChrom]);\n                    } else if (blockToFetch == null || ((dir < 0) && (endChrom > bestBlockChr || (endChrom == bestBlockChr && endBase > bestBlockOffset)) ||\n                                                 (dir > 0) && (startChrom < bestBlockChr || (startChrom == bestBlockChr && startBase < bestBlockOffset))))\n                    {\n                        //                        dlog('best is: startBase=' + startChrom + ':' + startBase + '; endBase=' + endChrom + ':' + endBase + '; offset=' + blockOffset + '; size=' + blockSize);\n                        blockToFetch = {offset: blockOffset, size: blockSize};\n                        bestBlockOffset = (dir < 0) ? endBase : startBase;\n                        bestBlockChr = (dir < 0) ? endChrom : startChrom;\n                    }\n                }\n                offset += 32;\n            }\n        } else {\n            var bestRecur = -1;\n            var bestPos = -1;\n            var bestChr = -1;\n            for (var i = 0; i < cnt; ++i) {\n                var lo = offset/4;\n                var startChrom = la[lo];\n                var startBase = la[lo + 1];\n                var endChrom = la[lo + 2];\n                var endBase = la[lo + 3];\n                var blockOffset = (la[lo + 4]<<32) | (la[lo + 5]);\n                if ((dir < 0 && ((startChrom < chr || (startChrom == chr && startBase <= pos)) &&\n                                 (endChrom   >= chr))) ||\n                     (dir > 0 && ((endChrom > chr || (endChrom == chr && endBase >= pos)) &&\n                                  (startChrom <= chr))))\n                {\n                    if (bestRecur < 0 || endBase > bestPos) {\n                        bestRecur = blockOffset;\n                        bestPos = (dir < 0) ? endBase : startBase;\n                        bestChr = (dir < 0) ? endChrom : startChrom;\n                    }\n                }\n                offset += 24;\n            }\n            if (bestRecur >= 0) {\n                cirFobRecur([bestRecur], level + 1);\n            }\n        }\n    };\n    \n\n    cirFobRecur([thisB.cirTreeOffset + 48], 1);\n}\n\nBigWig.prototype.readWigData = function(chrName, min, max, callback) {\n    this.getUnzoomedView().readWigData(chrName, min, max, callback);\n}\n\nBigWig.prototype.getUnzoomedView = function() {\n    if (!this.unzoomedView) {\n        var cirLen = 4000;\n        var nzl = this.zoomLevels[0];\n        if (nzl) {\n            cirLen = this.zoomLevels[0].dataOffset - this.unzoomedIndexOffset;\n        }\n        this.unzoomedView = new BigWigView(this, this.unzoomedIndexOffset, cirLen, false);\n    }\n    return this.unzoomedView;\n}\n\nBigWig.prototype.getZoomedView = function(z) {\n    var zh = this.zoomLevels[z];\n    if (!zh.view) {\n        zh.view = new BigWigView(this, zh.indexOffset, /* this.zoomLevels[z + 1].dataOffset - zh.indexOffset */ 4000, true);\n    }\n    return zh.view;\n}\n\nfunction makeBwg(data, callback, name) {\n    var bwg = new BigWig();\n    bwg.data = data;\n    bwg.name = name;\n    bwg.data.slice(0, 512).salted().fetch(function(result) {\n        if (!result) {\n            return callback(null, \"Couldn't fetch file\");\n        }\n\n        var header = result;\n        var ba = new Uint8Array(header);\n        var sa = new Int16Array(header);\n        var la = new Int32Array(header);\n        var magic = ba[0] + (M1 * ba[1]) + (M2 * ba[2]) + (M3 * ba[3]);\n        if (magic == BIG_WIG_MAGIC) {\n            bwg.type = 'bigwig';\n        } else if (magic == BIG_BED_MAGIC) {\n            bwg.type = 'bigbed';\n        } else if (magic == BIG_WIG_MAGIC_BE || magic == BIG_BED_MAGIC_BE) {\n            return callback(null, \"Currently don't support big-endian BBI files\");\n            \n        } else {\n            return callback(null, \"Not a supported format, magic=0x\" + magic.toString(16));\n            \n        }\n\n        bwg.version = sa[2];             // 4\n        bwg.numZoomLevels = sa[3];       // 6\n        bwg.chromTreeOffset = bwg_readOffset(ba, 8);\n        bwg.unzoomedDataOffset = bwg_readOffset(ba, 16);\n        bwg.unzoomedIndexOffset = bwg_readOffset(ba, 24);\n        bwg.fieldCount = sa[16];         // 32\n        bwg.definedFieldCount = sa[17];  // 34\n        bwg.asOffset = bwg_readOffset(ba, 36);\n        bwg.totalSummaryOffset = bwg_readOffset(ba, 44);\n        bwg.uncompressBufSize = la[13];  // 52\n        bwg.extHeaderOffset = bwg_readOffset(ba, 56);\n\n        bwg.zoomLevels = [];\n        for (var zl = 0; zl < bwg.numZoomLevels; ++zl) {\n            var zlReduction = la[zl*6 + 16]\n            var zlData = bwg_readOffset(ba, zl*24 + 72);\n            var zlIndex = bwg_readOffset(ba, zl*24 + 80);\n            bwg.zoomLevels.push({reduction: zlReduction, dataOffset: zlData, indexOffset: zlIndex});\n        }\n\n        bwg.readChromTree(function() {\n            bwg.getAutoSQL(function(as) {\n                bwg.schema = as;\n                return callback(bwg);\n            });\n        });\n    }, {timeout: 5000});    // Potential timeout on first request to catch mixed-content errors on\n                            // Chromium.\n}\n\n\nBigWig.prototype._tsFetch = function(zoom, chr, min, max, callback) {\n    var bwg = this;\n    if (zoom >= this.zoomLevels.length - 1) {\n        if (!this.topLevelReductionCache) {\n            this.getZoomedView(this.zoomLevels.length - 1).readWigDataById(-1, 0, 300000000, function(feats) {\n                bwg.topLevelReductionCache = feats;\n                return bwg._tsFetch(zoom, chr, min, max, callback);\n            });\n        } else {\n            var f = [];\n            var c = this.topLevelReductionCache;\n            for (var fi = 0; fi < c.length; ++fi) {\n                if (c[fi]._chromId == chr) {\n                    f.push(c[fi]);\n                }\n            }\n            return callback(f);\n        }\n    } else {\n        var view;\n        if (zoom < 0) {\n            view = this.getUnzoomedView();\n        } else {\n            view = this.getZoomedView(zoom);\n        }\n        return view.readWigDataById(chr, min, max, callback);\n    }\n}\n\nBigWig.prototype.thresholdSearch = function(chrName, referencePoint, dir, threshold, callback) {\n    dir = (dir<0) ? -1 : 1;\n    var bwg = this;\n    var initialChr = this.chromsToIDs[chrName];\n    var candidates = [{chrOrd: 0, chr: initialChr, zoom: bwg.zoomLevels.length - 4, min: 0, max: 300000000, fromRef: true}]\n    for (var i = 1; i <= this.maxID + 1; ++i) {\n        var chrId = (initialChr + (dir*i)) % (this.maxID + 1);\n        if (chrId < 0) \n            chrId += (this.maxID + 1);\n        candidates.push({chrOrd: i, chr: chrId, zoom: bwg.zoomLevels.length - 1, min: 0, max: 300000000})\n    }\n       \n    function fbThresholdSearchRecur() {\n    \tif (candidates.length == 0) {\n    \t    return callback(null);\n    \t}\n    \tcandidates.sort(function(c1, c2) {\n    \t    var d = c1.zoom - c2.zoom;\n    \t    if (d != 0)\n    \t\t    return d;\n\n            d = c1.chrOrd - c2.chrOrd;\n            if (d != 0)\n                return d;\n    \t    else\n    \t\t    return c1.min - c2.min * dir;\n    \t});\n\n\t    var candidate = candidates.splice(0, 1)[0];\n        bwg._tsFetch(candidate.zoom, candidate.chr, candidate.min, candidate.max, function(feats) {\n            var rp = dir > 0 ? 0 : 300000000;\n            if (candidate.fromRef)\n                rp = referencePoint;\n            \n            for (var fi = 0; fi < feats.length; ++fi) {\n    \t        var f = feats[fi];\n                var score;\n                if (f.maxScore != undefined)\n                    score = f.maxScore;\n                else\n                    score = f.score;\n\n                if (dir > 0) {\n    \t            if (score > threshold) {\n        \t\t        if (candidate.zoom < 0) {\n        \t\t            if (f.min > rp)\n                                return callback(f);\n        \t\t        } else if (f.max > rp) {\n        \t\t            candidates.push({chr: candidate.chr, chrOrd: candidate.chrOrd, zoom: candidate.zoom - 2, min: f.min, max: f.max, fromRef: candidate.fromRef});\n        \t\t        }\n                    }\n                } else {\n                    if (score > threshold) {\n            \t\t    if (candidate.zoom < 0) {\n                \t        if (f.max < rp)\n                \t\t\t    return callback(f);\n                        } else if (f.min < rp) {\n                            candidates.push({chr: candidate.chr, chrOrd: candidate.chrOrd, zoom: candidate.zoom - 2, min: f.min, max: f.max, fromRef: candidate.fromRef});\n                        }\n    \t            }\n                }\n    \t    }\n            fbThresholdSearchRecur();\n        });\n    }\n    \n    fbThresholdSearchRecur();\n}\n\nBigWig.prototype.getAutoSQL = function(callback) {\n    var thisB = this;\n    if (!this.asOffset)\n        return callback(null);\n\n\n    this.data.slice(this.asOffset, 2048).fetch(function(result) {\n        var ba = new Uint8Array(result);\n        var s = '';\n        for (var i = 0; i < ba.length; ++i) {\n            if (ba[i] == 0)\n                break;\n            s += String.fromCharCode(ba[i]);\n        }\n        \n        /* \n         * Quick'n'dirty attempt to parse autoSql format.\n         * See: http://www.linuxjournal.com/files/linuxjournal.com/linuxjournal/articles/059/5949/5949l2.html\n         */\n\n        var header_re = /(\\w+)\\s+(\\w+)\\s+(\"([^\"]+)\")?\\s+\\(\\s*/;\n        var field_re = /([\\w\\[\\]]+)\\s+(\\w+)\\s*;\\s*(\"([^\"]+)\")?\\s*/g;\n\n        var headerMatch = header_re.exec(s);\n        if (headerMatch) {\n            var as = {\n                declType: headerMatch[1],\n                name: headerMatch[2],\n                comment: headerMatch[4],\n\n                fields: []\n            };\n\n            s = s.substring(headerMatch[0]);\n            for (var m = field_re.exec(s); m != null; m = field_re.exec(s)) {\n                as.fields.push({type: m[1],\n                             name: m[2],\n                             comment: m[4]});\n            }\n\n            return callback(as);\n        }\n    });\n}\n\nBigWig.prototype.getExtraIndices = function(callback) {\n    var thisB = this;\n    if (this.version < 4 || this.extHeaderOffset == 0 || this.type != 'bigbed') {\n        return callback(null);\n    } else {\n        this.data.slice(this.extHeaderOffset, 64).fetch(function(result) {\n            if (!result) {\n                return callback(null, \"Couldn't fetch extension header\");\n            }\n\n            var ba = new Uint8Array(result);\n            var sa = new Int16Array(result);\n            var la = new Int32Array(result);\n            \n            var extHeaderSize = sa[0];\n            var extraIndexCount = sa[1];\n            var extraIndexListOffset = bwg_readOffset(ba, 4);\n\n            if (extraIndexCount == 0) {\n                return callback(null);\n            }\n\n            // FIXME 20byte records only make sense for single-field indices.\n            // Right now, these seem to be the only things around, but the format\n            // is actually more general.\n            thisB.data.slice(extraIndexListOffset, extraIndexCount * 20).fetch(function(eil) {\n                if (!eil) {\n                    return callback(null, \"Couldn't fetch index info\");\n                }\n\n                var ba = new Uint8Array(eil);\n                var sa = new Int16Array(eil);\n                var la = new Int32Array(eil);\n\n                var indices = [];\n                for (var ii = 0; ii < extraIndexCount; ++ii) {\n                    var eiType = sa[ii*10];\n                    var eiFieldCount = sa[ii*10 + 1];\n                    var eiOffset = bwg_readOffset(ba, ii*20 + 4);\n                    var eiField = sa[ii*10 + 8]\n                    var index = new BBIExtraIndex(thisB, eiType, eiFieldCount, eiOffset, eiField);\n                    indices.push(index);\n                }\n                callback(indices);\n            });\n        });\n    }\n}\n\nfunction BBIExtraIndex(bbi, type, fieldCount, offset, field) {\n    this.bbi = bbi;\n    this.type = type;\n    this.fieldCount = fieldCount;\n    this.offset = offset;\n    this.field = field;\n}\n\nBBIExtraIndex.prototype.lookup = function(name, callback) {\n    var thisB = this;\n\n    this.bbi.data.slice(this.offset, 32).fetch(function(bpt) {\n        var ba = new Uint8Array(bpt);\n        var sa = new Int16Array(bpt);\n        var la = new Int32Array(bpt);\n        var bptMagic = la[0];\n        var blockSize = la[1];\n        var keySize = la[2];\n        var valSize = la[3];\n        var itemCount = bwg_readOffset(ba, 16);\n        var rootNodeOffset = 32;\n\n        function bptReadNode(nodeOffset) {\n            thisB.bbi.data.slice(nodeOffset, 4 + (blockSize * (keySize + valSize))).fetch(function(node) {\n                var ba = new Uint8Array(node);\n                var sa = new Uint16Array(node);\n                var la = new Uint32Array(node);\n\n                var nodeType = ba[0];\n                var cnt = sa[1];\n\n                var offset = 4;\n                if (nodeType == 0) {\n                    var lastChildOffset = null;\n                    for (var n = 0; n < cnt; ++n) {\n                        var key = '';\n                        for (var ki = 0; ki < keySize; ++ki) {\n                            var charCode = ba[offset++];\n                            if (charCode != 0) {\n                                key += String.fromCharCode(charCode);\n                            }\n                        }\n\n                        var childOffset = bwg_readOffset(ba, offset);\n                        offset += 8;\n                        \n                        if (name.localeCompare(key) < 0 && lastChildOffset) {\n                            bptReadNode(lastChildOffset);\n                            return;\n                        }\n                        lastChildOffset = childOffset;\n                    }\n                    bptReadNode(lastChildOffset);\n                } else {\n                    for (var n = 0; n < cnt; ++n) {\n                        var key = '';\n                        for (var ki = 0; ki < keySize; ++ki) {\n                            var charCode = ba[offset++];\n                            if (charCode != 0) {\n                                key += String.fromCharCode(charCode);\n                            }\n                        }\n                        \n                        // Specific for EI case.\n                        if (key == name) {\n                            var start = bwg_readOffset(ba, offset);\n                            var length = readInt(ba, offset + 8);\n\n                            return thisB.bbi.getUnzoomedView().fetchFeatures(\n                                function(chr, min, max, toks) {\n                                    if (toks && toks.length > thisB.field - 3)\n                                        return toks[thisB.field - 3] == name;\n                                }, \n                                [{offset: start, size: length}], \n                                callback);\n                        }\n                        offset += valSize;\n                    }\n                    return callback([]);\n                }\n            });\n        }\n\n        bptReadNode(thisB.offset + rootNodeOffset);\n    });\n}\n\nif (typeof(module) !== 'undefined') {\n    module.exports = {\n        makeBwg: makeBwg,\n        BIG_BED_MAGIC: BIG_BED_MAGIC,\n        BIG_WIG_MAGIC: BIG_WIG_MAGIC\n    }\n}\n","/* -*- mode: javascript; c-basic-offset: 4; indent-tabs-mode: nil -*- */\n\n// \n// Dalliance Genome Explorer\n// (c) Thomas Down 2006-2011\n//\n// bin.js general binary data support\n//\n\n\"use strict\";\n\nif (typeof(require) !== 'undefined') {\n    var utils = require('./utils');\n    var shallowCopy = utils.shallowCopy;\n\n    var sha1 = require('./sha1');\n    var b64_sha1 = sha1.b64_sha1;\n\n    var Promise = require('es6-promise').Promise;\n}\n\nfunction BlobFetchable(b) {\n    this.blob = b;\n}\n\nBlobFetchable.prototype.slice = function(start, length) {\n    var b;\n\n    if (this.blob.slice) {\n        if (length) {\n            b = this.blob.slice(start, start + length);\n        } else {\n            b = this.blob.slice(start);\n        }\n    } else {\n        if (length) {\n            b = this.blob.webkitSlice(start, start + length);\n        } else {\n            b = this.blob.webkitSlice(start);\n        }\n    }\n    return new BlobFetchable(b);\n}\n\nBlobFetchable.prototype.salted = function() {return this;}\n\nif (typeof(FileReader) !== 'undefined') {\n    // console.log('defining async BlobFetchable.fetch');\n\n    BlobFetchable.prototype.fetch = function(callback) {\n        var reader = new FileReader();\n        reader.onloadend = function(ev) {\n            callback(bstringToBuffer(reader.result));\n        };\n        reader.readAsBinaryString(this.blob);\n    }\n\n} else {\n    // if (console && console.log)\n    //    console.log('defining sync BlobFetchable.fetch');\n\n    BlobFetchable.prototype.fetch = function(callback) {\n        var reader = new FileReaderSync();\n        try {\n            var res = reader.readAsArrayBuffer(this.blob);\n            callback(res);\n        } catch (e) {\n            callback(null, e);\n        }\n    }\n}\n\nfunction URLFetchable(url, start, end, opts) {\n    if (!opts) {\n        if (typeof start === 'object') {\n            opts = start;\n            start = undefined;\n        } else {\n            opts = {};\n        }\n    }\n\n    this.url = url;\n    this.start = start || 0;\n    if (end) {\n        this.end = end;\n    }\n    this.opts = opts;\n}\n\nURLFetchable.prototype.slice = function(s, l) {\n    if (s < 0) {\n        throw 'Bad slice ' + s;\n    }\n\n    var ns = this.start, ne = this.end;\n    if (ns && s) {\n        ns = ns + s;\n    } else {\n        ns = s || ns;\n    }\n    if (l && ns) {\n        ne = ns + l - 1;\n    } else {\n        ne = ne || l - 1;\n    }\n    return new URLFetchable(this.url, ns, ne, this.opts);\n}\n\nvar seed=0;\nvar isSafari = typeof(navigator) !== 'undefined' &&\n    navigator.userAgent.indexOf('Safari') >= 0 &&\n    navigator.userAgent.indexOf('Chrome') < 0 ;\n\nURLFetchable.prototype.fetchAsText = function(callback) {\n    var thisB = this;\n\n    this.getURL().then(function(url) {\n        try {\n            var req = new XMLHttpRequest();\n            var length;\n            if ((isSafari || thisB.opts.salt) && url.indexOf('?') < 0) {\n                url = url + '?salt=' + b64_sha1('' + Date.now() + ',' + (++seed));\n            }\n            req.open('GET', url, true);\n            \n            if (thisB.end) {\n                if (thisB.end - thisB.start > 100000000) {\n                    throw 'Monster fetch!';\n                }\n                req.setRequestHeader('Range', 'bytes=' + thisB.start + '-' + thisB.end);\n                length = thisB.end - thisB.start + 1;\n            }\n\n            req.onreadystatechange = function() {\n                if (req.readyState == 4) {\n                    if (req.status == 200 || req.status == 206) {\n                        return callback(req.responseText);\n                    } else {\n                        return callback(null);\n                    }\n                }\n            };\n            if (thisB.opts.credentials) {\n                req.withCredentials = true;\n            }\n            req.send();\n        } catch (e) {\n            return callback(null);\n        }\n    }).catch(function(err) {\n        console.log(err);\n        return callback(null, err);\n    });\n}\n\nURLFetchable.prototype.salted = function() {\n    var o = shallowCopy(this.opts);\n    o.salt = true;\n    return new URLFetchable(this.url, this.start, this.end, o);\n}\n\nURLFetchable.prototype.getURL = function() {\n    if (this.opts.resolver) {\n        return this.opts.resolver(this.url).then(function (urlOrObj) {\n            if (typeof urlOrObj === 'string') {\n                return urlOrObj;\n            } else {\n                return urlOrObj.url;\n            }\n        });\n    } else {\n        return Promise.resolve(this.url);\n    }\n}\n\nURLFetchable.prototype.fetch = function(callback, opts) {\n    var thisB = this;\n \n    opts = opts || {};\n    var attempt = opts.attempt || 1;\n    var truncatedLength = opts.truncatedLength;\n    if (attempt > 3) {\n        return callback(null);\n    }\n\n    this.getURL().then(function(url) {\n        try {\n            var timeout;\n            if (opts.timeout && !thisB.opts.credentials) {\n                timeout = setTimeout(\n                    function() {\n                        console.log('timing out ' + url);\n                        req.abort();\n                        return callback(null, 'Timeout');\n                    },\n                    opts.timeout\n                );\n            }\n            \n            var req = new XMLHttpRequest();\n            var length;\n            if ((isSafari || thisB.opts.salt) && url.indexOf('?') < 0) {\n                url = url + '?salt=' + b64_sha1('' + Date.now() + ',' + (++seed));\n            }\n            req.open('GET', url, true);\n            req.overrideMimeType('text/plain; charset=x-user-defined');\n            if (thisB.end) {\n                if (thisB.end - thisB.start > 100000000) {\n                    throw 'Monster fetch!';\n                }\n                req.setRequestHeader('Range', 'bytes=' + thisB.start + '-' + thisB.end);\n                length = thisB.end - thisB.start + 1;\n            }\n            req.responseType = 'arraybuffer';\n            req.onreadystatechange = function() {\n                if (req.readyState == 4) {\n                    if (timeout)\n                        clearTimeout(timeout);\n                    if (req.status == 200 || req.status == 206) {\n                        if (req.response) {\n                            var bl = req.response.byteLength;\n                            if (length && length != bl && (!truncatedLength || bl != truncatedLength)) {\n                                return thisB.fetch(callback, {attempt: attempt + 1, truncatedLength: bl});\n                            } else {\n                                return callback(req.response);\n                            }\n                        } else if (req.mozResponseArrayBuffer) {\n                            return callback(req.mozResponseArrayBuffer);\n                        } else {\n                            var r = req.responseText;\n                            if (length && length != r.length && (!truncatedLength || r.length != truncatedLength)) {\n                                return thisB.fetch(callback, {attempt: attempt + 1, truncatedLength: r.length});\n                            } else {\n                                return callback(bstringToBuffer(req.responseText));\n                            }\n                        }\n                    } else {\n                        return thisB.fetch(callback, {attempt: attempt + 1});\n                    }\n                }\n            };\n            if (thisB.opts.credentials) {\n                req.withCredentials = true;\n            }\n            req.send();\n        } catch (e) {\n            return callback(null);\n        }\n    }).catch(function(err) {\n        console.log(err);\n        return callback(null, err);\n    });\n}\n                       \nfunction bstringToBuffer(result) {\n    if (!result) {\n        return null;\n    }\n\n    var ba = new Uint8Array(result.length);\n    for (var i = 0; i < ba.length; ++i) {\n        ba[i] = result.charCodeAt(i);\n    }\n    return ba.buffer;\n}\n\n// Read from Uint8Array\n\nvar convertBuffer = new ArrayBuffer(8);\nvar ba = new Uint8Array(convertBuffer);\nvar fa = new Float32Array(convertBuffer);\n\nfunction readFloat(buf, offset) {\n    ba[0] = buf[offset];\n    ba[1] = buf[offset+1];\n    ba[2] = buf[offset+2];\n        ba[3] = buf[offset+3];\n    return fa[0];\n}\n\nfunction readInt64(ba, offset) {\n    return (ba[offset + 7] << 24) | (ba[offset + 6] << 16) | (ba[offset + 5] << 8) | (ba[offset + 4]);\n}\n\nfunction readInt(ba, offset) {\n    return (ba[offset + 3] << 24) | (ba[offset + 2] << 16) | (ba[offset + 1] << 8) | (ba[offset]);\n}\n\nfunction readShort(ba, offset) {\n    return (ba[offset + 1] << 8) | (ba[offset]);\n}\n\nfunction readByte(ba, offset) {\n    return ba[offset];\n}\n\nfunction readIntBE(ba, offset) {\n    return (ba[offset] << 24) | (ba[offset + 1] << 16) | (ba[offset + 2] << 8) | (ba[offset + 3]);\n}\n\n// Exports if we are being used as a module\n\nif (typeof(module) !== 'undefined') {\n    module.exports = {\n        BlobFetchable: BlobFetchable,\n        URLFetchable: URLFetchable,\n\n        readInt: readInt,\n        readIntBE: readIntBE,\n        readInt64: readInt64,\n        readShort: readShort,\n        readByte: readByte,\n        readFloat: readFloat\n    }\n}\n","/* -*- mode: javascript; c-basic-offset: 4; indent-tabs-mode: nil -*- */\n\n//\n// Dalliance Genome Explorer\n// (c) Thomas Down 2006-2013\n//\n// browser-us.js: standard UI wiring\n//\n\n\"use strict\";\n\nif (typeof(require) !== 'undefined') {\n    var browser = require('./cbrowser');\n    var Browser = browser.Browser;\n\n    var utils = require('./utils');\n    var makeElement = utils.makeElement;\n    var removeChildren = utils.removeChildren;\n\n    var nf = require('./numformats');\n    var formatLongInt = nf.formatLongInt;\n\n    var makeZoomSlider = require('./zoomslider');\n\n    // For side effects\n\n    require('./tier-edit');\n    require('./export-config');\n    require('./export-ui');\n    require('./export-image');\n    require('./svg-export');\n    require('./session');\n}\n\n/*\n * Quite a bit of this ought to be done using a templating system, but\n * since web-components isn't quite ready for prime time yet we'll stick\n * with constructing it all in Javascript for now...\n */\n\nBrowser.prototype.initUI = function(holder, genomePanel) {\n    if (!this.noSourceCSS) {\n      ['bootstrap-scoped.css', 'dalliance-scoped.css', 'font-awesome.min.css'].forEach(function(path) {\n        document.head.appendChild(makeElement('link', '', {\n          rel: 'stylesheet',\n          href: this.resolveURL('$$css/' + path)\n        }));\n      }.bind(this));\n    }\n\n    var b = this;\n\n    if (!b.disableDefaultFeaturePopup) {\n        this.addFeatureListener(function(ev, feature, hit, tier) {\n            b.featurePopup(ev, feature, hit, tier);\n        });\n    }\n\n    holder.classList.add('dalliance');\n    var toolbar = b.toolbar = makeElement('div', null, {className: 'btn-toolbar toolbar'});\n\n    var title = b.coordSystem.speciesName + ' ' + b.nameForCoordSystem(b.coordSystem);\n    if (this.setDocumentTitle) {\n        document.title = title + ' :: dalliance';\n    }\n\n    var locField = makeElement('input', '', {className: 'loc-field'});\n    b.makeTooltip(locField, 'Enter a genomic location or gene name');\n    var locStatusField = makeElement('p', '', {className: 'loc-status'});\n\n    var zoomInBtn = makeElement('a', [makeElement('i', null, {className: 'fa fa-search-plus'})], {className: 'btn'});\n    var zoomSlider = new makeZoomSlider({width: b.zoomSliderWidth});\n    b.makeTooltip(zoomSlider, \"Highlighted button shows current zoom level, gray button shows inactive zoom level (click or tap SPACE to toggle).\")\n\n    var zoomOutBtn = makeElement('a', [makeElement('i', null, {className: 'fa fa-search-minus'})], {className: 'btn'});\n\n    var clearHighlightsButton = makeElement('a', [makeElement('i', null, {className: 'fa fa-eraser'})], {className: 'btn'});\n\n    var addTrackBtn = makeElement('a', [makeElement('i', null, {className: 'fa fa-plus'})], {className: 'btn'});\n    var favBtn = makeElement('a', [makeElement('i', null, {className: 'fa fa-bookmark'})], {className: 'btn'});\n    var svgBtn = makeElement('a', [makeElement('i', null, {className: 'fa fa-print'})], {className: 'btn'});\n    var resetBtn = makeElement('a', [makeElement('i', null, {className: 'fa fa-refresh'})], {className: 'btn'});\n    var optsButton = makeElement('a', [makeElement('i', null, {className: 'fa fa-cogs'})], {className: 'btn'});\n    var helpButton = makeElement('a', [makeElement('i', null, {className: 'fa fa-question'})], {className: 'btn'});\n\n    var tierEditButton = makeElement('a', [makeElement('i', null, {className: 'fa fa-road'})], {className: 'btn'});\n    b.makeTooltip(tierEditButton, 'Configure currently selected track(s) (E)')\n\n    var leapLeftButton = makeElement('a', [makeElement('i', null, {className: 'fa fa-angle-left'})], {className: 'btn'}, {width: '5px'});\n    var leapRightButton = makeElement('a', [makeElement('i', null, {className: 'fa fa-angle-right'})], {className: 'btn pull-right'}, {width: '5px'});\n\n    var modeButtons = makeElement('div', null, {className: 'btn-group pull-right'});\n    if (!this.noTrackAdder)\n        modeButtons.appendChild(addTrackBtn);\n    if (!this.noTrackEditor)\n        modeButtons.appendChild(tierEditButton);\n    if (!this.noExport)\n        modeButtons.appendChild(svgBtn);\n    if (!this.noOptions)\n        modeButtons.appendChild(optsButton);\n    if (!this.noHelp)\n        modeButtons.appendChild(helpButton);\n\n    this.setUiMode = function(m) {\n        this.uiMode = m;\n        var mb = {help: helpButton, add: addTrackBtn, opts: optsButton, 'export': svgBtn, tier: tierEditButton};\n        for (var x in mb) {\n            if (x == m)\n                mb[x].classList.add('active');\n            else\n                mb[x].classList.remove('active');\n        }\n    }\n\n    if (!this.noLeapButtons)\n        toolbar.appendChild(leapRightButton);\n\n    if (modeButtons.firstChild)\n        toolbar.appendChild(modeButtons);\n    \n    if (!this.noLeapButtons)\n        toolbar.appendChild(leapLeftButton);\n    if (!this.noTitle) {\n        toolbar.appendChild(makeElement('div', makeElement('h4', title, {}, {margin: '0px'}), {className: 'btn-group title'}));\n    }\n    if (!this.noLocationField)\n        toolbar.appendChild(makeElement('div', [locField, locStatusField], {className: 'btn-group loc-group'}));\n    if (!this.noClearHighlightsButton)\n        toolbar.appendChild(clearHighlightsButton);\n\n    if (!this.noZoomSlider) {\n        toolbar.appendChild(makeElement('div', [zoomInBtn,\n                                                makeElement('span', zoomSlider, {className: 'btn'}),\n                                                zoomOutBtn], {className: 'btn-group'}));\n    }\n    \n    if (this.toolbarBelow) {\n        holder.appendChild(genomePanel);\n        holder.appendChild(toolbar);\n    } else {\n        holder.appendChild(toolbar);\n        holder.appendChild(genomePanel);\n    }\n\n\n    var lt2 = Math.log(2) / Math.log(10);\n    var lt5 = Math.log(5) / Math.log(10);\n    var roundSliderValue = function(x) {\n        var ltx = (x / b.zoomExpt + Math.log(b.zoomBase)) / Math.log(10);\n        \n        var whole = ltx|0\n        var frac = ltx - whole;\n        var rounded\n\n        if (frac < 0.01)\n            rounded = whole;\n        else if (frac <= (lt2 + 0.01))\n            rounded = whole + lt2;\n        else if (frac <= (lt5 + 0.01))\n            rounded = whole + lt5;\n        else {\n            rounded = whole + 1;\n        }\n\n        return (rounded * Math.log(10) -Math.log(b.zoomBase)) * b.zoomExpt;\n    }\n\n    var markSlider = function(x) {\n        zoomSlider.addLabel(x, humanReadableScale(Math.exp(x / b.zoomExpt) * b.zoomBase));\n    }\n\n    this.addViewListener(function(chr, min, max, _oldZoom, zoom) {\n        locField.value = (chr + ':' + formatLongInt(min) + '..' + formatLongInt(max));\n        zoomSlider.min = zoom.min|0;\n        zoomSlider.max = zoom.max|0;\n        if (zoom.isSnapZooming) {\n            zoomSlider.value = zoom.alternate\n            zoomSlider.value2 = zoom.current;\n            zoomSlider.active = 2;\n        } else {\n            zoomSlider.value = zoom.current;\n            zoomSlider.value2 = zoom.alternate;\n            zoomSlider.active = 1;\n        }\n\n        if (zoom.current == zoom.min)\n            zoomInBtn.classList.add('disabled');\n        else\n            zoomInBtn.classList.remove('disabled');\n\n        if (zoom.current == zoom.max)\n            zoomOutBtn.classList.add('disabled');\n        else\n            zoomOutBtn.classList.remove('disabled');\n\n        zoomSlider.removeLabels();\n        var zmin = zoom.min;\n        var zmax = zoom.max;\n        var zrange = zmax - zmin;\n\n        \n        var numSliderTicks = 4;\n        if (b.zoomSliderWidth && b.zoomSliderWidth < 150)\n            numSliderTicks = 3;\n        markSlider(roundSliderValue(zmin));\n        for (var sti = 1; sti < numSliderTicks - 1; ++sti) {\n            markSlider(roundSliderValue(zmin + (1.0 * sti * zrange / (numSliderTicks -1))));\n        }\n        markSlider(roundSliderValue(zmax));\n\n        if (b.storeStatus) {\n            b.storeViewStatus();\n        }\n\n        if (b.highlights.length > 0) {\n            clearHighlightsButton.style.display = 'inline-block';\n        } else {\n            clearHighlightsButton.style.display = 'none';\n        }\n    });\n\n    this.addTierListener(function() {\n        if (b.storeStatus) {\n            b.storeTierStatus();\n        }\n    });\n\n    locField.addEventListener('keydown', function(ev) {\n        if (ev.keyCode == 40) {\n            ev.preventDefault(); ev.stopPropagation();\n            b.setSelectedTier(0);\n        } if (ev.keyCode == 10 || ev.keyCode == 13) {\n            ev.preventDefault();\n\n\n            var g = locField.value;\n            b.search(g, function(err) {\n                if (err) {\n                    locStatusField.textContent = '' + err;\n                } else {\n                    locStatusField.textContent = '';\n                }\n            });\n        }\n    }, false);\n    \n    var trackAddPopup;\n    addTrackBtn.addEventListener('click', function(ev) {\n        if (trackAddPopup && trackAddPopup.displayed) {\n            b.removeAllPopups();\n        } else {\n            trackAddPopup = b.showTrackAdder(ev);\n        }\n    }, false);\n    b.makeTooltip(addTrackBtn, 'Add a new track from the registry or an indexed file. (A)');\n\n    zoomInBtn.addEventListener('click', function(ev) {\n      ev.stopPropagation(); ev.preventDefault();\n\n      b.zoomStep(-10);\n    }, false);\n    b.makeTooltip(zoomInBtn, 'Zoom in (+)');\n\n    zoomOutBtn.addEventListener('click', function(ev) {\n      ev.stopPropagation(); ev.preventDefault();\n\n      b.zoomStep(10);\n    }, false);\n    b.makeTooltip(zoomOutBtn, 'Zoom out (-)');\n\n    zoomSlider.addEventListener('change', function(ev) {\n        var wantSnap = zoomSlider.active == 2;\n        if (wantSnap != b.isSnapZooming) {\n            b.savedZoom = b.zoomSliderValue  - b.zoomMin;\n            b.isSnapZooming = wantSnap;\n        }\n        var activeZSV = zoomSlider.active == 1 ? zoomSlider.value : zoomSlider.value2;\n\n    \tb.zoomSliderValue = (1.0 * activeZSV);\n    \tb.zoom(Math.exp((1.0 * activeZSV) / b.zoomExpt));\n    }, false);\n\n    favBtn.addEventListener('click', function(ev) {\n       ev.stopPropagation(); ev.preventDefault();\n    }, false);\n    b.makeTooltip(favBtn, 'Favourite regions');\n\n    svgBtn.addEventListener('click', function(ev) {\n       ev.stopPropagation(); ev.preventDefault();\n        b.openExportPanel();\n    }, false);\n    b.makeTooltip(svgBtn, 'Export publication-quality SVG. (X)');\n\n    var optsPopup;\n    optsButton.addEventListener('click', function(ev) {\n        ev.stopPropagation(); ev.preventDefault();\n\n        b.toggleOptsPopup(ev);\n    }, false);\n    b.makeTooltip(optsButton, 'Configure options.');\n\n    helpButton.addEventListener('click', function(ev) {\n        ev.stopPropagation(); ev.preventDefault();\n        b.toggleHelpPopup(ev);\n    });\n    b.makeTooltip(helpButton, 'Help; Keyboard shortcuts. (H)');\n\n    tierEditButton.addEventListener('click', function(ev) {\n        ev.stopPropagation(); ev.preventDefault();\n        if (b.selectedTiers.length == 1) {\n            b.openTierPanel(b.tiers[b.selectedTiers[0]]);\n        }\n    }, false);\n\n    leapLeftButton.addEventListener('click', function(ev) {\n        b.leap(b.reverseKeyScrolling ? -1 : 1, false);\n    }, false);\n    b.makeTooltip(leapLeftButton, function(ev) {\n        var st = b.getSelectedTier();\n        var tier;\n        if (st >= 0)\n            tier = b.tiers[st];\n\n        if (tier && tier.featureSource && b.sourceAdapterIsCapable(tier.featureSource, 'quantLeap') && typeof(tier.quantLeapThreshold) == 'number') {\n            return 'Jump to the next region with a score above the threshold in the selected track \"' + (tier.config.name || tier.dasSource.name) + '\"\" (ctrl+LEFT)';\n        } else if (tier && tier.featureSource && b.sourceAdapterIsCapable(tier.featureSource, 'leap')) {\n            return 'Jump to the next feature in the selected track \"' + (tier.config.name || tier.dasSource.name) + '\" (ctrl+LEFT)';\n        } else {\n            return 'Jump left (shift+LEFT)';\n        }\n    });\n\n    leapRightButton.addEventListener('click', function(ev) {\n        b.leap(b.reverseKeyScrolling ? 1 : -1, false);\n    }, false);\n    b.makeTooltip(leapRightButton, function(ev) {\n        var st = b.getSelectedTier();\n        var tier;\n        if (st >= 0)\n            tier = b.tiers[st];\n\n        if (tier && tier.featureSource && b.sourceAdapterIsCapable(tier.featureSource, 'quantLeap') && typeof(tier.quantLeapThreshold) == 'number') {\n            return 'Jump to the next region with a score above the threshold in the selected track \"' + (tier.config.name || tier.dasSource.name) + '\"\" (ctrl+RIGHT)';\n        } else if (tier && tier.featureSource && b.sourceAdapterIsCapable(tier.featureSource, 'leap')) {\n            return 'Jump to the next feature in the selected track \"' + (tier.config.name || tier.dasSource.name) + '\" (ctrl+RIGHT)';\n        } else {\n            return 'Jump right (shift+RIGHT)';\n        }\n    });\n    b.addTierSelectionListener(function() {\n        var st = b.getSelectedTier();\n        var tier;\n        if (st >= 0)\n            tier = b.tiers[st];\n\n        var canLeap = false;\n        if (tier && tier.featureSource) {\n            if (b.sourceAdapterIsCapable(tier.featureSource, 'quantLeap') && typeof(tier.quantLeapThreshold) == 'number')\n                canLeap = true;\n            else if (b.sourceAdapterIsCapable(tier.featureSource, 'leap'))\n                canLeap = true;\n        }\n\n        leapLeftButton.firstChild.className = canLeap ? 'fa fa-angle-double-left' : 'fa fa-angle-left';\n        leapRightButton.firstChild.className = canLeap ? 'fa fa-angle-double-right' : 'fa fa-angle-right';\n    });\n\n    clearHighlightsButton.addEventListener('click', function(ev) {\n        b.clearHighlights();\n    }, false);\n    b.makeTooltip(clearHighlightsButton, 'Clear highlights (C)');\n\n    b.addTierSelectionWrapListener(function(dir) {\n        if (dir < 0) {\n            b.setSelectedTier(null);\n            locField.focus();\n        }\n    });\n\n    b.addTierSelectionListener(function(sel) {\n        if (b.uiMode === 'tier') {\n            if (sel.length == 0) {\n                b.hideToolPanel();\n                b.manipulatingTier = null;\n                b.uiMode = 'none';\n            } else {\n                var ft = b.tiers[sel[0]];\n                if (ft != b.manipulatingTier) {\n                    b.openTierPanel(ft);\n                }\n            }\n        }\n    });\n\n    var uiKeyHandler = function(ev) {\n        // console.log('bukh: ' + ev.keyCode);\n        if (ev.keyCode == 65 || ev.keyCode == 97) {  // a\n            ev.preventDefault(); ev.stopPropagation();\n            b.showTrackAdder();\n        } else if (ev.keyCode == 72 || ev.keyCode == 104) { // h\n            ev.stopPropagation(); ev.preventDefault();\n            b.toggleHelpPopup(ev);\n        } else if (ev.keyCode == 69 || ev.keyCode == 101) { //e\n            ev.stopPropagation(); ev.preventDefault();\n            if (b.selectedTiers.length == 1) {\n                b.openTierPanel(b.tiers[b.selectedTiers[0]]);\n            }\n        } else if (ev.keyCode == 88 || ev.keyCode == 120) { // x\n            ev.stopPropagation(); ev.preventDefault();\n            b.openExportPanel();\n        } else if (ev.keyCode == 67 || ev.keyCode == 99) { // c\n            ev.stopPropagation(); ev.preventDefault();\n            b.clearHighlights();\n        }\n    };\n\n    holder.addEventListener('focus', function(ev) {\n        holder.addEventListener('keydown', uiKeyHandler, false);\n    }, false);\n    holder.addEventListener('blur', function(ev) {\n        holder.removeEventListener('keydown', uiKeyHandler, false);\n    }, false);\n\n    holder.addEventListener('keydown', function(ev) {\n        if (ev.keyCode === 27) {\n            if (b.uiMode !== 'none') {\n                // Only consume event if tool panel is open.\n                ev.preventDefault();\n                ev.stopPropagation();\n                b.setUiMode('none');\n                b.hideToolPanel();\n\n                if (b.selectedTiers && b.selectedTiers.length > 0) {\n                    b.browserHolder.focus();\n                }\n            }\n        }\n    }, false);\n}\n\nBrowser.prototype.showToolPanel = function(panel, nowrap) {\n    var thisB = this;\n\n    if (this.activeToolPanel) {\n        this.activeToolPanel.parentElement.removeChild(this.activeToolPanel);\n    }\n\n    var content;\n    if (nowrap)\n        content = panel;\n    else\n        content = makeElement('div', panel, {}, {overflowY: 'auto', width: '100%'});\n\n\n    var divider = makeElement('div', makeElement('i', null, {className: 'fa fa-caret-right'}), {className: 'tool-divider'});\n    divider.addEventListener('click', function(ev) {\n        thisB.hideToolPanel();\n        thisB.setUiMode('none');\n    }, false);\n    this.makeTooltip(divider, 'Close tool panel (ESC)');\n    this.activeToolPanel = makeElement('div', [divider, content], {className: 'tool-holder'});\n    this.svgHolder.appendChild(this.activeToolPanel);\n    this.resizeViewer();\n\n    var thisB = this;\n}\n\nBrowser.prototype.hideToolPanel = function() {\n    if (this.activeToolPanel) {\n        this.activeToolPanel.parentElement.removeChild(this.activeToolPanel);\n    }\n    this.svgHolder.style.width = '100%';\n    this.activeToolPanel = null;\n    this.resizeViewer();\n}\n\nBrowser.prototype.toggleHelpPopup = function(ev) {\n    if (this.uiMode === 'help') {\n        this.hideToolPanel();\n        this.setUiMode('none');\n    } else {\n        var helpFrame = makeElement('iframe', null, {scrolling: 'yes', seamless: 'seamless', src: this.resolveURL('$$help/index.html'), className: 'help-panel'});\n        this.showToolPanel(helpFrame, false);\n        this.setUiMode('help');\n    }\n}\n\nBrowser.prototype.toggleOptsPopup = function(ev) {\n    var b = this;\n\n    if (this.uiMode === 'opts') {\n        this.hideToolPanel();\n        this.setUiMode('none');\n    } else {\n        var optsForm = makeElement('div', null, {className: 'form-horizontal'}, {boxSizing: 'border-box', MozBoxSizing: 'border-box', display: 'inline-block', verticalAlign: 'top'});\n        var optsTable = makeElement('table');\n        optsTable.cellPadding = 5;\n\n        var scrollModeButton = makeElement('input', '', {type: 'checkbox', checked: b.reverseScrolling});\n        scrollModeButton.addEventListener('change', function(ev) {\n            b.reverseScrolling = scrollModeButton.checked;\n            b.storeStatus();\n        }, false);\n        optsTable.appendChild(makeElement('tr', [makeElement('td', 'Reverse trackpad scrolling', {align: 'right'}), makeElement('td', scrollModeButton)]));\n\n        var scrollKeyButton = makeElement('input', '', {type: 'checkbox', checked: b.reverseKeyScrolling});\n        scrollKeyButton.addEventListener('change', function(ev) {\n            b.reverseKeyScrolling = scrollKeyButton.checked;\n            b.storeStatus();\n        }, false);\n        optsTable.appendChild(makeElement('tr', [makeElement('td', 'Reverse scrolling buttons and keys', {align: 'right'}), makeElement('td', scrollKeyButton)]));\n\n\n        var rulerSelect = makeElement('select');\n        rulerSelect.appendChild(makeElement('option', 'Left', {value: 'left'}));\n        rulerSelect.appendChild(makeElement('option', 'Center', {value: 'center'}));\n        rulerSelect.appendChild(makeElement('option', 'Right', {value: 'right'}));\n        rulerSelect.appendChild(makeElement('option', 'None', {value: 'none'}));\n        rulerSelect.value = b.rulerLocation;\n        rulerSelect.addEventListener('change', function(ev) {\n            b.rulerLocation = rulerSelect.value;\n            b.positionRuler();\n            for (var ti = 0; ti < b.tiers.length; ++ti) {\n                b.tiers[ti].paintQuant();\n            }\n            b.storeStatus();\n        }, false);\n        optsTable.appendChild(makeElement('tr', [makeElement('td', 'Vertical guideline', {align: 'right'}), makeElement('td', rulerSelect)]));\n        \n        var singleBaseHighlightButton = makeElement('input', '', {type: 'checkbox', checked: b.singleBaseHighlight}); \n        singleBaseHighlightButton.addEventListener('change', function(ev) {\n            b.singleBaseHighlight = singleBaseHighlightButton.checked;\n            b.positionRuler();\n            b.storeStatus();\n        }, false);\n        singleBaseHighlightButton.setAttribute('id','singleBaseHightlightButton'); // making this because access is required when the key 'u' is pressed and the options are visible\n        optsTable.appendChild(makeElement('tr', [makeElement('td', 'Display and highlight current genome location', {align: 'right'}), makeElement('td', singleBaseHighlightButton)]));\n        \n        optsForm.appendChild(optsTable);\n\n        var resetButton = makeElement('button', 'Reset browser', {className: 'btn'}, {marginLeft: 'auto', marginRight: 'auto', display: 'block'});\n        resetButton.addEventListener('click', function(ev) {\n            b.reset();\n        }, false);\n        optsForm.appendChild(resetButton);\n\n        this.showToolPanel(optsForm);\n        this.setUiMode('opts');\n    }\n}\n\nfunction humanReadableScale(x) {\n    var suffix = 'bp';\n    if (x > 1000000000) {\n        x /= 1000000000;\n        suffix = 'Gb';\n    } else if (x > 1000000) {\n        x /= 1000000\n        suffix = 'Mb';\n    } else if (x > 1000) {\n        x /= 1000;\n        suffix = 'kb';\n    }\n    return '' + Math.round(x) + suffix;\n}\n","/* -*- mode: javascript; c-basic-offset: 4; indent-tabs-mode: nil -*- */\n\n//\n// Dalliance Genome Explorer\n// (c) Thomas Down 2006-2011\n//\n// cbrowser.js: canvas browser container\n//\n\n\"use strict\";\n\nif (typeof(require) !== 'undefined') {\n    var utils = require('./utils');\n    var Observed = utils.Observed;\n    var Awaited = utils.Awaited;\n    var makeElement = utils.makeElement;\n    var removeChildren = utils.removeChildren;\n    var miniJSONify = utils.miniJSONify;\n    var shallowCopy = utils.shallowCopy;\n    var textXHR = utils.textXHR;\n\n    var tier = require('./tier');\n    var DasTier = tier.DasTier;\n\n    var sha1 = require('./sha1');\n    var hex_sha1 = sha1.hex_sha1;\n\n    var thub = require('./thub');\n    var connectTrackHub = thub.connectTrackHub;\n\n    var VERSION = require('./version');\n\n    var nf = require('./numformats');\n    var formatQuantLabel = nf.formatQuantLabel;\n    var formatLongInt = nf.formatLongInt;\n\n    var Chainset = require('./chainset').Chainset;\n\n    var Promise = require('es6-promise').Promise;\n\n    var sourcecompare = require('./sourcecompare');\n    var sourcesAreEqual = sourcecompare.sourcesAreEqual;\n    var sourcesAreEqualModuloStyle = sourcecompare.sourcesAreEqualModuloStyle;\n    var sourceDataURI = sourcecompare.sourceDataURI;\n    var sourceStyleURI = sourcecompare.sourceStyleURI;\n\n    var DefaultRenderer = require('./default-renderer');\n\n    var MultiRenderer = require('./multi-renderer');\n    var SubRenderer = require('./sub-renderer');\n\n    var DummyRenderer = require('./dummy-renderer');\n}\n\nfunction Region(chr, min, max) {\n    this.min = min;\n    this.max = max;\n    this.chr = chr;\n}\n\nfunction Browser(opts) {\n    if (!opts) {\n        opts = {};\n    }\n\n    this.renderers =\n        { 'default': DefaultRenderer,\n          'dummy': DummyRenderer,\n          'multi': MultiRenderer,\n          'sub': SubRenderer\n        };\n\n    this.defaultRenderer = opts.renderer || DefaultRenderer;\n\n    this.prefix = '//www.biodalliance.org/release-0.14/';\n\n    this.sources = [];\n    this.tiers = [];\n    this.tierGroups = {};\n\n    this.searchOnlySources = [];\n    this.searchOnlySourceHolders = [];\n\n    this.featureListeners = [];\n    this.featureHoverListeners = [];\n    this.viewListeners = [];\n    this.regionSelectListeners = [];\n    this.tierListeners = [];\n    this.tierSelectionListeners = [];\n    this.tierSelectionWrapListeners = [];\n\n    this.cookieKey = 'browser';\n\n    this.chains = {};\n\n    this.pageName = 'svgHolder'\n    this.zoomFactor = 1.0;\n    this.maxPixelsPerBase = 10;\n    this.origin = 0;\n    this.targetQuantRes = 1.0;\n    this.featurePanelWidth = 750;\n    this.zoomBase = 100;\n    this.zoomExpt = 30.0; // Back to being fixed....\n    this.zoomSliderValue = 100;\n    this.entryPoints = null;\n    this.currentSeqMax = -1; // init once EPs are fetched.\n\n    this.highlights = [];\n    this.selectedTiers = [1];\n\n    this.maxViewWidth = 500000;\n    this.defaultSubtierMax = 100;\n\n    this.highZoomThreshold = 0.2;\n    this.mediumZoomThreshold = 0.01\n\n    this.minExtraWidth = 100.0;\n    this.maxExtraWidth = 1000.0;\n    \n    // Options.\n\n    this.reverseScrolling = false;\n    this.rulerLocation = 'center';\n    this.defaultHighlightFill = 'red';\n    this.defaultHighlightAlpha = 0.3;\n    this.exportHighlights = true;\n    this.exportRuler = true;\n    this.exportBanner = true;\n    this.exportRegion = true;\n    this.singleBaseHighlight = true;\n\n    // Visual config.\n\n    // this.tierBackgroundColors = [\"rgb(245,245,245)\", \"rgb(230,230,250)\" /* 'white' */];\n    this.tierBackgroundColors = [\"rgb(245,245,245)\", 'white'];\n    this.minTierHeight = 20;\n    this.noDefaultLabels = false;\n\n    // Registry\n\n    this.availableSources = new Observed();\n    this.defaultSources = [];\n    this.mappableSources = {};\n\n    // Central DAS Registry no longer available 2015-05\n\n    this.registry = null; // '//www.dasregistry.org/das/sources';\n    this.noRegistryTabs = true;\n\n    this.defaultTrackAdderTab = null;\n\n    this.hubs = [];\n    this.hubObjects = [];\n\n    this.sourceCache = new SourceCache();\n\n    this.retina = true;\n\n    this.useFetchWorkers = true;\n    this.maxWorkers = 2;\n    this.workerPath = '$$worker-all.js';\n    this.resolvers = {};\n    this.resolverSeed = 1;\n\n    this.assemblyNamePrimary = true;\n    this.assemblyNameUcsc = true;\n\n    this.defaultSearchRegionPadding = 10000;\n\n    // HTTP warning support\n\n    this.httpCanaryURL = 'http://www.biodalliance.org/http-canary.txt';\n    this.httpWarningURL = '//www.biodalliance.org/https.html';\n\n    this.initListeners = [];\n\n    if (opts.baseColors) {\n        this.baseColors = opts.baseColors\n    } else {\n        if (opts.aminoAcids) {\n            this.baseColors = {\n                F: 'rgb(182, 201, 237)',\n                L: 'rgb(213, 236, 213)',\n                I: 'rgb(239, 213, 211)',\n                M: 'rgb(255, 23, 0)',\n                V: 'rgb(255, 172, 0)',\n                S: 'rgb(255, 244, 19)',\n                P: 'rgb(138, 189, 67)',\n                T: 'rgb(36, 153, 57)',\n                A: 'rgb(0, 166, 236)',\n                Y: 'rgb(0, 101, 178)',\n                H: 'rgb(215, 206, 182)',\n                Q: 'rgb(252, 176, 124)',\n                N: 'rgb(159, 148, 186)',\n                K: 'rgb(133, 117, 67)',\n                D: 'rgb(108, 242, 51)',\n                E: 'rgb(0, 253, 255)',\n                C: 'rgb(248, 129, 51)',\n                W: 'rgb(243, 68, 252)',\n                R: 'rgb(207, 207, 207)',\n                G: 'rgb(166, 213, 227)'\n            };\n        } else {\n            this.baseColors = {\n                A: 'green',\n                C: 'blue',\n                G: 'orange',\n                T: 'red',\n                '-' : 'hotpink', // deletion\n                'I' : 'red' // insertion\n            };\n        }\n    }\n\n    if (opts.viewStart !== undefined && typeof(opts.viewStart) !== 'number') {\n        throw Error('viewStart must be an integer');\n    }\n    if (opts.viewEnd !== undefined && typeof(opts.viewEnd) !== 'number') {\n        throw Error('viewEnd must be an integer');\n    }\n    if (opts.offscreenInitWidth !== undefined && typeof(opts.offscreenInitWidth) !== 'number') {\n        throw Error('offscreenInitWidth must be an integer');\n    }\n\n    for (var k in opts) {\n        this[k] = opts[k];\n    }\n    \n    if (typeof(opts.uiPrefix) === 'string' && typeof(opts.prefix) !== 'string') {\n        this.prefix = opts.uiPrefix;\n    }\n    // If the prefix only starts with a single '/' this is relative to the current\n    // site, so we need to prefix the prefix with //{hostname}\n    if (this.prefix.indexOf('//') < 0 && this.prefix.indexOf('/') === 0) {\n        var location = window.location.hostname;\n        if (window.location.port) {\n            location += ':' + window.location.port\n        };\n        this.prefix = '//' + location + this.prefix;\n    }\n    if (this.prefix.indexOf('//') === 0) {\n        var proto = window.location.protocol;\n        if (proto == 'http:' || proto == 'https:') {\n            // Protocol-relative URLs okay.\n        } else {\n            console.log(window.location.protocol);\n            console.log('WARNING: prefix is set to a protocol-relative URL (' + this.prefix + ' when loading from a non-HTTP source');\n            this.prefix = 'http:' + this.prefix;\n        }\n    }\n\n    if (!this.coordSystem) {\n        throw Error('Coordinate system must be configured');\n    }\n\n    if (this.chr === undefined || this.viewStart === undefined || this.viewEnd === undefined) {\n        throw Error('Viewed region (chr:start..end) must be defined');\n    }\n\n    var thisB = this;\n\n    if (document.readyState === 'complete') {\n        thisB.realInit();\n    } else {\n        var loadListener = function(ev) {\n            window.removeEventListener('load', loadListener, false);\n            thisB.realInit();\n        }\n        window.addEventListener('load', loadListener, false);\n    }\n}\n\nBrowser.prototype.resolveURL = function(url) {\n    return url.replace('$$', this.prefix);\n}\n\nBrowser.prototype.destroy = function() {\n    window.removeEventListener('resize', this.resizeListener, false);\n    if (this.fetchWorkers) {\n        for (const worker of this.fetchWorkers) {\n            worker.terminate();\n        }\n    }\n}\n\nBrowser.prototype.realInit = function() {\n    var self = this;\n    var thisB = this;\n\n    if (this.wasInitialized) {\n        console.log('Attemping to call realInit on an already-initialized Dalliance instance');\n        return;\n    }\n\n    this.wasInitialized = true;\n\n    if (typeof(navigator) !== 'undefined') {\n        var ua = navigator.userAgent || 'dummy';\n        if (ua.indexOf('Trident') >= 0 && ua.indexOf('rv:11') >= 0) {\n            // console.log('Detected IE11, disabling tier pinning.');\n            this.disablePinning = true;\n        }\n    }\n\n    this.defaultChr = this.chr;\n    this.defaultStart = this.viewStart;\n    this.defaultEnd = this.viewEnd;\n    this.defaultSources = [];\n    for (var i = 0; i < this.sources.length; ++i) {\n        var s = this.sources[i];\n        if (s)\n            this.defaultSources.push(s);\n    }\n\n    if (this.restoreStatus) {\n        this.statusRestored = this.restoreStatus();\n    }\n\n    if (this.injectionPoint && this.injectionPoint instanceof Element) {\n        this.browserHolderHolder = this.injectionPoint;\n    } else if (this.injectionPoint) {\n        this.browserHolderHolder = document.getElementById(this.injectionPoint);\n        if (!this.browserHolderHolder) {\n            throw Error('injectionPoint must point to a valid DOM element of element ID');\n        }\n    } else {\n        this.browserHolderHolder = document.getElementById(this.pageName);\n        if (!this.browserHolderHolder) {\n            throw Error('pageName must be a valid element ID (or use the injectionPoint option instead)');\n        }\n    }\n    \n    this.browserHolderHolder.classList.add('dalliance-injection-point');\n    this.browserHolder = makeElement('div', null, {className: 'dalliance dalliance-root', tabIndex: -1});\n    if (this.maxHeight) {\n        this.browserHolder.style.maxHeight = this.maxHeight + 'px';\n    } else if (this.maxHeight != undefined) {\n        this.browserHolder.style.maxHeight = null;\n    }\n    removeChildren(this.browserHolderHolder);\n    this.browserHolderHolder.appendChild(this.browserHolder);\n    this.svgHolder = makeElement('div', null, {className: 'main-holder'});\n\n    this.initUI(this.browserHolder, this.svgHolder);\n\n    this.pinnedTierHolder = makeElement('div', null, {className: 'tier-holder tier-holder-pinned'});\n    this.tierHolder = makeElement('div', this.makeLoader(24), {className: 'tier-holder tier-holder-rest'});\n\n    this.locSingleBase = makeElement('span', '', {className: 'loc-single-base'});\n    var locSingleBaseHolder = makeElement('div', this.locSingleBase,{className: 'loc-single-base-holder'});\n    // Add listener to update single base location\n    this.addViewListener(function(chr, minFloor, maxFloor, zoomSliderValue, zoomSliderDict, min, max) {\n        // Just setting textContent causes layout flickering in Blink.\n        // This approach means that the element is never empty.\n        var loc = Math.round((max + min) / 2);\n        self.locSingleBase.appendChild(document.createTextNode(chr + ':' + formatLongInt(loc)));\n        self.locSingleBase.removeChild(self.locSingleBase.firstChild);\n    });\n\n    if (this.disablePinning) {\n        this.tierHolderHolder = this.tierHolder;\n    } else {\n        this.tierHolderHolder = makeElement('div', [locSingleBaseHolder, this.pinnedTierHolder, this.tierHolder], {className: 'tier-holder-holder'});\n        this.svgHolder.appendChild(this.tierHolderHolder);\n    }\n    this.svgHolder.appendChild(this.tierHolderHolder);\n\n    this.bhtmlRoot = makeElement('div');\n    if (!this.disablePoweredBy) {\n        this.bhtmlRoot.appendChild(makeElement('span', ['Powered by ', makeElement('a', 'Biodalliance', {href: 'http://www.biodalliance.org/'}), ' ' + VERSION], {className: 'powered-by'}));\n    }\n    this.browserHolder.appendChild(this.bhtmlRoot);\n\n    this.resizeListener = function(ev) {\n        thisB.resizeViewer();\n    };\n\n    this.ruler = makeElement('div', null, {className: 'guideline'})\n    this.ruler2 = makeElement('div', null, {className: 'single-base-guideline'});\n    this.tierHolderHolder.appendChild(this.ruler);\n    this.tierHolderHolder.appendChild(this.ruler2);\n    this.chainConfigs = this.chains || {};\n    this.chains = {};\n    for (var k in this.chainConfigs) {\n        var cc = this.chainConfigs[k];\n        if (cc instanceof Chainset) {\n            console.log('WARNING: Should no longer use \"new Chainset\" in Biodalliance configurations.');\n        }\n        this.chains[k] = new Chainset(cc);\n    }\n\n    var promisedWorkers;\n    if (this.maxWorkers > 0) {\n        var pw = [];\n        for (var fi = 0; fi < this.maxWorkers; ++fi)\n            pw.push(makeFetchWorker(this));\n        promisedWorkers = Promise.all(pw);\n    } else {\n        promisedWorkers = Promise.resolve([]);\n    }\n\n    this.fetchWorkers = null;\n    this.nextWorker = 0;\n    promisedWorkers.then(function(v) {\n        console.log('Booted ' + v.length + ' workers');\n        thisB.fetchWorkers = v;\n    }, function(v) {\n        console.log('Failed to boot workers', v);\n    }).then(function() {\n        if (self.offscreenInitWidth || (window.getComputedStyle(thisB.browserHolderHolder).display != 'none' &&\n            thisB.tierHolder.getBoundingClientRect().width > 0))\n        {\n            setTimeout(function() {thisB.realInit2()}, 1);\n        } else {\n            var pollInterval = setInterval(function() {\n                if (window.getComputedStyle(thisB.browserHolderHolder).display != 'none' &&\n                    thisB.tierHolder.getBoundingClientRect().width > 0)\n                {\n                    clearInterval(pollInterval);\n                    thisB.realInit2();\n                }\n            }, 300);\n        }\n    });\n}\n\nBrowser.prototype.realInit2 = function() {\n    var thisB = this;\n\n    // Remove the loader icon, if needed\n    removeChildren(this.tierHolder);\n    removeChildren(this.pinnedTierHolder);\n\n    this.featurePanelWidth = this.tierHolder.getBoundingClientRect().width | thisB.offscreenInitWidth | 0;\n    window.addEventListener('resize', this.resizeListener, false);\n\n    this.scale = this.featurePanelWidth / (this.viewEnd - this.viewStart);\n    if (!this.zoomMax) {\n        this.zoomMax = this.zoomExpt * Math.log(this.maxViewWidth / this.zoomBase);\n        this.zoomMin = this.zoomExpt * Math.log(this.featurePanelWidth / this.maxPixelsPerBase / this.zoomBase);\n    }\n    this.zoomSliderValue = this.zoomExpt * Math.log((this.viewEnd - this.viewStart + 1) / this.zoomBase);\n\n    // Event handlers\n\n    this.tierHolderHolder.addEventListener('mousewheel', function(ev) {\n        ev.stopPropagation(); ev.preventDefault();\n\n        if (ev.wheelDeltaX) {\n            var delta = ev.wheelDeltaX/5;\n            if (!thisB.reverseScrolling) {\n                delta = -delta;\n            }\n            thisB.move(delta);\n        }\n\n        if (ev.wheelDeltaY) {\n            var delta = ev.wheelDeltaY;\n            if (thisB.reverseScrolling) {\n                delta = -delta;\n            }\n            thisB.tierHolder.scrollTop += delta;\n        }\n    }, false);\n\n    this.tierHolderHolder.addEventListener('MozMousePixelScroll', function(ev) {\n        ev.stopPropagation(); ev.preventDefault();\n        if (ev.axis == 1) {\n            if (ev.detail != 0) {\n                var delta = ev.detail/4;\n                if (thisB.reverseScrolling) {\n                    delta = -delta;\n                }\n                thisB.move(delta);\n            }\n        } else {\n            var delta = ev.detail;\n            if (!thisB.reverseScrolling) {\n              delta = -delta;\n            }\n\n            thisB.tierHolder.scrollTop += delta;\n        }\n    }, false);\n\n    this.tierHolderHolder.addEventListener('touchstart', function(ev) {return thisB.touchStartHandler(ev)}, false);\n    this.tierHolderHolder.addEventListener('touchmove', function(ev) {return thisB.touchMoveHandler(ev)}, false);\n    this.tierHolderHolder.addEventListener('touchend', function(ev) {return thisB.touchEndHandler(ev)}, false);\n    this.tierHolderHolder.addEventListener('touchcancel', function(ev) {return thisB.touchCancelHandler(ev)}, false);\n\n    var keyHandler = function(ev) {\n        // console.log('cbkh: ' + ev.keyCode);\n        if (ev.keyCode == 13) { // enter\n            var layoutsChanged = false;\n            for (var ti = 0; ti < thisB.tiers.length; ++ti) {\n                var t = thisB.tiers[ti];\n                if (t.wantedLayoutHeight && t.wantedLayoutHeight != t.layoutHeight) {\n                    t.layoutHeight = t.wantedLayoutHeight;\n                    t.clipTier();\n                    layoutsChanged = true;\n                }\n            }\n            if (layoutsChanged) {\n                thisB.arrangeTiers();\n            }\n        } else if (ev.keyCode == 32 || ev.charCode == 32) { // space\n            if (!thisB.isSnapZooming) {\n                thisB.isSnapZooming = true;\n                var newZoom = (thisB.savedZoom || 0.0) + thisB.zoomMin;\n                thisB.savedZoom = thisB.zoomSliderValue - thisB.zoomMin;\n                thisB.zoomSliderValue = newZoom;\n                thisB.zoom(Math.exp((1.0 * newZoom) / thisB.zoomExpt));\n            } else {\n                thisB.isSnapZooming = false;\n                var newZoom = (thisB.savedZoom || 20.0) + thisB.zoomMin;\n                thisB.savedZoom = thisB.zoomSliderValue - thisB.zoomMin;\n                thisB.zoomSliderValue = newZoom;\n                thisB.zoom(Math.exp((1.0 * newZoom) / thisB.zoomExpt));\n            }\n            ev.stopPropagation(); ev.preventDefault();\n        } else if (ev.keyCode == 85) { // u\n            if (thisB.uiMode === 'opts') { // if the options are visible, toggle the checkbox too\n                var check = document.getElementById(\"singleBaseHightlightButton\").checked;\n                document.getElementById(\"singleBaseHightlightButton\").checked = !check;\n            }\n            thisB.singleBaseHighlight = !thisB.singleBaseHighlight;\n            thisB.positionRuler();\n            ev.stopPropagation(); ev.preventDefault();\n        } else if (ev.keyCode == 39) { // right arrow\n            ev.stopPropagation(); ev.preventDefault();\n            thisB.scrollArrowKey(ev, -1);\n        } else if (ev.keyCode == 37) { // left arrow\n            ev.stopPropagation(); ev.preventDefault();\n            thisB.scrollArrowKey(ev, 1);\n        } else if (ev.keyCode == 38 || ev.keyCode == 87) { // up arrow | w\n            ev.stopPropagation(); ev.preventDefault();\n\n            if (ev.shiftKey) {\n                var st = thisB.getSelectedTier();\n                if (st < 0) return;\n                var tt = thisB.tiers[st];\n                var ch = tt.forceHeight || tt.subtiers[0].height;\n                if (ch >= 40) {\n                    tt.mergeConfig({height: ch-10});\n                }\n            } else if (ev.ctrlKey || ev.metaKey) {\n                var st = thisB.getSelectedTier();\n                if (st < 0) return;\n                var tt = thisB.tiers[st];\n\n                if (tt.quantLeapThreshold) {\n                    var th = tt.subtiers[0].height;\n                    var tq = tt.subtiers[0].quant;\n                    if (!tq)\n                        return;\n\n                    var qmin = 1.0 * tq.min;\n                    var qmax = 1.0 * tq.max;\n\n                    var qscale = (qmax - qmin) / th;\n                    tt.mergeConfig({quantLeapThreshold: qmin + ((Math.round((tt.quantLeapThreshold - qmin)/qscale)|0)+1)*qscale});\n\n                    tt.notify('Threshold: ' + formatQuantLabel(tt.quantLeapThreshold));\n                }\n            } else if (ev.altKey) {\n                var cnt = thisB.selectedTiers.length;\n                if (cnt == 0)\n                    return;\n\n                var st = thisB.selectedTiers[0];\n                var contiguous = true;\n                var mt = [];\n                for (var si = 0; si < thisB.selectedTiers.length; ++si) {\n                    mt.push(thisB.tiers[thisB.selectedTiers[si]]);\n                    if (si > 0 && thisB.selectedTiers[si] - thisB.selectedTiers[si - 1] != 1)\n                        contiguous = false;\n                }\n\n                if (contiguous && st <= 0)\n                    return;\n\n                for (var si = thisB.selectedTiers.length - 1; si >= 0; --si)\n                    thisB.tiers.splice(thisB.selectedTiers[si], 1);\n\n                thisB.selectedTiers.splice(0, cnt);\n\n                var ip = contiguous ? st - 1 : st;\n                for (var si = 0; si < mt.length; ++si) {\n                    thisB.tiers.splice(ip+si, 0, mt[si]);\n                    thisB.selectedTiers.push(ip + si);\n                }\n\n                thisB.withPreservedSelection(thisB._ensureTiersGrouped);\n                thisB.markSelectedTiers();\n                thisB.notifyTierSelection();\n                thisB.reorderTiers();\n                thisB.notifyTier(\"selected\", st);\n            } else {\n                var st = thisB.getSelectedTier();\n                if (st > 0) {\n                    thisB.setSelectedTier(st - 1);\n                    var nst = thisB.tiers[thisB.getSelectedTier()];\n                    var top = nst.row.offsetTop, bottom = top + nst.row.offsetHeight;\n                    if (top < thisB.tierHolder.scrollTop || bottom > thisB.tierHolder.scrollTop + thisB.tierHolder.offsetHeight) {\n                        thisB.tierHolder.scrollTop = top;\n                    }\n                } else {\n                    thisB.notifyTierSelectionWrap(-1);\n                }\n            }\n        } else if (ev.keyCode == 40 || ev.keyCode == 83) { // down arrow | s\n            ev.stopPropagation(); ev.preventDefault();\n\n            if (ev.shiftKey) {\n                var st = thisB.getSelectedTier();\n                if (st < 0) return;\n                var tt = thisB.tiers[st];\n                var ch = tt.forceHeight || tt.subtiers[0].height;\n                tt.mergeConfig({height: ch+10});\n            } else if (ev.ctrlKey || ev.metaKey) {\n                var st = thisB.getSelectedTier();\n                if (st < 0) return;\n                var tt = thisB.tiers[st];\n\n                if (tt.quantLeapThreshold) {\n                    var th = tt.subtiers[0].height;\n                    var tq = tt.subtiers[0].quant;\n                    if (!tq)\n                        return;\n\n                    var qmin = 1.0 * tq.min;\n                    var qmax = 1.0 * tq.max;\n                    var qscale = (qmax - qmin) / th;\n\n                    var it = Math.round((tt.quantLeapThreshold - qmin)/qscale)|0;\n                    if (it > 1) {\n                        tt.mergeConfig({quantLeapThreshold: qmin + (it-1)*qscale});\n                        tt.notify('Threshold: ' + formatQuantLabel(tt.quantLeapThreshold));\n                    }\n                }\n            } else if (ev.altKey) {\n                var cnt = thisB.selectedTiers.length;\n                if (cnt == 0)\n                    return;\n\n                var st = thisB.selectedTiers[0];\n                var discontig = 0;\n                var mt = [];\n                for (var si = 0; si < thisB.selectedTiers.length; ++si) {\n                    mt.push(thisB.tiers[thisB.selectedTiers[si]]);\n                    if (si > 0)\n                        discontig += (thisB.selectedTiers[si] - thisB.selectedTiers[si - 1] - 1);\n                }\n                var contiguous = discontig == 0;\n\n                if (contiguous && st + cnt >= thisB.tiers.length)\n                    return;\n\n                for (var si = thisB.selectedTiers.length - 1; si >= 0; --si)\n                    thisB.tiers.splice(thisB.selectedTiers[si], 1);\n\n                thisB.selectedTiers.splice(0, cnt);\n\n                var ip = contiguous ? st + 1 : st + discontig;\n                for (var si = 0; si < mt.length; ++si) {\n                    thisB.tiers.splice(ip+si, 0, mt[si]);\n                    thisB.selectedTiers.push(ip + si);\n                }\n\n                thisB.withPreservedSelection(function() {\n                    thisB._ensureTiersGrouped(true);\n                });\n                thisB.markSelectedTiers();\n                thisB.notifyTierSelection();\n                thisB.reorderTiers();\n                thisB.notifyTier(\"selected\", st);\n            } else {\n                var st = thisB.getSelectedTier();\n                if (st < thisB.tiers.length -1) {\n                    thisB.setSelectedTier(st + 1);\n                    var nst = thisB.tiers[thisB.getSelectedTier()];\n                    var top = nst.row.offsetTop, bottom = top + nst.row.offsetHeight;\n                    if (top < thisB.tierHolder.scrollTop || bottom > thisB.tierHolder.scrollTop + thisB.tierHolder.offsetHeight) {\n                        thisB.tierHolder.scrollTop = Math.min(top, bottom - thisB.tierHolder.offsetHeight);\n                    }\n                }\n            }\n        } else if (ev.keyCode == 187 || ev.keyCode == 61) { // +\n            ev.stopPropagation(); ev.preventDefault();\n            thisB.zoomStep(-10);\n        } else if (ev.keyCode == 189 || ev.keyCode == 173) { // -\n            ev.stopPropagation(); ev.preventDefault();\n            thisB.zoomStep(10);\n        } else if (ev.keyCode == 73 || ev.keyCode == 105) { // i\n            ev.stopPropagation(); ev.preventDefault();\n            var st = thisB.getSelectedTier();\n            if (st < 0) return;\n            var t = thisB.tiers[st];\n            if (!t.infoVisible) {\n                t.infoElement.style.display = 'block';\n                t.updateHeight();\n                t.infoVisible = true;\n            } else {\n                t.infoElement.style.display = 'none';\n                t.updateHeight();\n                t.infoVisible = false;\n            }\n        } else if (ev.keyCode == 84 || ev.keyCode == 116) { // t\n            var bumpStatus;\n            if( ev.shiftKey ){\n                ev.stopPropagation(); ev.preventDefault();\n                for (var ti = 0; ti < thisB.tiers.length; ++ti) {\n                    var t = thisB.tiers[ti];\n                    if (t.dasSource.collapseSuperGroups) {\n                        if (bumpStatus === undefined) {\n                            bumpStatus = !t.bumped;\n                        }\n                        t.mergeConfig({bumped: bumpStatus});\n                    }\n                }\n            } else if (!ev.ctrlKey && !ev.metaKey) {\n                ev.stopPropagation(); ev.preventDefault();\n                var st = thisB.getSelectedTier();\n                if (st < 0) return;\n                var t = thisB.tiers[st];\n\n                if (t.dasSource.collapseSuperGroups) {\n                    if (bumpStatus === undefined) {\n                        bumpStatus = !t.bumped;\n                    }\n                    t.mergeConfig({bumped: bumpStatus});\n                }\n            }\n        } else if (ev.keyCode == 77 || ev.keyCode == 109) { // m\n            ev.stopPropagation(); ev.preventDefault();\n            if ((ev.ctrlKey || ev.metaKey) && thisB.selectedTiers.length > 1) {\n                thisB.mergeSelectedTiers();\n            }\n        } else if (ev.keyCode == 68 || ev.keyCode == 100) { // d\n            ev.stopPropagation(); ev.preventDefault();\n            if (ev.ctrlKey || ev.metaKey) {\n                var st = thisB.getSelectedTier();\n                if (st < 0) return;\n                thisB.addTier(thisB.tiers[st].dasSource);\n            }\n        } else if (ev.keyCode == 80 || ev.keyCode == 112) { // p\n            if (ev.ctrlKey || ev.metaKey) {\n                // Need to be careful because order of tiers could change\n                // once we start updating pinning.\n                var tt = [];\n                for (var st = 0; st < thisB.selectedTiers.length; ++st) {\n                    tt.push(thisB.tiers[thisB.selectedTiers[st]]);\n                }\n                for (var ti = 0; ti < tt.length; ++ti) {\n                    tt[ti].mergeConfig({pinned: !tt[ti].pinned});\n                }\n            }\n        } else {\n            // console.log('key: ' + ev.keyCode + '; char: ' + ev.charCode);\n        }\n    };\n\n    this.browserHolder.addEventListener('focus', function(ev) {\n        thisB.browserHolder.addEventListener('keydown', keyHandler, false);\n    }, false);\n    this.browserHolder.addEventListener('blur', function(ev) {\n        thisB.browserHolder.removeEventListener('keydown', keyHandler, false);\n    }, false);\n\n    // Popup support (does this really belong here? FIXME)\n    this.hPopupHolder = makeElement('div');\n    this.hPopupHolder.style['font-family'] = 'helvetica';\n    this.hPopupHolder.style['font-size'] = '12pt';\n    this.hPopupHolder.classList.add('dalliance');\n    document.body.appendChild(this.hPopupHolder);\n\n    for (var t = 0; t < this.sources.length; ++t) {\n        var source = this.sources[t];\n        if (!source)\n            continue;\n\n        var config = {};\n        if (this.restoredConfigs) {\n            config = this.restoredConfigs[t];\n        }\n\n        if (!source.disabled) {\n            this.makeTier(source, config).then(function(tier) {\n                thisB.refreshTier(tier);\n            });\n        }\n    }\n\n    for (const source of this.searchOnlySources) {\n        if (!source.disabled) {\n            const {features} = this.createSources(source);\n\n            if (features) {\n                this.searchOnlySourceHolders.push({\n                    dasSource: source,\n                    featureSource: features\n                });\n            }\n        }\n    }\n\n    if (this.onFirstRender) {\n        Promise.all(this.tiers.map(t => t.firstRenderPromise))\n            .then(() => this.onFirstRender())\n            .catch((err) => console.log(err));\n    }\n\n    thisB._ensureTiersGrouped();\n    thisB.arrangeTiers();\n    thisB.reorderTiers();\n\n\n    var ss = this.getSequenceSource();\n    if (ss) {\n        ss.getSeqInfo(this.chr, function(si) {\n            if (si)\n                thisB.currentSeqMax = si.length;\n            else\n                thisB.currentSeqMax = -1;\n        });\n    }\n\n    this.queryRegistry();\n    for (var m in this.chains) {\n        this.queryRegistry(m, true);\n    }\n\n    if (this.hubs) {\n        for (var hi = 0; hi < this.hubs.length; ++hi) {\n            var hc = this.hubs[hi];\n            if (typeof hc == 'string') {\n                hc = {url: hc};\n            };\n\n            (function(hc) {\n                connectTrackHub(hc.url, function(hub, err) {\n                    if (err) {\n                        console.log(err);\n                    } else {\n                        var tdb;\n                        if (hc.genome)\n                            tdb = hub.genomes[hc.genome];\n                        else\n                            tdb = hub.genomes[thisB.coordSystem.ucscName];\n\n                        if (tdb) {\n                            if (hc.mapping)\n                                tdb.mapping = hc.mapping;\n                            if (hc.label)\n                                tdb.hub.altLabel = hc.label\n                            thisB.hubObjects.push(tdb);\n                        }\n                    }\n                }, hc);\n            })(hc);\n        }\n    }\n\n    if (this.fullScreen) {\n        this.setFullScreenHeight();\n    }\n\n    if (!this.statusRestored && this.storeStatus) {\n        this.storeStatus();\n    }\n\n    thisB.setLocation(this.chr, this.viewStart, this.viewEnd, function () {\n        thisB.setSelectedTier(1);\n        // Ping any init listeners.\n        for (var ii = 0; ii < thisB.initListeners.length; ++ii) {\n            try {\n                thisB.initListeners[ii].call(thisB);\n            } catch (e) {\n                console.log(e);\n            }\n        }\n    });\n}\n\n//\n// Touch event support\n//\n\nBrowser.prototype.touchStartHandler = function(ev) {\n    // Events not consumed so they can be interpretted as clicks as well.\n\n    this.touchOriginX = ev.touches[0].pageX;\n    this.touchOriginY = ev.touches[0].pageY;\n    if (ev.touches.length == 2) {\n        var sep = Math.abs(ev.touches[0].pageX - ev.touches[1].pageX);\n        this.zooming = true;\n        this.zoomLastSep = this.zoomInitialSep = sep;\n        this.zoomInitialScale = this.scale;\n    }\n}\n\nBrowser.prototype.touchMoveHandler = function(ev) {\n    // These events *are* consumed to ensure we never get any dragging that\n    // we don't manage ourselves.\n\n    ev.stopPropagation(); ev.preventDefault();\n\n    if (ev.touches.length == 1) {\n        var touchX = ev.touches[0].pageX;\n        var touchY = ev.touches[0].pageY;\n        if (this.touchOriginX && touchX != this.touchOriginX) {\n            this.move(touchX - this.touchOriginX);\n        }\n        if (this.touchOriginY && touchY != this.touchOriginY) {\n            this.tierHolder.scrollTop -= (touchY - this.touchOriginY);\n        }\n        this.touchOriginX = touchX;\n        this.touchOriginY = touchY;\n    } else if (this.zooming && ev.touches.length == 2) {\n        var sep = Math.abs(ev.touches[0].pageX - ev.touches[1].pageX);\n        if (sep != this.zoomLastSep) {\n            var cp = (ev.touches[0].pageX + ev.touches[1].pageX)/2;\n            var scp = this.viewStart + (cp/this.scale)|0\n            this.scale = this.zoomInitialScale * (sep/this.zoomInitialSep);\n            this.viewStart = scp - (cp/this.scale)|0;\n            for (var i = 0; i < this.tiers.length; ++i) {\n                tiers[i].getRenderer().drawTier(tiers[i]);\n            }\n        }\n        this.zoomLastSep = sep;\n    }\n}\n\nBrowser.prototype.touchEndHandler = function(ev) {\n}\n\nBrowser.prototype.touchCancelHandler = function(ev) {\n}\n\n\nBrowser.prototype.makeTier = function(source, config) {\n    try {\n        return this.realMakeTier(source, config);\n    } catch (e) {\n        console.log('Error initializing', source);\n        console.log(e.stack || e);\n    }\n}\n\nBrowser.prototype.realMakeTier = function(source, config) {\n    var thisB = this;\n    var background = null;\n    if (this.tierBackgroundColors) {\n        background = this.tierBackgroundColors[this.tiers.length % this.tierBackgroundColors.length];\n    }\n\n    var tier = new DasTier(this, source, config, background);\n    tier.oorigin = this.viewStart\n\n    var isDragging = false;\n    var dragOrigin, dragMoveOrigin;\n    var hoverTimeout;\n\n    var featureLookup = function(rx, ry) {\n        var st = tier.subtiers;\n        if (!st) {\n            return;\n        }\n\n        var sti = 0;\n        ry -= tier.padding;;\n        while (sti < st.length && ry > st[sti].height && sti < (st.length - 1)) {\n            ry = ry - st[sti].height - tier.padding;\n            ++sti;\n        }\n        if (sti >= st.length) {\n            return;\n        }\n\n        var glyphs = st[sti].glyphs;\n        var viewCenter = (thisB.viewStart + thisB.viewEnd)/2;\n        var offset = (tier.glyphCacheOrigin - thisB.viewStart)*thisB.scale;\n        rx -= offset;\n\n        return glyphLookup(glyphs, rx, ry);\n    }\n\n    var dragMoveHandler = function(ev) {\n        ev.preventDefault(); ev.stopPropagation();\n        var rx = ev.clientX;\n        if (rx != dragMoveOrigin) {\n            thisB.move((rx - dragMoveOrigin), true);\n            dragMoveOrigin = rx;\n        }\n        thisB.isDragging = true;\n    }\n\n    var dragUpHandler = function(ev) {\n        window.removeEventListener('mousemove', dragMoveHandler, true);\n        window.removeEventListener('mouseup', dragUpHandler, true);\n        thisB.move((ev.clientX - dragMoveOrigin)); // Snap back (FIXME: consider animation)\n    }\n\n\n    tier.viewport.addEventListener('mousedown', function(ev) {\n        thisB.browserHolder.focus();\n        ev.preventDefault();\n        var br = tier.row.getBoundingClientRect();\n        var rx = ev.clientX, ry = ev.clientY;\n\n        window.addEventListener('mousemove', dragMoveHandler, true);\n        window.addEventListener('mouseup', dragUpHandler, true);\n        dragOrigin = dragMoveOrigin = rx;\n        thisB.isDragging = false; // Not dragging until a movement event arrives.\n    }, false);\n\n    tier.viewport.addEventListener('mousemove', function(ev) {\n        var br = tier.row.getBoundingClientRect();\n        var rx = ev.clientX - br.left, ry = ev.clientY - br.top;\n\n        var hit = featureLookup(rx, ry);\n        if (hit && hit.length > 0) {\n            tier.row.style.cursor = 'pointer';\n        } else {\n            tier.row.style.cursor = 'default';\n        }\n\n        if (hoverTimeout) {\n            clearTimeout(hoverTimeout);\n        }\n\n        if (isDragging) {\n            // if (tier.dasSource.tier_type !== 'sequence' && rx != dragMoveOrigin) {\n            //    thisB.move((rx - dragMoveOrigin));\n            //    dragMoveOrigin = rx;\n            // }\n        } else {\n            hoverTimeout = setTimeout(function() {\n                var hit = featureLookup(rx, ry);\n                if (hit && hit.length > 0) {\n                    thisB.notifyFeatureHover(ev, hit[hit.length - 1], hit, tier);\n                }\n            }, 1000);\n        }\n    });\n\n    var doubleClickTimeout = null;\n    tier.viewport.addEventListener('mouseup', function(ev) {\n        var br = tier.row.getBoundingClientRect();\n        var rx = ev.clientX - br.left, ry = ev.clientY - br.top;\n\n        var hit = featureLookup(rx, ry);\n        if (hit && hit.length > 0 && !thisB.isDragging) {\n            if (doubleClickTimeout) {\n                clearTimeout(doubleClickTimeout);\n                doubleClickTimeout = null;\n                thisB.featureDoubleClick(hit, rx, ry);\n            } else {\n                doubleClickTimeout = setTimeout(function() {\n                    doubleClickTimeout = null;\n                    thisB.notifyFeature(ev, hit[hit.length-1], hit, tier);\n                }, 500);\n            }\n        }\n\n        if (thisB.isDragging && rx != dragOrigin && tier.sequenceSource) {\n            var a = thisB.viewStart + (rx/thisB.scale);\n            var b = thisB.viewStart + (dragOrigin/thisB.scale);\n\n            var min, max;\n            if (a < b) {\n                min = a|0; max = b|0;\n            } else {\n                min = b|0; max = a|0;\n            }\n\n            thisB.notifyRegionSelect(thisB.chr, min, max);\n        }\n        thisB.isDragging = false;\n    }, false);\n\n    tier.viewport.addEventListener('mouseout', function(ev) {\n        isDragging = false;\n    });\n\n    tier.removeButton.addEventListener('click', function(ev) {\n        ev.stopPropagation(); ev.preventDefault();\n        for (var ti = 0; ti < thisB.tiers.length; ++ti) {\n            if (thisB.tiers[ti] === tier) {\n                thisB.removeTier({index: ti});\n                break;\n            }\n        }\n    }, false);\n    tier.nameButton.addEventListener('click', function(ev) {\n        ev.stopPropagation(); ev.preventDefault();\n\n        if (ev.shiftKey) {\n            var hitTier = -1;\n            for (var ti = 0; ti < thisB.tiers.length; ++ti) {\n                if (thisB.tiers[ti] === tier) {\n                    hitTier = ti;\n                    break;\n                }\n            }\n            if (hitTier >= 0) {\n                var i = thisB.selectedTiers.indexOf(hitTier);\n                if (i >= 0) {\n                    thisB.selectedTiers.splice(i, 1);\n                } else {\n                    thisB.selectedTiers.push(hitTier);\n                    thisB.selectedTiers.sort();\n                }\n                thisB.markSelectedTiers();\n                thisB.notifyTierSelection();\n\n                if (thisB.selectedTiers.length > 0) {\n                    thisB.browserHolder.focus();\n                } else {\n                    thisB.notifyTierSelectionWrap(-1);\n                }\n            }\n        } else {\n            for (var ti = 0; ti < thisB.tiers.length; ++ti) {\n                if (thisB.tiers[ti] === tier) {\n                    thisB.browserHolder.focus();\n                    if (thisB.selectedTiers.length != 1 || thisB.selectedTiers[0] != ti) {\n                        thisB.setSelectedTier(ti);\n                        return;\n                    }\n                }\n            }\n\n            if (!tier.infoVisible) {\n                tier.infoElement.style.display = 'block';\n                tier.updateHeight();\n                tier.infoVisible = true;\n            } else {\n                tier.infoElement.style.display = 'none';\n                tier.updateHeight();\n                tier.infoVisible = false;\n            }\n        }\n    }, false);\n    tier.bumpButton.addEventListener('click', function(ev) {\n        ev.stopPropagation(); ev.preventDefault();\n        var bumpStatus;\n        var t = tier;\n        if (t.dasSource.collapseSuperGroups) {\n            if (bumpStatus === undefined) {\n                bumpStatus = !t.bumped;\n            }\n            t.mergeConfig({bumped: bumpStatus});\n        }\n    }, false);\n\n\n    var dragLabel;\n    var dragTierHolder;\n    var dragTierHolderScrollLimit;\n    var tierOrdinal;\n    var yAtLastReorder;\n    var tiersWereReordered = false;\n\n    var labelDragHandler = function(ev) {\n        var label = tier.label;\n\n        ev.stopPropagation(); ev.preventDefault();\n        if (!dragLabel) {\n            if (tier.pinned) {\n                dragTierHolder = thisB.pinnedTierHolder;\n            } else {\n                dragTierHolder = thisB.tierHolder;\n            }\n            dragTierHolderScrollLimit = dragTierHolder.scrollHeight - dragTierHolder.offsetHeight;\n\n            dragLabel = label.cloneNode(true);\n            dragLabel.style.cursor = 'pointer';\n            dragTierHolder.appendChild(dragLabel);\n            label.style.visibility = 'hidden';\n\n            for (var ti = 0; ti < thisB.tiers.length; ++ti) {\n                if (thisB.tiers[ti] === tier) {\n                    tierOrdinal = ti;\n                    break;\n                }\n            }\n\n            yAtLastReorder = ev.clientY;\n        }\n\n        var holderBCR = dragTierHolder.getBoundingClientRect();\n        dragLabel.style.left = (label.getBoundingClientRect().left - holderBCR.left) + 'px';\n        dragLabel.style.top = (ev.clientY - holderBCR.top + dragTierHolder.scrollTop - 10) + 'px';\n\n        var pty = ev.clientY - holderBCR.top + dragTierHolder.scrollTop;\n        for (var ti = 0; ti < thisB.tiers.length; ++ti) {\n            var tt = thisB.tiers[ti];\n            if (tt.pinned ^ tier.pinned)\n                continue;\n\n            var ttr = tt.row.getBoundingClientRect();\n            pty -= (ttr.bottom - ttr.top);\n            if (pty < 0) {\n                if (ti < tierOrdinal && ev.clientY < yAtLastReorder || ti > tierOrdinal && ev.clientY > yAtLastReorder) {\n                    thisB.withPreservedSelection(function() {\n                        thisB.tiers.splice(tierOrdinal, 1);\n                        thisB.tiers.splice(ti, 0, tier);\n                        thisB._ensureTiersGrouped(ti > tierOrdinal);\n                    });\n\n                    for (var tix = 0; tix < thisB.tiers.length; ++tix)\n                        if (thisB.tiers[tix] == tier)\n                            tierOrdinal = tix;\n\n                    yAtLastReorder = ev.clientY;\n                    thisB.reorderTiers();\n                    dragTierHolder.appendChild(dragLabel); // Because reorderTiers removes all children.\n                    tiersWereReordered = true;\n                }\n                break;\n            }\n        }\n\n        if (dragLabel.offsetTop < dragTierHolder.scrollTop) {\n            dragTierHolder.scrollTop -= (dragTierHolder.scrollTop - dragLabel.offsetTop);\n        } else if ((dragLabel.offsetTop + dragLabel.offsetHeight) > (dragTierHolder.scrollTop + dragTierHolder.offsetHeight)) {\n            dragTierHolder.scrollTop = Math.min(dragTierHolder.scrollTop +\n                                                   (dragLabel.offsetTop + dragLabel.offsetHeight) -\n                                                   (dragTierHolder.scrollTop + dragTierHolder.offsetHeight),\n                                                dragTierHolderScrollLimit);\n        }\n    };\n\n    var labelReleaseHandler = function(ev) {\n        var label = tier.label;\n\n        ev.stopPropagation(); ev.preventDefault();\n        if (dragLabel) {\n            dragLabel.style.cursor = 'auto';\n            dragTierHolder.removeChild(dragLabel);\n            dragLabel = null;\n            label.style.visibility = 'visible';\n        }\n        document.removeEventListener('mousemove', labelDragHandler, false);\n        document.removeEventListener('mouseup', labelReleaseHandler, false);\n\n        if (tiersWereReordered) {\n            for (var ti = 0; ti < thisB.tiers.length; ++ti) {\n                if (thisB.tiers[ti] == tier) {\n                    thisB.setSelectedTier(ti);\n                    break;\n                }\n            }\n            thisB.notifyTier(\"reordered\", tier);\n        }\n    };\n\n    tier.label.addEventListener('mousedown', function(ev) {\n        ev.stopPropagation(); ev.preventDefault();\n        tiersWereReordered = false;\n        document.addEventListener('mousemove', labelDragHandler, false);\n        document.addEventListener('mouseup', labelReleaseHandler, false);\n    }, false);\n\n    this.tiers.push(tier);  // NB this currently tells any extant knownSpace about the new tier.\n\n // fetches stylesheet\n    return tier.init().then(function (updatedTier) {\n        updatedTier.currentlyHeight = 50;\n        thisB.updateHeight();\n        updatedTier.updateLabel();\n\n        thisB.withPreservedSelection(thisB._ensureTiersGrouped);\n        updatedTier._updateFromConfig();\n        thisB.reorderTiers();\n\n        return updatedTier;\n    });\n}\n\nBrowser.prototype.reorderTiers = function() {\n    removeChildren(this.tierHolder);\n    removeChildren(this.pinnedTierHolder);\n    if (this.disablePinning) {\n        this.tierHolder.appendChild(this.ruler);\n        this.tierHolder.appendChild(this.ruler2);\n    }\n    var hasPinned = false;\n    var pinnedTiers = [], unpinnedTiers = [];\n    for (var i = 0; i < this.tiers.length; ++i) {\n        var t = this.tiers[i];\n        var visible = ['sub','dummy'].indexOf(this.tiers[i].dasSource.renderer) === -1;\n        if (t.pinned && !this.disablePinning) {\n            pinnedTiers.push(t);\n            if (visible)\n                this.pinnedTierHolder.appendChild(this.tiers[i].row);\n            hasPinned = true;\n        } else {\n            unpinnedTiers.push(t);\n            if (visible)\n                this.tierHolder.appendChild(this.tiers[i].row);\n        }\n    }\n\n    this.withPreservedSelection(function() {\n        this.tiers.splice(0, this.tiers.length);\n        for (var i = 0; i < pinnedTiers.length; ++i)\n            this.tiers.push(pinnedTiers[i]);\n        for (var i = 0; i < unpinnedTiers.length; ++i)\n            this.tiers.push(unpinnedTiers[i]);\n    });\n\n    if (hasPinned)\n        this.pinnedTierHolder.classList.add('tier-holder-pinned-full');\n    else\n        this.pinnedTierHolder.classList.remove('tier-holder-pinned-full');\n\n    this.arrangeTiers();\n}\n\nBrowser.prototype.withPreservedSelection = function(f) {\n    var st = [];\n    for (var xi = 0; xi < this.selectedTiers.length; ++xi) {\n        st.push(this.tiers[this.selectedTiers[xi]]);\n    }\n\n    f.call(this);\n\n    this.selectedTiers = [];\n    for (var sti = 0; sti < this.tiers.length; ++sti) {\n        if (st.indexOf(this.tiers[sti]) >= 0)\n            this.selectedTiers.push(sti);\n    }\n}\n\nBrowser.prototype.refreshTier = function(tier, tierCallback) {\n    var renderer = this.getTierRenderer(tier);\n    if (tier.dasSource.renderer === 'multi') {\n        renderer.drawTier(tier);\n    } else {\n        var renderCallback = tierCallback || renderer.renderTier;\n        if (this.knownSpace) {\n            this.knownSpace.invalidate(tier, renderCallback);\n        }\n    }\n}\n\nBrowser.prototype.getTierRenderer = function(tier) {\n    var renderer = tier.dasSource.renderer || this.defaultRenderer;\n    if (typeof(renderer) === 'string') {\n        return this.renderers[renderer];\n    } else if (typeof(renderer.renderTier) === 'function' &&\n               typeof(renderer.drawTier) === 'function') {\n        return renderer;\n    } else {\n        console.log(\"Tier doesn't have a renderer\");\n    }\n}\n\n/* Internal use only, assumes selection is being managed elsewhere... */\n\nBrowser.prototype._ensureTiersGrouped = function(down) {\n    var groupedTiers = {};\n    for (var ti = 0; ti < this.tiers.length; ++ti) {\n        var t = this.tiers[ti];\n        if (t.dasSource.tierGroup) {\n            pusho(groupedTiers, t.dasSource.tierGroup, t);\n        }\n    }\n\n    var newTiers = [];\n    if (down)\n        this.tiers.reverse();\n    for (var ti = 0; ti < this.tiers.length; ++ti) {\n        var t = this.tiers[ti];\n        if (t.dasSource.tierGroup) {\n            var nt = groupedTiers[t.dasSource.tierGroup];\n            if (nt) {\n                if (down)\n                    nt.reverse();\n                for (var nti = 0; nti < nt.length; ++nti)\n                    newTiers.push(nt[nti]);\n                groupedTiers[t.dasSource.tierGroup] = null;\n            }\n        } else {\n            newTiers.push(t);\n        }\n    }\n    if (down)\n        newTiers.reverse();\n    this.tiers.splice(0, this.tiers.length);\n    for (var nti = 0; nti < newTiers.length; ++nti)\n        this.tiers.push(newTiers[nti]);\n}\n\nBrowser.prototype.arrangeTiers = function() {\n    var arrangedTiers = [];\n    var groupedTiers = {};\n\n    for (var ti = 0; ti < this.tiers.length; ++ti) {\n        var t = this.tiers[ti];\n        if (t.pinned) {\n            arrangedTiers.push(t);\n            if (t.dasSource.tierGroup) {\n                pusho(groupedTiers, t.dasSource.tierGroup, t);\n            }\n        }\n\n    }\n    for (var ti = 0; ti < this.tiers.length; ++ti) {\n        var t = this.tiers[ti];\n        if (!t.pinned) {\n            arrangedTiers.push(t);\n            if (t.dasSource.tierGroup) {\n                pusho(groupedTiers, t.dasSource.tierGroup, t);\n            }\n        }\n    }\n\n    for (var g in groupedTiers) {\n        var tiers = groupedTiers[g];\n        var tierGroup = this.tierGroups[g];\n        if (!tierGroup) {\n            tierGroup = {\n                element: makeElement(\n                    'div',\n                    makeElement('span', g, {className: 'tier-group-label'}),\n                    {className: \"tier-group\"})\n            };\n            this.tierGroups[g] = tierGroup;\n        }\n\n        if (tierGroup.element.parentNode)\n            tierGroup.element.parentNode.removeChild(tierGroup.element);\n\n        var holder = tiers[0].pinned ? this.pinnedTierHolder : this.tierHolder;\n        var min = 10000000, max = 0;\n        for (var ti = 0; ti < tiers.length; ++ti) {\n            var row = tiers[ti].row;\n            min = Math.min(min, row.offsetTop);\n            max = Math.max(max, row.offsetTop + row.offsetHeight);\n        }\n        tierGroup.element.style.top = min + 'px';\n        tierGroup.element.style.left = '0px';\n        tierGroup.element.style.height = (max-min) + 'px';\n        holder.appendChild(tierGroup.element);\n    }\n\n    if (this.tierBackgroundColors) {\n        for (var ti = 0; ti < arrangedTiers.length; ++ti) {\n            var t = arrangedTiers[ti];\n            t.setBackground(this.tierBackgroundColors[ti % this.tierBackgroundColors.length]);\n            if (t.dasSource.tierGroup)\n                t.label.style.left = '18px';\n            else\n                t.label.style.left = '2px';\n            t.background = this.tierBackgroundColors[ti % this.tierBackgroundColors.length];\n        }\n    }\n}\n\nBrowser.prototype.refresh = function() {\n    this.retrieveTierData(this.tiers);\n    this.drawOverlays();\n    this.positionRuler();\n};\n\nvar defaultTierRenderer = function(status, tier) {\n    console.log(\"DEPRECATED!\");\n}\n\nBrowser.prototype.retrieveTierData = function(tiers) {\n    this.notifyLocation();\n    var width = (this.viewEnd - this.viewStart) + 1;\n    var minExtraW = (this.minExtraWidth / this.scale)|0;\n    var maxExtraW = (this.maxExtraWidth / this.scale)|0;\n\n    var newOrigin = (this.viewStart + this.viewEnd) / 2;\n    var oh = newOrigin - this.origin;\n    this.origin = newOrigin;\n    this.scaleAtLastRedraw = this.scale;\n    for (var t = 0; t < tiers.length; ++t) {\n        var od = oh;\n        if (tiers[t].originHaxx) {\n            od += tiers[t].originHaxx;\n        }\n        tiers[t].originHaxx = od;\n    }\n\n    var scaledQuantRes = this.targetQuantRes / this.scale;\n\n    var innerDrawnStart = Math.max(1, (this.viewStart|0) - minExtraW);\n    var innerDrawnEnd = Math.min((this.viewEnd|0) + minExtraW, ((this.currentSeqMax|0) > 0 ? (this.currentSeqMax|0) : 1000000000))\n    var outerDrawnStart = Math.max(1, (this.viewStart|0) - maxExtraW);\n    var outerDrawnEnd = Math.min((this.viewEnd|0) + maxExtraW, ((this.currentSeqMax|0) > 0 ? (this.currentSeqMax|0) : 1000000000));\n\n    if (!this.knownSpace || this.knownSpace.chr !== this.chr) {\n        var ss = this.getSequenceSource();\n        if (this.knownSpace)\n            this.knownSpace.cancel();\n        // known space is created based on the entire tier list, for future caching purposes, even if only a subset of the tiers are needed to be rendered now.\n        this.knownSpace = new KnownSpace(this.tiers, this.chr, outerDrawnStart, outerDrawnEnd, scaledQuantRes, ss);\n    }\n\n    var seg = this.knownSpace.bestCacheOverlapping(this.chr, innerDrawnStart, innerDrawnEnd);\n    if (seg && seg.min <= innerDrawnStart && seg.max >= innerDrawnEnd) {\n        this.drawnStart = Math.max(seg.min, outerDrawnStart);\n        this.drawnEnd = Math.min(seg.max, outerDrawnEnd);\n    } else {\n        this.drawnStart = outerDrawnStart;\n        this.drawnEnd = outerDrawnEnd;\n    }\n    // send in the subset of tiers to retrieve.\n    this.knownSpace.retrieveFeatures(tiers,\n                                     this.chr,\n                                     this.drawnStart,\n                                     this.drawnEnd,\n                                     scaledQuantRes);\n}\n\nfunction setSources(msh, availableSources, maybeMapping) {\n    if (maybeMapping) {\n        for (var s = 0; s < availableSources.length; ++s) {\n            availableSources[s].mapping = maybeMapping;\n        }\n    }\n    msh.set(availableSources);\n}\n\nBrowser.prototype.queryRegistry = function(maybeMapping, tryCache) {\n    if (!this.registry)\n        return;\n\n    var thisB = this;\n    var coords, msh;\n    if (maybeMapping) {\n        coords = this.chains[maybeMapping].coords;\n        if (!thisB.mappableSources[maybeMapping]) {\n            thisB.mappableSources[maybeMapping] = new Observed();\n        }\n        msh = thisB.mappableSources[maybeMapping];\n    } else {\n        coords = this.coordSystem;\n        msh = this.availableSources;\n    }\n    var cacheHash = hex_sha1(miniJSONify(coords));\n    if (tryCache) {\n        var cacheTime = localStorage['dalliance.registry.' + cacheHash + '.last_queried'];\n        if (cacheTime) {\n            try {\n                setSources(msh, JSON.parse(localStorage['dalliance.registry.' + cacheHash + '.sources']), maybeMapping);\n                var cacheAge = (Date.now()|0) - (cacheTime|0);\n                if (cacheAge < (12 * 60 * 60 * 1000)) {\n                    return;\n                }\n            } catch (rex) {\n                console.log('Bad registry cache: ' + rex);\n            }\n        }\n    }\n\n    var rurl = this.registry;\n    if (rurl.indexOf('//') == 0) {\n        var proto = window.location.protocol;\n        if (proto != 'https:' && proto != 'http:')\n            rurl = 'http:' + rurl;\n    }\n    new DASRegistry(rurl).sources(function(sources) {\n        var availableSources = [];\n        for (var s = 0; s < sources.length; ++s) {\n            var source = sources[s];\n            if (!source.coords || source.coords.length == 0) {\n                continue;\n            }\n            var scoords = source.coords[0];\n            if (scoords.taxon != coords.taxon || scoords.auth != coords.auth || scoords.version != coords.version) {\n                continue;\n            }\n            availableSources.push(source);\n        }\n\n        localStorage['dalliance.registry.' + cacheHash + '.sources'] = JSON.stringify(availableSources);\n        localStorage['dalliance.registry.' + cacheHash + '.last_queried'] = '' + Date.now();\n\n        setSources(msh, availableSources, maybeMapping);\n    }, function(error) {\n        // msh.set(null);\n    }, coords);\n}\n\n//\n// Navigation\n//\n\nBrowser.prototype.move = function(pos, soft)\n{\n    var wid = this.viewEnd - this.viewStart;\n    var nStart = this.viewStart - ((1.0 * pos) / this.scale);\n    var nEnd = nStart + wid;\n\n    if (!soft) {\n        if (this.currentSeqMax > 0 && nEnd > this.currentSeqMax) {\n            nEnd = this.currentSeqMax;\n            nStart = this.viewEnd - wid;\n        }\n        if (nStart < 1) {\n            nStart = 1;\n            nEnd = nStart + wid;\n        }\n    }\n\n    this.setLocation(null, nStart, nEnd, null, soft);\n}\n\nBrowser.prototype.zoomStep = function(delta) {\n    var oz = 1.0 * this.zoomSliderValue;\n    var nz = oz + delta;\n    if (nz < this.zoomMin) {\n        nz= this.zoomMin;\n    }\n    if (nz > this.zoomMax) {\n        nz = this.zoomMax;\n    }\n\n    if (nz != oz) {\n        this.zoomSliderValue = nz; // FIXME maybe ought to set inside zoom!\n        this.zoom(Math.exp((1.0 * nz) / this.zoomExpt));\n    }\n}\n\nBrowser.prototype.zoom = function(factor) {\n    this.zoomFactor = factor;\n    var viewCenter = Math.round((this.viewStart + this.viewEnd) / 2.0)|0;\n    this.viewStart = viewCenter - this.zoomBase * this.zoomFactor / 2;\n    this.viewEnd = viewCenter + this.zoomBase * this.zoomFactor / 2;\n    if (this.currentSeqMax > 0 && (this.viewEnd > this.currentSeqMax + 5)) {\n        var len = this.viewEnd - this.viewStart + 1;\n        this.viewEnd = this.currentSeqMax;\n        this.viewStart = this.viewEnd - len + 1;\n    }\n    if (this.viewStart < 1) {\n        var len = this.viewEnd - this.viewStart + 1;\n        this.viewStart = 1;\n        this.viewEnd = this.viewStart + len - 1;\n    }\n    this.scale = this.featurePanelWidth / (this.viewEnd - this.viewStart)\n    var width = this.viewEnd - this.viewStart + 1;\n\n    var scaleRat = (this.scale / this.scaleAtLastRedraw);\n\n    this.notifyLocation();\n    this.refresh();\n}\n\nBrowser.prototype.spaceCheck = function(dontRefresh) {\n    if (!this.knownSpace || this.knownSpace.chr !== this.chr) {\n        this.refresh();\n        return;\n    }\n\n    var width = ((this.viewEnd - this.viewStart)|0) + 1;\n    var minExtraW = (this.minExtraWidth / this.scale)|0;\n    var maxExtraW = (this.maxExtraWidth / this.scale)|0;\n\n    if ((this.drawnStart|0) > Math.max(1, ((this.viewStart|0) - minExtraW)|0)  || (this.drawnEnd|0) < Math.min((this.viewEnd|0) + minExtraW, ((this.currentSeqMax|0) > 0 ? (this.currentSeqMax|0) : 1000000000)))  {\n        this.refresh();\n    }\n}\n\nBrowser.prototype.resizeViewer = function(skipRefresh) {\n    var width = this.tierHolder.getBoundingClientRect().width | 0;\n    if (width == 0)\n        return;\n\n    var oldFPW = Math.max(this.featurePanelWidth, 300); // Can get silly values stored\n                                                        // when the browser is hidden.\n    this.featurePanelWidth = width|0;\n\n    if (oldFPW != this.featurePanelWidth) {\n        this.zoomMax = this.zoomExpt * Math.log(this.maxViewWidth / this.zoomBase);\n        this.zoomMin = this.zoomExpt * Math.log(this.featurePanelWidth / this.maxPixelsPerBase / this.zoomBase);   // FIXME hard-coded minimum.\n        this.zoomSliderValue = this.zoomExpt * Math.log((this.viewEnd - this.viewStart + 1) / this.zoomBase);\n\n        var viewWidth = this.viewEnd - this.viewStart;\n        var nve = this.viewStart + (viewWidth * this.featurePanelWidth) / oldFPW;\n\n        this.viewEnd = nve;\n\n        var wid = this.viewEnd - this.viewStart + 1;\n        if (this.currentSeqMax > 0 && this.viewEnd > this.currentSeqMax) {\n            this.viewEnd = this.currentSeqMax;\n            this.viewStart = this.viewEnd - wid + 1;\n        }\n        if (this.viewStart < 1) {\n            this.viewStart = 1;\n            this.viewEnd = this.viewStart + wid - 1;\n        }\n\n        this.positionRuler();\n\n        if (!skipRefresh) {\n            this.spaceCheck();\n        }\n        this.notifyLocation();\n    }\n\n    if (this.fullScreen) {\n        this.setFullScreenHeight();\n    }\n}\n\nBrowser.prototype.setFullScreenHeight = function() {\n    var rest = document.body.offsetHeight - this.browserHolder.offsetHeight;\n    this.browserHolder.style.maxHeight = Math.max(300, window.innerHeight - rest - 20) + 'px'\n}\n\nBrowser.prototype.addTier = function(conf) {\n    var thisB = this;\n    conf = shallowCopy(conf);\n    conf.disabled = false;\n\n    return this.makeTier(conf).then(function (tier) {\n        thisB.refreshTier(tier);\n        thisB.markSelectedTiers();\n        thisB.positionRuler();\n        thisB.notifyTier(\"added\", tier);\n        return tier;\n    })\n};\n\n\nBrowser.prototype.removeTier = function(conf, force) {\n    var target = -1;\n\n    if (typeof conf.index !== 'undefined' && conf.index >=0 && conf.index < this.tiers.length) {\n        target = conf.index;\n    } else {\n        for (var ti = 0; ti < this.tiers.length; ++ti) {\n            var ts = this.tiers[ti].dasSource;\n\n            if (sourcesAreEqual(conf, ts)) {\n                target = ti; break;\n            }\n        }\n    }\n\n    if (target < 0) {\n        throw \"Couldn't find requested tier\";\n    }\n\n    var targetTier = this.tiers[target];\n    this.tiers.splice(target, 1);\n\n    var nst = [];\n    for (var sti = 0; sti < this.selectedTiers.length; ++sti) {\n        var st = this.selectedTiers[sti];\n        if (st < target) {\n            nst.push(st);\n        } else if (st > target) {\n            nst.push(st - 1);\n        }\n    }\n    this.selectedTiers = nst;\n    this.markSelectedTiers();\n\n    targetTier.destroy();\n    if (this.knownSpace) {\n        this.knownSpace.featureCache[targetTier] = null;\n    }\n\n    this.reorderTiers();\n    this.notifyTier(\"removed\", targetTier);\n}\n\nBrowser.prototype.removeAllTiers = function() {\n\tvar thisB = this;\n    this.selectedTiers = [];\n    this.markSelectedTiers();\n    this.tiers.forEach(function (targetTier) {\n        targetTier.destroy();\n        if (thisB.knownSpace) {\n            thisB.knownSpace.featureCache[targetTier] = null;\n        }\n    });\n    this.tiers.length = 0;\n    this.reorderTiers();\n    this.notifyTier(\"removedAll\", null);\n}\n\nBrowser.prototype.getSequenceSource = function() {\n    if (this._sequenceSource === undefined)\n        this._sequenceSource = this._getSequenceSource();\n    return this._sequenceSource;\n}\n\nBrowser.prototype._getSequenceSource = function() {\n    for (var ti = 0; ti < this.tiers.length; ++ti) {\n        if (this.tiers[ti].sequenceSource) {\n            return this.tiers[ti].sequenceSource;\n        }\n    }\n\n    for (var si = 0; si < this.defaultSources.length; ++si) {\n        var s = this.defaultSources[si];\n        if (s.provides_entrypoints || s.tier_type == 'sequence' || s.twoBitURI || s.twoBitBlob) {\n            if (s.twoBitURI || s.twoBitBlob) {\n                return new TwoBitSequenceSource(s);\n            } else if (s.ensemblURI) {\n                return new EnsemblSequenceSource(s);\n            } else {\n                return new DASSequenceSource(s);\n            }\n        }\n    }\n}\n\nBrowser.prototype.setLocation = function(newChr, newMin, newMax, callback, soft) {\n    if (typeof(newMin) !== 'number') {\n        throw Error('minimum must be a number (got ' + JSON.stringify(newMin) + ')');\n    }\n    if (typeof(newMax) !== 'number') {\n        throw Error('maximum must be a number (got ' + JSON.stringify(newMax) + ')');\n    }\n\n    if (newMin > newMax) {\n        var oldNewMin = newMin;\n        newMin = newMax;\n        newMax = oldNewMin;\n    } else if (newMin === newMax) {\n        newMax += 1;\n    }\n\n    if (!callback) {\n        callback = function(err) {\n            if (err) {\n                throw err;\n            }\n        }\n    }\n    var thisB = this;\n\n    if ((!newChr || newChr == this.chr) && this.currentSeqMax > 0) {\n        return this._setLocation(null, newMin, newMax, null, callback, soft);\n    } else {\n        var ss = this.getSequenceSource();\n        if (!ss) {\n            return callback('Need a sequence source');\n        }\n\n        var findChr = newChr || this.chr;\n        ss.getSeqInfo(findChr, function(si) {\n            if (!si) {\n                var altChr;\n                if (findChr.indexOf('chr') == 0) {\n                    altChr = findChr.substr(3);\n                } else {\n                    altChr = 'chr' + findChr;\n                }\n                ss.getSeqInfo(altChr, function(si2) {\n                    if (!si2 && newChr) {\n                        return callback(\"Couldn't find sequence '\" + newChr + \"'\");\n                    } else if (!si2) {\n                        return thisB._setLocation(null, newMin, newMax, null, callback, soft);\n                    } else {\n                        return thisB._setLocation(altChr, newMin, newMax, si2, callback, soft);\n                    }\n                });\n            } else {\n                return thisB._setLocation(newChr, newMin, newMax, si, callback, soft);\n            }\n        });\n    }\n}\n\nBrowser.prototype._setLocation = function(newChr, newMin, newMax, newChrInfo, callback, soft) {\n    var chrChanged = false;\n    if (newChr) {\n        if (newChr.indexOf('chr') == 0)\n            newChr = newChr.substring(3);\n\n        if (this.chr != newChr)\n            chrChanged = true;\n        this.chr = newChr;\n        this.currentSeqMax = newChrInfo.length;\n    }\n\n    newMin = parseFloat(newMin); newMax=parseFloat(newMax);\n\n    var newWidth = Math.max(10, newMax-newMin+1);\n\n    if (!soft) {\n        var csm = this.currentSeqMax;\n        if (csm <= 0)\n            csm = 1000000000000;\n        if (newMin < 1) {\n            newMin = 1; newMax = newMin + newWidth - 1;\n        }\n        if (newMax > csm) {\n            newMax = csm;\n            newMin = Math.max(1, newMax - newWidth + 1);\n        }\n    }\n\n    this.viewStart = newMin;\n    this.viewEnd = newMax;\n    var newScale = Math.max(this.featurePanelWidth || this.offscreenInitWidth, 50) / (this.viewEnd - this.viewStart);\n    var oldScale = this.scale;\n    var scaleChanged = (Math.abs(newScale - oldScale)) > 0.000001;\n    this.scale = newScale;\n\n    var newZS, oldZS;\n    oldZS = this.zoomSliderValue;\n    this.zoomSliderValue = newZS = this.zoomExpt * Math.log((this.viewEnd - this.viewStart + 1) / this.zoomBase);\n\n    if (scaleChanged || chrChanged) {\n        for (var i = 0; i < this.tiers.length; ++i) {\n            this.tiers[i].viewportHolder.style.left = '5000px';\n            this.tiers[i].overlay.style.left = '5000px';\n        }\n\n        this.refresh();\n        // var self = this;\n        // this.tiers.forEach(function(tier) {self.refreshTier(tier);});\n        // this.refreshTier\n\n        if (this.savedZoom) {\n            newZS -= this.zoomMin;\n            oldZS -= this.zoomMin;\n            var difToActive = newZS - oldZS;\n            var difToSaved = newZS - this.savedZoom;\n            if (Math.abs(difToActive) > Math.abs(difToSaved)) {\n                this.isSnapZooming = !this.isSnapZooming;\n                this.savedZoom = oldZS;\n            }\n        } else {\n            this.isSnapZooming = false;\n            this.savedZoom = null;\n        }\n    } else {\n        var viewCenter = (this.viewStart + this.viewEnd)/2;\n\n        for (var i = 0; i < this.tiers.length; ++i) {\n            var offset = (this.viewStart - this.tiers[i].norigin)*this.scale;\n            this.tiers[i].viewportHolder.style.left = '' + ((-offset|0) - 1000) + 'px';\n            this.tiers[i].drawOverlay();\n        }\n    }\n\n    this.notifyLocation();\n\n    this.spaceCheck();\n    if (this.instrumentActivity)\n        this.activityStartTime = Date.now()|0;\n    return callback();\n}\n\nBrowser.prototype.setCenterLocation = function(newChr, newCenterLoc) {\n    var halfWidth = (this.viewEnd - this.viewStart)/2,\n    newMin = newCenterLoc - halfWidth,\n    newMax = newCenterLoc + halfWidth;\n    this.setLocation(newChr, newMin, newMax);\n}\n\nBrowser.prototype.pingActivity = function() {\n    if (!this.instrumentActivity || !this.activityStartTime)\n        return;\n\n    var activity = 0;\n    for (var ti = 0; ti < this.tiers.length; ++ti) {\n        if (this.tiers[ti].loaderButton.style.display !== 'none')\n            ++activity;\n    }\n\n    if (activity == 0) {\n        var now = Date.now()|0;\n        console.log('Loading took ' + (now-this.activityStartTime) + 'ms');\n        this.activityStartTime = null;\n    }\n}\n\nBrowser.prototype.addInitListener = function(handler) {\n    this.initListeners.push(handler);\n}\n\nBrowser.prototype.addFeatureListener = function(handler, opts) {\n    opts = opts || {};\n    this.featureListeners.push(handler);\n}\n\nBrowser.prototype.removeFeatureListener = function(handler, opts) {\n    var idx = arrayIndexOf(this.featureListeners, handler);\n    if (idx >= 0) {\n        this.featureListeners.splice(idx, 1);\n    }\n}\n\nBrowser.prototype.notifyFeature = function(ev, feature, hit, tier) {\n  for (var fli = 0; fli < this.featureListeners.length; ++fli) {\n      try {\n          if (this.featureListeners[fli](ev, feature, hit, tier))\n            return;\n      } catch (ex) {\n          console.log(ex.stack);\n      }\n  }\n}\n\nBrowser.prototype.addFeatureHoverListener = function(handler, opts) {\n    opts = opts || {};\n    this.featureHoverListeners.push(handler);\n}\n\nBrowser.prototype.removeFeatureHoverListener = function(handler, opts) {\n    var idx = arrayIndexOf(this.featureHoverListeners, handler);\n    if (idx >= 0) {\n        this.featureHoverListeners.splice(idx, 1);\n    }\n}\n\nBrowser.prototype.notifyFeatureHover = function(ev, feature, hit, tier) {\n    for (var fli = 0; fli < this.featureHoverListeners.length; ++fli) {\n        try {\n            this.featureHoverListeners[fli](ev, feature, hit, tier);\n        } catch (ex) {\n            console.log(ex.stack);\n        }\n    }\n}\n\nBrowser.prototype.addViewListener = function(handler, opts) {\n    opts = opts || {};\n    this.viewListeners.push(handler);\n}\n\nBrowser.prototype.removeViewListener = function(handler, opts) {\n    var idx = arrayIndexOf(this.viewListeners, handler);\n    if (idx >= 0) {\n        this.viewListeners.splice(idx, 1);\n    }\n}\n\nBrowser.prototype.notifyLocation = function() {\n    var nvs = Math.max(1, this.viewStart|0);\n    var nve = this.viewEnd|0;\n    if (this.currentSeqMax > 0 && nve > this.currentSeqMax)\n        nve = this.currentSeqMax;\n\n    for (var lli = 0; lli < this.viewListeners.length; ++lli) {\n        try {\n            this.viewListeners[lli](\n                this.chr,\n                nvs,\n                nve,\n                this.zoomSliderValue,\n                {current: this.zoomSliderValue,\n                 alternate: (this.savedZoom+this.zoomMin) || this.zoomMin,\n                 isSnapZooming: this.isSnapZooming,\n                 min: this.zoomMin,\n                 max: this.zoomMax},\n                 this.viewStart,\n                 this.viewEnd);\n        } catch (ex) {\n            console.log(ex.stack);\n        }\n    }\n}\n\nBrowser.prototype.addTierListener = function(handler) {\n    this.tierListeners.push(handler);\n}\n\nBrowser.prototype.removeTierListener = function(handler) {\n    var idx = arrayIndexOf(this.tierListeners, handler);\n    if (idx >= 0) {\n        this.tierListeners.splice(idx, 1);\n    }\n}\n\nBrowser.prototype.notifyTier = function(status, tier) {\n    for (var tli = 0; tli < this.tierListeners.length; ++tli) {\n        try {\n            this.tierListeners[tli](status, tier);\n        } catch (ex) {\n            console.log(ex.stack);\n        }\n    }\n}\n\nBrowser.prototype.addRegionSelectListener = function(handler) {\n    this.regionSelectListeners.push(handler);\n}\n\nBrowser.prototype.removeRegionSelectListener = function(handler) {\n    var idx = arrayIndexOf(this.regionSelectListeners, handler);\n    if (idx >= 0) {\n        this.regionSelectListeners.splice(idx, 1);\n    }\n}\n\nBrowser.prototype.notifyRegionSelect = function(chr, min, max) {\n    for (var rli = 0; rli < this.regionSelectListeners.length; ++rli) {\n        try {\n            this.regionSelectListeners[rli](chr, min, max);\n        } catch (ex) {\n            console.log(ex.stack);\n        }\n    }\n}\n\n\nBrowser.prototype.highlightRegion = function(chr, min, max) {\n    var thisB = this;\n\n    if (chr == this.chr) {\n        return this._highlightRegion(chr, min, max);\n    }\n\n    var ss = this.getSequenceSource();\n    if (!ss) {\n        throw 'Need a sequence source';\n    }\n\n    ss.getSeqInfo(chr, function(si) {\n        if (!si) {\n            var altChr;\n            if (chr.indexOf('chr') == 0) {\n                altChr = chr.substr(3);\n            } else {\n                altChr = 'chr' + chr;\n            }\n            ss.getSeqInfo(altChr, function(si2) {\n                if (!si2) {\n                    // Fail silently.\n                } else {\n                    return thisB._highlightRegion(altChr, min, max);\n                }\n            });\n        } else {\n            return thisB._highlightRegion(chr, min, max);\n        }\n    });\n}\n\nBrowser.prototype._highlightRegion = function(chr, min, max) {\n    for (var hi = 0; hi < this.highlights.length; ++hi) {\n        var h = this.highlights[hi];\n        if (h.chr == chr && h.min == min && h.max == max)\n            return;\n    }\n\n    this.highlights.push(new Region(chr, min, max));\n    var visStart = this.viewStart - (1000/this.scale);\n    var visEnd = this.viewEnd + (1000/this.scale);\n    if ((chr == this.chr || chr == ('chr'+this.chr)) && min < visEnd && max > visStart) {\n        this.drawOverlays();\n    }\n\n    this.notifyLocation();\n}\n\nBrowser.prototype.clearHighlights = function() {\n    this.highlights = [];\n    this.drawOverlays();\n    this.notifyLocation();\n}\n\nBrowser.prototype.drawOverlays = function() {\n    for (var ti = 0; ti < this.tiers.length; ++ti) {\n        this.tiers[ti].drawOverlay();\n    }\n}\n\nBrowser.prototype.featuresInRegion = function(chr, min, max) {\n    var features = [];\n    if (chr !== this.chr) {\n        return [];\n    }\n\n    for (var ti = 0; ti < this.tiers.length; ++ti) {\n        var fl = this.tiers[ti].currentFeatures || [];\n        for (var fi = 0; fi < fl.length; ++fi) {\n            var f = fl[fi];\n            if (f.min <= max && f.max >= min) {\n                features.push(f);\n            }\n        }\n    }\n    return features;\n}\n\n\nBrowser.prototype.getSelectedTier = function() {\n    if (this.selectedTiers.length > 0)\n        return this.selectedTiers[0];\n    else\n        return -1;\n}\n\nBrowser.prototype.setSelectedTier = function(t) {\n    if (t == null) {\n        this.selectedTiers = [];\n    } else {\n        this.selectedTiers = [t];\n    }\n    this.markSelectedTiers();\n    this.notifyTierSelection();\n}\n\nBrowser.prototype.markSelectedTiers = function() {\n    for (var ti = 0; ti < this.tiers.length; ++ti) {\n        var button = this.tiers[ti].nameButton;\n\n        if (this.selectedTiers.indexOf(ti) >= 0) {\n            button.classList.add('active');\n        } else {\n            button.classList.remove('active');\n        }\n    }\n    if (this.selectedTiers.length > 0) {\n        var browserMid = this.browserHolder.offsetTop + this.browserHolder.offsetHeight/2;\n        if (browserMid > document.body.scrollTop && (browserMid + 100) < document.body.scrollTop + window.innerHeight)\n            this.browserHolder.focus();\n    }\n}\n\nBrowser.prototype.addTierSelectionListener = function(handler) {\n    this.tierSelectionListeners.push(handler);\n}\n\nBrowser.prototype.removeTierSelectionListener = function(handler) {\n    var idx = arrayIndexOf(this.tierSelectionListeners, handler);\n    if (idx >= 0) {\n        this.tierSelectionListeners.splice(idx, 1);\n    }\n}\n\nBrowser.prototype.notifyTierSelection = function() {\n    for (var fli = 0; fli < this.tierSelectionListeners.length; ++fli) {\n        try {\n            this.tierSelectionListeners[fli](this.selectedTiers);\n        } catch (ex) {\n            console.log(ex.stack);\n        }\n    }\n\n}\n\nBrowser.prototype.addTierSelectionWrapListener = function(f) {\n    this.tierSelectionWrapListeners.push(f);\n}\n\nBrowser.prototype.removeTierSelectionWrapListener = function(handler) {\n    var idx = arrayIndexOf(this.tierSelectionWrapListeners, handler);\n    if (idx >= 0) {\n        this.tierSelectionWrapListeners.splice(idx, 1);\n    }\n}\n\nBrowser.prototype.notifyTierSelectionWrap = function(i) {\n    for (var fli = 0; fli < this.tierSelectionWrapListeners.length; ++fli) {\n        try {\n            this.tierSelectionWrapListeners[fli](i);\n        } catch (ex) {\n            console.log(ex.stack);\n        }\n    }\n}\n\n\nBrowser.prototype.positionRuler = function() {\n    var display = 'none';\n    var left = '';\n    var right = '';\n\n    if (this.rulerLocation == 'center') {\n        display = 'block';\n        left = '' + ((this.featurePanelWidth/2)|0) + 'px';\n    } else if (this.rulerLocation == 'left') {\n        display = 'block';\n        left = '0px';\n    } else if (this.rulerLocation == 'right') {\n        display = 'block';\n        right = '0px'\n    } else {\n        display = 'none';\n    }\n\n    this.ruler.style.display = display;\n    this.ruler.style.left = left;\n    this.ruler.style.right = right;\n\n    if(this.singleBaseHighlight) {\n        this.ruler2.style.display = 'block';\n        this.ruler2.style.borderWidth = '1px';\n        if (this.scale < 1) {\n            this.ruler2.style.width = '0px';\n            this.ruler2.style.borderRightWidth = '0px'\n        } else {\n            this.ruler2.style.width = this.scale + 'px';\n            this.ruler2.style.borderRightWidth = '1px'\n        }\n        // Position accompanying single base location text\n        this.locSingleBase.style.visibility = 'visible';\n        var centreOffset = this.featurePanelWidth/2 - this.locSingleBase.offsetWidth/2 + this.ruler2.offsetWidth/2;\n        this.locSingleBase.style.left = '' + (centreOffset|0) + 'px';\n    } else {\n        this.locSingleBase.style.visibility = 'hidden';\n        this.ruler2.style.width = '1px';\n        this.ruler2.style.borderWidth = '0px';\n        this.ruler2.style.display = this.rulerLocation == 'center' ? 'none' : 'block';\n    }\n\n    this.ruler2.style.left = '' + ((this.featurePanelWidth/2)|0) + 'px';\n\n    for (var ti = 0; ti < this.tiers.length; ++ti) {\n        var tier = this.tiers[ti];\n        var q = tier.quantOverlay;\n\n        var quant;\n        if (tier.subtiers && tier.subtiers.length > 0)\n            quant = tier.subtiers[0].quant;\n\n        if (q) {\n            q.style.display = quant ? display : 'none';\n            q.style.left = left;\n            q.style.right = right;\n        }\n    }\n}\n\nBrowser.prototype.featureDoubleClick = function(hit, rx, ry) {\n    if (!hit || hit.length == 0)\n        return;\n\n    var f = hit[hit.length - 1];\n\n    if (!f.min || !f.max) {\n        return;\n    }\n\n    var fstart = (((f.min|0) - (this.viewStart|0)) * this.scale);\n    var fwidth = (((f.max - f.min) + 1) * this.scale);\n\n    var newMid = (((f.min|0) + (f.max|0)))/2;\n    if (fwidth > 10) {\n        var frac = (1.0 * (rx - fstart)) / fwidth;\n        if (frac < 0.3) {\n            newMid = (f.min|0);\n        } else  if (frac > 0.7) {\n            newMid = (f.max|0) + 1;\n        }\n    }\n\n    var width = this.viewEnd - this.viewStart;\n    this.setLocation(null, newMid - (width/2), newMid + (width/2));\n}\n\nBrowser.prototype.zoomForScale = function(scale) {\n    var ssScale;\n    if (scale > this.highZoomThreshold) {\n        ssScale = 'high';\n    } else if (scale > this.mediumZoomThreshold) {\n        ssScale = 'medium';\n    } else  {\n        ssScale = 'low';\n    }\n    return ssScale;\n}\n\nBrowser.prototype.zoomForCurrentScale = function() {\n    return this.zoomForScale(this.scale);\n}\n\nBrowser.prototype.updateHeight = function() {\n    var tierTotal = 0;\n    for (var ti = 0; ti < this.tiers.length; ++ti)\n        tierTotal += (this.tiers[ti].currentHeight || 30);\n    this.ruler.style.height = '' + tierTotal + 'px';\n    this.ruler2.style.height = '' + tierTotal + 'px';\n    this.browserHolder.style.display = 'block';\n    this.browserHolder.style.display = '-webkit-flex';\n    this.browserHolder.style.display = 'flex';\n    // this.svgHolder.style.maxHeight = '' + Math.max(tierTotal, 500) + 'px';\n}\n\nBrowser.prototype.scrollArrowKey = function(ev, dir) {\n    if (this.reverseKeyScrolling)\n        dir = -dir;\n\n    if (ev.ctrlKey || ev.metaKey) {\n        var fedge = false;\n        if(ev.shiftKey){\n            fedge = true;\n        }\n\n        this.leap(dir, fedge);\n    } else if (this.scale > 1) {\n        // per-base scrolling mode, tries to perfectly center.\n        var mid = (this.viewStart + this.viewEnd)/2\n        var err = mid - Math.round(mid);\n        var n = 1;\n        if (ev.shiftKey)\n            n *= 10;\n        if (dir > 0) {\n            n = -n;\n            n -= err;\n            if (err > 0)\n                n += 1;\n        } else {\n            n -= err;\n            if (err < 0)\n                n -= 1;\n        }\n        this.setLocation(null, this.viewStart + n, this.viewEnd + n);\n    } else {\n        this.move(ev.shiftKey ? 100*dir : 25*dir);\n    }\n}\n\nBrowser.prototype.leap = function(dir, fedge) {\n    var thisB = this;\n    var pos=((thisB.viewStart + thisB.viewEnd + 1)/2)|0;\n    if (dir > 0 && thisB.viewStart <= 1) {\n        pos -= 100000000;\n    } else if (dir < 0 && thisB.viewEnd >= thisB.currentSeqMax) {\n        pos += 100000000;\n    }\n\n    var st = thisB.getSelectedTier();\n    if (st < 0) return;\n    var tier = thisB.tiers[st];\n\n    if (tier && ((tier.featureSource && this.sourceAdapterIsCapable(tier.featureSource, 'quantLeap') && typeof(tier.quantLeapThreshold) == 'number')\n                 || (tier.featureSource && this.sourceAdapterIsCapable(tier.featureSource, 'leap')))) {\n        tier.findNextFeature(\n              thisB.chr,\n              pos,\n              -dir,\n              fedge,\n              function(nxt) {\n                  if (nxt) {\n                      var nmin = nxt.min;\n                      var nmax = nxt.max;\n                      if (fedge) {\n                        if (dir > 0) {\n                          if (nmin>pos+1) {\n                              nmax=nmin;\n                          } else {\n                              nmax++;\n                              nmin=nmax\n                          }\n                        } else {\n                            if (nmax<pos-1) {\n                                nmax++;\n                                nmin=nmax;\n                            } else {\n                                nmax=nmin;\n                            }\n                        }\n                      }\n                      var wid = thisB.viewEnd - thisB.viewStart + 1;\n                      if(parseFloat(wid/2) == parseInt(wid/2)){wid--;}\n                      var newStart = (nmin + nmax - wid)/2 + 1;\n                      var newEnd = newStart + wid - 1;\n                      var pos2=pos;\n                      thisB.setLocation(nxt.segment, newStart, newEnd);\n                  } else {\n                      alert('no next feature'); // FIXME better reporting would be nice!\n                  }\n              });\n    } else {\n        this.move(100*dir);\n    }\n}\n\nfunction glyphLookup(glyphs, rx, ry, matches) {\n    matches = matches || [];\n\n    for (var gi = glyphs.length - 1; gi >= 0; --gi) {\n        var g = glyphs[gi];\n        if (!g.notSelectable && g.min() <= rx && g.max() >= rx) {\n            if (g.minY) {\n                if (ry < g.minY() || ry > g.maxY())\n                    continue;\n            }\n\n            if (g.feature) {\n                matches.push(g.feature);\n            } else if (g.group) {\n                matches.push(g.group);\n            }\n\n            if (g.glyphs) {\n                return glyphLookup(g.glyphs, rx, ry, matches);\n            } else if (g.glyph) {\n                return glyphLookup([g.glyph], rx, ry, matches);\n            } else {\n                return matches;\n            }\n        }\n    }\n    return matches;\n}\n\nBrowser.prototype.nameForCoordSystem = function(cs) {\n    var primary = null, ucsc = null;\n    if (this.assemblyNamePrimary) {\n        primary = '' + cs.auth;\n        if (typeof(cs.version) !== 'undefined')\n            primary += cs.version;\n    }\n    if (this.assemblyNameUcsc) {\n        ucsc = cs.ucscName;\n    }\n    if (primary != null && ucsc != null)\n        return primary + '/' + ucsc;\n    else\n        return primary || ucsc || 'unknown';\n}\n\nBrowser.prototype.makeLoader = function(size) {\n    size = size || 16;\n    var retina = window.devicePixelRatio > 1;\n    if (size < 20) {\n        return makeElement('img', null, {src: this.resolveURL('$$img/spinner_' + (retina ? 16 : 32) + '.gif'), width: '16', height: '16'});\n    } else {\n        return makeElement('img', null, {src: this.resolveURL('$$img/spinner_' + (retina ? 24 : 48) + '.gif'), width: '24', height: '24'});\n    }\n}\n\nBrowser.prototype.canFetchPlainHTTP = function() {\n    var self = this;\n    if (!this._plainHTTPPromise) {\n        var worker = this.getWorker();\n        if (worker) {\n            this._plainHTTPPromise = new Promise(function(resolve, reject) {\n                worker.postCommand(\n                    {command: 'textxhr',\n                     uri: self.httpCanaryURL},\n                    function(result, err) {\n                        if (result) {\n                            resolve(true);\n                        } else {\n                            resolve(false);\n                        }\n                    });\n                });\n        } else {\n           this._plainHTTPPromise = new Promise(function(resolve, reject) {\n                textXHR(\n                    self.httpCanaryURL,\n                    function(result, err) {\n                        if (result) {\n                            resolve(true);\n                        } else {\n                            resolve(false);\n                        }\n                    },\n                    {timeout: 2000}\n                );\n            });\n        }\n    }\n    return this._plainHTTPPromise;\n}\n\nBrowser.prototype.getWorker = function() {\n    if (!this.useFetchWorkers || !this.fetchWorkers || this.fetchWorkers.length==0)\n        return null;\n\n    if (this.nextWorker >= this.fetchWorkers.length)\n        this.nextWorker = 0;\n    return this.fetchWorkers[this.nextWorker++];\n}\n\nBrowser.prototype.registerResolver = function(resolver) {\n    var id = 'res' + (++this.resolverSeed);\n    this.resolvers[id] = resolver;\n    return id;\n}\n\nfunction FetchWorker(browser, worker) {\n    var thisB = this;\n    this.tagSeed = 0;\n    this.callbacks = {};\n    this.browser = browser;\n    this.worker = worker;\n\n    this.worker.onmessage = function(ev) {\n        var data = ev.data;\n\n        if (!data.cmd) {\n            var cb = thisB.callbacks[data.tag];\n            if (cb) {\n                cb(data.result, data.error);\n                delete thisB.callbacks[data.tag];\n            }\n        } else if (data.cmd == 'resolve') {\n            var resolver = thisB.browser.resolvers[data.resolver];\n            if (resolver) {\n                resolver(data.url).then(function(url) {\n                    thisB.worker.postMessage({\n                        tag: data.tag,\n                        url: url\n                    });\n                }).catch(function(err){\n                    console.log(err);\n                    thisB.worker.postMessage({\n                        tag: data.tag,\n                        err: err.toString()\n                    });\n                });\n            } else {\n                console.log('No resolver ' + data.resolver);\n            }\n        } else {\n            console.log('Bad worker callback ' + data.cmd);\n        }\n    };\n}\n\nfunction makeFetchWorker(browser) {\n    var wurl = browser.resolveURL(browser.workerPath);\n    if (wurl.indexOf('//') == 0) {\n        var proto = window.location.protocol;\n        if (proto == 'https:')\n            wurl = 'https:' + wurl;\n        else\n            wurl = 'http:' + wurl;\n    }\n\n    var wscript = 'importScripts(\"' + wurl + '?version=' + VERSION + '\");';\n    var wblob = new Blob([wscript], {type: 'application/javascript'});\n\n\n    return new Promise(function(resolve, reject) {\n        var worker = new Worker(URL.createObjectURL(wblob));\n\n        worker.onmessage = function(ev) {\n            if (ev.data.tag === 'init') {\n                console.log('Worker initialized');\n                resolve(new FetchWorker(browser, worker))\n            }\n\n        }\n\n        worker.onerror = function(ev) {\n            reject(ev.message);\n        }\n    });\n}\n\nFetchWorker.prototype.postCommand = function(cmd, callback, transfer) {\n    var tag = 'x' + (++this.tagSeed);\n    cmd.tag = tag;\n    this.callbacks[tag] = callback;\n    this.worker.postMessage(cmd, transfer);\n}\n\nFetchWorker.prototype.terminate = function() {\n    this.worker.terminate();\n}\n\nif (typeof(module) !== 'undefined') {\n    module.exports = {\n        Browser: Browser\n    };\n\n    // Required because they add stuff to Browser.prototype\n    require('./browser-ui');\n    require('./track-adder');\n    require('./feature-popup');\n    require('./tier-actions');\n    require('./domui');\n    require('./search');\n\n    var sa = require('./sourceadapters');\n    var TwoBitSequenceSource = sa.TwoBitSequenceSource;\n    var EnsemblSequenceSource = sa.EnsemblSequenceSource;\n    var EnsemblProteinSequenceSource = sa.EnsemblProteinSequenceSource;\n    var DASSequenceSource = sa.DASSequenceSource;\n\n    var KnownSpace = require('./kspace').KnownSpace;\n\n    var DASRegistry = require('./das').DASRegistry;\n}\n\nfunction SourceCache() {\n    this.sourcesByURI = {}\n}\n\nSourceCache.prototype.get = function(conf) {\n    var scb = this.sourcesByURI[sourceDataURI(conf)];\n    if (scb) {\n        for (var si = 0; si < scb.configs.length; ++si) {\n            if (sourcesAreEqualModuloStyle(scb.configs[si], conf)) {\n                return scb.sources[si];\n            }\n        }\n    }\n}\n\nSourceCache.prototype.put = function(conf, source) {\n    var uri = sourceDataURI(conf);\n    var scb = this.sourcesByURI[uri];\n    if (!scb) {\n        scb = {configs: [], sources: []};\n        this.sourcesByURI[uri] = scb;\n    }\n    scb.configs.push(conf);\n    scb.sources.push(source);\n}\n","/* -*- mode: javascript; c-basic-offset: 4; indent-tabs-mode: nil -*- */\n\n// \n// Dalliance Genome Explorer\n// (c) Thomas Down 2006-2010\n//\n// chainset.js: liftover support\n//\n\n\"use strict\";\n\nif (typeof(require) !== 'undefined') {\n    var das = require('./das');\n    var DASSource = das.DASSource;\n    var DASSegment = das.DASSegment;\n\n    var utils = require('./utils');\n    var pusho = utils.pusho;\n    var shallowCopy = utils.shallowCopy;\n\n    var parseCigar = require('./cigar').parseCigar;\n\n    var bin = require('./bin');\n    var URLFetchable = bin.URLFetchable;\n\n    var bbi = require('./bigwig');\n    var makeBwg = bbi.makeBwg;\n\n    var Promise = require('es6-promise').Promise;\n}\n\nfunction Chainset(conf, srcTag, destTag, coords) {\n    if (typeof(conf) == 'string') {\n        this.uri = conf;\n        this.srcTag = srcTag;\n        this.destTag = destTag;\n        this.coords = coords;\n    } else {\n        this.uri = conf.uri;\n        this.srcTag = conf.srcTag;\n        this.destTag = conf.destTag;\n        this.coords = shallowCopy(conf.coords);\n        this.type = conf.type;\n        this.credentials = conf.credentials;\n    }\n\n    this.chainsBySrc = {};\n    this.chainsByDest = {};\n    this.postFetchQueues = {};\n    this.fetchedTiles = {};\n    this.granularity = 1000000;  // size in bases of tile to fetch\n\n    if (this.type == 'bigbed') {\n        this.chainFetcher = new BBIChainFetcher(this.uri, this.credentials);\n    } else if (this.type == 'alias') {\n        this.chainFetcher = new AliasChainFetcher(conf);\n    } else {\n        this.chainFetcher = new DASChainFetcher(this.uri, this.srcTag, this.destTag);\n    }\n};\n\nChainset.prototype.exportConfig = function() {\n    return {\n        uri: this.uri,\n        srcTag: this.srcTag,\n        destTag: this.destTag,\n        coords: this.coords,\n        type: this.type,\n        credentials: this.credentials\n    };\n}\n\nChainset.prototype.mapPoint = function(chr, pos) {\n    var chains = this.chainsBySrc[chr] || [];\n    for (var ci = 0; ci < chains.length; ++ci) {\n        var c = chains[ci];\n        if (pos >= c.srcMin && pos <= c.srcMax) {\n            var cpos;\n            if (c.srcOri == '-') {\n                cpos = c.srcMax - pos;\n            } else {\n                cpos = pos - c.srcMin;\n            }\n            var blocks = c.blocks;\n            for (var bi = 0; bi < blocks.length; ++bi) {\n                var b = blocks[bi];\n                var bSrc = b[0];\n                var bDest = b[1];\n                var bSize = b[2];\n                if (cpos >= bSrc && cpos <= (bSrc + bSize)) {\n                    var apos = cpos - bSrc;\n\n                    var dpos;\n                    if (c.destOri == '-') {\n                        dpos = c.destMax - bDest - apos;\n                    } else {\n                        dpos = apos + bDest + c.destMin;\n                    }\n                    return {seq: c.destChr, pos: dpos, flipped: (c.srcOri != c.destOri)}\n                }\n            }\n        }\n    }\n    return null;\n}\n\nChainset.prototype.mapSegment = function(chr, min, max) {\n    var chains = this.chainsBySrc[chr] || [];\n    var mappings = [];\n    for (var ci = 0; ci < chains.length; ++ci) {\n        var c = chains[ci];\n        if (max >= c.srcMin && min <= c.srcMax) {\n            var cmin, cmax;\n            if (c.srcOri == '-') {\n                cmin = c.srcMax - max;\n                cmax = c.srcMax - min;\n            } else {\n                cmin = min - c.srcMin;\n                cmax = max - c.srcMin;\n            }\n            var blocks = c.blocks;\n            for (var bi = 0; bi < blocks.length; ++bi) {\n                var b = blocks[bi];\n                var bSrc = b[0];\n                var bDest = b[1];\n                var bSize = b[2];\n                if (cmax >= bSrc && cmin <= (bSrc + bSize)) {\n                    var m = {\n                        segment: c.destChr,\n                        flipped: (c.srcOri == '-') ^ (c.destOri == '-')};\n\n                    if (c.destOri == '-') {\n                        if (cmin >= bSrc) {\n                            m.max = c.destMax - bDest - cmin + bSrc;\n                        } else {\n                            m.max = c.destMax - bDest;\n                            m.partialMax = bSrc - cmin;\n                        }\n                        if (cmax <= (bSrc + bSize)) {\n                            m.min = c.destMax - bDest - cmax + bSrc;\n                        } else {\n                            m.min = c.destMax - bDest - bSize;\n                            m.partialMin = cmax - bSrc - bSize;\n                        }\n                    } else {\n                        if (cmin >= bSrc) {\n                            m.min = c.destMin + bDest + cmin - bSrc;\n                        } else {\n                            m.min = c.destMin + bDest;\n                            m.partialMin = bSrc - cmin;\n                        }\n                        if (cmax <= (bSrc + bSize)) {\n                            m.max = c.destMin + bDest + cmax - bSrc;\n                        } else {\n                            m.max = c.destMin + bDest + bSize;\n                            m.partialMax = cmax - bSrc - bSize;\n                        }\n                    }\n                    mappings.push(m);\n                }\n            }\n        }\n    }\n    return mappings;\n}\n\nChainset.prototype.unmapPoint = function(chr, pos) {\n    var chains = this.chainsByDest[chr] || [];\n    for (var ci = 0; ci < chains.length; ++ci) {\n        var c = chains[ci];\n        if (pos >= c.destMin && pos <= c.destMax) {\n            var cpos;\n            if (c.srcOri == '-') {\n                cpos = c.destMax - pos;\n            } else {\n                cpos = pos - c.destMin;\n            }    \n            \n            var blocks = c.blocks;\n            for (var bi = 0; bi < blocks.length; ++bi) {\n                var b = blocks[bi];\n                var bSrc = b[0];\n                var bDest = b[1];\n                var bSize = b[2];\n\n                if (cpos >= bDest && cpos <= (bDest + bSize)) {\n                    var apos = cpos - bDest;\n\n                    var dpos = apos + bSrc + c.srcMin;\n                    var dpos;\n                    if (c.destOri == '-') {\n                        dpos = c.srcMax - bSrc - apos;\n                    } else {\n                        dpos = apos + bSrc + c.srcMin;\n                    }\n                    return {seq: c.srcChr, pos: dpos, flipped: (c.srcOri != c.destOri)}\n                }\n            }\n            // return null;\n        }\n    }\n    return null;\n}\n\nChainset.prototype.sourceBlocksForRange = function(chr, min, max, callback) {\n    var STATE_PENDING = 1;\n    var STATE_FETCHED = 2;\n\n    var thisCS = this;\n    var minTile = (min/this.granularity)|0;\n    var maxTile = (max/this.granularity)|0;\n\n    var needsNewOrPending = false;\n    var needsNewFetch = false;\n    for (var t = minTile; t <= maxTile; ++t) {\n        var tn = chr + '_' + t;\n        if (this.fetchedTiles[tn] != STATE_FETCHED) {\n            needsNewOrPending = true;\n            if (this.fetchedTiles[tn] != STATE_PENDING) {\n                this.fetchedTiles[tn] = STATE_PENDING;\n                needsNewFetch = true;\n            }\n        }\n    }\n\n    if (needsNewOrPending) {\n        if (!this.postFetchQueues[chr]) {\n            this.chainFetcher.fetchChains(\n                chr, \n                minTile * this.granularity, \n                (maxTile+1) * this.granularity - 1)\n              .then(function(chains) {\n                if (!thisCS.chainsByDest)\n                    thisCS.chainsByDest[chr] = [];\n                for (var ci = 0; ci < chains.length; ++ci) {\n                    var chain = chains[ci];\n\n                    {\n                        var cbs = thisCS.chainsBySrc[chain.srcChr];\n                        if (!cbs) {\n                            thisCS.chainsBySrc[chain.srcChr] = [chain];\n                        } else {\n                            var present = false;\n                            for (var oci = 0; oci < cbs.length; ++oci) {\n                                var oc = cbs[oci];\n                                if (oc.srcMin == chain.srcMin && oc.srcMax == chain.srcMax) {\n                                    present = true;\n                                    break;\n                                }\n                            }\n                            if (!present)\n                                cbs.push(chain);\n                        }\n                    }\n\n                    {\n                        var cbd = thisCS.chainsByDest[chain.destChr];\n                        if (!cbd) {\n                            thisCS.chainsByDest[chain.destChr] = [chain];\n                        } else {\n                            var present = false;\n                            for (var oci = 0; oci < cbd.length; ++oci) {\n                                var oc = cbd[oci];\n                                if (oc.destMin == chain.destMin && oc.destMax == chain.destMax) {\n                                    present = true;\n                                    break;\n                                }\n                            }\n                            if (!present)\n                                cbd.push(chain);\n                        }\n                    }\n                }\n                for (var t = minTile; t <= maxTile; ++t) {\n                    var tn = chr + '_' + t;\n                    thisCS.fetchedTiles[tn] = STATE_FETCHED;\n                }\n                if (thisCS.postFetchQueues[chr]) {\n                    var pfq = thisCS.postFetchQueues[chr];\n                    for (var i = 0; i < pfq.length; ++i) {\n                        pfq[i]();\n                    }\n                    thisCS.postFetchQueues[chr] = null;\n                }\n              }).catch(function (err) {\n                console.log(err);\n              });   \n        }\n\n        pusho(this.postFetchQueues, chr, function() {\n            // Will either succeed if the tiles that are needed have already been fetched,\n            // or queue up a new fetch.\n\n            thisCS.sourceBlocksForRange(chr, min, max, callback);\n        });\n    } else {\n        var srcBlocks = [];\n        var chains = this.chainsByDest[chr] || [];\n        for (var ci = 0; ci < chains.length; ++ci) {\n            var c = chains[ci];\n            if (min <= c.destMax && max >= c.destMin) {\n                var cmin, cmax;\n                if (c.srcOri == '-') {\n                    cmin = c.destMax - max;\n                    cmax = c.destMax - min;\n                } else {\n                    cmin = min - c.destMin;\n                    cmax = max - c.destMin;\n                }\n\n                var blocks = c.blocks;\n                for (var bi = 0; bi < blocks.length; ++bi) {\n                    var b = blocks[bi];\n                    var bSrc = b[0];\n                    var bDest = b[1];\n                    var bSize = b[2];\n\n                    if (cmax >= bDest && cmin <= (bDest + bSize)) {\n                        var amin = Math.max(cmin, bDest) - bDest;\n                        var amax = Math.min(cmax, bDest + bSize) - bDest;\n\n                        if (c.destOri == '-') {\n                            srcBlocks.push(new DASSegment(c.srcChr, c.srcMax - bSrc - amax, c.srcMax - bSrc - amin));\n                        } else {\n                            srcBlocks.push(new DASSegment(c.srcChr, c.srcMin + amin + bSrc, c.srcMin + amax + bSrc));\n                        }\n                    }\n                }\n            }\n        }\n        callback(srcBlocks);\n    }\n}\n\nfunction DASChainFetcher(uri, srcTag, destTag) {\n    this.source = new DASSource(uri);\n    this.srcTag = srcTag;\n    this.destTag =destTag;\n}\n\nDASChainFetcher.prototype.fetchChains = function(chr, _min, _max) {\n    var thisCS = this;\n\n    return new Promise(function(resolve, reject) {\n        thisCS.source.alignments(chr, {}, function(aligns) {\n            var chains = [];\n\n            for (var ai = 0; ai < aligns.length; ++ai) {\n                var aln = aligns[ai];\n                for (var bi = 0; bi < aln.blocks.length; ++bi) {\n                    var block = aln.blocks[bi];\n                    var srcSeg, destSeg;\n                    for (var si = 0; si < block.segments.length; ++si) {\n                        var seg = block.segments[si];\n                        var obj = aln.objects[seg.object];\n                        if (obj.dbSource === thisCS.srcTag) {\n                            srcSeg = seg;\n                        } else if (obj.dbSource === thisCS.destTag) {\n                            destSeg = seg;\n                        }\n                    }\n                    if (srcSeg && destSeg) {\n                        var chain = {\n                            srcChr:     aln.objects[srcSeg.object].accession,\n                            srcMin:     srcSeg.min|0,\n                            srcMax:     srcSeg.max|0,\n                            srcOri:     srcSeg.strand,\n                            destChr:    aln.objects[destSeg.object].accession,\n                            destMin:    destSeg.min|0,\n                            destMax:    destSeg.max|0,\n                            destOri:    destSeg.strand,\n                            blocks:     []\n                        }\n\n                        var srcops = parseCigar(srcSeg.cigar), destops = parseCigar(destSeg.cigar);\n\n                        var srcOffset = 0, destOffset = 0;\n                        var srci = 0, desti = 0;\n                        while (srci < srcops.length && desti < destops.length) {\n                            if (srcops[srci].op == 'M' && destops[desti].op == 'M') {\n                                var blockLen = Math.min(srcops[srci].cnt, destops[desti].cnt);\n                                chain.blocks.push([srcOffset, destOffset, blockLen]);\n                                if (srcops[srci].cnt == blockLen) {\n                                    ++srci;\n                                } else {\n                                    srcops[srci].cnt -= blockLen;\n                                }\n                                if (destops[desti].cnt == blockLen) {\n                                    ++desti;\n                                } else {\n                                    destops[desti] -= blockLen;\n                                }\n                                srcOffset += blockLen;\n                                destOffset += blockLen;\n                            } else if (srcops[srci].op == 'I') {\n                                destOffset += srcops[srci++].cnt;\n                            } else if (destops[desti].op == 'I') {\n                                srcOffset += destops[desti++].cnt;\n                            }\n                        }\n\n                        chains.push(chain);\n                    }\n                }\n            }\n            resolve(chains);\n        });\n    });\n}\n\nfunction BBIChainFetcher(uri, credentials) {\n    var self = this;\n    this.uri = uri;\n    this.credentials = credentials;\n\n    this.bwg = new Promise(function(resolve, reject) {\n        makeBwg(new URLFetchable(self.uri, {credentials: self.credentials, \n                                            resolver: self.resolver}), \n          function(bwg, err) {\n            if (bwg) {\n                resolve(bwg);\n            } else {\n                reject(err);\n            }\n          });\n    });\n\n    this.bwg.then(function(bwg, err) {\n        if (err)\n            console.log(err);\n    });\n}\n\nfunction pi(x) {\n    return parseInt(x);\n}\n\nfunction cleanChr(c) {\n    if (c.indexOf('chr') == 0)\n        return c.substr(3);\n    else\n        return c;\n}\n\nfunction bbiFeatureToChain(feature) {\n    var chain = {\n        srcChr:     cleanChr(feature.srcChrom),\n        srcMin:     parseInt(feature.srcStart),\n        srcMax:     parseInt(feature.srcEnd),\n        srcOri:     feature.srcOri,\n        destChr:    cleanChr(feature.segment),\n        destMin:    feature.min - 1,     // Convert back from bigbed parser\n        destMax:    feature.max,\n        destOri:    feature.ori,\n        blocks:     []\n    };\n    var srcStarts = feature.srcStarts.split(',').map(pi);\n    var destStarts = feature.destStarts.split(',').map(pi);\n    var blockLengths = feature.blockLens.split(',').map(pi);\n    for (var bi = 0; bi < srcStarts.length; ++bi) {\n        chain.blocks.push([srcStarts[bi], destStarts[bi], blockLengths[bi]]);\n    }\n\n    return chain;\n}\n\nBBIChainFetcher.prototype.fetchChains = function(chr, min, max) {\n    return this.bwg.then(function(bwg, err) {\n        if (!bwg)\n            throw Error(\"No BWG\");\n\n        return new Promise(function(resolve, reject) {\n            bwg.getUnzoomedView().readWigData(chr, min, max, function(feats) {\n                resolve(feats.map(bbiFeatureToChain));\n            });\n        });\n    });\n};\n\nfunction AliasChainFetcher(conf) {\n    this.conf = conf;\n    this.forwardAliases = {};\n    var sa = conf.sequenceAliases || [];\n    for (var ai = 0; ai < sa.length; ++ai) {\n        var al = sa[ai];\n        if (al.length < 2)\n            continue;\n\n        var fa = [];\n        for (var i = 0; i < al.length - 1; ++i)\n            fa.push(al[i]);\n        this.forwardAliases[al[al.length - 1]] = fa;\n    }\n}\n\nAliasChainFetcher.prototype.fetchChains = function(chr, min, max) {\n    var resp = [];\n    var fa = this.forwardAliases[chr] || [];\n    for (var i = 0; i < fa.length; ++i) {\n        resp.push(\n            {\n                srcChr:         fa[i],\n                srcMin:         1,\n                srcMax:         1000000000,\n                srcOri:         '+',\n                destChr:        chr,\n                destMin:        1,\n                destMax:        1000000000,\n                destOri:        '+',\n                blocks: [[1, 1, 1000000000]]\n            });\n    }\n\n    return Promise.resolve(resp);\n}\n\nif (typeof(module) !== 'undefined') {\n    module.exports = {\n        Chainset: Chainset\n    };\n}\n","\n// \n// Dalliance Genome Explorer\n// (c) Thomas Down 2006-2010\n//\n// chainset.js: liftover support\n//\n\nvar CIGAR_REGEXP = new RegExp('([0-9]*)([MIDS])', 'g');\n\nfunction parseCigar(cigar)\n{\n    var cigops = [];\n    var match;\n    while ((match = CIGAR_REGEXP.exec(cigar)) != null) {\n        var count = match[1];\n        if (count.length == 0) {\n            count = 1;\n        }\n        cigops.push({cnt: count|0, op: match[2]});\n    }\n    return cigops;\n}\n\nif (typeof(module) !== 'undefined') {\n    module.exports = {\n        parseCigar: parseCigar\n    };\n}","/* -*- mode: javascript; c-basic-offset: 4; indent-tabs-mode: nil -*- */\n\n// \n// Dalliance Genome Explorer\n// (c) Thomas Down 2006-2010\n//\n// color.js\n//\n\n\"use strict\";\n\nfunction DColour(red, green, blue, name) {\n    this.red = red|0;\n    this.green = green|0;\n    this.blue = blue|0;\n    if (name) {\n        this.name = name;\n    }\n}\n\nDColour.prototype.toSvgString = function() {\n    if (!this.name) {\n        this.name = \"rgb(\" + this.red + \",\" + this.green + \",\" + this.blue + \")\";\n    }\n\n    return this.name;\n}\n\nfunction hex2(x) {\n    var y = '00' + x.toString(16);\n    return y.substring(y.length - 2);\n}\n\nDColour.prototype.toHexString = function() {\n    return '#' + hex2(this.red) + hex2(this.green) + hex2(this.blue);\n}\n\nvar palette = {\n    red: new DColour(255, 0, 0, 'red'),\n    green: new DColour(0, 255, 0, 'green'),\n    blue: new DColour(0, 0, 255, 'blue'),\n    yellow: new DColour(255, 255, 0, 'yellow'),\n    white: new DColour(255, 255, 255, 'white'),\n    black: new DColour(0, 0, 0, 'black'),\n    gray: new DColour(180, 180, 180, 'gray'),\n    grey: new DColour(180, 180, 180, 'grey'),\n    lightskyblue: new DColour(135, 206, 250, 'lightskyblue'),\n    lightsalmon: new DColour(255, 160, 122, 'lightsalmon'),\n    hotpink: new DColour(255, 105, 180, 'hotpink')\n};\n\nvar COLOR_RE = new RegExp('^#([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$');\nvar CSS_COLOR_RE = /rgb\\(([0-9]+),([0-9]+),([0-9]+)\\)/\n\nfunction dasColourForName(name) {\n    var c = palette[name];\n    if (!c) {\n        var match = COLOR_RE.exec(name);\n        if (match) {\n            c = new DColour(('0x' + match[1])|0, ('0x' + match[2])|0, ('0x' + match[3])|0, name);\n            palette[name] = c;\n        } else {\n    \t    match = CSS_COLOR_RE.exec(name);\n    \t    if (match) {\n        \t\tc = new DColour(match[1]|0, match[2]|0, match[3]|0, name);\n        \t\tpalette[name] = c;\n\t       } else {\n\t\t      console.log(\"couldn't handle color: \" + name);\n\t\t      c = palette.black;\n\t\t      palette[name] = c;\n\t       }\n        }\n    }\n    return c;\n}\n\nfunction makeColourSteps(steps, stops, colours) {\n    var dcolours = [];\n    for (var ci = 0; ci < colours.length; ++ci) {\n        dcolours.push(dasColourForName(colours[ci]));\n    }\n\n    var grad = [];\n  STEP_LOOP:\n    for (var si = 0; si < steps; ++si) {\n        var rs = (1.0 * si) / (steps-1);\n        var score = stops[0] + (stops[stops.length -1] - stops[0]) * rs;\n        for (var i = 0; i < stops.length - 1; ++i) {\n            if (score >= stops[i] && score <= stops[i+1]) {\n                var frac = (score - stops[i]) / (stops[i+1] - stops[i]);\n                var ca = dcolours[i];\n                var cb = dcolours[i+1];\n\n                var fill = new DColour(\n                    ((ca.red * (1.0 - frac)) + (cb.red * frac))|0,\n                    ((ca.green * (1.0 - frac)) + (cb.green * frac))|0,\n                    ((ca.blue * (1.0 - frac)) + (cb.blue * frac))|0\n                ).toSvgString();\n                grad.push(fill);\n\n                continue STEP_LOOP;\n            }\n        }\n        throw 'Bad step';\n    }\n\n    return grad;\n}\n\nfunction makeGradient(steps, color1, color2, color3) {\n    if (color3) {\n        return makeColourSteps(steps, [0, 0.5, 1], [color1, color2, color3]);\n    } else {\n        return makeColourSteps(steps, [0, 1], [color1, color2]);\n    }\n}\n\nif (typeof(module) !== 'undefined') {\n    module.exports = {\n        makeColourSteps: makeColourSteps,\n        makeGradient: makeGradient,\n        dasColourForName: dasColourForName\n    };\n}\n","/* -*- mode: javascript; c-basic-offset: 4; indent-tabs-mode: nil -*- */\n\n// \n// Dalliance Genome Explorer\n// (c) Thomas Down 2006-2011\n//\n// cram.js: indexed binary alignments\n//\n\n\"use strict\";\n\nif (typeof(require) !== 'undefined') {\n    var spans = require('./spans');\n    var Range = spans.Range;\n    var union = spans.union;\n    var intersection = spans.intersection;\n\n    var bin = require('./bin');\n    var readInt = bin.readInt;\n    var readShort = bin.readShort;\n    var readByte = bin.readByte;\n    var readInt64 = bin.readInt64;\n    var readFloat = bin.readFloat;\n\n    var lh3utils = require('./lh3utils');\n    var readVob = lh3utils.readVob;\n    var unbgzf = lh3utils.unbgzf;\n    var reg2bins = lh3utils.reg2bins;\n    var Chunk = lh3utils.Chunk;\n\n    var jszlib = require('jszlib');\n}\n\n\nvar CRAM_MAGIC = 0x14d4142;\nvar CRAI_MAGIC = 0x88B1F;\n\nvar CramFlags = {\n    MULTIPLE_SEGMENTS:       0x1,\n    ALL_SEGMENTS_ALIGN:      0x2,\n    SEGMENT_UNMAPPED:        0x4,\n    NEXT_SEGMENT_UNMAPPED:   0x8,\n    REVERSE_COMPLEMENT:      0x10,\n    NEXT_REVERSE_COMPLEMENT: 0x20,\n    FIRST_SEGMENT:           0x40,\n    LAST_SEGMENT:            0x80,\n    SECONDARY_ALIGNMENT:     0x100,\n    QC_FAIL:                 0x200,\n    DUPLICATE:               0x400,\n    SUPPLEMENTARY:           0x800\n};\n\nfunction CramFile() {\n}\n\n\n// Calculate the length (in bytes) of the CRAI ref starting at offset.\n// Returns {nbin, length, minBlockIndex}\nfunction _getCraiRefLength(uncba, offset) {\n    var p = offset;\n    var nbin = readInt(uncba, p); p += 4;\n    for (var b = 0; b < nbin; ++b) {\n        var bin = readInt(uncba, p);\n        var nchnk = readInt(uncba, p+4);\n        p += 8 + (nchnk * 16);\n    }\n    var nintv = readInt(uncba, p); p += 4;\n\n    var minBlockIndex = 1000000000;\n    var q = p;\n    for (var i = 0; i < nintv; ++i) {\n        var v = readVob(uncba, q); q += 8;\n        if (v) {\n            var bi = v.block;\n            if (v.offset > 0)\n                bi += 65536;\n\n            if (bi < minBlockIndex)\n                minBlockIndex = bi;\n            break;\n        }\n    }\n    p += (nintv * 8);\n\n    return {\n        minBlockIndex: minBlockIndex,\n        nbin: nbin,\n        length: p - offset\n    };\n}\n\n\nfunction makeCram(data, crai, indexChunks, callback, attempted) {\n    // Do an initial probe on the CRAM file to catch any mixed-content errors.\n    data.slice(0, 10).fetch(function(header) {\n        if (header) {\n            return makeCram2(data, crai, indexChunks, callback, attempted);\n        } else {\n            return callback(null, \"Couldn't access CRAM.\");\n        }\n    }, {timeout: 5000});\n}\n\nfunction makeCram2(data, crai, indexChunks, callback, attempted) {\n    var cram = new CramFile();\n    cram.data = data;\n    cram.crai = crai;\n    cram.indexChunks = indexChunks;\n\n    var minBlockIndex = cram.indexChunks ? cram.indexChunks.minBlockIndex : 1000000000;\n\n    // Fills out cram.chrToIndex and cram.indexToChr based on the first few bytes of the CRAM.\n    function parseCramHeader(r) {\n        if (!r) {\n            return callback(null, \"Couldn't access CRAM\");\n        }\n\n        var unc = unbgzf(r, r.byteLength);\n        var uncba = new Uint8Array(unc);\n\n        var magic = readInt(uncba, 0);\n        if (magic != CRAM_MAGIC) {\n            return callback(null, \"Not a CRAM file, magic=0x\" + magic.toString(16));\n        }\n        var headLen = readInt(uncba, 4);\n        var header = '';\n        for (var i = 0; i < headLen; ++i) {\n            header += String.fromCharCode(uncba[i + 8]);\n        }\n\n        var nRef = readInt(uncba, headLen + 8);\n        var p = headLen + 12;\n\n        cram.chrToIndex = {};\n        cram.indexToChr = [];\n        for (var i = 0; i < nRef; ++i) {\n            var lName = readInt(uncba, p);\n            var name = '';\n            for (var j = 0; j < lName-1; ++j) {\n                name += String.fromCharCode(uncba[p + 4 + j]);\n            }\n            var lRef = readInt(uncba, p + lName + 4);\n            cram.chrToIndex[name] = i;\n            if (name.indexOf('chr') == 0) {\n                cram.chrToIndex[name.substring(3)] = i;\n            } else {\n                cram.chrToIndex['chr' + name] = i;\n            }\n            cram.indexToChr.push(name);\n\n            p = p + 8 + lName;\n        }\n\n        if (cram.indices) {\n            return callback(cram);\n        }\n    }\n\n    function parseCrai(header) {\n        if (!header) {\n            return \"Couldn't access CRAI\";\n        }\n\n        var uncba = new Uint8Array(header);\n\n        var craiMagic = readInt(uncba, 0);\n        if (craiMagic != CRAI_MAGIC) {\n            return callback(null, 'Not a CRAI file, magic=0x' + craiMagic.toString(16));\n        }\n\n        var offset = 10;\n        var unc = jszlib.inflateBuffer(header,offset,header.byteLength - offset);\n        var s = ''\n        var resultBB = new Uint8Array(unc);\n        for (var i = 0; i < resultBB.length; ++i) {\n          s += String.fromCharCode(resultBB[i]);\n        }\n        console.log(s);\n\n        cram.indices = [];\n\n        var p = 8;\n        for (var ref = 0; ref < nref; ++ref) {\n            var blockStart = p;\n            var o = _getCraiRefLength(uncba, blockStart);\n            p += o.length;\n\n            minBlockIndex = Math.min(o.minBlockIndex, minBlockIndex);\n\n            var nbin = o.nbin;\n\n            if (nbin > 0) {\n                cram.indices[ref] = new Uint8Array(header, blockStart, p - blockStart);\n            }\n        }\n\n        return true;\n    }\n\n    if (!cram.indexChunks) {\n        cram.crai.fetch(function(header) {   // Do we really need to fetch the whole thing? :-(\n            var result = parseCrai(header);\n            if (result !== true) {\n                if (cram.crai.url && typeof(attempted) === \"undefined\") {\n                    // Already attempted x.cram.crai not there so now trying x.crai\n                    cram.crai.url = cram.data.url.replace(new RegExp('.cram$'), '.crai');\n                    \n                     // True lets us know we are making a second attempt\n                    makeCram2(data, cram.crai, indexChunks, callback, true);\n                }\n                else {\n                    // We've attempted x.cram.crai & x.crai and nothing worked\n                    callback(null, result);\n                }\n            } else {\n              cram.data.slice(0, minBlockIndex).fetch(parseCramHeader);\n            }\n        });   // Timeout on first request to catch Chrome mixed-content error.\n    } else {\n        var chunks = cram.indexChunks.chunks;\n        cram.indices = []\n        for (var i = 0; i < chunks.length; i++) {\n           cram.indices[i] = null;  // To be filled out lazily as needed\n        }\n        cram.data.slice(0, minBlockIndex).fetch(parseCramHeader);\n    }\n}\n\n\n\nCramFile.prototype.blocksForRange = function(refId, min, max) {\n    var index = this.indices[refId];\n    if (!index) {\n        return [];\n    }\n\n    var intBinsL = reg2bins(min, max);\n    var intBins = [];\n    for (var i = 0; i < intBinsL.length; ++i) {\n        intBins[intBinsL[i]] = true;\n    }\n    var leafChunks = [], otherChunks = [];\n\n    var nbin = readInt(index, 0);\n    var p = 4;\n    for (var b = 0; b < nbin; ++b) {\n        var bin = readInt(index, p);\n        var nchnk = readInt(index, p+4);\n//        dlog('bin=' + bin + '; nchnk=' + nchnk);\n        p += 8;\n        if (intBins[bin]) {\n            for (var c = 0; c < nchnk; ++c) {\n                var cs = readVob(index, p);\n                var ce = readVob(index, p + 8);\n                (bin < 4681 ? otherChunks : leafChunks).push(new Chunk(cs, ce));\n                p += 16;\n            }\n        } else {\n            p +=  (nchnk * 16);\n        }\n    }\n    // console.log('leafChunks = ' + JSON.stringify(leafChunks));\n    // console.log('otherChunks = ' + JSON.stringify(otherChunks));\n\n    var nintv = readInt(index, p);\n    // console.log('nintv=' + nintv);\n    var lowest = null;\n    var minLin = Math.min(min>>14, nintv - 1), maxLin = Math.min(max>>14, nintv - 1);\n    for (var i = minLin; i <= maxLin; ++i) {\n        var lb =  readVob(index, p + 4 + (i * 8));\n        if (!lb) {\n            continue;\n        }\n        if (!lowest || lb.block < lowest.block || (lb.block == lowest.block && lb.offset < lowest.offset)) {\n            lowest = lb;\n        }\n    }\n    // console.log('Lowest LB = ' + lowest);\n\n    var prunedOtherChunks = [];\n    if (lowest != null) {\n        for (var i = 0; i < otherChunks.length; ++i) {\n            var chnk = otherChunks[i];\n            if (chnk.maxv.block > lowest.block || (chnk.maxv.block == lowest.block && chnk.maxv.offset >= lowest.offset)) {\n                prunedOtherChunks.push(chnk);\n            }\n        }\n    }\n    // console.log('prunedOtherChunks = ' + JSON.stringify(prunedOtherChunks));\n    otherChunks = prunedOtherChunks;\n\n    var intChunks = [];\n    for (var i = 0; i < otherChunks.length; ++i) {\n        intChunks.push(otherChunks[i]);\n    }\n    for (var i = 0; i < leafChunks.length; ++i) {\n        intChunks.push(leafChunks[i]);\n    }\n\n    intChunks.sort(function(c0, c1) {\n        var dif = c0.minv.block - c1.minv.block;\n        if (dif != 0) {\n            return dif;\n        } else {\n            return c0.minv.offset - c1.minv.offset;\n        }\n    });\n    var mergedChunks = [];\n    if (intChunks.length > 0) {\n        var cur = intChunks[0];\n        for (var i = 1; i < intChunks.length; ++i) {\n            var nc = intChunks[i];\n            if (nc.minv.block == cur.maxv.block /* && nc.minv.offset == cur.maxv.offset */) { // no point splitting mid-block\n                cur = new Chunk(cur.minv, nc.maxv);\n            } else {\n                mergedChunks.push(cur);\n                cur = nc;\n            }\n        }\n        mergedChunks.push(cur);\n    }\n    // console.log('mergedChunks = ' + JSON.stringify(mergedChunks));\n\n    return mergedChunks;\n}\n\nCramFile.prototype.fetch = function(chr, min, max, callback, opts) {\n    var thisB = this;\n    opts = opts || {};\n\n    var chrId = this.chrToIndex[chr];\n    var chunks;\n    if (chrId === undefined) {\n        chunks = [];\n    } else {\n        // Fetch this portion of the CRAI if it hasn't been loaded yet.\n        if (this.indices[chrId] === null && this.indexChunks.chunks[chrId]) {\n            var start_stop = this.indexChunks.chunks[chrId];\n            return this.crai.slice(start_stop[0], start_stop[1]).fetch(function(data) {\n                var buffer = new Uint8Array(data);\n                this.indices[chrId] = buffer;\n                return this.fetch(chr, min, max, callback, opts);\n            }.bind(this));\n        }\n\n        chunks = this.blocksForRange(chrId, min, max);\n        if (!chunks) {\n            callback(null, 'Error in index fetch');\n        }\n    }\n    \n    var records = [];\n    var index = 0;\n    var data;\n\n    function tramp() {\n        if (index >= chunks.length) {\n            return callback(records);\n        } else if (!data) {\n            var c = chunks[index];\n            var fetchMin = c.minv.block;\n            var fetchMax = c.maxv.block + (1<<16); // *sigh*\n            // console.log('fetching ' + fetchMin + ':' + fetchMax);\n            thisB.data.slice(fetchMin, fetchMax - fetchMin).fetch(function(r) {\n                data = unbgzf(r, c.maxv.block - c.minv.block + 1);\n                return tramp();\n            });\n        } else {\n            var ba = new Uint8Array(data);\n            var finished = thisB.readCramRecords(ba, chunks[index].minv.offset, records, min, max, chrId, opts);\n            data = null;\n            ++index;\n            if (finished)\n                return callback(records);\n            else\n                return tramp();\n        }\n    }\n    tramp();\n}\n\nvar SEQRET_DECODER = ['=', 'A', 'C', 'x', 'G', 'x', 'x', 'x', 'T', 'x', 'x', 'x', 'x', 'x', 'x', 'N'];\nvar CIGAR_DECODER = ['M', 'I', 'D', 'N', 'S', 'H', 'P', '=', 'X', '?', '?', '?', '?', '?', '?', '?'];\n\nfunction CramRecord() {\n}\n\nCramFile.prototype.readCramRecords = function(ba, offset, sink, min, max, chrId, opts) {\n    while (true) {\n        var blockSize = readInt(ba, offset);\n        var blockEnd = offset + blockSize + 4;\n        if (blockEnd > ba.length) {\n            return false;\n        }\n\n        var record = new CramRecord();\n\n        var refID = readInt(ba, offset + 4);\n        var pos = readInt(ba, offset + 8);\n        \n        var bmn = readInt(ba, offset + 12);\n        var bin = (bmn & 0xffff0000) >> 16;\n        var mq = (bmn & 0xff00) >> 8;\n        var nl = bmn & 0xff;\n\n        var flag_nc = readInt(ba, offset + 16);\n        var flag = (flag_nc & 0xffff0000) >> 16;\n        var nc = flag_nc & 0xffff;\n    \n        var lseq = readInt(ba, offset + 20);\n        \n        var nextRef  = readInt(ba, offset + 24);\n        var nextPos = readInt(ba, offset + 28);\n        \n        var tlen = readInt(ba, offset + 32);\n    \n        record.segment = this.indexToChr[refID];\n        record.flag = flag;\n        record.pos = pos;\n        record.mq = mq;\n        if (opts.light)\n            record.seqLength = lseq;\n\n        if (!opts.light || opts.includeName) {\n            var readName = '';\n            for (var j = 0; j < nl-1; ++j) {\n                readName += String.fromCharCode(ba[offset + 36 + j]);\n            }\n            record.readName = readName;\n        }\n        \n        if (!opts.light) {\n            if (nextRef >= 0) {\n                record.nextSegment = this.indexToChr[nextRef];\n                record.nextPos = nextPos;\n            }\n        \n            var p = offset + 36 + nl;\n\n            var cigar = '';\n            for (var c = 0; c < nc; ++c) {\n                var cigop = readInt(ba, p);\n                cigar = cigar + (cigop>>4) + CIGAR_DECODER[cigop & 0xf];\n                p += 4;\n            }\n            record.cigar = cigar;\n        \n            var seq = '';\n            var seqBytes = (lseq + 1) >> 1;\n            for (var j = 0; j < seqBytes; ++j) {\n                var sb = ba[p + j];\n                seq += SEQRET_DECODER[(sb & 0xf0) >> 4];\n                if (seq.length < lseq)\n                    seq += SEQRET_DECODER[(sb & 0x0f)];\n            }\n            p += seqBytes;\n            record.seq = seq;\n\n            var qseq = '';\n            for (var j = 0; j < lseq; ++j) {\n                qseq += String.fromCharCode(ba[p + j] + 33);\n            }\n            p += lseq;\n            record.quals = qseq;\n\n            while (p < blockEnd) {\n                var tag = String.fromCharCode(ba[p], ba[p + 1]);\n                var type = String.fromCharCode(ba[p + 2]);\n                var value;\n\n                if (type == 'A') {\n                    value = String.fromCharCode(ba[p + 3]);\n                    p += 4;\n                } else if (type == 'i' || type == 'I') {\n                    value = readInt(ba, p + 3);\n                    p += 7;\n                } else if (type == 'c' || type == 'C') {\n                    value = ba[p + 3];\n                    p += 4;\n                } else if (type == 's' || type == 'S') {\n                    value = readShort(ba, p + 3);\n                    p += 5;\n                } else if (type == 'f') {\n                    value = readFloat(ba, p + 3);\n                    p += 7;\n                } else if (type == 'Z' || type == 'H') {\n                    p += 3;\n                    value = '';\n                    for (;;) {\n                        var cc = ba[p++];\n                        if (cc == 0) {\n                            break;\n                        } else {\n                            value += String.fromCharCode(cc);\n                        }\n                    }\n                } else if (type == 'B') {\n                    var atype = String.fromCharCode(ba[p + 3]);\n                    var alen = readInt(ba, p + 4);\n                    var elen;\n                    var reader;\n                    if (atype == 'i' || atype == 'I' || atype == 'f') {\n                        elen = 4;\n                        if (atype == 'f')\n                            reader = readFloat;\n                        else\n                            reader = readInt;\n                    } else if (atype == 's' || atype == 'S') {\n                        elen = 2;\n                        reader = readShort;\n                    } else if (atype == 'c' || atype == 'C') {\n                        elen = 1;\n                        reader = readByte;\n                    } else {\n                        throw 'Unknown array type ' + atype;\n                    }\n\n                    p += 8;\n                    value = [];\n                    for (var i = 0; i < alen; ++i) {\n                        value.push(reader(ba, p));\n                        p += elen;\n                    }\n                } else {\n                    throw 'Unknown type '+ type;\n                }\n                record[tag] = value;\n            }\n        }\n\n        if (!min || record.pos <= max && record.pos + lseq >= min) {\n            if (chrId === undefined || refID == chrId) {\n                sink.push(record);\n            }\n        }\n        if (record.pos > max) {\n            return true;\n        }\n        offset = blockEnd;\n    }\n\n    // Exits via top of loop.\n};\n\nif (typeof(module) !== 'undefined') {\n    module.exports = {\n        makeCram: makeCram,\n        CRAM_MAGIC: CRAM_MAGIC,\n        CRAI_MAGIC: CRAI_MAGIC,\n        CramFlags: CramFlags\n    };\n}\n","/* -*- mode: javascript; c-basic-offset: 4; indent-tabs-mode: nil -*- */\n\n// \n// Dalliance Genome Explorer\n// (c) Thomas Down 2006-2010\n//\n// das.js: queries and low-level data model.\n//\n\n\"use strict\";\n\nif (typeof(require) !== 'undefined') {\n    var utils = require('./utils');\n    var shallowCopy = utils.shallowCopy;\n    var pusho = utils.pusho;\n\n    var color = require('./color');\n    var makeColourSteps = color.makeColourSteps;\n}\n\nvar dasLibErrorHandler = function(errMsg) {\n    alert(errMsg);\n}\nvar dasLibRequestQueue = new Array();\n\nfunction DASSegment(name, start, end, description) {\n    this.name = name;\n    this.start = start;\n    this.end = end;\n    this.description = description;\n}\nDASSegment.prototype.toString = function() {\n    return this.name + ':' + this.start + '..' + this.end;\n};\nDASSegment.prototype.isBounded = function() {\n    return this.start && this.end;\n}\nDASSegment.prototype.toDASQuery = function() {\n    var q = 'segment=' + this.name;\n    if (this.start && this.end) {\n        q += (':' + this.start + ',' + this.end);\n    }\n    return q;\n}\n\n\nfunction DASSource(a1, a2) {\n    var options;\n    if (typeof a1 == 'string') {\n        this.uri = a1;\n        options = a2 || {};\n    } else {\n        options = a1 || {};\n    }\n    for (var k in options) {\n        this[k] = options[k];\n    }\n\n    if (!this.coords) {\n        this.coords = [];\n    }\n    if (!this.props) {\n        this.props = {};\n    }\n\n    this.dasBaseURI = this.uri;\n    if (this.dasBaseURI && this.dasBaseURI.substr(this.uri.length - 1) != '/') {\n        this.dasBaseURI = this.dasBaseURI + '/';\n    }\n}\n\nDASSource.prototype.getURI = function(uri) {\n    if (this.resolver) {\n        return this.resolver(uri).then(function (urlOrObj) {\n            if (typeof urlOrObj === 'string') {\n                return urlOrObj;\n            } else {\n                return urlOrObj.url;\n            }\n        });\n    } else {\n        return Promise.resolve(uri);\n    }\n}\n\nfunction DASCoords() {\n}\n\nfunction coordsMatch(c1, c2) {\n    return c1.taxon == c2.taxon && c1.auth == c2.auth && c1.version == c2.version;\n}\n\n//\n// DAS 1.6 entry_points command\n//\n\nDASSource.prototype.entryPoints = function(callback) {\n    var dasURI = this.dasBaseURI + 'entry_points';\n    this.doCrossDomainRequest(dasURI, function(responseXML) {\n            if (!responseXML) {\n                return callback([]);\n            }\n\n                var entryPoints = new Array();\n                \n                var segs = responseXML.getElementsByTagName('SEGMENT');\n                for (var i = 0; i < segs.length; ++i) {\n                    var seg = segs[i];\n                    var segId = seg.getAttribute('id');\n                    \n                    var segSize = seg.getAttribute('size');\n                    var segMin, segMax;\n                    if (segSize) {\n                        segMin = 1; segMax = segSize|0;\n                    } else {\n                        segMin = seg.getAttribute('start');\n                        if (segMin) {\n                            segMin |= 0;\n                        }\n                        segMax = seg.getAttribute('stop');\n                        if (segMax) {\n                            segMax |= 0;\n                        }\n                    }\n                    var segDesc = null;\n                    if (seg.firstChild) {\n                        segDesc = seg.firstChild.nodeValue;\n                    }\n                    entryPoints.push(new DASSegment(segId, segMin, segMax, segDesc));\n                }          \n               callback(entryPoints);\n    });         \n}\n\n//\n// DAS 1.6 sequence command\n// Do we need an option to fall back to the dna command?\n//\n\nfunction DASSequence(name, start, end, alpha, seq) {\n    this.name = name;\n    this.start = start;\n    this.end = end;\n    this.alphabet = alpha;\n    this.seq = seq;\n}\n\nDASSource.prototype.sequence = function(segment, callback) {\n    var dasURI = this.dasBaseURI + 'sequence?' + segment.toDASQuery();\n    this.doCrossDomainRequest(dasURI, function(responseXML) {\n        if (!responseXML) {\n            callback([]);\n            return;\n        } else {\n                var seqs = new Array();\n                \n                var segs = responseXML.getElementsByTagName('SEQUENCE');\n                for (var i = 0; i < segs.length; ++i) {\n                    var seg = segs[i];\n                    var segId = seg.getAttribute('id');\n                    var segMin = seg.getAttribute('start');\n                    var segMax = seg.getAttribute('stop');\n                    var segAlpha = 'DNA';\n                    var segSeq = null;\n                    if (seg.firstChild) {\n                        var rawSeq = seg.firstChild.nodeValue;\n                        segSeq = '';\n                        var idx = 0;\n                        while (true) {\n                            var space = rawSeq.indexOf('\\n', idx);\n                            if (space >= 0) {\n                                segSeq += rawSeq.substring(idx, space).toUpperCase();\n                                idx = space + 1;\n                            } else {\n                                segSeq += rawSeq.substring(idx).toUpperCase();\n                                break;\n                            }\n                        }\n                    }\n                    seqs.push(new DASSequence(segId, segMin, segMax, segAlpha, segSeq));\n                }\n                \n                callback(seqs);\n        }\n    });\n}\n\n//\n// DAS 1.6 features command\n//\n\nfunction DASFeature() {\n}\n\nfunction DASGroup(id) {\n    if (id)\n        this.id = id;\n}\n\nfunction DASLink(desc, uri) {\n    this.desc = desc;\n    this.uri = uri;\n}\n\nDASSource.prototype.features = function(segment, options, callback) {\n    options = options || {};\n    var thisB = this;\n\n    var dasURI;\n    if (this.features_uri) {\n        dasURI = this.features_uri;\n    } else {\n        var filters = [];\n\n        if (segment) {\n            filters.push(segment.toDASQuery());\n        } else if (options.group) {\n            var g = options.group;\n            if (typeof g == 'string') {\n                filters.push('group_id=' + g);\n            } else {\n                for (var gi = 0; gi < g.length; ++gi) {\n                    filters.push('group_id=' + g[gi]);\n                }\n            }\n        }\n\n        if (options.adjacent) {\n            var adj = options.adjacent;\n            if (typeof adj == 'string') {\n                adj = [adj];\n            }\n            for (var ai = 0; ai < adj.length; ++ai) {\n                filters.push('adjacent=' + adj[ai]);\n            }\n        }\n\n        if (options.type) {\n            if (typeof options.type == 'string') {\n                filters.push('type=' + options.type);\n            } else {\n                for (var ti = 0; ti < options.type.length; ++ti) {\n                    filters.push('type=' + options.type[ti]);\n                }\n            }\n        }\n        \n        if (options.maxbins) {\n            filters.push('maxbins=' + options.maxbins);\n        }\n        \n        if (filters.length > 0) {\n            dasURI = this.dasBaseURI + 'features?' + filters.join(';');\n        } else {\n            callback([], 'No filters specified');\n        }\n    } \n   \n\n    this.doCrossDomainRequest(dasURI, function(responseXML, req) {\n        if (!responseXML) {\n            var msg;\n            if (req.status == 0) {\n                msg = 'server may not support CORS';\n            } else {\n                msg = 'status=' + req.status;\n            }\n            callback([], 'Failed request: ' + msg);\n            return;\n        }\n/*      if (req) {\n            var caps = req.getResponseHeader('X-DAS-Capabilties');\n            if (caps) {\n                alert(caps);\n            }\n        } */\n\n        var features = new Array();\n        var segmentMap = {};\n\n        var segs = responseXML.getElementsByTagName('SEGMENT');\n        for (var si = 0; si < segs.length; ++si) {\n            var segmentXML = segs[si];\n            var segmentID = segmentXML.getAttribute('id');\n            segmentMap[segmentID] = {\n                min: segmentXML.getAttribute('start'),\n                max: segmentXML.getAttribute('stop')\n            };\n            \n            var featureXMLs = segmentXML.getElementsByTagName('FEATURE');\n            for (var i = 0; i < featureXMLs.length; ++i) {\n                var feature = featureXMLs[i];\n                var dasFeature = new DASFeature();\n                \n                dasFeature.segment = segmentID;\n                dasFeature.id = feature.getAttribute('id');\n                dasFeature.label = feature.getAttribute('label');\n\n\n/*\n                var childNodes = feature.childNodes;\n                for (var c = 0; c < childNodes.length; ++c) {\n                    var cn = childNodes[c];\n                    if (cn.nodeType == Node.ELEMENT_NODE) {\n                        var key = cn.tagName;\n                        //var val = null;\n                        //if (cn.firstChild) {\n                        //   val = cn.firstChild.nodeValue;\n                        //}\n                        dasFeature[key] = 'x';\n                    }\n                } */\n\n\n                var spos = elementValue(feature, \"START\");\n                var epos = elementValue(feature, \"END\");\n                if ((spos|0) > (epos|0)) {\n                    dasFeature.min = epos|0;\n                    dasFeature.max = spos|0;\n                } else {\n                    dasFeature.min = spos|0;\n                    dasFeature.max = epos|0;\n                }\n                {\n                    var tec = feature.getElementsByTagName('TYPE');\n                    if (tec.length > 0) {\n                        var te = tec[0];\n                        if (te.firstChild) {\n                            dasFeature.type = te.firstChild.nodeValue;\n                        }\n                        dasFeature.typeId = te.getAttribute('id');\n                        dasFeature.typeCv = te.getAttribute('cvId');\n                    }\n                }\n                dasFeature.type = elementValue(feature, \"TYPE\");\n                if (!dasFeature.type && dasFeature.typeId) {\n                    dasFeature.type = dasFeature.typeId; // FIXME?\n                }\n                \n                dasFeature.method = elementValue(feature, \"METHOD\");\n                {\n                    var ori = elementValue(feature, \"ORIENTATION\");\n                    if (!ori) {\n                        ori = '0';\n                    }\n                    dasFeature.orientation = ori;\n                }\n                dasFeature.score = elementValue(feature, \"SCORE\");\n                dasFeature.links = dasLinksOf(feature);\n                dasFeature.notes = dasNotesOf(feature);\n                \n                var groups = feature.getElementsByTagName(\"GROUP\");\n                for (var gi  = 0; gi < groups.length; ++gi) {\n                    var groupXML = groups[gi];\n                    var dasGroup = new DASGroup();\n                    dasGroup.type = groupXML.getAttribute('type');\n                    dasGroup.id = groupXML.getAttribute('id');\n                    dasGroup.links = dasLinksOf(groupXML);\n                    dasGroup.notes = dasNotesOf(groupXML);\n                    if (!dasFeature.groups) {\n                        dasFeature.groups = new Array(dasGroup);\n                    } else {\n                        dasFeature.groups.push(dasGroup);\n                    }\n                }\n\n                // Magic notes.  Check with TAD before changing this.\n                if (dasFeature.notes) {\n                    for (var ni = 0; ni < dasFeature.notes.length; ++ni) {\n                        var n = dasFeature.notes[ni];\n                        if (n.indexOf('Genename=') == 0) {\n                            var gg = new DASGroup();\n                            gg.type='gene';\n                            gg.id = n.substring(9);\n                            if (!dasFeature.groups) {\n                                dasFeature.groups = new Array(gg);\n                            } else {\n                                dasFeature.groups.push(gg);\n                            }\n                        }\n                    }\n                }\n                \n                {\n                    var pec = feature.getElementsByTagName('PART');\n                    if (pec.length > 0) {\n                        var parts = [];\n                        for (var pi = 0; pi < pec.length; ++pi) {\n                            parts.push(pec[pi].getAttribute('id'));\n                        }\n                        dasFeature.parts = parts;\n                    }\n                }\n                {\n                    var pec = feature.getElementsByTagName('PARENT');\n                    if (pec.length > 0) {\n                        var parents = [];\n                        for (var pi = 0; pi < pec.length; ++pi) {\n                            parents.push(pec[pi].getAttribute('id'));\n                        }\n                        dasFeature.parents = parents;\n                    }\n                }\n                \n                features.push(dasFeature);\n            }\n        }\n                \n        callback(features, undefined, segmentMap);\n    },\n    function (err) {\n        callback([], err);\n    });\n}\n\nfunction DASAlignment(type) {\n    this.type = type;\n    this.objects = {};\n    this.blocks = [];\n}\n\nDASSource.prototype.alignments = function(segment, options, callback) {\n    var dasURI = this.dasBaseURI + 'alignment?query=' + segment;\n    this.doCrossDomainRequest(dasURI, function(responseXML) {\n        if (!responseXML) {\n            callback([], 'Failed request ' + dasURI);\n            return;\n        }\n\n        var alignments = [];\n        var aliXMLs = responseXML.getElementsByTagName('alignment');\n        for (var ai = 0; ai < aliXMLs.length; ++ai) {\n            var aliXML = aliXMLs[ai];\n            var ali = new DASAlignment(aliXML.getAttribute('alignType'));\n            var objXMLs = aliXML.getElementsByTagName('alignObject');\n            for (var oi = 0; oi < objXMLs.length; ++oi) {\n                var objXML = objXMLs[oi];\n                var obj = {\n                    id:          objXML.getAttribute('intObjectId'),\n                    accession:   objXML.getAttribute('dbAccessionId'),\n                    version:     objXML.getAttribute('objectVersion'),\n                    dbSource:    objXML.getAttribute('dbSource'),\n                    dbVersion:   objXML.getAttribute('dbVersion')\n                };\n                ali.objects[obj.id] = obj;\n            }\n            \n            var blockXMLs = aliXML.getElementsByTagName('block');\n            for (var bi = 0; bi < blockXMLs.length; ++bi) {\n                var blockXML = blockXMLs[bi];\n                var block = {\n                    order:      blockXML.getAttribute('blockOrder'),\n                    segments:   []\n                };\n                var segXMLs = blockXML.getElementsByTagName('segment');\n                for (var si = 0; si < segXMLs.length; ++si) {\n                    var segXML = segXMLs[si];\n                    var seg = {\n                        object:      segXML.getAttribute('intObjectId'),\n                        min:         segXML.getAttribute('start'),\n                        max:         segXML.getAttribute('end'),\n                        strand:      segXML.getAttribute('strand'),\n                        cigar:       elementValue(segXML, 'cigar')\n                    };\n                    block.segments.push(seg);\n                }\n                ali.blocks.push(block);\n            }       \n                    \n            alignments.push(ali);\n        }\n        callback(alignments);\n    });\n}\n\n\nfunction DASStylesheet() {\n    this.styles = [];\n}\n\nDASStylesheet.prototype.pushStyle = function(filters, zoom, style) {\n    if (!filters) {\n        filters = {type: 'default'};\n    }\n    var styleHolder = shallowCopy(filters);\n    if (zoom) {\n        styleHolder.zoom = zoom;\n    }\n    styleHolder.style = style;\n    this.styles.push(styleHolder);\n}\n\nfunction DASStyle() {\n}\n\nfunction parseGradient(grad) {\n    var steps = grad.getAttribute('steps');\n    if (steps) {\n        steps = steps|0;\n    } else {\n        steps = 50;\n    }\n\n    var stops = [];\n    var colors = [];\n    var se = grad.getElementsByTagName('STOP');\n    for (var si = 0; si < se.length; ++si) {\n        var stop = se[si];\n        stops.push(1.0 * stop.getAttribute('score'));\n        colors.push(stop.firstChild.nodeValue);\n    }\n\n    return makeColourSteps(steps, stops, colors);\n}\n\nDASSource.prototype.stylesheet = function(successCB, failureCB) {\n    var dasURI, creds = this.credentials;\n    if (this.stylesheet_uri) {\n        dasURI = this.stylesheet_uri;\n        creds = false;\n    } else {\n        dasURI = this.dasBaseURI + 'stylesheet';\n    }\n\n    this.getURI(dasURI).then(function(dasURI) {\n        doCrossDomainRequest(dasURI, function(responseXML) {\n            if (!responseXML) {\n                if (failureCB) {\n                    failureCB();\n                } \n                return;\n            }\n            var stylesheet = new DASStylesheet();\n            var typeXMLs = responseXML.getElementsByTagName('TYPE');\n            for (var i = 0; i < typeXMLs.length; ++i) {\n                var typeStyle = typeXMLs[i];\n            \n                var filter = {};\n                filter.type = typeStyle.getAttribute('id'); // Am I right in thinking that this makes DASSTYLE XML invalid?  Ugh.\n                filter.label = typeStyle.getAttribute('label');\n                filter.method = typeStyle.getAttribute('method');\n                var glyphXMLs = typeStyle.getElementsByTagName('GLYPH');\n                for (var gi = 0; gi < glyphXMLs.length; ++gi) {\n                    var glyphXML = glyphXMLs[gi];\n                    var zoom = glyphXML.getAttribute('zoom');\n                    var glyph = childElementOf(glyphXML);\n                    var style = new DASStyle();\n                    style.glyph = glyph.localName;\n                    var child = glyph.firstChild;\n                    \n                    while (child) {\n                        if (child.nodeType == Node.ELEMENT_NODE) {\n                            if (child.localName == 'BGGRAD') {\n                                style[child.localName] = parseGradient(child);\n                            } else {      \n                                style[child.localName] = child.firstChild.nodeValue;\n                            }\n                        }\n                        child = child.nextSibling;\n                    }\n                    stylesheet.pushStyle(filter, zoom, style);\n                }\n            }\n            successCB(stylesheet);\n        }, creds);\n    }).catch(function(err) {\n        console.log(err);\n        failureCB();\n    });\n}\n\n//\n// sources command\n// \n\nfunction DASRegistry(uri, opts)\n{\n    opts = opts || {};\n    this.uri = uri;\n    this.opts = opts;   \n}\n\nDASRegistry.prototype.sources = function(callback, failure, opts)\n{\n    if (!opts) {\n        opts = {};\n    }\n\n    var filters = [];\n    if (opts.taxon) {\n        filters.push('organism=' + opts.taxon);\n    }\n    if (opts.auth) {\n        filters.push('authority=' + opts.auth);\n    }\n    if (opts.version) {\n        filters.push('version=' + opts.version);\n    }\n    var quri = this.uri;\n    if (filters.length > 0) {\n        quri = quri + '?' + filters.join('&');   // '&' as a separator to hack around dasregistry.org bug.\n    }\n\n    doCrossDomainRequest(quri, function(responseXML) {\n        if (!responseXML && failure) {\n            failure();\n            return;\n        }\n\n        var sources = [];       \n        var sourceXMLs = responseXML.getElementsByTagName('SOURCE');\n        for (var si = 0; si < sourceXMLs.length; ++si) {\n            var sourceXML = sourceXMLs[si];\n            var versionXMLs = sourceXML.getElementsByTagName('VERSION');\n            if (versionXMLs.length < 1) {\n                continue;\n            }\n            var versionXML = versionXMLs[0];\n\n            var coordXMLs = versionXML.getElementsByTagName('COORDINATES');\n            var coords = [];\n            for (var ci = 0; ci < coordXMLs.length; ++ci) {\n                var coordXML = coordXMLs[ci];\n                var coord = new DASCoords();\n                coord.auth = coordXML.getAttribute('authority');\n                coord.taxon = coordXML.getAttribute('taxid');\n                coord.version = coordXML.getAttribute('version');\n                coords.push(coord);\n            }\n            \n            var caps = [];\n            var capXMLs = versionXML.getElementsByTagName('CAPABILITY');\n            var uri;\n            for (var ci = 0; ci < capXMLs.length; ++ci) {\n                var capXML = capXMLs[ci];\n                \n                caps.push(capXML.getAttribute('type'));\n\n                if (capXML.getAttribute('type') == 'das1:features') {\n                    var fep = capXML.getAttribute('query_uri');\n                    uri = fep.substring(0, fep.length - ('features'.length));\n                }\n            }\n\n            var props = {};\n            var propXMLs = versionXML.getElementsByTagName('PROP');\n            for (var pi = 0; pi < propXMLs.length; ++pi) {\n                pusho(props, propXMLs[pi].getAttribute('name'), propXMLs[pi].getAttribute('value'));\n            }\n            \n            if (uri) {\n                var source = new DASSource(uri, {\n                    source_uri: sourceXML.getAttribute('uri'),\n                    name:  sourceXML.getAttribute('title'),\n                    desc:  sourceXML.getAttribute('description'),\n                    coords: coords,\n                    props: props,\n                    capabilities: caps\n                });\n                sources.push(source);\n            }\n        }\n        \n        callback(sources);\n    });\n}\n\n\n//\n// Utility functions\n//\n\nfunction elementValue(element, tag)\n{\n    var children = element.getElementsByTagName(tag);\n    if (children.length > 0 && children[0].firstChild) {\n        var c = children[0];\n        if (c.childNodes.length == 1) {\n            return c.firstChild.nodeValue;\n        } else {\n            var s = '';\n            for (var ni = 0; ni < c.childNodes.length; ++ni) {\n                s += c.childNodes[ni].nodeValue;\n            }\n            return s;\n        }\n\n    } else {\n        return null;\n    }\n}\n\nfunction childElementOf(element)\n{\n    if (element.hasChildNodes()) {\n        var child = element.firstChild;\n        do {\n            if (child.nodeType == Node.ELEMENT_NODE) {\n                return child;\n            } \n            child = child.nextSibling;\n        } while (child != null);\n    }\n    return null;\n}\n\n\nfunction dasLinksOf(element)\n{\n    var links = new Array();\n    var maybeLinkChilden = element.getElementsByTagName('LINK');\n    for (var ci = 0; ci < maybeLinkChilden.length; ++ci) {\n        var linkXML = maybeLinkChilden[ci];\n        if (linkXML.parentNode == element) {\n            links.push(new DASLink(linkXML.firstChild ? linkXML.firstChild.nodeValue : 'Unknown', linkXML.getAttribute('href')));\n        }\n    }\n    \n    return links;\n}\n\nfunction dasNotesOf(element)\n{\n    var notes = [];\n    var maybeNotes = element.getElementsByTagName('NOTE');\n    for (var ni = 0; ni < maybeNotes.length; ++ni) {\n        if (maybeNotes[ni].firstChild) {\n            notes.push(maybeNotes[ni].firstChild.nodeValue);\n        }\n    }\n    return notes;\n}\n\nfunction doCrossDomainRequest(url, handler, credentials, custAuth) {\n    // TODO: explicit error handlers?\n\n    if (window.XDomainRequest) {\n        var req = new XDomainRequest();\n        req.onload = function() {\n            var dom = new ActiveXObject(\"Microsoft.XMLDOM\");\n            dom.async = false;\n            dom.loadXML(req.responseText);\n            handler(dom);\n        }\n        req.open(\"get\", url);\n        req.send();\n    } else {\n        try {\n            var req = new XMLHttpRequest();\n            var timeout = setTimeout(\n                function() {\n                    console.log('timing out '  + url);\n                    req.abort();\n                    handler(null, req);\n                },\n                5000\n            );\n\n            req.ontimeout = function() {\n                console.log('timeout on ' + url);\n            };\n\n            req.onreadystatechange = function() {\n                if (req.readyState == 4) {\n                    clearTimeout(timeout);\n                    if (req.status >= 200 || req.status == 0) {\n                        handler(req.responseXML, req);\n                    }\n                }\n            };\n            req.open(\"get\", url, true);\n            // IE10/11 fix: The timeout property may be set only in the time interval between a call to the open method\n            //              and the first call to the send method.\n            req.timeout = 5000;\n            if (credentials) {\n                req.withCredentials = true;\n            }\n            if (custAuth) {\n                req.setRequestHeader('X-DAS-Authorisation', custAuth);\n            }\n            req.overrideMimeType('text/xml');\n            req.setRequestHeader('Accept', 'application/xml,*/*');\n            req.send();\n        } catch (e) {\n            handler(null, req, e);\n        }\n    }\n}\n\nDASSource.prototype.doCrossDomainRequest = function(url, handler, errHandler) {\n    var custAuth;\n    if (this.xUser) {\n        custAuth = 'Basic ' + btoa(this.xUser + ':' + this.xPass);\n    }\n\n    try {\n        return doCrossDomainRequest(url, handler, this.credentials, custAuth);\n    } catch (err) {\n        if (errHandler) {\n            errHandler(err);\n        } else {\n            throw err;\n        }\n    }\n}\n\nfunction isDasBooleanTrue(s) {\n    s = ('' + s).toLowerCase();\n    return s==='yes' || s==='true';\n}\n\nfunction isDasBooleanNotFalse(s) {\n    if (!s)\n        return false;\n\n    s = ('' + s).toLowerCase();\n    return s!=='no' || s!=='false';\n}\n\nfunction copyStylesheet(ss) {\n    var nss = shallowCopy(ss);\n    nss.styles = [];\n    for (var si = 0; si < ss.styles.length; ++si) {\n        var sh = nss.styles[si] = shallowCopy(ss.styles[si]);\n        sh._methodRE = sh._labelRE = sh._typeRE = undefined;\n        sh.style = shallowCopy(sh.style);\n        sh.style.id = undefined;\n        sh.style._gradient = undefined;\n    }\n    return nss;\n}\n\nif (typeof(module) !== 'undefined') {\n    module.exports = {\n        DASGroup: DASGroup,\n        DASFeature: DASFeature,\n        DASStylesheet: DASStylesheet,\n        DASStyle: DASStyle,\n        DASSource: DASSource,\n        DASSegment: DASSegment,\n        DASRegistry: DASRegistry,\n        DASSequence: DASSequence,\n        DASLink: DASLink,\n\n        isDasBooleanTrue: isDasBooleanTrue,\n        isDasBooleanNotFalse: isDasBooleanNotFalse,\n        copyStylesheet: copyStylesheet,\n        coordsMatch: coordsMatch\n    };\n}\n","/* jshint esversion: 6 */\n\"use strict\";\n\nimport { SubTier } from \"./feature-draw.js\";\n\nimport { drawSeqTier } from \"./sequence-draw.js\";\n\n\nimport { Range, union } from \"./spans.js\";\n\nimport { shallowCopy, pusho } from \"./utils.js\";\n\n\nimport * as Glyphs from \"./glyphs.js\";\n\nimport { isDasBooleanTrue,\n         isDasBooleanNotFalse,\n         DASFeature } from \"./das.js\";\n\nimport { makeGradient } from \"./color.js\";\n\nimport { parseCigar } from \"./cigar.js\";\n\nimport { formatQuantLabel } from \"./numformats\";\n\nimport * as R from \"ramda\";\n\n// The only functions that must be exported by a renderer are renderTier\n// and drawTier, the rest are exported for use in other renderers.\nexport { renderTier,\n         drawTier,\n         prepareSubtiers,\n         prepareViewport,\n         paint,\n         drawUnmapped,\n         clearViewport,\n         createQuantOverlay,\n         paintQuant\n       };\n\nfunction renderTier(status, tier) {\n    drawTier(tier);\n    tier.updateStatus(status);\n}\n\nfunction drawTier(tier) {\n    let canvas = tier.viewport.getContext(\"2d\");\n    let retina = tier.browser.retina && window.devicePixelRatio > 1;\n\n    if (tier.sequenceSource) {\n        let sequence = tier.currentSequence;\n        drawSeqTier(tier, sequence);\n    } else if (tier.currentFeatures) {\n        prepareSubtiers(tier, canvas);\n    } else {\n        console.log(\"No sequence or features in tier!\");\n    }\n\n    if (tier.subtiers) {\n        let vOffset = R.defaultTo(0, tier.dasSource.vOffset);\n\n        prepareViewport(tier, canvas, retina, true, vOffset);   // NB calls canvas.save\n        paint(tier, canvas, vOffset);\n        canvas.restore();\n    }\n\n    tier.drawOverlay();\n    tier.paintQuant();\n\n    if (typeof(tier.dasSource.drawCallback) === \"function\") {\n        tier.dasSource.drawCallback(canvas, tier);\n    }\n\n    tier.originHaxx = 0;\n    tier.browser.arrangeTiers();\n}\n\nfunction glyphsForGroup(canvas, features, y, groupElement, tier) {\n    let gstyle = tier.styleForFeature(groupElement);\n    let label;\n    let labelWanted = false;\n\n    let glyphs = [];\n    let strand = null;\n\n    features.forEach(f => {\n        if (f.orientation && strand === null) {\n            strand = f.orientation;\n        }\n\n        if (!label && f.label) {\n            label = f.label;\n        }\n\n        let style = tier.styleForFeature(f);\n        if (style && !f.parts) {\n            if (isDasBooleanTrue(style.LABEL))\n                labelWanted = true;\n\n            let glyph = glyphForFeature(canvas, f, y, style, tier, null, true);\n            if (glyph)\n                glyphs.push(glyph);\n        }\n    });\n\n    if (glyphs.length === 0)\n        return null;\n\n    let connector = 'flat';\n    if (gstyle && gstyle.glyph === 'LINE') {\n        // Stick with flat...\n    } else {\n        if (tier.dasSource.collapseSuperGroups && !tier.bumped) {\n            if (strand === '+' || strand === '-') {\n                connector = 'collapsed' + strand;\n            }\n        } else {\n            if (strand === '+' || strand === '-') {\n                connector = 'hat' + strand;\n            }\n        }\n    }\n\n    let labelText = null;\n    if ((label && labelWanted) ||\n        (gstyle && (isDasBooleanTrue(gstyle.LABEL) ||\n                    isDasBooleanTrue(gstyle.LABELS)))) {  // HACK, LABELS should work.\n        labelText = groupElement.label || label;\n    }\n\n    glyphs.sort((g1, g2) => (g1.zindex || 0) - (g2.zindex || 0));\n\n    let groupGlyph = new Glyphs.GroupGlyph(glyphs, connector);\n    if (labelText) {\n        if (strand === '+') {\n            labelText = '>' + labelText;\n        } else if (strand === '-') {\n            labelText = '<' + labelText;\n        }\n        groupGlyph = new Glyphs.LabelledGlyph(canvas, groupGlyph, labelText, false);\n    }\n    groupGlyph.bump = true;\n    return groupGlyph;\n}\n\nfunction glyphForFeature(canvas, feature, y, style, tier, forceHeight, noLabel) {\n    let scale = tier.browser.scale;\n    let origin = tier.browser.viewStart;\n    let glyphType = style.glyph || 'BOX';\n\n    let min = feature.min;\n    let max = feature.max;\n    let strand = feature.orientation;\n    let score = feature.score;\n    let label = feature.label || feature.id;\n\n    // Hide glyphs that are smaller than a pixel in width.\n    if (tier.dasSource.hideSubpixelGlyphs && (max - min) * scale < 1) return null;\n\n    let minPos = (min - origin) * scale;\n    let rawMaxPos = ((max - origin + 1) * scale);\n    let maxPos = Math.max(rawMaxPos, minPos + 1);\n\n    forceHeight = forceHeight * 1.0;\n    let height = (tier.forceHeight || style.HEIGHT || forceHeight || 12) * 1.0;\n    height = height * 1.0;\n    let bump = style.BUMP && isDasBooleanTrue(style.BUMP);\n\n    let glyph;\n    let quant;\n\n    // Create the glyph\n    if (glyphType === 'CROSS' ||\n        glyphType === 'EX' ||\n        glyphType === 'TRIANGLE' ||\n        glyphType === 'DOT' ||\n        glyphType === 'SQUARE' ||\n        glyphType === 'STAR' ||\n        glyphType === 'PLIMSOLL') {\n        const glyphHolder = featureToCrossLikeGlyph(canvas, tier, feature, y,\n                                                 glyphType, style, forceHeight, noLabel);\n        if (glyphHolder) {                                                 \n            [glyph, quant] = glyphHolder;\n        }\n    } else if (glyphType === 'HISTOGRAM' || glyphType === 'GRADIENT' && score !== 'undefined') {\n        [glyph, quant] = featureToGradientLikeGlyph(canvas, tier, feature, y, glyphType, style, forceHeight);\n\n    } else if (glyphType === 'HIDDEN') {\n        glyph = new Glyphs.PaddedGlyph(null, minPos, maxPos);\n        noLabel = true;\n\n    } else if (glyphType === 'ARROW') {\n        let color = style.FGCOLOR || 'purple';\n        let parallel = isDasBooleanTrue(style.PARALLEL);\n        let sw = isDasBooleanTrue(style.SOUTHWEST);\n        let ne = isDasBooleanTrue(style.NORTHEAST);\n        glyph = new Glyphs.ArrowGlyph(minPos, maxPos, height, color, parallel, sw, ne);\n\n    } else if (glyphType === 'ANCHORED_ARROW') {\n        let stroke = style.FGCOLOR || 'none';\n        let fill = style.BGCOLOR || 'green';\n        glyph = new Glyphs.AArrowGlyph(minPos, maxPos, height, fill, stroke, strand);\n        glyph.bump = true;\n\n    } else if (glyphType === 'SPAN') {\n        let stroke = style.FGCOLOR || 'black';\n        glyph = new Glyphs.SpanGlyph(minPos, maxPos, height, stroke);\n\n    } else if (glyphType === 'LINE') {\n        let stroke = style.FGCOLOR || 'black';\n        let lineStyle = style.STYLE || 'solid';\n        glyph = new Glyphs.LineGlyph(minPos, maxPos, height, lineStyle, strand, stroke);\n\n    } else if (glyphType === 'PRIMERS') {\n        let stroke = style.FGCOLOR || 'black';\n        let fill = style.BGCOLOR || 'red';\n        glyph = new Glyphs.PrimersGlyph(minPos, maxPos, height, fill, stroke);\n\n    } else if (glyphType === 'TEXT') {\n        let string = style.STRING || 'text';\n        let fill = style.FGCOLOR || 'black';\n        glyph = new Glyphs.TextGlyph(canvas, minPos, maxPos, height, fill, string);\n\n    } else if (glyphType === 'TOOMANY') {\n        let stroke = style.FGCOLOR || 'gray';\n        let fill = style.BGCOLOR || 'orange';\n        glyph = new Glyphs.TooManyGlyph(minPos, maxPos, height, fill, stroke);\n\n    } else if (glyphType === 'POINT') {\n        [glyph, quant] = featureToPointGlyph(tier, feature, style);\n\n    } else if (glyphType === '__SEQUENCE') {\n        glyph = sequenceGlyph(canvas, tier, feature, style, forceHeight);\n\n    } else if (glyphType === '__INSERTION') {\n        let insertionLabels = true;\n        if (style.__INSERTIONS !== undefined)\n            insertionLabels = isDasBooleanNotFalse(style.__INSERTIONS)\n        glyph = new Glyphs.TriangleGlyph(minPos, 5, 'S', 5, tier.browser.baseColors['I']);\n        if (insertionLabels)\n            glyph = new Glyphs.LabelledGlyph(canvas, glyph, feature.insertion || feature.altAlleles[0], false, 'center', 'above', '7px sans-serif');\n\n        if ((maxPos - minPos) > 1) {\n            let stroke = style.FGCOLOR || 'red';\n            let fill = style.BGCOLOR || style.COLOR1 || 'green';\n            let bg = new Glyphs.BoxGlyph(minPos, 5, (maxPos - minPos), height, fill, stroke);\n            glyph = new Glyphs.GroupGlyph([bg, glyph]);\n        }\n\n    } else if (glyphType === '__NONE') {\n        return null;\n\n    } else if (glyphType === 'BOX') {\n        let stroke = style.FGCOLOR || null;\n        let fill = style.BGCOLOR || style.COLOR1 || 'green';\n        if (style.BGITEM && feature.itemRgb)\n            fill = feature.itemRgb;\n        let scale = (maxPos - minPos) / (max - min);\n        if (feature.type == 'translation' &&\n            (feature.method == 'protein_coding' || feature.readframeExplicit) &&\n            (!feature.tags || feature.tags.indexOf('cds_start_NF') < 0 || feature.readframeExplicit) &&\n            (!tier.dasSource.collapseSuperGroups || tier.bumped) &&\n            scale >= 0.5) {\n            let refSeq = getRefSeq(tier, min, max);\n            glyph = new Glyphs.AminoAcidGlyph(minPos,\n                                           maxPos,\n                                           height,\n                                           fill,\n                                           refSeq,\n                                           feature.orientation,\n                                           feature.readframe);\n        } else {\n            glyph = new Glyphs.BoxGlyph(minPos, 0, (maxPos - minPos),\n                                     height, fill, stroke);\n        }\n    }\n\n    if (!glyph)\n        return;\n    \n    if ((isDasBooleanTrue(style.LABEL) || feature.forceLabel) &&\n        label && !noLabel) {\n        glyph = new Glyphs.LabelledGlyph(canvas, glyph, label, false);\n    }\n\n    if (bump) {\n        glyph.bump = true;\n    }\n\n    glyph.feature = feature;\n\n    if (isDasBooleanTrue(style[\"HIDEAXISLABEL\"]))\n        quant = null;\n\n    if (quant) {\n        glyph.quant = quant;\n    }\n\n    if (style.ZINDEX) {\n        glyph.zindex = style.ZINDEX | 0;\n    }\n\n    return glyph;\n}\n\n\nfunction groupFeatures(tier, canvas, y) {\n    let glyphs = [];\n    let gbsFeatures = {};\n    let gbsStyles = {};\n    let stackedFeatures = [];\n\n    R.map(features => {\n        features.forEach(feature => {\n            let style = tier.styleForFeature(feature);\n\n            if (feature.parts || !style)\n                return;\n\n            if (style.glyph === 'LINEPLOT') {\n                pusho(gbsFeatures, style.id, feature);\n                gbsStyles[style.id] = style;\n            } else if (style.glyph === 'STACKED') {\n                stackedFeatures.push(feature);\n            } else {\n                let glyph = glyphForFeature(canvas, feature, y, style, tier);\n                if (glyph)\n                    glyphs.push(glyph);\n            }\n        });\n    }, tier.ungroupedFeatures);\n\n    if (stackedFeatures.length > 0) {\n        glyphs = glyphs.concat(makeStackedBars(stackedFeatures, tier));\n    }\n    \n    for (let gbs in gbsFeatures) {\n        let gf = gbsFeatures[gbs];\n        let style = gbsStyles[gbs];\n        if (style.glyph === 'LINEPLOT') {\n            let lineGraphGlyphs = makeLinePlot(gf, style, tier, y);\n            lineGraphGlyphs.forEach(g => glyphs.push(g));\n        }\n    }\n\n    return glyphs;\n}\n\nfunction glyphifyGroups(tier, canvas, glyphs, y) {\n    let groupIds = Object.keys(tier.groupedFeatures);\n    let groupGlyphs = {};\n\n    groupIds.sort((g1, g2) =>\n                  tier.groupedFeatures[g2][0].score - tier.groupedFeatures[g1][0].score);\n\n\n    groupIds.forEach(gId => {\n        let glyphs = glyphsForGroup(canvas, tier.groupedFeatures[gId], y, tier.groups[gId], tier,\n                                    (tier.dasSource.collapseSuperGroups && !tier.bumped) ?\n                                    'collapsed_gene' : 'tent');\n\n        if (glyphs) {\n            glyphs.group = tier.groups[gId];\n            groupGlyphs[gId] = glyphs;\n        }\n    });\n\n    return groupGlyphs;\n}\n\nfunction bumpSubtiers(tier, glyphs, grid, gridOffset, gridSpacing) {\n    let subtierMax =\n            tier.subtierMax ||\n            tier.dasSource.subtierMax ||\n            tier.browser.defaultSubtierMax;\n\n    let subtiersExceeded = false;\n\n    let unbumpedST = new SubTier();\n    let bumpedSTs = [];\n\n    // We want to add each glyph to either the subtier\n    // containing unbumped subtiers, or to the first bumped subtier.\n    glyphs.forEach(glyph => {\n        // if the glyph is to be bumped...\n        if (glyph.bump &&\n            (tier.bumped ||\n            tier.dasSource.collapseSuperGroups)) {\n\n            let glyphTier = bumpedSTs.find(st => st.hasSpaceFor(glyph));\n\n            if (glyphTier) {\n                glyphTier.add(glyph);\n            } else if (bumpedSTs.length >= subtierMax) {\n                subtiersExceeded = true;\n            } else {\n                let subtier = new SubTier();\n                subtier.add(glyph);\n                bumpedSTs.push(subtier);\n            }\n        } else {\n            unbumpedST.add(glyph);\n        }\n    });\n\n    if (unbumpedST.glyphs.length > 0) {\n        bumpedSTs = [unbumpedST].concat(bumpedSTs);\n    }\n\n    // Simple hack to make the horizontal grid in bumped subtiers (e.g. lineplots)\n    // optional and configurable.\n    if (grid) {\n        bumpedSTs.forEach(subtier => {\n            if (subtier.quant) {\n                subtier.glyphs.unshift(new Glyphs.GridGlyph(subtier.height, gridOffset, gridSpacing));\n            }\n        });\n    }\n\n    bumpedSTs.forEach(subtier => {\n        subtier.glyphs.sort((g1, g2) => (g1.zindex || 0) - (g2.zindex || 0));\n    });\n\n    return [bumpedSTs, subtiersExceeded];\n}\n\n// The whole tier is translated downward on its canvas by y pixels\nfunction prepareSubtiers(tier, canvas, y=0, grid=true) {\n\n    let MIN_PADDING = 3;\n    tier.padding = typeof(tier.dasSource.padding) === 'number' ?\n        tier.dasSource.padding : MIN_PADDING;\n\n    tier.scaleVertical = typeof(tier.dasSource.scaleVertical) === 'boolean' ?\n        tier.dasSource.scaleVertical : false;\n\n    let glyphs = groupFeatures(tier, canvas, y);\n\n    // Merge supergroups\n    if (tier.dasSource.collapseSuperGroups && !tier.bumped) {\n        for (let sgId in tier.superGroups) {\n            let sgGroup = tier.superGroups[sgId];\n            tier.groups[sgId] = shallowCopy(tier.groups[sgId]);\n            let group = tier.groups[sgId];\n            group.isSuperGroup = true;\n            let featuresByType = {};\n\n            let sgMin = 10000000000, sgMax = -10000000000;\n            let sgSeg = null;\n\n            sgGroup.forEach((g, i) => {\n                let groupedFeature = tier.groupedFeatures[sgGroup[i]];\n                if (!groupedFeature)\n                    return;\n\n                groupedFeature.forEach(feature => {\n                    pusho(featuresByType, feature.type, feature);\n                    sgMin = Math.min(feature.min, sgMin);\n                    sgMax = Math.max(feature.max, sgMax);\n                    if (feature.segment && !sgSeg)\n                        sgSeg = feature.segment;\n                });\n\n                if (group && !group.links || group.links.length === 0) {\n                    group.links = tier.groups[sgGroup[0]].links;\n                }\n\n                delete tier.groupedFeatures[sgGroup[i]];\n\n            });\n\n            tier.groups[sgId].max = sgMax;\n            tier.groups[sgId].min = sgMin;\n            tier.groups[sgId].segment = sgSeg;\n\n            R.map(features => {\n\n                let template = features[0];\n                let loc = null;\n\n                features.forEach(feature => {\n                    let fl = new Range(feature.min, feature.max);\n                    loc = loc ? union(loc, fl) : fl;\n                });\n\n                let mergedRanges = loc.ranges();\n\n                mergedRanges.forEach(range => {\n                    let posCoverage = ((range.max() | 0) - (range.min() | 0) + 1) * sgGroup.length;\n                    let actCoverage = 0;\n\n                    features.forEach(feature => {\n                        let fmin = feature.min || 0;\n                        let fmax = feature.max || 0;\n                        if (fmin <= range.max() && fmax >= range.min()) {\n\n                            actCoverage += (Math.min(fmax, range.max()) -\n                                            Math.max(fmin, range.min()) + 1);\n                        }\n                    });\n\n                    let newFeature = new DASFeature();\n                    for (let key in template) {\n                        newFeature[key] = template[key];\n                    }\n\n                    newFeature.min = range.min();\n                    newFeature.max = range.max();\n                    if (newFeature.label && sgGroup.length > 1) {\n                        newFeature.label += ' (' + sgGroup.length + ' vars)';\n                    }\n\n                    newFeature.visualWeight = ((1.0 * actCoverage) / posCoverage);\n\n                    pusho(tier.groupedFeatures, sgId, newFeature);\n                });\n            }, featuresByType);\n\n            delete tier.superGroups[sgId]; // Do we want this?\n        }\n    }\n\n    // Glyphify groups.\n    let groupGlyphs = glyphifyGroups(tier, canvas, glyphs, y);\n\n    R.map(superGroup => {\n        let sgGlyphs = [];\n        let sgMin = 10000000000;\n        let sgMax = -10000000000;\n\n        superGroup.forEach(glyphs => {\n            let gGlyphs = groupGlyphs[glyphs];\n            if (gGlyphs) {\n                sgGlyphs.push(gGlyphs);\n                sgMin = Math.min(sgMin, gGlyphs.min());\n                sgMax = Math.max(sgMax, gGlyphs.max());\n            }\n        });\n\n        sgGlyphs.forEach(glyph => {\n            glyphs.push(new Glyphs.PaddedGlyph(glyph, sgMin, sgMax));\n        });\n    }, tier.superGroups);\n\n    R.map(glyph => glyphs.push(glyph), groupGlyphs);\n\n    let [subtiers, subtiersExceeded] = bumpSubtiers(tier, glyphs, grid, y);\n\n    tier.glyphCacheOrigin = tier.browser.viewStart;\n\n    if (subtiersExceeded)\n        tier.updateStatus('Bumping limit exceeded, use the track editor to see more features');\n    else\n        tier.updateStatus();\n\n    tier.subtiers = subtiers;\n}\n\n// Fills out areas that haven't been fetched as gray blocks\nfunction drawUnmapped(tier, canvas, padding) {\n    let drawStart =  tier.browser.viewStart - 1000.0/tier.browser.scale;\n    let drawEnd = tier.browser.viewEnd + 1000.0/tier.browser.scale;\n    let unmappedBlocks = [];\n    if (tier.knownCoverage) {\n        let knownRanges = tier.knownCoverage.ranges();\n        knownRanges.forEach((range, index) => {\n            if (index === 0) {\n                if (range.min() > drawStart)\n                    unmappedBlocks.push({min: drawStart, max: range.min() - 1});\n            } else {\n                unmappedBlocks.push({min: knownRanges[index-1].max() + 1, max: range.min() - 1});\n            }\n\n            if (index == knownRanges.length - 1 && range.max() < drawEnd) {\n                unmappedBlocks.push({min: range.max() + 1, max: drawEnd});\n            }\n        });\n    }\n    if (unmappedBlocks.length > 0) {\n        canvas.fillStyle = 'gray';\n        unmappedBlocks.forEach(block => {\n            let min = (block.min - tier.browser.viewStart) * tier.browser.scale + 1000;\n            let max = (block.max - tier.browser.viewStart) * tier.browser.scale + 1000;\n            canvas.fillRect(min, 0, max - min, padding);\n        });\n    }\n}\n\nfunction clearViewport(canvas, width, height) {\n    canvas.clearRect(0, 0, width, height);\n}\n\n// Make the viewport & canvas the correct size for the tier\nfunction prepareViewport(tier, canvas, retina, clear=true, vOffset=0) {\n    let desiredWidth = tier.browser.featurePanelWidth + 2000;\n    if (retina) {\n        desiredWidth *= 2;\n    }\n\n    let fpw = tier.viewport.width|0;\n    if (fpw < desiredWidth - 50) {\n        tier.viewport.width = fpw = desiredWidth;\n    }\n\n    let lh = tier.padding + vOffset;\n\n    tier.subtiers.forEach(s => lh += s.height + tier.padding);\n\n    lh += 6;\n    lh = Math.max(lh, tier.browser.minTierHeight);\n\n    let canvasHeight = lh;\n    if (retina) {\n        canvasHeight *= 2;\n    }\n\n    if (canvasHeight != tier.viewport.height) {\n        tier.viewport.height = canvasHeight;\n    }\n\n    tier.viewportHolder.style.left = '-1000px';\n    tier.viewport.style.width = retina ? ('' + (fpw/2) + 'px') : ('' + fpw + 'px');\n    tier.viewport.style.height = '' + lh + 'px';\n    tier.layoutHeight =  Math.max(lh, tier.browser.minTierHeight);\n\n    tier.updateHeight();\n    tier.norigin = tier.browser.viewStart;\n\n    canvas.save();\n    if (retina) {\n        canvas.scale(2, 2);\n    }\n\n    if (clear) {\n        clearViewport(canvas, fpw, canvasHeight);\n    }\n\n    drawUnmapped(tier, canvas, lh);\n\n}\n\nfunction paint(tier, canvas, vOffset=0) {\n    let overlayLabelCanvas = new Glyphs.OverlayLabelCanvas();\n    let offset = ((tier.glyphCacheOrigin - tier.browser.viewStart)*tier.browser.scale)+1000;\n    canvas.translate(offset, vOffset + tier.padding);\n    overlayLabelCanvas.translate(0, tier.padding);\n\n    tier.paintToContext(canvas, overlayLabelCanvas, offset);\n\n    if (overlayLabelCanvas.glyphs.length > 0)\n        tier.overlayLabelCanvas = overlayLabelCanvas;\n    else\n        tier.overlayLabelCanvas = null;\n\n    canvas.restore();\n}\n\nfunction getScoreMinMax(tier, style) {\n    let smin = tier.quantMin(style);\n    let smax = tier.quantMax(style);\n\n    if (!smax) {\n        if (smin < 0) {\n            smax = 0;\n        } else {\n            smax = 10;\n        }\n    }\n    if (!smin) {\n        smin = 0;\n    }\n    return [smin, smax];\n}\n\nfunction relScoreOrigin(score, smin, smax) {\n    let relScore = ((1.0 * score) - smin) / (smax-smin);\n    let relOrigin = (-1.0 * smin) / (smax - smin);\n\n    return [relScore, relOrigin];\n}\n\nfunction getRefSeq(tier, min, max) {\n    let refSeq = null;\n    if (tier.currentSequence) {\n        let csStart = tier.currentSequence.start|0;\n        let csEnd = tier.currentSequence.end|0;\n        if (csStart <= max && csEnd >= min) {\n            let sfMin = Math.max(min, csStart);\n            let sfMax = Math.min(max, csEnd);\n\n            refSeq = tier.currentSequence.seq.substr(sfMin - csStart, sfMax - sfMin + 1);\n            while (min < sfMin) {\n                refSeq = 'N' + refSeq;\n                sfMin--;\n            }\n            while (max > sfMax) {\n                refSeq = refSeq + 'N';\n                sfMax++;\n            }\n        }\n    }\n    return refSeq;\n}\n\nfunction featureToCrossLikeGlyph(canvas, tier, feature, y, glyphType, style, forceHeight, noLabel) {\n    let scale = tier.browser.scale;\n    let origin = tier.browser.viewStart;\n\n    let score = feature.score;\n    let label = feature.label || feature.id;\n\n    let minPos = (feature.min - origin) * scale;\n    let maxPos = Math.max((feature.max - origin + 1) * scale, minPos + 1);\n\n    let height = (tier.forceHeight || style.HEIGHT || forceHeight || 12) * 1.0;\n    let requiredHeight = height;\n\n    let glyph = null;\n    let quant = null;\n\n    let stroke = style.FGCOLOR || 'black';\n    let fill = style.BGCOLOR || 'none';\n    let outline = style.STROKECOLOR;\n\n    if (style.BGITEM && feature.itemRgb) {\n        stroke = feature.itemRgb;\n\n    } else if (isDasBooleanTrue(style.COLOR_BY_SCORE2)) {\n        let grad = style.BGGRAD || style._gradient;\n        if (!grad) {\n            grad = makeGradient(50, style.COLOR1, style.COLOR2, style.COLOR3);\n            style._gradient = grad;\n        }\n\n        let score2 = feature.score2;\n        if (score2 !== undefined || !stroke) {\n            score2 = score2 || 0;\n\n            let smin2 = style.MIN2 ? (1.0 * style.MIN2) : 0.0;\n            let smax2 = style.MAX2 ? (1.0 * style.MAX2) : 1.0;\n            let relScore2 = ((1.0 * score2) - smin2) / (smax2-smin2);\n\n            let step = (relScore2*grad.length) | 0;\n            R.clamp(0, step, grad.length - 1);\n            stroke = grad[step];\n        }\n    }\n\n    let size = style.SIZE || height;\n    if (style.RSIZE) {\n        size = (1.0 * style.RSIZE) * height;\n    }\n\n    if (style.STROKETHRESHOLD) {\n        if (size < (1.0 * style.STROKETHRESHOLD))\n            outline = null;\n    }\n\n    let mid = (minPos + maxPos)/2;\n\n    if (glyphType === 'EX') {\n        glyph = new Glyphs.ExGlyph(mid, size, stroke);\n\n    } else if (glyphType === 'TRIANGLE') {\n        let dir = style.DIRECTION || 'N';\n        let width = style.LINEWIDTH || size;\n        glyph = new Glyphs.TriangleGlyph(mid, size, dir, width, stroke, outline);\n\n    } else if (glyphType === 'DOT') {\n        glyph = new Glyphs.DotGlyph(mid, size, stroke, outline);\n\n    } else if (glyphType === 'PLIMSOLL') {\n        glyph = new Glyphs.PlimsollGlyph(mid, size, 0.2 * size, stroke, outline);\n\n    } else if (glyphType === 'SQUARE') {\n        glyph = new Glyphs.BoxGlyph(mid - size/2, 0, size, size, stroke, outline);\n\n    } else if (glyphType === 'STAR') {\n        let points = style.POINTS || 5;\n        glyph = new Glyphs.StarGlyph(mid, size/2, points, stroke, outline);\n\n    } else {\n        glyph = new Glyphs.CrossGlyph(mid, size, stroke);\n\n    }\n\n    if (fill && fill !== 'none' && (maxPos - minPos) > 5) {\n        let boxGlyph = new Glyphs.BoxGlyph(minPos, 0, (maxPos - minPos), size, fill);\n        glyph = new Glyphs.GroupGlyph([boxGlyph, glyph]);\n    }\n\n    if (isDasBooleanTrue(style.SCATTER)) {\n        let [smin, smax] = getScoreMinMax(tier, style);\n\n        let [relScore, relOrigin] = relScoreOrigin(score, smin, smax);\n\n        if (relScore < 0.0 || relScore > 1.0) {\n            // Glyph is out of bounds.\n            // Should we allow for \"partially showing\" glyphs?\n\n            return null;\n        } else {\n            let originShift = x => (x - relOrigin) * requiredHeight;\n            height = Math.max(1, originShift(relScore));\n            y = y + originShift(1);\n\n            if (relScore >= relOrigin)\n                y = y - height;\n\n            quant = {min: smin, max: smax};\n\n            let heightFudge = 0;\n            let featureLabel = R.defaultTo(style.LABEL, feature.forceLabel);\n\n            if (isDasBooleanNotFalse(featureLabel) && label && !noLabel) {\n                glyph = new Glyphs.LabelledGlyph(canvas, glyph, label, true, null,\n                                                 featureLabel == 'above' ? 'above' : 'below');\n                if (featureLabel === 'above') {\n                    heightFudge = glyph.textHeight + 2;\n                }\n                noLabel = true;\n            }\n            glyph = new Glyphs.TranslatedGlyph(glyph, 0, y - (size / 2) - heightFudge, requiredHeight);\n        }\n    }\n\n    return [glyph, quant];\n}\n\nfunction featureToGradientLikeGlyph(canvas, tier, feature, y, glyphType, style, forceHeight) {\n    let scale = tier.browser.scale;\n    let origin = tier.browser.viewStart;\n\n    let score = feature.score;\n\n    let minPos = (feature.min - origin) * scale;\n    let maxPos = Math.max((feature.max - origin + 1) * scale, minPos + 1);\n\n    let height = (tier.forceHeight || style.HEIGHT || forceHeight || 12) * 1.0;\n    let requiredHeight = height * 1.0;\n\n    let glyph = null;\n    let quant = null;\n\n    let centerOnAxis = isDasBooleanTrue(style[\"AXISCENTER\"]);\n\n\n    let [smin, smax] = getScoreMinMax(tier, style);\n\n    // AUTOMIN & AUTOMAX respectively set the lower and upper bounds\n    if (isDasBooleanTrue(style.AUTOMIN)) {\n        smin = tier.currentFeaturesMinScore*0.95;\n        console.log(\"smin:\\t\" + smin);\n    }\n    if (isDasBooleanTrue(style.AUTOMAX)) {\n        smax = tier.currentFeaturesMaxScore*1.05;\n        console.log(\"smax:\\t\" + smax);\n    }\n\n    if ((1.0 * score) < (1.0 * smin)) {\n        score = smin;\n    }\n    if ((1.0 * score) > (1.0 * smax)) {\n        score = smax;\n    }\n\n    // Shift smin/smax in case we want to center the histogram\n    // on the horizontal axis\n    if (centerOnAxis) {\n        let tmin = tier.quantMin(style);\n        let tmax = tier.quantMax(style);\n\n        if (isDasBooleanTrue(style.AUTOMIN)) {\n            tmin = tier.currentFeaturesMinScore*0.95;\n        }\n        if (isDasBooleanTrue(style.AUTOMAX)) {\n            tmax = tier.currentFeaturesMaxScore*1.05;\n        }\n\n        smin = tmin - ((tmax - tmin) / 2);\n        smax = tmax - ((tmax - tmin) / 2);\n    }\n\n    let [relScore, relOrigin] = relScoreOrigin(score, smin, smax);\n\n    if (glyphType === 'HISTOGRAM') {\n        let originShift = x => x - Math.max(0, relOrigin);\n        height = Math.abs(originShift(relScore)) * requiredHeight;\n        y = y + originShift(1.0) * requiredHeight;\n\n        if (relScore >= relOrigin)\n            y -= height;\n\n        if (centerOnAxis)\n            y += height / 2;\n\n        if (isDasBooleanTrue(style[\"HIDEAXISLABEL\"]))\n            quant = null;\n        else\n            quant = {min: smin, max: smax};\n    }\n\n    let stroke = style.FGCOLOR || null;\n    let fill = style.BGCOLOR || style.COLOR1 || 'green';\n    if (style.BGITEM && feature.itemRgb)\n        fill = feature.itemRgb;\n    let alpha = style.ALPHA ? (1.0 * style.ALPHA) : null;\n\n    if (style.BGGRAD) {\n        let grad = style.BGGRAD;\n        let step = (relScore*grad.length)|0;\n        step = R.clamp(0, step, grad.length - 1);\n        fill = grad[step];\n    }\n\n    if (style.COLOR2) {\n        let grad = style._gradient;\n        if (!grad) {\n            grad = makeGradient(50, style.COLOR1, style.COLOR2, style.COLOR3);\n            style._gradient = grad;\n        }\n\n        let step = (relScore*grad.length) | 0;\n        step = R.clamp(0, step, grad.length - 1);\n        fill = grad[step];\n    }\n\n    let tempGlyph = new Glyphs.BoxGlyph(minPos, y, (maxPos - minPos), height, fill, stroke, alpha);\n    glyph = new Glyphs.TranslatedGlyph(tempGlyph, 0, 0, requiredHeight);\n\n    return [glyph, quant];\n}\n\nfunction featureToPointGlyph(tier, feature, style) {\n    let scale = tier.browser.scale;\n    let origin = tier.browser.viewStart;\n\n    let score = feature.score;\n\n    let minPos = (feature.min - origin) * scale;\n    let maxPos = Math.max((feature.max - origin + 1) * scale, minPos + 1);\n\n    let height = tier.forceHeight || style.HEIGHT || 30;\n\n    let glyph = null;\n    let quant = null;\n\n    let [smin, smax] = getScoreMinMax(tier, style);\n    let yscale = ((1.0 * height) / (smax - smin));\n    let relScore = ((1.0 * score) - smin) / (smax-smin);\n    let sc = ((score - (1.0*smin)) * yscale)|0;\n    quant = {min: smin, max: smax};\n\n    let fill = style.FGCOLOR || style.COLOR1 || 'black';\n    if (style.COLOR2) {\n        let grad = style._gradient;\n        if (!grad) {\n            grad = makeGradient(50, style.COLOR1, style.COLOR2, style.COLOR3);\n            style._gradient = grad;\n        }\n\n        let step = (relScore*grad.length)|0;\n        step = R.clamp(0, step, grad.length - 1);\n        fill = grad[step];\n    }\n\n    glyph = new Glyphs.PointGlyph((minPos + maxPos)/2, height-sc, height, fill);\n\n    return [glyph, quant];\n}\n\nfunction sequenceGlyph(canvas, tier, feature, style, forceHeight) {\n    let scale = tier.browser.scale;\n    let origin = tier.browser.viewStart;\n\n    let min = feature.min;\n    let max = feature.max;\n    let minPos = (feature.min - origin) * scale;\n    let maxPos = Math.max((feature.max - origin + 1) * scale, minPos + 1);\n\n    let height = (tier.forceHeight || style.HEIGHT || forceHeight || 12) * 1.0;\n\n    let glyph = null;\n\n    let rawseq = feature.seq;\n    let seq = rawseq;\n    let rawquals = feature.quals;\n    let quals = rawquals;\n    let insertionLabels = isDasBooleanTrue(style.__INSERTIONS);\n\n    let indels = [];\n    if (feature.cigar) {\n        let ops = parseCigar(feature.cigar);\n        seq = '';\n        quals = '';\n        let cursor = 0;\n\n        ops.forEach(co => {\n            if (co.op === 'M') {\n                seq += rawseq.substr(cursor, co.cnt);\n                quals += rawquals.substr(cursor, co.cnt);\n                cursor += co.cnt;\n            } else if (co.op === 'D') {\n                seq += \"-\".repeat(co.cnt);\n                quals += \"Z\".repeat(co.cnt);\n            } else if (co.op === 'I') {\n                let inseq = rawseq.substr(cursor, co.cnt);\n                let ig = new Glyphs.TranslatedGlyph(\n                    new Glyphs.TriangleGlyph(minPos + (seq.length*scale), 6, 'S', 5, tier.browser.baseColors['I']),\n                    0, -2, 0\n                );\n                if (insertionLabels)\n                    ig = new Glyphs.LabelledGlyph(canvas, ig, inseq, false, 'center', 'above', '7px sans-serif');\n                ig.feature = {label: 'Insertion: ' + inseq, type: 'insertion', method: 'insertion'};\n                indels.push(ig);\n\n                cursor += co.cnt;\n            } else if (co.op === 'S') {\n                cursor += co.cnt;\n            } else {\n                console.log('unknown cigop' + co.op);\n            }\n        });\n    }\n\n    let refSeq = getRefSeq(tier, min, max);\n    if (seq && refSeq &&\n        (style.__SEQCOLOR === 'mismatch' ||\n         style.__SEQCOLOR === 'mismatch-all')) {\n        let mismatchSeq = [];\n        let match = feature.orientation === '-' ? ',' : '.';\n        for (let i = 0; i < seq.length; ++i) {\n            mismatchSeq.push(seq[i] == refSeq[i] ? match : seq[i]);\n        }\n        seq = mismatchSeq.join('');\n    }\n\n    let strandColor = feature.orientation === '-' ?\n              style._minusColor || 'lightskyblue'\n            : style._plusColor || 'lightsalmon';\n\n    if (style.__disableQuals)\n        quals = false;\n\n    glyph = new Glyphs.SequenceGlyph(\n        tier.browser.baseColors,\n        strandColor,\n        minPos,\n        maxPos,\n        height,\n        seq,\n        refSeq,\n        style.__SEQCOLOR,\n        quals,\n        !isDasBooleanTrue(style.__CLEARBG),\n        tier.scaleVertical\n    );\n\n    if (insertionLabels)\n        glyph = new Glyphs.TranslatedGlyph(glyph, 0, 7);\n\n    if (indels.length > 0) {\n        indels.splice(0, 0, glyph);\n        glyph = new Glyphs.GroupGlyph(indels);\n    }\n\n    return glyph;\n}\n\nfunction makeLinePlot(features, style, tier, yshift) {\n    yshift = yshift || 0;\n\n    let origin = tier.browser.viewStart, scale = tier.browser.scale;\n    let height = tier.forceHeight || style.HEIGHT || 30;\n    let min = tier.quantMin(style);\n    let max = tier.quantMax(style);\n\n    // AUTOMIN & AUTOMAX respectively set the lower and upper bounds\n    if (isDasBooleanTrue(style.AUTOMIN)) {\n        // add some basically arbitrary padding\n        min = tier.currentFeaturesMinScore*0.95;\n    }\n    if (isDasBooleanTrue(style.AUTOMAX)) {\n        max = tier.currentFeaturesMaxScore*1.05;\n    }\n\n    let yscale = ((1.0 * height) / (max - min));\n    let color = style.FGCOLOR || style.COLOR1 || 'black';\n\n    let prevSign = 1;\n    let curSign = null;\n\n    let curGlyphPoints = [];\n    let glyphSequences = [];\n\n    let prevPoint = null;\n\n    features.forEach(f => {\n        let px = ((((f.min|0) + (f.max|0)) / 2) - origin) * scale;\n        let sc = ((f.score - (1.0*min)) * yscale)|0;\n\n        // Additive tracks are always above the x-axis, and are colored\n        // depending on whether the score is positive or negative.\n        if (isDasBooleanTrue(style.ADDITIVE)) {\n            curSign = f.score < 0 ? -1 : 1;\n\n            if (curSign !== prevSign) {\n                glyphSequences.push({\n                    points: curGlyphPoints,\n                    color: prevSign === 1 ?\n                        style.POSCOLOR\n                        : style.NEGCOLOR\n                });\n                curGlyphPoints = [];\n                // Need to add the previous point to this sequence,\n                // otherwise there is a gap in the resulting plot\n                curGlyphPoints.push(prevPoint);\n            }\n            prevSign = curSign;\n        } else {\n            curSign = 1;\n        }\n\n        let py = (height - (sc * curSign)) + yshift;\n        prevPoint = {x: px, y: py};\n        curGlyphPoints.push(prevPoint);\n    });\n\n\n    // Need to add the final sequence of points as well.\n    if (isDasBooleanTrue(style.ADDITIVE)) {\n        color = curSign === 1 ? style.POSCOLOR : style.NEGCOLOR;\n    }\n    glyphSequences.push({\n        points: curGlyphPoints,\n        color: color\n    });\n\n\n    let lggs = glyphSequences.map(gs => {\n        let lgg = new Glyphs.LineGraphGlyph(gs.points, gs.color, height);\n        lgg.quant = {min, max};\n\n        if (style.ZINDEX)\n            lgg.zindex = style.ZINDEX|0;\n\n        return lgg;\n    });\n\n    return lggs;\n}\n\nfunction makeStackedBars(features, tier) {\n    let glyphs = [];\n\n    let posStacks = [],\n        negStacks = [];\n\n    const scale = tier.browser.scale, origin = tier.browser.viewStart;\n    for (var fi = 0; fi < features.length; ++fi) {\n        const feature = features[fi];\n        const style = tier.styleForFeature(feature);\n        let score = feature.score * 1.0;\n\n        let height = tier.forceHeight || style.HEIGHT || 12;\n        const requiredHeight = height = 1.0 * height;\n\n        const min = feature.min;\n        const max = feature.max;\n\n        const minPos = (min - origin) * scale;\n        const rawMaxPos = ((max - origin + 1) * scale);\n        const maxPos = Math.max(rawMaxPos, minPos + 1);\n\n        // This should somewhat match the 'HISTOGRAM' path.\n\n        var smin = tier.quantMin(style);\n        var smax = tier.quantMax(style);\n\n        if (!smax) {\n            if (smin < 0) {\n                smax = 0;\n            } else {\n                smax = 10;\n            }\n        } else {\n            smax = smax * 1.0;\n        }\n\n        if (!smin) {\n            smin = 0;\n        } else {\n            smin = smin * 1.0;\n        }\n\n        var stackOrigin;\n        if (score >= 0) {\n            stackOrigin = posStacks[min] || 0;\n            posStacks[min] = stackOrigin + score;\n        } else {\n            stackOrigin = negStacks[min] || 0;\n            negStacks[min] = stackOrigin + score;\n        }\n\n        if (stackOrigin > smax || stackOrigin < smin) {\n            // Stack has extended outside of range.\n            continue;\n        }\n\n        if (stackOrigin + score < smin) {\n            score = smin - stackOrigin;\n        }\n        if (stackOrigin + score > smax) {\n            score = smax - stackOrigin;\n        }\n\n        var relScoreEnd = (score + stackOrigin - smin) / (smax - smin);\n        var relScoreStart = (stackOrigin - smin) / (smax - smin)\n        var relScoreMax = Math.max(relScoreStart, relScoreEnd);\n        var relScoreMin = Math.min(relScoreStart, relScoreEnd);\n\n        height = (relScoreMax - relScoreMin) * requiredHeight;\n        var y = (1.0 - relScoreMax) * requiredHeight;\n\n        let stroke = style.FGCOLOR || null;\n        let fill = style.BGCOLOR || style.COLOR1 || 'green';\n        if (style.BGITEM && feature.itemRgb)\n            fill = feature.itemRgb;\n        const alpha = style.ALPHA ? (1.0 * style.ALPHA) : null;\n\n        let gg = new Glyphs.BoxGlyph(minPos, y, (maxPos - minPos), height, fill, stroke, alpha);\n        gg = new Glyphs.TranslatedGlyph(gg, 0, 0, requiredHeight);\n        gg.feature = feature;\n        gg.quant = {\n            min: smin, max: smax\n        };\n        if (style.ZINDEX) {\n            gg.zindex = style.ZINDEX | 0;\n        }\n        glyphs.push(gg);\n\n    }\n    return glyphs;\n}\n\n// height is subtier height\nfunction createQuantOverlay(tier, height, retina=false) {\n    let width = 50;\n\n    tier.quantOverlay.height = height;\n    tier.quantOverlay.width = retina ? width*2 : width;\n    tier.quantOverlay.style.height = '' + (retina ? height/2 : height) + 'px';\n    tier.quantOverlay.style.width = '' + width + 'px';\n    tier.quantOverlay.style.display = 'block';\n\n    let canvas = tier.quantOverlay.getContext('2d');\n\n    if (retina) {\n        canvas.scale(2, 2);\n    }\n\n    return canvas;\n}\n\nfunction paintQuant(canvas, tier, quant, tics) {\n    canvas.save();\n\n    let h = tier.quantOverlay.height;\n    let w = 100;\n\n    let ticSpacing = (h + tier.padding*2) / tics;\n    let ticInterval = (quant.max - quant.min) / tics;\n\n    canvas.fillStyle = 'white';\n    canvas.globalAlpha = 0.6;\n    if (tier.browser.rulerLocation == 'right') {\n        canvas.fillRect(w-30, 0, 30, h + tier.padding*2);\n    } else {\n        canvas.fillRect(0, 0, 30, h + tier.padding*2);\n    }\n    canvas.globalAlpha = 1.0;\n\n    canvas.strokeStyle = 'black';\n    canvas.lineWidth = 1;\n    canvas.beginPath();\n    if (tier.browser.rulerLocation == 'right') {\n        canvas.moveTo(w - 8, tier.padding);\n        canvas.lineTo(w, tier.padding);\n        canvas.lineTo(w, h + tier.padding);\n        canvas.lineTo(w - 8, h + tier.padding);\n\n        for (let t = 1; t < tics-1; t++) {\n            let ty = t*ticSpacing;\n            canvas.moveTo(w, ty);\n            canvas.lineTo(w - 5, ty);\n        }\n    } else {\n        canvas.moveTo(8, tier.padding);\n        canvas.lineTo(0, tier.padding);\n        canvas.lineTo(0, h + tier.padding);\n        canvas.lineTo(8, h + tier.padding);\n\n        for (let t = 1; t < tics-1; t++) {\n            let ty = t*ticSpacing;\n            canvas.moveTo(0, ty);\n            canvas.lineTo(5, ty);\n        }\n    }\n    canvas.stroke();\n\n    canvas.fillStyle = 'black';\n\n    if (tier.browser.rulerLocation == 'right') {\n        canvas.textAlign = 'right';\n        canvas.fillText(formatQuantLabel(quant.max), w-9, 8);\n        canvas.fillText(formatQuantLabel(quant.min), w-9, h + tier.padding);\n\n        for (let t = 1; t < tics-1; t++) {\n            let ty = t*ticSpacing;\n            canvas.fillText(formatQuantLabel((1.0*quant.max) - (t*ticInterval)), w - 9, ty + 3);\n        }\n    } else {\n        canvas.textAlign = 'left';\n        canvas.fillText(formatQuantLabel(quant.max), 9, 8);\n        canvas.fillText(formatQuantLabel(quant.min), 9, h + tier.padding);\n\n        for (let t = 1; t < tics-1; t++) {\n            let ty = t*ticSpacing;\n            canvas.fillText(formatQuantLabel((1.0*quant.max) - (t*ticInterval)), 9, ty + 3);\n        }\n    }\n\n    canvas.restore();\n}\n","/* -*- mode: javascript; c-basic-offset: 4; indent-tabs-mode: nil -*- */\n\n// \n// Dalliance Genome Explorer\n// (c) Thomas Down 2006-2010\n//\n// domui.js: SVG UI components\n//\n\n\"use strict\";\n\nif (typeof(require) !== 'undefined') {\n    var browser = require('./cbrowser');\n    var Browser = browser.Browser;\n\n    var utils = require('./utils');\n    var makeElement = utils.makeElement;\n    var removeChildren = utils.removeChildren;\n}\n\nBrowser.prototype.removeAllPopups = function() {\n    removeChildren(this.hPopupHolder);\n    removeChildren(this.popupHolder);\n}\n\nBrowser.prototype.makeTooltip = function(ele, text)\n{\n    var isin = false;\n    var thisB = this;\n    var timer = null;\n    var outlistener;\n    outlistener = function(ev) {\n        isin = false;\n        if (timer) {\n            clearTimeout(timer);\n            timer = null;\n        }\n        ele.removeEventListener('mouseout', outlistener, false);\n    };\n\n    var setup = function(ev) {\n        var mx = ev.clientX + window.scrollX, my = ev.clientY + window.scrollY;\n        if (!timer) {\n            timer = setTimeout(function() {\n                var ttt;\n                if (typeof(text) === 'function') {\n                    ttt = text();\n                } else {\n                    ttt = text;\n                }\n\n                var popup = makeElement('div',\n                    [makeElement('div', null, {className: 'tooltip-arrow'}),\n                     makeElement('div', ttt, {className: 'tooltip-inner'})], \n                    {className: 'tooltip bottom in'}, {\n                    display: 'block',\n                    top: '' + (my + 20) + 'px',\n                    left: '' + Math.max(mx - 30, 20) + 'px'\n                });\n                thisB.hPopupHolder.appendChild(popup);\n                var moveHandler;\n                moveHandler = function(ev) {\n                    try {\n                        thisB.hPopupHolder.removeChild(popup);\n                    } catch (e) {\n                        // May have been removed by other code which clears the popup layer.\n                    }\n                    window.removeEventListener('mousemove', moveHandler, false);\n                    if (isin) {\n                        if (ele.offsetParent == null) {\n                        } else {\n                            setup(ev);\n                        }\n                    }\n                }\n                window.addEventListener('mousemove', moveHandler, false);\n                timer = null;\n            }, 1000);\n        }\n    };\n\n    ele.addEventListener('mouseover', function(ev) {\n        isin = true\n        ele.addEventListener('mouseout', outlistener, false);\n        setup(ev);\n    }, false);\n    ele.addEventListener('DOMNodeRemovedFromDocument', function(ev) {\n        isin = false;\n        if (timer) {\n            clearTimeout(timer);\n            timer = null;\n        }\n    }, false);\n}\n\nBrowser.prototype.popit = function(ev, name, ele, opts)\n{\n    var thisB = this;\n    if (!opts) \n        opts = {};\n    if (!ev) \n        ev = {};\n\n    var width = opts.width || 200;\n\n    var mx, my;\n\n    if (ev.clientX) {\n        var mx =  ev.clientX, my = ev.clientY;\n    } else {\n        mx = 500; my= 50;\n    }\n    mx +=  document.documentElement.scrollLeft || document.body.scrollLeft;\n    my +=  document.documentElement.scrollTop || document.body.scrollTop;\n    var winWidth = window.innerWidth;\n\n    var top = my;\n    var left = Math.min(mx - (width/2) - 4, (winWidth - width - 30));\n\n    var popup = makeElement('div');\n    popup.className = 'popover fade ' + (ev.clientX ? 'bottom ' : '') + 'in';\n    popup.style.display = 'block';\n    popup.style.position = 'absolute';\n    popup.style.top = '' + top + 'px';\n    popup.style.left = '' + left + 'px';\n    popup.style.width = width + 'px';\n    if (width > 276) {\n        // HACK Bootstrappification...\n        popup.style.maxWidth = width + 'px';\n    }\n\n    popup.appendChild(makeElement('div', null, {className: 'arrow'}));\n\n    if (name) {\n        var closeButton = makeElement('button', '', {className: 'close'});\n        closeButton.innerHTML = '&times;'\n\n        closeButton.addEventListener('mouseover', function(ev) {\n            closeButton.style.color = 'red';\n        }, false);\n        closeButton.addEventListener('mouseout', function(ev) {\n            closeButton.style.color = 'black';\n        }, false);\n        closeButton.addEventListener('click', function(ev) {\n            ev.preventDefault(); ev.stopPropagation();\n            thisB.removeAllPopups();\n        }, false);\n        var tbar = makeElement('h4', [makeElement('span', name, null, {maxWidth: '200px'}), closeButton], {/*className: 'popover-title' */}, {paddingLeft: '10px', paddingRight: '10px'});\n\n        var dragOX, dragOY;\n        var moveHandler, upHandler;\n        moveHandler = function(ev) {\n            ev.stopPropagation(); ev.preventDefault();\n            left = left + (ev.clientX - dragOX);\n            if (left < 8) {\n                left = 8;\n            } if (left > (winWidth - width - 32)) {\n                left = (winWidth - width - 26);\n            }\n            top = top + (ev.clientY - dragOY);\n            top = Math.max(10, top);\n            popup.style.top = '' + top + 'px';\n            popup.style.left = '' + Math.min(left, (winWidth - width - 10)) + 'px';\n            dragOX = ev.clientX; dragOY = ev.clientY;\n        }\n        upHandler = function(ev) {\n            ev.stopPropagation(); ev.preventDefault();\n            window.removeEventListener('mousemove', moveHandler, false);\n            window.removeEventListener('mouseup', upHandler, false);\n        }\n        tbar.addEventListener('mousedown', function(ev) {\n            ev.preventDefault(); ev.stopPropagation();\n            dragOX = ev.clientX; dragOY = ev.clientY;\n            window.addEventListener('mousemove', moveHandler, false);\n            window.addEventListener('mouseup', upHandler, false);\n        }, false);\n                              \n\n        popup.appendChild(tbar);\n    }\n\n    popup.appendChild(makeElement('div', ele, {className: 'popover-content'}, {\n        padding: '0px'\n    }));\n    this.hPopupHolder.appendChild(popup);\n\n    var popupHandle = {\n        node: popup,\n        displayed: true\n    };\n    popup.addEventListener('DOMNodeRemoved', function(ev) {\n        if (ev.target == popup) {\n            popupHandle.displayed = false;\n        }\n    }, false);\n    return popupHandle;\n}\n\nfunction makeTreeTableSection(title, content, visible) {\n    var ttButton = makeElement('i');\n    function update() {\n        if (visible) {\n            ttButton.className = 'fa fa-caret-down';\n            content.style.display = 'table';\n        } else {\n            ttButton.className = 'fa fa-caret-right';\n            content.style.display = 'none';\n        }\n    }\n    update();\n\n    ttButton.addEventListener('click', function(ev) {\n        ev.preventDefault(); ev.stopPropagation();\n        visible = !visible;\n        update();\n    }, false);\n\n    var heading = makeElement('h6', [ttButton, ' ', title], {}, {display: 'block', background: 'gray', color: 'white', width: '100%', padding: '5px 2px', margin: '0px'});\n    return makeElement('div', [heading, content], {});\n}\n\nif (typeof(module) !== 'undefined') {\n    module.exports = {\n        makeTreeTableSection: makeTreeTableSection\n    };\n}\n","/* jshint esversion: 6 */\n\"use strict\";\n\nimport * as DefaultRenderer from \"./default-renderer\";\n\nexport { renderTier, drawTier };\n\nfunction renderTier(status, tier) {\n    drawTier(tier);\n    tier.updateStatus(status);\n}\n\nfunction drawTier(tier) {\n    let canvas = tier.viewport.getContext(\"2d\");\n    let retina = tier.browser.retina && window.devicePixelRatio > 1;\n    if (retina) {\n        canvas.scale(2, 2);\n    }\n\n    let features = tier.currentFeatures;\n    let sequence = tier.currentSequence;\n    if (tier.sequenceSource) {\n        DefaultRenderer.drawSeqTier(tier, sequence);\n    } else if (features) {\n        DefaultRenderer.prepareSubtiers(tier, canvas);\n    } else {\n        console.log(\"No sequence or features in tier!\");\n    }\n\n    if (tier.subtiers) {\n        DefaultRenderer.prepareViewport(tier, canvas, retina, true);\n    }\n\n    tier.drawOverlay();\n    tier.paintQuant();\n\n    if (typeof(tier.dasSource.drawCallback) === \"function\") {\n        tier.dasSource.drawCallback(canvas, tier);\n    }\n\n    tier.originHaxx = 0;\n    tier.browser.arrangeTiers();\n}\n","/* -*- mode: javascript; c-basic-offset: 4; indent-tabs-mode: nil -*- */\n\n// \n// Dalliance Genome Explorer\n// (c) Thomas Down 2006-2014\n//\n// encode.js: interface for ENCODE DCC services\n//\n\n\"use strict\";\n\nif (typeof(require) !== 'undefined') {\n    var Promise = require('es6-promise').Promise;\n}\n\nfunction lookupEncodeURI(uri, json) {\n    if (uri.indexOf('?') < 0)\n        uri = uri + '?soft=true';\n\n    return new Promise(function(accept, reject) {\n        var req = new XMLHttpRequest();\n        req.onreadystatechange = function() {\n            if (req.readyState == 4) {\n                if (req.status >= 300) {\n                    reject('Error code ' + req.status);\n                } else {\n                    var resp = JSON.parse(req.response);\n                    accept(json ? resp : resp.location);\n                }\n            }\n        };\n    \n        req.open('GET', uri, true);\n        req.setRequestHeader('Accept', 'application/json');\n        req.responseType = 'text';\n        req.send();\n    });\n}\n\nfunction EncodeURLHolder(url) {\n    this.rawurl = url;\n}\n\nEncodeURLHolder.prototype.getURLPromise = function() {\n    if (this.urlPromise && this.urlPromiseValidity > Date.now()) {\n        return this.urlPromise;\n    } else {\n        this.urlPromise = lookupEncodeURI(this.rawurl, true).then(function(resp) {\n            return resp.location;\n        });\n        this.urlPromiseValidity = Date.now() + (12 * 3600 * 1000);\n        return this.urlPromise;\n    }\n}\n\nfunction EncodeFetchable(url, start, end, opts) {\n    if (!opts) {\n        if (typeof start === 'object') {\n            opts = start;\n            start = undefined;\n        } else {\n            opts = {};\n        }\n    }\n\n    this.url = (typeof url === 'string' ? new EncodeURLHolder(url) : url);\n    this.start = start || 0;\n    if (end) {\n        this.end = end;\n    }\n    this.opts = opts;\n}\n\n\n\nEncodeFetchable.prototype.slice = function(s, l) {\n    if (s < 0) {\n        throw 'Bad slice ' + s;\n    }\n\n    var ns = this.start, ne = this.end;\n    if (ns && s) {\n        ns = ns + s;\n    } else {\n        ns = s || ns;\n    }\n    if (l && ns) {\n        ne = ns + l - 1;\n    } else {\n        ne = ne || l - 1;\n    }\n    return new EncodeFetchable(this.url, ns, ne, this.opts);\n}\n\nEncodeFetchable.prototype.fetchAsText = function(callback) {\n    var self = this;\n    var req = new XMLHttpRequest();\n    var length;\n    self.url.getURLPromise().then(function(url) {\n        req.open('GET', url, true);\n\n        if (self.end) {\n            if (self.end - self.start > 100000000) {\n                throw 'Monster fetch!';\n            }\n            req.setRequestHeader('Range', 'bytes=' + self.start + '-' + self.end);\n            length = self.end - self.start + 1;\n        }\n\n        req.onreadystatechange = function() {\n            if (req.readyState == 4) {\n                if (req.status == 200 || req.status == 206) {\n                    return callback(req.responseText);\n                } else {\n                    return callback(null);\n                }\n            }\n        };\n        if (self.opts.credentials) {\n            req.withCredentials = true;\n        }\n        req.send();\n    }).catch(function(err) {\n        console.log(err);\n        return callback(null);\n    });\n}\n\nEncodeFetchable.prototype.salted = function() {\n    return this;\n}\n\nEncodeFetchable.prototype.fetch = function(callback, attempt, truncatedLength) {\n    var self = this;\n\n    attempt = attempt || 1;\n    if (attempt > 3) {\n        return callback(null);\n    }\n\n    self.url.getURLPromise().then(function (url) {\n        var req = new XMLHttpRequest();\n        var length;\n        req.open('GET', url, true);\n        req.overrideMimeType('text/plain; charset=x-user-defined');\n        if (self.end) {\n            if (self.end - self.start > 100000000) {\n                throw 'Monster fetch!';\n            }\n            req.setRequestHeader('Range', 'bytes=' + self.start + '-' + self.end);\n            length = self.end - self.start + 1;\n        }\n        req.responseType = 'arraybuffer';\n        req.onreadystatechange = function() {\n            if (req.readyState == 4) {\n                if (req.status == 200 || req.status == 206) {\n                    if (req.response) {\n                        var bl = req.response.byteLength;\n                        if (length && length != bl && (!truncatedLength || bl != truncatedLength)) {\n                            return self.fetch(callback, attempt + 1, bl);\n                        } else {\n                            return callback(req.response);\n                        }\n                    } else if (req.mozResponseArrayBuffer) {\n                        return callback(req.mozResponseArrayBuffer);\n                    } else {\n                        var r = req.responseText;\n                        if (length && length != r.length && (!truncatedLength || r.length != truncatedLength)) {\n                            return self.fetch(callback, attempt + 1, r.length);\n                        } else {\n                            return callback(bstringToBuffer(req.responseText));\n                        }\n                    }\n                } else {\n                    return self.fetch(callback, attempt + 1);\n                }\n            }\n        };\n        if (self.opts.credentials) {\n            req.withCredentials = true;\n        }\n        req.send();\n    }).catch(function(err) {\n        console.log(err);\n    });\n}\n\nfunction bstringToBuffer(result) {\n    if (!result) {\n        return null;\n    }\n\n    var ba = new Uint8Array(result.length);\n    for (var i = 0; i < ba.length; ++i) {\n        ba[i] = result.charCodeAt(i);\n    }\n    return ba.buffer;\n}\n\nif (typeof(module) !== 'undefined') {\n    module.exports = {\n        lookupEncodeURI: lookupEncodeURI,\n        EncodeFetchable: EncodeFetchable\n    };\n}\n","/* -*- mode: javascript; c-basic-offset: 4; indent-tabs-mode: nil -*- */\n\n// \n// Dalliance Genome Explorer\n// (c) Thomas Down 2006-2013\n//\n// ensembljson.js -- query the Ensembl REST API.\n//\n\n\"use strict\";\n\nif (typeof(require) !== 'undefined') {\n    var sa = require('./sourceadapters');\n    var dalliance_registerSourceAdapterFactory = sa.registerSourceAdapterFactory;\n    var FeatureSourceBase = sa.FeatureSourceBase;\n\n    var das = require('./das');\n    var DASStylesheet = das.DASStylesheet;\n    var DASStyle = das.DASStyle;\n    var DASFeature = das.DASFeature;\n    var DASGroup = das.DASGroup;\n}\n\nfunction EnsemblFeatureSource(source) {\n    FeatureSourceBase.call(this);\n    this.source = source;\n    this.base = source.uri || '//rest.ensembl.org';\n    if (this.base.indexOf('//') === 0) {\n        var proto = window.location.protocol;\n        if (proto == 'http:' || proto == 'https:') {\n            // Protocol-relative URLs okay.\n        } else {\n            this.base = 'http:' + this.base;\n        }\n    }\n    this.species = source.species || 'human';\n\n    if (typeof source.type === 'string') {\n        this.type = [source.type];\n    } else {\n        this.type = source.type || ['regulatory'];\n    }\n}\n\nEnsemblFeatureSource.prototype = Object.create(FeatureSourceBase.prototype);\nEnsemblFeatureSource.prototype.constructor = EnsemblFeatureSource;\n\nEnsemblFeatureSource.prototype.getStyleSheet = function(callback) {\n    var stylesheet = new DASStylesheet();\n\n    var tsStyle = new DASStyle();\n    tsStyle.glyph = '__NONE';\n    if (this.type.indexOf('exon') >= 0)\n        stylesheet.pushStyle({type: 'transcript'}, null, tsStyle);\n    if (this.type.indexOf('exon') >= 0 || this.type.indexOf('transcript') >= 0)\n        stylesheet.pushStyle({type: 'gene'}, null, tsStyle);\n\n    var cdsStyle = new DASStyle();\n    cdsStyle.glyph = 'BOX';\n    cdsStyle.FGCOLOR = 'black';\n    cdsStyle.BGCOLOR = 'red'\n    cdsStyle.HEIGHT = 8;\n    cdsStyle.BUMP = true;\n    cdsStyle.LABEL = true;\n    cdsStyle.ZINDEX = 30;\n    stylesheet.pushStyle({type: 'cds'}, null, cdsStyle);\n\n    {\n        var varStyle = new DASStyle();\n        varStyle.glyph = 'SQUARE';\n        varStyle.BUMP = 'yes';\n        varStyle.LABEL = 'no';\n        // varStyle.BGCOLOR = '#888888';\n        varStyle.FGCOLOR = 'blue';\n        stylesheet.pushStyle({type: 'variation', method: '.+_UTR_variant'}, null, varStyle);\n    }\n    {\n        var varStyle = new DASStyle();\n        varStyle.glyph = 'TRIANGLE';\n        varStyle.DIRECTION = 'S';\n        varStyle.BUMP = 'yes';\n        varStyle.LABEL = 'no';\n        // varStyle.BGCOLOR = '#888888';\n        varStyle.FGCOLOR = 'blue';\n        stylesheet.pushStyle({type: 'variation', method: 'missense_variant'}, null, varStyle);\n    }\n    {\n        var varStyle = new DASStyle();\n        varStyle.glyph = 'TRIANGLE';\n        varStyle.DIRECTION = 'N';\n        varStyle.BUMP = 'yes';\n        varStyle.LABEL = 'no';\n        // varStyle.BGCOLOR = '#888888';\n        varStyle.FGCOLOR = 'blue';\n        stylesheet.pushStyle({type: 'variation', method: 'splice_.+_variant'}, null, varStyle);\n    }\n    {\n        var varStyle = new DASStyle();\n        varStyle.glyph = 'STAR';\n        varStyle.POINTS = 6;\n        varStyle.BUMP = 'yes';\n        varStyle.LABEL = 'no';\n        // varStyle.BGCOLOR = '#888888';\n        varStyle.FGCOLOR = 'blue';\n        stylesheet.pushStyle({type: 'variation', method: 'regulatory_region_variant'}, null, varStyle);\n    }\n    {\n        var varStyle = new DASStyle();\n        varStyle.glyph = 'PLIMSOLL';\n        varStyle.BUMP = 'yes';\n        varStyle.LABEL = 'no';\n        // varStyle.BGCOLOR = '#888888';\n        varStyle.FGCOLOR = 'rgb(50,80,255)';\n        varStyle.STROKECOLOR = 'black';\n        stylesheet.pushStyle({type: 'variation'}, null, varStyle);\n    }\n        {\n        var varStyle = new DASStyle();\n        varStyle.glyph = 'SQUARE';\n        varStyle.BUMP = 'yes';\n        varStyle.LABEL = 'no';\n        varStyle.BGCOLOR = '#888888';\n        varStyle.FGCOLOR = 'red';\n        stylesheet.pushStyle({type: 'indel', method: '.+_UTR_variant'}, null, varStyle);\n    }\n    {\n        var varStyle = new DASStyle();\n        varStyle.glyph = 'TRIANGLE';\n        varStyle.DIRECTION = 'S';\n        varStyle.BUMP = 'yes';\n        varStyle.LABEL = 'no';\n        varStyle.BGCOLOR = '#888888';\n        varStyle.FGCOLOR = 'red';\n        stylesheet.pushStyle({type: 'indel', method: 'missense_variant'}, null, varStyle);\n    }\n    {\n        var varStyle = new DASStyle();\n        varStyle.glyph = 'TRIANGLE';\n        varStyle.DIRECTION = 'N';\n        varStyle.BUMP = 'yes';\n        varStyle.LABEL = 'no';\n        varStyle.BGCOLOR = '#888888';\n        varStyle.FGCOLOR = 'red';\n        stylesheet.pushStyle({type: 'indel', method: 'splice_.+_variant'}, null, varStyle);\n    }\n    {\n        var varStyle = new DASStyle();\n        varStyle.glyph = 'STAR';\n        varStyle.POINTS = 6;\n        varStyle.BUMP = 'yes';\n        varStyle.LABEL = 'no';\n        varStyle.BGCOLOR = '#888888';\n        varStyle.FGCOLOR = 'red';\n        stylesheet.pushStyle({type: 'indel', method: 'regulatory_region_variant'}, null, varStyle);\n    }\n    {\n        var varStyle = new DASStyle();\n        varStyle.glyph = 'PLIMSOLL';\n        varStyle.BUMP = 'yes';\n        varStyle.LABEL = 'no';\n        varStyle.BGCOLOR = '#888888';\n        varStyle.FGCOLOR = 'red';\n        varStyle.STROKECOLOR = 'black';\n        stylesheet.pushStyle({type: 'indel'}, null, varStyle);\n    }\n\n    var wigStyle = new DASStyle();\n    wigStyle.glyph = 'BOX';\n    wigStyle.FGCOLOR = 'black';\n    wigStyle.BGCOLOR = 'orange'\n    wigStyle.HEIGHT = 8;\n    wigStyle.BUMP = true;\n    wigStyle.LABEL = true;\n    wigStyle.ZINDEX = 20;\n    stylesheet.pushStyle({type: 'default'}, null, wigStyle);\n    return callback(stylesheet);\n}\n\n\nEnsemblFeatureSource.prototype.getScales = function() {\n    return [];\n}\n\nEnsemblFeatureSource.prototype.fetch = function(chr, min, max, scale, types, pool, callback) {\n    var thisB = this;\n    var url = this.base + '/overlap/region/' + this.species + '/' + chr + ':' + min + '-' + max;\n\n    var filters = [];\n    for (var ti = 0; ti < this.type.length; ++ti) {\n        filters.push('feature=' + this.type[ti]);\n    }\n    filters.push('content-type=application/json');\n    url = url + '?' + filters.join(';');\n\n    var req = new XMLHttpRequest();\n    req.onreadystatechange = function() {\n    \tif (req.readyState == 4) {\n            thisB.busy--;\n            thisB.notifyActivity();\n\n    \t    if (req.status >= 300) {\n                var err = 'Error code ' + req.status;\n                try {\n                    var jr = JSON.parse(req.response);\n                    if (jr.error) {\n                        err = jr.error;\n                    }\n                } catch (ex) {};\n\n    \t\t    callback(err, null);\n    \t    } else {\n        \t\tvar jf = JSON.parse(req.response);\n        \t\tvar features = [];\n        \t\tfor (var fi = 0; fi < jf.length; ++fi) {\n        \t\t    var j = jf[fi];\n\n        \t\t    var notes = [];\n        \t\t    var f = new DASFeature();\n        \t\t    f.segment = chr;\n        \t\t    f.min = j['start'] | 0;\n        \t\t    f.max = j['end'] | 0;\n        \t\t    f.type = j.feature_type || 'unknown';\n        \t\t    f.id = j.ID;\n\n                    if (j.Parent) {\n                        var grp = new DASGroup();\n                        grp.id = j.Parent;\n                        f.groups = [grp];\n                    }\n\n                    if (j.strand) {\n                        if (j.strand < 0) \n                            f.orientation = '-';\n                        else if (j.strand > 0) \n                            f.orientation = '+';\n                    }\n\n                    if (j.consequence_type)\n                        f.method = j.consequence_type;\n\n                    if (j.alt_alleles) {\n                        notes.push('Alleles=' + j.alt_alleles.join('/'));\n                        if (j.alt_alleles.length > 1) {\n                            if (j.alt_alleles[1].length != j.alt_alleles[0].length || j.alt_alleles[1] == '-') {\n                                f.type = 'indel';\n                            }\n                        }\n                    }\n        \t\t    \n                    if (notes.length > 0) {\n                        f.notes = notes;\n                    }\n        \t\t    features.push(f);\n        \t\t}\n        \t\tcallback(null, features);\n    \t    }\n    \t}\n\t\n    };\n    \n    thisB.busy++;\n    thisB.notifyActivity();\n\n    req.open('GET', url, true);\n    req.responseType = 'text';\n    req.send();\n}\n\nEnsemblFeatureSource.prototype.capabilities = function() {\n    const caps = {};\n    if (this.type && this.type.indexOf('transcript') >= 0) {\n        caps.search = ['gene'];\n    }\n    return caps;\n}\n\nEnsemblFeatureSource.prototype.search = function(query, callback) {\n    const url = `${this.base}/lookup/symbol/${this.species}/${query}?content-type=application/json`;\n    const req = new XMLHttpRequest();\n    req.onreadystatechange = () => {\n        if (req.readyState == 4)\n            if (req.status >= 300 || req.status < 200) {\n                let err = 'Error code ' + req.status;\n                try {\n                    var jr = JSON.parse(req.response);\n                    if (jr.error) {\n                        err = jr.error;\n                    }\n                } catch (ex) {};\n\n                if (req.status == 400)    // E! returns an error if the lookup fails.  Who knows?\n                    return callback([]);\n                else\n                    return callback(null, err);\n            } else {\n                const resp = JSON.parse(req.response);\n                const result = [];\n\n                if (resp && resp.seq_region_name) {\n                    result.push({\n                        segment: resp.seq_region_name,\n                        min: resp.start,\n                        max: resp.end\n                    });\n                }\n                \n                return callback(result);\n            }\n    };\n\n    req.open('GET', url, true);\n    req.responseType = 'text';\n    req.send();\n}\n\ndalliance_registerSourceAdapterFactory('ensembl', function(source) {\n    return {features: new EnsemblFeatureSource(source)};\n});\n","/* -*- mode: javascript; c-basic-offset: 4; indent-tabs-mode: nil -*- */\n\n// \n// Dalliance Genome Explorer\n// (c) Thomas Down 2006-2014\n//\n// export-config.js\n//\n\nif (typeof(require) !== 'undefined') {\n    var browser = require('./cbrowser');\n    var Browser = browser.Browser;\n\n    var utils = require('./utils');\n    var shallowCopy = utils.shallowCopy;\n\n    var sha1 = require('./sha1');\n    var hex_sha1 = sha1.hex_sha1;\n\n    var das = require('./das');\n    var copyStylesheet = das.copyStylesheet;\n}\n\nBrowser.prototype.exportFullConfig = function(opts) {\n    opts = opts || {};\n\n    var config = {\n        chr: this.chr,\n        viewStart: this.viewStart|0,\n        viewEnd: this.viewEnd|0,\n        cookieKey: 'dalliance_' + hex_sha1(Date.now()),\n\n        coordSystem: this.coordSystem,\n\n        sources: this.exportSourceConfig(),\n\n        chains: this.exportChains()\n    };\n\n    if (this.prefix)\n        config.prefix = this.prefix;\n\n    return config;\n}\n\nBrowser.prototype.exportChains = function() {\n    var cc = {};\n    var cs = this.chains || {};\n    for (var k in cs) {\n        cc[k] = cs[k].exportConfig();\n    }\n    return cc;\n}\n\nBrowser.prototype.exportSourceConfig = function(opts) {\n    opts = opts || {};\n\n    var sourceConfig = [];\n    for (var ti = 0; ti < this.tiers.length; ++ti) {\n        var tier = this.tiers[ti];\n        var source = shallowCopy(tier.dasSource);\n\n        if (source.noPersist)\n            continue;\n\n        source.coords = undefined;\n        source.props = undefined;\n        if (!source.disabled)\n            source.disabled = undefined;\n\n        if (tier.config.stylesheet) {\n            source.style = copyStylesheet(tier.config.stylesheet).styles;\n            source.stylesheet_uri = undefined;\n        } else if (source.style) {\n            source.style = copyStylesheet({styles: source.style}).styles;\n        }\n\n        if (typeof(tier.config.name) === 'string') {\n            source.name = tier.config.name;\n        }\n\n        if (tier.config.height !== undefined) {\n            source.forceHeight = tier.config.height;\n        }\n        if (tier.config.forceMin !== undefined) {\n            source.forceMin = tier.config.forceMin;\n        }\n        if (tier.config.forceMinDynamic)\n            source.forceMinDynamic = tier.config.forceMinDynamic;\n        if (tier.config.forceMax !== undefined) {\n            source.forceMax = tier.config.forceMax;\n        }\n        if (tier.config.bumped !== undefined) {\n            source.bumped = tier.config.bumped;\n        }\n        if (tier.config.forceMaxDynamic)\n            source.forceMaxDynamic = tier.config.forceMaxDynamic;\n\n        sourceConfig.push(source);\n    }\n\n    return sourceConfig;\n}\n\nBrowser.prototype.exportPageTemplate = function(opts) {\n    opts = opts || {};\n    var template = '<html>\\n' +\n                   '  <head>\\n' +\n                   '    <script language=\"javascript\" src=\"' + this.resolveURL('$$dalliance-compiled.js') + '\"></script>\\n' +\n                   '    <script language=\"javascript\">\\n' +\n                   '      var dalliance_browser = new Browser(' + JSON.stringify(this.exportFullConfig(opts), null, 2) + ');\\n' +\n                   '    </script>\\n' +  \n                   '  </head>\\n' +\n                   '  <body>\\n' +\n                   '    <div id=\"svgHolder\">Dalliance goes here</div>\\n' +\n                   '  </body>\\n' +\n                   '<html>\\n';\n\n    return template;\n}","/* -*- mode: javascript; c-basic-offset: 4; indent-tabs-mode: nil -*- */\n\n// \n// Dalliance Genome Explorer\n// (c) Thomas Down 2006-2014\n//\n// export-image.js\n//\n\n\"use strict\";\n\nif (typeof(require) !== 'undefined') {\n    var browser = require('./cbrowser');\n    var Browser = browser.Browser;\n\n    var g = require('./glyphs');\n    var OverlayLabelCanvas = g.OverlayLabelCanvas;\n\n    var nf = require('./numformats');\n    var formatQuantLabel = nf.formatQuantLabel;\n    var formatLongInt = nf.formatLongInt;\n\n    var VERSION = require('./version');\n\n    var drawSeqTierGC = require('./sequence-draw').drawSeqTierGC;\n}\n\nfunction fillTextRightJustified(g, text, x, y) {\n    g.fillText(text, x - g.measureText(text).width, y);\n}\n\nBrowser.prototype.exportImage = function(opts) {\n    opts = opts || {};\n\n    var fpw = opts.width || this.featurePanelWidth;\n    var padding = 3;\n    var ypos = 0;\n    if (opts.banner || opts.region) {\n        ypos = 40;\n    }\n\n    var backupFPW = this.featurePanelWidth;\n    var backupScale = this.scale;\n    this.featurePanelWidth = fpw;\n    this.scale = this.featurePanelWidth / (this.viewEnd - this.viewStart);\n    \n    var totHeight = ypos;\n    for (var ti = 0; ti < this.tiers.length; ++ti) {\n        if (ti > 0)\n            totHeight += padding;\n        var tier = this.tiers[ti];\n\n        tier.backupSubtiers = tier.subtiers;\n        tier.backupOriginHaxx = tier.originHaxx;\n        tier.backupLayoutHeight = tier.layoutHeight;\n\n        if (tier.subtiers) {\n            const renderer = this.getTierRenderer(tier);\n            if (renderer && renderer.prepareSubtiers) {\n                renderer.prepareSubtiers(tier, tier.viewport.getContext('2d'));\n            }\n\n            if (tier.subtiers) {\n                var lh = tier.padding;\n                for (var s = 0; s < tier.subtiers.length; ++s) {\n                    lh = lh + tier.subtiers[s].height + tier.padding;\n                }\n                lh += 6\n                tier.layoutHeight = Math.max(lh, this.minTierHeight);\n            }\n        }\n\n        if (tier.layoutHeight !== undefined)\n                totHeight += tier.layoutHeight;\n    }\n    var mult = opts.resolutionMultiplier || 1.0;\n    var margin = 200;\n\n    var cw = ((fpw + margin) * mult)|0;\n    var ch = (totHeight * mult)|0;\n    var c = makeElement('canvas', null, {width: cw, height: ch});\n    var g = c.getContext('2d');\n    g.fillStyle = 'white';\n    g.fillRect(0, 0, cw, ch);\n\n    g.scale(mult, mult);\n\n    if (opts.region) {\n        g.save();\n        g.fillStyle = 'black';\n        g.font = '12pt sans-serif';\n        g.fillText(\n            this.chr + ':' + formatLongInt(this.viewStart) + '..' + formatLongInt(this.viewEnd),\n            margin + 100,\n            28\n        );\n        g.restore();\n    }\n\n    if (opts.banner) {\n        g.save();\n        g.fillStyle = 'black';\n        g.font = '12pt sans-serif';\n        fillTextRightJustified(g, 'Graphics from Biodalliance ' + VERSION, margin + fpw - 100, 28);\n        g.restore();\n    }\n\n    g.font = '10px sans-serif';\n    \n    for (var ti = 0; ti < this.tiers.length; ++ti) {\n        var tier = this.tiers[ti];\n        var offset = ((tier.glyphCacheOrigin - this.viewStart)*this.scale);\n\n        var oc = new OverlayLabelCanvas();\n        g.save();       // 1\n        g.translate(0, ypos);\n\n        g.save();       // 2\n        g.beginPath();\n        g.moveTo(margin, 0);\n        g.lineTo(margin + fpw, 0);\n        g.lineTo(margin + fpw, tier.layoutHeight);\n        g.lineTo(margin, tier.layoutHeight);\n        g.closePath();\n        g.clip();\n        g.translate(margin, 0);\n\n        g.save();      // 3\n        g.translate(offset, 0);\n        if (tier.subtiers) {\n            tier.paintToContext(g, oc, offset + 1000);\n            \n        } else {\n            drawSeqTierGC(tier, tier.currentSequence, g);\n        }\n        g.restore();   // 2\n        \n        g.save()       // 3\n        g.translate(offset, 0);\n        oc.draw(g, -offset, fpw - offset);\n        g.restore();   // 2\n        g.restore();   // 1\n\n        var hasQuant = false;\n        var pos = 0;\n        var subtiers = tier.subtiers || [];\n        for (var sti = 0; sti < subtiers.length; ++sti) {\n            var subtier = subtiers[sti];\n                    \n            if (subtier.quant) {\n                hasQuant = true;\n                var q = subtier.quant;\n                var h = subtier.height;\n\n                var numTics = 2;\n                if (h > 40) {\n                    numTics = 1 + ((h/20) | 0);\n                }\n                var ticSpacing = h / (numTics - 1);\n                var ticInterval = (q.max - q.min) / (numTics - 1);\n\n                g.beginPath();\n                g.moveTo(margin + 5, pos);\n                g.lineTo(margin, pos);\n                g.lineTo(margin, pos + subtier.height);\n                g.lineTo(margin + 5, pos + subtier.height);\n                for (var t = 1; t < numTics-1; ++t) {\n                    var ty = t*ticSpacing;\n                    g.moveTo(margin, pos + ty);\n                    g.lineTo(margin+3, pos + ty);\n                }\n                g.strokeStyle = 'black';\n                g.strokeWidth = 2;\n                g.stroke();\n\n                g.fillStyle = 'black';\n                fillTextRightJustified(g, formatQuantLabel(q.max), margin - 3, pos + 7);\n                fillTextRightJustified(g, formatQuantLabel(q.min), margin - 3, pos + subtier.height);\n                for (var t = 1; t < numTics-1; ++t) {\n                    var ty = t*ticSpacing;\n                    fillTextRightJustified(g, formatQuantLabel((1.0*q.max) - (t*ticInterval)), margin - 3, pos + ty + 3);\n                }\n            }\n\n            pos += subtier.height + padding;\n        }\n\n        var labelName;\n        if (typeof tier.config.name === 'string')\n            labelName = tier.config.name;\n        else\n            labelName = tier.dasSource.name;\n        var labelWidth = g.measureText(labelName).width;\n        g.fillStyle = 'black';\n        g.fillText(labelName, margin - (hasQuant ? 28 : 12) - labelWidth, (tier.layoutHeight + 3) / 2);\n\n        g.restore(); // 0\n\n        ypos += tier.layoutHeight + padding;\n\n        tier.subtiers = tier.backupSubtiers;\n        tier.originHaxx = tier.backupOriginHaxx;\n        tier.layoutHeight = tier.backupLayoutHeight;\n    }\n\n    if (opts.highlights) {\n        g.save();\n\n        g.beginPath();\n        g.moveTo(margin, 0);\n        g.lineTo(margin + fpw, 0);\n        g.lineTo(margin + fpw, ypos);\n        g.lineTo(margin, ypos);\n        g.closePath();\n        g.clip();\n\n        g.translate(margin + offset, 0);\n        var origin = this.viewStart;\n        var visStart = this.viewStart;\n        var visEnd = this.viewEnd;\n\n        for (var hi = 0; hi < this.highlights.length; ++hi) {\n            var h = this.highlights[hi];\n            if (((h.chr === this.chr) || (h.chr === ('chr' + this.chr))) && h.min < visEnd && h.max > visStart) {\n                g.globalAlpha = this.defaultHighlightAlpha;\n                g.fillStyle = this.defaultHighlightFill;\n                g.fillRect((h.min - origin) * this.scale,\n                           0,\n                           (h.max - h.min) * this.scale,\n                           ypos);\n            }\n        } \n        g.restore();\n    }\n\n    var rulerPos = -1; \n    if (opts.ruler == 'center') {\n        rulerPos = margin + ((this.viewEnd - this.viewStart + 1)*this.scale) / 2;\n    } else if (opts.ruler == 'left') {\n        rulerPos = margin;\n    } else if (opts.ruler == 'right') {\n        rulerPos = margin + ((this.viewEnd - this.viewStart + 1)*this.scale);\n    }\n    if (rulerPos >= 0) {\n        g.strokeStyle = 'blue';\n        g.beginPath();\n        g.moveTo(rulerPos, 0);\n        g.lineTo(rulerPos, ypos);\n        g.stroke();\n    }\n\n    this.featurePanelWidth = backupFPW;\n    this.scale = backupScale;\n\n    return c.toDataURL('image/png');\n}\n","/* -*- mode: javascript; c-basic-offset: 4; indent-tabs-mode: nil -*- */\n\n// \n// Dalliance Genome Explorer\n// (c) Thomas Down 2006-2014\n//\n// export-ui.js\n//\n\nif (typeof(require) !== 'undefined') {\n    var browser = require('./cbrowser');\n    var Browser = browser.Browser;\n\n    var utils = require('./utils');\n    var makeElement = utils.makeElement;\n    var removeChildren = utils.removeChildren;\n}\n\nBrowser.prototype.openExportPanel = function() {\n    var b = this;\n    if (this.uiMode === 'export') {\n        this.hideToolPanel();\n        this.setUiMode('none');\n    } else {\n        var exportForm = makeElement('div', null, {className: 'export-form'});\n        var exportSelect = makeElement('select');\n        exportSelect.appendChild(makeElement('option', 'SVG', {value: 'svg'}));\n        exportSelect.appendChild(makeElement('option', 'Image', {value: 'png'}));\n        exportSelect.appendChild(makeElement('option', 'Dalliance config', {value: 'config'}));\n        exportSelect.appendChild(makeElement('option', 'Dalliance sources', {value: 'sources'}));\n        exportSelect.appendChild(makeElement('option', 'Dalliance page', {value: 'page'}));\n        exportSelect.value = 'svg';\n\n        exportSelect.addEventListener('change', function(ev) {\n            removeChildren(exportContent);\n            setupEOT();\n        }, false);\n        exportForm.appendChild(makeElement('p', ['Export as: ', exportSelect]));\n\n        var exportHighlightsToggle = makeElement('input', null, {type: 'checkbox', checked: this.exportHighlights});\n        exportHighlightsToggle.addEventListener('change', function(ev) {\n            b.exportHighlights = exportHighlightsToggle.checked;\n            b.storeStatus();\n        }, false);\n        var exportRulerToggle = makeElement('input', null, {type: 'checkbox', checked: this.exportRuler});\n        exportRulerToggle.addEventListener('change', function(ev) {\n            b.exportRuler = exportRulerToggle.checked;\n            b.storeStatus();\n        }, false);\n        var exportRegionToggle = makeElement('input', null, {type: 'checkbox', checked: this.exportRegion});\n        exportRegionToggle.addEventListener('change', function(ev) {\n            b.exportRegion = exportRegionToggle.checked;\n            b.storeStatus();\n        }, false);\n        var exportBannerToggle = makeElement('input', null, {type: 'checkbox', checked: this.exportBanner});\n        exportBannerToggle.addEventListener('change', function(ev) {\n            b.exportBanner = exportBannerToggle.checked;\n            b.storeStatus();\n        }, false);\n        var exportScale = makeElement('input', null, {type: 'text', value: '1.0'});\n        var exportWidth = makeElement('input', null, {type: 'text', value: '800'});\n\n        var exportButton = makeElement('button', 'Export', {className: 'btn btn-primary'});\n        exportButton.addEventListener('click', function(ev) {\n            removeChildren(exportContent);\n\n            var blobURL;\n            var note, type, name;\n            if (exportSelect.value === 'svg') {\n                blobURL = URL.createObjectURL(b.makeSVG({highlights: exportHighlightsToggle.checked,\n                                                         banner: b.exportBanner,\n                                                         region: b.exportRegion,\n                                                         ruler: exportRulerToggle.checked ? b.rulerLocation : 'none',\n                                                         width: parseInt(exportWidth.value) || 800}));\n                note = 'SVG';\n                type = 'image/svg';\n                name = 'dalliance-view.svg';\n            } else if (exportSelect.value === 'png') {\n                var mult = parseFloat(exportScale.value);\n                if (mult < 0.1 || mult > 10) {\n                    alert('bad scale ' + mult);\n                    return;\n                }\n\n                blobURL = b.exportImage({highlights: exportHighlightsToggle.checked,\n                                         banner: b.exportBanner,\n                                         region: b.exportRegion,\n                                         ruler: exportRulerToggle.checked ? b.rulerLocation : 'none',\n                                         resolutionMultiplier: mult,\n                                         width: parseInt(exportWidth.value) || 800});\n                note = 'Image';\n                type = 'image/png';\n                name = 'dalliance-view.png';\n            } else if (exportSelect.value === 'config') {\n                var config = JSON.stringify(b.exportFullConfig(), null, 2);\n                var blob = new Blob([config], {type: 'text/plain'});\n                blobURL = URL.createObjectURL(blob);\n                note = 'Configuration';\n                type = 'text/plain';\n                name = 'dalliance-config.json';\n            } else if (exportSelect.value === 'sources') {\n                var config = JSON.stringify(b.exportSourceConfig(), null, 2);\n                var blob = new Blob([config], {type: 'text/plain'});\n                blobURL = URL.createObjectURL(blob);\n                note = 'Source array';\n                type = 'text/plain';\n                name = 'dalliance-sources.json';\n            } else if (exportSelect.value === 'page') {\n                var page = b.exportPageTemplate();\n                var type = 'text/html';\n                var blob = new Blob([page], {type: type});\n                blobURL = URL.createObjectURL(blob);\n                note = 'Page template';\n                name = 'dalliance-view.html';\n            }\n\n            if (blobURL) {\n                var downloadLink = makeElement('a', '[Download]', {\n                    href: blobURL,\n                    download: name,\n                    type: type\n                });\n\n                var previewLink = makeElement('a', '[Preview in browser]', {\n                    href: blobURL,\n                    type: type,\n                    target: '_new'\n                });\n\n                exportContent.appendChild(makeElement('p', ['' + note + ' created: ', downloadLink, previewLink]));\n            }\n        }, false);\n\n        b.addViewListener(function() {\n            removeChildren(exportContent);\n        });\n        b.addTierListener(function() {\n            removeChildren(exportContent);\n        });\n\n        var exportContent = makeElement('p', '');\n\n        var eotHighlights = makeElement('tr',\n                [makeElement('th', 'Include highlights', {}, {width: '400px', textAlign: 'right'}),\n                 makeElement('td', exportHighlightsToggle)]);\n        var eotGuideline = makeElement('tr',\n                [makeElement('th', 'Include vertical guideline', {}, {textAlign: 'right'}),\n                 makeElement('td', exportRulerToggle)]);\n        var eotScale = makeElement('tr',\n            [makeElement('th', 'Scale multiplier', {}, {textAlign: 'right'}),\n             makeElement('td', exportScale)]);\n        var eotWidth = makeElement('tr',\n            [makeElement('th', 'Width (logical px)', {}, {textAlign: 'right'}),\n             makeElement('td', exportWidth)]);\n        var eotRegion = makeElement('tr',\n            [makeElement('th', 'Label with genomic coordinates', {}, {textAlign: 'right'}),\n             makeElement('td', exportRegionToggle)]);\n        var eotBanner = makeElement('tr',\n            [makeElement('th', 'Include banner', {}, {textAlign: 'right'}),\n             makeElement('td', exportBannerToggle)]);\n\n        var exportOptsTable = makeElement('table',\n            [eotHighlights,\n             eotGuideline,\n             eotWidth,\n             eotScale,\n             eotRegion], null, {width: '500px'});\n        var setupEOT = function() {\n            var es = exportSelect.value;\n            eotHighlights.style.display = (es == 'svg' || es == 'png') ? 'table-row' : 'none';\n            eotGuideline.style.display = (es == 'svg' || es == 'png') ? 'table-row' : 'none';\n            eotScale.style.display = (es == 'png') ? 'table-row' : 'none';\n            eotWidth.style.display = (es == 'svg' || es == 'png') ? 'table-row' : 'none';\n            eotRegion.style.display = (es == 'svg' || es == 'png') ? 'table-row' : 'none';\n            eotBanner.style.display = (es == 'svg' || es == 'png') ? 'table-row' : 'none';\n        }\n        setupEOT();\n\n        exportForm.appendChild(exportOptsTable);\n        exportForm.appendChild(exportButton);\n        exportForm.appendChild(exportContent);\n\n        if (this.uiMode !== 'none')\n            this.hideToolPanel();\n        this.browserHolder.insertBefore(exportForm, this.svgHolder);\n        this.activeToolPanel = exportForm;\n\n        this.setUiMode('export');\n    }\n}\n","/* -*- mode: javascript; c-basic-offset: 4; indent-tabs-mode: nil -*- */\n\n// \n// Dalliance Genome Explorer\n// (c) Thomas Down 2006-2014\n//\n// exports.js: shim to export symbols into global namespace for ease of embedding\n//\n\nvar browser = require('./cbrowser');\nvar chainset = require('./chainset');\nvar sa = require('./sourceadapters');\nvar utils = require('./utils');\nvar das = require('./das');\nvar sc = require('./sourcecompare');\n\nwindow.Browser = browser.Browser;\nwindow.sourcesAreEqual = sc.sourcesAreEqual;\nwindow.Chainset = chainset.Chainset;    // Pre-0.12 configurations need this.\n\n// Useful for info plugins.  Should be reconsidered in the future.\nwindow.makeElement = utils.makeElement;\n\n// Allow source plugins to be loaded separately.\nwindow.dalliance_registerSourceAdapterFactory = sa.registerSourceAdapterFactory;\nwindow.dalliance_registerParserFactory = sa.registerParserFactory;\nwindow.dalliance_makeParser = sa.makeParser;\n\n// DAS* objects for some plugins -- remove when plugin API changes...\n\nwindow.DASSequence = das.DASSequence;\nwindow.DASFeature = das.DASFeature;\nwindow.DASGroup = das.DASGroup;\nwindow.DASStylesheet = das.DASStylesheet;\nwindow.DASStyle = das.DASStyle;\nwindow.DASSource = das.DASSource;    // Pre-0.8 configurations used this.  Still some around...\n\nvar ruler = require(\"./rulers\");\nwindow.Ruler = ruler.Ruler;\nwindow.rulerDrawCallback = ruler.rulerDrawCallback;\n","//\n// Dalliance Genome Explorer\n// (c) Thomas Down 2006-2010\n//\n// feature-draw.js: new feature-tier renderer\n//\n\n\"use strict\";\n\nif (typeof(require) !== 'undefined') {\n    var tier = require('./tier');\n    var DasTier = tier.DasTier;\n\n    var nf = require('./numformats');\n    var formatQuantLabel = nf.formatQuantLabel;\n}\n\nfunction SubTier() {\n    this.glyphs = [];\n    this.height = 0;\n    this.quant = null;\n}\n\nSubTier.prototype.indexFor = function(glyph) {\n    var gmin = glyph.min();\n    var lb = 0, ub = this.glyphs.length;\n    while (ub > lb) {\n        var mid = ((lb + ub)/2)|0;\n        if (mid >= this.glyphs.length)\n            return this.glyphs.length;\n        var mg = this.glyphs[mid];\n        if (gmin < mg.min()) {\n            ub = mid;\n        } else {\n            lb = mid + 1;\n        }\n    }\n    return ub;\n}\n\nSubTier.prototype.add = function(glyph) {\n    var ind = this.indexFor(glyph);\n    this.glyphs.splice(ind, 0, glyph);\n    this.height = Math.max(this.height, glyph.height());\n    if (glyph.quant && this.quant == null) {\n        this.quant = glyph.quant;\n    }\n}\n\nSubTier.prototype.hasSpaceFor = function(glyph) {\n    var ind = this.indexFor(glyph);\n    if (ind > 0 && this.glyphs[ind-1].max() >= glyph.min())\n        return false;\n    if (ind < this.glyphs.length && this.glyphs[ind].min() <= glyph.max())\n        return false;\n\n    return true;\n}\n\nDasTier.prototype.paintToContext = function(gc, oc, offset) {\n    var subtiers = this.subtiers;\n    var fpw = this.viewport.width|0;\n\n    gc.save();\n    for (var s = 0; s < subtiers.length; ++s) {\n        var quant = null;\n        var glyphs = subtiers[s].glyphs;\n        for (var i = 0; i < glyphs.length; ++i) {\n            var glyph = glyphs[i];\n            if (glyph.min() < fpw-offset && glyph.max() > -offset) {\n                var glyph = glyphs[i];\n                glyph.draw(gc, oc);\n                if (glyph.quant) {\n                    quant = glyph.quant;\n                }\n            }\n        }\n\n\tif (quant && quant.min < 0 && quant.max > 0 && this.dasSource.zeroLine) {\n\t    var ry = subtiers[0].height * (quant.max / (quant.max - quant.min))\n\t    gc.save();\n\t    gc.strokeStyle = this.dasSource.zeroLine;\n\t    gc.lineWidth = 0.5;\n\t    gc.beginPath();\n\t    gc.moveTo(-1000, ry);\n\t    gc.lineTo(fpw + 1000, ry);\n\t    gc.stroke();\n\t    gc.restore();\n\t}\n\n        if (this.scaleVertical) {\n            var scale = this.browser.scale;\n            gc.translate(0, scale + this.padding);\n            oc.translate(0, scale + this.padding);\n        } else {\n            gc.translate(0, subtiers[s].height + this.padding);\n            oc.translate(0, subtiers[s].height + this.padding);\n        }\n    }\n    gc.restore();\n\n    if (quant && this.quantLeapThreshold && this.featureSource && this.browser.sourceAdapterIsCapable(this.featureSource, 'quantLeap')) {\n        var ry = subtiers[0].height * (1.0 - ((this.quantLeapThreshold - quant.min) / (quant.max - quant.min)));\n\n        gc.save();\n        gc.strokeStyle = 'red';\n        gc.lineWidth = 0.3;\n        gc.beginPath();\n        gc.moveTo(-1000, ry);\n        gc.lineTo(fpw + 1000, ry);\n        gc.stroke();\n        gc.restore();\n    }\n}\n\nDasTier.prototype.paintQuant = function() {\n    if (!this.quantOverlay)\n        return;\n\n    var retina = this.browser.retina && window.devicePixelRatio > 1;\n\n    var quant;\n    if (this.subtiers && this.subtiers.length > 0)\n        quant = this.subtiers[0].quant;\n\n    if (quant) {\n        var h = this.subtiers[0].height;\n        var w = 50;\n        this.quantOverlay.height = this.viewport.height;\n        this.quantOverlay.width = retina ? w*2 : w;\n        this.quantOverlay.style.height = '' + (retina ? this.quantOverlay.height/2 : this.quantOverlay.height) + 'px';\n        this.quantOverlay.style.width = '' + w + 'px';\n        this.quantOverlay.style.display = 'block';\n        var ctx = this.quantOverlay.getContext('2d');\n        if (retina)\n            ctx.scale(2, 2);\n\n        var numTics = 2;\n        if (h > 40) {\n            numTics = 1 + ((h/20) | 0);\n        }\n        var ticSpacing = (h + this.padding*2) / (numTics - 1);\n        var ticInterval = (quant.max - quant.min) / (numTics - 1);\n\n        ctx.fillStyle = 'white'\n        ctx.globalAlpha = 0.6;\n        if (this.browser.rulerLocation == 'right') {\n            ctx.fillRect(w-30, 0, 30, h + this.padding*2);\n        } else {\n            ctx.fillRect(0, 0, 30, h + this.padding*2);\n        }\n        ctx.globalAlpha = 1.0;\n\n        ctx.strokeStyle = 'black';\n        ctx.lineWidth = 1;\n        ctx.beginPath();\n\n        if (this.browser.rulerLocation == 'right') {\n            ctx.moveTo(w - 8, this.padding);\n            ctx.lineTo(w, this.padding);\n            ctx.lineTo(w, h + this.padding);\n            ctx.lineTo(w - 8, h + this.padding);\n            for (var t = 1; t < numTics-1; ++t) {\n                var ty = t*ticSpacing;\n                ctx.moveTo(w, ty);\n                ctx.lineTo(w - 5, ty);\n            }\n        } else {\n            ctx.moveTo(8, this.padding);\n            ctx.lineTo(0, this.padding);\n            ctx.lineTo(0, h + this.padding);\n            ctx.lineTo(8, h + this.padding);\n            for (var t = 1; t < numTics-1; ++t) {\n                var ty = t*ticSpacing;\n                ctx.moveTo(0, ty);\n                ctx.lineTo(5, ty);\n            }\n        }\n        ctx.stroke();\n\n        ctx.fillStyle = 'black';\n\n        if (this.browser.rulerLocation == 'right') {\n            ctx.textAlign = 'right';\n            ctx.fillText(formatQuantLabel(quant.max), w-9, 8);\n            ctx.fillText(formatQuantLabel(quant.min), w-9, h + this.padding);\n            for (var t = 1; t < numTics-1; ++t) {\n                var ty = t*ticSpacing;\n                ctx.fillText(formatQuantLabel((1.0*quant.max) - (t*ticInterval)), w - 9, ty + 3);\n            }\n        } else {\n            ctx.textAlign = 'left';\n            ctx.fillText(formatQuantLabel(quant.max), 9, 8);\n            ctx.fillText(formatQuantLabel(quant.min), 9, h + this.padding);\n            for (var t = 1; t < numTics-1; ++t) {\n                var ty = t*ticSpacing;\n                ctx.fillText(formatQuantLabel((1.0*quant.max) - (t*ticInterval)), 9, ty + 3);\n            }\n        }\n    } else {\n        this.quantOverlay.style.display = 'none';\n    }\n}\n\nDasTier.prototype.styleForFeature = function(f) {\n    var ssScale = this.browser.zoomForCurrentScale();\n\n    if (!this.stylesheet) {\n        return null;\n    }\n\n    var maybe = null;\n    var ss = this.stylesheet.styles;\n    for (var si = 0; si < ss.length; ++si) {\n        var sh = ss[si];\n        if (sh.zoom && sh.zoom != ssScale) {\n            continue;\n        }\n\n        if (sh.orientation) {\n            if (sh.orientation != f.orientation) {\n                continue;\n            }\n        }\n\n        var labelRE = sh._labelRE;\n        if (!labelRE || !labelRE.test) {\n            labelRE = new RegExp('^' + sh.label + '$');\n            sh._labelRE = labelRE;\n        }\n        if (sh.label && !(labelRE.test(f.label))) {\n            continue;\n        }\n        var methodRE = sh._methodRE;\n        if (!methodRE || !methodRE.test) {\n            methodRE = new RegExp('^' + sh.method + '$');\n            sh._methodRE = methodRE;\n        }\n        if (sh.method && !(methodRE.test(f.method))) {\n            continue;\n        }\n        if (sh.type) {\n            if (sh.type == 'default') {\n                if (!maybe) {\n                    maybe = sh.style;\n                }\n                continue;\n            } else {\n                var typeRE = sh._typeRE;\n                if (!typeRE || !typeRE.test) {\n                    typeRE = new RegExp('^' + sh.type + '$');\n                    sh._typeRE = typeRE;\n                }\n                if (!typeRE.test(f.type))\n                    continue;\n            }\n        }\n        return sh.style;\n    }\n    return maybe;\n}\n\nDasTier.prototype.quantMin = function(style) {\n    if (this.forceMinDynamic) {\n        return this.currentFeaturesMinScore || 0;\n    } else if (typeof(this.forceMin) === 'number') {\n        return this.forceMin;\n    } else {\n        const softMin = typeof(style.SOFTMIN) !== 'undefined' ? style.SOFTMIN : Number.MAX_VALUE;\n        return style.MIN || Math.min(softMin, this.currentFeaturesMinScore || 0);\n    }\n}\n\nDasTier.prototype.quantMax = function(style) {\n    if (this.forceMaxDynamic) {\n        return this.currentFeaturesMaxScore || 0;\n    } else if (typeof(this.forceMax) === 'number') {\n        return this.forceMax;\n    } else {\n        const softMax = typeof(style.SOFTMAX) !== 'undefined' ? style.SOFTMAX : Number.MIN_VALUE;\n        return style.MAX || Math.max(softMax, this.currentFeaturesMaxScore || 0);\n    }\n}\n\nif (typeof(module) !== 'undefined') {\n    module.exports = {\n        SubTier: SubTier\n    };\n}\n","/* -*- mode: javascript; c-basic-offset: 4; indent-tabs-mode: nil -*- */\n\n// \n// Dalliance Genome Explorer\n// (c) Thomas Down 2006-2011\n//\n// feature-popup.js\n//\n\n\"use strict\";\n\nif (typeof(require) !== 'undefined') {\n    var browser = require('./cbrowser');\n    var Browser = browser.Browser;\n\n    var utils = require('./utils');\n    var pick = utils.pick;\n    var pushnew = utils.pushnew;\n    var makeElement = utils.makeElement;\n}\n\n\nvar TAGVAL_NOTE_RE = new RegExp('^([A-Za-z_-]+)=(.+)');\n\nBrowser.prototype.addFeatureInfoPlugin = function(handler) {\n    if (!this.featureInfoPlugins) {\n        this.featureInfoPlugins = [];\n    }\n    this.featureInfoPlugins.push(handler);\n}\n\nfunction FeatureInfo(hit, feature, group) {\n    var name = pick(group.type, feature.type);\n    var fid = pick(group.label, feature.label, group.id, feature.id);\n    if (fid && fid.indexOf('__dazzle') != 0) {\n        name = name + ': ' + fid;\n    }\n\n    this.hit = hit;\n    this.feature = feature;\n    this.group = group;\n    this.title = name;\n    this.sections = [];\n}\n\nFeatureInfo.prototype.setTitle = function(t) {\n    this.title = t;\n}\n\nFeatureInfo.prototype.add = function(label, info) {\n    if (typeof info === 'string') {\n        info = makeElement('span', info);\n    }\n    this.sections.push({label: label, info: info});\n}\n\nBrowser.prototype.featurePopup = function(ev, __ignored_feature, hit, tier) {\n    var hi = hit.length;\n    var feature = --hi >= 0 ? hit[hi] : {};\n    var group = --hi >= 0 ? hit[hi] : {};\n\n    var featureInfo = new FeatureInfo(hit, feature, group);\n    featureInfo.tier = tier;\n    var fips = this.featureInfoPlugins || [];\n    for (var fipi = 0; fipi < fips.length; ++fipi) {\n        try {\n            fips[fipi](feature, featureInfo);\n        } catch (e) {\n            console.log(e.stack || e);\n        }\n    }\n    fips = tier.featureInfoPlugins || [];\n    for (fipi = 0; fipi < fips.length; ++fipi) {\n        try {\n            fips[fipi](feature, featureInfo);\n        } catch (e) {\n            console.log(e.stack || e);\n        }\n    }\n\n    this.removeAllPopups();\n\n    var table = makeElement('table', null, {className: 'table table-striped table-condensed'});\n    table.style.width = '100%';\n    table.style.margin = '0px';\n\n    var idx = 0;\n    if (feature.method && !tier.dasSource.suppressMethod) {\n        var row = makeElement('tr', [\n            makeElement('th', 'Method'),\n            makeElement('td', feature.method)\n        ]);\n        table.appendChild(row);\n        ++idx;\n    }\n    {\n        var loc;\n        if (group.segment) {\n            loc = group;\n        } else {\n            loc = feature;\n        }\n        var row = makeElement('tr', [\n            makeElement('th', 'Location'),\n            makeElement('td', loc.segment + ':' + loc.min + '-' + loc.max, {}, {minWidth: '200px'})\n        ]);\n        table.appendChild(row);\n        ++idx;\n    }\n    if (feature.score !== undefined && feature.score !== null && feature.score != '-'\n        && !feature.suppressScore && !tier.dasSource.suppressScore\n    ) {\n        var row = makeElement('tr', [\n            makeElement('th', 'Score'),\n            makeElement('td', '' + feature.score)\n        ]);\n        table.appendChild(row);\n        ++idx;\n    }\n    {\n        var links = maybeConcat(group.links, feature.links);\n        if (links && links.length > 0) {\n            var row = makeElement('tr', [\n                makeElement('th', 'Links'),\n                makeElement('td', links.map(function(l) {\n                    return makeElement('div', makeElement('a', l.desc, {href: l.uri, target: '_new'}));\n                }))\n            ]);\n            table.appendChild(row);\n            ++idx;\n        }\n    }\n    {\n        var notes = maybeConcat(group.notes, feature.notes);\n        for (var ni = 0; ni < notes.length; ++ni) {\n            var k = 'Note';\n            var v = notes[ni];\n            var m = v.match(TAGVAL_NOTE_RE);\n            if (m) {\n                k = m[1];\n                v = m[2];\n            }\n\n            var row = makeElement('tr', [\n                makeElement('th', k),\n                makeElement('td', v)\n            ]);\n            table.appendChild(row);\n            ++idx;\n        }\n    }\n\n    for (var fisi = 0; fisi < featureInfo.sections.length; ++fisi) {\n        var section = featureInfo.sections[fisi];\n        table.appendChild(makeElement('tr', [\n            makeElement('th', section.label),\n            makeElement('td', section.info)]));\n    }        \n\n    this.popit(ev, featureInfo.title || 'Feature', table, {width: 450});\n}\n\nfunction maybeConcat(a, b) {\n    var l = [];\n    if (a) {\n        for (var i = 0; i < a.length; ++i) {\n            pushnew(l, a[i]);\n        }\n    }\n    if (b) {\n        for (var i = 0; i < b.length; ++i) {\n            pushnew(l, b[i]);\n        }\n    }\n    return l;\n}\n","\"use strict\";\n\nif (typeof(require) !== 'undefined') {\n    var utils = require('./utils');\n    var pusho = utils.pusho;\n    var pushnewo = utils.pushnewo;\n}\n\nfunction sortFeatures(tier)\n{\n    var dmin = tier.browser.drawnStart, dmax = tier.browser.drawnEnd;\n    var ungroupedFeatures = {};\n    var groupedFeatures = {};\n    var drawnGroupedFeatures = {};\n    var groupMins = {}, groupMaxes = {};\n    var groups = {};\n    var superGroups = {};\n    var groupsToSupers = {};\n    var nonPositional = [];\n    var minScore, maxScore;\n    var fbid;\n\n    var init_fbid = function() {\n        fbid = {};\n        for (var fi = 0; fi < tier.currentFeatures.length; ++fi) {\n            var f = tier.currentFeatures[fi];\n            if (f.id) {\n                fbid[f.id] = f;\n            }\n        }\n    };\n    \n    var superParentsOf = function(f) {\n        // FIXME: should recur.\n        var spids = [];\n        if (f.parents) {\n            for (var pi = 0; pi < f.parents.length; ++pi) {\n                var pid = f.parents[pi];\n                var p = fbid[pid];\n                if (!p) {\n                    continue;\n                }\n                // alert(p.type + ':' + p.typeCv);\n                if (p.typeCv == 'SO:0000704') {\n                    pushnew(spids, pid);\n                }\n            }\n        }\n        return spids;\n    }\n\n    for (var fi = 0; fi < tier.currentFeatures.length; ++fi) {\n        var f = tier.currentFeatures[fi];\n        if (f.parts) {\n            continue;\n        }\n\n        var drawn = f.min <= dmax && f.max >= dmin;\n\n        if (!f.min || !f.max) {\n            nonPositional.push(f);\n            continue;\n        }\n\n        if (f.score && f.score != '.' && f.score != '-') {\n            var sc = 1.0 * f.score;\n            if (!minScore || sc < minScore) {\n                minScore = sc;\n            }\n            if (!maxScore || sc > maxScore) {\n                maxScore = sc;\n            }\n        }\n\n        var fGroups = [];\n        var fSuperGroup = null;\n        if (f.groups) {\n            for (var gi = 0; gi < f.groups.length; ++gi) {\n                var g = f.groups[gi];\n                var gid = g.id;\n                if (g.type == 'gene') {\n                    // Like a super-grouper...\n                    fSuperGroup = gid; \n                    groups[gid] = g;\n                } else if (g.type == 'translation') {\n                    // have to ignore this to get sensible results from bj-e :-(.\n                } else {\n                    pusho(groupedFeatures, gid, f);\n                    groups[gid] = g;\n                    fGroups.push(gid);\n\n                    var ogm = groupMins[gid];\n                    if (!ogm || f.min < ogm)\n                        groupMins[gid] = f.min;\n\n                    ogm = groupMaxes[gid];\n                    if (!ogm || f.max > ogm)\n                        groupMaxes[gid] = f.max;\n                }\n            }\n        }\n\n        if (f.parents) {\n            if (!fbid) {\n                init_fbid();\n            }\n            for (var pi = 0; pi < f.parents.length; ++pi) {\n                var pid = f.parents[pi];\n                var p = fbid[pid];\n                if (!p) {\n                    // alert(\"couldn't find \" + pid);\n                    continue;\n                }\n                if (!p.parts) {\n                    p.parts = [f];\n                }\n                pushnewo(groupedFeatures, pid, p);\n                pusho(groupedFeatures, pid, f);\n                \n                if (!groups[pid]) {\n                    groups[pid] = {\n                        type: p.type,\n                        id: p.id,\n                        label: p.label || p.id\n                    };\n                }\n                fGroups.push(pid);\n\n                var ogm = groupMins[pid];\n                if (!ogm || f.min < ogm)\n                    groupMins[pid] = f.min;\n\n                ogm = groupMaxes[pid];\n                if (!ogm || f.max > ogm)\n                    groupMaxes[pid] = f.max;\n\n                var sgs = superParentsOf(p);\n                if (sgs.length > 0) {\n                    fSuperGroup = sgs[0];\n                    var sp = fbid[sgs[0]];\n                    groups[sgs[0]] = {\n                        type: sp.type,\n                        id: sp.id,\n                        label: sp.label || sp.id\n                    };\n                    if (!tier.dasSource.collapseSuperGroups) {\n                        tier.dasSource.collapseSuperGroups = true;\n                    }\n                }\n            }   \n        }\n\n        if (fGroups.length == 0) {\n            if (drawn)\n                pusho(ungroupedFeatures, f.type, f);\n        } else if (fSuperGroup) {\n            for (var g = 0; g < fGroups.length; ++g) {\n                var gid = fGroups[g];\n                pushnewo(superGroups, fSuperGroup, gid);\n                groupsToSupers[gid] = fSuperGroup;\n            } \n        }       \n    }\n\n    for (var gid in groupedFeatures) {\n        var group = groups[gid];\n        if (typeof(group.min) !== 'number') \n            group.min = groupMins[gid];\n        if (typeof(group.max) !== 'number') \n            group.max = groupMaxes[gid];\n\n        if (groupMaxes[gid] >= dmin && groupMins[gid] <= dmax)\n            drawnGroupedFeatures[gid] = groupedFeatures[gid];\n    }\n\n    tier.ungroupedFeatures = ungroupedFeatures;\n    tier.groupedFeatures = drawnGroupedFeatures;\n    tier.groups = groups;\n    tier.superGroups = superGroups;\n    tier.groupsToSupers = groupsToSupers;\n\n    if (minScore) {\n        if (minScore > 0) {\n            minScore = 0;\n        } else if (maxScore < 0) {\n            maxScore = 0;\n        }\n        tier.currentFeaturesMinScore = minScore;\n        tier.currentFeaturesMaxScore = maxScore;\n    }\n}\n\nif (typeof(module) !== 'undefined') {\n    module.exports = {\n        sortFeatures: sortFeatures\n    };\n}\n","/* -*- mode: javascript; c-basic-offset: 4; indent-tabs-mode: nil -*- */\n\n// \n// Dalliance Genome Explorer\n// (c) Thomas Down 2006-2010\n//\n// glyphs.js: components which know how to draw themselves\n//\n\n\"use strict\";\n\nif (typeof(require) !== 'undefined') {\n    var spans = require('./spans');\n    var union = spans.union;\n    var Range = spans.Range;\n\n    var utils = require('./utils');\n    var makeElementNS = utils.makeElementNS;\n    var AMINO_ACID_TRANSLATION = utils.AMINO_ACID_TRANSLATION;\n\n    var svgu = require('./svg-utils');\n    var NS_SVG = svgu.NS_SVG;\n    var NS_XLINK = svgu.NS_XLINK;\n    var SVGPath = svgu.SVGPath;\n}\n\nfunction PathGlyphBase(stroke, fill) {\n    this._stroke = stroke;\n    this._fill = fill;\n}\n\nPathGlyphBase.prototype.draw = function(g) {\n    g.beginPath();\n    this.drawPath(g);\n\n    if (this._fill) {\n        g.fillStyle = this._fill;\n        g.fill();\n    }\n    if (this._stroke) {\n        g.strokeStyle = this._stroke;\n        g.stroke();\n    }\n}\n\nPathGlyphBase.prototype.toSVG = function() {\n    var g = new SVGPath();\n    this.drawPath(g);\n    \n    return makeElementNS(\n        NS_SVG, 'path',\n        null,\n        {d: g.toPathData(),\n         fill: this._fill || 'none',\n         stroke: this._stroke || 'none'});\n}\n\nPathGlyphBase.prototype.drawPath = function(g) {\n    throw 'drawPath method on PathGlyphBase must be overridden';\n}\n\nfunction BoxGlyph(x, y, width, height, fill, stroke, alpha, radius) {\n    this.x = x;\n    this.y = y;\n    this._width = width;\n    this._height = height;\n    this.fill = fill;\n    this.stroke = stroke;\n    this._alpha = alpha;\n    this._radius = radius || 0;\n}\n\nBoxGlyph.prototype.draw = function(g) {\n    var r = this._radius;\n\n    if (r > 0) {\n        g.beginPath();\n        g.moveTo(this.x + r, this.y);\n        g.lineTo(this.x + this._width - r, this.y);\n        g.arcTo(this.x + this._width, this.y, this.x + this._width, this.y + r, r);\n        g.lineTo(this.x + this._width, this.y + this._height - r);\n        g.arcTo(this.x + this._width, this.y + this._height, this.x + this._width - r, this.y + this._height, r);\n        g.lineTo(this.x + r, this.y + this._height);\n        g.arcTo(this.x, this.y + this._height, this.x, this.y + this._height - r, r);\n        g.lineTo(this.x, this.y + r);\n        g.arcTo(this.x, this.y, this.x + r, this.y, r);\n        g.closePath();\n\n        if (this._alpha != null) {\n            g.save();\n            g.globalAlpha = this._alpha;\n        }\n        \n        if (this.fill) {\n            g.fillStyle = this.fill;\n            g.fill();\n        }\n        if (this.stroke) {\n            g.strokeStyle = this.stroke;\n            g.lineWidth = 0.5;\n            g.stroke();\n        }\n\n        if (this._alpha != null) {\n            g.restore();\n        }\n    } else {\n        if (this._alpha != null) {\n            g.save();\n            g.globalAlpha = this._alpha;\n        }\n\n        if (this.fill) {\n            g.fillStyle = this.fill;\n            g.fillRect(this.x, this.y, this._width, this._height);\n        }\n\n        if (this.stroke) {\n            g.strokeStyle = this.stroke;\n            g.lineWidth = 0.5;\n            g.strokeRect(this.x, this.y, this._width, this._height)\n        }\n\n        if (this._alpha != null) {\n            g.restore();\n        }\n    }\n}\n\nBoxGlyph.prototype.toSVG = function() {\n    var s = makeElementNS(NS_SVG, 'rect', null,\n                         {x: this.x, \n                          y: this.y, \n                          width: this._width, \n                          height: this._height,\n                          stroke: this.stroke || 'none',\n                          strokeWidth: 0.5,\n                          fill: this.fill || 'none'});\n    if (this._alpha != null) {\n        s.setAttribute('opacity', this._alpha);\n    }\n\n    return s;\n}\n\nBoxGlyph.prototype.min = function() {\n    return this.x;\n}\n\nBoxGlyph.prototype.max = function() {\n    return this.x + this._width;\n}\n\nBoxGlyph.prototype.height = function() {\n    return this.y + this._height;\n}\n\n\nfunction GroupGlyph(glyphs, connector) {\n    this.glyphs = glyphs;\n    this.connector = connector;\n    this.h = glyphs[0].height();\n\n    var covList = [];\n    for (var g = 0; g < glyphs.length; ++g) {\n        var gg = glyphs[g];\n        covList.push(new Range(gg.min(), gg.max()));\n        this.h = Math.max(this.h, gg.height());\n    }\n    this.coverage = union(covList);\n}\n\nGroupGlyph.prototype.drawConnectors = function(g) {\n    var ranges = this.coverage.ranges();\n    for (var r = 1; r < ranges.length; ++r) {\n        var gl = ranges[r];\n        var last = ranges[r - 1];\n        if (last && gl.min() > last.max()) {\n            var start = last.max();\n            var end = gl.min();\n            var mid = (start+end)/2\n            \n            if (this.connector === 'hat+') {\n                g.moveTo(start, this.h/2);\n                g.lineTo(mid, 0);\n                g.lineTo(end, this.h/2);\n            } else if (this.connector === 'hat-') {\n                g.moveTo(start, this.h/2);\n                g.lineTo(mid, this.h);\n                g.lineTo(end, this.h/2);\n            } else if (this.connector === 'collapsed+') {\n                g.moveTo(start, this.h/2);\n                g.lineTo(end, this.h/2);\n                if (end - start > 4) {\n                    g.moveTo(mid - 2, (this.h/2) - 3);\n                    g.lineTo(mid + 2, this.h/2);\n                    g.lineTo(mid - 2, (this.h/2) + 3);\n                }\n            } else if (this.connector === 'collapsed-') {\n                g.moveTo(start, this.h/2);\n                g.lineTo(end, this.h/2);\n                if (end - start > 4) {\n                    g.moveTo(mid + 2, (this.h/2) - 3);\n                    g.lineTo(mid - 2, this.h/2);\n                    g.lineTo(mid + 2, (this.h/2) + 3);\n                }\n            } else {\n                g.moveTo(start, this.h/2);\n                g.lineTo(end, this.h/2);\n            }\n        }\n        last = gl;\n    }\n}\n\nGroupGlyph.prototype.draw = function(g, oc) {\n    for (var i = 0; i < this.glyphs.length; ++i) {\n        var gl = this.glyphs[i];\n        gl.draw(g, oc);\n    }\n\n    g.strokeStyle = 'black';\n    g.beginPath();\n    this.drawConnectors(g);\n    g.stroke();\n}\n\nGroupGlyph.prototype.toSVG = function() {\n    var g = makeElementNS(NS_SVG, 'g');\n    for (var i = 0; i < this.glyphs.length; ++i) {\n        g.appendChild(this.glyphs[i].toSVG());\n    }\n\n    var p = new SVGPath();\n    this.drawConnectors(p);\n\n    var pathData = p.toPathData();\n    if (pathData.length > 0) {\n        var path = makeElementNS(\n            NS_SVG, 'path',\n            null,\n            {d: p.toPathData(),\n             fill: 'none',\n             stroke: 'black',\n             strokeWidth: 0.5});\n        g.appendChild(path);\n    }\n\n    return g;\n}\n\nGroupGlyph.prototype.min = function() {\n    return this.coverage.min();\n}\n\nGroupGlyph.prototype.max = function() {\n    return this.coverage.max();\n}\n\nGroupGlyph.prototype.height = function() {\n    return this.h;\n}\n\n\nfunction LineGraphGlyph(points, color, height) {\n    this.points = points;\n    this.color = color;\n    this._height = height || 50;\n}\n\nLineGraphGlyph.prototype.min = function() {\n    return this.points[0].x;\n    // return this.points[0];\n};\n\nLineGraphGlyph.prototype.max = function() {\n    return this.points[this.points.length - 1].x;\n    // return this.points[this.points.length - 2];\n};\n\nLineGraphGlyph.prototype.height = function() {\n    return this._height;\n}\n\nLineGraphGlyph.prototype.draw = function(g) {\n    g.save();\n    g.strokeStyle = this.color;\n    g.lineWidth = 2;\n    g.beginPath();\n    this.points.forEach(function(p, i) {\n        if (i === 0)\n            g.moveTo(p.x, p.y);\n        else\n            g.lineTo(p.x, p.y);\n    });\n    g.stroke();\n    g.restore();\n}\n\nLineGraphGlyph.prototype.toSVG = function() {\n    var p = new SVGPath();\n    for (let i = 0; i < this.points.length; ++i) {\n        var x = this.points[i].x;\n        var y = this.points[i].y;\n        if (i == 0) {\n            p.moveTo(x, y);\n        } else {\n            p.lineTo(x, y);\n        }\n    }\n    \n    return makeElementNS(\n        NS_SVG, 'path',\n        null,\n        {d: p.toPathData(),\n         fill: 'none',\n         stroke: this.color,\n         strokeWidth: '2px'});\n}\n\nfunction LabelledGlyph(GLOBAL_GC, glyph, text, unmeasured, anchor, align, font) {\n    this.glyph = glyph;\n    this.text = text;\n    this.anchor = anchor || 'left';\n    this.align = align || 'below';\n    if (font) {\n        this.font = font;\n    }\n    if (this.font) {\n        GLOBAL_GC.save();\n        GLOBAL_GC.font = this.font;\n    }\n    var metrics = GLOBAL_GC.measureText(text);\n    if (this.font) {\n        GLOBAL_GC.restore();\n    }\n    this.textLen = metrics.width;\n    this.textHeight = 5;\n    this.bump = glyph.bump;\n    this.measured = !unmeasured;\n}\n\nLabelledGlyph.prototype.toSVG = function() {\n    var child = this.glyph.toSVG();\n    var opts = {};\n    \n    if (this.align == 'above') {\n        child = makeElementNS(NS_SVG, 'g', child, {transform: \"translate(0, \" + (this.textHeight|0 + 2) + \")\"});\n        opts.y = this.textHeight;\n    } else {\n        opts.y = this.glyph.height() + 15;\n    }\n\n    if (this.font) {\n        opts.fontSize  = 7;\n    }\n\n    if ('center' == this.anchor) {\n        opts.x = (this.glyph.min() + this.glyph.max() - this.textLen) / 2;\n    } else {\n        opts.x = this.glyph.min();\n    }\n\n    return makeElementNS(NS_SVG, 'g',\n        [child,\n         makeElementNS(NS_SVG, 'text', this.text, opts)]);\n}\n\nLabelledGlyph.prototype.min = function() {\n    return this.glyph.min();\n}\n\nLabelledGlyph.prototype.max = function() {\n    if (this.measured)\n        return Math.max(this.glyph.max(), (1.0*this.glyph.min()) + this.textLen + 10);\n    else\n        return this.glyph.max();\n}\n\nLabelledGlyph.prototype.height = function() {\n    var h = this.glyph.height();\n    if (this.measured) {\n        if (this.align == 'above') {\n            h += this.textHeight + 2;\n        } else {\n            h += 20;\n        }\n    }\n    return h;\n}\n\nLabelledGlyph.prototype.draw = function(g, oc) {\n    if (this.align == 'above') {\n        g.save();\n        g.translate(0, this.textHeight + 2);\n    }\n    this.glyph.draw(g);\n    if (this.align == 'above') {\n        g.restore();\n    }\n\n    oc.registerGlyph(this);\n}\n\nLabelledGlyph.prototype.drawOverlay = function(g, minVisible, maxVisible) {\n    g.fillStyle = 'black';\n    if (this.font) {\n        g.save();\n        g.font = this.font;\n    }\n    var p;\n    if ('center' == this.anchor) {\n        p = (this.glyph.min() + this.glyph.max() - this.textLen) / 2;\n    } else {\n        p = this.glyph.min();\n        if (p < minVisible) {\n            p = Math.min(minVisible, this.glyph.max() - this.textLen);\n        }\n    }\n    g.fillText(this.text, p, this.align == 'above' ? this.textHeight : this.glyph.height() + 15);\n    if (this.font) {\n        g.restore();\n    }\n}\n\n\n\nfunction CrossGlyph(x, height, stroke) {\n    this._x = x;\n    this._height = height;\n    this._stroke = stroke;\n}\n\nCrossGlyph.prototype.draw = function(g) {\n    var hh = this._height/2;\n    \n    g.beginPath();\n    g.moveTo(this._x, 0);\n    g.lineTo(this._x, this._height);\n    g.moveTo(this._x - hh, hh);\n    g.lineTo(this._x + hh, hh);\n\n    g.strokeStyle = this._stroke;\n    g.lineWidth = 1;\n\n    g.stroke();\n}\n\nCrossGlyph.prototype.toSVG = function() {\n    var hh = this._height/2;\n\n    var g = new SVGPath();\n    g.moveTo(this._x, 0);\n    g.lineTo(this._x, this._height);\n    g.moveTo(this._x - hh, hh);\n    g.lineTo(this._x + hh, hh);\n    \n    return makeElementNS(\n        NS_SVG, 'path',\n        null,\n        {d: g.toPathData(),\n         fill: 'none',\n         stroke: this._stroke,\n         strokeWidth: '1px'});\n}\n\nCrossGlyph.prototype.min = function() {\n    return this._x - this._height/2;\n}\n\nCrossGlyph.prototype.max = function() {\n    return this._x + this._height/2;\n}\n\nCrossGlyph.prototype.height = function() {\n    return this._height;\n}\n\nfunction ExGlyph(x, height, stroke) {\n    this._x = x;\n    this._height = height;\n    this._stroke = stroke;\n}\n\nExGlyph.prototype.draw = function(g) {\n    var hh = this._height/2;\n    \n    g.beginPath();\n    g.moveTo(this._x - hh, 0);\n    g.lineTo(this._x + hh, this._height);\n    g.moveTo(this._x - hh, this._height);\n    g.lineTo(this._x + hh, 0);\n\n    g.strokeStyle = this._stroke;\n    g.lineWidth = 1;\n\n    g.stroke();\n}\n\nExGlyph.prototype.toSVG = function() {\n    var hh = this._height/2;\n\n    var g = new SVGPath();\n    g.moveTo(this._x - hh, 0);\n    g.lineTo(this._x + hh, this._height);\n    g.moveTo(this._x - hh, this._height);\n    g.lineTo(this._x + hh, 0);\n    \n    return makeElementNS(\n        NS_SVG, 'path',\n        null,\n        {d: g.toPathData(),\n         fill: 'none',\n         stroke: this._stroke,\n         strokeWidth: '1px'});\n}\n\nExGlyph.prototype.min = function() {\n    return this._x - this._height/2;\n}\n\nExGlyph.prototype.max = function() {\n    return this._x + this._height/2;\n}\n\nExGlyph.prototype.height = function() {\n    return this._height;\n}\n\n\n\nfunction TriangleGlyph(x, height, dir, width, fill, stroke) {\n    PathGlyphBase.call(this, stroke, fill);\n\n    this._x = x;\n    this._height = height;\n    this._dir = dir;\n    this._width = width;\n}\n\nTriangleGlyph.prototype = Object.create(PathGlyphBase.prototype);\n\nTriangleGlyph.prototype.drawPath = function(g) {\n    var hh = this._height/2;\n    var hw = this._width/2;\n\n    if (this._dir === 'S') {\n        g.moveTo(this._x, this._height);\n        g.lineTo(this._x - hw, 0);\n        g.lineTo(this._x + hw, 0);\n    } else if (this._dir === 'W') {\n        g.moveTo(this._x + hw, hh);\n        g.lineTo(this._x - hw, 0);\n        g.lineTo(this._x - hw, this._height);\n    } else if (this._dir === 'E') {\n        g.moveTo(this._x - hw, hh);\n        g.lineTo(this._x + hw, 0);\n        g.lineTo(this._x + hw, this._height);\n    } else {\n        g.moveTo(this._x , 0);\n        g.lineTo(this._x + hw, this._height);\n        g.lineTo(this._x - hw, this._height);\n    }\n\n    g.closePath();\n}\n\nTriangleGlyph.prototype.min = function() {\n    return this._x - this._height/2;\n}\n\nTriangleGlyph.prototype.max = function() {\n    return this._x + this._height/2;\n}\n\nTriangleGlyph.prototype.height = function() {\n    return this._height;\n}\n\n\n\n\nfunction DotGlyph(x, height, fill, stroke) {\n    this._x = x;\n    this._height = height;\n    this._fill = fill;\n    this._stroke = stroke;\n}\n\nDotGlyph.prototype.draw = function(g) {\n    var hh = this._height/2;\n    g.fillStyle = this._stroke;\n    g.beginPath();\n    g.arc(this._x, hh, hh, 0, 6.29);\n\n    if (this._fill) {\n        g.fillStyle = this._fill;\n        g.fill();\n    }\n\n    if (this._stroke) {\n        g.strokeStyle = this._stroke;\n        g.stroke();\n    }\n}\n\nDotGlyph.prototype.toSVG = function() {\n    var hh = this._height/2;\n    return makeElementNS(\n        NS_SVG, 'circle',\n        null,\n        {cx: this._x, cy: hh, r: hh,\n         fill: this._fill || 'none',\n         stroke: this._stroke || 'none',\n         strokeWidth: '1px'});\n}\n\nDotGlyph.prototype.min = function() {\n    return this._x - this._height/2;\n}\n\nDotGlyph.prototype.max = function() {\n    return this._x + this._height/2;\n}\n\nDotGlyph.prototype.height = function() {\n    return this._height;\n}\n\n\nfunction PaddedGlyph(glyph, minp, maxp) {\n    this.glyph = glyph;\n    this._min = minp;\n    this._max = maxp;\n    if (glyph) {\n        this.bump = glyph.bump;\n    }\n}\n\nPaddedGlyph.prototype.draw = function(g, oc) {\n    if (this.glyph) \n        this.glyph.draw(g, oc);\n}\n\nPaddedGlyph.prototype.toSVG = function() {\n    if (this.glyph) {\n        return this.glyph.toSVG();\n    } else {\n        return makeElementNS(NS_SVG, 'g');\n    }\n}\n\nPaddedGlyph.prototype.min = function() {\n    return this._min;\n}\n\nPaddedGlyph.prototype.max = function() {\n    return this._max;\n}\n\nPaddedGlyph.prototype.height = function() {\n    if (this.glyph) {\n        return this.glyph.height();\n    } else {\n        return 1;\n    }\n}\n\n\nfunction AArrowGlyph(min, max, height, fill, stroke, ori) {\n    PathGlyphBase.call(this, stroke, fill);\n    this._min = min;\n    this._max = max;\n    this._height = height;\n    this._ori = ori;\n}\n\nAArrowGlyph.prototype = Object.create(PathGlyphBase.prototype);\n\nAArrowGlyph.prototype.min = function() {\n    return this._min;\n}\n\nAArrowGlyph.prototype.max = function() {\n    return this._max;\n}\n\nAArrowGlyph.prototype.height = function() {\n    return this._height;\n}\n\nAArrowGlyph.prototype.drawPath = function(g) {\n    var maxPos = this._max;\n    var minPos = this._min;\n    var height = this._height;\n    var lInset = 0;\n    var rInset = 0;\n    var minLength = this._height + 2;\n    var instep = 0.333333 * this._height;\n    var y = 0;\n\n    if (this._ori) {\n        if (this._ori === '+') {\n            rInset = 0.5 * this._height;\n        } else if (this._ori === '-') {\n            lInset = 0.5 * this._height;\n        }\n    }\n\n    if (maxPos - minPos < minLength) {\n        minPos = (maxPos + minPos - minLength) / 2;\n        maxPos = minPos + minLength;\n    }\n\n    g.moveTo(minPos + lInset, y+instep);\n    g.lineTo(maxPos - rInset, y+instep);\n    g.lineTo(maxPos - rInset, y);\n    g.lineTo(maxPos, y + this._height/2);\n    g.lineTo(maxPos - rInset, y+height);\n    g.lineTo(maxPos - rInset, y+instep+instep);\n    g.lineTo(minPos + lInset, y+instep+instep);\n    g.lineTo(minPos + lInset, y+height);\n    g.lineTo(minPos, y+height/2);\n    g.lineTo(minPos + lInset, y);\n    g.lineTo(minPos + lInset, y+instep);\n}\n\nfunction SpanGlyph(min, max, height, stroke) {\n    PathGlyphBase.call(this, stroke, null);\n    this._min = min;\n    this._max = max;\n    this._height = height;\n}\n\nSpanGlyph.prototype = Object.create(PathGlyphBase.prototype);\n\nSpanGlyph.prototype.min = function() {return this._min};\nSpanGlyph.prototype.max = function() {return this._max};\nSpanGlyph.prototype.height = function() {return this._height};\n\nSpanGlyph.prototype.drawPath = function(g) {\n    var minPos = this._min, maxPos = this._max;\n    var height = this._height, hh = height/2;\n    g.moveTo(minPos, hh);\n    g.lineTo(maxPos, hh);\n    g.moveTo(minPos, 0);\n    g.lineTo(minPos, height);\n    g.moveTo(maxPos, 0);\n    g.lineTo(maxPos, height);\n}\n\nfunction LineGlyph(min, max, height, style, strand, stroke) {\n    this._min = min;\n    this._max = max;\n    this._height = height;\n    this._style = style;\n    this._strand = strand;\n    this._stroke = stroke;\n}\n\nLineGlyph.prototype.min = function() {return this._min};\nLineGlyph.prototype.max = function() {return this._max};\nLineGlyph.prototype.height = function() {return this._height};\n\nLineGlyph.prototype.drawPath = function(g) {\n    var minPos = this._min, maxPos = this._max;\n    var height = this._height, hh = height/2;\n\n    if (this._style === 'hat') {\n        g.moveTo(minPos, hh);\n        g.lineTo((minPos + maxPos)/2, this._strand === '-' ? height : 0);\n        g.lineTo(maxPos, hh);\n    } else {\n        g.moveTo(minPos, hh);\n        g.lineTo(maxPos, hh);\n    }\n}\n\n\nLineGlyph.prototype.draw = function(g) {\n    g.beginPath();\n    this.drawPath(g);\n    g.strokeStyle = this._stroke;\n    if (this._style === 'dashed' && g.setLineDash) {\n        g.save();\n        g.setLineDash([3]);\n        g.stroke();\n        g.restore();\n    } else {\n        g.stroke();\n    }\n}\n\nLineGlyph.prototype.toSVG = function() {\n    var g = new SVGPath();\n    this.drawPath(g);\n    \n    var opts = {d: g.toPathData(),\n            stroke: this._stroke || 'none'};\n    if (this._style === 'dashed') {\n        opts['strokeDasharray'] = '3';\n    }\n\n    return makeElementNS(\n        NS_SVG, 'path',\n        null, opts\n    );\n}\n\n\n\n\n\nfunction PrimersGlyph(min, max, height, fill, stroke) {\n    this._min = min;\n    this._max = max;\n    this._height = height;\n    this._fill = fill;\n    this._stroke = stroke;\n}\n\nPrimersGlyph.prototype.min = function() {return this._min};\nPrimersGlyph.prototype.max = function() {return this._max};\nPrimersGlyph.prototype.height = function() {return this._height};\n\n\nPrimersGlyph.prototype.drawStemPath = function(g) {\n    var minPos = this._min, maxPos = this._max;\n    var height = this._height, hh = height/2;\n    g.moveTo(minPos, hh);\n    g.lineTo(maxPos, hh);\n}\n\nPrimersGlyph.prototype.drawTrigsPath = function(g) {\n    var minPos = this._min, maxPos = this._max;\n    var height = this._height, hh = height/2;\n    g.moveTo(minPos, 0);\n    g.lineTo(minPos + height, hh);\n    g.lineTo(minPos, height);\n    g.lineTo(minPos, 0);\n    g.moveTo(maxPos, 0);\n    g.lineTo(maxPos - height, hh);\n    g.lineTo(maxPos, height);\n    g.lineTo(maxPos, 0);\n}\n\n\nPrimersGlyph.prototype.draw = function(g) {\n    g.beginPath();\n    this.drawStemPath(g);\n    g.strokeStyle = this._stroke;\n    g.stroke();\n    g.beginPath();\n    this.drawTrigsPath(g);\n    g.fillStyle = this._fill;\n    g.fill();\n}\n\nPrimersGlyph.prototype.toSVG = function() {\n    var s = new SVGPath();\n    this.drawStemPath(s);\n    var t = new SVGPath();\n    this.drawTrigsPath(t);\n    \n    return makeElementNS(\n        NS_SVG, 'g',\n        [makeElementNS(\n            NS_SVG, 'path',\n            null,\n            {d: s.toPathData(),\n             stroke: this._stroke || 'none'}),\n         makeElementNS(\n             NS_SVG, 'path',\n             null,\n             {d: t.toPathData(),\n              fill: this._fill || 'none'})]);\n}\n\nfunction ArrowGlyph(min, max, height, color, parallel, sw, ne) {\n    PathGlyphBase.call(this, null, color);\n    this._min = min;\n    this._max = max;\n    this._height = height;\n    this._color = color;\n    this._parallel = parallel;\n    this._sw = sw;\n    this._ne = ne;\n}\n\nArrowGlyph.prototype = Object.create(PathGlyphBase.prototype);\n\nArrowGlyph.prototype.min = function() {return this._min};\nArrowGlyph.prototype.max = function() {return this._max};\nArrowGlyph.prototype.height = function() {return this._height};\n\nArrowGlyph.prototype.drawPath = function(g) {\n    var min = this._min, max = this._max, height = this._height;\n    \n    if (this._parallel) {\n        var hh = height/2;\n        var instep = 0.4 * height;\n        if (this._sw) {\n            g.moveTo(min + hh, height-instep);\n            g.lineTo(min + hh, height);\n            g.lineTo(min, hh);\n            g.lineTo(min + hh, 0);\n            g.lineTo(min + hh, instep);\n        } else {\n            g.moveTo(min, height-instep);\n            g.lineTo(min, instep);\n        }\n        if (this._ne) {\n            g.lineTo(max - hh, instep);\n            g.lineTo(max - hh, 0);\n            g.lineTo(max, hh);\n            g.lineTo(max - hh, height);\n            g.lineTo(max - hh, height - instep);\n        } else {\n            g.lineTo(max, instep);\n            g.lineTo(max, height-instep);\n        }\n        g.closePath();\n    } else {\n        var mid = (min+max)/2;\n        var instep = 0.4*(max-min);\n        var th = height/3;\n\n        if (this._ne) {\n            g.moveTo(min + instep, th);\n            g.lineTo(min, th);\n            g.lineTo(mid, 0);\n            g.lineTo(max, th);\n            g.lineTo(max - instep, th);\n        } else {\n            g.moveTo(min+instep, 0);\n            g.lineTo(max-instep, 0);\n        }\n        if (this._sw) {\n            g.lineTo(max - instep, height-th);\n            g.lineTo(max, height-th);\n            g.lineTo(mid, height);\n            g.lineTo(min, height-th)\n            g.lineTo(min + instep, height-th);\n        } else {\n            g.lineTo(max - instep, height);\n            g.lineTo(min + instep, height);\n        }\n        g.closePath();\n    }\n}\n\n\nfunction TooManyGlyph(min, max, height, fill, stroke) {\n    this._min = min;\n    this._max = max;\n    this._height = height;\n    this._fill = fill;\n    this._stroke = stroke;\n}\n\nTooManyGlyph.prototype.min = function() {return this._min};\nTooManyGlyph.prototype.max = function() {return this._max};\nTooManyGlyph.prototype.height = function() {return this._height};\n\nTooManyGlyph.prototype.toSVG = function() {\n    return makeElementNS(NS_SVG, 'rect', null,\n                         {x: this._min, \n                          y: 0, \n                          width: this._max - this._min, \n                          height: this._height,\n                          stroke: this._stroke || 'none',\n                          fill: this._fill || 'none'});\n}\n\nTooManyGlyph.prototype.draw = function(g) {\n    if (this._fill) {\n        g.fillStyle = this._fill;\n        g.fillRect(this._min, 0, this._max - this._min, this._height);\n    }\n    if (this._stroke) {\n        g.strokeStyle = this._stroke;\n        g.strokeRect(this._min, 0, this._max - this._min, this._height);\n        g.beginPath();\n        for (var n = 2; n < this._height; n += 3) {\n            g.moveTo(this._min, n);\n            g.lineTo(this._max, n);\n        }\n        g.stroke();\n    }\n}\n\nfunction TextGlyph(GLOBAL_GC, min, max, height, fill, string) {\n    this._min = min;\n    this._max = max;\n    this._height = height;\n    this._fill = fill;\n    this._string = string;\n    this._textLen = GLOBAL_GC.measureText(string).width;\n}\n\nTextGlyph.prototype.min = function() {return this._min};\nTextGlyph.prototype.max = function() {return Math.max(this._max, this._min + this._textLen)};\nTextGlyph.prototype.height = function() {return this._height};\n\nTextGlyph.prototype.draw = function(g) {\n    g.fillStyle = this._fill;\n    g.fillText(this._string, this._min, this._height - 4);\n}\n\nTextGlyph.prototype.toSVG = function() {\n    return makeElementNS(NS_SVG, 'text', this._string, {x: this._min, y: this._height - 4});\n};\n\nfunction aminoTileColor(aa, start, color) {\n    var ALTERNATE_COLOR = {\n        'red': 'darkred',\n        'purple': 'mediumpurple',\n        'blue': 'darkblue',\n        'green': 'darkgreen'\n    };\n    var color2 = ALTERNATE_COLOR[color.toLowerCase()];\n    var tileColors;\n    if (!color2)\n        tileColors = ['rgb(73, 68, 149)', 'rgb(9, 0, 103)'];\n        // default to UCSC colors\n    else\n        tileColors = [color, color2];\n\n    if (aa == '?')\n        return 'black';\n    else if (aa == 'M')\n        return 'greenyellow';\n    else if (aa == '*')\n        return 'crimson';\n    else\n        return tileColors[start % 2];\n}\n\nfunction reverseComplement(sequence) {\n    var seq_dict = {'A': 'T', 'T': 'A', 'G': 'C', 'C': 'G'};\n    var rev_seq = sequence.split('').reverse().join('');\n    var rev_compl_seq = [];\n    for (var b = 0; b < rev_seq.length; ++b) {\n        var base = rev_seq.substr(b, 1).toUpperCase();\n        rev_compl_seq.push(base in seq_dict ? seq_dict[base] : 'N');\n    }\n    return rev_compl_seq.join('');\n}\n\nfunction AminoAcidGlyph(min, max, height, fill, seq, orientation, readframe) {\n    this._min = min;\n    this._max = max;\n    this._height = height;\n    this._fill = fill;\n    this._seq = seq;\n    this._orientation = orientation;\n    this._readframe = readframe;\n}\n\nAminoAcidGlyph.prototype.min = function() {return this._min};\nAminoAcidGlyph.prototype.max = function() {return this._max};\nAminoAcidGlyph.prototype.height = function() {return this._height};\n\nAminoAcidGlyph.prototype.draw = function(gc) {\n    var seq = this._seq;\n    var color = this._fill;\n\n    if (!seq) return;\n\n    var scale = (this._max - this._min + 1) / seq.length;\n\n    var prevOverhang = (3 - this._readframe) % 3;\n    var nextOverhang = (seq.length - prevOverhang) % 3;\n    var leftOverhang = this._orientation == '+' ? prevOverhang : nextOverhang;\n    \n    if (leftOverhang > 0) {\n        gc.fillStyle = color;\n        gc.fillRect(this._min, 0, scale * leftOverhang, this._height);\n    }\n\n    for (var p = leftOverhang; p < seq.length; p += 3) {\n        var codon = seq.substr(p, 3).toUpperCase();\n        if (this._orientation == '-')\n            codon = reverseComplement(codon);\n        var aa = codon in AMINO_ACID_TRANSLATION ? AMINO_ACID_TRANSLATION[codon] : '?';\n        color = codon.length == 3 ? aminoTileColor(aa, p, this._fill) : this._fill;\n        gc.fillStyle = color;\n        gc.fillRect(this._min + p * scale, 0, scale * codon.length, this._height);\n\n        if (scale >= 8 && codon.length == 3) {\n            gc.fillStyle = 'white';\n            gc.fillText(aa, this._min + (p+1) * scale, this._height);\n        } \n    }\n}\n\nAminoAcidGlyph.prototype.toSVG = function() {\n    var g = makeElementNS(NS_SVG, 'g');\n    var seq = this._seq;\n    var color = this._fill;\n\n    if (!seq)\n        return g;\n\n    var scale = (this._max - this._min + 1) / seq.length;\n\n    var prevOverhang = (3 - this._readframe) % 3;\n    var nextOverhang = (seq.length - prevOverhang) % 3;\n    var leftOverhang = this._orientation == '+' ? prevOverhang : nextOverhang;\n\n    if (leftOverhang > 0) {\n        g.appendChild(\n            makeElementNS(NS_SVG, 'rect', null, {\n                x: this._min,\n                y: 0,\n                width: scale * leftOverhang,\n                height: this._height,\n                fill: color}));\n    }\n    for (var p = leftOverhang; p < seq.length; p += 3) {\n        var codon = seq.substr(p, 3).toUpperCase();\n        if (this._orientation == '-')\n            codon = reverseComplement(codon);\n        var aa = codon in AMINO_ACID_TRANSLATION ? AMINO_ACID_TRANSLATION[codon] : '?';\n        color = codon.length == 3 ? aminoTileColor(aa, p, this._fill) : this._fill;\n        g.appendChild(\n            makeElementNS(NS_SVG, 'rect', null, {\n                x: this._min + p * scale,\n                y: 0,\n                width: scale * codon.length,\n                height: this._height,\n                fill: color}));\n\n        if (scale >= 8 && codon.length == 3) {\n            g.appendChild(\n                makeElementNS(NS_SVG, 'text', aa, {\n                    x: this._min + (p+1) * scale,\n                    y: this._height,\n                    fill: 'white'}));\n        }\n    }\n    return g;\n};\n\nvar isRetina = typeof(window) !== 'undefined' && window.devicePixelRatio > 1;\nvar __dalliance_SequenceGlyphCache = {};\nvar altPattern = new RegExp('^[ACGT-]$');\nvar isCloseUp = function(scale) {\n    return scale >= 8;\n}\n\nfunction SequenceGlyph(baseColors, strandColor, min, max, height, seq, ref, scheme, quals, fillbg, scaleVertical) {\n    this.baseColors = baseColors;\n    this._strandColor = strandColor;\n    this._min = min;\n    this._max = max;\n    this._height = height;\n    this._seq = seq;\n    this._ref = ref;\n    this._scheme = scheme;\n    this._quals = quals;\n    this._fillbg = fillbg;\n    this._scaleVertical = scaleVertical;\n}\n\nSequenceGlyph.prototype.min = function() {return this._min};\nSequenceGlyph.prototype.max = function() {return this._max};\nSequenceGlyph.prototype.height = function() {return this._height};\n\n\nSequenceGlyph.prototype.alphaForQual = function(qual) {\n    return 0.1 + 0.9*Math.max(0.0, Math.min((1.0 * qual) / 30.0, 1.0));\n}\n\nSequenceGlyph.prototype.draw = function(gc) {\n    var seq = this._seq;\n    var ref = this._ref;\n    var mismatch = this._scheme === 'mismatch' || this._scheme === 'mismatch-all';\n    var all = this._scheme === 'mismatch-all';\n    \n    var seqLength = seq ? seq.length : (this._max - this._min + 1);\n    var scale = (this._max - this._min + 1) / seqLength;\n\n    if (mismatch && !isCloseUp(scale)) {\n        gc.fillStyle = this._strandColor;\n        if (this._scaleVertical)\n            gc.fillRect(this._min, scale, this._max - this._min, scale);\n        else\n            gc.fillRect(this._min, this._height/4, this._max - this._min, this._height/2);\n    }\n\n    \n    for (var p = 0; p < seqLength; ++p) {\n        var base = seq ? seq.substr(p, 1).toUpperCase() : 'N';\n        \n        if (!altPattern.test(base) && !isCloseUp(scale))\n            continue;\n\n        var color = this.baseColors[base];\n\n        if (this._quals) {\n            var qc = this._quals.charCodeAt(p) - 33;\n            var oldAlpha = gc.globalAlpha;            // NB hoisted!\n            gc.globalAlpha = this.alphaForQual(qc);\n        }\n\n        if (!color) {\n            var refBase = ref ? ref.substr(p, 1).toUpperCase() : 'N';\n            if (base == 'N' || refBase == 'N')\n                color = 'gray';\n            else\n                color = this._strandColor;\n\n            if (all)\n                base = refBase;\n        }\n\n        gc.fillStyle = color;\n\n        var alt = altPattern.test(base);\n        if (this._fillbg || !isCloseUp(scale) || !alt) {\n            if (this._scaleVertical)\n                gc.fillRect(this._min + p*scale, scale, scale, scale);\n            else\n                gc.fillRect(this._min + p*scale, 0, scale, this._height);\n        }\n        if (isCloseUp(scale) && alt) {\n            var key = color + '_' + base\n            var img = __dalliance_SequenceGlyphCache[key];\n            if (!img) {\n                img = document.createElement('canvas');\n                if (isRetina) {\n                    img.width = 16;\n                    img.height = 20;\n                } else {\n                    img.width = 8;\n                    img.height = 10;\n                }\n                var imgGc = img.getContext('2d');\n                if (isRetina) {\n                    imgGc.scale(2, 2);\n                }\n                imgGc.fillStyle = this._fillbg ? 'black' : color;\n                var w = imgGc.measureText(base).width;\n                imgGc.fillText(base, 0.5 * (8.0 - w), 8);\n                __dalliance_SequenceGlyphCache[key] = img;\n            }\n            var dy = this._scaleVertical ? scale : 0;\n            if (isRetina)\n                gc.drawImage(img, this._min + p*scale + 0.5*(scale-8), dy, 8, 10);\n            else\n                gc.drawImage(img, this._min + p*scale + 0.5*(scale-8), dy);\n        } \n\n        if (this._quals) {\n            gc.globalAlpha = oldAlpha;\n        }\n    }\n}\n\nSequenceGlyph.prototype.toSVG = function() {\n    var seq = this._seq;\n    var ref = this._ref;\n    var mismatch = this._scheme === 'mismatch' || this._scheme === 'mismatch-all';\n    var all = this._scheme === 'mismatch-all';\n    var scale = (this._max - this._min + 1) / this._seq.length;\n    var  g = makeElementNS(NS_SVG, 'g'); \n\n    for (var p = 0; p < seq.length; ++p) {\n        var base = seq ? seq.substr(p, 1).toUpperCase() : 'N';\n        var color = this.baseColors[base];\n\n        if (!color) {\n            var refBase = ref ? ref.substr(p, 1).toUpperCase() : 'N';\n            if (base == 'N' || refBase == 'N')\n                color = 'gray';\n            else\n                color = this._strandColor;\n\n            if (all)\n                base = refBase;\n        }\n\n        var alpha = 1.0;\n        if (this._quals) {\n            var qc = this._quals.charCodeAt(p) - 33;\n            alpha = this.alphaForQual(qc);\n        }\n\n        var alt = altPattern.test(base);\n        if (this._fillbg || !isCloseUp(scale) || !alt) {\n            g.appendChild(\n                makeElementNS(NS_SVG, 'rect', null, {\n                    x:this._min + p*scale,\n                    y: 0,\n                    width: scale,\n                    height: this._height,\n                    fill: color,\n                    fillOpacity: alpha}));\n        }\n\n        if (isCloseUp(scale) && alt) {\n            g.appendChild(\n                makeElementNS(NS_SVG, 'text', base, {\n                    x: this._min + (0.5+p)*scale,\n                    y: 8,\n                    textAnchor: 'middle',\n                    fill: this._fillbg ? 'black' : color,\n                    fillOpacity: alpha}));\n        }\n    }\n\n    return g;\n}\n\nfunction TranslatedGlyph(glyph, x, y, height) {\n    this.glyph = glyph;\n    this._height = height;\n    this._x = x;\n    this._y = y;\n}\n\nTranslatedGlyph.prototype.height = function() {\n    if (this._height) {\n        return this._height;\n    } else {\n        return this.glyph.height() + this._y;\n    }\n}\n\nTranslatedGlyph.prototype.min = function() {\n    return this.glyph.min() + this._x;\n}\n\nTranslatedGlyph.prototype.max = function() {\n    return this.glyph.max() + this._x;\n}\n\nTranslatedGlyph.prototype.minY = function() {\n    return this._y;\n}\n\nTranslatedGlyph.prototype.maxY = function() {\n    return this._y + this.glyph.height();\n}\n\nTranslatedGlyph.prototype.draw = function(g, o) {\n    g.save();\n    g.translate(this._x, this._y);\n    this.glyph.draw(g, o);\n    g.restore();\n}\n\nTranslatedGlyph.prototype.toSVG = function() {\n    var s =  this.glyph.toSVG();\n    s.setAttribute('transform', 'translate(' + this._x + ',' + this._y + ')');\n    return s;\n}\n\nfunction PointGlyph(x, y, height, fill) {\n    this._x = x;\n    this._y = y;\n    this._height = height;\n    this._fill = fill;\n}\n\nPointGlyph.prototype.min = function() {\n    return this._x - 2;\n}\n\nPointGlyph.prototype.max = function() {\n    return this._x + 2;\n}\n\nPointGlyph.prototype.height = function() {\n    return this._height;\n}\n\nPointGlyph.prototype.draw = function(g) {\n    g.save();\n    g.globalAlpha = 0.3;\n    g.fillStyle = this._fill;\n    g.beginPath();\n    g.arc(this._x, this._y, 1.5, 0, 6.29);\n    g.fill();\n    g.restore();\n}\n\nPointGlyph.prototype.toSVG = function() {\n    return makeElementNS(\n        NS_SVG, 'circle',\n        null,\n        {cx: this._x, cy: this._y, r: 2,\n         fill: this._fill,\n         stroke: 'none'});\n}\n\n\nfunction GridGlyph(height, yOffset, spacing) {\n    this._height = height || 50;\n    this.yOffset = yOffset || 0;\n    this.spacing = spacing || 10;\n}\n\nGridGlyph.prototype.notSelectable = true;\n\nGridGlyph.prototype.min = function() {\n    return -100000;\n};\n\nGridGlyph.prototype.max = function() {\n    return 100000;\n};\n\nGridGlyph.prototype.height = function() {\n    return this._height;\n}\n\nGridGlyph.prototype.draw = function(g) {\n    g.save();\n    g.strokeStyle = 'black'\n    g.lineWidth = 0.1;\n\n    g.beginPath();\n    for (var y = this.yOffset; y <= this._height+this.yOffset; y += this.spacing) {\n    // for (var y = 0; y <= this._height; y += 10) {\n        g.moveTo(-5000, y);\n        g.lineTo(5000, y);\n    }\n    g.stroke();\n    g.restore();\n}\n\nGridGlyph.prototype.toSVG = function() {\n    var p = new SVGPath();\n    for (var y = 0; y <= this._height; y += 10) {\n        p.moveTo(-5000, y);\n        p.lineTo(5000, y);\n    }\n    \n    return makeElementNS(\n        NS_SVG, 'path',\n        null,\n        {d: p.toPathData(),\n         fill: 'none',\n         stroke: 'black',\n         strokeWidth: '0.1px'});\n}\n\nfunction StarGlyph(x, r, points, fill, stroke) {\n    PathGlyphBase.call(this, stroke, fill);\n    this._x = x;\n    this._r = r;\n    this._points = points;\n}\n\nStarGlyph.prototype = Object.create(PathGlyphBase.prototype);\n\nStarGlyph.prototype.min = function() {\n    return this._x - this._r;\n}\n\nStarGlyph.prototype.max = function() {\n    return this._x + this._r;\n}\n\nStarGlyph.prototype.height = function() {\n    return 2 * this._r;\n}\n\nStarGlyph.prototype.drawPath = function(g) {\n    var midX = this._x, midY = this._r, r = this._r;\n    for (var p = 0; p < this._points; ++p) {\n        var theta = (p * 6.28) / this._points;\n        var px = midX + r*Math.sin(theta);\n        var py = midY - r*Math.cos(theta);\n        if (p == 0) {\n            g.moveTo(px, py);\n        } else {\n            g.lineTo(px, py);\n        }\n        theta = ((p+0.5) * 6.28) / this._points;\n        px = midX + 0.4*r*Math.sin(theta);\n        py = midY - 0.4*r*Math.cos(theta);\n        g.lineTo(px, py);\n    }\n    g.closePath();\n}\n\nfunction PlimsollGlyph(x, height, overhang, fill, stroke) {\n    this._x = x;\n    this._height = height;\n    this._overhang = overhang;\n    this._fill = fill;\n    this._stroke = stroke;\n    this._hh = height / 2;\n}\n\nPlimsollGlyph.prototype.draw = function(g) {\n    var hh = this._height/2;\n    g.fillStyle = this._stroke;\n    g.beginPath();\n    g.arc(this._x, hh, hh - this._overhang, 0, 6.29);\n    g.moveTo(this._x, 0);\n    g.lineTo(this._x, this._height);\n\n    if (this._fill) {\n        g.fillStyle = this._fill;\n        g.fill();\n    }\n\n    if (this._stroke) {\n        g.strokeStyle = this._stroke;\n        g.stroke();\n    }\n}\n\nPlimsollGlyph.prototype.toSVG = function() {\n    var hh = this._hh;\n    return makeElementNS(NS_SVG, 'g', \n        [makeElementNS(NS_SVG, 'circle', null, {cx: this._x, cy: hh, r: hh - this._overhang}),\n         makeElementNS(NS_SVG, 'line', null, {x1: this._x, y1: 0, x2: this._x, y2: this._height})],\n        {fill: this._fill || 'none',\n         stroke: this._stroke || 'none',\n         strokeWidth: '1px'});\n}\n\nPlimsollGlyph.prototype.min = function() {\n    return this._x - this._hh;\n}\n\nPlimsollGlyph.prototype.max = function() {\n    return this._x + this._hh;\n}\n\nPlimsollGlyph.prototype.height = function() {\n    return this._height;\n}\n\n\nfunction OverlayLabelCanvas() {\n    this.ox = 0;\n    this.oy = 0;\n    this.glyphs = [];\n}\n\nOverlayLabelCanvas.prototype.translate = function(x, y) {\n    this.ox += x;\n    this.oy += y;\n}\n\nOverlayLabelCanvas.prototype.registerGlyph = function(g) {\n    this.glyphs.push({\n        x: this.ox,\n        y: this.oy,\n        glyph: g\n    });\n}\n\n\nOverlayLabelCanvas.prototype.draw = function(g, minVisible, maxVisible) {\n    for (var gi = 0; gi < this.glyphs.length; ++gi) {\n        var gg = this.glyphs[gi];\n        g.save();\n        g.translate(gg.x, gg.y);\n        gg.glyph.drawOverlay(g, minVisible, maxVisible);\n        g.restore();\n    }\n}\n\nif (typeof(module) !== 'undefined') {\n    module.exports = {\n        BoxGlyph: BoxGlyph,\n        GroupGlyph: GroupGlyph,\n        LineGraphGlyph: LineGraphGlyph,\n        LabelledGlyph: LabelledGlyph,\n        CrossGlyph: CrossGlyph,\n        ExGlyph: ExGlyph,\n        TriangleGlyph: TriangleGlyph,\n        DotGlyph: DotGlyph,\n        PaddedGlyph: PaddedGlyph,\n        AArrowGlyph: AArrowGlyph,\n        SpanGlyph: SpanGlyph,\n        LineGlyph: LineGlyph,\n        PrimersGlyph: PrimersGlyph,\n        ArrowGlyph: ArrowGlyph,\n        TooManyGlyph: TooManyGlyph,\n        TextGlyph: TextGlyph,\n        SequenceGlyph: SequenceGlyph,\n        AminoAcidGlyph: AminoAcidGlyph,\n        TranslatedGlyph: TranslatedGlyph,\n        GridGlyph: GridGlyph,\n        StarGlyph: StarGlyph,\n        PointGlyph: PointGlyph,\n        PlimsollGlyph: PlimsollGlyph,\n\n        OverlayLabelCanvas: OverlayLabelCanvas\n    }\n}\n","/* -*- mode: javascript; c-basic-offset: 4; indent-tabs-mode: nil -*- */\n\n// \n// Dalliance Genome Explorer\n// (c) Thomas Down 2006-2013\n//\n// jbjson.js -- query JBrowse-style REST data stores\n//\n\nif (typeof(require) !== 'undefined') {\n    var das = require('./das');\n    var DASStylesheet = das.DASStylesheet;\n    var DASStyle = das.DASStyle;\n    var DASFeature = das.DASFeature;\n    var DASGroup = das.DASGroup;\n\n    var utils = require('./utils');\n    var shallowCopy = utils.shallowCopy;\n\n    var spans = require('./spans');\n    var Range = spans.Range;\n    var union = spans.union;\n    var intersection = spans.intersection;\n}\n\nfunction JBrowseStore(base, query) {\n    this.base = base;\n    this.query = query;\n}\n\nfunction jbori(strand) {\n    if (strand > 0)\n        return '+';\n    else if (strand < 0)\n        return '-';\n}\n\nJBrowseStore.prototype.features = function(segment, opts, callback) {\n    opts = opts || {};\n\n    url = this.base + '/features/' + segment.name;\n\n    var filters = [];\n    if (this.query) {\n\t   filters.push(this.query);\n    }\n    if (segment.isBounded) {\n    \tfilters.push('start=' + segment.start);\n    \tfilters.push('end=' + segment.end);\n    }\n    if (filters.length > 0) {\n\t    url = url + '?' + filters.join('&');\n    }\n\n    var req = new XMLHttpRequest();\n    req.onreadystatechange = function() {\n\tif (req.readyState == 4) {\n\t    if (req.status >= 300) {\n\t\t    callback(null, 'Error code ' + req.status);\n\t    } else {\n\t\tvar jf = JSON.parse(req.response)['features'];\n\t\tvar features = [];\n\t\tfor (fi = 0; fi < jf.length; ++fi) {\n\t\t    var j = jf[fi];\n\t\t    \n\t\t    var f = new DASFeature();\n\t\t    f.segment = segment.name;\n\t\t    f.min = (j['start'] | 0) + 1;\n\t\t    f.max = j['end'] | 0;\n\t\t    if (j.name) {\n\t\t\tf.label = j.name;\n\t\t    }\n                    if (j.strand)\n                        f.orientation = jbori(j.strand);\n\t\t    f.type = j.type || 'unknown';\n\n                    if (j.subfeatures && j.subfeatures.length > 0) {\n                        f.id = j.uniqueID;\n\n                        var blocks = [];\n                        var cds = [];\n                        var all = [];\n\n                        for (var si = 0; si < j.subfeatures.length; ++si) {\n                            var sj = j.subfeatures[si];\n                            var sf = shallowCopy(f);\n                            sf.min = sj.start + 1;\n                            sf.max = sj.end;\n                            sf.groups = [f];\n\n                            all.push(sf);\n                            blocks.push(new Range(sf.min, sf.max));\n                            if (sj.type === 'CDS')\n                                cds.push(sf);\n                        }\n                        \n                        if (cds.length > 0) {\n                            spans = union(blocks);\n                            var txGroup = shallowCopy(f);\n                            txGroup.type = 'transcript';\n                            spans.ranges().forEach(function(exon) {\n                                features.push({\n                                    segment:     segment.name,\n                                    min:         exon.min(),\n                                    max:         exon.max(),\n                                    orientation: f.orientation,\n                                    groups:      [txGroup],\n                                    type:        'transcript'\n                                });\n                            });\n\n                            var tlGroup = shallowCopy(f);\n                            cds.forEach(function(cdsExon) {\n                                cdsExon.type = 'translation'\n                                cdsExon.groups = [tlGroup];\n                                features.push(cdsExon);\n                            });\n                        } else {\n                            all.forEach(function(f) {\n                                features.push(f);\n                            });\n                        }\n                    } else {\n\t\t        features.push(f);\n                    }\n\t\t}\n\t\tcallback(features);\n\t    }\n\t}\n\t\n    };\n    \n    req.open('GET', url, true);\n    req.responseType = 'text';\n    req.send();\n}\n\nif (typeof(module) !== 'undefined') {\n    module.exports = {\n        JBrowseStore: JBrowseStore\n    };\n}\n","/* -*- mode: javascript; c-basic-offset: 4; indent-tabs-mode: nil -*- */\n\n//\n// Dalliance Genome Explorer\n// (c) Thomas Down 2006-2013\n//\n// kspace.js\n//\n\n\"use strict\";\n\nif (typeof(require) !== 'undefined') {\n    var utils = require('./utils');\n    var Awaited = utils.Awaited;\n    var pusho = utils.pusho;\n\n    var sa = require('./sourceadapters');\n    var MappedFeatureSource = sa.MappedFeatureSource;\n    var CachingFeatureSource = sa.CachingFeatureSource;\n    var BWGFeatureSource = sa.BWGFeatureSource;\n    var RemoteBWGFeatureSource = sa.RemoteBWGFeatureSource;\n    var BAMFeatureSource = sa.BAMFeatureSource;\n    var RemoteBAMFeatureSource = sa.RemoteBAMFeatureSource;\n    var DummySequenceSource = sa.DummySequenceSource;\n    var DummyFeatureSource = sa.DummyFeatureSource;\n\n    var OverlayFeatureSource = require('./overlay').OverlayFeatureSource;\n\n    var spans = require('./spans');\n    var Range = spans.Range;\n    var union = spans.union;\n    var intersection = spans.intersection;\n\n    var sample = require('./sample');\n    var downsample = sample.downsample;\n    var getBaseCoverage = sample.getBaseCoverage;\n\n    var das = require('./das');\n    var DASSequence = das.DASSequence;\n\n    var Promise = require('es6-promise').Promise;\n}\n\nfunction FetchPool() {\n    var self = this;\n    this.reqs = [];\n    this.awaitedFeatures = {};\n    this.requestsIssued = new Promise(function(resolve, reject) {\n        self.notifyRequestsIssued = resolve;\n    });\n}\n\nFetchPool.prototype.addRequest = function(xhr) {\n    this.reqs.push(xhr);\n}\n\nFetchPool.prototype.abortAll = function() {\n    for (var i = 0; i < this.reqs.length; ++i) {\n        this.reqs[i].abort();\n    }\n}\n\nfunction KSCacheBaton(chr, min, max, scale, features, status, coverage) {\n    this.chr = chr;\n    this.min = min;\n    this.max = max;\n    this.coverage = coverage;\n    this.scale = scale;\n    this.features = features || [];\n    this.status = status;\n}\n\nKSCacheBaton.prototype.toString = function() {\n    return this.chr + \":\" + this.min + \"..\" + this.max + \";scale=\" + this.scale;\n}\n\nfunction KnownSpace(tierMap, chr, min, max, scale, seqSource) {\n    this.tierMap = tierMap;\n    this.chr = chr;\n    this.min = min;\n    this.max = max;\n    this.scale = scale;\n    this.seqSource = seqSource || new DummySequenceSource();\n    this.viewCount = 0;\n\n    this.featureCache = {};\n    this.latestViews = {};\n}\n\nKnownSpace.prototype.cancel = function() {\n    this.cancelled = true;\n}\n\nKnownSpace.prototype.bestCacheOverlapping = function(chr, min, max) {\n    var baton = this.featureCache[this.tierMap[0]];\n    if (baton) {\n        return baton;\n    } else {\n        return null;\n    }\n}\n\nKnownSpace.prototype.retrieveFeatures = function(tiers, chr, min, max, scale) {\n    if (scale != scale) {\n        throw \"retrieveFeatures called with silly scale\";\n    }\n\n    if (chr != this.chr) {\n        throw \"Can't extend Known Space to a new chromosome\";\n    }\n    if (min < 1) {\n        min = 1;\n    }\n\n    this.min = min;\n    this.max = max;\n    this.scale = scale;\n\n    if (this.pool) {\n        this.pool.abortAll();\n    }\n    this.pool = new FetchPool();\n    this.awaitedSeq = new Awaited();\n    this.seqWasFetched = false;\n    this.viewCount++;\n\n    this.startFetchesForTiers(tiers);\n    this.pool.notifyRequestsIssued();\n}\n\nfunction filterFeatures(features, min, max) {\n    var ff = [];\n    var featuresByGroup = {};\n\n    for (var fi = 0; fi < features.length; ++fi) {\n        var f = features[fi];\n        if (!f.min || !f.max) {\n            ff.push(f);\n        } else if (f.groups && f.groups.length > 0) {\n            pusho(featuresByGroup, f.groups[0].id, f);\n        } else if (f.min <= max && f.max >= min) {\n            ff.push(f);\n        }\n    }\n\n    for (var gid in featuresByGroup) {\n        var gf = featuresByGroup[gid];\n        var gmin = 100000000000, gmax = -100000000000;\n        for (var fi = 0; fi < gf.length; ++fi) {\n            var f = gf[fi];\n            gmin = Math.min(gmin, f.min);\n            gmax = Math.max(gmax, f.max);\n        }\n        if (gmin <= max || gmax >= min) {\n            for (var fi = 0; fi < gf.length; ++fi) {\n                ff.push(gf[fi]);\n            }\n        }\n    }\n\n    return ff;\n}\n\nKnownSpace.prototype.invalidate = function(tier) {\n    if (!this.pool) {\n        return;\n    }\n\n    this.featureCache[tier] = null;\n    this.startFetchesForTiers([tier]);\n}\n\nKnownSpace.prototype.startFetchesForTiers = function(tiers) {\n    var thisB = this;\n\n    var awaitedSeq = this.awaitedSeq;\n    var needSeq = false;\n\n    var gex;\n\n    for (var t = 0; t < tiers.length; ++t) {\n        var tierRenderer = tiers[t].browser.getTierRenderer(tiers[t]);\n        try {\n            if (this.startFetchesFor(tiers[t], awaitedSeq)) {\n                needSeq = true;\n            }\n        } catch (ex) {\n            var tier = tiers[t];\n\n            tier.currentFeatures = [];\n            tier.currentSequence = null;\n            console.log('Error fetching tier source');\n            console.log(ex);\n            gex = ex;\n            console.log(ex.stack);\n            tierRenderer.renderTier(ex, tier);\n            tier.wasRendered();\n        }\n    }\n\n    if (needSeq && !this.seqWasFetched) {\n        this.seqWasFetched = true;\n        var smin = this.min, smax = this.max;\n\n        if (this.cs) {\n            if (this.cs.start <= smin && this.cs.end >= smax) {\n                var cachedSeq;\n                if (this.cs.start == smin && this.cs.end == smax) {\n                    cachedSeq = this.cs;\n                } else {\n                    cachedSeq = new DASSequence(this.cs.name, smin, smax, this.cs.alphabet,\n                                                this.cs.seq.substring(smin - this.cs.start, smax + 1 - this.cs.start));\n                }\n                return awaitedSeq.provide(cachedSeq);\n            }\n        }\n\n        this.seqSource.fetch(this.chr, smin, smax, this.pool, function(err, seq) {\n            if (seq) {\n                if (!thisB.cs || (smin <= thisB.cs.start && smax >= thisB.cs.end) ||\n                    (smin >= thisB.cs.end) || (smax <= thisB.cs.start) ||\n                    ((smax - smin) > (thisB.cs.end - thisB.cs.start)))\n                {\n                    thisB.cs = seq;\n                }\n                awaitedSeq.provide(seq);\n            } else {\n                console.log('Sequence loading failed', err);\n                awaitedSeq.provide(null);\n            }\n        });\n    }\n\n    if (gex)\n        throw gex;\n}\n\nKnownSpace.prototype.startFetchesFor = function(tier, awaitedSeq) {\n    var thisB = this;\n\n    var viewID = this.viewCount;\n    var source = tier.getSource() || new DummyFeatureSource();\n    var needsSeq = tier.needsSequence(this.scale);\n    var baton = thisB.featureCache[tier];\n    var styleFilters = tier.getActiveStyleFilters(this.scale);\n    var wantedTypes;\n    if (styleFilters)\n        wantedTypes = styleFilters.typeList();\n    var chr = this.chr, min = this.min, max = this.max;\n\n\n    if (wantedTypes === undefined) {\n        return false;\n    }\n    if (baton && baton.chr === this.chr && baton.min <= min && baton.max >= max) {\n        var cachedFeatures = baton.features;\n        if (baton.min < min || baton.max > max) {\n            cachedFeatures = filterFeatures(cachedFeatures, min, max);\n        }\n\n        thisB.provision(tier, baton.chr,\n                        intersection(baton.coverage, new Range(min, max)),\n                        baton.scale, wantedTypes,\n                        cachedFeatures, baton.status,\n                        needsSeq ? awaitedSeq : null);\n\n        var availableScales = source.getScales();\n\n        if (baton.scale <= this.scale || !availableScales) {\n            return needsSeq;\n        }\n    }\n\n    if (source.instrument)\n        console.log('Starting  fetch ' + viewID + ' (' + min + ', ' + max + ')');\n\n\n    source.fetch(chr, min, max, this.scale, wantedTypes, this.pool, function(status, features, scale, coverage) {\n        if (source.instrument)\n            console.log('Finishing fetch ' + viewID);\n\n        var latestViewID = thisB.latestViews[tier] || -1;\n        if (thisB.cancelled || latestViewID > viewID) {\n            return;\n        }\n\n        if (!coverage) {\n            coverage = new Range(min, max);\n        }\n\n        if (!baton || (min < baton.min) || (max > baton.max)) {         // FIXME should be merging in some cases?\n            thisB.featureCache[tier] = new KSCacheBaton(chr, min, max, scale, features, status, coverage);\n        }\n\n        thisB.latestViews[tier] = viewID;\n        thisB.provision(tier, chr, coverage, scale, wantedTypes, features, status, needsSeq ? awaitedSeq : null);\n    }, styleFilters);\n    return needsSeq;\n}\n\nKnownSpace.prototype.provision = function(tier, chr, coverage, actualScale, wantedTypes, features, status, awaitedSeq) {\n    var tierRenderer = tier.browser.getTierRenderer(tier);\n    if (status) {\n        tier.setFeatures(chr, coverage, actualScale, [], null);\n        if (!features) {\n            var e = new Error(status);\n            status = \"Error fetching data: \" + status + \"; see browser console\";\n            console.log(\"Error fetching data for tier \" + tier.dasSource.name + \":\");\n            console.log(tier.dasSource);\n            console.log(\"Stack trace:\");\n            console.log(e.stack)\n        }\n        tierRenderer.renderTier(status, tier);\n        tier.wasRendered();\n    } else {\n        var mayDownsample = false;\n        var needBaseComposition = false;\n        var src = tier.getSource();\n        while (MappedFeatureSource.prototype.isPrototypeOf(src) ||\n               CachingFeatureSource.prototype.isPrototypeOf(src) ||\n               OverlayFeatureSource.prototype.isPrototypeOf(src)) {\n\n            if (OverlayFeatureSource.prototype.isPrototypeOf(src)) {\n                src = src.sources[0];\n            } else {\n                src = src.source;\n            }\n        }\n        if (BWGFeatureSource.prototype.isPrototypeOf(src) ||\n            RemoteBWGFeatureSource.prototype.isPrototypeOf(src) ||\n            BAMFeatureSource.prototype.isPrototypeOf(src) ||\n            RemoteBAMFeatureSource.prototype.isPrototypeOf(src)) {\n\n            mayDownsample = true;\n        }\n\n        if (!src.opts || (!src.opts.forceReduction && !src.opts.noDownsample)) {\n            if (/* (actualScale < (this.scale/2) && features.length > 200)  || */\n                (mayDownsample && wantedTypes && wantedTypes.length == 1 && wantedTypes.indexOf('density') >= 0))\n            {\n                features = downsample(features, this.scale);\n            }\n        }\n\n        if (wantedTypes && wantedTypes.length == 1 && wantedTypes.indexOf('base-coverage') >= 0)\n        {\n            // Base-composition coverage track\n            needBaseComposition = true;\n        }\n\n\n        if (awaitedSeq) {\n            awaitedSeq.await(function(seq) {\n                if (needBaseComposition) {\n                    features = getBaseCoverage(features, seq, tier.browser.baseColors);\n                }\n                tier.setFeatures(chr, coverage, actualScale, features, seq);\n                tierRenderer.renderTier(status, tier);\n                tier.wasRendered()\n            });\n        } else {\n            tier.setFeatures(chr, coverage, actualScale, features);\n            tierRenderer.renderTier(status, tier);\n            tier.wasRendered();\n        }\n    }\n}\n\nif (typeof(module) !== 'undefined') {\n    module.exports = {\n        KnownSpace: KnownSpace\n    };\n}\n","/* -*- mode: javascript; c-basic-offset: 4; indent-tabs-mode: nil -*- */\n\n// \n// Dalliance Genome Explorer\n// (c) Thomas Down 2006-2011\n//\n// lh3utils.js: common support for lh3's file formats\n//\n\nif (typeof(require) !== 'undefined') {\n    var jszlib = require('jszlib');\n    var jszlib_inflate_buffer = jszlib.inflateBuffer;\n    var arrayCopy = jszlib.arrayCopy;\n}\n\nfunction Vob(b, o) {\n    this.block = b;\n    this.offset = o;\n}\n\nVob.prototype.toString = function() {\n    return '' + this.block + ':' + this.offset;\n}\n\nfunction readVob(ba, offset, allowZero) {\n    var block = ((ba[offset+6] & 0xff) * 0x100000000) + ((ba[offset+5] & 0xff) * 0x1000000) + ((ba[offset+4] & 0xff) * 0x10000) + ((ba[offset+3] & 0xff) * 0x100) + ((ba[offset+2] & 0xff));\n    var bint = (ba[offset+1] << 8) | (ba[offset]);\n    if (block == 0 && bint == 0 && !allowZero) {\n        return null;  // Should only happen in the linear index?\n    } else {\n        return new Vob(block, bint);\n    }\n}\n\nfunction unbgzf(data, lim) {\n    lim = Math.min(lim || 1, data.byteLength - 50);\n    var oBlockList = [];\n    var ptr = [0];\n    var totalSize = 0;\n\n    while (ptr[0] < lim) {\n        var ba = new Uint8Array(data, ptr[0], 12); // FIXME is this enough for all credible BGZF block headers?\n        var xlen = (ba[11] << 8) | (ba[10]);\n        // dlog('xlen[' + (ptr[0]) +']=' + xlen);\n        var unc = jszlib_inflate_buffer(data, 12 + xlen + ptr[0], Math.min(65536, data.byteLength - 12 - xlen - ptr[0]), ptr);\n        ptr[0] += 8;\n        totalSize += unc.byteLength;\n        oBlockList.push(unc);\n    }\n\n    if (oBlockList.length == 1) {\n        return oBlockList[0];\n    } else {\n        var out = new Uint8Array(totalSize);\n        var cursor = 0;\n        for (var i = 0; i < oBlockList.length; ++i) {\n            var b = new Uint8Array(oBlockList[i]);\n            arrayCopy(b, 0, out, cursor, b.length);\n            cursor += b.length;\n        }\n        return out.buffer;\n    }\n}\n\nfunction Chunk(minv, maxv) {\n    this.minv = minv; this.maxv = maxv;\n}\n\n\n//\n// Binning (transliterated from SAM1.3 spec)\n//\n\n/* calculate bin given an alignment covering [beg,end) (zero-based, half-close-half-open) */\nfunction reg2bin(beg, end)\n{\n    --end;\n    if (beg>>14 == end>>14) return ((1<<15)-1)/7 + (beg>>14);\n    if (beg>>17 == end>>17) return ((1<<12)-1)/7 + (beg>>17);\n    if (beg>>20 == end>>20) return ((1<<9)-1)/7 + (beg>>20);\n    if (beg>>23 == end>>23) return ((1<<6)-1)/7 + (beg>>23);\n    if (beg>>26 == end>>26) return ((1<<3)-1)/7 + (beg>>26);\n    return 0;\n}\n\n/* calculate the list of bins that may overlap with region [beg,end) (zero-based) */\nvar MAX_BIN = (((1<<18)-1)/7);\nfunction reg2bins(beg, end) \n{\n    var i = 0, k, list = [];\n    --end;\n    list.push(0);\n    for (k = 1 + (beg>>26); k <= 1 + (end>>26); ++k) list.push(k);\n    for (k = 9 + (beg>>23); k <= 9 + (end>>23); ++k) list.push(k);\n    for (k = 73 + (beg>>20); k <= 73 + (end>>20); ++k) list.push(k);\n    for (k = 585 + (beg>>17); k <= 585 + (end>>17); ++k) list.push(k);\n    for (k = 4681 + (beg>>14); k <= 4681 + (end>>14); ++k) list.push(k);\n    return list;\n}\n\nif (typeof(module) !== 'undefined') {\n    module.exports = {\n        unbgzf: unbgzf,\n        readVob: readVob,\n        reg2bin: reg2bin,\n        reg2bins: reg2bins,\n        Chunk: Chunk\n    };\n}\n","/* -*- mode: javascript; c-basic-offset: 4; indent-tabs-mode: nil -*- */\n\n// \n// Dalliance Genome Explorer\n// (c) Thomas Down 2006-2014\n//\n// memstore.js\n//\n\n\"use strict\";\n\nif (typeof(require) !== 'undefined') {\n    var sa = require('./sourceadapters');\n    var dalliance_registerSourceAdapterFactory = sa.registerSourceAdapterFactory;\n    var dalliance_makeParser = sa.makeParser;\n    var FeatureSourceBase = sa.FeatureSourceBase;\n\n    var das = require('./das');\n    var DASStylesheet = das.DASStylesheet;\n    var DASStyle = das.DASStyle;\n    var DASFeature = das.DASFeature;\n    var DASGroup = das.DASGroup;\n\n    var utils = require('./utils');\n    var Awaited = utils.Awaited;\n    var textXHR = utils.textXHR;\n}\n\nfunction MemStore() {\n    this.featuresByChr = {};\n    this.maxLength = 1;\n    this.chrRing = null;\n}\n\nMemStore.prototype.addFeatures = function(features) {\n    var dirty = {};\n    for (var fi = 0; fi < features.length; ++fi) {\n        var f = features[fi];\n        var chr = f.segment || f.chr;\n        var fa = this.featuresByChr[chr];\n        if (!fa) {\n            fa = [];\n            this.featuresByChr[chr] = fa;\n        }\n        fa.push(f);\n        dirty[chr] = true;\n\n        var len = f.max - f.min + 1;\n        if (len > this.maxLength)\n            this.maxLength = len;\n    }\n\n    for (chr in dirty) {\n        var fa = this.featuresByChr[chr];\n        fa.sort(function(f1, f2) {\n            var d = f1.min - f2.min;\n            if (d != 0)\n                return d;\n            return f1.max - f2.max;\n        });\n    }\n    this.chrRing = null;\n}\n\nMemStore.prototype._indexFor = function(fa, p) {\n    var lb = 0, ub = fa.length;\n    while (ub > lb) {\n        var mid = ((lb + ub)/2)|0;\n        if (mid >= fa.length)\n            return fa.length;\n        var mg = fa[mid];\n        if (p < mg.min) {\n            ub = mid;\n        } else {\n            lb = mid + 1;\n        }\n    }\n    return ub;\n}\n\nMemStore.prototype.fetch = function(chr, min, max) {\n    var fa = this.featuresByChr[chr];\n    if (!fa) {\n        if (chr.indexOf('chr') == 0)\n            fa = this.featuresByChr[chr.substring(3)];\n        else\n            fa = this.featuresByChr['chr' + chr];\n    }\n    if (!fa)\n        return [];\n\n    var mini = Math.max(0, this._indexFor(fa, min - this.maxLength - 1));\n    var maxi = Math.min(fa.length - 1, this._indexFor(fa, max));\n\n    var res = [];\n    for (var fi = mini; fi <= maxi; ++fi) {\n        var f = fa[fi];\n        if (f.min <= max && f.max >= min)\n            res.push(f);\n    }\n    return res;\n}\n\nMemStore.prototype.findNextFeature = function(chr, pos, dir) {\n    if (this.chrRing == null) {\n        this.chrRing = [];\n        for (var chr in this.featuresByChr) {\n            this.chrRing.push(chr);\n        }\n        this.chrRing.sort();\n    }\n\n    var fa = this.featuresByChr[chr];\n    if (!fa) {\n        if (chr.indexOf('chr') == 0) {\n            chr = chr.substring(3);\n            fa = this.featuresByChr[chr];\n        } else {\n            chr = 'chr' + chr;\n            fa = this.featuresByChr[chr];\n        }\n    }\n    if (!fa)\n        return null;\n\n    var i = Math.max(0, Math.min(this._indexFor(fa, pos), fa.length - 1));\n    if (dir > 0) {\n        while (i < fa.length) {\n            var f = fa[i++];\n            if (f.min > pos)\n                return f;\n        }\n        var chrInd = this.chrRing.indexOf(chr) + 1;\n        if (chrInd >= this.chrRing.length)\n            chrInd = 0;\n        return this.findNextFeature(this.chrRing[chrInd], 0, dir);\n    } else {\n        while (i >= 0) {\n            var f = fa[i--];\n            if (f.max < pos)\n                return f;\n        }\n        var chrInd = this.chrRing.indexOf(chr) - 1;\n        if (chrInd < 0)\n            chrInd = this.chrRing.length - 1;\n        return this.findNextFeature(this.chrRing[chrInd], 10000000000, dir);\n    }\n}\n\nfunction MemStoreFeatureSource(source) {\n    this.source = source;\n    FeatureSourceBase.call(this);\n    this.storeHolder = new Awaited();\n\n    this.parser = dalliance_makeParser(source.payload);\n    if (!this.parser) {\n        throw \"Unsupported memstore payload: \" + source.payload;\n    }\n\n    var thisB = this;\n    this._load(function(resp, err) {\n        if (err) {\n            thisB.error = err;\n            thisB.storeHolder.provide(null);\n        } else {\n            var store = new MemStore();\n            var features = [];\n            var session = thisB.parser.createSession(function(f) {features.push(f)});\n\n            if (err === 'already parsed') {\n                resp.forEach(function(feat) {\n                  session.validate(feat);\n                });\n            }\n            else {\n                var lines = resp.split('\\n');\n\n                for (var li = 0; li < lines.length; ++li) {\n                    var line = lines[li];\n                    if (line.length > 0) {\n                        session.parse(line);\n                    }\n                }\n                session.flush();\n            }\n            store.addFeatures(features);\n\n            thisB.storeHolder.provide(store);\n        }\n    });\n}\n\nMemStoreFeatureSource.prototype = Object.create(FeatureSourceBase.prototype);\n\nMemStoreFeatureSource.prototype._load = function(callback) {\n    if (this.source.blob) {\n        var r = new FileReader();\n        r.onloadend = function() {\n            return callback(r.result, r.error);\n        }\n        r.readAsText(this.source.blob);\n    } else if (this.source.features) {\n      return callback(this.source.features, 'already parsed');\n    } else {\n        if (this.source.credentials)\n            var opts = {credentials : this.source.credentials};\n        textXHR(this.source.uri, callback, opts);\n    }\n}\n\nMemStoreFeatureSource.prototype.fetch = function(chr, min, max, scale, types, pool, cnt) {\n    var thisB = this;\n    this.storeHolder.await(function(store) {\n        if (store) {\n            var f = store.fetch(chr, min, max);\n            return cnt(null, f, 100000000);\n        } else {\n            return cnt(thisB.error)\n        }\n    });\n}\n\nMemStoreFeatureSource.prototype.getStyleSheet = function(callback) {\n    if (this.parser && this.parser.getStyleSheet)\n        this.parser.getStyleSheet(callback)\n}\n\nMemStoreFeatureSource.prototype.getDefaultFIPs = function(callback) {\n    if (this.parser && this.parser.getDefaultFIPs)\n        this.parser.getDefaultFIPs(callback);\n}\n\nMemStoreFeatureSource.prototype.getScales = function() {\n    return 100000000;\n}\n\nMemStoreFeatureSource.prototype.findNextFeature = function(chr, pos, dir, callback) {\n    var thisB = this;\n    this.storeHolder.await(function(store) {\n        if (store) {\n            return callback(store.findNextFeature(chr, pos, dir));\n        } else {\n            return callback(null, thisB.error);\n        }\n    });\n}\n\n\nMemStoreFeatureSource.prototype.capabilities = function() {\n    var caps = {leap: true};\n    return caps;\n}\n\ndalliance_registerSourceAdapterFactory('memstore', function(source) {\n    return {features: new MemStoreFeatureSource(source)};\n});\n","/* jshint esversion: 6 */\n\"use strict\";\n\nimport { drawSeqTier } from \"./sequence-draw.js\";\n\nimport { GridGlyph } from \"./glyphs.js\";\n\nimport * as DefaultRenderer from \"./default-renderer\";\n\nimport * as R from \"ramda\";\n\nexport { renderTier, drawTier };\n\n\n/* Renders multiple tiers in a single track.\n   Works by simply drawing several tiers to a single canvas.\n   Actual rendering is done using default-renderer.es6.\n   A multi-tier renderer is configured by adding the following to a tier's\n   configuration:\n   renderer: 'multi',\n   multi: {\n       multi_id: \"multi_1\",\n   }\n\n   All subtiers with the \"multi_1\" multi_id will be drawn to this tier's canvas.\n */\n\nfunction renderTier(status, tier) {\n    drawTier(tier);\n    tier.updateStatus(status);\n}\n\nfunction drawTier(multiTier) {\n    let multiConfig = multiTier.dasSource.multi;\n    let getSubConfig = t => t.dasSource.sub;\n\n    // Padding is used for finding the correct canvas size and must be set\n    if (!multiTier.padding)\n        multiTier.padding = 3;\n\n    let canvas = multiTier.viewport.getContext(\"2d\");\n    let retina = multiTier.browser.retina && window.devicePixelRatio > 1;\n    if (retina) {\n        canvas.scale(2, 2);\n    }\n\n    // Filter out only tiers that are to be drawn in this multitier,\n    // and also have fetched data.\n    let tiers = multiTier.browser.tiers.\n            filter(tier => typeof(getSubConfig(tier)) === \"object\" &&\n                   getSubConfig(tier).multi_id === multiConfig.multi_id &&\n                   (tier.currentFeatures || tier.currentSequence));\n\n    // The shortest distance from the top of the canvas to a subtier\n    let minOffset = R.pipe(\n        R.map(tier => tier.dasSource.sub.offset),\n        R.reduce((acc, offset) => offset < acc ? offset : acc, 0)\n    )(tiers);\n\n    tiers.forEach(tier => {\n        if (tier.sequenceSource) {\n            drawSeqTier(tier, tier.currentSequence);\n        } else {\n            // Shift subtiers up by the minimum offset,\n            // so that there's no empty space at the top\n            DefaultRenderer.prepareSubtiers(tier, canvas,\n                                            getSubConfig(tier).offset - minOffset,\n                                            false);\n        }\n\n        // Must be set for painting to work\n        if (!multiTier.glyphCacheOrigin)\n            multiTier.glyphCacheOrigin = tier.glyphCacheOrigin;\n    });\n\n    // The canvas should fit all subtiers, including offsets, but no more\n    let canvasHeight = R.pipe(\n        R.map(tier =>\n              R.map(subtier => subtier.height + getSubConfig(tier).offset,\n                    tier.subtiers)),\n        R.flatten,\n        R.reduce((acc, h) => h > acc ? h : acc, -Infinity),\n        R.add(-minOffset)\n    )(tiers);\n\n    prepareViewport(multiTier, canvas, retina, canvasHeight, true);\n\n    tiers.sort((t1, t2) => getSubConfig(t1).z > getSubConfig(t2).z);\n\n    // TODO: make it add the glyph on to the first available tier;\n    // crashes if last tier is empty...\n    if (multiConfig.grid && tiers && tiers[tiers.length-1] && tiers[tiers.length-1].subtiers[0]) {\n        let grid = new GridGlyph(canvasHeight,\n                                 multiConfig.grid_offset,\n                                 multiConfig.grid_spacing);\n        // pretty hacky way of adding the grid, but it works (mostly)\n        tiers[tiers.length-1].subtiers[0].glyphs.unshift(grid);\n    }\n\n    tiers.forEach(tier => {\n        // Need to save and restore canvas to make sure that the subtiers are\n        // drawn on top of one another, if not shifted...\n        canvas.save();\n        DefaultRenderer.paint(tier, canvas, retina, true);\n        canvas.restore();\n    });\n\n    multiTier.drawOverlay();\n\n    if (multiConfig.quant) {\n        let quantCanvas = DefaultRenderer.createQuantOverlay(multiTier, canvasHeight+multiTier.padding*2, retina);\n        DefaultRenderer.paintQuant(quantCanvas, multiTier, multiConfig.quant, 10);\n    }\n\n    if (typeof(multiTier.dasSource.drawCallback) === \"function\") {\n        multiTier.dasSource.drawCallback(canvas, multiTier);\n    }\n\n    multiTier.originHaxx = 0;\n    multiTier.browser.arrangeTiers();\n}\n\nfunction prepareViewport(tier, canvas, retina, canvasHeight, clear=true) {\n    let desiredWidth = tier.browser.featurePanelWidth + 2000;\n    if (retina) {\n        desiredWidth *= 2;\n    }\n\n    let fpw = tier.viewport.width|0;\n    if (fpw < desiredWidth - 50) {\n        tier.viewport.width = fpw = desiredWidth;\n    }\n\n    canvasHeight += 2*tier.padding;\n    canvasHeight = Math.max(canvasHeight, tier.browser.minTierHeight);\n\n    if (canvasHeight != tier.viewport.height) {\n        tier.viewport.height = canvasHeight;\n\n        if (retina) {\n            tier.viewport.height *= 2;\n        }\n    }\n\n    tier.viewportHolder.style.left = '-1000px';\n    tier.viewport.style.width = retina ? ('' + (fpw/2) + 'px') : ('' + fpw + 'px');\n    tier.viewport.style.height = '' + canvasHeight + 'px';\n    tier.layoutHeight =  Math.max(canvasHeight, tier.browser.minTierHeight);\n\n    tier.updateHeight();\n    tier.norigin = tier.browser.viewStart;\n\n    if (clear) {\n        DefaultRenderer.clearViewport(canvas, fpw, canvasHeight);\n    }\n\n    DefaultRenderer.drawUnmapped(tier, canvas, canvasHeight);\n\n}\n","/* -*- mode: javascript; c-basic-offset: 4; indent-tabs-mode: nil -*- */\n\n// \n// Dalliance Genome Explorer\n// (c) Thomas Down 2006-2014\n//\n// memstore.js\n//\n\nfunction formatLongInt(n) {\n    return (n|0).toString().replace(/\\B(?=(\\d{3})+(?!\\d))/g, ',')\n}\n\nfunction formatQuantLabel(v) {\n    var t = '' + v;\n    var dot = t.indexOf('.');\n    if (dot < 0) {\n        return t;\n    } else {\n        var dotThreshold = 2;\n        if (t.substring(0, 1) == '-') {\n            ++dotThreshold;\n        }\n\n        if (dot >= dotThreshold) {\n            return t.substring(0, dot);\n        } else {\n            return t.substring(0, dot + 2);\n        }\n    }\n}\n\nif (typeof(module) !== 'undefined') {\n    module.exports = {\n        formatLongInt: formatLongInt,\n        formatQuantLabel: formatQuantLabel\n    };\n}","/* -*- mode: javascript; c-basic-offset: 4; indent-tabs-mode: nil -*- */\n\n// \n// Dalliance Genome Explorer\n// (c) Thomas Down 2006-2013\n//\n// overlay.js: featuresources composed from multiple underlying sources\n//\n\n\"use strict\";\n\nif (typeof(require) !== 'undefined') {\n    var utils = require('./utils');\n    var shallowCopy = utils.shallowCopy;\n    var arrayIndexOf = utils.arrayIndexOf;\n}\n\nfunction OverlayFeatureSource(sources, opts) {\n    this.sources = sources;\n    this.opts = opts || {};\n    this.activityListeners = [];\n    this.readinessListeners = [];\n    this.changeListeners = [];\n    this.business = [];\n    this.readiness = [];\n\n    for (var i = 0; i < this.sources.length; ++i) {\n        this.initN(i);\n    }\n\n    if (typeof(opts.merge) === 'function') {\n        this.merge = opts.merge;\n    } else if (opts.merge == 'concat') {\n        this.merge = OverlayFeatureSource_merge_concat;\n    } else if (opts.merge == 'alternates') {\n        this.merge = OverlayFeatureSource_merge_concat;\n        this.filterDispatchOnMethod = true;\n    } else {\n        this.merge = OverlayFeatureSource_merge_byKey;\n    }\n}\n\nOverlayFeatureSource.prototype.initN = function(n) {\n    var s = this.sources[n];\n    var thisB = this;\n    this.business[n] = 0;\n\n    if (s.addActivityListener) {\n        s.addActivityListener(function(b) {\n            thisB.business[n] = b;\n            thisB.notifyActivity();\n        });\n    }\n    if (s.addChangeListener) {\n        s.addChangeListener(function() {\n            thisB.notifyChange();\n        });\n    }\n    if (s.addReadinessListener) {\n        s.addReadinessListener(function(r) {\n            thisB.readiness[n] = r;\n            thisB.notifyReadiness();\n        });\n    }\n}\n\nOverlayFeatureSource.prototype.addReadinessListener = function(l) {\n    this.readinessListeners.push(l);\n    this.notifyReadinessListener(l);\n}\n\nOverlayFeatureSource.prototype.removeReadinessListener = function(l) {\n    var idx = arrayIndexOf(this.readinessListeners, l);\n    if (idx >= 0) {\n        this.readinessListeners.splice(idx, 1);\n    }\n}\n\nOverlayFeatureSource.prototype.notifyReadiness = function() {\n    for (var i = 0; i < this.readinessListeners.length; ++i) {\n        this.notifyReadinessListener(this.readinessListeners[i]);\n    }\n}\n\nOverlayFeatureSource.prototype.notifyReadinessListener = function(l) {\n    var r = null;\n    for (var i = 0; i < this.readiness.length; ++i) {\n        if (this.readiness[i] != null) {\n            r = this.readiness[i]; break;\n        }\n    }\n    try {\n        l(r);\n    } catch (e) {\n        console.log(e);\n    }\n}\n\nOverlayFeatureSource.prototype.addActivityListener = function(l) {\n    this.activityListeners.push(l);\n}\n\nOverlayFeatureSource.prototype.removeActivityListener = function(l) {\n    var idx = arrayIndexOf(this.activityListeners, l);\n    if (idx >= 0) {\n        this.activityListeners.splice(idx, 1);\n    }\n}\n\nOverlayFeatureSource.prototype.notifyActivity = function() {\n    var busy = 0;\n    for (var i = 0; i < this.business.length; ++i) {\n        busy += this.business[i];\n    }\n\n    for (var li = 0; li < this.activityListeners.length; ++li) {\n        try {\n            this.activityListeners[li](busy);\n        } catch (e) {\n            console.log(e);\n        }\n    }\n}\n\nOverlayFeatureSource.prototype.addChangeListener = function(listener) {\n    this.changeListeners.push(listener);\n}\n\nOverlayFeatureSource.prototype.removeChangeListener = function(l) {\n    var idx = arrayIndexOf(this.changeListeners, l);\n    if (idx >= 0) {\n        this.changeListeners.splice(idx, 1);\n    }\n}\n\nOverlayFeatureSource.prototype.notifyChange = function() {\n    for (var li = 0; li < this.changeListeners.length; ++li) {\n        try {\n            this.changeListeners[li](this.busy);\n        } catch (e) {\n            console.log(e);\n        }\n    }\n}\n\nOverlayFeatureSource.prototype.getScales = function() {\n    return this.sources[0].getScales();\n}\n\nOverlayFeatureSource.prototype.getStyleSheet = function(callback) {\n    return this.sources[0].getStyleSheet(callback);\n}\n\nOverlayFeatureSource.prototype.capabilities = function() {\n    var caps = {};\n    var s0 = this.sources[0];\n    if (s0.capabilities) \n        caps = shallowCopy(s0.capabilities());\n\n    for (var i = 1; i < this.sources.length; ++i) {\n        var si = this.sources[i];\n        if (si.capabilities) {\n            var co = si.capabilities();\n            if (co.search) {\n                caps.search = co.search;\n            }\n        }\n    }\n\n    return caps;\n}\n\nOverlayFeatureSource.prototype.search = function(query, callback) {\n    for (var i = 0; i < this.sources.length; ++i) {\n        if (_sourceAdapterIsCapable(this.sources[i], 'search')) {\n            return this.sources[i].search(query, callback);\n        }\n    }\n}\n\nOverlayFeatureSource.prototype.fetch = function(chr, min, max, scale, types, pool, callback, styleFilters) {\n    var sources;\n    if (this.filterDispatchOnMethod) {\n        sources = [];\n        var sfl = styleFilters.list();\n        for (var si = 0; si < this.sources.length; ++si) {\n            var source = this.sources[si];\n            for (var fi = 0; fi < sfl.length; ++fi) {\n                var filter = sfl[fi];\n                if (!filter.method || filter.method == source.name) {\n                    sources.push(source);\n                    break;\n                }\n            }\n        }\n    } else {\n        sources = this.sources;\n    }\n\n    var baton = new OverlayBaton(this, callback, sources);\n    for (var si = 0; si < sources.length; ++si) {\n\t   this.fetchN(baton, si, sources[si], chr, min, max, scale, types, pool, styleFilters);\n    }\n}\n\nOverlayFeatureSource.prototype.fetchN = function(baton, si, source, chr, min, max, scale, types, pool, styleFilters) {\n    // FIXME should we try to prune styleFilters?\n    source.fetch(chr, min, max, scale, types, pool, function(status, features, scale) {\n\t   return baton.completed(si, status, features, scale);\n    }, styleFilters);\n}\n\nOverlayFeatureSource.prototype.quantFindNextFeature = function(chr, pos, dir, threshold, callback) {\n    return this.sources[0].quantFindNextFeature(chr, pos, dir, threshold, callback);\n}\n\nOverlayFeatureSource.prototype.findNextFeature = function(chr, pos, dir, callback) {\n    return this.sources[0].findNextFeature(chr, pos, dir, callback);\n}\n\nfunction OverlayBaton(source, callback, sources) {\n    this.source = source;\n    this.callback = callback;\n    this.sources = sources;\n    this.count = sources.length;\n\n    this.returnCount = 0;\n    this.statusCount = 0;\n    this.returns = [];\n    this.features = []\n    this.statuses = [];\n    this.scale = null;\n}\n\nOverlayBaton.prototype.completed = function(index, status, features, scale) {\n    if (this.scale == null || index == 0) \n\t   this.scale = scale;\n\n    if (this.returns[index])\n\t   throw 'Multiple returns for source ' + index;\n\n    this.returns[index] = true;\n    this.returnCount++;\n\n    this.features[index] = features;\n\n    if (status) {\n    \tthis.statuses[index] = status;\n    \tthis.statusCount++;\n    }\n\n\n    if (this.returnCount == this.count) {\n    \tif (this.statusCount > 0) {\n    \t    var message = '';\n    \t    for (var si = 0; si < this.count; ++si) {\n        \t\tvar s = this.statuses[si];\n        \t\tif (s) {\n        \t\t    if (message.length > 0) \n        \t\t\tmessage += ', ';\n        \t\t    message += s;\n        \t\t}\n    \t    }\n    \t    return this.callback(message, null, this.scale);\n    \t} else {\n    \t    this.callback(null, this.source.merge(this.features, this.sources), this.scale);\n    \t}\n    }\n}\n\nOverlayFeatureSource.prototype.getDefaultFIPs = function(callback) {\n    for (var si = 0; si < this.sources.length; ++si) {\n        var s = this.sources[si];\n        if (s.getDefaultFIPs)\n            s.getDefaultFIPs(callback);\n    }\n}\n\nOverlayFeatureSource.prototype.keyForFeature = function(feature) {\n    return '' + feature.min + '..' + feature.max;\n}\n\nfunction OverlayFeatureSource_merge_byKey(featureSets) {\n    var omaps = [];\n\n    for (var fsi = 1; fsi < featureSets.length; ++fsi) {\n        var om = {};\n        var of = featureSets[fsi];\n        for (var fi = 0; fi < of.length; ++fi) {\n    \t   om[this.keyForFeature(of[fi])] = of[fi];\n        }\n        omaps.push(om);\n    }\n\n\n    var mf = [];\n    var fl = featureSets[0];\n    for (var fi = 0; fi < fl.length; ++fi) {\n    \tvar f = fl[fi];\n\n        for (var oi = 0; oi < omaps.length; ++oi) {\n            var om = omaps[oi];\n        \tof = om[this.keyForFeature(f)]\n        \tif (of) {\n                for (var k in of) {\n                    if (k === 'score') {\n                        f.score2 = of.score;\n                    } else if (k === 'min' || k === 'max' || k === 'segment' || k === '_cachedStyle') {\n                        // do nothing\n                    } else {\n                        f[k] = of[k];\n                    }\n                }\n        \t}\n        }\n    \tmf.push(f);\n    }\n    return mf;\n}\n\nfunction OverlayFeatureSource_merge_concat(featureSets, sources) {\n    var features = [];\n    for (var fsi = 0; fsi < featureSets.length; ++fsi) {\n        var fs = featureSets[fsi];\n        var name = sources[fsi].name;\n        for (var fi = 0; fi < fs.length; ++fi) {\n            var f = fs[fi];\n            f.method = name;\n            features.push(f);\n        }\n    }\n    return features;\n}\n\nfunction _sourceAdapterIsCapable(s, cap) {\n    if (!s.capabilities)\n        return false;\n    else \n        return s.capabilities()[cap];\n}\n\nif (typeof(module) !== 'undefined') {\n    module.exports = {\n        OverlayFeatureSource: OverlayFeatureSource\n    };\n}\n\n\n","/* -*- mode: javascript; c-basic-offset: 4; indent-tabs-mode: nil -*- */\n\n// \n// Dalliance Genome Explorer\n// (c) Thomas Down 2006-2014\n//\n// bedwig.js\n//\n\n\"use strict\";\n\nif (typeof(require) !== 'undefined') {\n    var bin = require('./bin');\n    var URLFetchable = bin.URLFetchable;\n    var BlobFetchable = bin.BlobFetchable;\n    var readInt = bin.readInt;\n\n    var bbi = require('./bigwig');\n    var BIG_WIG_MAGIC = bbi.BIG_WIG_MAGIC;\n    var BIG_BED_MAGIC = bbi.BIG_BED_MAGIC;\n\n    var lh3utils = require('./lh3utils');\n    var unbgzf = lh3utils.unbgzf;\n\n    var bam = require('./bam');\n    var BAM_MAGIC = bam.BAM_MAGIC;\n    var BAI_MAGIC = bam.BAI_MAGIC;\n\n    var tbi = require('./tabix');\n    var TABIX_MAGIC = tbi.TABIX_MAGIC;\n\n    var EncodeFetchable = require('./encode').EncodeFetchable;\n}\n\nfunction probeResource(source, listener, retry) {\n    var BED_REGEXP = new RegExp('^\\\\w+\\\\s[0-9]+\\\\s[0-9]+.*$');\n    var KV_REGEXP=/([^=]+)=\\\"?([^\\\"]+)\\\"?/;\n    var VCFHEAD_RE = /^##\\s*fileformat=VCFv4\\..+/;\n\n    var fetchable;\n    if (source.blob)\n        fetchable = new BlobFetchable(source.blob);\n    else if (source.transport == 'encode')\n        fetchable = new EncodeFetchable(source.uri);\n    else\n        fetchable = new URLFetchable(source.uri, {credentials: source.credentials});\n\n    fetchable.slice(0, 1<<16).salted().fetch(function(result, error) {\n        if (!result) {\n            if (!retry) {\n                source.credentials = true;\n                probeResource(source, listener, true)\n            }\n\n            return listener(source, \"Couldn't fetch data\");\n        }\n\n        var ba = new Uint8Array(result);\n        var la = new Uint32Array(result, 0, 1);\n        var magic = la[0];\n        if (magic == BIG_WIG_MAGIC || magic == BIG_BED_MAGIC) {\n            source.tier_type = 'bwg';\n            var nameExtractPattern = new RegExp('/?([^/]+?)(.bw|.bb|.bigWig|.bigBed)?$');\n            var match = nameExtractPattern.exec(source.uri || source.blob.name);\n            if (match) {\n                source.name = match[1];\n            }\n\n            return listener(source, null);\n        } else if (magic == BAI_MAGIC) {\n            source.tier_type = 'bai';\n            return listener(source, null);\n        } else if (ba[0] == 31 || ba[1] == 139) {\n            var unc = unbgzf(result);\n            var uncba = new Uint8Array(unc);\n            magic = readInt(uncba, 0);\n            if (magic == BAM_MAGIC) {\n                source.tier_type = 'bam';\n                var nameExtractPattern = new RegExp('/?([^/]+?)(.bam)?$');\n                var match = nameExtractPattern.exec(source.uri || source.blob.name);\n                if (match) {\n                    source.name = match[1];\n                }\n\n                return listener(source, null);\n            } else if (magic == TABIX_MAGIC) {\n                source.tier_type = 'tabix-index';\n                return listener(source, null);\n            } else if (magic == 0x69662323) {\n                source.tier_type = 'tabix';\n                source.payload = 'vcf';\n                var nameExtractPattern = new RegExp('/?([^/]+?)(.vcf)?(.gz)?$');\n                var match = nameExtractPattern.exec(source.uri || source.blob.name);\n                if (match) {\n                    source.name = match[1];\n                }\n\n                return listener(source, null);\n            } else {\n                console.log('magic = ' + magic.toString(16));\n               return listener(source, \"Unsupported format\");\n            }\n        } else {\n            var text = String.fromCharCode.apply(null, ba);\n            var lines = text.split(\"\\n\");\n\n            if (lines.length > 0 && VCFHEAD_RE.test(lines[0])) {\n                source.tier_type = 'memstore';\n                source.payload = 'vcf';\n                var nameExtractPattern = new RegExp('/?([^/]+?)(\\.vcf)?$');\n                var match = nameExtractPattern.exec(source.uri || source.blob.name);\n                if (match && !source.name) {\n                    source.name = match[1];\n                }\n                return listener(source, null);\n            }\n\n            for (var li = 0; li < lines.length; ++li) {\n                var line = lines[li].replace('\\r', '');\n                if (line.length == 0) continue;\n\n                if (line.indexOf('browser') == 0) continue;\n\n                if (line.indexOf('track') == 0) {\n                    var maybeType = 'bed';\n                    var toks = line.split(/\\s/);\n                    for (var ti = 1; ti < toks.length; ++ti) {\n                        var m = KV_REGEXP.exec(toks[ti]);\n                        if (m) {\n                            if (m[1] == 'type' && m[2] == 'wiggle_0') {\n                                maybeType = 'wig'\n                            } else if (m[0] == 'name') {\n                                source.name = m[2];\n                            }\n                        }\n                    }\n\n                    finishProbeBedWig(source, maybeType);\n                    return listener(source, null);\n                }\n\n                if (line.indexOf('fixedStep') == 0) {\n                    finishProbeBedWig(source, 'wig');\n                    return listener(source, null);\n                }\n\n                if (line.indexOf('variableStep') == 0) {\n                    finishProbeBedWig(source, 'wig');\n                    return listener(source, null);\n                }\n\n                if (BED_REGEXP.test(line)) {\n                    finishProbeBedWig(source, null);\n                    return listener(source, null);\n                }\n\n                break;\n            }\n\n            return listener(source, \"Unsupported format\");\n        }\n    }, {timeout: 1500});  // Timeout to catch mixed-origin case on Chromium.\n}\n\nfunction finishProbeBedWig(source, maybeType) {\n    source.tier_type = 'memstore';\n    var nameExtractPattern = new RegExp('/?([^/]+?)(.(bed|wig))?$');\n    var match = nameExtractPattern.exec(source.uri || source.blob.name);\n    if (match) {\n        if (!source.name)\n            source.name = match[1];\n        if (!maybeType && match[3]) {\n            maybeType = match[3];\n        }\n    }\n    source.payload = maybeType || 'bed';\n}\n\nif (typeof(module) !== 'undefined') {\n    module.exports = {\n        probeResource: probeResource\n    };\n}\n","/* jshint esversion: 6 */\n\n\"use strict\";\n\nexport { Ruler, rulerDrawCallback };\n\n\nfunction Ruler(options) {\n    let self = this;\n\n    self.value = options.value;\n    self.min = options.min;\n    self.max = options.max;\n    self.width = options.width;\n    self.color = options.color;\n\n    Object.keys(self).map(key => {\n        if (self[key] === undefined) {\n            console.log(\"WARNING: Ruler option \" + key + \" not set\");\n        }\n    });\n}\n\nRuler.prototype.constructor = Ruler;\n\nfunction rulerDrawCallback(canvas, tier) {\n    let rulers = tier.dasSource.rulers;\n\n    if (!rulers) {\n        console.log(\"Tier uses ruler callback but has no rulers!\");\n    } else if (!(rulers instanceof Array)) {\n        console.log(\"rulers.js: 'rulers' should be an Array\");\n    }\n\n\n    rulers.map(r => {\n        let rulerY = ((r.max - r.value) * r.height);\n        let viewWidth = tier.viewport.width;\n        let oldLineWidth = canvas.lineWidth;\n\n        canvas.strokeStyle = r.color;\n        canvas.beginPath();\n        canvas.moveTo(-viewWidth, rulerY + r.offset);\n        // Other parts of the code rely on not having changed the lineWidth...\n        // So we need to change it back when we're done.\n        canvas.lineWidth = r.width;\n        canvas.lineTo(2*viewWidth, rulerY + r.offset);\n        canvas.stroke();\n        canvas.lineWidth = oldLineWidth;\n    });\n}\n","/* -*- mode: javascript; c-basic-offset: 4; indent-tabs-mode: nil -*- */\n\n// \n// Dalliance Genome Explorer\n// (c) Thomas Down 2006-2010\n//\n// sample.js: downsampling of quantitative features\n//\n\n\"use strict\";\n\nif (typeof(require) !== 'undefined') {\n    var das = require('./das');\n    var DASFeature = das.DASFeature;\n\n    var parseCigar = require('./cigar').parseCigar;\n\n    var shallowCopy = require('./utils').shallowCopy;\n}\n\nvar __DS_SCALES = [1, 2, 5];\n\nfunction ds_scale(n) {\n    return __DS_SCALES[n % __DS_SCALES.length] * Math.pow(10, (n / __DS_SCALES.length)|0);\n}\n\n\nfunction DSBin(scale, min, max) {\n    this.scale = scale;\n    this.tot = 0;\n    this.cnt = 0;\n    this.hasScore = false;\n    this.min = min; this.max = max;\n    this.features = [];\n}\n\nfunction _featureOrder(a, b) {\n    if (a.min < b.min) {\n        return -1;\n    } else if (a.min > b.min) {\n        return 1;\n    } else if (a.max < b.max) {\n        return -1;\n    } else if (b.max > a.max) {\n        return 1;\n    } else {\n        return 0;\n    }\n}\n\nDSBin.prototype.score = function() {\n    if (this.cnt == 0) {\n        return 0;\n    } else if (this.hasScore) {\n        return this.tot / this.cnt;\n    } else {\n        var features = this.features;\n        features.sort(_featureOrder);\n\n        var maxSeen = -10000000000;\n        var cov=0, lap=0;\n\n        for (var fi = 1; fi < features.length; ++fi) {\n            var f = features[fi];\n            var lMin = Math.max(f.min, this.min);\n            var lMax = Math.min(f.max, this.max);\n            lap += (lMax - lMin + 1);\n\n            if (lMin > maxSeen) {\n                cov += lMax - lMin + 1;\n                maxSeen = lMax;\n            } else {\n                if (lMax > maxSeen) {\n                    cov += (lMax - maxSeen);\n                    maxSeen = lMax;\n                }\n            }\n        }\n\n        if (cov > 0)\n            return (1.0 * lap) / cov;\n        else\n            return 0;\n    }\n}\n\nDSBin.prototype.feature = function(f) {\n    if (f.score !== undefined) {\n        this.tot += f.score;\n        this.hasScore = true\n    }\n\n    ++this.cnt;\n    this.features.push(f);\n}\n\nfunction downsample(features, targetRez) {\n    var sn = 0;\n    while (ds_scale(sn + 1) < targetRez) {\n        ++sn;\n    }\n    var scale = ds_scale(sn);\n\n    var binTots = [];\n    var maxBin = -10000000000;\n    var minBin = 10000000000;\n    for (var fi = 0; fi < features.length; ++fi) {\n        var f = features[fi];\n        if (f.groups && f.groups.length > 0) {\n            // Don't downsample complex features (?)\n            return features;\n        }\n\n        var minLap = (f.min / scale)|0;\n        var maxLap = (f.max / scale)|0;\n        maxBin = Math.max(maxBin, maxLap);\n        minBin = Math.min(minBin, minLap);\n        for (var b = minLap; b <= maxLap; ++b) {\n            var bm = binTots[b];\n            if (!bm) {\n                bm = new DSBin(scale, b * scale, (b + 1) * scale - 1);\n                binTots[b] = bm;\n            }\n            bm.feature(f);\n        }\n    }\n\n    var sampledFeatures = [];\n    for (var b = minBin; b <= maxBin; ++b) {\n        var bm = binTots[b];\n        if (bm) {\n            var f = new DASFeature();\n            f.segment = features[0].segment;\n            f.min = (b * scale) + 1;\n            f.max = (b + 1) * scale;\n            f.score = bm.score();\n            f.type = 'density';\n            sampledFeatures.push(f);\n        }\n    }\n\n    var afterDS = Date.now();\n    return sampledFeatures;\n}\n\n/** Data structure to store information for\na base position:\n\npos: position of the base.\n*/\nfunction BaseBin(pos) {\n\n    this._pos = pos;\n    this._bases = {};\n    this._totalCount = 0;\n}\n\n/** Keep record for incidence of a base,\nwith related qual score and strand for a position.\n\nParams\n    base: base (e.g A, T, G, C, N) observed at position.\n    qual: numeric quality score.\n    strand: '+' or '-'.\n*/\nBaseBin.prototype.recordBase = function(base, qual, strand) {\n    if (!this._bases[base]) {\n        var strandComposition = {'+': 0, '-': 0};\n        strandComposition[strand]++;\n        this._bases[base] = {\n            cnt: 1,\n            totalQual: qual,\n            strandCnt: strandComposition\n        };\n    } else {\n        var baseComposition = this._bases[base];\n        baseComposition.cnt++;\n        baseComposition.totalQual += qual;\n        baseComposition.strandCnt[strand]++;\n    }\n    this._totalCount++;\n};\n\n/** Returns count of total number of bases observed at position */\nBaseBin.prototype.totalCount = function() {return this._totalCount;};\n\n/** Returns the base position */\nBaseBin.prototype.pos = function() {return this._pos;};\n\n/** Creates a list of tag, info pairs in the form\n[tag]=[info] for each base, for use in feature-popup */\nBaseBin.prototype.infoList = function() {\n    var info = [];\n    var totalCount = this._totalCount;\n    var totalCountStr = \"Depth=\" + totalCount.toString();\n    info.push(totalCountStr);\n    for (var base in this._bases) {\n        var baseComposition = this._bases[base];\n        var baseCnt = baseComposition.cnt;\n        var basePercentage = (baseCnt * 100 / totalCount); \n        var plusStrandCnt = baseComposition.strandCnt['+'];\n        var minusStrandCnt = baseComposition.strandCnt['-'];\n        var meanQual = baseComposition.totalQual/baseCnt;\n\n        var baseInfoString = [base, '=', baseCnt, ' (', basePercentage.toFixed(0), '%, ',\n                              plusStrandCnt, ' +, ', minusStrandCnt, ' -, Qual: ', meanQual.toFixed(0), ')'];\n        info.push(baseInfoString.join(''));\n    }\n    return info;\n};\n\n/** Return a list of objects for creating a\nhistogram showing composition of different bases at a\ngiven location.\n\nCurrent implementation is hacky: the logic involves\noverlaying BoxGlyphs on top of each other, thus the score\nis not meaningful, but only used to manipulate height.\n\nParams:\n  ref: reference base at position\n  threshold: value between 0 and 1 representing min allele frequency\n              below which the allele will be ignored in histogram.\n              (interpreted as noise)\n              Similar to 'allele threshold' parameter in IGV\n\nReturns a list of objects containing 2 properties\n    base: such as A, T, G, C, N, - (del)\n    score: a numeric score for determining height of histogram\nThe list is ordered such that a preceeding object always have a\nscore >= the current object, and the ref base will be the last item.\n\nExample: There are 50 T's and 40 A's (total depth = 90)\nat a base where ref=A. The function will return\n[T: 90, A: 40]. When creating a histogram with overlap,\nthis will give an appearance of 40 A's (bottom) and 50 T's (top):\n#######\n#  T  #\n#  T  #\n#  T  #\n#  T  #\n#  T  #\n#######\n#  A  #\n#  A  #\n#  A  #\n#  A  #\n#######\n*/\nBaseBin.prototype.baseScoreList = function(ref, threshold) {\n    var baseScoreList = [];\n    var totalCount = this._totalCount;\n    var minCount = threshold * totalCount;\n    for (var base in this._bases) {\n        var baseCount = this._bases[base].cnt;\n        if (baseCount < minCount || base == ref)\n            continue;\n        var baseScorePair = {base: base, score: totalCount};\n        baseScoreList.push(baseScorePair);\n        totalCount -= baseCount;\n    }\n    baseScoreList.push({base: ref, score: totalCount});\n    return baseScoreList;\n};\n\n/** Generates an aligned read from the raw sequence of a BAM record\nusing given cigar string.\n\nParams:\n  rawseq: unaligned read sequence from Bam record\n  rawquals: unaligned read quals from Bam record\n  cigar: Bam cigar string from Bam record\n\nReturns an object with 2 properties:\n  seq: string containing aligned read\n  quals: string containing printable-character representation\n         of sequencing quality score\n*/\nfunction alignSeqUsingCigar(rawseq, rawquals, cigar) {\n    var ops = parseCigar(cigar);\n    var seq = [];\n    var quals = [];\n    var cursor = 0;\n    for (var ci = 0; ci < ops.length; ++ci) {\n        var co = ops[ci];\n        if (co.op == 'M') {\n            seq.push(rawseq.substr(cursor, co.cnt));\n            quals.push(rawquals.substr(cursor, co.cnt));\n            cursor += co.cnt;\n        } else if (co.op == 'D') {\n            for (var oi = 0; oi < co.cnt; ++oi) {\n                seq.push('-');\n                quals.push('Z');\n            }\n        } else if (co.op == 'I') {\n            cursor += co.cnt;\n        } else if (co.op == 'S') {\n            cursor += co.cnt;\n        } else {\n            console.log('unknown cigop' + co.op);\n        }\n    }\n    var processedSeq = {seq: seq.join(''), quals: quals.join('')};\n    return processedSeq;\n}\n\n/** Constructs the reference sequence for a given window.\n\nParams\n    currentSequence: DasSequence object containing ref sequence\n                     in current browser view.\n    min, max: min and max position for window.\n\nReturns a string containing the refseq, padded with 'N' where sequence is not\n    available.\n*/\nfunction getRefSeq(currentSequence, min, max) {\n    var refSeq = [];\n    if (currentSequence) {\n        var csStart = currentSequence.start|0;\n        var csEnd = currentSequence.end|0;\n        if (csStart <= max && csEnd >= min) {\n            var sfMin = Math.max(min, csStart);\n            var sfMax = Math.min(max, csEnd);\n\n            for (var i = 0; i < sfMin - min; i++)\n                refSeq.push('N');\n            refSeq.push(currentSequence.seq.substr(sfMin - csStart, sfMax - sfMin + 1));\n            for (var i = 0; i < max - sfMax; i++)\n                refSeq.push('N');\n        }\n    }\n    return refSeq.join('');\n}\n\n/** Constructs features necessary for a coverage track showing\nbase composition for BAM reads\n\nParams\n    features: a list of features from BAM records.\n    currentRefSeq: a DASSequence object containing reference sequence.\n    baseColors: an object mapping base to desired colors.\n\nReturns a list of features of type base-coverage.\n*/\nfunction getBaseCoverage(features, currentRefSeq, baseColors) {\n    var minBin = null;\n    var maxBin = null;\n\n    var allBins = [];\n\n    // Populate BaseBins\n    for (var fi = 0; fi < features.length; ++fi) {\n        var f = features[fi];\n        if (f.groups && f.groups.length > 0) {\n            // Don't downsample complex features\n            return features;\n        }\n        var processedSeq = alignSeqUsingCigar(f.seq, f.quals, f.cigar);\n        var seq = processedSeq.seq;\n        var quals = processedSeq.quals;\n        var strand = f.orientation;\n        var minForFeature = f.min || 0;\n        var maxForFeature = f.max || 0;\n        var ind = 0;\n\n        for (var b = minForFeature; b <= maxForFeature; ++b) {\n            var bm = allBins[b];\n            if (!bm) {\n                bm = new BaseBin(b);\n                allBins[b] = bm;\n            }\n            var base = seq.charAt(ind);\n            var qual = quals.charCodeAt(ind) - 33; // Generate numeric qual score\n            bm.recordBase(base, qual, strand);\n            ind++;\n        }\n\n        if (!minBin)\n            minBin = minForFeature;\n        else\n            minBin = Math.min(minBin, minForFeature);\n        if (!maxBin)\n            maxBin = maxForFeature;\n        else\n            maxBin = Math.max(maxBin, maxForFeature);\n    }\n\n    // Generate coverage features\n    var refSeq = getRefSeq(currentRefSeq, minBin, maxBin);\n    var baseFeatures = [];\n    var ind = 0;\n    for (var b = minBin; b <= maxBin; ++b) {\n        var bm = allBins[b];\n        if (bm) {\n            var f = new DASFeature();\n            f.segment = features[0].segment;\n            f.min = bm.pos();\n            f.max = f.min;\n            f.notes = [];\n            f.notes = f.notes.concat(bm.infoList());\n            f.type = 'base-coverage';\n            f.suppressScore = true;\n            if (refSeq) {\n                var refBase = refSeq.charAt(ind);\n                var refString = 'Ref=' + refBase;\n                f.notes.unshift(refString);\n                var baseScoreList = bm.baseScoreList(refBase, 0.2);\n                // TODO: shift 0.2 threshold to a config parameter\n                for (var i = 0; i < baseScoreList.length; i++) {\n                    var base = baseScoreList[i].base;\n                    var score = baseScoreList[i].score;\n                    var fBase = shallowCopy(f);\n                    fBase.score = score;\n                    // Color by baseColor when mismatch occurs\n                    // otherwise, BoxGlyph to COLOR1 in style\n                    if (baseScoreList.length > 1 || base != refBase)\n                        fBase.itemRgb = baseColors[base];\n\n                    baseFeatures.push(fBase);\n                }\n            } else {\n                // No refSeq, only show coverage height.\n                baseFeatures.push(f);\n            }\n        }\n        ind ++;\n    }\n    return baseFeatures;\n}\n\nif (typeof(module) !== 'undefined') {\n    module.exports = {\n        downsample: downsample,\n        getBaseCoverage: getBaseCoverage\n    };\n}\n","/* -*- mode: javascript; c-basic-offset: 4; indent-tabs-mode: nil -*- */\n\n// \n// Dalliance Genome Explorer\n// (c) Thomas Down 2006-2011\n//\n// bin.js general binary data support\n//\n\n\"use strict\";\n\nif (typeof(require) !== 'undefined') {\n    var browser = require('./cbrowser');\n    var Browser = browser.Browser;\n\n    var bin = require('./bin');\n    var URLFetchable = bin.URLFetchable;\n\n    var connectTrix = require('./trix').connectTrix;\n}\n\nvar REGION_PATTERN = /^([\\d+,\\w,\\.,\\_,\\-]+)[\\s:]+([0-9,\\.]+?)([KkMmGg])?((-|\\.\\.|\\s)+([0-9,\\.]+)([KkMmGg])?)?$/;\n\nfunction parseLocCardinal(n, m) {\n    var i = parseFloat(n.replace(/,/g, ''));\n    if (m === 'k' || m === 'K') {\n        return (i * 1000)|0;\n    } else if (m == 'm' || m === 'M') {\n        return (i * 1000000)|0;\n    } else {\n        return i|0;\n    }\n}\n\nBrowser.prototype.search = function(g, statusCallback, opts) {\n    var thisB = this;\n    opts = opts || {};\n    var srPadding = opts.padding || this.defaultSearchRegionPadding;\n    \n    var m = REGION_PATTERN.exec(g);\n\n    if (m) {\n        var chr = m[1], start, end;\n        if (m[6]) {\n            start = parseLocCardinal(m[2],  m[3]);\n            end = parseLocCardinal(m[6], m[7]);\n        } else {\n            var width = this.viewEnd - this.viewStart + 1;\n            start = (parseLocCardinal(m[2], m[3]) - (width/2))|0;\n            end = start + width - 1;\n        }\n        this.setLocation(chr, start, end, statusCallback);\n    } else {\n        if (!g || g.length == 0) {\n            return false;\n        }\n\n        var searchCount = 0;\n        var foundLatch = false;\n\n        var searchCallback = function(found, err) {\n            --searchCount;\n            if (err) {\n                return statusCallback(err);\n            }\n\n            if (!found) found = [];\n            var min = 500000000, max = -100000000;\n            var nchr = null;\n            for (var fi = 0; fi < found.length; ++fi) {\n                var f = found[fi];\n            \n                if (nchr == null) {\n                    nchr = f.segment;\n                }\n                min = Math.min(min, f.min);\n                max = Math.max(max, f.max);\n            }\n\n            if (!nchr) {\n                if (searchCount == 0 && !foundLatch)\n                    return statusCallback(\"no match for '\" + g + \"'\");\n            } else {\n                foundLatch = true;\n                thisB.highlightRegion(nchr, min, max);\n\n                var mid = ((max+min)/2)|0\n                var padding = Math.max(srPadding, (0.3 * (max - min + 1))|0);\n                thisB.setLocation(nchr, min - padding, max + padding, statusCallback);\n            }\n        }\n\n        var doTrixSearch = function(tier, trix) {\n            trix.lookup(g, function(result, status) {\n                if (result == null || result.length < 2) {\n                    return tier.featureSource.search(g, searchCallback);\n                } else {\n                    var hit = result[1].split(',')[0];\n                    return tier.featureSource.search(hit, searchCallback);\n                }\n            });\n        }\n\n        if (this.searchEndpoint) {\n            searchCount = 1;\n            return this.doDasSearch(thisB.searchEndpoint, g, searchCallback);\n        }\n\n\n        const searchSources = [\n            ...(this.searchOnlySourceHolders || []),\n            ...this.tiers\n        ];\n\n        for (var ti = 0; ti < searchSources.length; ++ti) {\n            (function(tier) {\n                if (thisB.sourceAdapterIsCapable(tier.featureSource, 'search')) {\n                    if (tier.dasSource.trixURI) {\n                        ++searchCount;\n                        if (tier.trix) {\n                            doTrixSearch(tier, tier.trix);\n                        } else {\n                            var ix = new URLFetchable(\n                                tier.dasSource.trixURI,\n                                {credentials: tier.dasSource.credentials,\n                                 resolver: tier.dasSource.resolver}\n                            );\n\n                            var ixx = new URLFetchable(\n                                tier.dasSource.trixxURI || (tier.dasSource.trixURI + 'x'),\n                                {credentials: tier.dasSource.credentials,\n                                 resolver: tier.dasSource.resolver}\n                            );\n\n                            connectTrix(ix, ixx, function(trix) {\n                                tier.trix = trix;\n                                doTrixSearch(tier, trix);\n                            });\n                        }\n                    } else {\n                        ++searchCount;\n                        tier.featureSource.search(g, searchCallback);\n                    }\n                } else if (tier.dasSource.provides_search) {\n                    ++searchCount;\n                    thisB.doDasSearch(tier.dasSource, g, searchCallback);\n                }\n            })(searchSources[ti]);\n        }\n    }\n}\n\nBrowser.prototype.doDasSearch = function(source, g, searchCallback) {\n    var thisB = this;\n    source.features(null, {group: g, type: 'transcript'}, function(found) {\n        if (!found) found = [];\n        var min = 500000000, max = -100000000;\n        var nchr = null;\n\n        var found2 = [];\n        for (var fi = 0; fi < found.length; ++fi) {\n            var f = found[fi];\n            \n            if (f.label.toLowerCase() != g.toLowerCase()) {\n                // ...because Dazzle can return spurious overlapping features.\n                continue;\n            }\n            found2.push(f);\n        }\n\n        return searchCallback(found2);\n    }, false);\n}\n","/* -*- mode: javascript; c-basic-offset: 4; indent-tabs-mode: nil -*- */\n\n// \n// Dalliance Genome Explorer\n// (c) Thomas Down 2006-2012\n//\n// sequence-draw.js: renderers for sequence-related data\n//\n\n\"use strict\";\n\nif (typeof(require) !== 'undefined') {\n    var utils = require('./utils');\n    var formatLongInt = utils.formatLongInt;\n    var makeElementNS = utils.makeElementNS;\n\n    var svgu = require('./svg-utils');\n    var NS_SVG = svgu.NS_SVG;\n    var NS_XLINK = svgu.NS_XLINK;\n    var SVGPath = svgu.SVGPath;\n\n    var nf = require('./numformats');\n    var formatLongInt = nf.formatLongInt;\n}\n\nvar MIN_TILE = 100;\nvar rulerTileColors = ['black', 'white'];\n\nvar steps = [1,2,5];\n\n\nvar NS_SVG = 'http://www.w3.org/2000/svg';\n\n\nfunction tileSizeForScale(scale, min)\n{\n    if (!min) {\n        min = MIN_TILE;\n    }\n\n    function ts(p) {\n        return steps[p % steps.length] * Math.pow(10, (p / steps.length)|0);\n    }\n    var pow = steps.length;\n    while (scale * ts(pow) < min) {\n        ++pow;\n    }\n    return ts(pow);\n}\n\nfunction drawSeqTier(tier, seq) {\n    var gc = tier.viewport.getContext('2d');\n    var retina = tier.browser.retina && window.devicePixelRatio > 1;\n    var desiredWidth = tier.browser.featurePanelWidth + 2000;\n    if (retina) {\n        desiredWidth *= 2;\n    }\n    var fpw = tier.viewport.width|0; // this.browser.featurePanelWidth;\n    if (fpw < desiredWidth - 50) {\n        tier.viewport.width = fpw = desiredWidth;\n    }\n\n    var height = 50;\n    if (seq && seq.seq) {\n        height += 25;\n    }\n\n    var canvasHeight = height;\n    if (retina) \n        canvasHeight *= 2;\n\n    tier.viewport.height = canvasHeight;\n    tier.viewport.style.height = '' + height + 'px';\n    tier.viewport.style.width = retina ? ('' + (fpw/2) + 'px') : ('' + fpw + 'px');\n    tier.layoutHeight = height;\n    tier.updateHeight();\n\n    \n    if (tier.background) {\n        gc.fillStyle = tier.background;\n        gc.fillRect(0, 0, fpw, tier.viewport.height);\n    }\n    if (retina) {\n        gc.scale(2, 2);\n    }\n\n    gc.translate(1000,0);\n    drawSeqTierGC(tier, seq, gc);\n    tier.norigin = tier.browser.viewStart;\n    tier.viewportHolder.style.left = '-1000px';\n}\n\nfunction drawSeqTierGC(tier, seq, gc)\n{\n    var scale = tier.browser.scale, knownStart = tier.browser.viewStart - (1000/scale)|0, knownEnd = tier.browser.viewEnd + (2000/scale), currentSeqMax = tier.browser.currentSeqMax;\n\n    var seqTierMax = knownEnd;\n    if (currentSeqMax > 0 && currentSeqMax < knownEnd) {\n        seqTierMax = currentSeqMax;\n    }\n    var tile = tileSizeForScale(scale);\n    var pos = Math.max(0, ((knownStart / tile)|0) * tile);\n    \n    var origin = tier.browser.viewStart;\n\n    while (pos <= seqTierMax) {\n\t\tgc.fillStyle = ((pos / tile) % 2 == 0) ? 'white' : 'black';\n\t\tgc.strokeStyle = 'black';\n\t\tgc.fillRect((pos - origin) * scale,\n\t\t\t    8,\n\t\t\t    tile*scale,\n\t\t\t    3);\n\t\tgc.strokeRect((pos - origin) * scale,\n\t\t\t      8,\n\t\t\t      tile*scale,\n\t\t\t      3);\n\n\t\tgc.fillStyle = 'black';\n\t\tgc.fillText(formatLongInt(pos), ((pos - origin) * scale), 22);\n\t\t\n\n\t\tpos += tile;\n    }\n\n    if (seq && seq.seq) {\n\t\tfor (var p = knownStart; p <= knownEnd; ++p) {\n\t\t    if (p >= seq.start && p <= seq.end) {\n\t\t\t\tvar base = seq.seq.substr(p - seq.start, 1).toUpperCase();\n\t\t\t\tvar color = tier.browser.baseColors[base];\n\t\t\t\tif (!color) {\n\t\t            color = 'gray';\n\t\t\t\t}\n\n\t\t\t\tgc.fillStyle = color;\n\n\t\t\t\tif (scale >= 8) {\n                    var w = gc.measureText(base).width;\n                    // console.log(scale-w);\n\t\t\t\t    gc.fillText(base, (p - origin) * scale + ((scale-w)*0.5) , 52);\n\t\t\t\t} else {\n\t\t\t\t    gc.fillRect((p - origin) * scale, 42, scale, 12); \n\t\t\t\t}\n\t\t    }\n\t\t}\n    }\n}\n\nfunction svgSeqTier(tier, seq) {\n    var scale = tier.browser.scale, knownStart = tier.browser.viewStart - (1000/scale)|0, knownEnd = tier.browser.viewEnd + (2000/scale), currentSeqMax = tier.browser.currentSeqMax;\n\n    var fpw = tier.viewport.width|0; \n\n    var seqTierMax = knownEnd;\n    if (currentSeqMax > 0 && currentSeqMax < knownEnd) {\n        seqTierMax = currentSeqMax;\n    }\n    var tile = tileSizeForScale(scale);\n    var pos = Math.max(0, ((knownStart / tile)|0) * tile);\n    \n    var origin = tier.browser.viewStart;\n\n    var  g = makeElementNS(NS_SVG, 'g', [], {fontSize: '8pt'}); \n    while (pos <= seqTierMax) {\n    \tg.appendChild(\n    \t    makeElementNS(\n    \t\tNS_SVG, 'rect',\n    \t\tnull,\n    \t\t{x: (pos-origin)*scale,\n    \t\t y: 8,\n    \t\t width: tile*scale,\n    \t\t height: 3,\n    \t\t fill: ((pos / tile) % 2 == 0) ? 'white' : 'black',\n    \t\t stroke: 'black'}));\n\n    \tg.appendChild(\n    \t    makeElementNS(\n    \t\tNS_SVG, 'text',\n    \t\tformatLongInt(pos),\n    \t\t{x: (pos-origin)*scale,\n    \t\t y: 28,\n    \t\t fill: 'black', stroke: 'none'}));\n    \t\n    \tpos += tile;\n    }\n\n    if (seq && seq.seq) {\n    \tfor (var p = knownStart; p <= knownEnd; ++p) {\n    \t    if (p >= seq.start && p <= seq.end) {\n        \t\tvar base = seq.seq.substr(p - seq.start, 1).toUpperCase();\n        \t\tvar color = tier.browser.baseColors[base];\n        \t\tif (!color) {\n                    color = 'gray';\n        \t\t}\n\n        \t\tif (scale >= 8) {\n        \t\t    g.appendChild(\n        \t\t\tmakeElementNS(NS_SVG, 'text', base, {\n        \t\t\t    x: (0.5+p-origin)*scale,\n        \t\t\t    y: 52,\n                        textAnchor: 'middle',\n        \t\t\t    fill: color}));\n        \t\t} else {\n        \t\t    g.appendChild(\n        \t\t\tmakeElementNS(NS_SVG, 'rect', null, {\n        \t\t\t    x: (p - origin)*scale,\n        \t\t\t    y: 42,\n        \t\t\t    width: scale,\n        \t\t\t    height: 12,\n        \t            fill: color}));\n\n        \t\t}\n    \t    }\n    \t}\n    } \n\n    return g;\n}\n\nif (typeof(module) !== 'undefined') {\n    module.exports = {\n        drawSeqTier: drawSeqTier,\n        drawSeqTierGC: drawSeqTierGC,\n        svgSeqTier: svgSeqTier\n    };\n}\n","/* -*- mode: javascript; c-basic-offset: 4; indent-tabs-mode: nil -*- */\n\n// \n// Dalliance Genome Explorer\n// (c) Thomas Down 2006-2013\n//\n// session.js\n//\n\n\"use strict\";\n\nif (typeof(require) != 'undefined') {\n    var browser = require('./cbrowser');\n    var Browser = browser.Browser;\n\n    var sc = require('./sourcecompare');\n    var sourceDataURI = sc.sourceDataURI;\n    var sourcesAreEqual = sc.sourcesAreEqual;\n\n    var VERSION = require('./version');\n\n    var utils = require('./utils');\n    var miniJSONify = utils.miniJSONify;\n\n    var sha1 = require('./sha1');\n    var hex_sha1 = sha1.hex_sha1;\n}\n\nBrowser.prototype.nukeStatus = function() {\n    delete localStorage['dalliance.' + this.cookieKey + '.view-chr'];\n    delete localStorage['dalliance.' + this.cookieKey + '.view-start'];\n    delete localStorage['dalliance.' + this.cookieKey + '.view-end'];\n    delete localStorage['dalliance.' + this.cookieKey + '.current-seq-length'];\n    delete localStorage['dalliance.' + this.cookieKey + '.showing-alt-zoom'];\n    delete localStorage['dalliance.' + this.cookieKey + '.saved-zoom'];\n\n    delete localStorage['dalliance.' + this.cookieKey + '.sources'];\n    delete localStorage['dalliance.' + this.cookieKey + '.hubs'];\n    delete localStorage['dalliance.' + this.cookieKey + '.version'];\n\n    delete localStorage['dalliance.' + this.cookieKey + '.reverse-scrolling'];\n    delete localStorage['dalliance.' + this.cookieKey + '.reverse-key-scrolling'];\n    delete localStorage['dalliance.' + this.cookieKey + '.ruler-location'];\n}\n\nBrowser.prototype.storeStatus = function() {\n    this.storeViewStatus();\n    this.storeTierStatus();\n}\n\nBrowser.prototype.storeViewStatus = function() {\n    if (!this.cookieKey || this.noPersist || this.noPersistView) {\n        return;\n    }\n\n    localStorage['dalliance.' + this.cookieKey + '.view-chr'] = this.chr;\n    localStorage['dalliance.' + this.cookieKey + '.view-start'] = this.viewStart|0;\n    localStorage['dalliance.' + this.cookieKey + '.view-end'] = this.viewEnd|0\n    localStorage['dalliance.' + this.cookieKey + '.showing-alt-zoom'] = '' + this.isSnapZooming;\n    localStorage['dalliance.' + this.cookieKey + '.saved-zoom'] = this.savedZoom;\n    if (this.currentSeqMax) {\n\t   localStorage['dalliance.' + this.cookieKey + '.current-seq-length'] = this.currentSeqMax;\n    }\n}\n\n\nBrowser.prototype.storeTierStatus = function() {\n    if (!this.cookieKey || this.noPersist) {\n        return;\n    }\n\n    var currentSourceList = [];\n    for (var t = 0; t < this.tiers.length; ++t) {\n        var tt = this.tiers[t];\n        var ts = tt.dasSource;\n        if (!ts.noPersist) {\n            currentSourceList.push({source: tt.dasSource, config: tt.config || {}});\n        }\n    }\n    localStorage['dalliance.' + this.cookieKey + '.sources'] = JSON.stringify(currentSourceList);\n\n\n    var coveredHubURLs = {};\n    var currentHubList = [];\n    for (var hi = 0; hi < this.hubObjects.length; ++hi) {\n        var tdb = this.hubObjects[hi];\n        var hc = {url: tdb.hub.url, genome: tdb.genome};\n        if (tdb.credentials)\n            hc.credentials = tdb.credentials;\n        if (tdb.mapping)\n            hc.mapping = tdb.mapping;\n        coveredHubURLs[hc.url] = true;\n        currentHubList.push(hc);\n    }\n\n    // Needed to handle hubs that failed to connect, or hubs that haven't\n    // connected yet when we're called soon after startup.\n    for (var hi = 0; hi < this.hubs.length; ++hi) {\n        var hc = this.hubs[hi];\n        if (typeof hc === 'string')\n            hc = {url: hc};\n        if (!coveredHubURLs[hc.url])\n            currentHubList.push(hc);\n    }\n\n    localStorage['dalliance.' + this.cookieKey + '.hubs'] = JSON.stringify(currentHubList);\n\n    localStorage['dalliance.' + this.cookieKey + '.reverse-scrolling'] = this.reverseScrolling;\n    localStorage['dalliance.' + this.cookieKey + '.reverse-key-scrolling'] = this.reverseKeyScrolling;\n    localStorage['dalliance.' + this.cookieKey + '.single-base-highlight'] = this.singleBaseHighlight;\n    localStorage['dalliance.' + this.cookieKey + '.ruler-location'] = this.rulerLocation;\n\n    localStorage['dalliance.' + this.cookieKey + '.export-ruler'] = this.exportRuler;\n    localStorage['dalliance.' + this.cookieKey + '.export-highlights'] = this.exportHighlights;\n    \n    localStorage['dalliance.' + this.cookieKey + '.version'] = VERSION.CONFIG;\n}\n\nBrowser.prototype.restoreStatus = function() {\n    if (this.noPersist)\n        return;\n    \n    var storedConfigVersion = localStorage['dalliance.' + this.cookieKey + '.version'];\n    if (storedConfigVersion) {\n        storedConfigVersion = storedConfigVersion|0;\n    } else {\n        storedConfigVersion = -100;\n    }\n    if (VERSION.CONFIG != storedConfigVersion) {\n        return;\n    }\n\n    var storedConfigHash = localStorage['dalliance.' + this.cookieKey + '.configHash'] || '';\n    var pageConfigHash = hex_sha1(miniJSONify({\n        sources: this.sources,\n        hubs: this.hubs,\n        rulerLocation: this.rulerLocation\n    }));\n    if (pageConfigHash != storedConfigHash) {\n        localStorage['dalliance.' + this.cookieKey + '.configHash'] = pageConfigHash;\n        return;\n    }\n\n    var defaultSourcesByURI = {};\n    for (var si = 0; si < this.sources.length; ++si) {\n        var source = this.sources[si];\n        if (!source)\n            continue;\n\n        var uri = sourceDataURI(source);\n        var ul = defaultSourcesByURI[uri];\n        if (!ul)\n            defaultSourcesByURI[uri] = ul = [];\n        ul.push(source);\n        \n    }\n\n    if (!this.noPersistView) {\n        var qChr = localStorage['dalliance.' + this.cookieKey + '.view-chr'];\n        var qMin = localStorage['dalliance.' + this.cookieKey + '.view-start']|0;\n        var qMax = localStorage['dalliance.' + this.cookieKey + '.view-end']|0;\n        if (qChr && qMin && qMax) {\n        \tthis.chr = qChr;\n        \tthis.viewStart = qMin;\n        \tthis.viewEnd = qMax;\n        \t\n        \tvar csm = localStorage['dalliance.' + this.cookieKey + '.current-seq-length'];\n        \tif (csm) {\n        \t    this.currentSeqMax = csm|0;\n        \t}\n\n            this.isSnapZooming = (localStorage['dalliance.' + this.cookieKey + '.showing-alt-zoom']) == 'true';\n\n            var sz = parseFloat(localStorage['dalliance.' + this.cookieKey + '.saved-zoom']);\n            if (typeof sz === 'number' && !isNaN(sz)) {\n                this.savedZoom = sz;\n            }\n        }\n    }\n\n    var rs = localStorage['dalliance.' + this.cookieKey + '.reverse-scrolling'];\n    this.reverseScrolling = (rs && rs == 'true');\n    var rks = localStorage['dalliance.' + this.cookieKey + '.reverse-key-scrolling'];\n    this.reverseKeyScrolling = (rks && rks == 'true');\n    var sbh = localStorage['dalliance.' + this.cookieKey + '.single-base-highlight'];\n    this.singleBaseHighlight = (sbh && sbh == 'true');\n \n    var rl = localStorage['dalliance.' + this.cookieKey + '.ruler-location'];\n    if (rl)\n        this.rulerLocation = rl;\n\n    var x = localStorage['dalliance.' + this.cookieKey + '.export-ruler'];\n    if (x)\n        this.exportRuler = (x === 'true');\n    var x = localStorage['dalliance.' + this.cookieKey + '.export-highlights'];\n    if (x)\n        this.exportHighlights = (x === 'true');\n\n    var sourceStr = localStorage['dalliance.' + this.cookieKey + '.sources'];\n    if (sourceStr) {\n\t    var storedSources = JSON.parse(sourceStr);\n        this.sources = [];\n        this.restoredConfigs = [];\n        for (var si = 0; si < storedSources.length; ++si) {\n            var source = this.sources[si] = storedSources[si].source;\n            this.restoredConfigs[si] = storedSources[si].config;\n            var uri = sourceDataURI(source);\n            var ul = defaultSourcesByURI[uri] || [];\n            for (var osi = 0; osi < ul.length; ++osi) {    \n                var oldSource = ul[osi];\n                if (sourcesAreEqual(source, oldSource)) {\n                    for (var k in oldSource) {\n                        if (oldSource.hasOwnProperty(k) && \n                            (typeof(oldSource[k]) === 'function' || oldSource[k] instanceof Blob))\n                        {\n                            source[k] = oldSource[k];\n                        }\n                    }\n                }\n            }\n        }\n    }\n\n    var hubStr = localStorage['dalliance.' + this.cookieKey + '.hubs'];\n    if (hubStr) {\n        this.hubs = JSON.parse(hubStr);\n    }\n\n    return true;\n}\n\nBrowser.prototype.reset = function() {\n    for (var i = this.tiers.length - 1; i >= 0; --i) {\n       this.removeTier({index: i}, true);\n    }\n    for (var i = 0; i < this.defaultSources.length; ++i) {\n        var s = this.defaultSources[i];\n        if (!s.disabled) \n            this.addTier(this.defaultSources[i]);\n    }\n\n    this.highlights.splice(0, this.highlights.length);\n\n    this.setLocation(this.defaultChr, this.defaultStart, this.defaultEnd);\n}\n","/*\r\n * A JavaScript implementation of the Secure Hash Algorithm, SHA-1, as defined\r\n * in FIPS 180-1\r\n * Version 2.2 Copyright Paul Johnston 2000 - 2009.\r\n * Other contributors: Greg Holt, Andrew Kepert, Ydnar, Lostinet\r\n * Distributed under the BSD License\r\n * See http://pajhome.org.uk/crypt/md5 for details.\r\n */\r\n\r\n \"use strict\";\r\n\r\n/*\r\n * Configurable variables. You may need to tweak these to be compatible with\r\n * the server-side, but the defaults work in most cases.\r\n */\r\nvar hexcase = 0;  /* hex output format. 0 - lowercase; 1 - uppercase        */\r\nvar b64pad  = \"\"; /* base-64 pad character. \"=\" for strict RFC compliance   */\r\n\r\n/*\r\n * These are the functions you'll usually want to call\r\n * They take string arguments and return either hex or base-64 encoded strings\r\n */\r\nfunction hex_sha1(s)    { return rstr2hex(rstr_sha1(str2rstr_utf8(s))); }\r\nfunction b64_sha1(s)    { return rstr2b64(rstr_sha1(str2rstr_utf8(s))); }\r\nfunction any_sha1(s, e) { return rstr2any(rstr_sha1(str2rstr_utf8(s)), e); }\r\nfunction hex_hmac_sha1(k, d)\r\n  { return rstr2hex(rstr_hmac_sha1(str2rstr_utf8(k), str2rstr_utf8(d))); }\r\nfunction b64_hmac_sha1(k, d)\r\n  { return rstr2b64(rstr_hmac_sha1(str2rstr_utf8(k), str2rstr_utf8(d))); }\r\nfunction any_hmac_sha1(k, d, e)\r\n  { return rstr2any(rstr_hmac_sha1(str2rstr_utf8(k), str2rstr_utf8(d)), e); }\r\n\r\n/*\r\n * Perform a simple self-test to see if the VM is working\r\n */\r\nfunction sha1_vm_test()\r\n{\r\n  return hex_sha1(\"abc\").toLowerCase() == \"a9993e364706816aba3e25717850c26c9cd0d89d\";\r\n}\r\n\r\n/*\r\n * Calculate the SHA1 of a raw string\r\n */\r\nfunction rstr_sha1(s)\r\n{\r\n  return binb2rstr(binb_sha1(rstr2binb(s), s.length * 8));\r\n}\r\n\r\n/*\r\n * Calculate the HMAC-SHA1 of a key and some data (raw strings)\r\n */\r\nfunction rstr_hmac_sha1(key, data)\r\n{\r\n  var bkey = rstr2binb(key);\r\n  if(bkey.length > 16) bkey = binb_sha1(bkey, key.length * 8);\r\n\r\n  var ipad = Array(16), opad = Array(16);\r\n  for(var i = 0; i < 16; i++)\r\n  {\r\n    ipad[i] = bkey[i] ^ 0x36363636;\r\n    opad[i] = bkey[i] ^ 0x5C5C5C5C;\r\n  }\r\n\r\n  var hash = binb_sha1(ipad.concat(rstr2binb(data)), 512 + data.length * 8);\r\n  return binb2rstr(binb_sha1(opad.concat(hash), 512 + 160));\r\n}\r\n\r\n/*\r\n * Convert a raw string to a hex string\r\n */\r\nfunction rstr2hex(input)\r\n{\r\n  // try { hexcase } catch(e) { hexcase=0; }\r\n  var hex_tab = hexcase ? \"0123456789ABCDEF\" : \"0123456789abcdef\";\r\n  var output = \"\";\r\n  var x;\r\n  for(var i = 0; i < input.length; i++)\r\n  {\r\n    x = input.charCodeAt(i);\r\n    output += hex_tab.charAt((x >>> 4) & 0x0F)\r\n           +  hex_tab.charAt( x        & 0x0F);\r\n  }\r\n  return output;\r\n}\r\n\r\n/*\r\n * Convert a raw string to a base-64 string\r\n */\r\nfunction rstr2b64(input)\r\n{\r\n  // try { b64pad } catch(e) { b64pad=''; }\r\n  var tab = \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\";\r\n  var output = \"\";\r\n  var len = input.length;\r\n  for(var i = 0; i < len; i += 3)\r\n  {\r\n    var triplet = (input.charCodeAt(i) << 16)\r\n                | (i + 1 < len ? input.charCodeAt(i+1) << 8 : 0)\r\n                | (i + 2 < len ? input.charCodeAt(i+2)      : 0);\r\n    for(var j = 0; j < 4; j++)\r\n    {\r\n      if(i * 8 + j * 6 > input.length * 8) output += b64pad;\r\n      else output += tab.charAt((triplet >>> 6*(3-j)) & 0x3F);\r\n    }\r\n  }\r\n  return output;\r\n}\r\n\r\n/*\r\n * Convert a raw string to an arbitrary string encoding\r\n */\r\nfunction rstr2any(input, encoding)\r\n{\r\n  var divisor = encoding.length;\r\n  var remainders = Array();\r\n  var i, q, x, quotient;\r\n\r\n  /* Convert to an array of 16-bit big-endian values, forming the dividend */\r\n  var dividend = Array(Math.ceil(input.length / 2));\r\n  for(i = 0; i < dividend.length; i++)\r\n  {\r\n    dividend[i] = (input.charCodeAt(i * 2) << 8) | input.charCodeAt(i * 2 + 1);\r\n  }\r\n\r\n  /*\r\n   * Repeatedly perform a long division. The binary array forms the dividend,\r\n   * the length of the encoding is the divisor. Once computed, the quotient\r\n   * forms the dividend for the next step. We stop when the dividend is zero.\r\n   * All remainders are stored for later use.\r\n   */\r\n  while(dividend.length > 0)\r\n  {\r\n    quotient = Array();\r\n    x = 0;\r\n    for(i = 0; i < dividend.length; i++)\r\n    {\r\n      x = (x << 16) + dividend[i];\r\n      q = Math.floor(x / divisor);\r\n      x -= q * divisor;\r\n      if(quotient.length > 0 || q > 0)\r\n        quotient[quotient.length] = q;\r\n    }\r\n    remainders[remainders.length] = x;\r\n    dividend = quotient;\r\n  }\r\n\r\n  /* Convert the remainders to the output string */\r\n  var output = \"\";\r\n  for(i = remainders.length - 1; i >= 0; i--)\r\n    output += encoding.charAt(remainders[i]);\r\n\r\n  /* Append leading zero equivalents */\r\n  var full_length = Math.ceil(input.length * 8 /\r\n                                    (Math.log(encoding.length) / Math.log(2)))\r\n  for(i = output.length; i < full_length; i++)\r\n    output = encoding[0] + output;\r\n\r\n  return output;\r\n}\r\n\r\n/*\r\n * Encode a string as utf-8.\r\n * For efficiency, this assumes the input is valid utf-16.\r\n */\r\nfunction str2rstr_utf8(input)\r\n{\r\n  var output = \"\";\r\n  var i = -1;\r\n  var x, y;\r\n\r\n  while(++i < input.length)\r\n  {\r\n    /* Decode utf-16 surrogate pairs */\r\n    x = input.charCodeAt(i);\r\n    y = i + 1 < input.length ? input.charCodeAt(i + 1) : 0;\r\n    if(0xD800 <= x && x <= 0xDBFF && 0xDC00 <= y && y <= 0xDFFF)\r\n    {\r\n      x = 0x10000 + ((x & 0x03FF) << 10) + (y & 0x03FF);\r\n      i++;\r\n    }\r\n\r\n    /* Encode output as utf-8 */\r\n    if(x <= 0x7F)\r\n      output += String.fromCharCode(x);\r\n    else if(x <= 0x7FF)\r\n      output += String.fromCharCode(0xC0 | ((x >>> 6 ) & 0x1F),\r\n                                    0x80 | ( x         & 0x3F));\r\n    else if(x <= 0xFFFF)\r\n      output += String.fromCharCode(0xE0 | ((x >>> 12) & 0x0F),\r\n                                    0x80 | ((x >>> 6 ) & 0x3F),\r\n                                    0x80 | ( x         & 0x3F));\r\n    else if(x <= 0x1FFFFF)\r\n      output += String.fromCharCode(0xF0 | ((x >>> 18) & 0x07),\r\n                                    0x80 | ((x >>> 12) & 0x3F),\r\n                                    0x80 | ((x >>> 6 ) & 0x3F),\r\n                                    0x80 | ( x         & 0x3F));\r\n  }\r\n  return output;\r\n}\r\n\r\n/*\r\n * Encode a string as utf-16\r\n */\r\nfunction str2rstr_utf16le(input)\r\n{\r\n  var output = \"\";\r\n  for(var i = 0; i < input.length; i++)\r\n    output += String.fromCharCode( input.charCodeAt(i)        & 0xFF,\r\n                                  (input.charCodeAt(i) >>> 8) & 0xFF);\r\n  return output;\r\n}\r\n\r\nfunction str2rstr_utf16be(input)\r\n{\r\n  var output = \"\";\r\n  for(var i = 0; i < input.length; i++)\r\n    output += String.fromCharCode((input.charCodeAt(i) >>> 8) & 0xFF,\r\n                                   input.charCodeAt(i)        & 0xFF);\r\n  return output;\r\n}\r\n\r\n/*\r\n * Convert a raw string to an array of big-endian words\r\n * Characters >255 have their high-byte silently ignored.\r\n */\r\nfunction rstr2binb(input)\r\n{\r\n  var output = Array(input.length >> 2);\r\n  for(var i = 0; i < output.length; i++)\r\n    output[i] = 0;\r\n  for(var i = 0; i < input.length * 8; i += 8)\r\n    output[i>>5] |= (input.charCodeAt(i / 8) & 0xFF) << (24 - i % 32);\r\n  return output;\r\n}\r\n\r\n/*\r\n * Convert an array of big-endian words to a string\r\n */\r\nfunction binb2rstr(input)\r\n{\r\n  var output = \"\";\r\n  for(var i = 0; i < input.length * 32; i += 8)\r\n    output += String.fromCharCode((input[i>>5] >>> (24 - i % 32)) & 0xFF);\r\n  return output;\r\n}\r\n\r\n/*\r\n * Calculate the SHA-1 of an array of big-endian words, and a bit length\r\n */\r\nfunction binb_sha1(x, len)\r\n{\r\n  /* append padding */\r\n  x[len >> 5] |= 0x80 << (24 - len % 32);\r\n  x[((len + 64 >> 9) << 4) + 15] = len;\r\n\r\n  var w = Array(80);\r\n  var a =  1732584193;\r\n  var b = -271733879;\r\n  var c = -1732584194;\r\n  var d =  271733878;\r\n  var e = -1009589776;\r\n\r\n  for(var i = 0; i < x.length; i += 16)\r\n  {\r\n    var olda = a;\r\n    var oldb = b;\r\n    var oldc = c;\r\n    var oldd = d;\r\n    var olde = e;\r\n\r\n    for(var j = 0; j < 80; j++)\r\n    {\r\n      if(j < 16) w[j] = x[i + j];\r\n      else w[j] = bit_rol(w[j-3] ^ w[j-8] ^ w[j-14] ^ w[j-16], 1);\r\n      var t = safe_add(safe_add(bit_rol(a, 5), sha1_ft(j, b, c, d)),\r\n                       safe_add(safe_add(e, w[j]), sha1_kt(j)));\r\n      e = d;\r\n      d = c;\r\n      c = bit_rol(b, 30);\r\n      b = a;\r\n      a = t;\r\n    }\r\n\r\n    a = safe_add(a, olda);\r\n    b = safe_add(b, oldb);\r\n    c = safe_add(c, oldc);\r\n    d = safe_add(d, oldd);\r\n    e = safe_add(e, olde);\r\n  }\r\n  return Array(a, b, c, d, e);\r\n\r\n}\r\n\r\n/*\r\n * Perform the appropriate triplet combination function for the current\r\n * iteration\r\n */\r\nfunction sha1_ft(t, b, c, d)\r\n{\r\n  if(t < 20) return (b & c) | ((~b) & d);\r\n  if(t < 40) return b ^ c ^ d;\r\n  if(t < 60) return (b & c) | (b & d) | (c & d);\r\n  return b ^ c ^ d;\r\n}\r\n\r\n/*\r\n * Determine the appropriate additive constant for the current iteration\r\n */\r\nfunction sha1_kt(t)\r\n{\r\n  return (t < 20) ?  1518500249 : (t < 40) ?  1859775393 :\r\n         (t < 60) ? -1894007588 : -899497514;\r\n}\r\n\r\n/*\r\n * Add integers, wrapping at 2^32. This uses 16-bit operations internally\r\n * to work around bugs in some JS interpreters.\r\n */\r\nfunction safe_add(x, y)\r\n{\r\n  var lsw = (x & 0xFFFF) + (y & 0xFFFF);\r\n  var msw = (x >> 16) + (y >> 16) + (lsw >> 16);\r\n  return (msw << 16) | (lsw & 0xFFFF);\r\n}\r\n\r\n/*\r\n * Bitwise rotate a 32-bit number to the left.\r\n */\r\nfunction bit_rol(num, cnt)\r\n{\r\n  return (num << cnt) | (num >>> (32 - cnt));\r\n}\r\n\r\nif (typeof(module) !== 'undefined') {\r\n  module.exports = {\r\n    b64_sha1: b64_sha1,\r\n    hex_sha1: hex_sha1\r\n  }\r\n}\r\n","//* -*- mode: javascript; c-basic-offset: 4; indent-tabs-mode: nil -*- */\n\n// \n// Dalliance Genome Explorer\n// (c) Thomas Down 2006-2013\n//\n// sourceadapters.js\n//\n\n\"use strict\";\n\nif (typeof(require) !== 'undefined') {\n    var browser = require('./cbrowser');\n    var Browser = browser.Browser;\n\n    var tier = require('./tier');\n    var DasTier = tier.DasTier;\n\n    var utils = require('./utils');\n    var Awaited = utils.Awaited;\n    var arrayIndexOf = utils.arrayIndexOf;\n    var shallowCopy = utils.shallowCopy;\n    var resolveUrlToPage = utils.resolveUrlToPage;\n\n    var das = require('./das');\n    var DASStylesheet = das.DASStylesheet;\n    var DASStyle = das.DASStyle;\n    var DASSource = das.DASSource;\n    var DASSegment = das.DASSegment;\n    var DASFeature = das.DASFeature;\n    var DASSequence = das.DASSequence;\n    var DASLink = das.DASLink;\n\n    var bin = require('./bin');\n    var URLFetchable = bin.URLFetchable;\n    var BlobFetchable = bin.BlobFetchable;\n\n    var twoBit = require('./twoBit');\n    var makeTwoBit = twoBit.makeTwoBit;\n\n    var bbi = require('./bigwig');\n    var makeBwg = bbi.makeBwg;\n\n    var bam = require('./bam');\n    var makeBam = bam.makeBam;\n    var BamFlags = bam.BamFlags;\n\n    var cram = require('./cram');\n    var makeCram = cram.makeCram;\n    var CramFlags = cram.CramFlags;\n\n    var spans = require('./spans');\n    var Range = spans.Range;\n    var union = spans.union;\n\n    var parseCigar = require('./cigar').parseCigar;\n\n    var OverlayFeatureSource = require('./overlay').OverlayFeatureSource;\n\n    var JBrowseStore = require('./jbjson').JBrowseStore;\n\n    var Chainset = require('./chainset').Chainset;\n\n    var style = require('./style');\n    var StyleFilterSet = style.StyleFilterSet;\n\n    var EncodeFetchable = require('./encode').EncodeFetchable;\n}\n\nvar __dalliance_sourceAdapterFactories = {};\n\nfunction dalliance_registerSourceAdapterFactory(type, factory) {\n    __dalliance_sourceAdapterFactories[type] = factory;\n}\n\n\nvar __dalliance_parserFactories = {};\n\nfunction dalliance_registerParserFactory(type, factory) {\n    __dalliance_parserFactories[type] = factory;\n}\n\nfunction dalliance_makeParser(type) {\n    if (__dalliance_parserFactories[type]) {\n        return __dalliance_parserFactories[type](type);\n    }\n}\n\n\nDasTier.prototype.initSources = function() {\n    var thisTier = this;\n\n    var sources = this.browser.createSources(this.dasSource);\n    this.featureSource = sources.features || new DummyFeatureSource();\n    this.sequenceSource = sources.sequence;\n\n    if (this.featureSource && this.featureSource.addChangeListener) {\n        this.featureSource.addChangeListener(function() {\n            thisTier.browser.refreshTier(thisTier);\n        });\n    }\n};\n\nBrowser.prototype.createSources = function(config) {\n    var sources = this.sourceCache.get(config);\n    if (sources)\n        return sources;\n\n    var fs, ss;\n\n    if (config.tier_type == 'sequence' || config.twoBitURI || config.twoBitBlob) {\n        if (config.twoBitURI || config.twoBitBlob) {\n            ss = new TwoBitSequenceSource(config);\n        } else if (config.ensemblURI) {\n            if (config.aminoAcids) {\n                ss = new EnsemblProteinSequenceSource(config);\n            } else {\n                ss = new EnsemblSequenceSource(config);\n            }\n        } else {\n            ss = new DASSequenceSource(config);\n        }\n    } else if (config.tier_type && __dalliance_sourceAdapterFactories[config.tier_type]) {\n        var saf = __dalliance_sourceAdapterFactories[config.tier_type];\n        var ns = saf(config);\n        fs = ns.features;\n        ss = ns.sequence;\n    } else if (config.bwgURI || config.bwgBlob) {\n        var worker = this.getWorker();\n        if (worker)\n            fs = new RemoteBWGFeatureSource(config, worker, this);\n        else\n            fs = new BWGFeatureSource(config);\n    } else if (config.bamURI || config.bamBlob) {\n        var worker = this.getWorker();\n        if (worker)\n            fs = new RemoteBAMFeatureSource(config, worker, this);\n        else\n            fs = new BAMFeatureSource(config);\n    } else if (config.cramURI || config.cramBlob) {\n        var worker = this.getWorker();\n        if (worker)\n            fs = new RemoteCRAMFeatureSource(config, worker, this);\n        else\n            fs = new CRAMFeatureSource(config);\n    } else if (config.jbURI) {\n        fs = new JBrowseFeatureSource(config);\n    } else if (config.uri || config.features_uri) {\n        fs = new DASFeatureSource(config);\n    }\n\n    if (config.overlay) {\n        var sources = [];\n        if (fs)\n            sources.push(new CachingFeatureSource(fs));\n\n        for (var oi = 0; oi < config.overlay.length; ++oi) {\n            var cs = this.createSources(config.overlay[oi]);\n            if (cs && cs.features)\n                sources.push(cs.features);\n        }\n        fs = new OverlayFeatureSource(sources, config);\n    }\n\n    if (config.sequenceAliases) {\n        fs = new MappedFeatureSource(fs, new Chainset({type: 'alias', sequenceAliases: config.sequenceAliases}));\n    }\n\n    if (config.mapping) {\n        fs = new MappedFeatureSource(fs, this.chains[config.mapping]);\n    }\n\n    if (config.name && fs && !fs.name) {\n        fs.name = config.name;\n    }\n\n    if (typeof fs !== 'undefined' && fs !== null) {\n        fs = new CachingFeatureSource(fs);\n    }\n\n    if ( (typeof fs !== 'undefined' && fs !==  null) || (typeof ss !== 'undefined' && ss != null) ) {\n        sources = {\n            features: fs,\n            sequence: ss\n        };\n        this.sourceCache.put(config, sources);\n    }\n\n    return sources;\n};\n\nDasTier.prototype.fetchStylesheet = function(cb) {\n    var ssSource;\n    // Somewhat ugly workaround for the special case of DAS sources...\n    if (this.dasSource.stylesheet_uri || (\n        !this.dasSource.tier_type &&\n        !this.dasSource.bwgURI &&\n        !this.dasSource.bwgBlob &&\n        !this.dasSource.bamURI &&\n        !this.dasSource.bamBlob &&\n        !this.dasSource.twoBitURI &&\n        !this.dasSource.twoBitBlob &&\n        !this.dasSource.jbURI &&\n        !this.dasSource.overlay))\n    {\n        ssSource = new DASFeatureSource(this.dasSource);\n    } else {\n        ssSource = this.getSource();\n    }\n    ssSource.getStyleSheet(cb);\n};\n\nvar __cfs_id_seed = 0;\n\nfunction CachingFeatureSource(source) {\n    var thisB = this;\n\n    this.source = source;\n    this.cfsid = 'cfs' + (++__cfs_id_seed);\n    if (source.name) {\n        this.name = source.name;\n    }\n    if (source.addChangeListener) {\n        source.addChangeListener(function() {\n            thisB.cfsid = 'cfs' + (++__cfs_id_seed);\n        });\n    }\n}\n\nCachingFeatureSource.prototype.addReadinessListener = function(listener) {\n    if (this.source.addReadinessListener)\n        return this.source.addReadinessListener(listener);\n    else\n        listener(null);\n};\n\nCachingFeatureSource.prototype.removeReadinessListener = function(listener) {\n    if (this.source.removeReadinessListener)\n        return this.source.removeReadinessListener(listener);\n};\n\nCachingFeatureSource.prototype.search = function(query, callback) {\n    if (this.source.search)\n        return this.source.search(query, callback);\n};\n\nCachingFeatureSource.prototype.getDefaultFIPs = function(callback) {\n    if (this.source.getDefaultFIPs)\n        return this.source.getDefaultFIPs(callback); \n};\n\nCachingFeatureSource.prototype.getStyleSheet = function(callback) {\n    this.source.getStyleSheet(callback);\n};\n\nCachingFeatureSource.prototype.getScales = function() {\n    return this.source.getScales();\n};\n\nCachingFeatureSource.prototype.addActivityListener = function(l) {\n    if (this.source.addActivityListener) {\n        this.source.addActivityListener(l);\n    }\n};\n\nCachingFeatureSource.prototype.removeActivityListener = function(l) {\n    if (this.source.removeActivityListener) {\n        this.source.removeActivityListener(l);\n    }\n};\n\nCachingFeatureSource.prototype.addChangeListener = function(l) {\n    if (this.source.addChangeListener)\n        this.source.addChangeListener(l);\n};\n\nCachingFeatureSource.prototype.removeChangeListener = function(l) {\n    if (this.source.removeChangeListener)\n        this.source.removeChangeListener(l);\n};\n\nCachingFeatureSource.prototype.findNextFeature = function(chr, pos, dir, callback) {\n    this.source.findNextFeature(chr, pos, dir, callback);\n};\n\nCachingFeatureSource.prototype.quantFindNextFeature = function(chr, pos, dir, threshold, callback) {\n    this.source.quantFindNextFeature(chr, pos, dir, threshold, callback);\n};\n\nCachingFeatureSource.prototype.capabilities = function() {\n    if (this.source.capabilities) {\n        return this.source.capabilities();\n    } else {\n        return {};\n    }\n};\n\nCachingFeatureSource.prototype.fetch = function(chr, min, max, scale, types, pool, callback, styleFilters) {\n    if (!pool) {\n        throw Error('Fetch pool is null');\n    }\n\n    var self = this;\n    var cacheKey = this.cfsid;\n\n    var awaitedFeatures = pool.awaitedFeatures[cacheKey];\n    if (awaitedFeatures && awaitedFeatures.started) {\n        if (awaitedFeatures.styleFilters.doesNotContain(styleFilters)) {\n            // console.log('Fetch already started with wrong parameters, skipping cache.');\n            self.source.fetch(chr, min, max, scale, types, pool, callback, styleFilters);\n            return;\n        }\n    } else if (awaitedFeatures) {\n        awaitedFeatures.styleFilters.addAll(styleFilters);\n    } else {\n        awaitedFeatures = new Awaited();\n        awaitedFeatures.styleFilters = styleFilters;\n        pool.awaitedFeatures[cacheKey] = awaitedFeatures;\n\n        pool.requestsIssued.then(function() {\n            awaitedFeatures.started = true;\n            self.source.fetch(\n                chr, \n                min, \n                max, \n                scale, \n                awaitedFeatures.styleFilters.typeList(), \n                pool, \n                function(status, features, scale, coverage) {\n                    if (!awaitedFeatures.res)\n                        awaitedFeatures.provide({status: status, features: features, scale: scale, coverage: coverage});\n                }, \n                awaitedFeatures.styleFilters);\n        }).catch(function(err) {\n            console.log(err);\n        });\n    } \n\n    awaitedFeatures.await(function(af) {\n        callback(af.status, af.features, af.scale, af.coverage);\n    });\n};\n    \nfunction FeatureSourceBase() {\n    this.busy = 0;\n    this.activityListeners = [];\n    this.readinessListeners = [];\n    this.readiness = null;\n}\n\nFeatureSourceBase.prototype.addReadinessListener = function(listener) {\n    this.readinessListeners.push(listener);\n    listener(this.readiness);\n};\n\nFeatureSourceBase.prototype.removeReadinessListener = function(listener) {\n    var idx = arrayIndexOf(this.readinessListeners, listener);\n    if (idx >= 0) {\n        this.readinessListeners.splice(idx, 1);\n    }\n};\n\nFeatureSourceBase.prototype.notifyReadiness = function() {\n    for (var li = 0; li < this.readinessListeners.length; ++li) {\n        try {\n            this.readinessListeners[li](this.readiness);\n        } catch (e) {\n            console.log(e);\n        }\n    }\n};\n\nFeatureSourceBase.prototype.addActivityListener = function(listener) {\n    this.activityListeners.push(listener);\n};\n\nFeatureSourceBase.prototype.removeActivityListener = function(listener) {\n    var idx = arrayIndexOf(this.activityListeners, listener);\n    if (idx >= 0) {\n        this.activityListeners.splice(idx, 1);\n    }\n};\n\nFeatureSourceBase.prototype.notifyActivity = function() {\n    for (var li = 0; li < this.activityListeners.length; ++li) {\n        try {\n            this.activityListeners[li](this.busy);\n        } catch (e) {\n            console.log(e);\n        }\n    }\n};\n\nFeatureSourceBase.prototype.getScales = function() {\n    return null;\n};\n\nFeatureSourceBase.prototype.fetch = function(chr, min, max, scale, types, pool, cnt) {\n    return cnt(null, [], 1000000000);\n};\n\nFeatureSourceBase.prototype.getStyleSheet = function(callback) {\n    var stylesheet = new DASStylesheet();\n    var defStyle = new DASStyle();\n    defStyle.glyph = 'BOX';\n    defStyle.BGCOLOR = 'blue';\n    defStyle.FGCOLOR = 'black';\n    stylesheet.pushStyle({type: 'default'}, null, defStyle);\n    return callback(stylesheet);\n};\n\n\n\nfunction DASFeatureSource(dasSource) {\n    this.dasSource = new DASSource(dasSource);\n    this.busy = 0;\n    this.activityListeners = [];\n}\n\nDASFeatureSource.prototype.addActivityListener = function(listener) {\n    this.activityListeners.push(listener);\n};\n\nDASFeatureSource.prototype.removeActivityListener = function(listener) {\n    var idx = arrayIndexOf(this.activityListeners, listener);\n    if (idx >= 0)\n        this.activityListeners.splice(idx, 1);\n};\n\n\nDASFeatureSource.prototype.notifyActivity = function() {\n    for (var li = 0; li < this.activityListeners.length; ++li) {\n        try {\n            this.activityListeners[li](this.busy);\n        } catch (e) {\n            console.log(e);\n        }\n    }\n};\n\nDASFeatureSource.prototype.getStyleSheet = function(callback) {\n    this.dasSource.stylesheet(function(stylesheet) {\n        callback(stylesheet);\n    }, function() {\n        callback(null, \"Couldn't fetch DAS stylesheet\");\n    });\n};\n\nDASFeatureSource.prototype.fetch = function(chr, min, max, scale, types, pool, callback) {\n    if (types && types.length === 0) {\n        callback(null, [], scale);\n        return;\n    }\n\n    if (!this.dasSource.uri && !this.dasSource.features_uri) {\n        // FIXME should this be making an error callback???\n        return;\n    }\n\n    if (this.dasSource.dasStaticFeatures && this.cachedStaticFeatures) {\n        return callback(null, this.cachedStaticFeatures, this.cachedStaticScale);\n    }\n\n    var tryMaxBins = (this.dasSource.maxbins !== false);\n    var fops = {\n        type: types\n    };\n    if (tryMaxBins) {\n        fops.maxbins = 1 + (((max - min) / scale) | 0);\n    }\n    \n    var thisB = this;\n    thisB.busy++;\n    thisB.notifyActivity();\n\n    this.dasSource.features(\n        new DASSegment(chr, min, max),\n        fops,\n        function(features, status) {\n            \n            thisB.busy--;\n            thisB.notifyActivity();\n\n            var retScale = scale;\n            if (!tryMaxBins) {\n                retScale = 0.1;\n            }\n            if (!status && thisB.dasSource.dasStaticFeatures) {\n                thisB.cachedStaticFeatures = features;\n                thisB.cachedStaticScale = retScale;\n            }\n            callback(status, features, retScale);\n        }\n    );\n};\n\nDASFeatureSource.prototype.findNextFeature = function(chr, pos, dir, callback) {\n    if (this.dasSource.capabilities && arrayIndexOf(this.dasSource.capabilities, 'das1:adjacent-feature') >= 0) {\n        var thisB = this;\n        if (this.dasAdjLock) {\n            return console.log('Already looking for a next feature, be patient!');\n        }\n        this.dasAdjLock = true;\n        var fops = {\n            adjacent: chr + ':' + (pos|0) + ':' + (dir > 0 ? 'F' : 'B')\n        };\n        var types = thisTier.getDesiredTypes(thisTier.browser.scale);\n        if (types) {\n            fops.types = types;\n        }\n        thisTier.dasSource.features(null, fops, function(res) {\n            thisB.dasAdjLock = false;\n            if (res.length > 0 && res[0] !== null) {\n                callback(res[0]);\n            }\n        });\n    }\n};\n\nfunction DASSequenceSource(dasSource) {\n    this.dasSource = new DASSource(dasSource);\n    this.awaitedEntryPoints = new Awaited();\n\n    var thisB = this;\n    this.dasSource.entryPoints(\n        function(ep) {\n            thisB.awaitedEntryPoints.provide(ep);\n        });\n}\n\n\nDASSequenceSource.prototype.fetch = function(chr, min, max, pool, callback) {\n    this.dasSource.sequence(\n        new DASSegment(chr, min, max),\n        function(seqs) {\n            if (seqs.length == 1) {\n                return callback(null, seqs[0]);\n            } else {\n                return callback(\"Didn't get sequence\");\n            }\n        }\n    );\n};\n\nDASSequenceSource.prototype.getSeqInfo = function(chr, cnt) {\n    this.awaitedEntryPoints.await(function(ep) {\n        for (var epi = 0; epi < ep.length; ++epi) {\n            if (ep[epi].name == chr) {\n                return cnt({length: ep[epi].end});\n            }\n        }\n        return cnt();\n    });\n};\n    \n\nfunction TwoBitSequenceSource(source) {\n    var thisB = this;\n    this.source = source;\n    this.twoBit = new Awaited();\n    var data;\n    if (source.twoBitURI) {\n        data = new URLFetchable(source.twoBitURI, {credentials: source.credentials, resolver: source.resolver});\n    } else if (source.twoBitBlob) {\n        data = new BlobFetchable(source.twoBitBlob);\n    } else {\n        throw Error(\"No twoBitURI or twoBitBlob parameter\");\n    }\n\n    makeTwoBit(data, function(tb, error) {\n        if (error) {\n            console.log(error);\n        } else {\n            thisB.twoBit.provide(tb);\n        }\n    });\n}\n\nTwoBitSequenceSource.prototype.fetch = function(chr, min, max, pool, callback) {\n        this.twoBit.await(function(tb) {\n            tb.fetch(chr, min, max,\n                     function(seq, err) {\n                         if (err) {\n                             return callback(err, null);\n                         } else {\n                             var sequence = new DASSequence(chr, min, max, 'DNA', seq);\n                             return callback(null, sequence);\n                         }\n                     });\n        });\n};\n\nTwoBitSequenceSource.prototype.getSeqInfo = function(chr, cnt) {\n    this.twoBit.await(function(tb) {\n        var seq = tb.getSeq(chr);\n        if (seq) {\n            tb.getSeq(chr).length(function(l) {\n                cnt({length: l});\n            });\n        } else {\n            cnt();\n        }\n    });\n};\n\nfunction EnsemblSequenceSource(source) {\n  this.source = source;\n}\n\nEnsemblSequenceSource.prototype.fetch = function(chr, min, max, pool, callback) {\n    var url = this.source.ensemblURI + '/sequence/region/' + this.source.species + '/' +\n              chr + ':' + min + '..' + max + ':1?content-type=application/json';\n    var req = new XMLHttpRequest();\n    req.onreadystatechange = function() {\n        if (req.readyState == 4) {\n            var jr;\n            if (req.status >= 300) {\n                var err = 'Error code ' + req.status;\n                try {\n                    jr = JSON.parse(req.response);\n                    if (jr.error) {\n                        err = jr.error;\n                    }\n                } finally {\n                    callback(err, null);\n                }\n            } else {\n                jr = JSON.parse(req.response);\n                var sequence = new DASSequence(chr, min, max, 'DNA', jr.seq);\n                return callback(null, sequence);\n            }\n        }\n    };\n    req.open('GET', url, true);\n    req.responseType = 'text';\n    req.send();\n};\n\nEnsemblSequenceSource.prototype.getSeqInfo = function(chr, cnt) {\n  var url = this.source.ensemblURI + '/info/assembly/' + this.source.species + '/' + chr + '?content-type=application/json';\n  var req = new XMLHttpRequest();\n  req.onreadystatechange = function() {\n     if (req.readyState == 4) {\n        if (req.status >= 300) {\n            cnt();\n        } else {\n            var jr = JSON.parse(req.response);\n            cnt(jr);\n        }\n    }\n  };\n  req.open('GET', url, true);\n  req.responseType = 'text';\n  req.send();\n};\n\nfunction EnsemblProteinSequenceSource(source) {\n  this.source = source;\n}\n\nEnsemblProteinSequenceSource.prototype.fetch = function(chr, min, max, pool, callback) {\n  var url = this.source.ensemblURI + '/sequence/id/' + chr + '?type=protein&content-type=application/json';\n  var req = new XMLHttpRequest();\n  req.onreadystatechange = function() {\n  \tif (req.readyState == 4) {\n\t    if (req.status >= 300) {\n        var err = 'Error code ' + req.status;\n        try {\n          var jr = JSON.parse(req.response);\n          if (jr.error) {\n            err = jr.error;\n          }\n        } catch (ex) {};\n\n\t\t    callback(err, null);\n\t    } else {\n    \t\tvar jr = JSON.parse(req.response);\n        var sequence = new DASSequence(chr, 1, jr.seq.length + 1, 'PEP', jr.seq);\n        return callback(null, sequence);\n      }\n    }\n  }\n  req.open('GET', url, true);\n  req.responseType = 'text';\n  req.send('');\n}\n\nEnsemblProteinSequenceSource.prototype.getSeqInfo = function(chr, cnt) {\n  var url = this.source.ensemblURI + '/sequence/id/' + chr + '?type=protein&content-type=application/json';\n  var req = new XMLHttpRequest();\n  req.onreadystatechange = function() {\n\t  if (req.readyState == 4) {\n      if (req.status >= 300) {\n\t      cnt();\n      } else {\n  \t\t  var jr = JSON.parse(req.response);\n        cnt({length:jr.seq.length});\n      }\n    }\n  }\n  req.open('GET', url, true);\n  req.responseType = 'text';\n  req.send('');\n}\n\nDASFeatureSource.prototype.getScales = function() {\n    return [];\n};\n\nvar bwg_preflights = {};\n\nfunction BWGFeatureSource(bwgSource) {\n    FeatureSourceBase.call(this);\n\n    var thisB = this;\n    this.readiness = 'Connecting';\n    this.bwgSource = this.opts = bwgSource;    \n    thisB.bwgHolder = new Awaited();\n\n    if (this.opts.preflight) {\n        var pfs = bwg_preflights[this.opts.preflight];\n        if (!pfs) {\n            pfs = new Awaited();\n            bwg_preflights[this.opts.preflight] = pfs;\n\n            var req = new XMLHttpRequest();\n            req.onreadystatechange = function() {\n                if (req.readyState == 4) {\n                    if (req.status == 200) {\n                        pfs.provide('success');\n                    } else {\n                        pfs.provide('failure');\n                    }\n                }\n            };\n            req.open('get', this.opts.preflight + '?' + hex_sha1('salt' + Date.now()), true);    // Instead, ensure we always preflight a unique URI.\n            if (this.opts.credentials) {\n                req.withCredentials = true;\n            }\n            req.send();\n        }\n        pfs.await(function(status) {\n            if (status === 'success') {\n                thisB.init();\n            }\n        });\n    } else {\n        thisB.init();\n    }\n}\n\nBWGFeatureSource.prototype = Object.create(FeatureSourceBase.prototype);\n\nBWGFeatureSource.prototype.init = function() {\n    var thisB = this;\n    var arg;\n\n    var uri = this.bwgSource.uri || this.bwgSource.bwgURI;\n    if (uri) {\n        if (this.bwgSource.transport === 'encode') {\n            arg = new EncodeFetchable(uri, {credentials: this.opts.credentials});\n        } else {\n            arg = new URLFetchable(uri, {credentials: this.opts.credentials, resolver: this.opts.resolver});\n        }\n    } else {\n        arg = new BlobFetchable(this.bwgSource.bwgBlob);\n    }\n\n    makeBwg(arg, function(bwg, err) {\n        if (err) {\n            thisB.error = err;\n            thisB.readiness = null;\n            thisB.notifyReadiness();\n            thisB.bwgHolder.provide(null);\n        } else {\n            thisB.bwgHolder.provide(bwg);\n            thisB.readiness = null;\n            thisB.notifyReadiness();\n            if (bwg.type == 'bigbed') {\n                bwg.getExtraIndices(function(ei) {\n                    thisB.extraIndices = ei;\n                });\n            }\n        }\n    });\n};\n\nBWGFeatureSource.prototype.capabilities = function() {\n    var caps = {leap: true};\n    if (this.bwgHolder.res && this.bwgHolder.res.type == 'bigwig')\n        caps.quantLeap = true;\n    if (this.extraIndices && this.extraIndices.length > 0) {\n        caps.search = [];\n        for (var eii = 0; eii < this.extraIndices.length; ++eii) {\n            caps.search.push(this.extraIndices[eii].field);\n        }\n    }\n    return caps;\n};\n\nBWGFeatureSource.prototype.fetch = function(chr, min, max, scale, types, pool, callback) {\n    var thisB = this;\n    this.bwgHolder.await(function(bwg) {\n        if (typeof bwg === 'undefined' || bwg === null) {\n            return callback(thisB.error || \"Can't access binary file\", null, null);\n        }\n\n        var data;\n        var wantDensity = !types || types.length === 0 || arrayIndexOf(types, 'density') >= 0;\n        if (thisB.opts.clientBin) {\n            wantDensity = false;\n        }\n        var scaleFactor = thisB.opts.scaleFactor || 1.0;\n        if (bwg.type == 'bigwig' || wantDensity || (typeof thisB.opts.forceReduction !== 'undefined')) {\n            var zoom = -1;\n            for (var z = 0; z < bwg.zoomLevels.length; ++z) {\n                if (bwg.zoomLevels[z].reduction <= (scale * scaleFactor)) {\n                    zoom = z;\n                } else {\n                    break;\n                }\n            }\n            if (typeof thisB.opts.forceReduction !== 'undefined') {\n                zoom = thisB.opts.forceReduction;\n            }\n\n            if (zoom < 0) {\n                data = bwg.getUnzoomedView();\n            } else {\n                data = bwg.getZoomedView(zoom);\n            }\n        } else {\n            data = bwg.getUnzoomedView();\n        }\n        \n        thisB.busy++;\n        thisB.notifyActivity();\n        data.readWigData(chr, min, max, function(features) {\n            thisB.busy--;\n            thisB.notifyActivity();\n\n            var fs = 1000000000;\n            if (bwg.type === 'bigwig') {\n                var is = (max - min) / features.length / 2;\n                if (is < fs) {\n                    fs = is;\n                }\n            }\n            if (thisB.opts.link) {\n                for (var fi = 0; fi < features.length; ++fi) {\n                    var f = features[fi];\n                    if (f.label) {\n                        f.links = [new DASLink('Link', thisB.opts.link.replace(/\\$\\$/, f.label))];\n                    }\n                }\n            }\n            callback(null, features, fs);\n        });\n    });\n};\n\nBWGFeatureSource.prototype.quantFindNextFeature = function(chr, pos, dir, threshold, callback) {\n    // var beforeQFNF = Date.now()|0;\n    var thisB = this;\n    thisB.busy++;\n    thisB.notifyActivity();\n    this.bwgHolder.res.thresholdSearch(chr, pos, dir, threshold, function(a, b) {\n        thisB.busy--;\n        thisB.notifyActivity();\n        // var afterQFNF = Date.now()|0;\n        // console.log('QFNF took ' + (afterQFNF - beforeQFNF) + 'ms');\n        return callback(a, b);\n    });\n};\n\nBWGFeatureSource.prototype.findNextFeature = function(chr, pos, dir, callback) {\n    var thisB = this;\n    thisB.busy++;\n    thisB.notifyActivity();\n    this.bwgHolder.res.getUnzoomedView().getFirstAdjacent(chr, pos, dir, function(res) {\n        thisB.busy--;\n        thisB.notifyActivity();\n        if (res.length > 0 && res[0] !== null) {\n            callback(res[0]);\n        }\n    });\n};\n\nBWGFeatureSource.prototype.getScales = function() {\n    var bwg = this.bwgHolder.res;\n    if (bwg /* && bwg.type == 'bigwig' */) {\n        var scales = [1];  // Can we be smarter about inferring baseline scale?\n        for (var z = 0; z < bwg.zoomLevels.length; ++z) {\n            scales.push(bwg.zoomLevels[z].reduction);\n        }\n        return scales;\n    } else {\n        return null;\n    }\n};\n\nBWGFeatureSource.prototype.search = function(query, callback) {\n    if (!this.extraIndices || this.extraIndices.length === 0) {\n        return callback(null, 'No indices available');\n    }\n\n    var index = this.extraIndices[0];\n    return index.lookup(query, callback);\n};\n\nBWGFeatureSource.prototype.getDefaultFIPs = function(callback) {\n    if (this.opts.noExtraFeatureInfo)\n        return true;\n\n    this.bwgHolder.await(function(bwg) {\n        if (!bwg) return;\n\n        if (bwg.schema && bwg.definedFieldCount < bwg.schema.fields.length) {\n            var fip = function(feature, featureInfo) {\n                for (var hi = 0; hi < featureInfo.hit.length; ++hi) {\n                    if (featureInfo.hit[hi].isSuperGroup)\n                        return;\n                }\n                for (var fi = bwg.definedFieldCount; fi < bwg.schema.fields.length; ++fi) {\n                    var f = bwg.schema.fields[fi];\n                    featureInfo.add(f.comment, feature[f.name]);\n                }\n            };\n\n            callback(fip);\n        } else {\n            // No need to do anything.\n        }\n    });\n};\n\nBWGFeatureSource.prototype.getStyleSheet = function(callback) {\n    var thisB = this;\n\n    this.bwgHolder.await(function(bwg) {\n        if (!bwg) {\n            return callback(null, 'bbi error');\n        }\n\n        var stylesheet = new DASStylesheet();\n        if (bwg.type == 'bigbed') {\n            var wigStyle = new DASStyle();\n            wigStyle.glyph = 'BOX';\n            wigStyle.FGCOLOR = 'black';\n            wigStyle.BGCOLOR = 'blue';\n            wigStyle.HEIGHT = 8;\n            wigStyle.BUMP = true;\n            wigStyle.LABEL = true;\n            wigStyle.ZINDEX = 20;\n            stylesheet.pushStyle({type: 'bigbed'}, null, wigStyle);\n        \n            wigStyle.glyph = 'BOX';\n            wigStyle.FGCOLOR = 'black';\n            wigStyle.BGCOLOR = 'red';\n            wigStyle.HEIGHT = 10;\n            wigStyle.BUMP = true;\n            wigStyle.ZINDEX = 20;\n            stylesheet.pushStyle({type: 'translation'}, null, wigStyle);\n                    \n            var tsStyle = new DASStyle();\n            tsStyle.glyph = 'BOX';\n            tsStyle.FGCOLOR = 'black';\n            tsStyle.BGCOLOR = 'white';\n            tsStyle.HEIGHT = 10;\n            tsStyle.ZINDEX = 10;\n            tsStyle.BUMP = true;\n            tsStyle.LABEL = true;\n            stylesheet.pushStyle({type: 'transcript'}, null, tsStyle);\n\n            var densStyle = new DASStyle();\n            densStyle.glyph = 'HISTOGRAM';\n            densStyle.COLOR1 = 'white';\n            densStyle.COLOR2 = 'black';\n            densStyle.HEIGHT=30;\n            stylesheet.pushStyle({type: 'density'}, null, densStyle);\n        } else {\n            var wigStyle = new DASStyle();\n            wigStyle.glyph = 'HISTOGRAM';\n            wigStyle.COLOR1 = 'white';\n            wigStyle.COLOR2 = 'black';\n            wigStyle.HEIGHT=30;\n            stylesheet.pushStyle({type: 'default'}, null, wigStyle);\n        }\n\n        if (bwg.definedFieldCount == 12 && bwg.fieldCount >= 14) {\n            stylesheet.geneHint = true;\n        }\n\n        return callback(stylesheet);\n    });\n};\n\nfunction RemoteBWGFeatureSource(bwgSource, worker, browser) {\n    FeatureSourceBase.call(this);\n\n    var thisB = this;\n    this.worker = worker;\n    this.readiness = 'Connecting';\n    this.bwgSource = this.opts = bwgSource;\n    this.keyHolder = new Awaited();\n\n    if (bwgSource.resolver) {\n        this.resolverKey = browser.registerResolver(bwgSource.resolver);\n    }\n\n    this.init();\n}\n\nRemoteBWGFeatureSource.prototype = Object.create(FeatureSourceBase.prototype);\n\nRemoteBWGFeatureSource.prototype.init = function() {\n    var thisB = this;\n    var uri = this.uri || this.bwgSource.uri || this.bwgSource.bwgURI;\n    var blob = this.bwgSource.blob || this.bwgSource.bwgBlob;\n\n    var cnt = function(key, err) {\n        thisB.readiness = null;\n        thisB.notifyReadiness();\n\n        if (key) {\n            thisB.worker.postCommand({command: 'meta', connection: key}, function(meta, err) {\n                if (err) {\n                    thisB.error = err;\n                    thisB.keyHolder.provide(null);\n                } else {\n                    thisB.meta = meta;\n                    thisB.keyHolder.provide(key);\n                }\n            });\n        } else {\n            thisB.error = err;\n            thisB.keyHolder.provide(null);\n        }\n    };\n\n    if (blob) {\n        this.worker.postCommand({command: 'connectBBI', blob: blob}, cnt);\n    } else {\n        this.worker.postCommand({\n            command: 'connectBBI', \n            uri: resolveUrlToPage(uri), \n            resolver: this.resolverKey,\n            transport: this.bwgSource.transport,\n            credentials: this.bwgSource.credentials}, \n          cnt); \n    }\n};\n\nRemoteBWGFeatureSource.prototype.capabilities = function() {\n    var caps = {leap: true};\n\n    if (this.meta && this.meta.type == 'bigwig')\n        caps.quantLeap = true;\n    if (this.meta && this.meta.extraIndices && this.meta.extraIndices.length > 0) {\n        caps.search = [];\n        for (var eii = 0; eii < this.meta.extraIndices.length; ++eii) {\n            caps.search.push(this.meta.extraIndices[eii].field);\n        }\n    }\n    return caps;\n};\n\nRemoteBWGFeatureSource.prototype.fetch = function(chr, min, max, scale, types, pool, callback) {\n    var thisB = this;\n\n    thisB.busy++;\n    thisB.notifyActivity();\n\n    this.keyHolder.await(function(key) {\n        if (!key) {\n            thisB.busy--;\n            thisB.notifyActivity();\n            return callback(thisB.error || \"Can't access binary file\", null, null);\n        }\n\n        var zoom = -1;\n        var wantDensity = !types || types.length === 0 || arrayIndexOf(types, 'density') >= 0;\n        if (thisB.opts.clientBin) {\n            wantDensity = false;\n        }\n        if (thisB.meta.type == 'bigwig' || wantDensity || (typeof thisB.opts.forceReduction !== 'undefined')) {\n            for (var z = 1; z < thisB.meta.zoomLevels.length; ++z) {\n                if (thisB.meta.zoomLevels[z] <= scale) {\n                    zoom = z - 1; // Scales returned in metadata start at 1, unlike \"real\" zoom levels.\n                } else {\n                    break;\n                }\n            }\n            if (typeof thisB.opts.forceReduction !== 'undefined') {\n                zoom = thisB.opts.forceReduction;\n            }\n        }\n        \n        thisB.worker.postCommand({command: 'fetch', connection: key, chr: chr, min: min, max: max, zoom: zoom}, function(features, error) {\n            thisB.busy--;\n            thisB.notifyActivity();\n\n            var fs = 1000000000;\n            if (thisB.meta.type === 'bigwig') {\n                var is = (max - min) / features.length / 2;\n                if (is < fs) {\n                    fs = is;\n                }\n            } \n            if (thisB.opts.link) {\n                for (var fi = 0; fi < features.length; ++fi) {\n                    var f = features[fi];\n                    if (f.label) {\n                        f.links = [new DASLink('Link', thisB.opts.link.replace(/\\$\\$/, f.label))];\n                    }\n                }\n            } \n            callback(error, features, fs);\n        });\n    });\n};\n\n\nRemoteBWGFeatureSource.prototype.quantFindNextFeature = function(chr, pos, dir, threshold, callback) {\n    var thisB = this;\n    this.busy++;\n    this.notifyActivity();\n    this.worker.postCommand({command: 'quantLeap', connection: this.keyHolder.res, chr: chr, pos: pos, dir: dir, threshold: threshold, under: false}, function(result, err) {\n        console.log(result, err);\n        thisB.busy--;\n        thisB.notifyActivity();\n        return callback(result, err);\n    });\n};\n\nRemoteBWGFeatureSource.prototype.findNextFeature = function(chr, pos, dir, callback) {\n    var thisB = this;\n    this.busy++;\n    this.notifyActivity();\n    this.worker.postCommand({command: 'leap', connection: this.keyHolder.res, chr: chr, pos: pos, dir: dir}, function(result, err) {\n        thisB.busy--;\n        thisB.notifyActivity();\n        if (result.length > 0 && result[0] !== null) {\n            callback(result[0]);\n        }\n    });\n};\n\nRemoteBWGFeatureSource.prototype.getScales = function() {\n    var meta = this.meta;\n    if (meta) {\n        return meta.zoomLevels;\n    } else {\n        return null;\n    }\n};\n\nRemoteBWGFeatureSource.prototype.search = function(query, callback) {\n    if (!this.meta.extraIndices || this.meta.extraIndices.length === 0) {\n        return callback(null, 'No indices available');\n    }\n\n    var thisB = this;\n    this.busy++;\n    this.notifyActivity();\n    var index = this.meta.extraIndices[0];\n    this.worker.postCommand({command: 'search', connection: this.keyHolder.res, query: query, index: index}, function(result, err) {\n        thisB.busy--;\n        thisB.notifyActivity();\n\n        callback(result, err);\n    });\n};\n\nRemoteBWGFeatureSource.prototype.getDefaultFIPs = function(callback) {\n    if (this.opts.noExtraFeatureInfo)\n        return true;\n\n    var thisB = this;\n    this.keyHolder.await(function(key) {\n        var bwg = thisB.meta;\n        if (!bwg) return;\n\n        if (bwg.schema && bwg.definedFieldCount < bwg.schema.fields.length) {\n            var fip = function(feature, featureInfo) {\n                for (var hi = 0; hi < featureInfo.hit.length; ++hi) {\n                    if (featureInfo.hit[hi].isSuperGroup)\n                        return;\n                }\n                for (var fi = bwg.definedFieldCount; fi < bwg.schema.fields.length; ++fi) {\n                    var f = bwg.schema.fields[fi];\n                    featureInfo.add(f.comment, feature[f.name]);\n                }\n            };\n\n            callback(fip);\n        } else {\n            // No need to do anything.\n        }\n    });\n};\n\nRemoteBWGFeatureSource.prototype.getStyleSheet = function(callback) {\n    var thisB = this;\n\n    this.keyHolder.await(function(key) {\n        var bwg = thisB.meta;\n        if (!bwg) {\n            return callback(null, 'bbi error');\n        } \n\n        var stylesheet = new DASStylesheet();\n        if (bwg.type == 'bigbed') {\n            var wigStyle = new DASStyle();\n            wigStyle.glyph = 'BOX';\n            wigStyle.FGCOLOR = 'black';\n            wigStyle.BGCOLOR = 'blue';\n            wigStyle.HEIGHT = 8;\n            wigStyle.BUMP = true;\n            wigStyle.LABEL = true;\n            wigStyle.ZINDEX = 20;\n            stylesheet.pushStyle({type: 'bigbed'}, null, wigStyle);\n        \n            wigStyle.glyph = 'BOX';\n            wigStyle.FGCOLOR = 'black';\n            wigStyle.BGCOLOR = 'red';\n            wigStyle.HEIGHT = 10;\n            wigStyle.BUMP = true;\n            wigStyle.ZINDEX = 20;\n            stylesheet.pushStyle({type: 'translation'}, null, wigStyle);\n                    \n            var tsStyle = new DASStyle();\n            tsStyle.glyph = 'BOX';\n            tsStyle.FGCOLOR = 'black';\n            tsStyle.BGCOLOR = 'white';\n            tsStyle.HEIGHT = 10;\n            tsStyle.ZINDEX = 10;\n            tsStyle.BUMP = true;\n            tsStyle.LABEL = true;\n            stylesheet.pushStyle({type: 'transcript'}, null, tsStyle);\n\n            var densStyle = new DASStyle();\n            densStyle.glyph = 'HISTOGRAM';\n            densStyle.COLOR1 = 'white';\n            densStyle.COLOR2 = 'black';\n            densStyle.HEIGHT=30;\n            stylesheet.pushStyle({type: 'density'}, null, densStyle);\n        } else {\n            var wigStyle = new DASStyle();\n            wigStyle.glyph = 'HISTOGRAM';\n            wigStyle.COLOR1 = 'white';\n            wigStyle.COLOR2 = 'black';\n            wigStyle.HEIGHT=30;\n            stylesheet.pushStyle({type: 'default'}, null, wigStyle);\n        }\n\n\n        if (bwg.definedFieldCount == 12 && bwg.fieldCount >= 14) {\n            stylesheet.geneHint = true;\n        } \n\n        return callback(stylesheet);\n    });\n};\n\nfunction bamRecordToFeature(r, group) {\n    if (r.flag & BamFlags.SEGMENT_UNMAPPED)\n        return; \n    \n    var len;\n    if (r.seq)\n        len = r.seq.length;\n    else \n        len = r.seqLength;\n    \n    if (r.cigar) {\n        len = 0;\n        var ops = parseCigar(r.cigar);\n        for (var ci = 0; ci < ops.length; ++ci) {\n            var co = ops[ci];\n            if (co.op == 'M' || co.op == 'D')\n                len += co.cnt;\n        }\n    }\n\n    var f = new DASFeature();\n    f.min = r.pos + 1;\n    f.max = r.pos + len;\n    f.segment = r.segment;\n    f.type = 'bam';\n    f.id = r.readName;\n    f.notes = [/* 'Sequence=' + r.seq, 'CIGAR=' + r.cigar, */ 'MQ=' + r.mq];\n    f.cigar = r.cigar;\n    f.seq = r.seq;\n    f.quals = r.quals;\n    f.orientation = (r.flag & BamFlags.REVERSE_COMPLEMENT) ? '-' : '+';\n    f.bamRecord = r;\n\n    if (group && (r.flag & BamFlags.MULTIPLE_SEGMENTS)) {\n        f.groups = [{id: r.readName, \n                     type: 'readpair'}];\n    }\n\n    return f;\n}\n\nfunction BAMFeatureSource(bamSource) {\n    FeatureSourceBase.call(this);\n\n    var thisB = this;\n    this.bamSource = bamSource;\n    this.opts = {credentials: bamSource.credentials, preflight: bamSource.preflight, bamGroup: bamSource.bamGroup};\n    this.bamHolder = new Awaited();\n    \n    if (this.opts.preflight) {\n        var pfs = bwg_preflights[this.opts.preflight];\n        if (!pfs) {\n            pfs = new Awaited();\n            bwg_preflights[this.opts.preflight] = pfs;\n\n            var req = new XMLHttpRequest();\n            req.onreadystatechange = function() {\n                if (req.readyState == 4) {\n                    if (req.status == 200) {\n                        pfs.provide('success');\n                    } else {\n                        pfs.provide('failure');\n                    }\n                }\n            };\n            // req.setRequestHeader('cache-control', 'no-cache');    /* Doesn't work, not an allowed request header in CORS */\n            req.open('get', this.opts.preflight + '?' + hex_sha1('salt' + Date.now()), true);    // Instead, ensure we always preflight a unique URI.\n            if (this.opts.credentials) {\n                req.withCredentials = 'true';\n            }\n            req.send();\n        }\n        pfs.await(function(status) {\n            if (status === 'success') {\n                thisB.init();\n            }\n        });\n    } else {\n        thisB.init();\n    }\n}\n\nBAMFeatureSource.prototype = Object.create(FeatureSourceBase.prototype);\n\nBAMFeatureSource.prototype.init = function() {\n    var thisB = this;\n    var bamF, baiF;\n    if (this.bamSource.bamBlob) {\n        bamF = new BlobFetchable(this.bamSource.bamBlob);\n        baiF = new BlobFetchable(this.bamSource.baiBlob);\n    } else {\n        bamF = new URLFetchable(this.bamSource.bamURI, {credentials: this.opts.credentials, resolver: this.opts.resolver});\n        baiF = new URLFetchable(this.bamSource.baiURI || (this.bamSource.bamURI + '.bai'), \n                                {credentials: this.opts.credentials, resolver: this.opts.resolver});\n    }\n    makeBam(bamF, baiF, null, function(bam, err) {\n        thisB.readiness = null;\n        thisB.notifyReadiness();\n\n        if (bam) {\n            thisB.bamHolder.provide(bam);\n        } else {\n            thisB.error = err;\n            thisB.bamHolder.provide(null);\n        }\n    });\n};\n\nBAMFeatureSource.prototype.fetch = function(chr, min, max, scale, types, pool, callback) {\n    var light = types && (types.length == 1) && (types[0] == 'density');\n\n    var thisB = this;\n    \n    thisB.busy++;\n    thisB.notifyActivity();\n    \n    this.bamHolder.await(function(bam) {\n        if (!bam) {\n            thisB.busy--;\n            thisB.notifyActivity();\n            return callback(thisB.error || \"Couldn't fetch BAM\");\n        }\n\n        bam.fetch(chr, min, max, function(bamRecords, error) {\n            thisB.busy--;\n            thisB.notifyActivity();\n\n            if (error) {\n                callback(error, null, null);\n            } else {\n                var features = [];\n                for (var ri = 0; ri < bamRecords.length; ++ri) {\n                    var r = bamRecords[ri];\n\n                    var f = bamRecordToFeature(r, thisB.opts.bamGroup);\n                    if (f)\n                        features.push(f);\n                }\n                callback(null, features, 1000000000);\n            }\n        }, {light: light});\n    });\n};\n\nBAMFeatureSource.prototype.getScales = function() {\n    return 1000000000;\n};\n\nBAMFeatureSource.prototype.getStyleSheet = function(callback) {\n    this.bamHolder.await(function(bam) {\n        var stylesheet = new DASStylesheet();\n                \n        var densStyle = new DASStyle();\n        densStyle.glyph = 'HISTOGRAM';\n        densStyle.COLOR1 = 'black';\n        densStyle.COLOR2 = 'red';\n        densStyle.HEIGHT=30;\n        stylesheet.pushStyle({type: 'density'}, 'low', densStyle);\n        stylesheet.pushStyle({type: 'density'}, 'medium', densStyle);\n\n        var wigStyle = new DASStyle();\n        wigStyle.glyph = '__SEQUENCE';\n        wigStyle.FGCOLOR = 'black';\n        wigStyle.BGCOLOR = 'blue';\n        wigStyle.HEIGHT = 8;\n        wigStyle.BUMP = true;\n        wigStyle.LABEL = false;\n        wigStyle.ZINDEX = 20;\n        stylesheet.pushStyle({type: 'bam'}, 'high', wigStyle);\n\n        return callback(stylesheet);\n    });\n};\n\n\nfunction RemoteBAMFeatureSource(bamSource, worker) {\n    FeatureSourceBase.call(this);\n\n    var thisB = this;\n    this.bamSource = bamSource;\n    this.worker = worker;\n    this.opts = {credentials: bamSource.credentials, preflight: bamSource.preflight, bamGroup: bamSource.bamGroup};\n    this.keyHolder = new Awaited();\n    \n    if (bamSource.resolver) {\n        this.resolverKey = browser.registerResolver(bamSource.resolver);\n    }\n\n    this.init();\n}\n\nRemoteBAMFeatureSource.prototype = Object.create(FeatureSourceBase.prototype);\n\nRemoteBAMFeatureSource.prototype.init = function() {    var thisB = this;\n    var uri = this.bamSource.uri || this.bamSource.bamURI;\n    var indexUri = this.bamSource.indexUri || this.bamSource.baiURI || uri + '.bai';\n\n    var blob = this.bamSource.bamBlob || this.bamSource.blob;\n    var indexBlob = this.bamSource.baiBlob || this.bamSource.indexBlob;\n\n    var cnt = function(result, err) {\n        thisB.readiness = null;\n        thisB.notifyReadiness();\n\n        if (result) {\n            thisB.keyHolder.provide(result);\n        } else {\n            thisB.error = err;\n            thisB.keyHolder.provide(null);\n        }\n    };\n\n    if (blob) {\n        this.worker.postCommand({command: 'connectBAM', blob: blob, indexBlob: indexBlob}, cnt);\n    } else {\n        this.worker.postCommand({\n            command: 'connectBAM', \n            uri: resolveUrlToPage(uri), \n            resolver: this.resolverKey,\n            indexUri: resolveUrlToPage(indexUri),\n            credentials: this.bamSource.credentials,\n            indexChunks: this.bamSource.indexChunks},\n          cnt); \n    }\n};\n\nRemoteBAMFeatureSource.prototype.fetch = function(chr, min, max, scale, types, pool, callback) {\n    var light = types && (types.length == 1) && (types[0] == 'density');\n    var thisB = this;\n    \n    thisB.busy++;\n    thisB.notifyActivity();\n    \n    this.keyHolder.await(function(key) {\n        if (!key) {\n            thisB.busy--;\n            thisB.notifyActivity();\n            return callback(thisB.error || \"Couldn't fetch BAM\");\n        }\n\n        thisB.worker.postCommand({command: 'fetch', connection: key, chr: chr, min: min, max: max, opts: {light: light}}, function(bamRecords, error) {\n            // console.log('retrieved ' + bamRecords.length + ' via worker.');\n\n            thisB.busy--;\n            thisB.notifyActivity();\n\n            if (error) {\n                callback(error, null, null);\n            } else {\n                var features = [];\n                for (var ri = 0; ri < bamRecords.length; ++ri) {\n                    var r = bamRecords[ri];\n                    var f = bamRecordToFeature(r, thisB.opts.bamGroup);\n                    if (f)\n                        features.push(f);\n                }\n                callback(null, features, 1000000000);\n            }\n        });\n    });\n};\n\nRemoteBAMFeatureSource.prototype.getScales = function() {\n    return 1000000000;\n};\n\nRemoteBAMFeatureSource.prototype.getStyleSheet = function(callback) {\n    this.keyHolder.await(function(bam) {\n        var stylesheet = new DASStylesheet();\n                \n        var densStyle = new DASStyle();\n        densStyle.glyph = 'HISTOGRAM';\n        densStyle.COLOR1 = 'black';\n        densStyle.COLOR2 = 'red';\n        densStyle.HEIGHT=30;\n        stylesheet.pushStyle({type: 'density'}, 'low', densStyle);\n        stylesheet.pushStyle({type: 'density'}, 'medium', densStyle);\n\n        var wigStyle = new DASStyle();\n        wigStyle.glyph = '__SEQUENCE';\n        wigStyle.FGCOLOR = 'black';\n        wigStyle.BGCOLOR = 'blue';\n        wigStyle.HEIGHT = 8;\n        wigStyle.BUMP = true;\n        wigStyle.LABEL = false;\n        wigStyle.ZINDEX = 20;\n        stylesheet.pushStyle({type: 'bam'}, 'high', wigStyle);\n        return callback(stylesheet);\n    });\n};\n\nfunction CRAMFeatureSource(cramSource) {\n    FeatureSourceBase.call(this);\n\n    var thisB = this;\n    this.cramSource = cramSource;\n    this.opts = {credentials: cramSource.credentials, preflight: cramSource.preflight, cramGroup: cramSource.cramGroup};\n    this.cramHolder = new Awaited();\n    \n    if (this.opts.preflight) {\n        var pfs = bwg_preflights[this.opts.preflight];\n        if (!pfs) {\n            pfs = new Awaited();\n            bwg_preflights[this.opts.preflight] = pfs;\n\n            var req = new XMLHttpRequest();\n            req.onreadystatechange = function() {\n                if (req.readyState == 4) {\n                    if (req.status == 200) {\n                        pfs.provide('success');\n                    } else {\n                        pfs.provide('failure');\n                    }\n                }\n            };\n            // req.setRequestHeader('cache-control', 'no-cache');    /* Doesn't work, not an allowed request header in CORS */\n            req.open('get', this.opts.preflight + '?' + hex_sha1('salt' + Date.now()), true);    // Instead, ensure we always preflight a unique URI.\n            if (this.opts.credentials) {\n                req.withCredentials = 'true';\n            }\n            req.send();\n        }\n        pfs.await(function(status) {\n            if (status === 'success') {\n                thisB.init();\n            }\n        });\n    } else {\n        thisB.init();\n    }\n}\n\nCRAMFeatureSource.prototype = Object.create(FeatureSourceBase.prototype);\n\nCRAMFeatureSource.prototype.init = function() {\n    var thisB = this;\n    var cramF, craiF;\n    if (this.cramSource.cramBlob) {\n        cramF = new BlobFetchable(this.cramSource.cramBlob);\n        craiF = new BlobFetchable(this.cramSource.craiBlob);\n    } else {\n        cramF = new URLFetchable(this.cramSource.cramURI, {credentials: this.opts.credentials, resolver: this.opts.resolver});\n        craiF = new URLFetchable(this.cramSource.craiURI || (this.cramSource.cramURI + '.crai'), \n                                {credentials: this.opts.credentials, resolver: this.opts.resolver});\n    }\n    makeCram(cramF, craiF, null, function(cram, err) {\n        thisB.readiness = null;\n        thisB.notifyReadiness();\n\n        if (cram) {\n            thisB.cramHolder.provide(cram);\n        } else {\n            thisB.error = err;\n            thisB.cramHolder.provide(null);\n        }\n    });\n};\n\nCRAMFeatureSource.prototype.fetch = function(chr, min, max, scale, types, pool, callback) {\n    var light = types && (types.length == 1) && (types[0] == 'density');\n\n    var thisB = this;\n    \n    thisB.busy++;\n    thisB.notifyActivity();\n    \n    this.cramHolder.await(function(cram) {\n        if (!cram) {\n            thisB.busy--;\n            thisB.notifyActivity();\n            return callback(thisB.error || \"Couldn't fetch CRAM\");\n        }\n\n        cram.fetch(chr, min, max, function(cramRecords, error) {\n            thisB.busy--;\n            thisB.notifyActivity();\n\n            if (error) {\n                callback(error, null, null);\n            } else {\n                var features = [];\n                for (var ri = 0; ri < cramRecords.length; ++ri) {\n                    var r = cramRecords[ri];\n\n                    var f = cramRecordToFeature(r, thisB.opts.cramGroup);\n                    if (f)\n                        features.push(f);\n                }\n                callback(null, features, 1000000000);\n            }\n        }, {light: light});\n    });\n};\n\nCRAMFeatureSource.prototype.getScales = function() {\n    return 1000000000;\n};\n\nCRAMFeatureSource.prototype.getStyleSheet = function(callback) {\n    this.cramHolder.await(function(cram) {\n        var stylesheet = new DASStylesheet();\n                \n        var densStyle = new DASStyle();\n        densStyle.glyph = 'HISTOGRAM';\n        densStyle.COLOR1 = 'black';\n        densStyle.COLOR2 = 'red';\n        densStyle.HEIGHT=30;\n        stylesheet.pushStyle({type: 'density'}, 'low', densStyle);\n        stylesheet.pushStyle({type: 'density'}, 'medium', densStyle);\n\n        var wigStyle = new DASStyle();\n        wigStyle.glyph = '__SEQUENCE';\n        wigStyle.FGCOLOR = 'black';\n        wigStyle.BGCOLOR = 'blue';\n        wigStyle.HEIGHT = 8;\n        wigStyle.BUMP = true;\n        wigStyle.LABEL = false;\n        wigStyle.ZINDEX = 20;\n        stylesheet.pushStyle({type: 'cram'}, 'high', wigStyle);\n\n        return callback(stylesheet);\n    });\n};\n\n\nfunction RemoteCRAMFeatureSource(cramSource, worker) {\n    FeatureSourceBase.call(this);\n\n    var thisB = this;\n    this.cramSource = cramSource;\n    this.worker = worker;\n    this.opts = {credentials: cramSource.credentials, preflight: cramSource.preflight, cramGroup: cramSource.cramGroup};\n    this.keyHolder = new Awaited();\n    \n    if (cramSource.resolver) {\n        this.resolverKey = browser.registerResolver(cramSource.resolver);\n    }\n\n    this.init();\n}\n\nRemoteCRAMFeatureSource.prototype = Object.create(FeatureSourceBase.prototype);\n\nRemoteCRAMFeatureSource.prototype.init = function() {    var thisB = this;\n    var uri = this.cramSource.uri || this.cramSource.cramURI;\n    var indexUri = this.cramSource.indexUri || this.cramSource.craiURI || uri + '.crai';\n\n    var blob = this.cramSource.cramBlob || this.cramSource.blob;\n    var indexBlob = this.cramSource.craiBlob || this.cramSource.indexBlob;\n\n    var cnt = function(result, err) {\n        thisB.readiness = null;\n        thisB.notifyReadiness();\n\n        if (result) {\n            thisB.keyHolder.provide(result);\n        } else {\n            thisB.error = err;\n            thisB.keyHolder.provide(null);\n        }\n    };\n\n    if (blob) {\n        this.worker.postCommand({command: 'connectCRAM', blob: blob, indexBlob: indexBlob}, cnt);\n    } else {\n        this.worker.postCommand({\n            command: 'connectCRAM', \n            uri: resolveUrlToPage(uri), \n            resolver: this.resolverKey,\n            indexUri: resolveUrlToPage(indexUri),\n            credentials: this.cramSource.credentials,\n            indexChunks: this.cramSource.indexChunks},\n          cnt); \n    }\n};\n\nRemoteCRAMFeatureSource.prototype.fetch = function(chr, min, max, scale, types, pool, callback) {\n    var light = types && (types.length == 1) && (types[0] == 'density');\n    var thisB = this;\n    \n    thisB.busy++;\n    thisB.notifyActivity();\n    \n    this.keyHolder.await(function(key) {\n        if (!key) {\n            thisB.busy--;\n            thisB.notifyActivity();\n            return callback(thisB.error || \"Couldn't fetch CRAM\");\n        }\n\n        thisB.worker.postCommand({command: 'fetch', connection: key, chr: chr, min: min, max: max, opts: {light: light}}, function(cramRecords, error) {\n            // console.log('retrieved ' + cramRecords.length + ' via worker.');\n\n            thisB.busy--;\n            thisB.notifyActivity();\n\n            if (error) {\n                callback(error, null, null);\n            } else {\n                var features = [];\n                for (var ri = 0; ri < cramRecords.length; ++ri) {\n                    var r = cramRecords[ri];\n                    var f = cramRecordToFeature(r, thisB.opts.cramGroup);\n                    if (f)\n                        features.push(f);\n                }\n                callback(null, features, 1000000000);\n            }\n        });\n    });\n};\n\nRemoteCRAMFeatureSource.prototype.getScales = function() {\n    return 1000000000;\n};\n\nRemoteCRAMFeatureSource.prototype.getStyleSheet = function(callback) {\n    this.keyHolder.await(function(cram) {\n        var stylesheet = new DASStylesheet();\n                \n        var densStyle = new DASStyle();\n        densStyle.glyph = 'HISTOGRAM';\n        densStyle.COLOR1 = 'black';\n        densStyle.COLOR2 = 'red';\n        densStyle.HEIGHT=30;\n        stylesheet.pushStyle({type: 'density'}, 'low', densStyle);\n        stylesheet.pushStyle({type: 'density'}, 'medium', densStyle);\n\n        var wigStyle = new DASStyle();\n        wigStyle.glyph = '__SEQUENCE';\n        wigStyle.FGCOLOR = 'black';\n        wigStyle.BGCOLOR = 'blue';\n        wigStyle.HEIGHT = 8;\n        wigStyle.BUMP = true;\n        wigStyle.LABEL = false;\n        wigStyle.ZINDEX = 20;\n        stylesheet.pushStyle({type: 'cram'}, 'high', wigStyle);\n        return callback(stylesheet);\n    });\n};\n\n\nfunction MappedFeatureSource(source, mapping) {\n    this.source = source;\n    this.mapping = mapping;\n    \n    this.activityListeners = [];\n    this.busy = 0;\n}\n\nMappedFeatureSource.prototype.addActivityListener = function(listener) {\n    this.activityListeners.push(listener);\n};\n\nMappedFeatureSource.prototype.removeActivityListener = function(listener) {\n    var idx = arrayIndexOf(this.activityListeners, listener);\n    if (idx >= 0)\n        this.activityListeners.splice(idx, 0);\n};\n\nMappedFeatureSource.prototype.notifyActivity = function() {\n    for (var li = 0; li < this.activityListeners.length; ++li) {\n        try {\n            this.activityListeners[li](this.busy);\n        } catch (e) {\n            console.log(e);\n        }\n    }\n};\n\nMappedFeatureSource.prototype.getStyleSheet = function(callback) {\n    return this.source.getStyleSheet(callback);\n};\n\nMappedFeatureSource.prototype.getScales = function() {\n    return this.source.getScales();\n};\n\nMappedFeatureSource.prototype.getDefaultFIPs = function(callback) {\n    if (this.source.getDefaultFIPs)\n        return this.source.getDefaultFIPs(callback);\n};\n\nMappedFeatureSource.prototype.simplifySegments = function(segs, minGap) {\n    if (segs.length === 0) return segs;\n\n    segs.sort(function(s1, s2) {\n        var d = s1.name - s2.name;\n        if (d)\n            return d;\n        d = s1.start - s2.start;\n        if (d)\n            return d;\n        return s1.end - s2.end;   // Should never come to this...?\n    });\n\n    var ssegs = [];\n    var currentSeg = segs[0];\n    for (var si = 0; si < segs.length; ++si) {\n        var ns = segs[si];\n\n        // console.log(ns.name + ' ' + ns.start + ' ' + ns.end);\n        if (ns.name != currentSeg.name || ns.start > (currentSeg.end + minGap)) {\n            ssegs.push(currentSeg);\n            currentSeg = ns;\n        } else {\n            currentSeg = new DASSegment(currentSeg.name, Math.min(currentSeg.start, ns.start), Math.max(currentSeg.end, ns.end));\n        }\n    }\n    ssegs.push(currentSeg);\n    return ssegs;\n};\n\nMappedFeatureSource.prototype.fetch = function(chr, min, max, scale, types, pool, callback, styleFilters) {\n    var thisB = this;\n    var fetchLength = max - min + 1;\n\n    thisB.busy++;\n    thisB.notifyActivity();\n\n    this.mapping.sourceBlocksForRange(chr, min, max, function(mseg) {\n        if (mseg.length === 0) {\n            thisB.busy--;\n            thisB.notifyActivity();\n\n            callback(\"No mapping available for this regions\", [], scale);\n        } else {\n            mseg = thisB.simplifySegments(mseg, Math.max(100, 0.05 * fetchLength));\n\n            var mappedFeatures = [];\n            var mappedLoc = null;\n            var count = mseg.length;\n            var finalStatus;\n\n            mseg.map(function(seg) {\n                thisB.source.fetch(seg.name, seg.start, seg.end, scale, types, pool, function(status, features, fscale) {\n                    if (status && !finalStatus)\n                        finalStatus = status;\n\n                    if (features) {\n                        for (var fi = 0; fi < features.length; ++fi) {\n                            var f = features[fi];\n                            var sn = f.segment;\n                            if (sn.indexOf('chr') === 0) {\n                                sn = sn.substr(3);\n                            }\n\n                            var mappings = thisB.mapping.mapSegment(sn, f.min, f.max);\n\n                            if (mappings.length === 0) {\n                                if (f.parts && f.parts.length > 0) {\n                                     mappedFeatures.push(f);\n                                }\n                            } else {\n                                for (var mi = 0; mi < mappings.length; ++mi) {\n                                    var m = mappings[mi];\n                                    var mf = shallowCopy(f);\n                                    mf.segment = m.segment;\n                                    mf.min = m.min;\n                                    mf.max = m.max;\n                                    if (m.partialMin)\n                                        mf.partialMin = m.partialMin;\n                                    if (m.partialMax)\n                                        mf.partialMax = m.partialMax;\n\n                                    if (m.flipped) {\n                                        if (f.orientation == '-') {\n                                            mf.orientation = '+';\n                                        } else if (f.orientation == '+') {\n                                            mf.orientation = '-';\n                                        }\n                                    }\n                                    mappedFeatures.push(mf);\n                                }\n                            }\n                        }\n                    }\n\n                    var m1 = thisB.mapping.mapPoint(seg.name, seg.start);\n                    var m2 = thisB.mapping.mapPoint(seg.name, seg.end);\n\n                    if (m1 && m2) {\n                        var segDestCoverage = new Range(m1.pos, m2.pos);\n                        if (mappedLoc)\n                            mappedLoc = union(mappedLoc, segDestCoverage);\n                        else\n                            mappedLoc = segDestCoverage;\n                    }\n\n                    --count;\n                    if (count === 0) {\n                        thisB.busy--;\n                        thisB.notifyActivity();\n                        callback(finalStatus, mappedFeatures, fscale, mappedLoc);\n                    }\n                }, styleFilters);\n            });\n        }\n    });\n};\n\nfunction DummyFeatureSource() {\n}\n\nDummyFeatureSource.prototype.getScales = function() {\n    return null;\n};\n\nDummyFeatureSource.prototype.fetch = function(chr, min, max, scale, types, pool, cnt) {\n    return cnt(null, [], 1000000000);\n};\n\nDummyFeatureSource.prototype.getStyleSheet = function(callback) {\n    var stylesheet = new DASStylesheet();\n    var defStyle = new DASStyle();\n    defStyle.glyph = 'BOX';\n    defStyle.BGCOLOR = 'blue';\n    defStyle.FGCOLOR = 'black';\n    stylesheet.pushStyle({type: 'default'}, null, defStyle);\n    return callback(stylesheet);\n};\n\nfunction DummySequenceSource() {\n}\n\nDummySequenceSource.prototype.fetch = function(chr, min, max, pool, cnt) {\n    return cnt(null, null);\n};\n\nfunction JBrowseFeatureSource(source) {\n    this.store = new JBrowseStore(source.jbURI, source.jbQuery);\n}\n\nJBrowseFeatureSource.prototype.getScales = function() {\n    return null;\n};\n\nJBrowseFeatureSource.prototype.getStyleSheet = function(callback) {\n    var stylesheet = new DASStylesheet();\n    \n    var cdsStyle = new DASStyle();\n    cdsStyle.glyph = 'BOX';\n    cdsStyle.FGCOLOR = 'black';\n    cdsStyle.BGCOLOR = 'red';\n    cdsStyle.HEIGHT = 10;\n    cdsStyle.BUMP = true;\n    cdsStyle.ZINDEX = 20;\n    stylesheet.pushStyle({type: 'translation'}, null, cdsStyle);\n    \n    var tsStyle = new DASStyle();\n    tsStyle.glyph = 'BOX';\n    tsStyle.FGCOLOR = 'black';\n    tsStyle.BGCOLOR = 'white';\n    tsStyle.HEIGHT = 10;\n    tsStyle.ZINDEX = 10;\n    tsStyle.BUMP = true;\n    tsStyle.LABEL = true;\n    stylesheet.pushStyle({type: 'transcript'}, null, tsStyle);\n\n    var wigStyle = new DASStyle();\n    wigStyle.glyph = 'BOX';\n    wigStyle.FGCOLOR = 'black';\n    wigStyle.BGCOLOR = 'green';\n    wigStyle.HEIGHT = 8;\n    wigStyle.BUMP = true;\n    wigStyle.LABEL = true;\n    wigStyle.ZINDEX = 20;\n    stylesheet.pushStyle({type: 'default'}, null, wigStyle);\n\n    return callback(stylesheet);\n};\n\nJBrowseFeatureSource.prototype.fetch = function(chr, min, max, scale, types, pool, callback) {\n    if (types && types.length === 0) {\n        callback(null, [], scale);\n        return;\n    }\n    \n    var fops = {};\n\n    this.store.features(\n        new DASSegment(chr, min, max),\n        fops,\n        function(features, status) {\n            callback(status, features, 100000);\n        }\n    );\n};\n\nBrowser.prototype.sourceAdapterIsCapable = function(s, cap) {\n    if (!s.capabilities)\n        return false;\n    else return s.capabilities()[cap];\n};\n\nif (typeof(module) !== 'undefined') {\n    module.exports = {\n        FeatureSourceBase: FeatureSourceBase,\n\n        TwoBitSequenceSource: TwoBitSequenceSource,\n        EnsemblSequenceSource: EnsemblSequenceSource,\n        EnsemblProteinSequenceSource: EnsemblProteinSequenceSource,\n        DASSequenceSource: DASSequenceSource,\n        MappedFeatureSource: MappedFeatureSource,\n        CachingFeatureSource: CachingFeatureSource,\n        BWGFeatureSource: BWGFeatureSource,\n        RemoteBWGFeatureSource: RemoteBWGFeatureSource,\n        BAMFeatureSource: BAMFeatureSource,\n        RemoteBAMFeatureSource: RemoteBAMFeatureSource,\n        CRAMFeatureSource: CRAMFeatureSource,\n        RemoteCRAMFeatureSource: RemoteCRAMFeatureSource,\n        DummyFeatureSource: DummyFeatureSource,\n        DummySequenceSource: DummySequenceSource,\n\n        registerSourceAdapterFactory: dalliance_registerSourceAdapterFactory,\n        registerParserFactory: dalliance_registerParserFactory,\n        makeParser: dalliance_makeParser\n    };\n\n    // Standard set of plugins.\n    require('./ensembljson');\n    require('./tabix-source');\n    require('./memstore');\n    require('./bedwig');\n    require('./vcf');\n    require('./test-source');\n}\n","/* -*- mode: javascript; c-basic-offset: 4; indent-tabs-mode: nil -*- */\n\n// \n// Dalliance Genome Explorer\n// (c) Thomas Down 2006-2015\n//\n// sourcecompare.js\n//\n\n\nfunction sourceDataURI(conf) {\n    if (conf.uri) {\n        return conf.uri;\n    } else if (conf.blob) {\n        return 'file:' + conf.blob.name;\n    } else if (conf.bwgBlob) {\n        return 'file:' + conf.bwgBlob.name;\n    } else if (conf.bamBlob) {\n        return 'file:' + conf.bamBlob.name;\n    } else if (conf.twoBitBlob) {\n        return 'file:' + conf.twoBitBlob.name;\n    }\n\n    return conf.bwgURI || conf.bamURI || conf.jbURI || conf.twoBitURI || 'https://www.biodalliance.org/magic/no_uri';\n}\n\nfunction sourceStyleURI(conf) {\n    if (conf.stylesheet_uri)\n        return conf.stylesheet_uri;\n    else if (conf.tier_type == 'sequence' || conf.twoBitURI || conf.twoBitBlob)\n        return 'https://www.biodalliance.org/magic/sequence'\n    else\n        return sourceDataURI(conf);\n}\n\nfunction sourcesAreEqualModuloStyle(a, b) {\n    if (sourceDataURI(a) != sourceDataURI(b))\n        return false;\n\n    if (a.mapping != b.mapping)\n        return false;\n\n    if (a.tier_type != b.tier_type)\n        return false;\n\n    if (a.overlay) {\n        if (!b.overlay || b.overlay.length != a.overlay.length)\n            return false;\n        for (var oi = 0; oi < a.overlay.length; ++oi) {\n            if (!sourcesAreEqualModuloStyle(a.overlay[oi], b.overlay[oi]))\n                return false;\n        }\n    } else {\n        if (b.overlay)\n            return false;\n    }\n\n    return true;\n}\n\nfunction sourcesAreEqual(a, b) {\n    if (sourceDataURI(a) != sourceDataURI(b) ||\n        sourceStyleURI(a) != sourceStyleURI(b))\n        return false;\n\n    if (a.mapping != b.mapping)\n        return false;\n\n    if (a.tier_type != b.tier_type)\n        return false;\n\n    if (a.overlay) {\n        if (!b.overlay || b.overlay.length != a.overlay.length)\n            return false;\n        for (var oi = 0; oi < a.overlay.length; ++oi) {\n            if (!sourcesAreEqual(a.overlay[oi], b.overlay[oi]))\n                return false;\n        }\n    } else {\n        if (b.overlay)\n            return false;\n    }\n\n    return true;\n}\n\nif (typeof(module) !== 'undefined') {\n    module.exports = {\n        sourcesAreEqual: sourcesAreEqual,\n        sourcesAreEqualModuloStyle: sourcesAreEqualModuloStyle,\n        sourceDataURI: sourceDataURI,\n        sourceStyleURI: sourceStyleURI\n    };\n}\n","/* -*- mode: javascript; c-basic-offset: 4; indent-tabs-mode: nil -*- */\n\n// \n// Dalliance Genome Explorer\n// (c) Thomas Down 2006-2010\n//\n// spans.js: JavaScript Intset/Location port.\n//\n\n\"use strict\";\n\n\nfunction Range(min, max)\n{\n    if (typeof(min) != 'number' || typeof(max) != 'number')\n        throw 'Bad range ' + min + ',' + max;\n    this._min = min;\n    this._max = max;\n}\n\nRange.prototype.min = function() {\n    return this._min;\n}\n\nRange.prototype.max = function() {\n    return this._max;\n}\n\nRange.prototype.contains = function(pos) {\n    return pos >= this._min && pos <= this._max;\n}\n\nRange.prototype.isContiguous = function() {\n    return true;\n}\n\nRange.prototype.ranges = function() {\n    return [this];\n}\n\nRange.prototype._pushRanges = function(ranges) {\n    ranges.push(this);\n}\n\nRange.prototype.toString = function() {\n    return '[' + this._min + '-' + this._max + ']';\n}\n\nfunction _Compound(ranges) {\n    // given: a set of unsorted possibly overlapping ranges\n    // sort the input ranges\n    var sorted = ranges.sort(_rangeOrder);\n    // merge overlaps between adjacent ranges\n    var merged = [];\n    var current = sorted.shift();\n    sorted.forEach(function(range) {\n        if (range._min <= current._max) {\n            if (range._max > current._max) {\n                current._max = range._max;\n            }\n        }\n        else {\n            merged.push(current);\n            current = range;\n        }\n    });\n    merged.push(current);\n    this._ranges = merged;\n}\n\n_Compound.prototype.min = function() {\n    return this._ranges[0].min();\n}\n\n_Compound.prototype.max = function() {\n    return this._ranges[this._ranges.length - 1].max();\n}\n\n// returns the index of the first range that is not less than pos\n_Compound.prototype.lower_bound = function(pos) {\n    // first check if pos is out of range\n    var r = this.ranges();\n    if (pos > this.max()) return r.length;\n    if (pos < this.min()) return 0;\n    // do a binary search\n    var a=0, b=r.length - 1;\n    while (a <= b) {\n        var m = Math.floor((a+b)/2);\n        if (pos > r[m]._max) {\n            a = m+1;\n        }\n        else if (pos < r[m]._min) {\n            b = m-1;\n        }\n        else {\n            return m;\n        }\n    }\n    return a;\n}\n\n_Compound.prototype.contains = function(pos) {\n    var lb = this.lower_bound(pos);\n    if (lb < this._ranges.length && this._ranges[lb].contains(pos)) {\n        return true;\n    }\n    return false;\n}\n\n_Compound.prototype.insertRange = function(range) {\n    var lb = this.lower_bound(range._min);\n    if (lb === this._ranges.length) { // range follows this\n        this._ranges.push(range);\n        return;\n    }\n    \n    var r = this.ranges();\n    if (range._max < r[lb]._min) { // range preceeds lb\n        this._ranges.splice(lb,0,range);\n        return;\n    }\n\n    // range overlaps lb (at least)\n    if (r[lb]._min < range._min) range._min = r[lb]._min;\n    var ub = lb+1;\n    while (ub < r.length && r[ub]._min <= range._max) {\n        ub++;\n    }\n    ub--;\n    // ub is the upper bound of the new range\n    if (r[ub]._max > range._max) range._max = r[ub]._max;\n    \n    // splice range into this._ranges\n    this._ranges.splice(lb,ub-lb+1,range);\n    return;\n}\n\n_Compound.prototype.isContiguous = function() {\n    return this._ranges.length > 1;\n}\n\n_Compound.prototype.ranges = function() {\n    return this._ranges;\n}\n\n_Compound.prototype._pushRanges = function(ranges) {\n    for (var ri = 0; ri < this._ranges.length; ++ri)\n        ranges.push(this._ranges[ri]);\n}\n\n_Compound.prototype.toString = function() {\n    var s = '';\n    for (var r = 0; r < this._ranges.length; ++r) {\n        if (r>0) {\n            s = s + ',';\n        }\n        s = s + this._ranges[r].toString();\n    }\n    return s;\n}\n\nfunction union(s0, s1) {\n    if (! (s0 instanceof _Compound)) {\n        if (! (s0 instanceof Array))\n            s0 = [s0];\n        s0 = new _Compound(s0);\n    }\n    \n    if (s1)\n        s0.insertRange(s1);\n\n    return s0;\n}\n\nfunction intersection(s0, s1) {\n    var r0 = s0.ranges();\n    var r1 = s1.ranges();\n    var l0 = r0.length, l1 = r1.length;\n    var i0 = 0, i1 = 0;\n    var or = [];\n\n    while (i0 < l0 && i1 < l1) {\n        var s0 = r0[i0], s1 = r1[i1];\n        var lapMin = Math.max(s0.min(), s1.min());\n        var lapMax = Math.min(s0.max(), s1.max());\n        if (lapMax >= lapMin) {\n            or.push(new Range(lapMin, lapMax));\n        }\n        if (s0.max() > s1.max()) {\n            ++i1;\n        } else {\n            ++i0;\n        }\n    }\n    \n    if (or.length == 0) {\n        return null; // FIXME\n    } else if (or.length == 1) {\n        return or[0];\n    } else {\n        return new _Compound(or);\n    }\n}\n\nfunction coverage(s) {\n    var tot = 0;\n    var rl = s.ranges();\n    for (var ri = 0; ri < rl.length; ++ri) {\n        var r = rl[ri];\n        tot += (r.max() - r.min() + 1);\n    }\n    return tot;\n}\n\n\n\nfunction rangeOrder(a, b)\n{\n    if (a.min() < b.min()) {\n        return -1;\n    } else if (a.min() > b.min()) {\n        return 1;\n    } else if (a.max() < b.max()) {\n        return -1;\n    } else if (b.max() > a.max()) {\n        return 1;\n    } else {\n        return 0;\n    }\n}\n\nfunction _rangeOrder(a, b)\n{\n    if (a._min < b._min) {\n        return -1;\n    } else if (a._min > b._min) {\n        return 1;\n    } else if (a._max < b._max) {\n        return -1;\n    } else if (b._max > a._max) {\n        return 1;\n    } else {\n        return 0;\n    }\n}\n\nif (typeof(module) !== 'undefined') {\n    module.exports = {\n        Range: Range,\n        union: union,\n        intersection: intersection,\n        coverage: coverage,\n        rangeOver: rangeOrder,\n        _rangeOrder: _rangeOrder\n    }\n}","/* -*- mode: javascript; c-basic-offset: 4; indent-tabs-mode: nil -*- */\n\n// \n// Dalliance Genome Explorer\n// (c) Thomas Down 2014\n//\n// style.js\n//\n\n\"use strict\";\n\nfunction StyleFilter(type, method, label) {\n    this.type = type;\n    this.method = method;\n    this.label = label;\n}\n\nStyleFilter.prototype.equals = function(o) {\n    return this.type == o.type && this.method == o.method && this.label == o.label;\n}\n\nStyleFilter.prototype.toString = function() {\n    var fs = [];\n    if (this.type) \n        fs.push('type=' + this.type);\n    if (this.method)\n        fs.push('method=' + this.method);\n    if (this.label)\n        fs.push('label=' + this.label);\n    return 'StyleFilter<' + fs.join(';') + '>';\n}\n\nfunction StyleFilterSet(filters) {\n    this._filters = {};\n    if (filters) {\n        for (var fi = 0; fi < filters.length; ++fi) {\n            this.add(filters[fi]);\n        }\n    }\n}\n\nStyleFilterSet.prototype.add = function(filter) {\n    var fs = filter.toString();\n    if (!this._filters[fs]) {\n        this._filters[fs] = filter;\n        this._list = null;\n    }\n}\n\nStyleFilterSet.prototype.addAll = function(filterSet) {\n    var l = filterSet.list();\n    for (var fi = 0; fi < l.length; ++fi) {\n        this.add(l[fi]);\n    }\n}\n\nStyleFilterSet.prototype.doesNotContain = function(filterSet) {\n    var l = filterSet.list();\n    for (var fi = 0; fi < l.length; ++fi) {\n        if (!this._filters[fi.toString()])\n            return true;\n    }\n    return false\n}\n\nStyleFilterSet.prototype.list = function() {\n    if (!this._list) {\n        this._list = [];\n        for (var k in this._filters) {\n            if (this._filters.hasOwnProperty(k)) {\n                this._list.push(this._filters[k]);\n            }\n        }\n    }\n    return this._list;\n}\n\nStyleFilterSet.prototype.typeList = function() {\n    var types = [];\n    var list = this.list();\n    for (var fi = 0; fi < list.length; ++fi) {\n        var filter = list[fi];\n        var type = filter.type;\n        if (!type || type == 'default')\n            return null;\n        if (types.indexOf(type) < 0)\n            types.push(type);\n    }\n    return types;\n}\n\nif (typeof(module) !== 'undefined') {\n    module.exports = {\n        StyleFilter: StyleFilter,\n        StyleFilterSet: StyleFilterSet\n    };\n}\n","/* jshint esversion: 6 */\n\"use strict\";\n\nexport { renderTier, drawTier };\n\n/* To be used by tiers which are to be drawn in a multitier\n   using the multi-renderer.\n\n   Subtiers are configured by adding the following to a tier's source configuration:\n       renderer: 'sub',\n       sub: {\n           multi_id: \"multi_1\",\n           offset: 130,\n           z: 2,\n       }\n   This would define a subtier that's to be rendered in the multi-tier with\n   id \"multi_1\", with the top of the subtier at 130 pixels and at z-index 2.\n */\n\nfunction renderTier(status, tier) {\n    drawTier(tier);\n    tier.updateStatus(status);\n}\n\n// drawTier is called when this tier's data has been fetched,\n// so by refreshing the multiTier from here, we can be sure that\n// there's something new worth drawing in it\nfunction drawTier(tier) {\n    let browser = tier.browser;\n\n    let multiTier = browser.tiers.\n            filter(t => t.dasSource.renderer === 'multi' &&\n                   t.dasSource.multi.multi_id === tier.dasSource.sub.multi_id);\n\n    multiTier.forEach(t => browser.refreshTier(t));\n}\n","/* -*- mode: javascript; c-basic-offset: 4; indent-tabs-mode: nil -*- */\n\n// \n// Dalliance Genome Explorer\n// (c) Thomas Down 2006-2013\n//\n// svg-export.js\n//\n\nif (typeof(require) !== 'undefined') {\n    var browser = require('./cbrowser');\n    var Browser = browser.Browser;\n\n    var utils = require('./utils');\n    var makeElement = utils.makeElement;\n    var makeElementNS = utils.makeElementNS;\n\n    var VERSION = require('./version');\n\n    var svgSeqTier = require('./sequence-draw').svgSeqTier;\n\n    var svgu = require('./svg-utils');\n    var NS_SVG = svgu.NS_SVG;\n    var NS_XLINK = svgu.NS_XLINK;\n    var SVGPath = svgu.SVGPath;\n\n    var nf = require('./numformats');\n    var formatQuantLabel = nf.formatQuantLabel;\n    var formatLongInt = nf.formatLongInt;\n}\n\n\nBrowser.prototype.makeSVG = function(opts) {\n    opts = opts || {};\n    var minTierHeight = opts.minTierHeight || 20;\n    var padding = 3;\n    var fpw = opts.width || this.featurePanelWidth;\n\n    var backupFPW = this.featurePanelWidth;\n    var backupScale = this.scale;\n    this.featurePanelWidth = fpw;\n    this.scale = this.featurePanelWidth / (this.viewEnd - this.viewStart);\n\n    var b = this;\n    var saveDoc = document.implementation.createDocument(NS_SVG, 'svg', null);\n\n    var saveRoot = makeElementNS(NS_SVG, 'g', null, {\n        fontFamily: 'helvetica',\n        fontSize: '8pt'\n    });\n    saveDoc.documentElement.appendChild(saveRoot);\n\n    var margin = 200;\n\n    if (opts.banner) {\n      var dallianceAnchor = makeElementNS(NS_SVG, 'a',\n         makeElementNS(NS_SVG, 'text', 'Graphics from Biodalliance ' + VERSION, {\n             x: (b.featurePanelWidth + margin) - 100,\n             y: 35,\n             strokeWidth: 0,\n             fontSize: '12pt',\n\t     textAnchor: 'end',\n\t     fill: 'blue'\n         }));\n      dallianceAnchor.setAttribute('xmlns:xlink', NS_XLINK);\n      dallianceAnchor.setAttribute('xlink:href', 'http://www.biodalliance.org/');\n\n      saveRoot.appendChild(dallianceAnchor);\n    }\n  \n    if (opts.region) {\n        saveRoot.appendChild(\n            makeElementNS(NS_SVG, 'text', this.chr + ':' + formatLongInt(this.viewStart) + '..' + formatLongInt(this.viewEnd), {\n                x: margin + 100,\n                y: 35,\n                strokeWidth: 0,\n                fontSize: '12pt',\n                textAnchor: 'start'\n            })\n        );\n    }\n    \n    var clipRect = makeElementNS(NS_SVG, 'rect', null, {\n    \tx: margin,\n    \ty: 50,\n    \twidth: b.featurePanelWidth,\n    \theight: 100000\n    });\n    var clip = makeElementNS(NS_SVG, 'clipPath', clipRect, {id: 'featureClip'});\n    saveRoot.appendChild(clip);\n\n    var pos = 70;\n    var tierHolder = makeElementNS(NS_SVG, 'g', null, {});\n\n    for (var ti = 0; ti < b.tiers.length; ++ti) {\n        var tier = b.tiers[ti];\n        tier.backupSubtiers = tier.subtiers;\n        tier.backupOriginHaxx = tier.originHaxx;\n        tier.backupLayoutHeight = tier.layoutHeight;\n\n        const renderer = b.getTierRenderer(tier);\n        if (renderer && renderer.prepareSubtiers) {\n            renderer.prepareSubtiers(tier, tier.viewport.getContext('2d'));\n        }\n\n        var tierSVG = makeElementNS(NS_SVG, 'g', null, {clipPath: 'url(#featureClip)', clipRule: 'nonzero'});\n    \tvar tierLabels = makeElementNS(NS_SVG, 'g');\n    \tvar tierTopPos = pos;\n\n    \tvar tierBackground = makeElementNS(NS_SVG, 'rect', null, {x: 0, y: tierTopPos, width: '10000', height: 50, fill: tier.background});\n    \ttierSVG.appendChild(tierBackground);\n\n    \tif (tier.sequenceSource) {\n    \t    var seqTrack = svgSeqTier(tier, tier.currentSequence);\n    \t    \n    \t    tierSVG.appendChild(makeElementNS(NS_SVG, 'g', seqTrack, {transform: 'translate(' + (margin) + ', ' + pos + ')'}));\n    \t    pos += 80;\n    \t} else {\n            if (!tier.subtiers) {\n    \t\t   continue;\n            }\n    \t\n    \t    var offset = ((tier.glyphCacheOrigin - b.viewStart) * b.scale);\n            var hasQuant = false;\n            for (var sti = 0; sti < tier.subtiers.length; ++sti) {\n                pos += padding;\n        \t\tvar subtier = tier.subtiers[sti];\n                    \n        \t\tvar glyphElements = [];\n        \t\tfor (var gi = 0; gi < subtier.glyphs.length; ++gi) {\n                    var glyph = subtier.glyphs[gi];\n                    glyphElements.push(glyph.toSVG());\n        \t\t}\n\n    \t\t    tierSVG.appendChild(makeElementNS(NS_SVG, 'g', glyphElements, {transform: 'translate(' + (margin+offset) + ', ' + pos + ')'}));\n\n        \t\tif (subtier.quant) {\n                    hasQuant = true;\n        \t\t    var q = subtier.quant;\n                    var h = subtier.height;\n\n                    var numTics = 2;\n                    if (h > 40) {\n                        numTics = 1 + ((h/20) | 0);\n                    }\n                    var ticSpacing = h / (numTics - 1);\n                    var ticInterval = (q.max - q.min) / (numTics - 1);\n\n        \t\t    var path = new SVGPath();\n        \t\t    path.moveTo(margin + 5, pos);\n        \t\t    path.lineTo(margin, pos);\n        \t\t    path.lineTo(margin, pos + subtier.height);\n        \t\t    path.lineTo(margin + 5, pos + subtier.height);\n                    for (var t = 1; t < numTics-1; ++t) {\n                        var ty = t*ticSpacing;\n                        path.moveTo(margin, pos + ty);\n                        path.lineTo(margin+3, pos + ty);\n                    }\n\n        \t\t    tierLabels.appendChild(makeElementNS(NS_SVG, 'path', null, {d: path.toPathData(), fill: 'none', stroke: 'black', strokeWidth: '2px'}));\n        \t\t    tierLabels.appendChild(makeElementNS(NS_SVG, 'text', formatQuantLabel(q.max), {x: margin - 3, y: pos + 7, textAnchor: 'end'}));\n        \t\t    tierLabels.appendChild(makeElementNS(NS_SVG, 'text', formatQuantLabel(q.min), {x: margin - 3, y: pos +  subtier.height, textAnchor: 'end'}));\n                    for (var t = 1; t < numTics-1; ++t) {\n                        var ty = t*ticSpacing;\n                        tierLabels.appendChild(makeElementNS(NS_SVG, 'text', formatQuantLabel((1.0*q.max) - (t*ticInterval)), \n                            {x: margin - 3, y: pos +  ty + 3, textAnchor: 'end'}));\n                    }\n        \t\t}\n\n    \t\t    pos += subtier.height + padding;\n            }\n\n            if (pos - tierTopPos < minTierHeight) {\n                pos = tierTopPos + minTierHeight;\n            }\n    \t}\n\n        var labelName;\n        if (typeof tier.config.name === 'string')\n            labelName = tier.config.name;\n        else\n            labelName = tier.dasSource.name;\n    \ttierLabels.appendChild(\n    \t    makeElementNS(\n    \t\tNS_SVG, 'text',\n    \t\tlabelName,\n    \t\t{x: margin - (hasQuant ? 20 : 12), y: (pos+tierTopPos+8)/2, fontSize: '10pt', textAnchor: 'end'}));\n\n    \t\n    \ttierBackground.setAttribute('height', pos - tierTopPos);\n    \ttierHolder.appendChild(makeElementNS(NS_SVG, 'g', [tierSVG, tierLabels]));\n\n        tier.subtiers = tier.backupSubtiers;\n        tier.originHaxx = tier.backupOriginHaxx;\n        tier.layoutHeight = tier.backupLayoutHeight;\n    }\n\n    if (opts.highlights) {\n        var highlights = this.highlights || [];\n        for (var hi = 0; hi < highlights.length; ++hi) {\n            var h = highlights[hi];\n            if ((h.chr == this.chr || h.chr == ('chr' + this.chr)) && h.min < this.viewEnd && h.max > this.viewStart) {\n                var tmin = (Math.max(h.min, this.viewStart) - this.viewStart) * this.scale;\n                var tmax = (Math.min(h.max, this.viewEnd) - this.viewStart) * this.scale;\n\n                tierHolder.appendChild(makeElementNS(NS_SVG, 'rect', null, {x: margin + tmin, y: 70, width: (tmax-tmin), height: pos-70,\n                                                                      stroke: 'none', fill: this.defaultHighlightFill, fillOpacity: this.defaultHighlightAlpha}));\n            }\n        }\n    }\n\n    var rulerPos = -1; \n    if (opts.ruler == 'center') {\n        rulerPos = margin + ((this.viewEnd - this.viewStart)*this.scale) / 2;\n    } else if (opts.ruler == 'left') {\n        rulerPos = margin;\n    } else if (opts.ruler == 'right') {\n        rulerPos = margin + ((this.viewEnd - this.viewStart)*this.scale);\n    }\n    if (rulerPos >= 0) {\n        tierHolder.appendChild(makeElementNS(NS_SVG, 'line', null, {x1: rulerPos, y1: 70, x2: rulerPos, y2: pos,\n                                                              stroke: 'blue'}));\n    }\n\n    saveRoot.appendChild(tierHolder);\n    saveDoc.documentElement.setAttribute('width', b.featurePanelWidth + 20 + margin);\n    saveDoc.documentElement.setAttribute('height', pos + 50);\n\n    \n    this.featurePanelWidth = backupFPW;\n    this.scale = backupScale;\n\n    let svg;\n    if (typeof(XMLSerializer) !== 'undefined') {\n        svg = new XMLSerializer().serializeToString(saveDoc);\n    } else {\n        const root = saveDoc.documentElement;\n        root.setAttribute('xmlns', 'http://www.w3.org/2000/svg');\n        svg = root.outerHTML;\n    }\n\n    if (opts.output && opts.output === 'string') {\n        return svg;\n    } else {\n        return new Blob([svg], {type: 'image/svg+xml'});\n    }\n}\n","/* -*- mode: javascript; c-basic-offset: 4; indent-tabs-mode: nil -*- */\n\n// \n// Dalliance Genome Explorer\n// (c) Thomas Down 2006-2014\n//\n// svg-utils.js\n//\n\nvar NS_SVG = 'http://www.w3.org/2000/svg';\nvar NS_XLINK = 'http://www.w3.org/1999/xlink';\n\nfunction SVGPath() {\n    this.ops = [];\n}\n\nSVGPath.prototype.moveTo = function(x, y) {\n    this.ops.push('M ' + x + ' ' + y);\n}\n\nSVGPath.prototype.lineTo = function(x, y) {\n    this.ops.push('L ' + x + ' ' + y);\n}\n\nSVGPath.prototype.closePath = function() {\n    this.ops.push('Z');\n}\n\nSVGPath.prototype.toPathData = function() {\n    return this.ops.join(' ');\n}\n\nif (typeof(module) !== 'undefined') {\n    module.exports = {\n        NS_SVG: NS_SVG,\n        NS_XLINK: NS_XLINK,\n        SVGPath: SVGPath\n    }\n}","/* -*- mode: javascript; c-basic-offset: 4; indent-tabs-mode: nil -*- */\n\n// \n// Dalliance Genome Explorer\n// (c) Thomas Down 2006-2013\n//\n// tabix-source.js\n//\n\n\"use strict\";\n\nif (typeof(require) !== 'undefined') {\n    var sa = require('./sourceadapters');\n    var dalliance_registerSourceAdapterFactory = sa.registerSourceAdapterFactory;\n    var dalliance_makeParser = sa.makeParser;\n    var FeatureSourceBase = sa.FeatureSourceBase;\n\n    var bin = require('./bin');\n    var URLFetchable = bin.URLFetchable;\n    var BlobFetchable = bin.BlobFetchable;\n\n    var utils = require('./utils');\n    var Awaited = utils.Awaited;\n\n    var connectTabix = require('./tabix').connectTabix;\n}\n\nfunction TabixFeatureSource(source) {\n    FeatureSourceBase.call(this);\n    this.readiness = 'Connecting';\n    this.source = source;\n\n    this.tabixHolder = new Awaited();\n    var thisB = this;\n\n\n    var parser = dalliance_makeParser(source.payload);\n    if (!parser) {\n        throw 'Unsuported tabix payload ' + source.payload;\n    } else {\n        this.parser = parser;\n    }\n\n    var data, index;\n    if (this.source.blob) {\n        data = new BlobFetchable(this.source.blob);\n        index = new BlobFetchable(this.source.indexBlob);\n    } else {\n        data = new URLFetchable(this.source.uri, {credentials: this.source.credentials, resolver: this.source.resolver});\n        index = new URLFetchable(this.source.indexURI || (this.source.uri + '.tbi'), \n                                 {credentials: this.source.credentials, resolver: this.source.resolver});\n    }\n    connectTabix(data, index, function(tabix, err) {\n        thisB.tabixHolder.provide(tabix);\n        tabix.fetchHeader(function(lines, err) {\n            if (lines) {\n                var session = parser.createSession(function() { /* Null sink because we shouldn't get records */ });\n                for (var li = 0; li < lines.length; ++li) {\n                    session.parse(lines[li]);\n                }\n                session.flush();\n            }\n        });\n        thisB.readiness = null\n        thisB.notifyReadiness();\n    });\n}\n\nTabixFeatureSource.prototype = Object.create(FeatureSourceBase.prototype);\n\nTabixFeatureSource.prototype.fetch = function(chr, min, max, scale, types, pool, callback) {\n    var thisB = this;\n    \n    thisB.busy++;\n    thisB.notifyActivity();\n    \n    this.tabixHolder.await(function(tabix) {\n        tabix.fetch(chr, min, max, function(records, error) {\n            thisB.busy--;\n            thisB.notifyActivity();\n\n            var features = [];\n            var session = thisB.parser.createSession(function(f) {features.push(f)});\n            for (var ri = 0; ri < records.length; ++ri) {\n                var f = session.parse(records[ri]);\n            }\n            session.flush();\n            callback(null, features, 1000000000);\n        });\n    });\n}\n\n\nTabixFeatureSource.prototype.getStyleSheet = function(callback) {\n    if (this.parser && this.parser.getStyleSheet)\n        this.parser.getStyleSheet(callback)\n}\n\nTabixFeatureSource.prototype.getDefaultFIPs = function(callback) {\n    if (this.parser && this.parser.getDefaultFIPs)\n        this.parser.getDefaultFIPs(callback);\n}\n\n\ndalliance_registerSourceAdapterFactory('tabix', function(source) {\n    return {features: new TabixFeatureSource(source)};\n});\n","/* -*- mode: javascript; c-basic-offset: 4; indent-tabs-mode: nil -*- */\n\n// \n// Dalliance Genome Explorer\n// (c) Thomas Down 2006-2011\n//\n// tabix.js: basic support for tabix-indexed flatfiles\n//\n\n\"use strict\";\n\nvar TABIX_MAGIC = 0x01494254;\n\nif (typeof(require) !== 'undefined') {\n    var spans = require('./spans');\n    var Range = spans.Range;\n    var union = spans.union;\n    var intersection = spans.intersection;\n\n    var bin = require('./bin');\n    var readInt = bin.readInt;\n    var readShort = bin.readShort;\n    var readByte = bin.readByte;\n    var readInt64 = bin.readInt64;\n    var readFloat = bin.readFloat;\n\n    var lh3utils = require('./lh3utils');\n    var readVob = lh3utils.readVob;\n    var unbgzf = lh3utils.unbgzf;\n    var reg2bins = lh3utils.reg2bins;\n    var Chunk = lh3utils.Chunk;\n}\n\nfunction TabixFile() {\n}\n\nfunction connectTabix(data, tbi, callback) {\n    var tabix = new TabixFile();\n    tabix.data = data;\n    tabix.tbi = tbi;\n\n    tabix.tbi.fetch(function(header) {   // Do we really need to fetch the whole thing? :-(\n        if (!header) {\n            return callback(null, \"Couldn't access Tabix\");\n        }\n\n        var unchead = unbgzf(header, header.byteLength);\n        var uncba = new Uint8Array(unchead);\n        var magic = readInt(uncba, 0);\n        if (magic != TABIX_MAGIC) {\n            return callback(null, 'Not a tabix index');\n        }\n\n        var nref = readInt(uncba, 4);\n        tabix.format = readInt(uncba, 8);\n        tabix.colSeq = readInt(uncba, 12);\n        tabix.colStart = readInt(uncba, 16);\n        tabix.colEnd = readInt(uncba, 20);\n        tabix.meta = readInt(uncba, 24);\n        tabix.skip = readInt(uncba, 28);\n        var nameLength = readInt(uncba, 32);\n\n        tabix.indices = [];\n\n        var p = 36;\n        tabix.chrToIndex = {};\n        tabix.indexToChr = [];\n        for (var i = 0; i < nref; ++i) {\n            var name = ''\n\n            while (true) {\n                var ch = uncba[p++];\n                if (ch == 0)\n                    break;\n\n                name += String.fromCharCode(ch);\n            }\n\n            tabix.chrToIndex[name] = i;\n            if (name.indexOf('chr') == 0) {\n                tabix.chrToIndex[name.substring(3)] = i;\n            } else {\n                tabix.chrToIndex['chr' + name] = i;\n            }\n            tabix.indexToChr.push(name);\n        }\n\n        var minBlockIndex = 1000000000;\n        for (var ref = 0; ref < nref; ++ref) {\n            var blockStart = p;\n            var nbin = readInt(uncba, p); p += 4;\n            for (var b = 0; b < nbin; ++b) {\n                var bin = readInt(uncba, p);\n                var nchnk = readInt(uncba, p+4);\n                p += 8 + (nchnk * 16);\n            }\n            var nintv = readInt(uncba, p); p += 4;\n            \n            var q = p;\n            for (var i = 0; i < nintv; ++i) {\n                var v = readVob(uncba, q); q += 8;\n                if (v) {\n                    var bi = v.block;\n                    if (v.offset > 0)\n                        bi += 65536;\n\n                    if (bi < minBlockIndex)\n                        minBlockIndex = bi;\n                    break;\n                }\n            }\n            p += (nintv * 8);\n\n\n            var ub = uncba;\n            if (nbin > 0) {\n                tabix.indices[ref] = new Uint8Array(unchead, blockStart, p - blockStart);\n            }                     \n        }\n\n        tabix.headerMax = minBlockIndex;\n\n        callback(tabix);\n    }, {timeout: 50000});\n}\n\n// Copy-paste from BamFile\n\nTabixFile.prototype.blocksForRange = function(refId, min, max) {\n    var index = this.indices[refId];\n    if (!index) {\n        return [];\n    }\n\n    var intBinsL = reg2bins(min, max);\n    var intBins = [];\n    for (var i = 0; i < intBinsL.length; ++i) {\n        intBins[intBinsL[i]] = true;\n    }\n    var leafChunks = [], otherChunks = [];\n\n    var nbin = readInt(index, 0);\n    var p = 4;\n    for (var b = 0; b < nbin; ++b) {\n        var bin = readInt(index, p);\n        var nchnk = readInt(index, p+4);\n        p += 8;\n        if (intBins[bin]) {\n            for (var c = 0; c < nchnk; ++c) {\n                var cs = readVob(index, p, true);\n                var ce = readVob(index, p + 8, true);\n                (bin < 4681 ? otherChunks : leafChunks).push(new Chunk(cs, ce));\n                p += 16;\n            }\n        } else {\n            p +=  (nchnk * 16);\n        }\n    }\n\n    var nintv = readInt(index, p);\n    var lowest = null;\n    var minLin = Math.min(min>>14, nintv - 1), maxLin = Math.min(max>>14, nintv - 1);\n    for (var i = minLin; i <= maxLin; ++i) {\n        var lb =  readVob(index, p + 4 + (i * 8));\n        if (!lb) {\n            continue;\n        }\n        if (!lowest || lb.block < lowest.block || lb.offset < lowest.offset) {\n            lowest = lb;\n        }\n    }\n    \n    var prunedOtherChunks = [];\n    if (lowest != null) {\n        for (var i = 0; i < otherChunks.length; ++i) {\n            var chnk = otherChunks[i];\n            if (chnk.maxv.block >= lowest.block && chnk.maxv.offset >= lowest.offset) {\n                prunedOtherChunks.push(chnk);\n            }\n        }\n    } \n    otherChunks = prunedOtherChunks;\n\n    var intChunks = [];\n    for (var i = 0; i < otherChunks.length; ++i) {\n        intChunks.push(otherChunks[i]);\n    }\n    for (var i = 0; i < leafChunks.length; ++i) {\n        intChunks.push(leafChunks[i]);\n    }\n\n    intChunks.sort(function(c0, c1) {\n        var dif = c0.minv.block - c1.minv.block;\n        if (dif != 0) {\n            return dif;\n        } else {\n            return c0.minv.offset - c1.minv.offset;\n        }\n    });\n    var mergedChunks = [];\n    if (intChunks.length > 0) {\n        var cur = intChunks[0];\n        for (var i = 1; i < intChunks.length; ++i) {\n            var nc = intChunks[i];\n            if (nc.minv.block == cur.maxv.block /* && nc.minv.offset == cur.maxv.offset */) { // no point splitting mid-block\n                cur = new Chunk(cur.minv, nc.maxv);\n            } else {\n                mergedChunks.push(cur);\n                cur = nc;\n            }\n        }\n        mergedChunks.push(cur);\n    }\n\n    return mergedChunks;\n}\n\nTabixFile.prototype.fetch = function(chr, min, max, callback) {\n    var thisB = this;\n\n    var chrId = this.chrToIndex[chr];\n    if (chrId == undefined)\n        return callback([]);\n\n    var canonicalChr = this.indexToChr[chrId];\n\n    var chunks;\n    if (chrId === undefined) {\n        chunks = [];\n    } else {\n        chunks = this.blocksForRange(chrId, min, max);\n        if (!chunks) {\n            callback(null, 'Error in index fetch');\n        }\n    }\n\n    var records = [];\n    var index = 0;\n    var data;\n\n    function tramp() {\n        if (index >= chunks.length) {\n            return callback(records);\n        } else if (!data) {\n            var c = chunks[index];\n            var fetchMin = c.minv.block;\n            var fetchMax = c.maxv.block + (1<<16); // *sigh*\n            thisB.data.slice(fetchMin, fetchMax - fetchMin).fetch(function(r) {\n                data = unbgzf(r, c.maxv.block - c.minv.block + 1);\n                return tramp();\n            });\n        } else {\n            var ba = new Uint8Array(data);\n            thisB.readRecords(ba, chunks[index].minv.offset, records, min, max, canonicalChr);\n            data = null;\n            ++index;\n            return tramp();\n        }\n    }\n    tramp();\n}\n\nTabixFile.prototype.readRecords = function(ba, offset, sink, min, max, chr) {\n   LINE_LOOP:\n    while (true) {\n        var line = '';\n        while (offset < ba.length) {\n            var ch = ba[offset++];\n            if (ch == 10) {\n                var toks = line.split('\\t');\n\n                if (toks[this.colSeq - 1] == chr) {\n                    var fmin = parseInt(toks[this.colStart - 1]);\n                    var fmax = fmin;\n                    if (this.colEnd > 0)\n                        fmax = parseInt(toks[this.colEnd - 1]);\n                    if (this.format & 0x10000) ++fmin;\n\n                    if (fmin <= max && fmax >= min)\n                        sink.push(line);\n                }\n                continue LINE_LOOP;\n            } else {\n                line += String.fromCharCode(ch);\n            }\n        }\n        return;\n    }\n}\n\nTabixFile.prototype.fetchHeader = function(callback) {\n    var self = this;\n    var fetchPtr = 0, ptr = 0, line='';\n    var lines = [];\n\n    self.data.slice(0, self.headerMax).fetch(function(chnk) {\n        if (!chnk) {\n            return callback(null, \"Fetch failed\");\n        }\n        var ba = new Uint8Array(unbgzf(chnk, chnk.byteLength));\n        var ptr = 0, line = '', lines = [];\n        while (ptr < ba.length) {\n            var ch = ba[ptr++]\n            if (ch == 10) {\n                if (line.charCodeAt(0) == self.meta) {\n                    lines.push(line);\n                    line = '';\n                } else {\n                    return callback(lines);\n                }\n            } else {\n                line += String.fromCharCode(ch);\n            }\n        }\n        callback(lines);\n    });\n}\n\nif (typeof(module) !== 'undefined') {\n    module.exports = {\n        connectTabix: connectTabix,\n        TABIX_MAGIC: TABIX_MAGIC\n    };\n}\n","/* jshint esversion: 6 */\n\n/*\n Source that can be configured to produce any type of feature,\n useful for testing renderers.\n */\n\nimport { registerSourceAdapterFactory,\n         FeatureSourceBase\n       } from \"./sourceadapters.js\";\n\nimport { DASFeature\n       } from \"./das.js\";\n\nimport * as R from \"ramda\";\n\n\nclass TestSource extends FeatureSourceBase {\n    constructor(source) {\n        super();\n\n        this.features = R.defaultTo([], source.features);\n    }\n\n    genFeature(conf) {\n        let feature = new DASFeature();\n\n        for (let key in conf) {\n            feature[key] = conf[key];\n        }\n    }\n\n    fetch(chr, min, max, scale, types, pool, callback) {\n        let features = R.forEach(this.genFeature, this.features);\n        return callback(null, features, 1);\n    }\n}\n\n\nregisterSourceAdapterFactory('test-source', source => {\n    return { features: new TestSource(source) };\n});\n","/* -*- mode: javascript; c-basic-offset: 4; indent-tabs-mode: nil -*- */\n\n// \n// Dalliance Genome Explorer\n// (c) Thomas Down 2006-2013\n//\n// thub.js: support for track-hub style registries\n//\n\n\"use strict\";\n\nif (typeof(require) !== 'undefined') {\n    var utils = require('./utils');\n    var textXHR = utils.textXHR;\n    var relativeURL = utils.relativeURL;\n    var shallowCopy = utils.shallowCopy;\n\n    var das = require('./das');\n    var DASStylesheet = das.DASStylesheet;\n    var DASStyle = das.DASStyle;\n}\n\nvar THUB_STANZA_REGEXP = /\\n\\s*\\n/;\nvar THUB_PARSE_REGEXP  = /(\\w+) +(.+)\\n?/;\nvar THUB_SUBGROUP_REGEXP = /subGroup[1-9]/;\n\nvar THUB_PENNANT_PREFIX = 'http://genome.ucsc.edu/images/';\n\nfunction TrackHub(url) {\n    this.genomes = {};\n    this.url = url;\n}\n\nfunction TrackHubTrack() {\n}\n\nTrackHubTrack.prototype.get = function(k) {\n    if (this[k])\n        return this[k];\n    else if (this._parent) \n        return this._parent.get(k);\n}\n\nfunction TrackHubDB(hub) {\n    this.hub = hub;\n}\n\nTrackHubDB.prototype.getTracks = function(callback) {\n    var thisB = this;\n    if (this._tracks) {\n        return callback(this._tracks);\n    } \n    \n    textXHR(this.absURL, function(trackFile, err) {\n        if (err) {\n            return callback(null, err);\n        }\n        \n        // trackFile = trackFile.replace(/\\#.*/g, '');\n        trackFile = trackFile.replace('\\\\\\n', ' ');\n\n        var tracks = [];\n        var tracksById = {};\n        var stanzas = trackFile.split(THUB_STANZA_REGEXP);\n        for (var s = 0; s < stanzas.length; ++s) {\n            var toks = stanzas[s].replace(/\\#.*/g, '').split(THUB_PARSE_REGEXP);\n            var track = new TrackHubTrack();\n            track._db = thisB;\n            for (var l = 0; l < toks.length - 2; l += 3) {\n                var k = toks[l+1], v = toks[l+2];\n                if (k.match(THUB_SUBGROUP_REGEXP)) {\n                    if (!track.subgroups)\n                        track.subgroups = {};\n                    var sgtoks = v.split(/\\s/);\n                    var sgtag = sgtoks[0];\n                    var sgrecord = {name: sgtoks[1], tags: [], titles: []};\n                    for (var sgti = 2; sgti < sgtoks.length; ++sgti) {\n                        var grp = sgtoks[sgti].split(/=/);\n                        sgrecord.tags.push(grp[0]);\n                        sgrecord.titles.push(grp[1]);\n                    }\n                    track.subgroups[sgtag] = sgrecord;\n                } else if (k === 'subGroups') {\n                    var sgtoks = v.split(/(\\w+)=(\\w+)/);\n                    track.sgm = {};\n                    for (var sgti = 0; sgti < sgtoks.length - 2; sgti += 3) {\n                        track.sgm[sgtoks[sgti+1]] = sgtoks[sgti + 2];\n                    }\n                } else {\n                    track[toks[l+1]] = toks[l+2];\n                }\n            }\n\n            if (track.track && (track.type || track.container || track.view || track.bigDataUrl)) {\n                tracks.push(track);\n                tracksById[track.track] = track;\n            } else {\n                // console.log('skipping ', track);\n            }\n        }\n        \n        var toplevels = [];\n        var composites = [];\n        for (var ti = 0; ti < tracks.length; ++ti) {\n            var track = tracks[ti];\n            var top = true;\n            if (track.parent) {\n                var ptoks = track.parent.split(/\\s+/);\n                var parent = tracksById[ptoks[0]];\n                if (parent) {\n                    track._parent = parent;\n\n                    if (!parent.children)\n                        parent.children = [];\n                    parent.children.push(track);\n\n                    if (parent)\n                        top = false;\n                } else {\n                    console.log(\"Couldn't find parent \" + ptoks[0] + '(' + track.parent + ')');\n                }\n               \n            }\n            if (track.compositeTrack) {\n                composites.push(track);\n            } else if (top) {\n                toplevels.push(track);\n            }\n        }\n\n        for (var ci = 0; ci < composites.length; ++ci) {\n            var comp = composites[ci];\n            if (!comp.children)\n                continue;\n\n            var parentOfViews = false;\n            for (var ki = 0; ki < comp.children.length; ++ki) {\n                var k = comp.children[ki];\n                if (k.view) {\n                    k.shortLabel = comp.shortLabel + \": \" + k.shortLabel;\n                    toplevels.push(k);\n                    parentOfViews = true;\n                }\n            }\n            if (!parentOfViews)\n                toplevels.push(comp);\n        }\n            \n        thisB._tracks = toplevels;\n        return callback(thisB._tracks, null);\n    }, {credentials: this.credentials, salt: true});\n}\n\nfunction connectTrackHub(hubURL, callback, opts) {\n    opts = opts || {};\n    opts.salt = true;\n\n    textXHR(hubURL, function(hubFile, err) {\n        if (err) {\n            return callback(null, err);\n        }\n\n        var toks = hubFile.split(THUB_PARSE_REGEXP);\n        var hub = new TrackHub(hubURL);\n        if (opts.credentials) {\n            hub.credentials = opts.credentials;\n        }\n        for (var l = 0; l < toks.length - 2; l += 3) {\n            hub[toks[l+1]] = toks[l+2];\n        }\n        \n        \n        if (hub.genomesFile) {\n            var genURL = relativeURL(hubURL, hub.genomesFile);\n            textXHR(genURL, function(genFile, err) {\n                if (err) {\n                    return callback(null, err);\n                }\n\n                var stanzas = genFile.split(THUB_STANZA_REGEXP);\n                for (var s = 0; s < stanzas.length; ++s) {\n                    var toks = stanzas[s].split(THUB_PARSE_REGEXP);\n                    var gprops = new TrackHubDB(hub);\n                    if (opts.credentials) {\n                        gprops.credentials = opts.credentials;\n                    }\n\n                    for (var l = 0; l < toks.length - 2; l += 3) {\n                        gprops[toks[l+1]] = toks[l+2];\n                    }\n\n                    if (gprops.twoBitPath) {\n                        gprops.twoBitPath = relativeURL(genURL, gprops.twoBitPath);\n                    }\n\n                    if (gprops.genome && gprops.trackDb) {\n                        gprops.absURL = relativeURL(genURL, gprops.trackDb);\n                        hub.genomes[gprops.genome] = gprops;\n                    }\n                }\n\n                callback(hub);\n                        \n            }, opts);\n        } else {\n            callback(null, 'No genomesFile');\n        }\n    }, opts);\n}\n\n\nTrackHubTrack.prototype.toDallianceSource = function() {\n    var source = {\n        name: this.shortLabel,\n        desc: this.longLabel\n    };\n    if (this._db.mapping) {\n        source.mapping = this._db.mapping;\n    }\n\n    var pennantIcon = this.get('pennantIcon');\n    if (pennantIcon) {\n        var ptoks = pennantIcon.split(/\\s+/);\n        source.pennant = THUB_PENNANT_PREFIX + ptoks[0];\n    }\n\n    var searchTrix = this.get('searchTrix');\n    if (searchTrix) {\n        source.trixURI = relativeURL(this._db.absURL, searchTrix);\n    }\n\n    if (this.container == 'multiWig') {\n        source.merge = 'concat';\n        source.overlay = [];\n        var children = this.children || [];\n        source.style = [];\n        source.noDownsample = true;\n\n        for (var ci = 0; ci < children.length; ++ci) {\n            var ch = children[ci];\n            var cs = ch.toDallianceSource()\n            source.overlay.push(cs);\n\n            if (cs.style) {\n                for (var si = 0; si < cs.style.length; ++si) {\n                    var style = cs.style[si];\n                    style.method = ch.shortLabel;  // FIXME\n                    if (this.aggregate == 'transparentOverlay')\n                        style.style.ALPHA = 0.5;\n                    source.style.push(style);\n                }\n            }\n        }\n        return source;       \n    } else {\n        var type = this.type;\n        if (!type) {\n            var p = this;\n            while (p._parent && !p.type) {\n                p = p._parent;\n            }\n            type = p.type;\n        }\n        if (!type)\n            return;\n        var typeToks = type.split(/\\s+/);\n        if (typeToks[0] == 'bigBed' && this.bigDataUrl) {\n            var bedTokens = typeToks[1]|0\n            var bedPlus = typeToks[2] == '+';\n\n            source.bwgURI = relativeURL(this._db.absURL, this.bigDataUrl);\n            source.style = this.bigbedStyles();\n            if (this._db.credentials) {\n                source.credentials = true;\n            }\n            if (bedTokens >= 12 && bedPlus)\n                source.collapseSuperGroups = true;\n            return source;\n        } else if (typeToks[0] == 'bigWig' && this.bigDataUrl) {\n            source.bwgURI = relativeURL(this._db.absURL, this.bigDataUrl);\n            source.style = this.bigwigStyles();\n            source.noDownsample = true;     // FIXME seems like a blunt instrument...\n            \n            if (this.yLineOnOff && this.yLineOnOff == 'on') {\n                source.quantLeapThreshold = this.yLineMark !== undefined ? (1.0 * this.yLineMark) : 0.0;\n            }\n\n            if (this._db.credentials) {\n                source.credentials = true;\n            }\n\n            return source;\n        } else if (typeToks[0] == 'bam'  && this.bigDataUrl) {\n            source.bamURI = relativeURL(this._db.absURL, this.bigDataUrl);\n            if (this._db.credentials) {\n                source.credentials = true;\n            }\n            return source;\n        } else if (typeToks[0] == 'cram' && this.bigDataUrl) {\n            source.cramURI = relativeURL(this._db.absURL, this.bigDataUrl);\n            if (this._db.credentials) {\n                source.credentials = true;\n            }\n            return source;\n        } else if (typeToks[0] == 'vcfTabix' && this.bigDataUrl) {\n            source.uri = relativeURL(this._db.absURL, this.bigDataUrl);\n            source.tier_type = 'tabix';\n            source.payload = 'vcf';\n            if (this._db.credentials) {\n                source.credentials = true;\n            }\n            return source;\n        } else {\n            console.log('Unsupported ' + this.type);\n        }\n    }\n}\n\nTrackHubTrack.prototype.bigwigStyles = function() {\n    var type = this.type;\n    if (!type) {\n        var p = this;\n        while (p._parent && !p.type) {\n            p = p._parent;\n        }\n        type = p.type;\n    }\n    if (!type)\n        return;\n    var typeToks = type.split(/\\s+/);\n\n    var min, max;\n    if (typeToks.length >= 3) {\n        min = 1.0 * typeToks[1];\n        max = 1.0 * typeToks[2];\n    }\n\n    var height;\n    if (this.maxHeightPixels) {\n        var mhpToks = this.maxHeightPixels.split(/:/);\n        if (mhpToks.length == 3) {\n            height = mhpToks[1] | 0;\n        } else {\n            console.log('maxHeightPixels should be of the form max:default:min');\n        }\n    }\n    \n    var gtype = 'bars';\n    if (this.graphTypeDefault) {\n        gtype = this.graphTypeDefault;\n    }\n    \n    var color = 'black';\n    var altColor = null;\n    if (this.color) {\n        color = 'rgb(' + this.color + ')';\n    }\n    if (this.altColor) {\n        altColor = 'rgb(' + this.altColor + ')';\n    }\n    \n    var stylesheet = new DASStylesheet();\n    var wigStyle = new DASStyle();\n    if (gtype == 'points') {\n        wigStyle.glyph = 'POINT';\n    } else {\n        wigStyle.glyph = 'HISTOGRAM';\n    }\n\n    if (altColor) {\n        wigStyle.COLOR1 = color;\n        wigStyle.COLOR2 = altColor;\n    } else {\n        wigStyle.BGCOLOR = color;\n    }\n    wigStyle.HEIGHT = height || 30;\n    if (min || max) {\n        wigStyle.MIN = min;\n        wigStyle.MAX = max;\n    }\n    stylesheet.pushStyle({type: 'default'}, null, wigStyle);\n    return stylesheet.styles;\n}\n\nTrackHubTrack.prototype.bigbedStyles = function() {\n    var itemRgb = (''+this.get('itemRgb')).toLowerCase() == 'on';\n    var visibility = this.get('visibility') || 'full';\n    var color = this.get('color');\n    if (color)\n        color = 'rgb(' + color + ')';\n    else \n        color = 'blue';\n    \n    var stylesheet = new DASStylesheet();\n    var wigStyle = new DASStyle();\n    wigStyle.glyph = 'BOX';\n    wigStyle.FGCOLOR = 'black';\n    wigStyle.BGCOLOR = color;\n    wigStyle.HEIGHT = (visibility == 'full' || visibility == 'pack') ? 12 : 8;\n    wigStyle.BUMP = (visibility == 'full' || visibility == 'pack');\n    wigStyle.LABEL = (visibility == 'full' || visibility == 'pack');\n    wigStyle.ZINDEX = 20;\n    if (itemRgb)\n        wigStyle.BGITEM = true;\n\n    var cbs = this.get('colorByStrand');\n    if (cbs) {\n        var cbsToks = cbs.split(/\\s+/);\n        \n        var plus = shallowCopy(wigStyle);\n        plus.BGCOLOR = 'rgb(' + cbsToks[0] + ')';\n        stylesheet.pushStyle({type: 'bigbed', orientation: '+'}, null, plus);\n\n        var minus = shallowCopy(wigStyle);\n        minus.BGCOLOR = 'rgb(' + cbsToks[1] + ')';\n        stylesheet.pushStyle({type: 'bigbed', orientation: '-'}, null, minus);\n    } else {\n        stylesheet.pushStyle({type: 'bigbed'}, null, wigStyle);\n    }   \n    \n    var tlStyle = new DASStyle();\n    tlStyle.glyph = 'BOX';\n    tlStyle.FGCOLOR = 'black';\n    if (itemRgb)\n        tlStyle.BGITEM = true;\n    tlStyle.BGCOLOR = 'red'\n    tlStyle.HEIGHT = 10;\n    tlStyle.BUMP = true;\n    tlStyle.ZINDEX = 20;\n    stylesheet.pushStyle({type: 'translation'}, null, tlStyle);\n    \n    var tsStyle = new DASStyle();\n    tsStyle.glyph = 'BOX';\n    tsStyle.FGCOLOR = 'black';\n    tsStyle.BGCOLOR = 'white';\n    tsStyle.HEIGHT = 10;\n    tsStyle.ZINDEX = 10;\n    tsStyle.BUMP = true;\n    tsStyle.LABEL = true;\n    stylesheet.pushStyle({type: 'transcript'}, null, tsStyle);\n\n    return stylesheet.styles;\n}\n\nfunction THUB_COMPARE(g, h) {\n    if (g.priority && h.priority) {\n        return (1.0 * g.priority) - (1.0 * h.priority)\n    } else if (g.priority) {\n        return 1;\n    } else if (h.priority) {\n        return -1;\n    } else {\n        return g.shortLabel.localeCompare(h.shortLabel);\n    }\n}\n\nif (typeof(module) !== 'undefined') {\n    module.exports = {\n        connectTrackHub: connectTrackHub,\n        THUB_COMPARE: THUB_COMPARE\n    };\n}\n","/* -*- mode: javascript; c-basic-offset: 4; indent-tabs-mode: nil -*- */\n\n// \n// Dalliance Genome Explorer\n// (c) Thomas Down 2006-2013\n//\n// tier-actions.js\n//\n\n\"use strict\";\n\nif (typeof(require) !== 'undefined') {\n    var browser = require('./cbrowser');\n    var Browser = browser.Browser;\n\n    var utils = require('./utils');\n    var shallowCopy = utils.shallowCopy;\n}\n\nBrowser.prototype.mergeSelectedTiers = function() {\n    var sources = [];\n    var styles = [];\n\n    for (var sti = 0; sti < this.selectedTiers.length; ++sti) {\n        var tier = this.tiers[this.selectedTiers[sti]];\n\t    sources.push(shallowCopy(tier.dasSource));\n        var ss = tier.stylesheet.styles;\n        for (var si = 0; si < ss.length; ++si) {\n            var sh = ss[si];\n            var nsh = shallowCopy(sh);\n            nsh.method = tier.dasSource.name.replace(/[()+*?]/g, '\\\\$&');\n            nsh._methodRE = null;\n            nsh.style = shallowCopy(sh.style);\n            if (nsh.style.ZINDEX === undefined)\n                nsh.style.ZINDEX = sti;\n\n            if (tier.forceMin) {\n                nsh.style.MIN = tier.forceMin;\n            }\n            if (tier.forceMax) {\n                nsh.style.MAX = tier.forceMax;\n            }\n\n            styles.push(nsh);\n        }\n    }\n    \n    this.addTier(\n\t{name: 'Merged',\n\t merge: 'concat',\n\t overlay: sources,\n\t noDownsample: true,\n     style: styles});\n\n    this.setSelectedTier(this.tiers.length - 1);\n}\n","/* -*- mode: javascript; c-basic-offset: 4; indent-tabs-mode: nil -*- */\n\n// \n// Dalliance Genome Explorer\n// (c) Thomas Down 2006-2013\n//\n// tier-edit.js\n//\n\n\"use strict\";\n\nif (typeof(require) !== 'undefined') {\n    var browser = require('./cbrowser');\n    var Browser = browser.Browser;\n\n    var utils = require('./utils');\n    var makeElement = utils.makeElement;\n\n    var das = require('./das');\n    var isDasBooleanTrue = das.isDasBooleanTrue;\n    var isDasBooleanNotFalse = das.isDasBooleanNotFalse;\n    var copyStylesheet = das.copyStylesheet;\n\n    var color = require('./color');\n    var dasColourForName = color.dasColourForName;\n\n    var sourceDataURI = require('./sourcecompare').sourceDataURI;\n}\n\nvar __dalliance_smallGlyphs = {\n    DOT: true, \n    EX: true, \n    STAR: true, \n    SQUARE: true, \n    CROSS: true, \n    TRIANGLE: true, \n    PLIMSOLL: true\n};\n\nBrowser.prototype.openTierPanel = function(tier) {\n    var b = this;\n\n    if (this.uiMode === 'tier' && this.manipulatingTier === tier) {\n        this.hideToolPanel();\n        this.setUiMode('none');\n    } else if (!tier) {\n        return;\n    } else {\n        var setStyleColors = function(style) {\n            if (style.BGGRAD)\n                return;\n\n            if (numColors == 1) {\n                if (style.glyph == 'LINEPLOT' || __dalliance_smallGlyphs[style.glyph]) {\n                    style.FGCOLOR = tierColorField.value;\n                } else {\n                    style.BGCOLOR = tierColorField.value;\n                }\n                style.COLOR1 = style.COLOR2 = style.COLOR3 = null;\n            } else {\n                style.COLOR1 = tierColorField.value;\n                style.COLOR2 = tierColorField2.value;\n                if (numColors > 2) {\n                    style.COLOR3 = tierColorField3.value;\n                } else {\n                    style.COLOR3 = null;\n                }\n            }\n            style._gradient = null;\n            style._plusColor = tierPlusColorField.value;\n            style._minusColor = tierMinusColorField.value;\n        }\n\n        var mutateStylesheet = function(visitor) {\n            var nss = copyStylesheet(tier.stylesheet);\n            var ssScale = tier.browser.zoomForCurrentScale();\n\n            for (var i = 0; i < nss.styles.length; ++i) {\n                var sh = nss.styles[i];\n                if (sh.zoom && sh.zoom != ssScale) {\n                    continue;\n                }\n\n                visitor(sh.style);\n            }\n\n            return nss;\n        }\n\n        var changeColor = function(ev) {\n            tier.mergeStylesheet(mutateStylesheet(setStyleColors));\n        }\n        \n        this.manipulatingTier = tier;\n\n        var tierForm = makeElement('div', null, {className: 'tier-edit'});\n\n        var aboutBanner = makeElement('div', \"About '\" + (tier.config.Name || tier.dasSource.name) + \"'\", null,\n                {background: 'gray', paddingBottom: '5px', marginBottom: '5px', textAlign: 'center'});\n        tierForm.appendChild(aboutBanner);\n\n        var about = makeElement('div', \n            [makeElement('p', tier.dasSource.desc)]\n        );\n        var aboutNotes = [];\n        var sduri = sourceDataURI(tier.dasSource);\n        if (sduri &&\n            (sduri.indexOf('http://') == 0 ||\n             sduri.indexOf('https://') == 0 ||\n             sduri.indexOf('//') == 0) &&\n            sduri !== 'https://www.biodalliance.org/magic/no_uri')\n        {\n            aboutNotes.push(makeElement('li', makeElement('a', '(Download data)', {href: sduri})));\n        }\n\n        if (tier.dasSource.mapping) {\n            var coords = this.chains[tier.dasSource.mapping].coords;\n            aboutNotes.push(makeElement('li',  'Mapped from ' + coords.auth + coords.version));\n        }\n\n        if (aboutNotes.length > 0) {\n            about.appendChild(makeElement('ul', aboutNotes));\n        }\n        \n        tierForm.appendChild(about);\n\n        var semanticBanner = makeElement('span', ' (styles for current zoom level)', null, {display: 'none'});\n        var editBanner = makeElement('div', ['Edit', semanticBanner], null,\n              {background: 'gray', paddingBottom: '5px', marginBottom: '5px', textAlign: 'center'});\n        tierForm.appendChild(editBanner);\n\n        var tierNameField = makeElement('input', null, {type: 'text'});\n        var tierPinnedToggle = makeElement('input', null, {type: 'checkbox', disabled: this.disablePinning});\n\n        var glyphField = makeElement('select');\n        glyphField.appendChild(makeElement('option', 'Histogram', {value: 'HISTOGRAM'}));\n        glyphField.appendChild(makeElement('option', 'Line Plot', {value: 'LINEPLOT'}));\n        glyphField.appendChild(makeElement('option', 'Ribbon', {value: 'GRADIENT'}));\n        glyphField.appendChild(makeElement('option', 'Scatter', {value: 'SCATTER'}));\n\n        var tierColorField = makeElement('input', null, {type: 'text', value: '#dd00dd'});\n        var tierColorField2 = makeElement('input', null, {type: 'text', value: '#dd00dd'});\n        var tierColorField3 = makeElement('input', null, {type: 'text', value: '#dd00dd'});\n\n        var tierPlusColorField = makeElement('input', null, {type: 'text', value: '#ffa07a'});\n        var tierMinusColorField = makeElement('input', null, {type: 'text', value: '#87cefa'});\n\n        try {\n            tierColorField.type = tierColorField2.type = tierColorField3.type = 'color';\n            tierPlusColorField.type = tierMinusColorField.type = 'color';\n        } catch (e) {\n            // IE throws if attempt to set type to 'color'.\n        }\n\n        var tierColorFields = [tierColorField, tierColorField2, tierColorField3];\n        var colorListPlus = makeElement('i', null, {className: 'fa fa-plus-circle'});\n        var colorListMinus = makeElement('i', null, {className: 'fa fa-minus-circle'});\n        var numColors = 1;\n        var colorListElement = makeElement('td', tierColorFields);\n        var setNumColors = function(n) {\n            numColors = n;\n            for (var i = 0; i < n; ++i) \n                tierColorFields[i].style.display = 'block';\n            for (var i = n; i < tierColorFields.length; ++i)\n                tierColorFields[i].style.display = 'none';\n        }\n        colorListPlus.addEventListener('click', function(ev) {\n            if (numColors < 3) {\n                setNumColors(numColors + 1);\n                changeColor(null);\n            }\n        }, false);\n        colorListMinus.addEventListener('click', function(ev) {\n            if (numColors > 1) {\n                setNumColors(numColors - 1);\n                changeColor(null);\n            }\n        }, false);\n\n        var tierMinField = makeElement('input', null, {type: 'text', value: '0.0'});\n        var tierMaxField = makeElement('input', null, {type: 'text', value: '10.0'});\n        var tierMinToggle = makeElement('input', null, {type: 'checkbox'});\n        var tierMaxToggle = makeElement('input', null, {type: 'checkbox'});\n\n        var quantLeapToggle = makeElement('input', null, {type: 'checkbox', checked: tier.quantLeapThreshold !== undefined});\n        var quantLeapThreshField = makeElement('input', null, {type: 'text', value: tier.quantLeapThreshold, disabled: !quantLeapToggle.checked});\n\n        var tierHeightField = makeElement('input', null, {type: 'text', value: '50'});\n\n        var bumpToggle = makeElement('input', null, {type: 'checkbox'});\n        var bumpLimit = makeElement('input', null, {type: 'text'});\n        var labelToggle = makeElement('input', null, {type: 'checkbox'});\n\n        var mainStyle = null;\n        if (tier.stylesheet.styles.length > 0) {\n            var s = mainStyle = tier.stylesheet.styles[0].style;\n        }\n\n        var refresh = function() {\n            if (typeof tier.config.name === 'string')\n                tierNameField.value = tier.config.name;\n            else \n                tierNameField.value = tier.dasSource.name;\n\n            tierPinnedToggle.checked = tier.pinned;\n\n            if (tier.forceHeight) {\n                tierHeightField.value = '' + tier.forceHeight;\n            } else if (mainStyle && mainStyle.HEIGHT) {\n                tierHeightField.value = '' + mainStyle.HEIGHT;\n            }\n\n            if (typeof tier.quantLeapThreshold == 'number') {\n                quantLeapToggle.checked = true;\n                quantLeapThreshField.disabled = false;\n                if (parseFloat(quantLeapThreshField.value) != tier.quantLeapThreshold)\n                    quantLeapThreshField.value = tier.quantLeapThreshold;\n            } else {\n                quantLeapToggle.checked = false;\n                quantLeapThreshField.disabled = true;\n            }\n\n            if (typeof tier.subtierMax == 'number') {\n                bumpLimit.value = '' + tier.subtierMax;\n            } else {\n                bumpLimit.value = '' + (tier.dasSource.subtierMax || tier.browser.defaultSubtierMax);\n            }\n\n            if (tier.stylesheet.styles.length > 0) {\n                var s = null;\n                var isQuantitative=false, isSimpleQuantitative = false;\n                var ssScale = tier.browser.zoomForCurrentScale();\n                var activeStyleCount = 0;\n\n                for (var si = 0; si < tier.stylesheet.styles.length; ++si) {\n                    var sh = tier.stylesheet.styles[si];  \n                    if (sh.zoom && sh.zoom != ssScale) {\n                        continue;\n                    }\n                    ++activeStyleCount;\n                    var ss = tier.stylesheet.styles[si].style;\n\n                    if (!s) {\n                        s = mainStyle = ss;\n                    }\n                    \n                    if (ss.glyph == 'LINEPLOT' || ss.glyph == 'HISTOGRAM' || ss.glyph == 'GRADIENT' || isDasBooleanTrue(ss.SCATTER)) {\n                        if (!isQuantitative)\n                            s = mainStyle = ss;\n                        isQuantitative = true;\n                    }\n                }\n                if (!s) {\n                    return;\n                }\n\n                semanticBanner.style.display = (activeStyleCount == tier.stylesheet.styles.length) ? 'none' : 'inline';\n\n                isSimpleQuantitative = isQuantitative && activeStyleCount == 1;\n                var isGradient = s.COLOR2 || s.BGGRAD;\n\n                if (isQuantitative) {\n                    minRow.style.display = 'table-row';\n                    maxRow.style.display = 'table-row';\n                    bumpRow.style.display = 'none';\n                    labelRow.style.display = 'none';\n                } else {\n                    minRow.style.display = 'none';\n                    maxRow.style.display = 'none';\n                    bumpRow.style.display = 'table-row';\n                    bumpToggle.checked = isDasBooleanTrue(mainStyle.BUMP);\n                    bumpLimit.disabled = !isDasBooleanTrue(mainStyle.BUMP);\n                    labelRow.style.display = 'table-row';\n                    labelToggle.checked = isDasBooleanTrue(mainStyle.LABEL);\n                }\n\n                if (isSimpleQuantitative) {\n                    styleRow.style.display = 'table-row';\n                    colorRow.style.display = 'table-row';\n                } else {\n                    styleRow.style.display = 'none';\n                    colorRow.style.display = 'none';\n\n                }\n\n                var numColors = 1;\n                if (s.COLOR1) {\n                    tierColorField.value = dasColourForName(s.COLOR1).toHexString();\n                    if (s.COLOR2) {\n                        tierColorField2.value = dasColourForName(s.COLOR2).toHexString();\n                        if (s.COLOR3) {\n                            tierColorField3.value = dasColourForName(s.COLOR3).toHexString();\n                            numColors = 3;\n                        } else {\n                            numColors = 2;\n                        }\n                    }\n                } else {\n                    if (s.glyph == 'LINEPLOT' || s.glyph == 'DOT' && s.FGCOLOR) {\n                        tierColorField.value = dasColourForName(s.FGCOLOR).toHexString();\n                    } else if (s.BGCOLOR) {\n                        tierColorField.value = dasColourForName(s.BGCOLOR).toHexString();\n                    }\n                } \n                setNumColors(numColors);\n\n                if (s._plusColor)\n                    tierPlusColorField.value = dasColourForName(s._plusColor).toHexString() || s._plusColor;\n                if (s._minusColor)\n                    tierMinusColorField.value = dasColourForName(s._minusColor).toHexString() || s._minusColor;\n                if (isDasBooleanTrue(s.SCATTER)) {\n                    glyphField.value = 'SCATTER';\n                } else {\n                    glyphField.value = s.glyph;\n                } \n\n                var setMinValue, setMaxValue;\n                if (s.MIN !== undefined) {\n                    var x = parseFloat(s.MIN);\n                    if (!isNaN(x))\n                        setMinValue = x;\n                }\n                if (!tier.forceMinDynamic && (s.MIN !== undefined || tier.forceMin !== undefined)) {\n                    tierMinToggle.checked = true;\n                    tierMinField.disabled = false;\n                } else {\n                    tierMinToggle.checked = false;\n                    tierMinField.disabled = true;\n                }\n\n                if (s.MAX !== undefined) {\n                    var x = parseFloat(s.MAX)\n                    if (!isNaN(x))\n                        setMaxValue = x;\n                }\n                if (!tier.forceMaxDynamic && (s.MAX !== undefined || tier.forceMax !== undefined)) {\n                    tierMaxToggle.checked = true;\n                    tierMaxField.disabled = false;\n                } else {\n                    tierMaxToggle.checked = false;\n                    tierMaxField.disabled = true;\n                }\n\n                if (tier.forceMin != undefined) {\n                    setMinValue = tier.forceMin;\n                }\n                if (tier.forceMax != undefined) {\n                    setMaxValue = tier.forceMax;\n                }\n                if (typeof(setMinValue) == 'number' && setMinValue != parseFloat(tierMinField.value)) {\n                    tierMinField.value = setMinValue;\n                }\n                if (typeof(setMaxValue) == 'number' && setMaxValue != parseFloat(tierMaxField.value)) {\n                    tierMaxField.value = setMaxValue;\n                }\n\n                var seqStyle = getSeqStyle(tier.stylesheet);\n                if (seqStyle) {\n                    seqMismatchRow.style.display = 'table-row';\n                    seqMismatchToggle.checked = (seqStyle.__SEQCOLOR === 'mismatch');\n                    seqInsertRow.style.display = 'table-row';\n                    seqInsertToggle.checked =  isDasBooleanTrue(seqStyle.__INSERTIONS);\n                    seqIgnoreQualsRow.style.display = 'table-row';\n                    seqIgnoreQualsToggle.checked = (seqStyle.__disableQuals === undefined || seqStyle.__disableQuals === false);\n                    console.log(seqStyle.__disableQuals);\n                } else {\n                    seqMismatchRow.style.display = 'none';\n                    seqInsertRow.style.display = 'none';\n                    seqIgnoreQualsRow.style.display = 'none';\n                }\n\n                if (seqStyle && seqMismatchToggle.checked && !isSimpleQuantitative) {\n                    plusStrandColorRow.style.display = 'table-row';\n                    minusStrandColorRow.style.display = 'table-row';\n                } else {\n                    plusStrandColorRow.style.display = 'none';\n                    minusStrandColorRow.style.display = 'none';\n                }\n            }\n\n            if (isQuantitative && tier.browser.sourceAdapterIsCapable(tier.featureSource, 'quantLeap'))\n                quantLeapRow.style.display = 'table-row';\n            else \n                quantLeapRow.style.display = 'none';\n        }\n\n        var seqMismatchToggle = makeElement('input', null, {type: 'checkbox'});\n        var seqMismatchRow = makeElement('tr',\n            [makeElement('th', 'Highlight mismatches & strands'),\n             makeElement('td', seqMismatchToggle)]);\n        seqMismatchToggle.addEventListener('change', function(ev) {\n            var nss = copyStylesheet(tier.stylesheet);\n            var seqStyle = getSeqStyle(nss);\n            seqStyle.__SEQCOLOR = seqMismatchToggle.checked ? 'mismatch' : 'base';\n            tier.mergeStylesheet(nss);\n        });\n\n        var seqInsertToggle = makeElement('input', null, {type: 'checkbox'});\n        var seqInsertRow = makeElement('tr',\n            [makeElement('th', 'Show insertions'),\n             makeElement('td', seqInsertToggle)]);\n        seqInsertToggle.addEventListener('change', function(ev) {\n            var nss = copyStylesheet(tier.stylesheet);\n            var seqStyle = getSeqStyle(nss);\n            seqStyle.__INSERTIONS = seqInsertToggle.checked ? 'yes' : 'no';\n            tier.mergeStylesheet(nss);\n        });\n\n        var seqIgnoreQualsToggle = makeElement('input', null, {type: 'checkbox'});\n        var seqIgnoreQualsRow = makeElement('tr',\n            [makeElement('th', 'Reflect base quality as base color transparency'),\n             makeElement('td', seqIgnoreQualsToggle)]);\n        seqIgnoreQualsToggle.addEventListener('change', function(ev) {\n            var nss = copyStylesheet(tier.stylesheet);\n            var seqStyle = getSeqStyle(nss);\n            seqStyle.__disableQuals = !seqIgnoreQualsToggle.checked;\n            console.log(seqStyle.__disableQuals);\n            tier.mergeStylesheet(nss);\n        });\n\n        var styleRow = makeElement('tr',\n                [makeElement('th', 'Style'),\n                 makeElement('td', glyphField)]);\n        var colorRow = makeElement('tr',\n                [makeElement('th', ['Colour(s)', colorListPlus, colorListMinus]),\n                 colorListElement]);\n        var plusStrandColorRow = makeElement('tr',\n                [makeElement('th', 'Plus Strand Color'),\n                 makeElement('td', tierPlusColorField)]);\n        var minusStrandColorRow = makeElement('tr',\n                [makeElement('th', 'Minus Strand Color'),\n                 makeElement('td', tierMinusColorField)]);\n        var minRow = makeElement('tr',\n                [makeElement('th', 'Min value'),\n                 makeElement('td', [tierMinToggle, ' ', tierMinField])]);\n        var maxRow = makeElement('tr',\n                [makeElement('th', 'Max value'),\n                 makeElement('td', [tierMaxToggle, ' ', tierMaxField])]);\n        var quantLeapRow = \n             makeElement('tr',\n                [makeElement('th', 'Threshold leap:'),\n                 makeElement('td', [quantLeapToggle, ' ', quantLeapThreshField])]);\n        var bumpRow = makeElement('tr',\n                [makeElement('th', 'Bump overlaps'),\n                 makeElement('td', [bumpToggle, ' limit: ', bumpLimit])]);\n        var labelRow = makeElement('tr',\n                [makeElement('th', 'Label features'),\n                 makeElement('td', labelToggle)]);\n\n\n        var tierTable = makeElement('table',\n            [makeElement('tr',\n                [makeElement('th', 'Name', {}, {width: '150px', textAlign: 'right'}),\n                 tierNameField]),\n\n             makeElement('tr',\n                [makeElement('th', 'Pin to top'),\n                 tierPinnedToggle]),\n\n             makeElement('tr',\n                [makeElement('th', 'Height'),\n                 makeElement('td', tierHeightField)]),\n\n            styleRow,\n            colorRow,\n            plusStrandColorRow,\n            minusStrandColorRow,\n            minRow,\n            maxRow,\n            quantLeapRow,\n            bumpRow,\n            labelRow,\n            seqMismatchRow,\n            seqInsertRow,\n            seqIgnoreQualsRow\n             ]);\n\n\n        refresh();\n\n        tierForm.appendChild(tierTable);\n\n        var resetButton = makeElement('button', 'Reset track', {className: 'btn'}, {marginLeft: 'auto', marginRight: 'auto', display: 'block'});\n        resetButton.addEventListener('click', function(ev) {\n            tier.setConfig({});\n        }, false);\n        tierForm.appendChild(resetButton);\n\n        tierNameField.addEventListener('input', function(ev) {\n            tier.mergeConfig({name: tierNameField.value});\n        }, false);\n\n        tierPinnedToggle.addEventListener('change', function(ev) {\n            tier.mergeConfig({pinned: tierPinnedToggle.checked});\n        }, false);\n\n        for (var ci = 0; ci < tierColorFields.length; ++ci) {\n            tierColorFields[ci].addEventListener('change', changeColor, false);\n        }\n\n        tierPlusColorField.addEventListener('change', changeColor, false);\n        tierMinusColorField.addEventListener('change', changeColor, false);\n\n        glyphField.addEventListener('change', function(ev) {\n            var nss = mutateStylesheet(function(ts) {\n                if (glyphField.value === 'SCATTER') {\n                    ts.SCATTER = true;\n                    ts.glyph = 'DOT';\n                    ts.SIZE = '3';\n                } else {\n                    ts.glyph = glyphField.value;\n                    ts.SCATTER = undefined;\n                }\n                setStyleColors(ts);\n            });\n            tier.mergeStylesheet(nss);\n        }, false);\n\n        tierMinToggle.addEventListener('change', function(ev) {\n            var conf = {forceMinDynamic: !tierMinToggle.checked};\n            tierMinField.disabled = !tierMinToggle.checked;\n            var x = parseFloat(tierMinField.value);\n            if (tierMinToggle.checked && typeof(x) == 'number' && !isNaN(x))\n                conf.forceMin = parseFloat(x);\n            tier.mergeConfig(conf);\n        });\n        tierMinField.addEventListener('input', function(ev) {\n            var x = parseFloat(tierMinField.value);\n            if (typeof(x) == 'number' && !isNaN(x))\n                tier.mergeConfig({forceMin: x});\n        }, false);\n\n        tierMaxToggle.addEventListener('change', function(ev) {\n            var conf = {forceMaxDynamic: !tierMaxToggle.checked};\n            tierMaxField.disabled = !tierMaxToggle.checked;\n            var x = parseFloat(tierMaxField.value);\n            if (tierMaxToggle.checked && typeof(x) == 'number' && !isNaN(x))\n                conf.forceMax = parseFloat(x);\n            tier.mergeConfig(conf);\n        });\n        tierMaxField.addEventListener('input', function(ev) {\n            var x = parseFloat(tierMaxField.value);\n            if (typeof(x) == 'number' && !isNaN(x))\n                tier.mergeConfig({forceMax: x});\n        }, false);\n\n        tierHeightField.addEventListener('input', function(ev) {\n            var x = parseFloat(tierHeightField.value);\n            if (typeof(x) == 'number' && !isNaN(x))\n                tier.mergeConfig({height: Math.min(500, x|0)});\n        }, false);\n\n        var updateQuant = function() {\n            quantLeapThreshField.disabled = !quantLeapToggle.checked;\n            if (quantLeapToggle.checked) {\n                var x = parseFloat(quantLeapThreshField.value);\n                if (typeof(x) == 'number' && !isNaN(x)) {\n                    tier.mergeConfig({quantLeapThreshold: parseFloat(quantLeapThreshField.value)});\n                }\n            } else {\n                tier.mergeConfig({quantLeapThreshold: null});\n            }\n        }\n        quantLeapToggle.addEventListener('change', function(ev) {\n            updateQuant();\n        }, false);\n        quantLeapThreshField.addEventListener('input', function(ev) {\n            updateQuant();\n        }, false);\n\n        labelToggle.addEventListener('change', function(ev) {\n            var nss = mutateStylesheet(function(style) {\n                style.LABEL = labelToggle.checked ? 'yes' : 'no';\n            });\n            tier.mergeStylesheet(nss);\n        }, false);\n        bumpToggle.addEventListener('change', function(ev) {\n            var nss = mutateStylesheet(function(style) {\n                style.BUMP = bumpToggle.checked ? 'yes' : 'no';\n            });\n            tier.mergeStylesheet(nss);\n        }, false);\n        bumpLimit.addEventListener('input', function(ev) {\n            var x = parseInt(bumpLimit.value);\n            if (typeof(x) == 'number' && x > 0) {\n                tier.mergeConfig({subtierMax: x});\n            }\n        }, false);\n\n\n        this.showToolPanel(tierForm);\n        this.setUiMode('tier');\n\n        tier.addTierListener(refresh);\n\n        var currentScale = tier.browser.scale;\n        tier.browser.addViewListener(function() {\n            if (tier.browser.scale != currentScale) {\n                currentScale = tier.browser.scale;\n                refresh();\n            }\n        });\n    }\n}\n\nfunction getSeqStyle(stylesheet) {\n    for (var si = 0; si < stylesheet.styles.length; ++si) {\n        var ss = stylesheet.styles[si].style;\n        if (ss.glyph === '__SEQUENCE') {\n            return ss;\n        }\n    }\n}\n\n","/* -*- mode: javascript; c-basic-offset: 4; indent-tabs-mode: nil -*- */\n\n// \n// Dalliance Genome Explorer\n// (c) Thomas Down 2006-2010\n//\n// tier.js: (try) to encapsulate the functionality of a browser tier.\n//\n\n\"use strict\";\n\nif (typeof(require) !== 'undefined') {\n    var utils = require('./utils');\n    var makeElement = utils.makeElement;\n    var removeChildren = utils.removeChildren;\n    var shallowCopy = utils.shallowCopy;\n    var pushnew = utils.pushnew;\n    var miniJSONify = utils.miniJSONify;\n    var arrayIndexOf = utils.arrayIndexOf;\n\n    var das = require('./das');\n    var DASStylesheet = das.DASStylesheet;\n    var DASStyle = das.DASStyle;\n\n    var sha1 = require('./sha1');\n    var b64_sha1 = sha1.b64_sha1;\n\n    var style = require('./style');\n    var StyleFilter = style.StyleFilter;\n    var StyleFilterSet = style.StyleFilterSet;\n\n    var sc = require('./sourcecompare');\n    var sourceDataURI = sc.sourceDataURI;\n\n    var Promise = require('es6-promise').Promise;\n\n    var sortFeatures = require('./features').sortFeatures;\n}\n\nvar __tier_idSeed = 0;\n\nfunction DasTier(browser, source, config, background)\n{\n    this.config = config || {};\n    this.id = 'tier' + (++__tier_idSeed);\n    this.browser = browser;\n    this.dasSource = shallowCopy(source);\n    this.background = background;\n\n    this.viewport = makeElement('canvas', null, \n                                {width: '' + ((this.browser.featurePanelWidth|0) + 2000), \n                                 height: \"30\",\n                                 className: 'viewport_12_5'},\n                                {position: 'inline-block',\n                                 margin: '0px', border: '0px'});\n    this.viewportHolder = makeElement('div', this.viewport, {className: 'viewport-holder_12_5'}, \n                                      {background: background,\n                                       position: 'absolute',\n                                       padding: '0px', margin: '0px',\n                                       border: '0px',\n                                       left: '-1000px',\n                                       minHeight: '200px'});\n    this.overlay = makeElement('canvas', null,\n         {width: + ((this.browser.featurePanelWidth|0)), \n          height: \"30\",\n          className: 'viewport-overlay'});\n\n    this.notifier = makeElement('div', '', {className: 'notifier'});\n    this.notifierHolder = makeElement('div', this.notifier, {className: 'notifier-holder'});\n    this.quantOverlay = makeElement(\n        'canvas', null, \n        {width: '50', height: \"56\",\n         className: 'quant-overlay'});\n\n    this.removeButton = makeElement('i', null, {className: 'fa fa-times'});\n    this.bumpButton = makeElement('i', null, {className: 'fa fa-plus-circle'});\n    this.loaderButton = browser.makeLoader(16);\n    this.loaderButton.style.display = 'none';\n    this.infoElement = makeElement('div', this.dasSource.desc, {className: 'track-label-info'});\n    this.nameButton = makeElement('div', [], {className: 'tier-tab'});\n    this.nameButton.appendChild(this.removeButton);\n    if (source.pennant) {\n        this.nameButton.appendChild(makeElement('img', null, {src: source.pennant, width: '16', height: '16'}))\n    } else if (source.mapping) {\n        var version = null;\n        if (this.browser.chains[source.mapping])\n            version = this.browser.chains[source.mapping].coords.version;\n        if (version)\n            this.nameButton.appendChild(makeElement('span', '' + version, null, {fontSize: '8pt', background: 'black', color: 'white', paddingLeft: '3px', paddingRight: '3px', paddingTop: '1px', paddingBottom: '1px', marginLeft: '2px', borderRadius: '10px'}));\n    }\n    this.nameElement = makeElement('span', source.name);\n    this.nameButton.appendChild(makeElement('span', [this.nameElement, this.infoElement], {className: 'track-name-holder'}));\n    this.nameButton.appendChild(this.bumpButton);\n    this.nameButton.appendChild(this.loaderButton);\n\n    this.label = makeElement('span',\n       [this.nameButton],\n       {className: 'btn-group track-label'});\n\n    var classes = 'tier' + (source.className ? ' ' + source.className : '');\n    this.row = makeElement('div', [this.viewportHolder,\n                                   this.overlay,\n                                   this.quantOverlay],\n                            {className: classes});\n\n    if (!background) {\n        this.row.style.background = 'none';\n    }\n\n    if (!browser.noDefaultLabels)\n        this.row.appendChild(this.label);\n    this.row.appendChild(this.notifierHolder);\n    \n    this.layoutHeight = 25;\n    this.bumped = true;\n    this.styleIdSeed = 0;\n    if (source.quantLeapThreshold) {\n        this.quantLeapThreshold = source.quantLeapThreshold;\n    }\n    if (this.dasSource.collapseSuperGroups) {\n        this.bumped = false;\n    }\n    this.layoutWasDone = false;\n\n    if (source.featureInfoPlugin) {\n        this.addFeatureInfoPlugin(source.featureInfoPlugin);\n    }\n\n    this.initSources();\n\n    var thisB = this;\n    if (this.featureSource && this.featureSource.getDefaultFIPs && !source.noSourceFeatureInfo) {\n        this.featureSource.getDefaultFIPs(function(fip) {\n            if (fip)\n                thisB.addFeatureInfoPlugin(fip);\n        });\n    }\n\n    if (this.featureSource && this.featureSource.addReadinessListener) {\n        this.readinessListener = function(ready) {\n            thisB.notify(ready, -1);\n        };\n        this.featureSource.addReadinessListener(this.readinessListener);\n    }\n\n    if (this.featureSource && this.featureSource.addActivityListener) {\n        this.activityListener = function(busy) {\n            if (busy > 0) {\n                thisB.loaderButton.style.display = 'inline-block';\n            } else {\n                thisB.loaderButton.style.display = 'none';\n            }\n            thisB.browser.pingActivity();\n        };\n        this.featureSource.addActivityListener(this.activityListener);\n    }\n\n    this.listeners = [];\n    this.featuresLoadedListeners = [];\n    this.firstRenderPromise = new Promise((resolve, reject) => this._resolveFirstRenderPromise = resolve);\n}\n\nDasTier.prototype.destroy = function() {\n    if (this.featureSource.removeReadinessListener) {\n        this.featureSource.removeReadinessListener(this.readinessListener);\n    }\n    if (this.featureSource.removeActivityListener) {\n        this.featureSource.removeActivityListener(this.activityListener);\n    }\n}\n\nDasTier.prototype.setBackground = function(b) {\n    this.background = b;\n    this.viewportHolder.style.background = b;\n}\n\nDasTier.prototype.toString = function() {\n    return this.id;\n}\n\nDasTier.prototype.addFeatureInfoPlugin = function(p) {\n    if (!this.featureInfoPlugins) \n        this.featureInfoPlugins = [];\n    this.featureInfoPlugins.push(p);\n}\n\nDasTier.prototype.init = function() {\n    var tier = this;\n    return new Promise(function (resolve, reject) {\n        \n        if (tier.dasSource.style) {\n            tier.setStylesheet({styles: tier.dasSource.style});\n            resolve(tier);\n        } else {\n            tier.status = 'Fetching stylesheet';\n            tier.fetchStylesheet(function(ss, err) {\n                if (err || !ss) {\n                    tier.error = 'No stylesheet';\n                    var ss = new DASStylesheet();\n                    var defStyle = new DASStyle();\n                    defStyle.glyph = 'BOX';\n                    defStyle.BGCOLOR = 'blue';\n                    defStyle.FGCOLOR = 'black';\n                    ss.pushStyle({type: 'default'}, null, defStyle);\n                    tier.setStylesheet(ss);\n                } else {\n                    tier.setStylesheet(ss);\n                    if (ss.geneHint) {\n                        tier.dasSource.collapseSuperGroups = true;\n                        tier.bumped = false;\n                        tier.updateLabel();\n                    }\n                    tier._updateFromConfig();\n                }\n                resolve(tier);\n            });\n        }\n    });\n}\n\nDasTier.prototype.setStylesheet = function(ss) {\n    this.baseStylesheet = shallowCopy(ss);\n    for (var si = 0; si < this.baseStylesheet.styles.length; ++si) {\n        var sh = this.baseStylesheet.styles[si] = shallowCopy(this.baseStylesheet.styles[si]);\n        sh._methodRE = sh._labelRE = sh._typeRE = null;\n        sh.style = shallowCopy(sh.style);\n        sh.style.id = 'style' + (++this.styleIdSeed);\n    }\n    this.baseStylesheetValidity = b64_sha1(miniJSONify(this.baseStylesheet));\n    this._updateFromConfig();\n}\n\nDasTier.prototype.getSource = function() {\n    return this.featureSource;\n}\n\nDasTier.prototype.getDesiredTypes = function(scale) {\n    var sfs = this.getActiveStyleFilters(scale);\n    if (sfs)\n        return sfs.typeList();\n}\n\nDasTier.prototype.getActiveStyleFilters = function(scale) {\n    var ssScale = this.browser.zoomForCurrentScale();\n\n    if (this.stylesheet) {\n        var styles = new StyleFilterSet();\n        var ss = this.stylesheet.styles;\n        for (var si = 0; si < ss.length; ++si) {\n            var sh = ss[si];\n            if (!sh.zoom || sh.zoom == ssScale) {\n                styles.add(new StyleFilter(sh.type, sh.method, sh.label));\n            }\n        }\n        return styles;\n    }\n}\n\nDasTier.prototype.needsSequence = function(scale) {\n    var sourceConfigNeedsSeq = function(s) {\n        if (s.bamURI || s.bamBlob || s.bwgURI || s.bwgBlob) {\n            return true;\n        } else if (s.overlay) {\n            return s.overlay.some(sourceConfigNeedsSeq);\n        } else {\n            return false;\n        }\n    }\n\n    if (this.sequenceSource && scale < 5) {\n        return true;\n    } else if (sourceConfigNeedsSeq(this.dasSource) && scale < 20) {\n        return true\n    }\n    return false;\n}\n\nDasTier.prototype.setFeatures = function(chr, coverage, scale, features, sequence) {\n    this.currentFeatures = features;\n    this.currentSequence = sequence;    \n    this.knownChr = chr;\n    this.knownCoverage = coverage;\n    \n\n    // only notify features loaded, if they are valid\n    if (features) {\n        sortFeatures(this);\n        this.notifyFeaturesLoaded();\n    }\n}\n\n\nDasTier.prototype.draw = function() {\n    console.log(\"Use browser.getTierRenderer(tier).drawTier(tier)\");\n}\n\nDasTier.prototype.findNextFeature = function(chr, pos, dir, fedge, callback) {\n    if (this.quantLeapThreshold) {\n        var width = this.browser.viewEnd - this.browser.viewStart + 1;\n        pos = (pos +  ((width * dir) / 2))|0\n        this.featureSource.quantFindNextFeature(chr, pos, dir, this.quantLeapThreshold, callback);\n    } else {\n        if (this.knownCoverage && pos >= this.knownCoverage.min() && pos <= this.knownCoverage.max()) {\n            if (this.currentFeatures) {\n                var bestFeature = null;\n                for (var fi = 0; fi < this.currentFeatures.length; ++fi) {\n                    var f = this.currentFeatures[fi];\n                    if (!f.min || !f.max) {\n                        continue;\n                    }\n                    if (f.parents && f.parents.length > 0) {\n                        continue;\n                    }\n                    if (dir < 0) {\n                        if (fedge == 1 && f.max >= pos && f.min < pos) {\n                            if (!bestFeature || f.min > bestFeature.min ||\n                                (f.min == bestFeature.min && f.max < bestFeature.max)) {\n                                bestFeature = f;\n                            }\n                        } else if (f.max < pos) {\n                            if (!bestFeature || f.max > bestFeature.max || \n                                (f.max == bestFeature.max && f.min < bestFeature.min) ||\n                                (f.min == bestFeature.mmin && bestFeature.max >= pos)) {\n                                bestFeature = f;\n                            } \n                        }\n                    } else {\n                        if (fedge == 1 && f.min <= pos && f.max > pos) {\n                            if (!bestFeature || f.max < bestFeature.max ||\n                                (f.max == bestFeature.max && f.min > bestFeature.min)) {\n                                bestFeature = f;\n                            }\n                        } else if (f.min > pos) {\n                            if (!bestFeature || f.min < bestFeature.min ||\n                                (f.min == bestFeature.min && f.max > bestFeature.max) ||\n                                (f.max == bestFeature.max && bestFeature.min <= pos)) {\n                                bestFeature = f;\n                            }\n                        }\n                    }\n                }\n                if (bestFeature) {\n                    return callback(bestFeature);\n                }\n                if (dir < 0) {\n                    pos = this.browser.knownSpace.min;\n                } else {\n                    pos = this.browser.knownSpace.max;\n                }\n            }\n        }\n\n        this.trySourceFNF(chr, pos, dir, callback);\n    }\n}\n\nDasTier.prototype.trySourceFNF = function(chr, pos, dir, callback) {\n    var self = this;\n    this.featureSource.findNextFeature(chr, pos, dir, function(feature) {\n        if (!feature)\n            callback(feature);\n\n        var ss = self.browser.getSequenceSource();\n        if (!ss) // We're probably in trouble, but return anyway.\n            callback(feature)\n\n        ss.getSeqInfo(feature.segment, function(si) {\n            if (si)\n                callback(feature);\n            else\n                self.trySourceFNF(feature.segment, dir > 0 ? 10000000000 : 0, dir, callback);\n        });\n    });\n}\n\n\nDasTier.prototype.updateLabel = function() {\n   this.bumpButton.className = this.bumped ? 'fa fa-minus-circle' : 'fa fa-plus-circle';\n   if (this.dasSource.collapseSuperGroups) {\n        this.bumpButton.style.display = 'inline-block';\n    } else {\n        this.bumpButton.style.display = 'none';\n    }\n}\n\nDasTier.prototype.updateHeight = function() {\n    this.currentHeight = Math.max(Math.max(this.layoutHeight, this.label.clientHeight + 2), this.browser.minTierHeight);\n    this.row.style.height = '' + this.currentHeight + 'px';\n    this.browser.updateHeight();\n }\n\n\nDasTier.prototype.drawOverlay = function() {\n    var t = this;\n    var b = this.browser;\n    var retina = b.retina && window.devicePixelRatio > 1;\n    \n    t.overlay.height = t.viewport.height;\n    t.overlay.width = retina ? b.featurePanelWidth * 2 : b.featurePanelWidth;\n\n    var g = t.overlay.getContext('2d');\n    if (retina) {\n        g.scale(2, 2);\n    }\n    \n    var origin = b.viewStart;\n    var visStart = b.viewStart;\n    var visEnd = b.viewEnd;\n\n    if (this.overlayLabelCanvas) {\n        var offset = ((this.glyphCacheOrigin - this.browser.viewStart)*this.browser.scale);\n        g.save();\n        g.translate(offset, 0);\n        var drawStart = -offset + 2;\n        if (this.dasSource.tierGroup)\n            drawStart += 15;\n        this.overlayLabelCanvas.draw(g, drawStart, b.featurePanelWidth-offset);\n        g.restore();\n    }\n\n    for (var hi = 0; hi < b.highlights.length; ++hi) {\n        var h = b.highlights[hi];\n        if (((h.chr === b.chr) || (h.chr === ('chr' + b.chr))) && h.min < visEnd && h.max > visStart) {\n            g.globalAlpha = b.defaultHighlightAlpha;\n            g.fillStyle = b.defaultHighlightFill;\n            g.fillRect((h.min - origin) * b.scale,\n                       0,\n                       (h.max - h.min) * b.scale,\n                       t.overlay.height);\n        }\n    } \n\n    // t.oorigin = b.viewStart;\n    t.overlay.style.width = b.featurePanelWidth;\n    t.overlay.style.height = t.viewport.style.height;\n    t.overlay.style.left = '0px';\n}\n\n\nDasTier.prototype.updateStatus = function(status) {\n    var self = this;\n    if (status) {\n        this.status = status;\n        this._notifierToStatus();\n        var sd = sourceDataURI(this.dasSource);\n        if (window.location.protocol === 'https:' && sourceDataURI(this.dasSource).indexOf('http:') == 0 && !this.checkedHTTP) {\n            this.checkedHTTP = true;\n            this.browser.canFetchPlainHTTP().then(\n                function(can) {\n                    if (!can) {\n                        self.warnHTTP = true;\n                        self._notifierToStatus();\n                    }\n                }\n            );\n        }\n    } else {\n        if (this.status) {\n            this.status = null\n            this._notifierToStatus();\n        }\n    }\n}\n\nDasTier.prototype.notify = function(message, timeout) {\n    if (typeof(timeout) !== 'number')\n        timeout = 2000;\n\n    if (this.notifierFadeTimeout) {\n        clearTimeout(this.notifierFadeTimeout);\n        this.notifierFadeTimeout = null;\n    }\n\n    if (message) {\n        this._notifierOn(message);\n        if (timeout > 0) {\n            var thisB = this;\n            this.notifierFadeTimeout = setTimeout(function() {\n                thisB._notifierToStatus();\n            }, timeout);\n        }\n    } else {\n        this._notifierToStatus();\n    }\n}\n\nDasTier.prototype._notifierOn = function(message, warnHTTP) {\n    removeChildren(this.notifier);\n    if (warnHTTP) {\n        this.notifier.appendChild(\n            makeElement(\n                'span',\n                [makeElement('a', '[HTTP Warning] ', {href: this.browser.httpWarningURL, target: \"_blank\"}),\n                 message]\n            )\n        );\n    } else {\n        this.notifier.textContent = message;\n    }\n    this.notifier.style.opacity = 0.8;\n}\n\nDasTier.prototype._notifierOff = function() {\n    this.notifier.style.opacity = 0;\n}\n\nDasTier.prototype._notifierToStatus = function() {\n    if (this.status) {\n        this._notifierOn(this.status, this.warnHTTP)\n    } else {\n        this._notifierOff();\n    }\n}\n\nDasTier.prototype.setConfig = function(config) {\n    this.config = config || {};\n    this._updateFromConfig();\n    this.notifyTierListeners();\n}\n\nDasTier.prototype.mergeStylesheet = function(newStyle) {\n    this.mergeConfig({\n        stylesheet: newStyle, \n        stylesheetValidity: this.baseStylesheetValidity\n    });\n}\n\nDasTier.prototype.mergeConfig = function(newConfig) {\n    for (var k in newConfig) {\n        this.config[k] = newConfig[k];\n    }\n    this._updateFromConfig();\n    this.notifyTierListeners();\n}\n\nDasTier.prototype._updateFromConfig = function() {\n    var needsRefresh = false;\n    var needsReorder = false;\n\n    if (typeof this.config.name === 'string')\n        this.nameElement.textContent = this.config.name;\n    else\n        this.nameElement.textContent = this.dasSource.name;\n\n    var wantedHeight = this.config.height || this.dasSource.forceHeight;\n    if (wantedHeight != this.forceHeight) {\n        this.forceHeight = wantedHeight;\n        needsRefresh = true;\n    }\n\n    if (this.forceMinDynamic != this.config.forceMinDynamic) {\n        this.forceMinDynamic = this.config.forceMinDynamic;\n        needsRefresh = true;\n    }\n\n    var forceMin = this.config.forceMin != undefined ? this.config.forceMin : this.dasSource.forceMin;\n    if (this.forceMin != forceMin) {\n        this.forceMin = forceMin;\n        needsRefresh = true;\n    }\n\n    if (this.forceMaxDynamic != this.config.forceMaxDynamic) {\n        this.forceMaxDynamic = this.config.forceMaxDynamic;\n        needsRefresh = true;\n    }\n    \n    var forceMax = this.config.forceMax != undefined ? this.config.forceMax : this.dasSource.forceMax;\n    if (this.forceMax != forceMax) {\n        this.forceMax = forceMax;\n        needsRefresh = true;\n    }\n\n    var quantLeapThreshold = null;\n    if (this.config.quantLeapThreshold !== undefined)\n        quantLeapThreshold = this.config.quantLeapThreshold;\n    else if (this.dasSource.quantLeapThreshold !== undefined)\n        quantLeapThreshold = this.dasSource.quantLeapThreshold;\n    if (quantLeapThreshold != this.quantLeapThreshold) {\n        this.quantLeapThreshold = quantLeapThreshold;\n        needsRefresh = true;\n    }\n    \n    // Possible FIXME -- are there cases where style IDs need to be reassigned?\n    var stylesheet = null;\n    if (this.config.stylesheetValidity == this.baseStylesheetValidity)\n        stylesheet = this.config.stylesheet;\n    stylesheet = stylesheet || this.baseStylesheet;\n    if (this.stylesheet !== stylesheet) {\n        this.stylesheet = stylesheet;\n        needsRefresh = true;\n    }\n\n    var wantedPinned = this.config.pinned !== undefined ? this.config.pinned : this.dasSource.pinned;\n    if (wantedPinned !== this.pinned) {\n        this.pinned = wantedPinned;\n        needsReorder = true;\n    }\n\n    var wantedSubtierMax = (typeof(this.config.subtierMax === 'number') ? \n        this.config.subtierMax : this.dasSource.subtierMax || this.browser.defaultSubtierMax);\n    if (wantedSubtierMax != this.subtierMax) {\n        this.subtierMax = wantedSubtierMax;\n        needsRefresh = true;\n    }\n\n    var wantedBumped;\n    if (this.config.bumped !== undefined) {\n        wantedBumped = this.config.bumped;\n    } else if (this.dasSource.bumped !== undefined) {\n        wantedBumped = this.dasSource.bumped;\n    } else {\n        wantedBumped = this.dasSource.collapseSuperGroups ? false : true;\n    }\n    if (wantedBumped !== this.bumped) {\n        this.bumped = wantedBumped;\n        needsRefresh = true;\n        this.updateLabel();\n    }\n\n    if (needsRefresh)\n        this.scheduleRedraw();\n\n    if (needsReorder)\n        this.browser.reorderTiers();\n}\n\nDasTier.prototype.scheduleRedraw = function() {\n    if (!this.currentFeatures)\n        return;\n    \n    var tier = this;\n\n    if (!this.redrawTimeout) {\n        this.redrawTimeout = setTimeout(function() {\n            sortFeatures(tier);   // Some render actions mutate the results of this,\n                                  // => need to re-run before refreshing.\n            var renderer = tier.browser.getTierRenderer(tier);\n            renderer.drawTier(tier);\n            tier.redrawTimeout = null;\n        }, 10);\n    }\n}\nDasTier.prototype.clearTierListeners = function() {\n\tthis.listeners = [];\n}\n\n\nDasTier.prototype.addTierListener = function(l) {\n    this.listeners.push(l);\n}\n\nDasTier.prototype.removeTierListener = function(l) {\n    var idx = arrayIndexOf(this.listeners, l);\n    if (idx >= 0) {\n        this.listeners.splice(idx, 1);\n    }\n}\n\nDasTier.prototype.notifyTierListeners = function(change) {\n    for (var li = 0; li < this.listeners.length; ++li) {\n        try {\n            this.listeners[li](change);\n        } catch (e) {\n            console.log(e);\n        }\n    }\n    this.browser.notifyTier();\n}\n\nDasTier.prototype.clearFeaturesLoadedListeners = function() {\n  this.featuresLoadedListeners = [];\n}\n\nDasTier.prototype.addFeaturesLoadedListener = function(handler) {\n    this.featuresLoadedListeners.push(handler);\n}\n\nDasTier.prototype.removeFeaturesLoadedListener = function(handler) {\n    var idx = arrayIndexOf(this.featuresLoadedListeners, handler);\n    if (idx >= 0) {\n        this.featuresLoadedListeners.splice(idx, 1);\n    }\n}\n\nDasTier.prototype.notifyFeaturesLoaded = function() {\n    for (var li = 0; li < this.featuresLoadedListeners.length; ++li) {\n        try {\n            this.featuresLoadedListeners[li].call(this);\n        } catch (e) {\n            console.log(e);\n        }\n    }\n}\n\nDasTier.prototype.wasRendered = function() {\n    this._resolveFirstRenderPromise();\n}\n\nif (typeof(module) !== 'undefined') {\n    module.exports = {\n        DasTier: DasTier\n    };\n\n    // Imported for side effects\n    var fd = require('./feature-draw');\n}\n","/* -*- mode: javascript; c-basic-offset: 4; indent-tabs-mode: nil -*- */\n\n// \n// Dalliance Genome Explorer\n// (c) Thomas Down 2006-2010\n//\n// track-adder.js\n//\n\n\"use strict\";\n\nif (typeof(require) !== 'undefined') {\n    var browser = require('./cbrowser');\n    var Browser = browser.Browser;\n\n    var sc = require('./sourcecompare');\n    var sourcesAreEqual = sc.sourcesAreEqual;\n\n    var utils = require('./utils');\n    var makeElement = utils.makeElement;\n    var removeChildren = utils.removeChildren;\n    var Observed = utils.Observed;\n\n    var thub = require('./thub');\n    var THUB_COMPARE = thub.THUB_COMPARE;\n    var connectTrackHub = thub.connectTrackHub;\n\n    var domui = require('./domui');\n    var makeTreeTableSection = domui.makeTreeTableSection;\n\n    var probeResource = require('./probe').probeResource;\n\n\n    // Most of this could disappear if we leave all probing to the probe module...\n    var bin = require('./bin');\n    var URLFetchable = bin.URLFetchable;\n    var BlobFetchable = bin.BlobFetchable;\n    var readInt = bin.readInt;\n\n    var lh3utils = require('./lh3utils');\n    var unbgzf = lh3utils.unbgzf;\n\n    var bam = require('./bam');\n    var BAM_MAGIC = bam.BAM_MAGIC;\n    var BAI_MAGIC = bam.BAI_MAGIC;\n\n    var tbi = require('./tabix');\n    var TABIX_MAGIC = tbi.TABIX_MAGIC;\n\n    var das = require('./das');\n    var DASSource = das.DASSource;\n    var DASSegment = das.DASSegment;\n    var DASRegistry = das.DASRegistry;\n    var coordsMatch = das.coordsMatch;\n\n    var EncodeFetchable = require('./encode').EncodeFetchable;\n}\n\nBrowser.prototype.currentlyActive = function(source) {\n    for (var ti = 0; ti < this.tiers.length; ++ti) {\n        if (sourcesAreEqual(this.tiers[ti].dasSource, source))\n            return this.tiers[ti];\n    }\n    return false;\n}\n\nBrowser.prototype.makeButton = function(name, tooltip) {\n    var regButton = makeElement('a', name, {href: '#'});\n    if (tooltip) {\n        this.makeTooltip(regButton, tooltip);\n    }\n    return makeElement('li', regButton);\n}\n\nfunction activateButton(addModeButtons, which) {\n    for (var i = 0; i < addModeButtons.length; ++i) {\n        var b = addModeButtons[i];\n        if (b === which) {\n            b.classList.add('active');\n        } else {\n            b.classList.remove('active');\n        }\n    }\n}\n\nBrowser.prototype.showTrackAdder = function(ev) {\n    if (this.uiMode === 'add') {\n        this.hideToolPanel();\n        this.setUiMode('none');\n        return;\n    }\n\n    var thisB = this;\n\n    var popup = makeElement('div', null, {className: 'dalliance'} , {width: '100%', display: 'inline-block', boxSizing: 'border-box', MozBoxSizing: 'border-box', verticalAlign: 'top', paddingRight: '15px'});\n\n    var addModeButtons = [];\n    var makeStab, makeStabObserver;\n\n\n    if (!this.noRegistryTabs) {\n        var regButton = this.makeButton('Registry', 'Browse compatible datasources from the DAS registry');\n        addModeButtons.push(regButton);\n        \n        for (var m in this.mappableSources) {\n            var mf  = function(mm) {\n                var mapButton = thisB.makeButton(thisB.chains[mm].srcTag, 'Browse datasources mapped from ' + thisB.chains[mm].srcTag);\n                addModeButtons.push(mapButton);\n                mapButton.addEventListener('click', function(ev) {\n                    ev.preventDefault(); ev.stopPropagation();\n                    activateButton(addModeButtons, mapButton);\n                    makeStab(thisB.mappableSources[mm], mm);\n                }, false);\n            }; mf(m);\n        }\n    }\n\n    var groupedDefaults = {};\n    for (var si = 0; si < this.defaultSources.length; ++si) {\n        var s = this.defaultSources[si];\n        var g = s.group || 'Defaults';\n        if (groupedDefaults[g]) {\n            groupedDefaults[g].push(s);\n        } else {\n            groupedDefaults[g] = [s];\n        }\n    }\n    \n\n    var makeHubButton = function(tdb) {\n        var hub = tdb.hub;\n        var hubMenuButton = makeElement('i', null, {className: 'fa fa-list-alt'}, {cursor: 'context-menu'});\n        var label = hub.altLabel || hub.shortLabel || 'Unknown';\n        if (tdb.mapping)\n            label = label + ' (' + tdb.genome + ')';\n        var hbContent = makeElement('span', [label, ' ', hubMenuButton]);\n        var hubButton = thisB.makeButton(hbContent, hub.longLabel);\n        hubButton.hub = tdb;\n        addModeButtons.push(hubButton);\n        \n        hubButton.addEventListener('click', function(ev) {\n            ev.preventDefault(); ev.stopPropagation();\n            activateButton(addModeButtons, hubButton);\n            removeChildren(stabHolder);\n            var loader = thisB.makeLoader(24);\n            loader.style.marginLeft = 'auto';\n            loader.style.marginRight = 'auto';\n            loader.style.marginTop = '100px';\n            stabHolder.appendChild(makeElement('div', loader, null, {textAlign: 'center'}));\n\n            refreshButton.style.display = 'none';\n            addButton.style.display = 'none';\n            canButton.style.display = 'none';\n\n            tdb.getTracks(function(tracks, err) {\n                if (err) {\n                    console.log(err);\n                }\n                \n                makeHubStab(tracks);\n            });\n        }, false);\n\n        hubMenuButton.addEventListener('click', function(ev) {\n            ev.preventDefault(); ev.stopPropagation();\n            \n            var removeHubItem = makeElement('li', makeElement('a', 'Remove hub'));\n            var allOnItem = makeElement('li',  makeElement('a', 'Enable all'));\n            var allOffItem = makeElement('li',  makeElement('a', 'Disable all'));\n            var hubMenu = makeElement('ul', [removeHubItem, allOnItem, allOffItem], {className: 'dropdown-menu'}, {display: 'block'});\n\n            var mx =  ev.clientX, my = ev.clientY;\n            mx +=  document.documentElement.scrollLeft || document.body.scrollLeft;\n            my +=  document.documentElement.scrollTop || document.body.scrollTop;\n\n            hubMenu.style.position = 'absolute';\n            hubMenu.style.top = '' + (my+10) + 'px';\n            hubMenu.style.left = '' + (mx-30) + 'px';\n            thisB.hPopupHolder.appendChild(hubMenu);\n\n            var clickCatcher = function(ev) {\n                console.log('cc');\n                document.body.removeEventListener('click', clickCatcher, true);\n                thisB.hPopupHolder.removeChild(hubMenu);\n            };\n            document.body.addEventListener('click', clickCatcher, true);\n\n            removeHubItem.addEventListener('click', function(ev) {\n                for (var hi = 0; hi < thisB.hubObjects.length; ++hi) {\n                    if (thisB.hubObjects[hi].absURL == tdb.absURL) {\n                        thisB.hubObjects.splice(hi, 1);\n                        break;\n                    }\n                }\n                for (var hi = 0; hi < thisB.hubs.length; ++hi) {\n                    var hc = thisB.hubs[hi];\n                    if (typeof hc === 'string')\n                        hc = {url: hc};\n                    if (hc.url == tdb.hub.url && !hc.genome || hc.genome == tdb.genome) {\n                        thisB.hubs.splice(hi, 1);\n                        break;\n                    }\n\n                }\n\n                thisB.notifyTier();\n\n                modeButtonHolder.removeChild(hubButton);\n                activateButton(addModeButtons, addHubButton);\n                switchToHubConnectMode();\n            }, false);\n\n\n            allOnItem.addEventListener('click', function(ev) {\n                tdb.getTracks(function(tracks, err) {\n                    if (err) {\n                        console.log(err);\n                    }\n                    \n                    for (var ti = 0; ti < tracks.length; ++ti) {\n                        var ds = tracks[ti].toDallianceSource();\n                        if (!thisB.currentlyActive(ds)) {\n                            thisB.addTier(ds);\n                        }\n                    }\n                });\n            }, false);\n\n            allOffItem.addEventListener('click', function(ev) {\n                tdb.getTracks(function(tracks, err) {\n                    if (err) {\n                        console.log(err);\n                    }\n                    \n                    for (var ti = 0; ti < tracks.length; ++ti) {\n                        var ds = tracks[ti].toDallianceSource();\n                        if (thisB.currentlyActive(ds)) {\n                            thisB.removeTier(ds);\n                        }\n                    }\n                });\n            }, false);\n        }, false);\n\n        return hubButton;\n    }\n\n    var firstDefButton = null;\n    var firstDefSources = null;\n    for (var g in groupedDefaults) {\n        (function(g, ds) {\n            var defButton = thisB.makeButton(g, 'Browse the default set of data for this browser');\n            defButton.addEventListener('click', function(ev) {\n                ev.preventDefault(); ev.stopPropagation();\n                activateButton(addModeButtons, defButton);\n                makeStab(new Observed(ds));\n            }, false);\n            addModeButtons.push(defButton);\n\n            if (!firstDefButton || thisB.defaultTrackAdderTab && thisB.defaultTrackAdderTab == g) {\n                firstDefButton = defButton;\n                firstDefSources = ds;\n            }\n        })(g, groupedDefaults[g]);\n    }   \n    var custButton = this.makeButton('DAS', 'Add data using the DAS protocol');\n    addModeButtons.push(custButton);\n    var binButton = this.makeButton('Files', 'Add data from files on disk or the web');\n    addModeButtons.push(binButton);\n\n\n    for (var hi = 0; hi < this.hubObjects.length; ++hi) {\n        var hub = this.hubObjects[hi];\n        makeHubButton(hub);\n    }\n\n    var addHubButton = this.makeButton('+', 'Connect to a new track-hub');\n    addModeButtons.push(addHubButton);\n\n\n    var modeButtonHolder = makeElement('ul', addModeButtons, {className: 'nav nav-tabs'}, {marginBottom: '0px'});\n    popup.appendChild(modeButtonHolder);\n    \n    var custURL, custName, custCS, custQuant, custFile, custUser, custPass;\n    var customMode = false;\n    var dataToFinalize = null;\n\n    var asform = makeElement('form', null, {}, {display: 'inline-block', width: '100%'});\n    asform.addEventListener('submit', function(ev) {\n            ev.stopPropagation(); ev.preventDefault();\n            doAdd();\n            return false;\n    }, true); \n    var stabHolder = makeElement('div');\n    stabHolder.style.position = 'relative';\n    stabHolder.style.overflow = 'scroll';\n    // stabHolder.style.height = '500px';\n    asform.appendChild(stabHolder);\n\n    var __mapping;\n    var __sourceHolder;\n\n\n    makeStab = function(msources, mapping) {\n        refreshButton.style.display = 'none';\n        addButton.style.display = 'none';\n        canButton.style.display = 'none';\n        if (__sourceHolder) {\n            __sourceHolder.removeListener(makeStabObserver);\n        }\n        __mapping = mapping;\n        __sourceHolder = msources;\n        __sourceHolder.addListenerAndFire(makeStabObserver);\n    }\n\n    makeStabObserver = function(msources) {\n        customMode = false;\n        var buttons = [];\n        removeChildren(stabHolder);\n        if (!msources) {\n            stabHolder.appendChild(makeElement('p', 'Dalliance was unable to retrieve data source information from the DAS registry, please try again later'));\n            return;\n        }\n        \n        var stabBody = makeElement('tbody', null, {className: 'table table-striped table-condensed'}, {width: '100%'});\n        var stab = makeElement('table', stabBody, {className: 'table table-striped table-condensed'}, {width: '100%', tableLayout: 'fixed'}); \n        var idx = 0;\n\n        var sources = [];\n        for (var i = 0; i < msources.length; ++i) {\n            sources.push(msources[i]);\n        }\n        \n        sources.sort(function(a, b) {\n            return a.name.toLowerCase().trim().localeCompare(b.name.toLowerCase().trim());\n        });\n\n        for (var i = 0; i < sources.length; ++i) {\n            var source = sources[i];\n            var r = makeElement('tr');\n\n            var bd = makeElement('td', null, {}, {width: '30px'});\n            bd.style.textAlign = 'center';\n            if (!source.props || source.props.cors) {\n                var b = makeElement('input');\n                b.type = 'checkbox';\n                b.dalliance_source = source;\n                b.id = 'sourcecb' + i;\n                if (__mapping) {\n                    b.dalliance_mapping = __mapping;\n                }\n                // b.checked = thisB.currentlyActive(source);\n                bd.appendChild(b);\n                buttons.push(b);\n                b.addEventListener('change', function(ev) {\n                    if (ev.target.checked) {\n                        thisB.addTier(ev.target.dalliance_source);\n                    } else {\n                        thisB.removeTier(ev.target.dalliance_source);\n                    }\n                });\n            } else {\n                bd.appendChild(document.createTextNode('!'));\n                thisB.makeTooltip(bd, makeElement('span', [\"This data source isn't accessible because it doesn't support \", makeElement('a', \"CORS\", {href: 'http://www.w3.org/TR/cors/'}), \".\"]));\n            }\n            r.appendChild(bd);\n            var ld = makeElement('label', null, {htmlFor: 'sourcecb' + i});\n            ld.appendChild(document.createTextNode(source.name));\n            if (source.desc && source.desc.length > 0) {\n                thisB.makeTooltip(ld, source.desc);\n            }\n            r.appendChild(makeElement('td', ld));\n            stabBody.appendChild(r);\n            ++idx;\n        }\n\n        var setChecks = function() {\n            for (var bi = 0; bi < buttons.length; ++bi) {\n                var b = buttons[bi];\n                var t = thisB.currentlyActive(b.dalliance_source);\n                if (t) {\n                    b.checked = true;\n                } else {\n                    b.checked = false;\n                }\n            }\n        }\n        setChecks();\n        thisB.addTierListener(function(l) {\n            setChecks();\n        });\n\n        stabHolder.appendChild(stab);\n    };\n\n    function makeHubStab(tracks) {\n        refreshButton.style.display = 'none';\n        addButton.style.display = 'none';\n        canButton.style.display = 'none';\n\n        customMode = false;\n        removeChildren(stabHolder);\n        \n        let buttonIdSeed = 0;\n\n        var ttab = makeElement('div', null, {}, {width: '100%'});\n        var sources = [];\n        for (var i = 0; i < tracks.length; ++i) {\n            sources.push(tracks[i]);\n        }\n        \n        sources.sort(function(a, b) {\n            return a.shortLabel.toLowerCase().trim().localeCompare(b.shortLabel.toLowerCase().trim());\n        });\n\n        var groups = [];\n        var tops = [];\n        \n        for (var ti = 0; ti < sources.length; ++ti) {\n            var track = sources[ti];\n            if (track.children && track.children.length > 0 && track.container != 'multiWig') {\n                groups.push(track);\n            } else {\n                tops.push(track);\n            }\n        }\n        if (tops.length > 0) {\n            groups.push({\n                shortLabel: 'Others',\n                priority: -100000000,\n                children: tops});\n        }\n\n        groups.sort(THUB_COMPARE);\n        \n        var buttons = [];\n        for (var gi = 0; gi < groups.length; ++gi) {\n            var group = groups[gi];\n            var dg = group;\n            if (!dg.dimensions && dg._parent && dg._parent.dimensions)\n                dg = dg._parent;\n\n            var dprops = {}\n            if (dg.dimensions) {\n                var dtoks = dg.dimensions.split(/(\\w+)=(\\w+)/);\n                for (var dti = 0; dti < dtoks.length - 2; dti += 3) {\n                    dprops[dtoks[dti + 1]] = dtoks[dti + 2];\n                }\n            }\n\n            if (dprops.dimX && dprops.dimY) {\n                var dimX = dprops.dimX, dimY = dprops.dimY;\n                var sgX = dg.subgroups[dimX];\n                var sgY = dg.subgroups[dimY];\n                \n                var trks = {};\n                for (var ci = 0; ci < group.children.length; ++ci) {\n                    var child = group.children[ci];\n                    var vX = child.sgm[dimX], vY = child.sgm[dimY];\n                    if (!trks[vX])\n                        trks[vX] = {};\n                    trks[vX][vY] = child;\n                }\n\n                var matrix = makeElement('table', null, {className: 'table table-striped table-condensed'}, {tableLayout: 'fixed'});\n                {\n                    var header = makeElement('tr');\n                    header.appendChild(makeElement('th', null, {}, {width: '150px', height: '100px'}));   // blank corner element\n                    for (var si = 0; si < sgX.titles.length; ++si) {\n                        var h = makeElement('th', makeElement('div', sgX.titles[si], {}, {transform: 'rotate(-60deg)', \n                                                                       transformOrigin: '0% 100%', \n                                                                       webkitTransform: 'rotate(-60deg) translate(20px,10px)', \n                                                                       webkitTransformOrigin: '0% 100%',\n                                                                       textAlign: 'left'}), {}, {width: '35px',\n                                                                                                 height: '100px',\n                                                                                                 verticalAlign: 'bottom'})\n                        header.appendChild(h);\n                    }\n                    matrix.appendChild(header);\n                }\n\n                var mbody = makeElement('tbody', null, {className: 'table table-striped table-condensed'})\n                for (var yi = 0; yi < sgY.titles.length; ++yi) {\n                    var vY = sgY.tags[yi];\n                    var row = makeElement('tr');\n                    row.appendChild(makeElement('th', sgY.titles[yi]), {});\n                    \n                    for (var xi = 0; xi < sgX.titles.length; ++xi) {\n                        var vX = sgX.tags[xi];\n                        var cell = makeElement('td');\n                        if (trks[vX] && trks[vX][vY]) {\n                            var track = trks[vX][vY];\n                            var ds = track.toDallianceSource();\n                            if (!ds)\n                                continue;\n                            \n                            var r = makeElement('tr');\n                            var bd = makeElement('td');\n                            bd.style.textAlign = 'center';\n                            \n                            var b = makeElement('input');\n                            b.type = 'checkbox';\n                            b.dalliance_source = ds;\n                            if (__mapping) {\n                                b.dalliance_mapping = __mapping;\n                            }\n                            buttons.push(b);\n                            cell.appendChild(b);\n                            b.addEventListener('change', function(ev) {\n                                if (ev.target.checked) {\n                                    thisB.addTier(ev.target.dalliance_source);\n                                } else {\n                                    thisB.removeTier(ev.target.dalliance_source);\n                                }\n                            });\n\n                        }\n                        row.appendChild(cell);\n                    } \n                    mbody.appendChild(row);\n                }\n                matrix.appendChild(mbody);\n                ttab.appendChild(makeTreeTableSection(group.shortLabel, matrix, gi==0));                \n            } else {\n                var stabBody = makeElement('tbody', null, {className: 'table table-striped table-condensed'});\n                var stab = makeElement('table', stabBody, {className: 'table table-striped table-condensed'}, {width: '100%', tableLayout: 'fixed'}); \n                var idx = 0;\n            \n                group.children.sort(THUB_COMPARE);\n                for (var i = 0; i < group.children.length; ++i) {\n                    const buttonId = 'hb' + (++buttonIdSeed);\n\n                    var track = group.children[i];\n                    var ds = track.toDallianceSource();\n                    if (!ds)\n                        continue;\n\n                    var r = makeElement('tr');\n                    var bd = makeElement('td', null, {}, {width: '30px'});\n                    bd.style.textAlign = 'center';\n                    \n                    var b = makeElement('input');\n                    b.type = 'checkbox';\n                    b.dalliance_source = ds;\n                    b.id = buttonId;\n                    if (__mapping) {\n                        b.dalliance_mapping = __mapping;\n                    }\n                    buttons.push(b);\n                    bd.appendChild(b);\n                    b.addEventListener('change', function(ev) {\n                        if (ev.target.checked) {\n                            thisB.addTier(ev.target.dalliance_source);\n                        } else {\n                            thisB.removeTier(ev.target.dalliance_source);\n                        }\n                    });\n\n                    r.appendChild(bd);\n                    var ld = makeElement('label', null, {htmlFor: buttonId});\n                    ld.appendChild(document.createTextNode(track.shortLabel));\n                    if (track.longLabel && track.longLabel.length > 0) {\n                        thisB.makeTooltip(ld, track.longLabel);\n                    }\n                    r.appendChild(makeElement('td', ld));\n                    stabBody.appendChild(r);\n                    ++idx;\n                }\n\n                if (groups.length > 1 || group.shortLabel !== 'Others') {\n                    ttab.appendChild(makeTreeTableSection(group.shortLabel, stab, gi==0));\n                } else {\n                    ttab.appendChild(stab);\n                }\n                \n            }\n        }\n\n        var setChecks = function() {\n            for (var bi = 0; bi < buttons.length; ++bi) {\n                var b = buttons[bi];\n                var t = thisB.currentlyActive(b.dalliance_source);\n                if (t) {\n                    b.checked = true;\n                    b.disabled = t.sequenceSource != null;\n                } else {\n                    b.checked = false;\n                }\n            }\n        }\n        setChecks();\n        thisB.addTierListener(function(l) {\n            setChecks();\n        });\n        \n        stabHolder.appendChild(ttab);\n    }\n\n    if (regButton) {\n        regButton.addEventListener('click', function(ev) {\n            ev.preventDefault(); ev.stopPropagation();\n            activateButton(addModeButtons, regButton);\n            makeStab(thisB.availableSources);\n        }, false);\n    }\n \n    binButton.addEventListener('click', function(ev) {\n        ev.preventDefault(); ev.stopPropagation();\n        switchToBinMode();\n    }, false);\n    addHubButton.addEventListener('click', function(ev) {\n        ev.preventDefault(); ev.stopPropagation();\n        switchToHubConnectMode();\n    }, false);\n\n\n    function switchToBinMode() {\n        activateButton(addModeButtons, binButton);\n        customMode = 'bin';\n\n        refreshButton.style.display = 'none';\n        addButton.style.display = 'inline';\n        canButton.style.display = 'none';\n\n        removeChildren(stabHolder);\n        var pageHolder = makeElement('div', null, {}, {paddingLeft: '10px', paddingRight: '10px'});\n        pageHolder.appendChild(makeElement('h3', 'Add custom URL-based data'));\n        pageHolder.appendChild(makeElement('p', ['You can add indexed binary data hosted on an web server that supports CORS (', makeElement('a', 'full details', {href: 'http://www.biodalliance.org/bin.html'}), ').  Currently supported formats are bigwig, bigbed, and indexed BAM.']));\n\n        pageHolder.appendChild(makeElement('br'));\n        pageHolder.appendChild(document.createTextNode('URL: '));\n        custURL = makeElement('input', '', {size: 80, value: 'http://www.biodalliance.org/datasets/ensGene.bb'}, {width: '100%'});\n        pageHolder.appendChild(custURL);\n        \n        pageHolder.appendChild(makeElement('br'));\n        pageHolder.appendChild(makeElement('b', '- or -'));\n        pageHolder.appendChild(makeElement('br'));\n        pageHolder.appendChild(document.createTextNode('File: '));\n        custFile = makeElement('input', null, {type: 'file', multiple: 'multiple'});\n        pageHolder.appendChild(custFile);\n        \n        pageHolder.appendChild(makeElement('p', 'Clicking the \"Add\" button below will initiate a series of test queries.'));\n\n        stabHolder.appendChild(pageHolder);\n        custURL.focus();\n    }\n\n    function switchToHubConnectMode() {\n        activateButton(addModeButtons, addHubButton);\n        refreshButton.style.display = 'none';\n        addButton.style.display = 'inline';\n        canButton.style.display = 'none';\n\n        customMode = 'hub-connect';\n        refreshButton.style.visibility = 'hidden';\n\n        removeChildren(stabHolder);\n\n        var pageHolder = makeElement('div', null, {}, {paddingLeft: '10px', paddingRight: '10px'});\n        pageHolder.appendChild(makeElement('h3', 'Connect to a track hub.'));\n        pageHolder.appendChild(makeElement('p', ['Enter the top-level URL (usually points to a file called \"hub.txt\") of a UCSC-style track hub']));\n        \n        custURL = makeElement('input', '', {size: 120, value: 'http://www.biodalliance.org/datasets/testhub/hub.txt'}, {width: '100%'});\n        pageHolder.appendChild(custURL);\n        \n        stabHolder.appendChild(pageHolder);\n        \n        custURL.focus();\n    }\n\n    custButton.addEventListener('click', function(ev) {\n        ev.preventDefault(); ev.stopPropagation();\n        switchToCustomMode();\n    }, false);\n\n    function switchToCustomMode() {\n        activateButton(addModeButtons, custButton);\n        refreshButton.style.display = 'none';\n        addButton.style.display = 'inline';\n        canButton.style.display = 'none';\n\n        customMode = 'das';\n\n        removeChildren(stabHolder);\n\n        var customForm = makeElement('div', null, {},  {paddingLeft: '10px', paddingRight: '10px'});\n        customForm.appendChild(makeElement('h3', 'Add custom DAS data'));\n        customForm.appendChild(makeElement('p', 'This interface is intended for adding custom or lab-specific data.  Public data can be added more easily via the registry interface.'));\n                \n        customForm.appendChild(document.createTextNode('URL: '));\n        customForm.appendChild(makeElement('br'));\n        custURL = makeElement('input', '', {size: 80, value: 'http://www.derkholm.net:8080/das/medipseq_reads/'}, {width: '100%'});\n        customForm.appendChild(custURL);\n\n        customForm.appendChild(makeElement('p', 'Clicking the \"Add\" button below will initiate a series of test queries.  If the source is password-protected, you may be prompted to enter credentials.'));\n        stabHolder.appendChild(customForm);\n\n        custURL.focus();\n    }\n\n\n\n    var addButton = makeElement('button', 'Add', {className: 'btn btn-primary'});\n    addButton.addEventListener('click', function(ev) {\n        ev.stopPropagation(); ev.preventDefault();\n        doAdd();\n    }, false);\n\n    function doAdd() {\n        if (customMode) {\n            if (customMode === 'das') {\n                var curi = custURL.value.trim();\n                if (!/^.+:\\/\\//.exec(curi)) {\n                    curi = 'http://' + curi;\n                }\n                var nds = new DASSource({name: 'temporary', uri: curi});\n                tryAddDAS(nds);\n            } else if (customMode === 'bin') {\n                var fileList = custFile.files;\n\n                if (fileList && fileList.length > 0) {\n                    tryAddMultiple(fileList);\n                } else {\n                    var curi = custURL.value.trim();\n                    if (!/^.+:\\/\\//.exec(curi)) {\n                        curi = 'http://' + curi;\n                    }\n                    var source = {uri: curi};\n                    var lcuri = curi.toLowerCase();\n                    if (lcuri.indexOf(\"https://www.encodeproject.org/\") == 0 &&\n                        lcuri.indexOf(\"@@download\") >= 0) \n                    {\n                        source.transport = 'encode';\n                    }\n                    tryAddBin(source);\n                }\n            } else if (customMode === 'reset') {\n                switchToCustomMode();\n            } else if (customMode === 'reset-bin') {\n                switchToBinMode(); \n            } else if (customMode === 'reset-hub') {\n                switchToHubConnectMode();\n            } else if (customMode === 'prompt-bai') {\n                var fileList = custFile.files;\n                if (fileList && fileList.length > 0 && fileList[0]) {\n                    dataToFinalize.baiBlob = fileList[0];\n                    completeBAM(dataToFinalize);\n                } else {\n                    promptForBAI(dataToFinalize);\n                }\n            } else if (customMode === 'prompt-tbi') {\n                var fileList = custFile.files;\n                if (fileList && fileList.length > 0 && fileList[0]) {\n                    dataToFinalize.indexBlob = fileList[0];\n                    completeTabixVCF(dataToFinalize);\n                } else {\n                    promptForTabix(dataToFinalize);\n                }\n            } else if (customMode === 'finalize' || customMode === 'finalize-bin') {\n                dataToFinalize.name = custName.value;\n                var m = custCS.value;\n                if (m != '__default__') {\n                    dataToFinalize.mapping = m;\n                } else {\n                    dataToFinalize.mapping = undefined;\n                }\n                if (custQuant) {\n                    dataToFinalize.maxbins = custQuant.checked;\n                }\n\n                if (custUser.value.length > 1 && custPass.value.length > 1) {\n                    dataToFinalize.xUser = custUser.value;\n                    dataToFinalize.xPass = custPass.value;\n                }\n\n                thisB.addTier(dataToFinalize);\n\n                if (customMode == 'finalize-bin')\n                    switchToBinMode();\n                else\n                    switchToCustomMode();\n            } else if (customMode === 'hub-connect') {\n                var curi = custURL.value.trim();\n                if (!/^.+:\\/\\//.exec(curi)) {\n                    curi = 'http://' + curi;\n                }\n                \n                tryAddHub(curi);\n            } else if (customMode === 'multiple') {\n                for (var mi = 0; mi < multipleSet.length; ++mi) {\n                    var s = multipleSet[mi];\n                    if (s.hidden)\n                        continue;\n\n                    if (s.tier_type == 'bam' && !s.indexBlob && !s.indexUri)\n                        continue;\n                    if (s.tier_type == 'tabix' && !s.indexBlob && !s.indexUri)\n                        continue;\n\n                    var nds = makeSourceConfig(s);\n                    if (nds) {\n                        nds.noPersist = true;\n                        thisB.addTier(nds);\n                    }\n                }\n\n                switchToBinMode();\n            }\n        } else {\n            thisB.removeAllPopups();\n        }\n    };\n\n    function tryAddHub(curi, opts, retry) {\n        opts = opts || {};\n        for (var hi = 0; hi < thisB.hubObjects.length; ++hi) {\n            var h = thisB.hubObjects[hi];\n            if (h.hub.url == curi) {\n                for (var bi = 0; bi < addModeButtons.length; ++bi) {\n                    if (addModeButtons[bi].hub == h) {\n                        activateButton(addModeButtons, addModeButtons[bi]);\n                    }\n                }\n                h.getTracks(function(tracks, err) {\n                    if (err) {\n                        console.log(err);\n                    }\n                    makeHubStab(tracks);\n                });\n                return;\n            }\n\n        }\n        \n        connectTrackHub(curi, function(hub, err) {\n            if (err) {\n                if (!retry) {\n                    return tryAddHub(curi, {credentials: true}, true);\n                }\n                removeChildren(stabHolder);\n                stabHolder.appendChild(makeElement('h2', 'Error connecting to track hub'))\n                stabHolder.appendChild(makeElement('p', err));\n                customMode = 'reset-hub';\n                return;\n            } else {\n                var bestHub = null;\n                var bestHubButton = null;\n                for (var genome in hub.genomes) {\n                    var mapping = null;\n                    var okay = false;\n\n                    if (genome == thisB.coordSystem.ucscName) {\n                        okay = true;\n                    } else {\n                         for (var mid in thisB.chains) {\n                            var m = thisB.chains[mid];\n                            if (genome == m.coords.ucscName) {\n                                mapping = mid;\n                                okay = true;\n                            }\n                         }\n                    }\n\n                    if (okay) {\n                        var hc = {url: curi, genome: genome};\n                        if (opts.credentials)\n                            hc.credentials = true;\n                        if (mapping) {\n                            hc.mapping = mapping;\n                            hub.genomes[genome].mapping = mapping;\n                        }\n                        thisB.hubs.push(hc);\n                        thisB.hubObjects.push(hub.genomes[genome]);\n                        \n                        var hubButton = makeHubButton(hub.genomes[genome]);\n                        modeButtonHolder.appendChild(hubButton);\n\n                        if (!mapping || !bestHub) {\n                            bestHub = hub.genomes[genome];\n                            bestHubButton = hubButton;\n                        }\n                    }\n                }\n\n                if (bestHub) {\n                    thisB.notifyTier();\n                    activateButton(addModeButtons, bestHubButton);\n                    bestHub.getTracks(function(tracks, err) {\n                        makeHubStab(tracks);\n                    });\n                } else {\n                    removeChildren(stabHolder);\n                    stabHolder.appendChild(makeElement('h2', 'No data for this genome'))\n                    stabHolder.appendChild(makeElement('p', 'This URL appears to be a valid track-hub, but it doesn\\'t contain any data for the coordinate system of this browser'));\n                    stabHolder.appendChild(makeElement('p', 'coordSystem.ucscName = ' + thisB.coordSystem.ucscName));\n                    customMode = 'reset-hub';\n                    return;\n                }\n            }\n        }, opts);\n    }\n\n    var tryAddDAS = function(nds, retry) {\n        var knownSpace = thisB.knownSpace;\n        if (!knownSpace) {\n            alert(\"Can't confirm track-addition to an uninit browser.\");\n            return;\n        }\n        var tsm = Math.max(knownSpace.min, (knownSpace.min + knownSpace.max - 100) / 2)|0;\n        var testSegment = new DASSegment(knownSpace.chr, tsm, Math.min(tsm + 99, knownSpace.max));\n        nds.features(testSegment, {}, function(features, status) {\n            if (status) {\n                if (!retry) {\n                    nds.credentials = true;\n                    tryAddDAS(nds, true);\n                } else {\n                    removeChildren(stabHolder);\n                    stabHolder.appendChild(makeElement('h2', 'Custom data not found'));\n                    stabHolder.appendChild(makeElement('p', 'DAS uri: ' + nds.uri + ' is not answering features requests'));\n                    customMode = 'reset';\n                    return;\n                }\n            } else {\n                var nameExtractPattern = new RegExp('/([^/]+)/?$');\n                var match = nameExtractPattern.exec(nds.uri);\n                if (match) {\n                    nds.name = match[1];\n                }\n\n                tryAddDASxSources(nds);\n                return;\n            }\n        });\n    }\n\n    function tryAddDASxSources(nds, retry) {\n        var uri = nds.uri;\n        if (retry) {\n            var match = /(.+)\\/[^\\/]+\\/?/.exec(uri);\n            if (match) {\n                uri = match[1] + '/sources';\n            }\n        }\n        function sqfail() {\n            if (!retry) {\n                return tryAddDASxSources(nds, true);\n            } else {\n                return addDasCompletionPage(nds);\n            }\n        }\n        new DASRegistry(uri, {credentials: nds.credentials}).sources(\n            function(sources) {\n                if (!sources || sources.length == 0) {\n                    return sqfail();\n                } \n\n                var fs = null;\n                if (sources.length == 1) {\n                    fs = sources[0];\n                } else {\n                    for (var i = 0; i < sources.length; ++i) {\n                        if (sources[i].uri === nds.uri) {\n                            fs = sources[i];\n                            break;\n                        }\n                    }\n                }\n\n                var coordsDetermined = false, quantDetermined = false;\n                if (fs) {\n                    nds.name = fs.name;\n                    nds.desc = fs.desc;\n                    if (fs.maxbins) {\n                        nds.maxbins = true;\n                    } else {\n                        nds.maxbins = false;\n                    }\n                    if (fs.capabilities) {\n                        nds.capabilities = fs.capabilities;\n                    }\n                    quantDetermined = true\n                    \n                    if (fs.coords && fs.coords.length == 1) {\n                        var coords = fs.coords[0];\n                        if (coordsMatch(coords, thisB.coordSystem)) {\n                            coordsDetermined = true;\n                        } else if (thisB.chains) {\n                            for (var k in thisB.chains) {\n                                if (coordsMatch(coords, thisB.chains[k].coords)) {\n                                    nds.mapping = k;\n                                    coordsDetermined = true;\n                                }\n                            }\n                        }\n                    }\n                    \n                }\n                return addDasCompletionPage(nds, coordsDetermined, quantDetermined);\n            },\n            function() {\n                return sqfail();\n            }\n        );\n    }\n\n    var makeSourceConfig = function(s) {\n        var nds = {name: s.name};\n        if (s.credentials)\n            nds.credentials = s.credentials;\n        \n        if (s.mapping && s.mapping != '__default__')\n            nds.mapping = s.mapping;\n\n        if (s.transport)\n            nds.transport = s.transport;\n\n        if (s.tier_type == 'bwg') {\n            if (s.blob)\n                nds.bwgBlob = s.blob;\n            else if (s.uri)\n                nds.bwgURI = s.uri;\n            return nds;\n        } else if (s.tier_type == 'bam') {\n            if (s.blob) {\n                nds.bamBlob = s.blob;\n                nds.baiBlob = s.indexBlob;\n            } else {\n                nds.bamURI = s.uri;\n                nds.baiURI = s.indexUri;\n            }\n            return nds;\n        } else if (s.tier_type == 'tabix') {\n            nds.tier_type = 'tabix';\n            nds.payload = s.payload;\n            if (s.blob) {\n                nds.blob = s.blob;\n                nds.indexBlob = s.indexBlob;\n            } else {\n                nds.uri = s.uri;\n                nds.indexUri = s.indexUri;\n            }\n            return nds;\n        } else if (s.tier_type == 'memstore') {\n            nds.tier_type = 'memstore';\n            nds.payload = s.payload;\n            if (s.blob)\n                nds.blob = s.blob;\n            else\n                nds.uri = s.uri;\n            return nds;\n        }\n    }\n\n    var tryAddBin = function(source) {\n        probeResource(source, function(source, err) {\n            if (err) {\n                removeChildren(stabHolder);\n                var tabError = makeElement('div');\n                tabError.appendChild(makeElement('h2', \"Couldn't access custom data\"));\n                tabError.appendChild(makeElement('p', '' + err));\n                stabHolder.appendChild(tabError);\n                console.log(source);\n                if (window.location.protocol === 'https:' && source.uri.indexOf('http:') == 0) {\n                    thisB.canFetchPlainHTTP().then(\n                        function(can) {\n                            if (!can) {\n                                tabError.appendChild(\n                                    makeElement('p', [\n                                        makeElement('strong', 'HTTP warning: '),\n                                        'you may not be able to access HTTP resources from an instance of Biodalliance which you are accessing via HTTPS.',\n                                        makeElement('a', '[More info]', {href: thisB.httpWarningURL, target: \"_blank\"})\n                                      ]\n                                   )\n                                );\n                            }\n                        }\n                    );\n                }\n                customMode = 'reset-bin';\n            } else {\n                var nds = makeSourceConfig(source);\n                if (source.tier_type == 'bam') {\n                    return completeBAM(nds);\n                } else if (source.tier_type == 'tabix') {\n                    return completeTabixVCF(nds);\n                } else {\n                    return addDasCompletionPage(nds, false, false, true);\n                }\n            }\n        });\n    }\n\n    function promptForBAI(nds) {\n        refreshButton.style.display = 'none';\n        addButton.style.display = 'inline';\n        canButton.style.display = 'inline';\n\n        removeChildren(stabHolder);\n        customMode = 'prompt-bai'\n        stabHolder.appendChild(makeElement('h2', 'Select an index file'));\n        stabHolder.appendChild(makeElement('p', 'Dalliance requires a BAM index (.bai) file when displaying BAM data.  These normally accompany BAM files.  For security reasons, web applications like Dalliance can only access local files which you have explicity selected.  Please use the file chooser below to select the appropriate BAI file'));\n\n        stabHolder.appendChild(document.createTextNode('Index file: '));\n        custFile = makeElement('input', null, {type: 'file'});\n        stabHolder.appendChild(custFile);\n        dataToFinalize = nds;\n    }\n\n    function promptForTabix(nds) {\n        refreshButton.style.display = 'none';\n        addButton.style.display = 'inline';\n        canButton.style.display = 'inline';\n\n        removeChildren(stabHolder);\n        customMode = 'prompt-tbi'\n        stabHolder.appendChild(makeElement('h2', 'Select an index file'));\n        stabHolder.appendChild(makeElement('p', 'Dalliance requires a Tabix index (.tbi) file when displaying VCF data.  For security reasons, web applications like Dalliance can only access local files which you have explicity selected.  Please use the file chooser below to select the appropriate BAI file'));\n\n        stabHolder.appendChild(document.createTextNode('Index file: '));\n        custFile = makeElement('input', null, {type: 'file'});\n        stabHolder.appendChild(custFile);\n        dataToFinalize = nds;\n    }\n\n    function completeBAM(nds) {\n        var indexF;\n        if (nds.baiBlob) \n            indexF = new BlobFetchable(nds.baiBlob);\n        else if (nds.transport == 'encode')\n            indexF = new EncodeFetchable(nds.bamURI + '.bai');\n        else\n            indexF = new URLFetchable(nds.bamURI + '.bai', {credentials: nds.credentials});\n\n        indexF.slice(0, 256).fetch(function(r) {\n                var hasBAI = false;\n                if (r) {\n                    var ba = new Uint8Array(r);\n                    var magic2 = readInt(ba, 0);\n                    hasBAI = (magic2 == BAI_MAGIC);\n                }\n                if (hasBAI) {\n                    return addDasCompletionPage(nds, false, false, true);\n                } else {\n                    return binFormatErrorPage('You have selected a valid BAM file, but a corresponding index (.bai) file was not found.  Please index your BAM (samtools index) and place the BAI file in the same directory');\n                }\n        });\n    }\n\n    function completeTabixVCF(nds) {\n        var indexF;\n        if (nds.indexBlob) {\n            indexF = new BlobFetchable(nds.indexBlob);\n        } else {\n            indexF = new URLFetchable(nds.uri + '.tbi');\n        }\n        indexF.slice(0, 1<<16).fetch(function(r) {\n            var hasTabix = false;\n            if (r) {\n                var ba = new Uint8Array(r);\n                if (ba[0] == 31 || ba[1] == 139) {\n                    var unc = unbgzf(r);\n                    ba = new Uint8Array(unc);\n                    var m2 = readInt(ba, 0);\n                    hasTabix = (m2 == TABIX_MAGIC);\n                }\n            }\n            if (hasTabix) {\n                return addDasCompletionPage(nds, false, false, true);\n            } else {\n                return binFormatErrorPage('You have selected a valid VCF file, but a corresponding index (.tbi) file was not found.  Please index your VCF (\"tabix -p vcf -f myfile.vcf.gz\") and place the .tbi file in the same directory');\n            }\n        });\n    }\n\n    function binFormatErrorPage(message) {\n        refreshButton.style.display = 'none';\n        addButton.style.display = 'inline';\n        canButton.style.display = 'inline';\n\n        removeChildren(stabHolder);\n        message = message || 'Custom data format not recognized';\n        stabHolder.appendChild(makeElement('h2', 'Error adding custom data'));\n        stabHolder.appendChild(makeElement('p', message));\n        stabHolder.appendChild(makeElement('p', 'Currently supported formats are bigBed, bigWig, and BAM.'));\n        customMode = 'reset-bin';\n        return;\n    }\n                     \n    var addDasCompletionPage = function(nds, coordsDetermined, quantDetermined, quantIrrelevant) {\n        refreshButton.style.display = 'none';\n        addButton.style.display = 'inline';\n        canButton.style.display = 'inline';\n\n        removeChildren(stabHolder);\n        stabHolder.appendChild(makeElement('h2', 'Add custom data: step 2'));\n        stabHolder.appendChild(document.createTextNode('Label: '));\n        custName = makeElement('input', '', {value: nds.name});\n        stabHolder.appendChild(custName);\n\n\n        // stabHolder.appendChild(document.createTextNode('User: '));\n        custUser = makeElement('input', '');\n        // stabHolder.appendChild(custUser);\n        //stabHolder.appendChild(document.createTextNode('Pass: '));\n        custPass = makeElement('input', '');\n        // stabHolder.appendChild(custPass);\n        \n\n        stabHolder.appendChild(makeElement('br'));\n        stabHolder.appendChild(makeElement('br'));\n        stabHolder.appendChild(makeElement('h4', 'Coordinate system: '));\n        custCS = makeElement('select', null);\n        custCS.appendChild(makeElement('option', thisB.nameForCoordSystem(thisB.coordSystem), {value: '__default__'}));\n        if (thisB.chains) {\n            for (var csk in thisB.chains) {\n                var cs = thisB.chains[csk].coords;\n                custCS.appendChild(makeElement('option', thisB.nameForCoordSystem(cs), {value: csk}));\n            }\n        }\n        custCS.value = nds.mapping || '__default__';\n        stabHolder.appendChild(custCS);\n\n        if (coordsDetermined) {\n            stabHolder.appendChild(makeElement('p', \"(Based on server response, probably doesn't need changing.)\"));\n        } else {\n            stabHolder.appendChild(makeElement('p', [makeElement('b', 'Warning: '), \"unable to determine the correct value from server responses.  Please check carefully.\"]));\n            stabHolder.appendChild(makeElement('p', \"If you don't see the mapping you're looking for, please contact thomas@biodalliance.org\"));\n        }\n\n        if (!quantIrrelevant) {\n            stabHolder.appendChild(document.createTextNode('Quantitative: '));\n            custQuant = makeElement('input', null, {type: 'checkbox', checked: true});\n            if (typeof nds.maxbins !== 'undefined') {\n                custQuant.checked = nds.maxbins;\n            }\n            stabHolder.appendChild(custQuant);\n            if (quantDetermined) {\n                stabHolder.appendChild(makeElement('p', \"(Based on server response, probably doesn't need changing.)\"));\n            } else {\n                stabHolder.appendChild(makeElement('p', [makeElement('b', \"Warning: \"), \"unable to determine correct value.  If in doubt, leave checked.\"]));\n            }\n        }\n\n        if (nds.bwgBlob) {\n            stabHolder.appendChild(makeElement('p', [makeElement('b', 'Warning: '), 'data added from local file.  Due to the browser security model, the track will disappear if you reload Dalliance.']));\n        }\n\n        custName.focus();\n\n        if (customMode === 'bin' || customMode === 'prompt-bai' || customMode === 'prompt-tbi')\n            customMode = 'finalize-bin';\n        else\n            customMode = 'finalize';\n        dataToFinalize = nds;\n    }\n\n    var multipleSet = null;\n    var tryAddMultiple = function(fileList) {\n        var newSources = multipleSet = [];\n        customMode = 'multiple';\n        for (var fi = 0; fi < fileList.length; ++fi) {\n            var f = fileList[fi];\n            if (f) {\n                newSources.push({blob: f});\n            }\n        }\n\n        for (var fi = 0; fi < newSources.length; ++fi) {\n            probeMultiple(newSources[fi]);\n        }\n        updateMultipleStatus();\n    }\n\n    var probeMultiple = function(ns) {\n        probeResource(ns, function(source, err) {\n            if (err) {\n                source.error = err;\n            }\n\n            var usedIndices = [];\n            var bams = {}, tabixes = {};\n            for (var si = 0; si < multipleSet.length; ++si) {\n                var s = multipleSet[si];\n                if (s.tier_type == 'bam' && !s.indexBlob) {\n                    bams[s.blob.name] = s;\n                }\n                if (s.tier_type == 'tabix' && !s.indexBlob) {\n                    tabixes[s.blob.name] = s;\n                }\n            }\n\n            for (var si = 0; si < multipleSet.length; ++si) {\n                var s = multipleSet[si];\n                if (s.tier_type === 'bai') {\n                    var baiPattern = new RegExp('(.+)\\\\.bai$');\n                    var match = baiPattern.exec(s.blob.name);\n                    if (match && bams[match[1]]) {\n                        bams[match[1]].indexBlob = s.blob;\n                        usedIndices.push(si);\n                    }\n                } else if (s.tier_type === 'tabix-index') {\n                    var tbiPattern = new RegExp('(.+)\\\\.tbi$');\n                    var match = tbiPattern.exec(s.blob.name);\n                    if (match && tabixes[match[1]]) {\n                        tabixes[match[1]].indexBlob = s.blob;\n                        usedIndices.push(si);\n                    }\n                }\n            }\n\n            for (var bi = usedIndices.length - 1; bi >= 0; --bi) {\n                multipleSet.splice(usedIndices[bi], 1);\n            }\n\n            updateMultipleStatus();\n        });\n    }\n\n    var updateMultipleStatus = function() {\n        removeChildren(stabHolder);\n        var needsIndex = false;\n        var multTable = makeElement('table', multipleSet\n          .filter(function(s) {return !s.hidden})\n          .map(function(s) {\n            var row = makeElement('tr');\n            row.appendChild(makeElement('td', s.name || s.blob.name));\n            var typeContent;\n            if (s.error) {\n                typeContent = makeElement('span', 'Error', null, {color: 'red'});\n            } else if (s.tier_type) {\n                typeContent = s.payload || s.tier_type;\n            } else {\n                typeContent = thisB.makeLoader(16);\n            }\n\n            var ccs;\n            var state = 'unknown';\n            if (s.tier_type == 'bwg' || s.tier_type == 'memstore') {\n                state = 'okay';\n            } else if (s.tier_type == 'bam') {\n                state = s.indexBlob ? 'okay' : 'needs-index';\n            } else if (s.tier_type == 'tabix') {\n                state = s.indexBlob ? 'okay' : 'needs-index';\n            }\n\n            if (state == 'okay') {\n                ccs = makeElement('select', null, null, {width: '150px'});\n                ccs.appendChild(makeElement('option', thisB.nameForCoordSystem(thisB.coordSystem), {value: '__default__'}));\n                if (thisB.chains) {\n                    for (var csk in thisB.chains) {\n                        var cs = thisB.chains[csk].coords;\n                        ccs.appendChild(makeElement('option', thisB.nameForCoordSystem(cs), {value: csk}));\n                    }\n                }\n                ccs.value = s.mapping || '__default__';\n\n                ccs.addEventListener('change', function(ev) {\n                    s.mapping = ccs.value;\n                    console.log(s);\n                }, false);\n            } else if (state == 'needs-index') {\n                ccs = makeElement('span', 'Needs index', {}, {color: 'red'});\n                needsIndex = true;\n            }\n\n            return makeElement('tr', [makeElement('td', s.name || s.blob.name),\n                                      makeElement('td', typeContent),\n                                      makeElement('td', ccs)]);\n\n        }), {className: 'table table-striped table-condensed'});\n        stabHolder.appendChild(multTable);\n\n        if (needsIndex) {\n            stabHolder.appendChild(makeElement('p', 'Some of these files are missing required index (.bai or .tbi) files.  For security reasons, web applications like Dalliance can only access local files which you have explicity selected.  Please use the file chooser below to select the appropriate index file'));\n            stabHolder.appendChild(document.createTextNode('Index file(s): '));\n            var indexFile = makeElement('input', null, {type: 'file', multiple: 'multiple'});\n            stabHolder.appendChild(indexFile);\n            indexFile.addEventListener('change', function(ev) {\n                console.log('fileset changed');\n                var fileList = indexFile.files || [];\n                for (var fi = 0; fi < fileList.length; ++fi) {\n                    var f = fileList[fi];\n                    if (f) {\n                        var ns = {blob: f, hidden: true};\n                        multipleSet.push(ns);\n                        probeMultiple(ns);\n                    }\n                }\n            }, false);\n        }\n    }\n\n    var canButton = makeElement('button', 'Cancel', {className: 'btn'});\n    canButton.addEventListener('click', function(ev) {\n        ev.stopPropagation(); ev.preventDefault();\n        if (customMode === 'finalize-bin')\n            switchToBinMode();\n        else\n            switchToCustomMode();\n    }, false);\n\n    var refreshButton = makeElement('button', 'Refresh', {className: 'btn'});\n    refreshButton.addEventListener('click', function(ev) {\n        ev.stopPropagation(); ev.preventDefault();\n        thisB.queryRegistry(__mapping);\n    }, false);\n    this.makeTooltip(refreshButton, 'Click to re-fetch data from the DAS registry');\n\n    var buttonHolder = makeElement('div', [addButton, ' ', canButton, ' ', refreshButton]);\n    buttonHolder.style.margin = '10px';\n    asform.appendChild(buttonHolder);\n\n    popup.appendChild(asform);\n    makeStab(thisB.availableSources);\n\n    this.showToolPanel(popup);\n    this.setUiMode('add');\n\n    if (firstDefButton) {\n        activateButton(addModeButtons, firstDefButton);\n        makeStab(new Observed(firstDefSources));\n    }\n}\n","/* -*- mode: javascript; c-basic-offset: 4; indent-tabs-mode: nil -*- */\n\n// \n// Dalliance Genome Explorer\n// (c) Thomas Down 2006-2010\n//\n// trix.js: UCSC-style free text indices\n//\n\n\"use strict\";\n\nfunction connectTrix(ix, ixx, callback) {\n    ixx.fetchAsText(function(ixxData) {\n        if (!ixxData) \n            return callback(null, \"Couldn't fetch index-index\");\n\n        var toks = ixxData.split(/(.+)([0-9A-F]{10})\\n/);\n\n        var keys = [];\n        var offsets = [];\n        for (var ti = 1; ti < toks.length; ti += 3) {\n            keys.push(toks[ti]);\n            offsets.push(parseInt(toks[ti+1], 16));\n        }\n\n        return callback(new TrixIndex(keys, offsets, ix));\n    });\n}\n\nfunction TrixIndex(keys, offsets, ix) {\n    this.keys = keys;\n    this.offsets = offsets;\n    this.ix = ix;\n}\n\nTrixIndex.prototype.lookup = function(query, callback) {\n    var ixslice;\n\n    var qtag = (query + '     ').substring(0,5).toLowerCase();\n    for (var i = 0; i < this.keys.length; ++i) {\n        if (qtag.localeCompare(this.keys[i]) < 0) {\n            ixslice = this.ix.slice(this.offsets[i - 1], this.offsets[i] - this.offsets[i - 1]);\n            break;\n        }\n    }\n\n    if (!ixslice) {\n        ixslice = this.ix.slice(this.offsets[this.offsets.length - 1]);\n    }\n\n    ixslice.fetchAsText(function(ist) {\n        var lines = ist.split('\\n');\n        for (var li = 0; li < lines.length; ++li) {\n            if (lines[li].indexOf(query.toLowerCase() + ' ') == 0) {\n                return callback(lines[li].split(' '));\n            }\n        }\n        return callback(null);\n    });\n}\n\nif (typeof(module) !== 'undefined') {\n    module.exports = {\n        connectTrix: connectTrix\n    };\n}","/* -*- mode: javascript; c-basic-offset: 4; indent-tabs-mode: nil -*- */\n\n// \n// Dalliance Genome Explorer\n// (c) Thomas Down 2006-2010\n//\n// twoBit.js: packed-binary reference sequences\n//\n\n\"use strict\";\n\nif (typeof(require) !== 'undefined') {\n    var bin = require('./bin');\n    var readInt = bin.readInt;\n    var readIntBE = bin.readIntBE;\n\n    var spans = require('./spans');\n    var Range = spans.Range;\n    var union = spans.union;\n    var intersection = spans.intersection;\n}\n\nvar TWOBIT_MAGIC = 0x1a412743;\nvar TWOBIT_MAGIC_BE = 0x4327411a;\nvar HEADER_BLOCK_SIZE = 12500;\n\nfunction TwoBitFile() {\n}\n\nfunction makeTwoBit(fetchable, cnt) {\n    var tb = new TwoBitFile();\n    tb.data = fetchable;\n    var headerBlockSize = HEADER_BLOCK_SIZE;\n    var headerBlocksFetched=0;\n    \n    tb.data.slice(0, headerBlockSize).fetch(function(r) {\n        if (!r) {\n            return cnt(null, \"Couldn't access data\");\n        }\n        var ba = new Uint8Array(r);\n        var magic = readInt(ba, 0);\n        if (magic == TWOBIT_MAGIC) {\n            tb.readInt = readInt;\n        } else if (magic == TWOBIT_MAGIC_BE) {\n            tb.readInt = readIntBE;\n        } else {\n            return cnt(null, \"Not a .2bit file, magic=0x\" + magic.toString(16));\n        }\n\n        var version = tb.readInt(ba, 4);\n        if (version != 0) {\n            return cnt(null, 'Unsupported version ' + version);\n        }\n\n        tb.seqCount = tb.readInt(ba, 8);\n        tb.seqDict = {};\n\n        var p = 16, i=0;\n        var o = 0;  // Offset of the current block if we need to fetch multiple header blocks.\n\n        var parseSeqInfo = function() {\n            while (i < tb.seqCount) {\n                var ns = ba[p];\n                if (p + ns + 6 >= ba.length) {\n                    headerBlocksFetched += headerBlockSize;\n                    headerBlockSize = Math.max(HEADER_BLOCK_SIZE,Math.floor(headerBlocksFetched*tb.seqCount/i));\n                    return tb.data.slice(o + p, headerBlockSize).fetch(function (r) {\n                        o += p;\n                        p = 0;\n                        ba = new Uint8Array(r);\n                        parseSeqInfo();\n                    });\n                } else {\n                    ++p;\n                    var name = '';\n                    for (var j = 1; j <= ns; ++j) {\n                        name += String.fromCharCode(ba[p++]);\n                    }\n                    var offset = tb.readInt(ba, p);\n                    p += 4;\n                    tb.seqDict[name] = new TwoBitSeq(tb, offset);\n                    ++i;\n                }\n            }\n            return cnt(tb);\n        }\n\n        parseSeqInfo();\n        \n    });\n}\n\nTwoBitFile.prototype.getSeq = function(chr) {\n    var seq = this.seqDict[chr];\n    if (!seq) {\n        seq = this.seqDict['chr' + chr];\n    }\n    return seq;\n}\n\nTwoBitFile.prototype.fetch = function(chr, min, max, cnt) {\n    var seq = this.getSeq(chr);\n    if (!seq) {\n        return cnt(null, \"Couldn't find \" + chr);\n    } else if (max <= min) {\n        return cnt('');\n    } else {\n        seq.fetch(min, max, cnt);\n    }\n}\n\nfunction TwoBitSeq(tbf, offset) {\n    this.tbf = tbf;\n    this.offset = offset;\n}\n\nTwoBitSeq.prototype.init = function(cnt) {\n    if (this.seqOffset) {\n        return cnt();\n    }\n\n    var thisB = this;\n    thisB.tbf.data.slice(thisB.offset, 8).fetch(function(r1) {\n        if (!r1) {\n            return cnt('Fetch failed');\n        }\n        var ba = new Uint8Array(r1);\n        thisB._length = thisB.tbf.readInt(ba, 0);\n        thisB.nBlockCnt = thisB.tbf.readInt(ba, 4);\n        thisB.tbf.data.slice(thisB.offset + 8, thisB.nBlockCnt*8 + 4).fetch(function(r2) {\n            if (!r2) {\n                return cnt('Fetch failed');\n            }\n            var ba = new Uint8Array(r2);\n            var nbs = null;\n            for (var b = 0; b < thisB.nBlockCnt; ++b) {\n                var nbMin = thisB.tbf.readInt(ba, b * 4);\n                var nbLen = thisB.tbf.readInt(ba, (b + thisB.nBlockCnt) * 4);\n                var nb = new Range(nbMin, nbMin + nbLen - 1);\n                if (!nbs) {\n                    nbs = nb;\n                } else {\n                    nbs = union(nbs, nb);\n                }\n            }\n            thisB.nBlocks = nbs;\n            thisB.mBlockCnt = thisB.tbf.readInt(ba, thisB.nBlockCnt*8);\n            thisB.seqLength = ((thisB._length + 3)/4)|0;\n            thisB.seqOffset = thisB.offset + 16 + ((thisB.nBlockCnt + thisB.mBlockCnt) * 8);\n            return cnt();\n        });\n    });\n}\n\nvar TWOBIT_TABLE = ['T', 'C', 'A', 'G'];\n\nTwoBitSeq.prototype.fetch = function(min, max, cnt) {\n    --min; --max;       // Switch to zero-based.\n    var thisB = this;\n    this.init(function(error) {\n        if (error) {\n            return cnt(null, error);\n        }\n\n        var fetchMin = min >> 2;\n        var fetchMax = max + 3 >> 2;\n        if (fetchMin < 0 || fetchMax > thisB.seqLength) {\n            return cnt('Coordinates out of bounds: ' + min + ':' + max);\n        }\n\n        thisB.tbf.data.slice(thisB.seqOffset + fetchMin, fetchMax - fetchMin).salted().fetch(function(r) {\n            if (r == null) {\n                return cnt('SeqFetch failed');\n            }\n            var seqData = new Uint8Array(r);\n\n            var nSpans = [];\n            if (thisB.nBlocks) {\n                var intr = intersection(new Range(min, max), thisB.nBlocks);\n                if (intr) {\n                    nSpans = intr.ranges();\n                }\n            }\n            \n            var seqstr = '';\n            var ptr = min;\n            function fillSeq(fsm) {\n                while (ptr <= fsm) {\n                    var bb = (ptr >> 2) - fetchMin;\n                    var ni = ptr & 0x3;\n                    var bv = seqData[bb];\n                    var n;\n                    if (ni == 0) {\n                        n = (bv >> 6) & 0x3;\n                    } else if (ni == 1) {\n                        n = (bv >> 4) & 0x3;\n                    } else if (ni == 2) {\n                        n = (bv >> 2) & 0x3;\n                    } else {\n                        n = (bv) & 0x3;\n                    }\n                    seqstr += TWOBIT_TABLE[n];\n                    ++ptr;\n                }\n            }\n            \n            for (var b = 0; b < nSpans.length; ++b) {\n                var nb = nSpans[b];\n                if (ptr > nb.min()) {\n                    throw 'N mismatch...';\n                }\n                if (ptr < nb.min()) {\n                    fillSeq(nb.min() - 1);\n                }\n                while (ptr <= nb.max()) {\n                    seqstr += 'N';\n                    ++ptr;\n                }\n            }\n            if (ptr <= max) {\n                fillSeq(max);\n            }\n            return cnt(seqstr);\n        });\n    });\n}\n\nTwoBitSeq.prototype.length = function(cnt) {\n    var thisB = this;\n    this.init(function(error) {\n        if (error) {\n            return cnt(null, error);\n        } else {\n            return cnt(thisB._length);\n        }\n    });\n}\n\nif (typeof(module) !== 'undefined') {\n    module.exports = {\n        makeTwoBit: makeTwoBit\n    };\n}\n","/* -*- mode: javascript; c-basic-offset: 4; indent-tabs-mode: nil -*- */\n\n// \n// Dalliance Genome Explorer\n// (c) Thomas Down 2006-2010\n//\n// utils.js: odds, sods, and ends.\n//\n\n\"use strict\";\n\nif (typeof(require) !== 'undefined') {\n    var sha1 = require('./sha1');\n    var b64_sha1 = sha1.b64_sha1;\n}\n\nvar NUM_REGEXP = new RegExp('[0-9]+');\n\nfunction stringToNumbersArray(str) {\n    var nums = new Array();\n    var m;\n    while (m = NUM_REGEXP.exec(str)) {\n        nums.push(m[0]);\n        str=str.substring(m.index + (m[0].length));\n    }\n    return nums;\n}\n\nvar STRICT_NUM_REGEXP = new RegExp('^[0-9]+$');\n\nfunction stringToInt(str) {\n    str = str.replace(new RegExp(',', 'g'), '');\n    if (!STRICT_NUM_REGEXP.test(str)) {\n        return null;\n    }\n    return str|0;\n}\n\nfunction pushnew(a, v) {\n    for (var i = 0; i < a.length; ++i) {\n        if (a[i] == v) {\n            return;\n        }\n    }\n    a.push(v);\n}\n\nfunction pusho(obj, k, v) {\n    if (obj[k]) {\n        obj[k].push(v);\n    } else {\n        obj[k] = [v];\n    }\n}\n\nfunction pushnewo(obj, k, v) {\n    var a = obj[k];\n    if (a) {\n        for (var i = 0; i < a.length; ++i) {    // indexOf requires JS16 :-(.\n            if (a[i] == v) {\n                return;\n            }\n        }\n        a.push(v);\n    } else {\n        obj[k] = [v];\n    }\n}\n\n\nfunction pick(a, b, c, d)\n{\n    if (a) {\n        return a;\n    } else if (b) {\n        return b;\n    } else if (c) {\n        return c;\n    } else if (d) {\n        return d;\n    }\n}\n\nfunction pushnew(l, o)\n{\n    for (var i = 0; i < l.length; ++i) {\n        if (l[i] == o) {\n            return;\n        }\n    }\n    l.push(o);\n}\n\n\n\nfunction arrayIndexOf(a, x) {\n    if (!a) {\n        return -1;\n    }\n\n    for (var i = 0; i < a.length; ++i) {\n        if (a[i] === x) {\n            return i;\n        }\n    }\n    return -1;\n}\n\nfunction arrayRemove(a, x) {\n    var i = arrayIndexOf(a, x);\n    if (i >= 0) {\n        a.splice(i, 1);\n        return true;\n    }\n    return false;\n}\n\n//\n// DOM utilities\n//\n\n\nfunction makeElement(tag, children, attribs, styles)\n{\n    var ele = document.createElement(tag);\n    if (children) {\n        if (! (children instanceof Array)) {\n            children = [children];\n        }\n        for (var i = 0; i < children.length; ++i) {\n            var c = children[i];\n            if (c) {\n                if (typeof c == 'string') {\n                    c = document.createTextNode(c);\n                } else if (typeof c == 'number') {\n                    c = document.createTextNode('' + c);\n                }\n                ele.appendChild(c);\n            }\n        }\n    }\n    \n    if (attribs) {\n        for (var l in attribs) {\n            try {\n                ele[l] = attribs[l];\n            } catch (e) {\n                console.log('error setting ' + l);\n                throw(e);\n            }\n        }\n    }\n    if (styles) {\n        for (var l in styles) {\n            ele.style[l] = styles[l];\n        }\n    }\n    return ele;\n}\n\nfunction makeElementNS(namespace, tag, children, attribs)\n{\n    var ele = document.createElementNS(namespace, tag);\n    if (children) {\n        if (! (children instanceof Array)) {\n            children = [children];\n        }\n        for (var i = 0; i < children.length; ++i) {\n            var c = children[i];\n            if (typeof c == 'string') {\n                c = document.createTextNode(c);\n            }\n            ele.appendChild(c);\n        }\n    }\n    \n    setAttrs(ele, attribs);\n    return ele;\n}\n\nvar attr_name_cache = {};\n\nfunction setAttr(node, key, value)\n{\n    var attr = attr_name_cache[key];\n    if (!attr) {\n        var _attr = '';\n        for (var c = 0; c < key.length; ++c) {\n            var cc = key.substring(c, c+1);\n            var lcc = cc.toLowerCase();\n            if (lcc != cc) {\n                _attr = _attr + '-' + lcc;\n            } else {\n                _attr = _attr + cc;\n            }\n        }\n        attr_name_cache[key] = _attr;\n        attr = _attr;\n    }\n    node.setAttribute(attr, value);\n}\n\nfunction setAttrs(node, attribs)\n{\n    if (attribs) {\n        for (var l in attribs) {\n            setAttr(node, l, attribs[l]);\n        }\n    }\n}\n\n\n\nfunction removeChildren(node)\n{\n    if (!node || !node.childNodes) {\n        return;\n    }\n\n    while (node.childNodes.length > 0) {\n        node.removeChild(node.firstChild);\n    }\n}\n\n\n\n//\n// WARNING: not for general use!\n//\n\nfunction miniJSONify(o, exc) {\n    if (typeof o === 'undefined') {\n        return 'undefined';\n    } else if (o == null) {\n        return 'null';\n    } else if (typeof o == 'string') {\n        return \"'\" + o + \"'\";\n    } else if (typeof o == 'number') {\n        return \"\" + o;\n    } else if (typeof o == 'boolean') {\n        return \"\" + o;\n    } else if (typeof o == 'object') {\n        if (o instanceof Array) {\n            var s = null;\n            for (var i = 0; i < o.length; ++i) {\n                s = (s == null ? '' : (s + ', ')) + miniJSONify(o[i], exc);\n            }\n            return '[' + (s?s:'') + ']';\n        } else {\n            exc = exc || {};\n            var s = null;\n            for (var k in o) {\n                if (exc[k])\n                    continue;\n                if (k != undefined && typeof(o[k]) != 'function') {\n                    s = (s == null ? '' : (s + ', ')) + k + ': ' + miniJSONify(o[k], exc);\n                }\n            }\n            return '{' + (s?s:'') + '}';\n        }\n    } else {\n        return (typeof o);\n    }\n}\n\nfunction shallowCopy(o) {\n    var n = {};\n    for (var k in o) {\n        n[k] = o[k];\n    }\n    return n;\n}\n\nfunction Observed(x) {\n    this.value = x;\n    this.listeners = [];\n}\n\nObserved.prototype.addListener = function(f) {\n    this.listeners.push(f);\n}\n\nObserved.prototype.addListenerAndFire = function(f) {\n    this.listeners.push(f);\n    f(this.value);\n}\n\nObserved.prototype.removeListener = function(f) {\n    arrayRemove(this.listeners, f);\n}\n\nObserved.prototype.get = function() {\n    return this.value;\n}\n\nObserved.prototype.set = function(x) {\n    this.value = x;\n    for (var i = 0; i < this.listeners.length; ++i) {\n        this.listeners[i](x);\n    }\n}\n\nfunction Awaited() {\n    this.queue = [];\n}\n\nAwaited.prototype.provide = function(x) {\n    if (this.res !== undefined) {\n        throw \"Resource has already been provided.\";\n    }\n\n    this.res = x;\n    for (var i = 0; i < this.queue.length; ++i) {\n        this.queue[i](x);\n    }\n    this.queue = null;   // avoid leaking closures.\n}\n\nAwaited.prototype.await = function(f) {\n    if (this.res !== undefined) {\n        f(this.res);\n        return this.res;\n    } else {\n        this.queue.push(f);\n    }\n}\n\nvar __dalliance_saltSeed = 0;\n\nfunction saltURL(url) {\n    return url + '?salt=' + b64_sha1('' + Date.now() + ',' + (++__dalliance_saltSeed));\n}\n\nfunction textXHR(url, callback, opts) {\n    if (opts && opts.salt) \n        url = saltURL(url);\n\n    try {\n        var timeout;\n        if (opts && opts.timeout) {\n            timeout = setTimeout(\n                function() {\n                    console.log('timing out ' + url);\n                    req.abort();\n                    return callback(null, 'Timeout');\n                },\n                opts.timeout\n            );\n        }\n\n        var req = new XMLHttpRequest();\n        req.onreadystatechange = function() {\n    \t    if (req.readyState == 4) {\n                if (timeout)\n                    clearTimeout(timeout);\n    \t        if (req.status < 200 || req.status >= 300) {\n    \t\t    callback(null, 'Error code ' + req.status);\n    \t        } else {\n    \t\t    callback(req.responseText);\n    \t        }\n    \t    }\n        };\n        \n        req.open('GET', url, true);\n        req.responseType = 'text';\n\n        if (opts && opts.credentials) {\n            req.withCredentials = true;\n        }\n        req.send();\n    } catch (e) {\n        callback(null, 'Exception ' + e);\n    }\n}\n\nfunction relativeURL(base, rel) {\n    // FIXME quite naive -- good enough for trackhubs?\n\n    if (rel.indexOf('http:') == 0 || rel.indexOf('https:') == 0) {\n        return rel;\n    }\n\n    var li = base.lastIndexOf('/');\n    if (li >= 0) {\n        return base.substr(0, li + 1) + rel;\n    } else {\n        return rel;\n    }\n}\n\nvar AMINO_ACID_TRANSLATION = {\n    'TTT': 'F',\n    'TTC': 'F',\n    'TTA': 'L',\n    'TTG': 'L',\n    'CTT': 'L',\n    'CTC': 'L',\n    'CTA': 'L',\n    'CTG': 'L',\n    'ATT': 'I',\n    'ATC': 'I',\n    'ATA': 'I',\n    'ATG': 'M',\n    'GTT': 'V',\n    'GTC': 'V',\n    'GTA': 'V',\n    'GTG': 'V',\n    'TCT': 'S',\n    'TCC': 'S',\n    'TCA': 'S',\n    'TCG': 'S',\n    'CCT': 'P',\n    'CCC': 'P',\n    'CCA': 'P',\n    'CCG': 'P',\n    'ACT': 'T',\n    'ACC': 'T',\n    'ACA': 'T',\n    'ACG': 'T',\n    'GCT': 'A',\n    'GCC': 'A',\n    'GCA': 'A',\n    'GCG': 'A',\n    'TAT': 'Y',\n    'TAC': 'Y',\n    'TAA': '*',  // stop\n    'TAG': '*',  // stop\n    'CAT': 'H',\n    'CAC': 'H',\n    'CAA': 'Q',\n    'CAG': 'Q',\n    'AAT': 'N',\n    'AAC': 'N',\n    'AAA': 'K',\n    'AAG': 'K',\n    'GAT': 'D',\n    'GAC': 'D',\n    'GAA': 'E',\n    'GAG': 'E',\n    'TGT': 'C',\n    'TGC': 'C',\n    'TGA': '*',  // stop\n    'TGG': 'W',\n    'CGT': 'R',\n    'CGC': 'R',\n    'CGA': 'R',\n    'CGG': 'R',\n    'AGT': 'S',\n    'AGC': 'S',\n    'AGA': 'R',\n    'AGG': 'R',\n    'GGT': 'G',\n    'GGC': 'G',\n    'GGA': 'G',\n    'GGG': 'G'\n}\n\nfunction resolveUrlToPage(rel) {\n    return makeElement('a', null, {href: rel}).href;\n}\n\n//\n// Missing APIs\n// \n\nif (!('trim' in String.prototype)) {\n    String.prototype.trim = function() {\n        return this.replace(/^\\s+/, '').replace(/\\s+$/, '');\n    };\n}\n\nif (typeof(module) !== 'undefined') {\n    module.exports = {\n        textXHR: textXHR,\n        relativeURL: relativeURL,\n        resolveUrlToPage: resolveUrlToPage,\n        shallowCopy: shallowCopy,\n        pusho: pusho,\n        pushnew: pushnew,\n        pushnewo: pushnewo,\n        arrayIndexOf: arrayIndexOf,\n        pick: pick,\n\n        makeElement: makeElement,\n        makeElementNS: makeElementNS,\n        removeChildren: removeChildren,\n\n        miniJSONify: miniJSONify,\n\n        Observed: Observed,\n        Awaited: Awaited,\n\n        AMINO_ACID_TRANSLATION: AMINO_ACID_TRANSLATION\n    }\n}\n","/* -*- mode: javascript; c-basic-offset: 4; indent-tabs-mode: nil -*- */\n\n// \n// Dalliance Genome Explorer\n// (c) Thomas Down 2006-2014\n//\n// vcf.js\n//\n\n\"use strict\";\n\nif (typeof(require) !== 'undefined') {\n    var sa = require('./sourceadapters');\n    var dalliance_registerParserFactory = sa.registerParserFactory;\n\n    var das = require('./das');\n    var DASStylesheet = das.DASStylesheet;\n    var DASStyle = das.DASStyle;\n    var DASFeature = das.DASFeature;\n    var DASGroup = das.DASGroup;\n\n    var revalidator = require('revalidator');\n}\n\nfunction VCFParser() {\n    this.info = [];\n}\n\nvar VCF_INFO_RE = /([^;=]+)(=([^;]+))?;?/;\nvar VCF_INFO_HEADER = /##INFO=<([^>]+)>/;\nvar VCF_INFO_HEADER_TOK = /([^,=]+)=([^,]+|\"[^\"]+\"),?/\n\nVCFParser.prototype.createSession = function(sink) {\n    return new VCFParseSession(this, sink);\n}\n\nfunction VCFParseSession(parser, sink) {\n    this.parser = parser;\n    this.sink  = sink;\n}\n\nVCFParseSession.prototype.parse = function(line) {\n    if (line.length == 0)\n        return;\n    if (line[0] == '#') {\n        if (line.length > 1 && line[1] == '#') {\n            var m = VCF_INFO_HEADER.exec(line);\n            if (m) {\n                var toks = m[1].split(VCF_INFO_HEADER_TOK);\n                var id = null, desc = null;\n                for (var ti = 0; ti < toks.length - 1; ti += 3) {\n                    var key = toks[ti + 1];\n                    var value = toks[ti + 2].replace(/\"/g, '');\n                    if (key == 'ID') {\n                        id = value;\n                    } else if (key == 'Description') {\n                        desc = value;\n                    }\n                }\n                if (id && desc) {\n                    this.parser.info.push(\n                        {id: id,\n                         desc: desc}\n                    );\n                }\n            }\n            return;\n        } else {\n            return;\n        }\n    }\n\n    var toks = line.split('\\t');\n    var f = new DASFeature();\n    f.segment = toks[0];\n    f.id = toks[2]\n    f.refAllele = toks[3];\n    f.altAlleles = toks[4].split(',');\n    f.min = parseInt(toks[1]);\n    f.max = f.min + f.refAllele.length - 1;\n\n    var infoToks = toks[7].split(VCF_INFO_RE);\n    f.info = {};\n    for (var ti = 0; ti < infoToks.length; ti += 4) {\n        f.info[infoToks[ti + 1]] = infoToks[ti + 3];\n    }\n\n\n    var alt = f.altAlleles[0];\n    var ref = f.refAllele;\n    if (alt.length > ref.length) {\n        f.type = \"insertion\";\n        if (alt.indexOf(ref) == 0) {\n            f.insertion = alt.substr(ref.length);\n            f.min += ref.length;\n            f.max = f.min - 1; // Effectively \"between\" bases.\n        } else {\n            f.insertion = alt;\n        }\n    } else if (alt.length < ref.length) {\n        f.type = \"deletion\";\n    } else {\n        f.type = 'substitution';\n    }\n\n    this.sink(f);\n}\n\nVCFParseSession.prototype.flush = function() {};\n\nVCFParseSession.prototype.schema = {\n  properties: {\n    segment: {\n      description: 'the name of the region containing the variation',\n      type: 'string',\n      required: true\n    },\n    min: {\n      description: 'the start position',\n      type: 'integer',\n      minimum: 1,\n      required: true\n    },\n    max: {\n      description: 'the end position',\n      type: 'integer',\n      required: true\n    },\n    id: {\n      description: 'identifier of variant',\n      type: 'string',\n      required: true\n    },\n    refAllele: {\n      description: 'reference allele',\n      type: 'string',\n      required: true\n    },\n    altAlleles: {\n      description: 'list of alternate alleles',\n      type: 'array',\n      items: { type: 'string' },\n      required: true\n    },\n    info: {\n      description: 'info',\n      type: 'object',\n      required: true\n    },\n    type: {\n      description: 'type of variation',\n      type: 'string',\n      enum: ['insertion','deletion','substitution'],\n      required: true\n    },\n    insertion: {\n      description: 'the actual insertion',\n      type: 'string'\n    }\n  }\n};\n\nVCFParseSession.prototype.validate = function(f) {\n  // use revalidator.validate to check if feature f is valid\n  var check = revalidator.validate(f, this.schema);\n  if (check.valid) {\n    this.sink(f);\n  } else {\n    console.log(check.errors);\n  }\n}\n\nVCFParser.prototype.getStyleSheet = function(callback) {\n    var stylesheet = new DASStylesheet();\n\n    {\n        var varStyle = new DASStyle();\n        varStyle.glyph = '__INSERTION';\n        varStyle.BUMP = 'yes';\n        varStyle.LABEL = 'no';\n        varStyle.FGCOLOR = 'rgb(50,80,255)';\n        varStyle.BGCOLOR = '#888888';\n        varStyle.STROKECOLOR = 'black';\n        stylesheet.pushStyle({type: 'insertion'}, null, varStyle);\n    }\n    {\n        var varStyle = new DASStyle();\n        varStyle.glyph = 'PLIMSOLL';\n        varStyle.BUMP = 'yes';\n        varStyle.LABEL = 'no';\n        varStyle.FGCOLOR = 'rgb(255, 60, 60)';\n        varStyle.BGCOLOR = '#888888';\n        varStyle.STROKECOLOR = 'black';\n        stylesheet.pushStyle({type: 'deletion'}, null, varStyle);\n    }\n    {\n        var varStyle = new DASStyle();\n        varStyle.glyph = 'PLIMSOLL';\n        varStyle.BUMP = 'yes';\n        varStyle.LABEL = 'no';\n        varStyle.FGCOLOR = 'rgb(50,80,255)';\n        varStyle.BGCOLOR = '#888888';\n        varStyle.STROKECOLOR = 'black';\n        stylesheet.pushStyle({type: 'default'}, null, varStyle);\n    }\n\n    return callback(stylesheet);\n}\n\nVCFParser.prototype.getDefaultFIPs = function(callback) {\n    var self = this;\n    var fip = function(feature, featureInfo) {\n        featureInfo.add(\"Ref. allele\", feature.refAllele);\n        featureInfo.add(\"Alt. alleles\", feature.altAlleles.join(','));\n\n        if (feature.info) {\n            for (var ii = 0; ii < self.info.length; ++ii) {\n                var info = self.info[ii];\n                var val = feature.info[info.id];\n                if (val !== undefined) {\n                    featureInfo.add(info.desc, val);\n                }\n            }\n        }\n    };\n    callback(fip);\n}\n\ndalliance_registerParserFactory('vcf', function() {return new VCFParser()});\n","/* -*- mode: javascript; c-basic-offset: 4; indent-tabs-mode: nil -*- */\n\n// \n// Dalliance Genome Explorer\n// (c) Thomas Down 2006-2010\n//\n// version.js\n//\n\n\"use strict\";\n\nvar VERSION = {\n    CONFIG: 5,\n    MAJOR:  0,\n    MINOR:  13,\n    MICRO:  7,\n    BRANCH: 'dev'\n};\n\nVERSION.toString = function() {\n    var vs = '' + this.MAJOR + '.' + this.MINOR + '.' + this.MICRO;\n    if (this.PATCH) {\n        vs = vs + this.PATCH;\n    }\n    if (this.BRANCH && this.BRANCH != '') {\n        vs = vs + '-' + this.BRANCH;\n    }\n    return vs;\n}\n\nif (typeof(module) !== 'undefined') {\n    module.exports = VERSION;\n}\n","/* -*- mode: javascript; c-basic-offset: 4; indent-tabs-mode: nil -*- */\n\n// \n// Dalliance Genome Explorer\n// (c) Thomas Down 2006-2014\n//\n// zoomslider.js: custom slider component\n//\n\n\n\"use strict\";\n\nif (typeof(require) !== 'undefined') {\n    var utils = require('./utils');\n    var makeElement = utils.makeElement;\n}\n\nfunction makeZoomSlider(opts) {\n    opts = opts || {};\n    \n    var minPos = 0, maxPos = opts.width || 200;\n    var min = 0, max = 200;\n    var pos = 50, pos2 = 100;\n    var labels = [];\n    var track = makeElement('hr', null, {className: 'slider-track'}, {width: '' + (maxPos|0) + 'px'});\n    var thumb = makeElement('hr', null, {className: 'slider-thumb active'});\n    var thumb2 = makeElement('hr', null, {className: 'slider-thumb'});\n    var slider = makeElement('div', [track, thumb, thumb2], {className: 'slider'},  {width: '' + ((maxPos|0) + 10) + 'px'});\n\n    slider.removeLabels = function() {\n        for (var li = 0; li < labels.length; ++li) {\n            slider.removeChild(labels[li]);\n        }\n        labels = [];\n    }\n\n    slider.addLabel = function(val, txt) {\n        var pos = (minPos + ((val - min) * (maxPos - minPos))/(max-min))|0;\n        var label = makeElement('div', txt, {className: 'slider-label'}, {\n            left: '' + ((minPos + ((val - min) * (maxPos - minPos))/(max-min))|0) + 'px'\n        });\n        slider.appendChild(label);\n        labels.push(label);\n    }\n\n    var onChange = document.createEvent('HTMLEvents');\n    onChange.initEvent('change', true, false);\n\n    function setPos(np) {\n        np = Math.min(np, maxPos);\n        np = Math.max(np, minPos);\n        pos = np;\n        thumb.style.left = '' + pos + 'px';\n    }\n\n    function setPos2(np) {\n        np = Math.min(np, maxPos);\n        np = Math.max(np, minPos);\n        pos2 = np;\n        thumb2.style.left = '' + pos2 + 'px';\n    }\n\n    Object.defineProperty(slider, 'value', {\n        get: function()  {return min + (((pos-minPos) * (max-min)) / (maxPos - minPos));},\n        set: function(v) {\n          var np = minPos + ((v-min) * (maxPos-minPos))/(max-min);\n          setPos(np);\n        }\n    });\n\n    Object.defineProperty(slider, 'value2', {\n        get: function()  {return min + (((pos2-minPos) * (max-min)) / (maxPos - minPos));},\n        set: function(v) {\n          var np = minPos + ((v-min) * (maxPos-minPos))/(max-min);\n          setPos2(np);\n        }\n    });\n\n    Object.defineProperty(slider, 'active', {\n        get: function() {return thumb.classList.contains('active') ? 1 : 2},\n        set: function(x) {\n            if (x == 1) {\n                thumb.classList.add('active');\n                thumb2.classList.remove('active');\n            } else {\n                thumb2.classList.add('active');\n                thumb.classList.remove('active');\n            }\n        }\n    });\n\n    Object.defineProperty(slider, 'min', {\n      get: function() {return min},\n      set: function(v) {min = v}\n    });\n\n    Object.defineProperty(slider, 'max', {\n      get: function() {return max},\n      set: function(v) {max = v}\n    });\n\n    var offset;\n    var which;\n\n    var thumbMouseDown = function(ev) {\n        which = this == thumb ? 1 : 2;\n        if (which != slider.active) {\n            slider.active = which;\n            slider.dispatchEvent(onChange);\n        }\n        ev.stopPropagation(); ev.preventDefault();\n        window.addEventListener('mousemove', thumbDragHandler, false);\n        window.addEventListener('mouseup', thumbDragEndHandler, false);\n        offset = ev.clientX - (which == 1 ? pos : pos2);\n    };\n\n    thumb.addEventListener('mousedown', thumbMouseDown, false);\n    thumb2.addEventListener('mousedown', thumbMouseDown, false);\n\n    var thumbDragHandler = function(ev) {\n        if (which == 1)\n            setPos(ev.clientX - offset);\n        else\n            setPos2(ev.clientX - offset);\n        slider.dispatchEvent(onChange);\n    };\n\n    var thumbDragEndHandler = function(ev) {\n        window.removeEventListener('mousemove', thumbDragHandler, false);\n        window.removeEventListener('mouseup', thumbDragEndHandler, false);\n    }\n\n    return slider;\n}\n\nif (typeof(module) !== 'undefined') {\n    module.exports = makeZoomSlider;\n}\n","\"use strict\";\nvar Promise = require(\"./promise/promise\").Promise;\nvar polyfill = require(\"./promise/polyfill\").polyfill;\nexports.Promise = Promise;\nexports.polyfill = polyfill;","\"use strict\";\n/* global toString */\n\nvar isArray = require(\"./utils\").isArray;\nvar isFunction = require(\"./utils\").isFunction;\n\n/**\n  Returns a promise that is fulfilled when all the given promises have been\n  fulfilled, or rejected if any of them become rejected. The return promise\n  is fulfilled with an array that gives all the values in the order they were\n  passed in the `promises` array argument.\n\n  Example:\n\n  ```javascript\n  var promise1 = RSVP.resolve(1);\n  var promise2 = RSVP.resolve(2);\n  var promise3 = RSVP.resolve(3);\n  var promises = [ promise1, promise2, promise3 ];\n\n  RSVP.all(promises).then(function(array){\n    // The array here would be [ 1, 2, 3 ];\n  });\n  ```\n\n  If any of the `promises` given to `RSVP.all` are rejected, the first promise\n  that is rejected will be given as an argument to the returned promises's\n  rejection handler. For example:\n\n  Example:\n\n  ```javascript\n  var promise1 = RSVP.resolve(1);\n  var promise2 = RSVP.reject(new Error(\"2\"));\n  var promise3 = RSVP.reject(new Error(\"3\"));\n  var promises = [ promise1, promise2, promise3 ];\n\n  RSVP.all(promises).then(function(array){\n    // Code here never runs because there are rejected promises!\n  }, function(error) {\n    // error.message === \"2\"\n  });\n  ```\n\n  @method all\n  @for RSVP\n  @param {Array} promises\n  @param {String} label\n  @return {Promise} promise that is fulfilled when all `promises` have been\n  fulfilled, or rejected if any of them become rejected.\n*/\nfunction all(promises) {\n  /*jshint validthis:true */\n  var Promise = this;\n\n  if (!isArray(promises)) {\n    throw new TypeError('You must pass an array to all.');\n  }\n\n  return new Promise(function(resolve, reject) {\n    var results = [], remaining = promises.length,\n    promise;\n\n    if (remaining === 0) {\n      resolve([]);\n    }\n\n    function resolver(index) {\n      return function(value) {\n        resolveAll(index, value);\n      };\n    }\n\n    function resolveAll(index, value) {\n      results[index] = value;\n      if (--remaining === 0) {\n        resolve(results);\n      }\n    }\n\n    for (var i = 0; i < promises.length; i++) {\n      promise = promises[i];\n\n      if (promise && isFunction(promise.then)) {\n        promise.then(resolver(i), reject);\n      } else {\n        resolveAll(i, promise);\n      }\n    }\n  });\n}\n\nexports.all = all;","\"use strict\";\nvar browserGlobal = (typeof window !== 'undefined') ? window : {};\nvar BrowserMutationObserver = browserGlobal.MutationObserver || browserGlobal.WebKitMutationObserver;\nvar local = (typeof global !== 'undefined') ? global : (this === undefined? window:this);\n\n// node\nfunction useNextTick() {\n  return function() {\n    process.nextTick(flush);\n  };\n}\n\nfunction useMutationObserver() {\n  var iterations = 0;\n  var observer = new BrowserMutationObserver(flush);\n  var node = document.createTextNode('');\n  observer.observe(node, { characterData: true });\n\n  return function() {\n    node.data = (iterations = ++iterations % 2);\n  };\n}\n\nfunction useSetTimeout() {\n  return function() {\n    local.setTimeout(flush, 1);\n  };\n}\n\nvar queue = [];\nfunction flush() {\n  for (var i = 0; i < queue.length; i++) {\n    var tuple = queue[i];\n    var callback = tuple[0], arg = tuple[1];\n    callback(arg);\n  }\n  queue = [];\n}\n\nvar scheduleFlush;\n\n// Decide what async method to use to triggering processing of queued callbacks:\nif (typeof process !== 'undefined' && {}.toString.call(process) === '[object process]') {\n  scheduleFlush = useNextTick();\n} else if (BrowserMutationObserver) {\n  scheduleFlush = useMutationObserver();\n} else {\n  scheduleFlush = useSetTimeout();\n}\n\nfunction asap(callback, arg) {\n  var length = queue.push([callback, arg]);\n  if (length === 1) {\n    // If length is 1, that means that we need to schedule an async flush.\n    // If additional callbacks are queued before the queue is flushed, they\n    // will be processed by this flush that we are scheduling.\n    scheduleFlush();\n  }\n}\n\nexports.asap = asap;","\"use strict\";\n/**\n  `RSVP.Promise.cast` returns the same promise if that promise shares a constructor\n  with the promise being casted.\n\n  Example:\n\n  ```javascript\n  var promise = RSVP.resolve(1);\n  var casted = RSVP.Promise.cast(promise);\n\n  console.log(promise === casted); // true\n  ```\n\n  In the case of a promise whose constructor does not match, it is assimilated.\n  The resulting promise will fulfill or reject based on the outcome of the\n  promise being casted.\n\n  In the case of a non-promise, a promise which will fulfill with that value is\n  returned.\n\n  Example:\n\n  ```javascript\n  var value = 1; // could be a number, boolean, string, undefined...\n  var casted = RSVP.Promise.cast(value);\n\n  console.log(value === casted); // false\n  console.log(casted instanceof RSVP.Promise) // true\n\n  casted.then(function(val) {\n    val === value // => true\n  });\n  ```\n\n  `RSVP.Promise.cast` is similar to `RSVP.resolve`, but `RSVP.Promise.cast` differs in the\n  following ways:\n  * `RSVP.Promise.cast` serves as a memory-efficient way of getting a promise, when you\n  have something that could either be a promise or a value. RSVP.resolve\n  will have the same effect but will create a new promise wrapper if the\n  argument is a promise.\n  * `RSVP.Promise.cast` is a way of casting incoming thenables or promise subclasses to\n  promises of the exact class specified, so that the resulting object's `then` is\n  ensured to have the behavior of the constructor you are calling cast on (i.e., RSVP.Promise).\n\n  @method cast\n  @for RSVP\n  @param {Object} object to be casted\n  @return {Promise} promise that is fulfilled when all properties of `promises`\n  have been fulfilled, or rejected if any of them become rejected.\n*/\n\n\nfunction cast(object) {\n  /*jshint validthis:true */\n  if (object && typeof object === 'object' && object.constructor === this) {\n    return object;\n  }\n\n  var Promise = this;\n\n  return new Promise(function(resolve) {\n    resolve(object);\n  });\n}\n\nexports.cast = cast;","\"use strict\";\nvar config = {\n  instrument: false\n};\n\nfunction configure(name, value) {\n  if (arguments.length === 2) {\n    config[name] = value;\n  } else {\n    return config[name];\n  }\n}\n\nexports.config = config;\nexports.configure = configure;","\"use strict\";\n/*global self*/\nvar RSVPPromise = require(\"./promise\").Promise;\nvar isFunction = require(\"./utils\").isFunction;\n\nfunction polyfill() {\n  var local;\n\n  if (typeof global !== 'undefined') {\n    local = global;\n  } else if (typeof window !== 'undefined' && window.document) {\n    local = window;\n  } else {\n    local = self;\n  }\n\n  var es6PromiseSupport = \n    \"Promise\" in local &&\n    // Some of these methods are missing from\n    // Firefox/Chrome experimental implementations\n    \"cast\" in local.Promise &&\n    \"resolve\" in local.Promise &&\n    \"reject\" in local.Promise &&\n    \"all\" in local.Promise &&\n    \"race\" in local.Promise &&\n    // Older version of the spec had a resolver object\n    // as the arg rather than a function\n    (function() {\n      var resolve;\n      new local.Promise(function(r) { resolve = r; });\n      return isFunction(resolve);\n    }());\n\n  if (!es6PromiseSupport) {\n    local.Promise = RSVPPromise;\n  }\n}\n\nexports.polyfill = polyfill;","\"use strict\";\nvar config = require(\"./config\").config;\nvar configure = require(\"./config\").configure;\nvar objectOrFunction = require(\"./utils\").objectOrFunction;\nvar isFunction = require(\"./utils\").isFunction;\nvar now = require(\"./utils\").now;\nvar cast = require(\"./cast\").cast;\nvar all = require(\"./all\").all;\nvar race = require(\"./race\").race;\nvar staticResolve = require(\"./resolve\").resolve;\nvar staticReject = require(\"./reject\").reject;\nvar asap = require(\"./asap\").asap;\n\nvar counter = 0;\n\nconfig.async = asap; // default async is asap;\n\nfunction Promise(resolver) {\n  if (!isFunction(resolver)) {\n    throw new TypeError('You must pass a resolver function as the first argument to the promise constructor');\n  }\n\n  if (!(this instanceof Promise)) {\n    throw new TypeError(\"Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.\");\n  }\n\n  this._subscribers = [];\n\n  invokeResolver(resolver, this);\n}\n\nfunction invokeResolver(resolver, promise) {\n  function resolvePromise(value) {\n    resolve(promise, value);\n  }\n\n  function rejectPromise(reason) {\n    reject(promise, reason);\n  }\n\n  try {\n    resolver(resolvePromise, rejectPromise);\n  } catch(e) {\n    rejectPromise(e);\n  }\n}\n\nfunction invokeCallback(settled, promise, callback, detail) {\n  var hasCallback = isFunction(callback),\n      value, error, succeeded, failed;\n\n  if (hasCallback) {\n    try {\n      value = callback(detail);\n      succeeded = true;\n    } catch(e) {\n      failed = true;\n      error = e;\n    }\n  } else {\n    value = detail;\n    succeeded = true;\n  }\n\n  if (handleThenable(promise, value)) {\n    return;\n  } else if (hasCallback && succeeded) {\n    resolve(promise, value);\n  } else if (failed) {\n    reject(promise, error);\n  } else if (settled === FULFILLED) {\n    resolve(promise, value);\n  } else if (settled === REJECTED) {\n    reject(promise, value);\n  }\n}\n\nvar PENDING   = void 0;\nvar SEALED    = 0;\nvar FULFILLED = 1;\nvar REJECTED  = 2;\n\nfunction subscribe(parent, child, onFulfillment, onRejection) {\n  var subscribers = parent._subscribers;\n  var length = subscribers.length;\n\n  subscribers[length] = child;\n  subscribers[length + FULFILLED] = onFulfillment;\n  subscribers[length + REJECTED]  = onRejection;\n}\n\nfunction publish(promise, settled) {\n  var child, callback, subscribers = promise._subscribers, detail = promise._detail;\n\n  for (var i = 0; i < subscribers.length; i += 3) {\n    child = subscribers[i];\n    callback = subscribers[i + settled];\n\n    invokeCallback(settled, child, callback, detail);\n  }\n\n  promise._subscribers = null;\n}\n\nPromise.prototype = {\n  constructor: Promise,\n\n  _state: undefined,\n  _detail: undefined,\n  _subscribers: undefined,\n\n  then: function(onFulfillment, onRejection) {\n    var promise = this;\n\n    var thenPromise = new this.constructor(function() {});\n\n    if (this._state) {\n      var callbacks = arguments;\n      config.async(function invokePromiseCallback() {\n        invokeCallback(promise._state, thenPromise, callbacks[promise._state - 1], promise._detail);\n      });\n    } else {\n      subscribe(this, thenPromise, onFulfillment, onRejection);\n    }\n\n    return thenPromise;\n  },\n\n  'catch': function(onRejection) {\n    return this.then(null, onRejection);\n  }\n};\n\nPromise.all = all;\nPromise.cast = cast;\nPromise.race = race;\nPromise.resolve = staticResolve;\nPromise.reject = staticReject;\n\nfunction handleThenable(promise, value) {\n  var then = null,\n  resolved;\n\n  try {\n    if (promise === value) {\n      throw new TypeError(\"A promises callback cannot return that same promise.\");\n    }\n\n    if (objectOrFunction(value)) {\n      then = value.then;\n\n      if (isFunction(then)) {\n        then.call(value, function(val) {\n          if (resolved) { return true; }\n          resolved = true;\n\n          if (value !== val) {\n            resolve(promise, val);\n          } else {\n            fulfill(promise, val);\n          }\n        }, function(val) {\n          if (resolved) { return true; }\n          resolved = true;\n\n          reject(promise, val);\n        });\n\n        return true;\n      }\n    }\n  } catch (error) {\n    if (resolved) { return true; }\n    reject(promise, error);\n    return true;\n  }\n\n  return false;\n}\n\nfunction resolve(promise, value) {\n  if (promise === value) {\n    fulfill(promise, value);\n  } else if (!handleThenable(promise, value)) {\n    fulfill(promise, value);\n  }\n}\n\nfunction fulfill(promise, value) {\n  if (promise._state !== PENDING) { return; }\n  promise._state = SEALED;\n  promise._detail = value;\n\n  config.async(publishFulfillment, promise);\n}\n\nfunction reject(promise, reason) {\n  if (promise._state !== PENDING) { return; }\n  promise._state = SEALED;\n  promise._detail = reason;\n\n  config.async(publishRejection, promise);\n}\n\nfunction publishFulfillment(promise) {\n  publish(promise, promise._state = FULFILLED);\n}\n\nfunction publishRejection(promise) {\n  publish(promise, promise._state = REJECTED);\n}\n\nexports.Promise = Promise;","\"use strict\";\n/* global toString */\nvar isArray = require(\"./utils\").isArray;\n\n/**\n  `RSVP.race` allows you to watch a series of promises and act as soon as the\n  first promise given to the `promises` argument fulfills or rejects.\n\n  Example:\n\n  ```javascript\n  var promise1 = new RSVP.Promise(function(resolve, reject){\n    setTimeout(function(){\n      resolve(\"promise 1\");\n    }, 200);\n  });\n\n  var promise2 = new RSVP.Promise(function(resolve, reject){\n    setTimeout(function(){\n      resolve(\"promise 2\");\n    }, 100);\n  });\n\n  RSVP.race([promise1, promise2]).then(function(result){\n    // result === \"promise 2\" because it was resolved before promise1\n    // was resolved.\n  });\n  ```\n\n  `RSVP.race` is deterministic in that only the state of the first completed\n  promise matters. For example, even if other promises given to the `promises`\n  array argument are resolved, but the first completed promise has become\n  rejected before the other promises became fulfilled, the returned promise\n  will become rejected:\n\n  ```javascript\n  var promise1 = new RSVP.Promise(function(resolve, reject){\n    setTimeout(function(){\n      resolve(\"promise 1\");\n    }, 200);\n  });\n\n  var promise2 = new RSVP.Promise(function(resolve, reject){\n    setTimeout(function(){\n      reject(new Error(\"promise 2\"));\n    }, 100);\n  });\n\n  RSVP.race([promise1, promise2]).then(function(result){\n    // Code here never runs because there are rejected promises!\n  }, function(reason){\n    // reason.message === \"promise2\" because promise 2 became rejected before\n    // promise 1 became fulfilled\n  });\n  ```\n\n  @method race\n  @for RSVP\n  @param {Array} promises array of promises to observe\n  @param {String} label optional string for describing the promise returned.\n  Useful for tooling.\n  @return {Promise} a promise that becomes fulfilled with the value the first\n  completed promises is resolved with if the first completed promise was\n  fulfilled, or rejected with the reason that the first completed promise\n  was rejected with.\n*/\nfunction race(promises) {\n  /*jshint validthis:true */\n  var Promise = this;\n\n  if (!isArray(promises)) {\n    throw new TypeError('You must pass an array to race.');\n  }\n  return new Promise(function(resolve, reject) {\n    var results = [], promise;\n\n    for (var i = 0; i < promises.length; i++) {\n      promise = promises[i];\n\n      if (promise && typeof promise.then === 'function') {\n        promise.then(resolve, reject);\n      } else {\n        resolve(promise);\n      }\n    }\n  });\n}\n\nexports.race = race;","\"use strict\";\n/**\n  `RSVP.reject` returns a promise that will become rejected with the passed\n  `reason`. `RSVP.reject` is essentially shorthand for the following:\n\n  ```javascript\n  var promise = new RSVP.Promise(function(resolve, reject){\n    reject(new Error('WHOOPS'));\n  });\n\n  promise.then(function(value){\n    // Code here doesn't run because the promise is rejected!\n  }, function(reason){\n    // reason.message === 'WHOOPS'\n  });\n  ```\n\n  Instead of writing the above, your code now simply becomes the following:\n\n  ```javascript\n  var promise = RSVP.reject(new Error('WHOOPS'));\n\n  promise.then(function(value){\n    // Code here doesn't run because the promise is rejected!\n  }, function(reason){\n    // reason.message === 'WHOOPS'\n  });\n  ```\n\n  @method reject\n  @for RSVP\n  @param {Any} reason value that the returned promise will be rejected with.\n  @param {String} label optional string for identifying the returned promise.\n  Useful for tooling.\n  @return {Promise} a promise that will become rejected with the given\n  `reason`.\n*/\nfunction reject(reason) {\n  /*jshint validthis:true */\n  var Promise = this;\n\n  return new Promise(function (resolve, reject) {\n    reject(reason);\n  });\n}\n\nexports.reject = reject;","\"use strict\";\n/**\n  `RSVP.resolve` returns a promise that will become fulfilled with the passed\n  `value`. `RSVP.resolve` is essentially shorthand for the following:\n\n  ```javascript\n  var promise = new RSVP.Promise(function(resolve, reject){\n    resolve(1);\n  });\n\n  promise.then(function(value){\n    // value === 1\n  });\n  ```\n\n  Instead of writing the above, your code now simply becomes the following:\n\n  ```javascript\n  var promise = RSVP.resolve(1);\n\n  promise.then(function(value){\n    // value === 1\n  });\n  ```\n\n  @method resolve\n  @for RSVP\n  @param {Any} value value that the returned promise will be resolved with\n  @param {String} label optional string for identifying the returned promise.\n  Useful for tooling.\n  @return {Promise} a promise that will become fulfilled with the given\n  `value`\n*/\nfunction resolve(value) {\n  /*jshint validthis:true */\n  var Promise = this;\n  return new Promise(function(resolve, reject) {\n    resolve(value);\n  });\n}\n\nexports.resolve = resolve;","\"use strict\";\nfunction objectOrFunction(x) {\n  return isFunction(x) || (typeof x === \"object\" && x !== null);\n}\n\nfunction isFunction(x) {\n  return typeof x === \"function\";\n}\n\nfunction isArray(x) {\n  return Object.prototype.toString.call(x) === \"[object Array]\";\n}\n\n// Date.now is not available in browsers < IE9\n// https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Date/now#Compatibility\nvar now = Date.now || function() { return new Date().getTime(); };\n\n\nexports.objectOrFunction = objectOrFunction;\nexports.isFunction = isFunction;\nexports.isArray = isArray;\nexports.now = now;","/* -*- mode: javascript; c-basic-offset: 4; indent-tabs-mode: nil -*- */\n\n// \n// Javascript ZLib\n// By Thomas Down 2010-2011\n//\n// Based very heavily on portions of jzlib (by ymnk@jcraft.com), who in\n// turn credits Jean-loup Gailly and Mark Adler for the original zlib code.\n//\n// inflate.js: ZLib inflate code\n//\n\n//\n// Shared constants\n//\n\nvar MAX_WBITS=15; // 32K LZ77 window\nvar DEF_WBITS=MAX_WBITS;\nvar MAX_MEM_LEVEL=9;\nvar MANY=1440;\nvar BMAX = 15;\n\n// preset dictionary flag in zlib header\nvar PRESET_DICT=0x20;\n\nvar Z_NO_FLUSH=0;\nvar Z_PARTIAL_FLUSH=1;\nvar Z_SYNC_FLUSH=2;\nvar Z_FULL_FLUSH=3;\nvar Z_FINISH=4;\n\nvar Z_DEFLATED=8;\n\nvar Z_OK=0;\nvar Z_STREAM_END=1;\nvar Z_NEED_DICT=2;\nvar Z_ERRNO=-1;\nvar Z_STREAM_ERROR=-2;\nvar Z_DATA_ERROR=-3;\nvar Z_MEM_ERROR=-4;\nvar Z_BUF_ERROR=-5;\nvar Z_VERSION_ERROR=-6;\n\nvar METHOD=0;   // waiting for method byte\nvar FLAG=1;     // waiting for flag byte\nvar DICT4=2;    // four dictionary check bytes to go\nvar DICT3=3;    // three dictionary check bytes to go\nvar DICT2=4;    // two dictionary check bytes to go\nvar DICT1=5;    // one dictionary check byte to go\nvar DICT0=6;    // waiting for inflateSetDictionary\nvar BLOCKS=7;   // decompressing blocks\nvar CHECK4=8;   // four check bytes to go\nvar CHECK3=9;   // three check bytes to go\nvar CHECK2=10;  // two check bytes to go\nvar CHECK1=11;  // one check byte to go\nvar DONE=12;    // finished check, done\nvar BAD=13;     // got an error--stay here\n\nvar inflate_mask = [0x00000000, 0x00000001, 0x00000003, 0x00000007, 0x0000000f, 0x0000001f, 0x0000003f, 0x0000007f, 0x000000ff, 0x000001ff, 0x000003ff, 0x000007ff, 0x00000fff, 0x00001fff, 0x00003fff, 0x00007fff, 0x0000ffff];\n\nvar IB_TYPE=0;  // get type bits (3, including end bit)\nvar IB_LENS=1;  // get lengths for stored\nvar IB_STORED=2;// processing stored block\nvar IB_TABLE=3; // get table lengths\nvar IB_BTREE=4; // get bit lengths tree for a dynamic block\nvar IB_DTREE=5; // get length, distance trees for a dynamic block\nvar IB_CODES=6; // processing fixed or dynamic block\nvar IB_DRY=7;   // output remaining window bytes\nvar IB_DONE=8;  // finished last block, done\nvar IB_BAD=9;   // ot a data error--stuck here\n\nvar fixed_bl = 9;\nvar fixed_bd = 5;\n\nvar fixed_tl = [\n    96,7,256, 0,8,80, 0,8,16, 84,8,115,\n    82,7,31, 0,8,112, 0,8,48, 0,9,192,\n    80,7,10, 0,8,96, 0,8,32, 0,9,160,\n    0,8,0, 0,8,128, 0,8,64, 0,9,224,\n    80,7,6, 0,8,88, 0,8,24, 0,9,144,\n    83,7,59, 0,8,120, 0,8,56, 0,9,208,\n    81,7,17, 0,8,104, 0,8,40, 0,9,176,\n    0,8,8, 0,8,136, 0,8,72, 0,9,240,\n    80,7,4, 0,8,84, 0,8,20, 85,8,227,\n    83,7,43, 0,8,116, 0,8,52, 0,9,200,\n    81,7,13, 0,8,100, 0,8,36, 0,9,168,\n    0,8,4, 0,8,132, 0,8,68, 0,9,232,\n    80,7,8, 0,8,92, 0,8,28, 0,9,152,\n    84,7,83, 0,8,124, 0,8,60, 0,9,216,\n    82,7,23, 0,8,108, 0,8,44, 0,9,184,\n    0,8,12, 0,8,140, 0,8,76, 0,9,248,\n    80,7,3, 0,8,82, 0,8,18, 85,8,163,\n    83,7,35, 0,8,114, 0,8,50, 0,9,196,\n    81,7,11, 0,8,98, 0,8,34, 0,9,164,\n    0,8,2, 0,8,130, 0,8,66, 0,9,228,\n    80,7,7, 0,8,90, 0,8,26, 0,9,148,\n    84,7,67, 0,8,122, 0,8,58, 0,9,212,\n    82,7,19, 0,8,106, 0,8,42, 0,9,180,\n    0,8,10, 0,8,138, 0,8,74, 0,9,244,\n    80,7,5, 0,8,86, 0,8,22, 192,8,0,\n    83,7,51, 0,8,118, 0,8,54, 0,9,204,\n    81,7,15, 0,8,102, 0,8,38, 0,9,172,\n    0,8,6, 0,8,134, 0,8,70, 0,9,236,\n    80,7,9, 0,8,94, 0,8,30, 0,9,156,\n    84,7,99, 0,8,126, 0,8,62, 0,9,220,\n    82,7,27, 0,8,110, 0,8,46, 0,9,188,\n    0,8,14, 0,8,142, 0,8,78, 0,9,252,\n    96,7,256, 0,8,81, 0,8,17, 85,8,131,\n    82,7,31, 0,8,113, 0,8,49, 0,9,194,\n    80,7,10, 0,8,97, 0,8,33, 0,9,162,\n    0,8,1, 0,8,129, 0,8,65, 0,9,226,\n    80,7,6, 0,8,89, 0,8,25, 0,9,146,\n    83,7,59, 0,8,121, 0,8,57, 0,9,210,\n    81,7,17, 0,8,105, 0,8,41, 0,9,178,\n    0,8,9, 0,8,137, 0,8,73, 0,9,242,\n    80,7,4, 0,8,85, 0,8,21, 80,8,258,\n    83,7,43, 0,8,117, 0,8,53, 0,9,202,\n    81,7,13, 0,8,101, 0,8,37, 0,9,170,\n    0,8,5, 0,8,133, 0,8,69, 0,9,234,\n    80,7,8, 0,8,93, 0,8,29, 0,9,154,\n    84,7,83, 0,8,125, 0,8,61, 0,9,218,\n    82,7,23, 0,8,109, 0,8,45, 0,9,186,\n    0,8,13, 0,8,141, 0,8,77, 0,9,250,\n    80,7,3, 0,8,83, 0,8,19, 85,8,195,\n    83,7,35, 0,8,115, 0,8,51, 0,9,198,\n    81,7,11, 0,8,99, 0,8,35, 0,9,166,\n    0,8,3, 0,8,131, 0,8,67, 0,9,230,\n    80,7,7, 0,8,91, 0,8,27, 0,9,150,\n    84,7,67, 0,8,123, 0,8,59, 0,9,214,\n    82,7,19, 0,8,107, 0,8,43, 0,9,182,\n    0,8,11, 0,8,139, 0,8,75, 0,9,246,\n    80,7,5, 0,8,87, 0,8,23, 192,8,0,\n    83,7,51, 0,8,119, 0,8,55, 0,9,206,\n    81,7,15, 0,8,103, 0,8,39, 0,9,174,\n    0,8,7, 0,8,135, 0,8,71, 0,9,238,\n    80,7,9, 0,8,95, 0,8,31, 0,9,158,\n    84,7,99, 0,8,127, 0,8,63, 0,9,222,\n    82,7,27, 0,8,111, 0,8,47, 0,9,190,\n    0,8,15, 0,8,143, 0,8,79, 0,9,254,\n    96,7,256, 0,8,80, 0,8,16, 84,8,115,\n    82,7,31, 0,8,112, 0,8,48, 0,9,193,\n\n    80,7,10, 0,8,96, 0,8,32, 0,9,161,\n    0,8,0, 0,8,128, 0,8,64, 0,9,225,\n    80,7,6, 0,8,88, 0,8,24, 0,9,145,\n    83,7,59, 0,8,120, 0,8,56, 0,9,209,\n    81,7,17, 0,8,104, 0,8,40, 0,9,177,\n    0,8,8, 0,8,136, 0,8,72, 0,9,241,\n    80,7,4, 0,8,84, 0,8,20, 85,8,227,\n    83,7,43, 0,8,116, 0,8,52, 0,9,201,\n    81,7,13, 0,8,100, 0,8,36, 0,9,169,\n    0,8,4, 0,8,132, 0,8,68, 0,9,233,\n    80,7,8, 0,8,92, 0,8,28, 0,9,153,\n    84,7,83, 0,8,124, 0,8,60, 0,9,217,\n    82,7,23, 0,8,108, 0,8,44, 0,9,185,\n    0,8,12, 0,8,140, 0,8,76, 0,9,249,\n    80,7,3, 0,8,82, 0,8,18, 85,8,163,\n    83,7,35, 0,8,114, 0,8,50, 0,9,197,\n    81,7,11, 0,8,98, 0,8,34, 0,9,165,\n    0,8,2, 0,8,130, 0,8,66, 0,9,229,\n    80,7,7, 0,8,90, 0,8,26, 0,9,149,\n    84,7,67, 0,8,122, 0,8,58, 0,9,213,\n    82,7,19, 0,8,106, 0,8,42, 0,9,181,\n    0,8,10, 0,8,138, 0,8,74, 0,9,245,\n    80,7,5, 0,8,86, 0,8,22, 192,8,0,\n    83,7,51, 0,8,118, 0,8,54, 0,9,205,\n    81,7,15, 0,8,102, 0,8,38, 0,9,173,\n    0,8,6, 0,8,134, 0,8,70, 0,9,237,\n    80,7,9, 0,8,94, 0,8,30, 0,9,157,\n    84,7,99, 0,8,126, 0,8,62, 0,9,221,\n    82,7,27, 0,8,110, 0,8,46, 0,9,189,\n    0,8,14, 0,8,142, 0,8,78, 0,9,253,\n    96,7,256, 0,8,81, 0,8,17, 85,8,131,\n    82,7,31, 0,8,113, 0,8,49, 0,9,195,\n    80,7,10, 0,8,97, 0,8,33, 0,9,163,\n    0,8,1, 0,8,129, 0,8,65, 0,9,227,\n    80,7,6, 0,8,89, 0,8,25, 0,9,147,\n    83,7,59, 0,8,121, 0,8,57, 0,9,211,\n    81,7,17, 0,8,105, 0,8,41, 0,9,179,\n    0,8,9, 0,8,137, 0,8,73, 0,9,243,\n    80,7,4, 0,8,85, 0,8,21, 80,8,258,\n    83,7,43, 0,8,117, 0,8,53, 0,9,203,\n    81,7,13, 0,8,101, 0,8,37, 0,9,171,\n    0,8,5, 0,8,133, 0,8,69, 0,9,235,\n    80,7,8, 0,8,93, 0,8,29, 0,9,155,\n    84,7,83, 0,8,125, 0,8,61, 0,9,219,\n    82,7,23, 0,8,109, 0,8,45, 0,9,187,\n    0,8,13, 0,8,141, 0,8,77, 0,9,251,\n    80,7,3, 0,8,83, 0,8,19, 85,8,195,\n    83,7,35, 0,8,115, 0,8,51, 0,9,199,\n    81,7,11, 0,8,99, 0,8,35, 0,9,167,\n    0,8,3, 0,8,131, 0,8,67, 0,9,231,\n    80,7,7, 0,8,91, 0,8,27, 0,9,151,\n    84,7,67, 0,8,123, 0,8,59, 0,9,215,\n    82,7,19, 0,8,107, 0,8,43, 0,9,183,\n    0,8,11, 0,8,139, 0,8,75, 0,9,247,\n    80,7,5, 0,8,87, 0,8,23, 192,8,0,\n    83,7,51, 0,8,119, 0,8,55, 0,9,207,\n    81,7,15, 0,8,103, 0,8,39, 0,9,175,\n    0,8,7, 0,8,135, 0,8,71, 0,9,239,\n    80,7,9, 0,8,95, 0,8,31, 0,9,159,\n    84,7,99, 0,8,127, 0,8,63, 0,9,223,\n    82,7,27, 0,8,111, 0,8,47, 0,9,191,\n    0,8,15, 0,8,143, 0,8,79, 0,9,255\n];\nvar fixed_td = [\n    80,5,1, 87,5,257, 83,5,17, 91,5,4097,\n    81,5,5, 89,5,1025, 85,5,65, 93,5,16385,\n    80,5,3, 88,5,513, 84,5,33, 92,5,8193,\n    82,5,9, 90,5,2049, 86,5,129, 192,5,24577,\n    80,5,2, 87,5,385, 83,5,25, 91,5,6145,\n    81,5,7, 89,5,1537, 85,5,97, 93,5,24577,\n    80,5,4, 88,5,769, 84,5,49, 92,5,12289,\n    82,5,13, 90,5,3073, 86,5,193, 192,5,24577\n];\n\n  // Tables for deflate from PKZIP's appnote.txt.\n  var cplens = [ // Copy lengths for literal codes 257..285\n        3, 4, 5, 6, 7, 8, 9, 10, 11, 13, 15, 17, 19, 23, 27, 31,\n        35, 43, 51, 59, 67, 83, 99, 115, 131, 163, 195, 227, 258, 0, 0\n  ];\n\n  // see note #13 above about 258\n  var cplext = [ // Extra bits for literal codes 257..285\n        0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 2, 2, 2, 2,\n        3, 3, 3, 3, 4, 4, 4, 4, 5, 5, 5, 5, 0, 112, 112  // 112==invalid\n  ];\n\n var cpdist = [ // Copy offsets for distance codes 0..29\n        1, 2, 3, 4, 5, 7, 9, 13, 17, 25, 33, 49, 65, 97, 129, 193,\n        257, 385, 513, 769, 1025, 1537, 2049, 3073, 4097, 6145,\n        8193, 12289, 16385, 24577\n  ];\n\n  var cpdext = [ // Extra bits for distance codes\n        0, 0, 0, 0, 1, 1, 2, 2, 3, 3, 4, 4, 5, 5, 6, 6,\n        7, 7, 8, 8, 9, 9, 10, 10, 11, 11,\n        12, 12, 13, 13];\n\n//\n// ZStream.java\n//\n\nfunction ZStream() {\n}\n\n\nZStream.prototype.inflateInit = function(w, nowrap) {\n    if (!w) {\n\tw = DEF_WBITS;\n    }\n    if (nowrap) {\n\tnowrap = false;\n    }\n    this.istate = new Inflate();\n    return this.istate.inflateInit(this, nowrap?-w:w);\n}\n\nZStream.prototype.inflate = function(f) {\n    if(this.istate==null) return Z_STREAM_ERROR;\n    return this.istate.inflate(this, f);\n}\n\nZStream.prototype.inflateEnd = function(){\n    if(this.istate==null) return Z_STREAM_ERROR;\n    var ret=istate.inflateEnd(this);\n    this.istate = null;\n    return ret;\n}\nZStream.prototype.inflateSync = function(){\n    // if(istate == null) return Z_STREAM_ERROR;\n    return istate.inflateSync(this);\n}\nZStream.prototype.inflateSetDictionary = function(dictionary, dictLength){\n    // if(istate == null) return Z_STREAM_ERROR;\n    return istate.inflateSetDictionary(this, dictionary, dictLength);\n}\n\n/*\n\n  public int deflateInit(int level){\n    return deflateInit(level, MAX_WBITS);\n  }\n  public int deflateInit(int level, boolean nowrap){\n    return deflateInit(level, MAX_WBITS, nowrap);\n  }\n  public int deflateInit(int level, int bits){\n    return deflateInit(level, bits, false);\n  }\n  public int deflateInit(int level, int bits, boolean nowrap){\n    dstate=new Deflate();\n    return dstate.deflateInit(this, level, nowrap?-bits:bits);\n  }\n  public int deflate(int flush){\n    if(dstate==null){\n      return Z_STREAM_ERROR;\n    }\n    return dstate.deflate(this, flush);\n  }\n  public int deflateEnd(){\n    if(dstate==null) return Z_STREAM_ERROR;\n    int ret=dstate.deflateEnd();\n    dstate=null;\n    return ret;\n  }\n  public int deflateParams(int level, int strategy){\n    if(dstate==null) return Z_STREAM_ERROR;\n    return dstate.deflateParams(this, level, strategy);\n  }\n  public int deflateSetDictionary (byte[] dictionary, int dictLength){\n    if(dstate == null)\n      return Z_STREAM_ERROR;\n    return dstate.deflateSetDictionary(this, dictionary, dictLength);\n  }\n\n*/\n\n/*\n  // Flush as much pending output as possible. All deflate() output goes\n  // through this function so some applications may wish to modify it\n  // to avoid allocating a large strm->next_out buffer and copying into it.\n  // (See also read_buf()).\n  void flush_pending(){\n    int len=dstate.pending;\n\n    if(len>avail_out) len=avail_out;\n    if(len==0) return;\n\n    if(dstate.pending_buf.length<=dstate.pending_out ||\n       next_out.length<=next_out_index ||\n       dstate.pending_buf.length<(dstate.pending_out+len) ||\n       next_out.length<(next_out_index+len)){\n      System.out.println(dstate.pending_buf.length+\", \"+dstate.pending_out+\n\t\t\t \", \"+next_out.length+\", \"+next_out_index+\", \"+len);\n      System.out.println(\"avail_out=\"+avail_out);\n    }\n\n    System.arraycopy(dstate.pending_buf, dstate.pending_out,\n\t\t     next_out, next_out_index, len);\n\n    next_out_index+=len;\n    dstate.pending_out+=len;\n    total_out+=len;\n    avail_out-=len;\n    dstate.pending-=len;\n    if(dstate.pending==0){\n      dstate.pending_out=0;\n    }\n  }\n\n  // Read a new buffer from the current input stream, update the adler32\n  // and total number of bytes read.  All deflate() input goes through\n  // this function so some applications may wish to modify it to avoid\n  // allocating a large strm->next_in buffer and copying from it.\n  // (See also flush_pending()).\n  int read_buf(byte[] buf, int start, int size) {\n    int len=avail_in;\n\n    if(len>size) len=size;\n    if(len==0) return 0;\n\n    avail_in-=len;\n\n    if(dstate.noheader==0) {\n      adler=_adler.adler32(adler, next_in, next_in_index, len);\n    }\n    System.arraycopy(next_in, next_in_index, buf, start, len);\n    next_in_index  += len;\n    total_in += len;\n    return len;\n  }\n\n  public void free(){\n    next_in=null;\n    next_out=null;\n    msg=null;\n    _adler=null;\n  }\n}\n*/\n\n\n//\n// Inflate.java\n//\n\nfunction Inflate() {\n    this.was = [0];\n}\n\nInflate.prototype.inflateReset = function(z) {\n    if(z == null || z.istate == null) return Z_STREAM_ERROR;\n    \n    z.total_in = z.total_out = 0;\n    z.msg = null;\n    z.istate.mode = z.istate.nowrap!=0 ? BLOCKS : METHOD;\n    z.istate.blocks.reset(z, null);\n    return Z_OK;\n}\n\nInflate.prototype.inflateEnd = function(z){\n    if(this.blocks != null)\n      this.blocks.free(z);\n    this.blocks=null;\n    return Z_OK;\n}\n\nInflate.prototype.inflateInit = function(z, w){\n    z.msg = null;\n    this.blocks = null;\n\n    // handle undocumented nowrap option (no zlib header or check)\n    nowrap = 0;\n    if(w < 0){\n      w = - w;\n      nowrap = 1;\n    }\n\n    // set window size\n    if(w<8 ||w>15){\n      this.inflateEnd(z);\n      return Z_STREAM_ERROR;\n    }\n    this.wbits=w;\n\n    z.istate.blocks=new InfBlocks(z, \n\t\t\t\t  z.istate.nowrap!=0 ? null : this,\n\t\t\t\t  1<<w);\n\n    // reset state\n    this.inflateReset(z);\n    return Z_OK;\n  }\n\nInflate.prototype.inflate = function(z, f){\n    var r, b;\n\n    if(z == null || z.istate == null || z.next_in == null)\n      return Z_STREAM_ERROR;\n    f = f == Z_FINISH ? Z_BUF_ERROR : Z_OK;\n    r = Z_BUF_ERROR;\n    while (true){\n      switch (z.istate.mode){\n      case METHOD:\n\n        if(z.avail_in==0)return r;r=f;\n\n        z.avail_in--; z.total_in++;\n        if(((z.istate.method = z.next_in[z.next_in_index++])&0xf)!=Z_DEFLATED){\n          z.istate.mode = BAD;\n          z.msg=\"unknown compression method\";\n          z.istate.marker = 5;       // can't try inflateSync\n          break;\n        }\n        if((z.istate.method>>4)+8>z.istate.wbits){\n          z.istate.mode = BAD;\n          z.msg=\"invalid window size\";\n          z.istate.marker = 5;       // can't try inflateSync\n          break;\n        }\n        z.istate.mode=FLAG;\n      case FLAG:\n\n        if(z.avail_in==0)return r;r=f;\n\n        z.avail_in--; z.total_in++;\n        b = (z.next_in[z.next_in_index++])&0xff;\n\n        if((((z.istate.method << 8)+b) % 31)!=0){\n          z.istate.mode = BAD;\n          z.msg = \"incorrect header check\";\n          z.istate.marker = 5;       // can't try inflateSync\n          break;\n        }\n\n        if((b&PRESET_DICT)==0){\n          z.istate.mode = BLOCKS;\n          break;\n        }\n        z.istate.mode = DICT4;\n      case DICT4:\n\n        if(z.avail_in==0)return r;r=f;\n\n        z.avail_in--; z.total_in++;\n        z.istate.need=((z.next_in[z.next_in_index++]&0xff)<<24)&0xff000000;\n        z.istate.mode=DICT3;\n      case DICT3:\n\n        if(z.avail_in==0)return r;r=f;\n\n        z.avail_in--; z.total_in++;\n        z.istate.need+=((z.next_in[z.next_in_index++]&0xff)<<16)&0xff0000;\n        z.istate.mode=DICT2;\n      case DICT2:\n\n        if(z.avail_in==0)return r;r=f;\n\n        z.avail_in--; z.total_in++;\n        z.istate.need+=((z.next_in[z.next_in_index++]&0xff)<<8)&0xff00;\n        z.istate.mode=DICT1;\n      case DICT1:\n\n        if(z.avail_in==0)return r;r=f;\n\n        z.avail_in--; z.total_in++;\n        z.istate.need += (z.next_in[z.next_in_index++]&0xff);\n        z.adler = z.istate.need;\n        z.istate.mode = DICT0;\n        return Z_NEED_DICT;\n      case DICT0:\n        z.istate.mode = BAD;\n        z.msg = \"need dictionary\";\n        z.istate.marker = 0;       // can try inflateSync\n        return Z_STREAM_ERROR;\n      case BLOCKS:\n\n        r = z.istate.blocks.proc(z, r);\n        if(r == Z_DATA_ERROR){\n          z.istate.mode = BAD;\n          z.istate.marker = 0;     // can try inflateSync\n          break;\n        }\n        if(r == Z_OK){\n          r = f;\n        }\n        if(r != Z_STREAM_END){\n          return r;\n        }\n        r = f;\n        z.istate.blocks.reset(z, z.istate.was);\n        if(z.istate.nowrap!=0){\n          z.istate.mode=DONE;\n          break;\n        }\n        z.istate.mode=CHECK4;\n      case CHECK4:\n\n        if(z.avail_in==0)return r;r=f;\n\n        z.avail_in--; z.total_in++;\n        z.istate.need=((z.next_in[z.next_in_index++]&0xff)<<24)&0xff000000;\n        z.istate.mode=CHECK3;\n      case CHECK3:\n\n        if(z.avail_in==0)return r;r=f;\n\n        z.avail_in--; z.total_in++;\n        z.istate.need+=((z.next_in[z.next_in_index++]&0xff)<<16)&0xff0000;\n        z.istate.mode = CHECK2;\n      case CHECK2:\n\n        if(z.avail_in==0)return r;r=f;\n\n        z.avail_in--; z.total_in++;\n        z.istate.need+=((z.next_in[z.next_in_index++]&0xff)<<8)&0xff00;\n        z.istate.mode = CHECK1;\n      case CHECK1:\n\n        if(z.avail_in==0)return r;r=f;\n\n        z.avail_in--; z.total_in++;\n        z.istate.need+=(z.next_in[z.next_in_index++]&0xff);\n\n        if(((z.istate.was[0])) != ((z.istate.need))){\n          z.istate.mode = BAD;\n          z.msg = \"incorrect data check\";\n          z.istate.marker = 5;       // can't try inflateSync\n          break;\n        }\n\n        z.istate.mode = DONE;\n      case DONE:\n        return Z_STREAM_END;\n      case BAD:\n        return Z_DATA_ERROR;\n      default:\n        return Z_STREAM_ERROR;\n      }\n    }\n  }\n\n\nInflate.prototype.inflateSetDictionary = function(z,  dictionary, dictLength) {\n    var index=0;\n    var length = dictLength;\n    if(z==null || z.istate == null|| z.istate.mode != DICT0)\n      return Z_STREAM_ERROR;\n\n    if(z._adler.adler32(1, dictionary, 0, dictLength)!=z.adler){\n      return Z_DATA_ERROR;\n    }\n\n    z.adler = z._adler.adler32(0, null, 0, 0);\n\n    if(length >= (1<<z.istate.wbits)){\n      length = (1<<z.istate.wbits)-1;\n      index=dictLength - length;\n    }\n    z.istate.blocks.set_dictionary(dictionary, index, length);\n    z.istate.mode = BLOCKS;\n    return Z_OK;\n  }\n\n//  static private byte[] mark = {(byte)0, (byte)0, (byte)0xff, (byte)0xff};\nvar mark = [0, 0, 255, 255]\n\nInflate.prototype.inflateSync = function(z){\n    var n;       // number of bytes to look at\n    var p;       // pointer to bytes\n    var m;       // number of marker bytes found in a row\n    var r, w;   // temporaries to save total_in and total_out\n\n    // set up\n    if(z == null || z.istate == null)\n      return Z_STREAM_ERROR;\n    if(z.istate.mode != BAD){\n      z.istate.mode = BAD;\n      z.istate.marker = 0;\n    }\n    if((n=z.avail_in)==0)\n      return Z_BUF_ERROR;\n    p=z.next_in_index;\n    m=z.istate.marker;\n\n    // search\n    while (n!=0 && m < 4){\n      if(z.next_in[p] == mark[m]){\n        m++;\n      }\n      else if(z.next_in[p]!=0){\n        m = 0;\n      }\n      else{\n        m = 4 - m;\n      }\n      p++; n--;\n    }\n\n    // restore\n    z.total_in += p-z.next_in_index;\n    z.next_in_index = p;\n    z.avail_in = n;\n    z.istate.marker = m;\n\n    // return no joy or set up to restart on a new block\n    if(m != 4){\n      return Z_DATA_ERROR;\n    }\n    r=z.total_in;  w=z.total_out;\n    this.inflateReset(z);\n    z.total_in=r;  z.total_out = w;\n    z.istate.mode = BLOCKS;\n    return Z_OK;\n}\n\n  // Returns true if inflate is currently at the end of a block generated\n  // by Z_SYNC_FLUSH or Z_FULL_FLUSH. This function is used by one PPP\n  // implementation to provide an additional safety check. PPP uses Z_SYNC_FLUSH\n  // but removes the length bytes of the resulting empty stored block. When\n  // decompressing, PPP checks that at the end of input packet, inflate is\n  // waiting for these length bytes.\nInflate.prototype.inflateSyncPoint = function(z){\n    if(z == null || z.istate == null || z.istate.blocks == null)\n      return Z_STREAM_ERROR;\n    return z.istate.blocks.sync_point();\n}\n\n\n//\n// InfBlocks.java\n//\n\nvar INFBLOCKS_BORDER = [16, 17, 18, 0, 8, 7, 9, 6, 10, 5, 11, 4, 12, 3, 13, 2, 14, 1, 15];\n\nfunction InfBlocks(z, checkfn, w) {\n    this.hufts=new Int32Array(MANY*3);\n    this.window=new Uint8Array(w);\n    this.end=w;\n    this.checkfn = checkfn;\n    this.mode = IB_TYPE;\n    this.reset(z, null);\n\n    this.left = 0;            // if STORED, bytes left to copy \n\n    this.table = 0;           // table lengths (14 bits) \n    this.index = 0;           // index into blens (or border) \n    this.blens = null;         // bit lengths of codes \n    this.bb=new Int32Array(1); // bit length tree depth \n    this.tb=new Int32Array(1); // bit length decoding tree \n\n    this.codes = new InfCodes();\n\n    this.last = 0;            // true if this block is the last block \n\n  // mode independent information \n    this.bitk = 0;            // bits in bit buffer \n    this.bitb = 0;            // bit buffer \n    this.read = 0;            // window read pointer \n    this.write = 0;           // window write pointer \n    this.check = 0;          // check on output \n\n    this.inftree=new InfTree();\n}\n\n\n\n\nInfBlocks.prototype.reset = function(z, c){\n    if(c) c[0]=this.check;\n    if(this.mode==IB_CODES){\n      this.codes.free(z);\n    }\n    this.mode=IB_TYPE;\n    this.bitk=0;\n    this.bitb=0;\n    this.read=this.write=0;\n\n    if(this.checkfn)\n      z.adler=this.check=z._adler.adler32(0, null, 0, 0);\n  }\n\n InfBlocks.prototype.proc = function(z, r){\n    var t;              // temporary storage\n    var b;              // bit buffer\n    var k;              // bits in bit buffer\n    var p;              // input data pointer\n    var n;              // bytes available there\n    var q;              // output window write pointer\n    var m;              // bytes to end of window or read pointer\n\n    // copy input/output information to locals (UPDATE macro restores)\n    {p=z.next_in_index;n=z.avail_in;b=this.bitb;k=this.bitk;}\n    {q=this.write;m=(q<this.read ? this.read-q-1 : this.end-q);}\n\n    // process input based on current state\n    while(true){\n      switch (this.mode){\n      case IB_TYPE:\n\n\twhile(k<(3)){\n\t  if(n!=0){\n\t    r=Z_OK;\n\t  }\n\t  else{\n\t    this.bitb=b; this.bitk=k; \n\t    z.avail_in=n;\n\t    z.total_in+=p-z.next_in_index;z.next_in_index=p;\n\t    this.write=q;\n\t    return this.inflate_flush(z,r);\n\t  };\n\t  n--;\n\t  b|=(z.next_in[p++]&0xff)<<k;\n\t  k+=8;\n\t}\n\tt = (b & 7);\n\tthis.last = t & 1;\n\n\tswitch (t >>> 1){\n        case 0:                         // stored \n          {b>>>=(3);k-=(3);}\n          t = k & 7;                    // go to byte boundary\n\n          {b>>>=(t);k-=(t);}\n          this.mode = IB_LENS;                  // get length of stored block\n          break;\n        case 1:                         // fixed\n          {\n              var bl=new Int32Array(1);\n\t      var bd=new Int32Array(1);\n              var tl=[];\n\t      var td=[];\n\n\t      inflate_trees_fixed(bl, bd, tl, td, z);\n              this.codes.init(bl[0], bd[0], tl[0], 0, td[0], 0, z);\n          }\n\n          {b>>>=(3);k-=(3);}\n\n          this.mode = IB_CODES;\n          break;\n        case 2:                         // dynamic\n\n          {b>>>=(3);k-=(3);}\n\n          this.mode = IB_TABLE;\n          break;\n        case 3:                         // illegal\n\n          {b>>>=(3);k-=(3);}\n          this.mode = BAD;\n          z.msg = \"invalid block type\";\n          r = Z_DATA_ERROR;\n\n\t  this.bitb=b; this.bitk=k; \n\t  z.avail_in=n;z.total_in+=p-z.next_in_index;z.next_in_index=p;\n\t  this.write=q;\n\t  return this.inflate_flush(z,r);\n\t}\n\tbreak;\n      case IB_LENS:\n\twhile(k<(32)){\n\t  if(n!=0){\n\t    r=Z_OK;\n\t  }\n\t  else{\n\t    this.bitb=b; this.bitk=k; \n\t    z.avail_in=n;\n\t    z.total_in+=p-z.next_in_index;z.next_in_index=p;\n\t    this.write=q;\n\t    return this.inflate_flush(z,r);\n\t  };\n\t  n--;\n\t  b|=(z.next_in[p++]&0xff)<<k;\n\t  k+=8;\n\t}\n\n\tif ((((~b) >>> 16) & 0xffff) != (b & 0xffff)){\n\t  this.mode = BAD;\n\t  z.msg = \"invalid stored block lengths\";\n\t  r = Z_DATA_ERROR;\n\n\t  this.bitb=b; this.bitk=k; \n\t  z.avail_in=n;z.total_in+=p-z.next_in_index;z.next_in_index=p;\n\t  this.write=q;\n\t  return this.inflate_flush(z,r);\n\t}\n\tthis.left = (b & 0xffff);\n\tb = k = 0;                       // dump bits\n\tthis.mode = this.left!=0 ? IB_STORED : (this.last!=0 ? IB_DRY : IB_TYPE);\n\tbreak;\n      case IB_STORED:\n\tif (n == 0){\n\t  this.bitb=b; this.bitk=k; \n\t  z.avail_in=n;z.total_in+=p-z.next_in_index;z.next_in_index=p;\n\t  write=q;\n\t  return this.inflate_flush(z,r);\n\t}\n\n\tif(m==0){\n\t  if(q==end&&read!=0){\n\t    q=0; m=(q<this.read ? this.read-q-1 : this.end-q);\n\t  }\n\t  if(m==0){\n\t    this.write=q; \n\t    r=this.inflate_flush(z,r);\n\t    q=this.write; m = (q < this.read ? this.read-q-1 : this.end-q);\n\t    if(q==this.end && this.read != 0){\n\t      q=0; m = (q < this.read ? this.read-q-1 : this.end-q);\n\t    }\n\t    if(m==0){\n\t      this.bitb=b; this.bitk=k; \n\t      z.avail_in=n;z.total_in+=p-z.next_in_index;z.next_in_index=p;\n\t      this.write=q;\n\t      return this.inflate_flush(z,r);\n\t    }\n\t  }\n\t}\n\tr=Z_OK;\n\n\tt = this.left;\n\tif(t>n) t = n;\n\tif(t>m) t = m;\n\tarrayCopy(z.next_in, p, this.window, q, t);\n\tp += t;  n -= t;\n\tq += t;  m -= t;\n\tif ((this.left -= t) != 0)\n\t  break;\n\tthis.mode = (this.last != 0 ? IB_DRY : IB_TYPE);\n\tbreak;\n      case IB_TABLE:\n\n\twhile(k<(14)){\n\t  if(n!=0){\n\t    r=Z_OK;\n\t  }\n\t  else{\n\t    this.bitb=b; this.bitk=k; \n\t    z.avail_in=n;\n\t    z.total_in+=p-z.next_in_index;z.next_in_index=p;\n\t    this.write=q;\n\t    return this.inflate_flush(z,r);\n\t  };\n\t  n--;\n\t  b|=(z.next_in[p++]&0xff)<<k;\n\t  k+=8;\n\t}\n\n\tthis.table = t = (b & 0x3fff);\n\tif ((t & 0x1f) > 29 || ((t >> 5) & 0x1f) > 29)\n\t  {\n\t    this.mode = IB_BAD;\n\t    z.msg = \"too many length or distance symbols\";\n\t    r = Z_DATA_ERROR;\n\n\t    this.bitb=b; this.bitk=k; \n\t    z.avail_in=n;z.total_in+=p-z.next_in_index;z.next_in_index=p;\n\t    this.write=q;\n\t    return this.inflate_flush(z,r);\n\t  }\n\tt = 258 + (t & 0x1f) + ((t >> 5) & 0x1f);\n\tif(this.blens==null || this.blens.length<t){\n\t    this.blens=new Int32Array(t);\n\t}\n\telse{\n\t  for(var i=0; i<t; i++){\n              this.blens[i]=0;\n          }\n\t}\n\n\t{b>>>=(14);k-=(14);}\n\n\tthis.index = 0;\n\tmode = IB_BTREE;\n      case IB_BTREE:\n\twhile (this.index < 4 + (this.table >>> 10)){\n\t  while(k<(3)){\n\t    if(n!=0){\n\t      r=Z_OK;\n\t    }\n\t    else{\n\t      this.bitb=b; this.bitk=k; \n\t      z.avail_in=n;\n\t      z.total_in+=p-z.next_in_index;z.next_in_index=p;\n\t      this.write=q;\n\t      return this.inflate_flush(z,r);\n\t    };\n\t    n--;\n\t    b|=(z.next_in[p++]&0xff)<<k;\n\t    k+=8;\n\t  }\n\n\t  this.blens[INFBLOCKS_BORDER[this.index++]] = b&7;\n\n\t  {b>>>=(3);k-=(3);}\n\t}\n\n\twhile(this.index < 19){\n\t  this.blens[INFBLOCKS_BORDER[this.index++]] = 0;\n\t}\n\n\tthis.bb[0] = 7;\n\tt = this.inftree.inflate_trees_bits(this.blens, this.bb, this.tb, this.hufts, z);\n\tif (t != Z_OK){\n\t  r = t;\n\t  if (r == Z_DATA_ERROR){\n\t    this.blens=null;\n\t    this.mode = IB_BAD;\n\t  }\n\n\t  this.bitb=b; this.bitk=k; \n\t  z.avail_in=n;z.total_in+=p-z.next_in_index;z.next_in_index=p;\n\t  write=q;\n\t  return this.inflate_flush(z,r);\n\t}\n\n\tthis.index = 0;\n\tthis.mode = IB_DTREE;\n      case IB_DTREE:\n\twhile (true){\n\t  t = this.table;\n\t  if(!(this.index < 258 + (t & 0x1f) + ((t >> 5) & 0x1f))){\n\t    break;\n\t  }\n\n\t  var h; //int[]\n\t  var i, j, c;\n\n\t  t = this.bb[0];\n\n\t  while(k<(t)){\n\t    if(n!=0){\n\t      r=Z_OK;\n\t    }\n\t    else{\n\t      this.bitb=b; this.bitk=k; \n\t      z.avail_in=n;\n\t      z.total_in+=p-z.next_in_index;z.next_in_index=p;\n\t      this.write=q;\n\t      return this.inflate_flush(z,r);\n\t    };\n\t    n--;\n\t    b|=(z.next_in[p++]&0xff)<<k;\n\t    k+=8;\n\t  }\n\n//\t  if (this.tb[0]==-1){\n//            dlog(\"null...\");\n//\t  }\n\n\t  t=this.hufts[(this.tb[0]+(b & inflate_mask[t]))*3+1];\n\t  c=this.hufts[(this.tb[0]+(b & inflate_mask[t]))*3+2];\n\n\t  if (c < 16){\n\t    b>>>=(t);k-=(t);\n\t    this.blens[this.index++] = c;\n\t  }\n\t  else { // c == 16..18\n\t    i = c == 18 ? 7 : c - 14;\n\t    j = c == 18 ? 11 : 3;\n\n\t    while(k<(t+i)){\n\t      if(n!=0){\n\t\tr=Z_OK;\n\t      }\n\t      else{\n\t\tthis.bitb=b; this.bitk=k; \n\t\tz.avail_in=n;\n\t\tz.total_in+=p-z.next_in_index;z.next_in_index=p;\n\t\tthis.write=q;\n\t\treturn this.inflate_flush(z,r);\n\t      };\n\t      n--;\n\t      b|=(z.next_in[p++]&0xff)<<k;\n\t      k+=8;\n\t    }\n\n\t    b>>>=(t);k-=(t);\n\n\t    j += (b & inflate_mask[i]);\n\n\t    b>>>=(i);k-=(i);\n\n\t    i = this.index;\n\t    t = this.table;\n\t    if (i + j > 258 + (t & 0x1f) + ((t >> 5) & 0x1f) ||\n\t\t(c == 16 && i < 1)){\n\t      this.blens=null;\n\t      this.mode = IB_BAD;\n\t      z.msg = \"invalid bit length repeat\";\n\t      r = Z_DATA_ERROR;\n\n\t      this.bitb=b; this.bitk=k; \n\t      z.avail_in=n;z.total_in+=p-z.next_in_index;z.next_in_index=p;\n\t      this.write=q;\n\t      return this.inflate_flush(z,r);\n\t    }\n\n\t    c = c == 16 ? this.blens[i-1] : 0;\n\t    do{\n\t      this.blens[i++] = c;\n\t    }\n\t    while (--j!=0);\n\t    this.index = i;\n\t  }\n\t}\n\n\tthis.tb[0]=-1;\n\t{\n\t    var bl=new Int32Array(1);\n\t    var bd=new Int32Array(1);\n\t    var tl=new Int32Array(1);\n\t    var td=new Int32Array(1);\n\t    bl[0] = 9;         // must be <= 9 for lookahead assumptions\n\t    bd[0] = 6;         // must be <= 9 for lookahead assumptions\n\n\t    t = this.table;\n\t    t = this.inftree.inflate_trees_dynamic(257 + (t & 0x1f), \n\t\t\t\t\t      1 + ((t >> 5) & 0x1f),\n\t\t\t\t\t      this.blens, bl, bd, tl, td, this.hufts, z);\n\n\t    if (t != Z_OK){\n\t        if (t == Z_DATA_ERROR){\n\t            this.blens=null;\n\t            this.mode = BAD;\n\t        }\n\t        r = t;\n\n\t        this.bitb=b; this.bitk=k; \n\t        z.avail_in=n;z.total_in+=p-z.next_in_index;z.next_in_index=p;\n\t        this.write=q;\n\t        return this.inflate_flush(z,r);\n\t    }\n\t    this.codes.init(bl[0], bd[0], this.hufts, tl[0], this.hufts, td[0], z);\n\t}\n\tthis.mode = IB_CODES;\n      case IB_CODES:\n\tthis.bitb=b; this.bitk=k;\n\tz.avail_in=n; z.total_in+=p-z.next_in_index;z.next_in_index=p;\n\tthis.write=q;\n\n\tif ((r = this.codes.proc(this, z, r)) != Z_STREAM_END){\n\t  return this.inflate_flush(z, r);\n\t}\n\tr = Z_OK;\n\tthis.codes.free(z);\n\n\tp=z.next_in_index; n=z.avail_in;b=this.bitb;k=this.bitk;\n\tq=this.write;m = (q < this.read ? this.read-q-1 : this.end-q);\n\n\tif (this.last==0){\n\t  this.mode = IB_TYPE;\n\t  break;\n\t}\n\tthis.mode = IB_DRY;\n      case IB_DRY:\n\tthis.write=q; \n\tr = this.inflate_flush(z, r); \n\tq=this.write; m = (q < this.read ? this.read-q-1 : this.end-q);\n\tif (this.read != this.write){\n\t  this.bitb=b; this.bitk=k; \n\t  z.avail_in=n;z.total_in+=p-z.next_in_index;z.next_in_index=p;\n\t  this.write=q;\n\t  return this.inflate_flush(z, r);\n\t}\n\tmode = DONE;\n      case IB_DONE:\n\tr = Z_STREAM_END;\n\n\tthis.bitb=b; this.bitk=k; \n\tz.avail_in=n;z.total_in+=p-z.next_in_index;z.next_in_index=p;\n\tthis.write=q;\n\treturn this.inflate_flush(z, r);\n      case IB_BAD:\n\tr = Z_DATA_ERROR;\n\n\tthis.bitb=b; this.bitk=k; \n\tz.avail_in=n;z.total_in+=p-z.next_in_index;z.next_in_index=p;\n\tthis.write=q;\n\treturn this.inflate_flush(z, r);\n\n      default:\n\tr = Z_STREAM_ERROR;\n\n\tthis.bitb=b; this.bitk=k; \n\tz.avail_in=n;z.total_in+=p-z.next_in_index;z.next_in_index=p;\n\tthis.write=q;\n\treturn this.inflate_flush(z, r);\n      }\n    }\n  }\n\nInfBlocks.prototype.free = function(z){\n    this.reset(z, null);\n    this.window=null;\n    this.hufts=null;\n}\n\nInfBlocks.prototype.set_dictionary = function(d, start, n){\n    arrayCopy(d, start, window, 0, n);\n    this.read = this.write = n;\n}\n\n  // Returns true if inflate is currently at the end of a block generated\n  // by Z_SYNC_FLUSH or Z_FULL_FLUSH. \nInfBlocks.prototype.sync_point = function(){\n    return this.mode == IB_LENS;\n}\n\n  // copy as much as possible from the sliding window to the output area\nInfBlocks.prototype.inflate_flush = function(z, r){\n    var n;\n    var p;\n    var q;\n\n    // local copies of source and destination pointers\n    p = z.next_out_index;\n    q = this.read;\n\n    // compute number of bytes to copy as far as end of window\n    n = ((q <= this.write ? this.write : this.end) - q);\n    if (n > z.avail_out) n = z.avail_out;\n    if (n!=0 && r == Z_BUF_ERROR) r = Z_OK;\n\n    // update counters\n    z.avail_out -= n;\n    z.total_out += n;\n\n    // update check information\n    if(this.checkfn != null)\n      z.adler=this.check=z._adler.adler32(this.check, this.window, q, n);\n\n    // copy as far as end of window\n    arrayCopy(this.window, q, z.next_out, p, n);\n    p += n;\n    q += n;\n\n    // see if more to copy at beginning of window\n    if (q == this.end){\n      // wrap pointers\n      q = 0;\n      if (this.write == this.end)\n        this.write = 0;\n\n      // compute bytes to copy\n      n = this.write - q;\n      if (n > z.avail_out) n = z.avail_out;\n      if (n!=0 && r == Z_BUF_ERROR) r = Z_OK;\n\n      // update counters\n      z.avail_out -= n;\n      z.total_out += n;\n\n      // update check information\n      if(this.checkfn != null)\n\tz.adler=this.check=z._adler.adler32(this.check, this.window, q, n);\n\n      // copy\n      arrayCopy(this.window, q, z.next_out, p, n);\n      p += n;\n      q += n;\n    }\n\n    // update pointers\n    z.next_out_index = p;\n    this.read = q;\n\n    // done\n    return r;\n  }\n\n//\n// InfCodes.java\n//\n\nvar IC_START=0;  // x: set up for LEN\nvar IC_LEN=1;    // i: get length/literal/eob next\nvar IC_LENEXT=2; // i: getting length extra (have base)\nvar IC_DIST=3;   // i: get distance next\nvar IC_DISTEXT=4;// i: getting distance extra\nvar IC_COPY=5;   // o: copying bytes in window, waiting for space\nvar IC_LIT=6;    // o: got literal, waiting for output space\nvar IC_WASH=7;   // o: got eob, possibly still output waiting\nvar IC_END=8;    // x: got eob and all data flushed\nvar IC_BADCODE=9;// x: got error\n\nfunction InfCodes() {\n}\n\nInfCodes.prototype.init = function(bl, bd, tl, tl_index, td, td_index, z) {\n    this.mode=IC_START;\n    this.lbits=bl;\n    this.dbits=bd;\n    this.ltree=tl;\n    this.ltree_index=tl_index;\n    this.dtree = td;\n    this.dtree_index=td_index;\n    this.tree=null;\n}\n\nInfCodes.prototype.proc = function(s, z, r){ \n    var j;              // temporary storage\n    var t;              // temporary pointer (int[])\n    var tindex;         // temporary pointer\n    var e;              // extra bits or operation\n    var b=0;            // bit buffer\n    var k=0;            // bits in bit buffer\n    var p=0;            // input data pointer\n    var n;              // bytes available there\n    var q;              // output window write pointer\n    var m;              // bytes to end of window or read pointer\n    var f;              // pointer to copy strings from\n\n    // copy input/output information to locals (UPDATE macro restores)\n    p=z.next_in_index;n=z.avail_in;b=s.bitb;k=s.bitk;\n    q=s.write;m=q<s.read?s.read-q-1:s.end-q;\n\n    // process input and output based on current state\n    while (true){\n      switch (this.mode){\n\t// waiting for \"i:\"=input, \"o:\"=output, \"x:\"=nothing\n      case IC_START:         // x: set up for LEN\n\tif (m >= 258 && n >= 10){\n\n\t  s.bitb=b;s.bitk=k;\n\t  z.avail_in=n;z.total_in+=p-z.next_in_index;z.next_in_index=p;\n\t  s.write=q;\n\t  r = this.inflate_fast(this.lbits, this.dbits, \n\t\t\t   this.ltree, this.ltree_index, \n\t\t\t   this.dtree, this.dtree_index,\n\t\t\t   s, z);\n\n\t  p=z.next_in_index;n=z.avail_in;b=s.bitb;k=s.bitk;\n\t  q=s.write;m=q<s.read?s.read-q-1:s.end-q;\n\n\t  if (r != Z_OK){\n\t    this.mode = r == Z_STREAM_END ? IC_WASH : IC_BADCODE;\n\t    break;\n\t  }\n\t}\n\tthis.need = this.lbits;\n\tthis.tree = this.ltree;\n\tthis.tree_index=this.ltree_index;\n\n\tthis.mode = IC_LEN;\n      case IC_LEN:           // i: get length/literal/eob next\n\tj = this.need;\n\n\twhile(k<(j)){\n\t  if(n!=0)r=Z_OK;\n\t  else{\n\n\t    s.bitb=b;s.bitk=k;\n\t    z.avail_in=n;z.total_in+=p-z.next_in_index;z.next_in_index=p;\n\t    s.write=q;\n\t    return s.inflate_flush(z,r);\n\t  }\n\t  n--;\n\t  b|=(z.next_in[p++]&0xff)<<k;\n\t  k+=8;\n\t}\n\n\ttindex=(this.tree_index+(b&inflate_mask[j]))*3;\n\n\tb>>>=(this.tree[tindex+1]);\n\tk-=(this.tree[tindex+1]);\n\n\te=this.tree[tindex];\n\n\tif(e == 0){               // literal\n\t  this.lit = this.tree[tindex+2];\n\t  this.mode = IC_LIT;\n\t  break;\n\t}\n\tif((e & 16)!=0 ){          // length\n\t  this.get = e & 15;\n\t  this.len = this.tree[tindex+2];\n\t  this.mode = IC_LENEXT;\n\t  break;\n\t}\n\tif ((e & 64) == 0){        // next table\n\t  this.need = e;\n\t  this.tree_index = tindex/3 + this.tree[tindex+2];\n\t  break;\n\t}\n\tif ((e & 32)!=0){               // end of block\n\t  this.mode = IC_WASH;\n\t  break;\n\t}\n\tthis.mode = IC_BADCODE;        // invalid code\n\tz.msg = \"invalid literal/length code\";\n\tr = Z_DATA_ERROR;\n\n\ts.bitb=b;s.bitk=k;\n\tz.avail_in=n;z.total_in+=p-z.next_in_index;z.next_in_index=p;\n\ts.write=q;\n\treturn s.inflate_flush(z,r);\n\n      case IC_LENEXT:        // i: getting length extra (have base)\n\tj = this.get;\n\n\twhile(k<(j)){\n\t  if(n!=0)r=Z_OK;\n\t  else{\n\n\t    s.bitb=b;s.bitk=k;\n\t    z.avail_in=n;z.total_in+=p-z.next_in_index;z.next_in_index=p;\n\t    s.write=q;\n\t    return s.inflate_flush(z,r);\n\t  }\n\t  n--; b|=(z.next_in[p++]&0xff)<<k;\n\t  k+=8;\n\t}\n\n\tthis.len += (b & inflate_mask[j]);\n\n\tb>>=j;\n\tk-=j;\n\n\tthis.need = this.dbits;\n\tthis.tree = this.dtree;\n\tthis.tree_index = this.dtree_index;\n\tthis.mode = IC_DIST;\n      case IC_DIST:          // i: get distance next\n\tj = this.need;\n\n\twhile(k<(j)){\n\t  if(n!=0)r=Z_OK;\n\t  else{\n\n\t    s.bitb=b;s.bitk=k;\n\t    z.avail_in=n;z.total_in+=p-z.next_in_index;z.next_in_index=p;\n\t    s.write=q;\n\t    return s.inflate_flush(z,r);\n\t  }\n\t  n--; b|=(z.next_in[p++]&0xff)<<k;\n\t  k+=8;\n\t}\n\n\ttindex=(this.tree_index+(b & inflate_mask[j]))*3;\n\n\tb>>=this.tree[tindex+1];\n\tk-=this.tree[tindex+1];\n\n\te = (this.tree[tindex]);\n\tif((e & 16)!=0){               // distance\n\t  this.get = e & 15;\n\t  this.dist = this.tree[tindex+2];\n\t  this.mode = IC_DISTEXT;\n\t  break;\n\t}\n\tif ((e & 64) == 0){        // next table\n\t  this.need = e;\n\t  this.tree_index = tindex/3 + this.tree[tindex+2];\n\t  break;\n\t}\n\tthis.mode = IC_BADCODE;        // invalid code\n\tz.msg = \"invalid distance code\";\n\tr = Z_DATA_ERROR;\n\n\ts.bitb=b;s.bitk=k;\n\tz.avail_in=n;z.total_in+=p-z.next_in_index;z.next_in_index=p;\n\ts.write=q;\n\treturn s.inflate_flush(z,r);\n\n      case IC_DISTEXT:       // i: getting distance extra\n\tj = this.get;\n\n\twhile(k<(j)){\n\t  if(n!=0)r=Z_OK;\n\t  else{\n\n\t    s.bitb=b;s.bitk=k;\n\t    z.avail_in=n;z.total_in+=p-z.next_in_index;z.next_in_index=p;\n\t    s.write=q;\n\t    return s.inflate_flush(z,r);\n\t  }\n\t  n--; b|=(z.next_in[p++]&0xff)<<k;\n\t  k+=8;\n\t}\n\n\tthis.dist += (b & inflate_mask[j]);\n\n\tb>>=j;\n\tk-=j;\n\n\tthis.mode = IC_COPY;\n      case IC_COPY:          // o: copying bytes in window, waiting for space\n        f = q - this.dist;\n        while(f < 0){     // modulo window size-\"while\" instead\n          f += s.end;     // of \"if\" handles invalid distances\n\t}\n\twhile (this.len!=0){\n\n\t  if(m==0){\n\t    if(q==s.end&&s.read!=0){q=0;m=q<s.read?s.read-q-1:s.end-q;}\n\t    if(m==0){\n\t      s.write=q; r=s.inflate_flush(z,r);\n\t      q=s.write;m=q<s.read?s.read-q-1:s.end-q;\n\n\t      if(q==s.end&&s.read!=0){q=0;m=q<s.read?s.read-q-1:s.end-q;}\n\n\t      if(m==0){\n\t\ts.bitb=b;s.bitk=k;\n\t\tz.avail_in=n;z.total_in+=p-z.next_in_index;z.next_in_index=p;\n\t\ts.write=q;\n\t\treturn s.inflate_flush(z,r);\n\t      }  \n\t    }\n\t  }\n\n\t  s.window[q++]=s.window[f++]; m--;\n\n\t  if (f == s.end)\n            f = 0;\n\t  this.len--;\n\t}\n\tthis.mode = IC_START;\n\tbreak;\n      case IC_LIT:           // o: got literal, waiting for output space\n\tif(m==0){\n\t  if(q==s.end&&s.read!=0){q=0;m=q<s.read?s.read-q-1:s.end-q;}\n\t  if(m==0){\n\t    s.write=q; r=s.inflate_flush(z,r);\n\t    q=s.write;m=q<s.read?s.read-q-1:s.end-q;\n\n\t    if(q==s.end&&s.read!=0){q=0;m=q<s.read?s.read-q-1:s.end-q;}\n\t    if(m==0){\n\t      s.bitb=b;s.bitk=k;\n\t      z.avail_in=n;z.total_in+=p-z.next_in_index;z.next_in_index=p;\n\t      s.write=q;\n\t      return s.inflate_flush(z,r);\n\t    }\n\t  }\n\t}\n\tr=Z_OK;\n\n\ts.window[q++]=this.lit; m--;\n\n\tthis.mode = IC_START;\n\tbreak;\n      case IC_WASH:           // o: got eob, possibly more output\n\tif (k > 7){        // return unused byte, if any\n\t  k -= 8;\n\t  n++;\n\t  p--;             // can always return one\n\t}\n\n\ts.write=q; r=s.inflate_flush(z,r);\n\tq=s.write;m=q<s.read?s.read-q-1:s.end-q;\n\n\tif (s.read != s.write){\n\t  s.bitb=b;s.bitk=k;\n\t  z.avail_in=n;z.total_in+=p-z.next_in_index;z.next_in_index=p;\n\t  s.write=q;\n\t  return s.inflate_flush(z,r);\n\t}\n\tthis.mode = IC_END;\n      case IC_END:\n\tr = Z_STREAM_END;\n\ts.bitb=b;s.bitk=k;\n\tz.avail_in=n;z.total_in+=p-z.next_in_index;z.next_in_index=p;\n\ts.write=q;\n\treturn s.inflate_flush(z,r);\n\n      case IC_BADCODE:       // x: got error\n\n\tr = Z_DATA_ERROR;\n\n\ts.bitb=b;s.bitk=k;\n\tz.avail_in=n;z.total_in+=p-z.next_in_index;z.next_in_index=p;\n\ts.write=q;\n\treturn s.inflate_flush(z,r);\n\n      default:\n\tr = Z_STREAM_ERROR;\n\n\ts.bitb=b;s.bitk=k;\n\tz.avail_in=n;z.total_in+=p-z.next_in_index;z.next_in_index=p;\n\ts.write=q;\n\treturn s.inflate_flush(z,r);\n      }\n    }\n  }\n\nInfCodes.prototype.free = function(z){\n    //  ZFREE(z, c);\n}\n\n  // Called with number of bytes left to write in window at least 258\n  // (the maximum string length) and number of input bytes available\n  // at least ten.  The ten bytes are six bytes for the longest length/\n  // distance pair plus four bytes for overloading the bit buffer.\n\nInfCodes.prototype.inflate_fast = function(bl, bd, tl, tl_index, td, td_index, s, z) {\n    var t;                // temporary pointer\n    var   tp;             // temporary pointer (int[])\n    var tp_index;         // temporary pointer\n    var e;                // extra bits or operation\n    var b;                // bit buffer\n    var k;                // bits in bit buffer\n    var p;                // input data pointer\n    var n;                // bytes available there\n    var q;                // output window write pointer\n    var m;                // bytes to end of window or read pointer\n    var ml;               // mask for literal/length tree\n    var md;               // mask for distance tree\n    var c;                // bytes to copy\n    var d;                // distance back to copy from\n    var r;                // copy source pointer\n\n    var tp_index_t_3;     // (tp_index+t)*3\n\n    // load input, output, bit values\n    p=z.next_in_index;n=z.avail_in;b=s.bitb;k=s.bitk;\n    q=s.write;m=q<s.read?s.read-q-1:s.end-q;\n\n    // initialize masks\n    ml = inflate_mask[bl];\n    md = inflate_mask[bd];\n\n    // do until not enough input or output space for fast loop\n    do {                          // assume called with m >= 258 && n >= 10\n      // get literal/length code\n      while(k<(20)){              // max bits for literal/length code\n\tn--;\n\tb|=(z.next_in[p++]&0xff)<<k;k+=8;\n      }\n\n      t= b&ml;\n      tp=tl; \n      tp_index=tl_index;\n      tp_index_t_3=(tp_index+t)*3;\n      if ((e = tp[tp_index_t_3]) == 0){\n\tb>>=(tp[tp_index_t_3+1]); k-=(tp[tp_index_t_3+1]);\n\n\ts.window[q++] = tp[tp_index_t_3+2];\n\tm--;\n\tcontinue;\n      }\n      do {\n\n\tb>>=(tp[tp_index_t_3+1]); k-=(tp[tp_index_t_3+1]);\n\n\tif((e&16)!=0){\n\t  e &= 15;\n\t  c = tp[tp_index_t_3+2] + (b & inflate_mask[e]);\n\n\t  b>>=e; k-=e;\n\n\t  // decode distance base of block to copy\n\t  while(k<(15)){           // max bits for distance code\n\t    n--;\n\t    b|=(z.next_in[p++]&0xff)<<k;k+=8;\n\t  }\n\n\t  t= b&md;\n\t  tp=td;\n\t  tp_index=td_index;\n          tp_index_t_3=(tp_index+t)*3;\n\t  e = tp[tp_index_t_3];\n\n\t  do {\n\n\t    b>>=(tp[tp_index_t_3+1]); k-=(tp[tp_index_t_3+1]);\n\n\t    if((e&16)!=0){\n\t      // get extra bits to add to distance base\n\t      e &= 15;\n\t      while(k<(e)){         // get extra bits (up to 13)\n\t\tn--;\n\t\tb|=(z.next_in[p++]&0xff)<<k;k+=8;\n\t      }\n\n\t      d = tp[tp_index_t_3+2] + (b&inflate_mask[e]);\n\n\t      b>>=(e); k-=(e);\n\n\t      // do the copy\n\t      m -= c;\n\t      if (q >= d){                // offset before dest\n\t\t//  just copy\n\t\tr=q-d;\n\t\tif(q-r>0 && 2>(q-r)){           \n\t\t  s.window[q++]=s.window[r++]; // minimum count is three,\n\t\t  s.window[q++]=s.window[r++]; // so unroll loop a little\n\t\t  c-=2;\n\t\t}\n\t\telse{\n\t\t  s.window[q++]=s.window[r++]; // minimum count is three,\n\t\t  s.window[q++]=s.window[r++]; // so unroll loop a little\n\t\t  c-=2;\n\t\t}\n\t      }\n\t      else{                  // else offset after destination\n                r=q-d;\n                do{\n                  r+=s.end;          // force pointer in window\n                }while(r<0);         // covers invalid distances\n\t\te=s.end-r;\n\t\tif(c>e){             // if source crosses,\n\t\t  c-=e;              // wrapped copy\n\t\t  if(q-r>0 && e>(q-r)){           \n\t\t    do{s.window[q++] = s.window[r++];}\n\t\t    while(--e!=0);\n\t\t  }\n\t\t  else{\n\t\t    arrayCopy(s.window, r, s.window, q, e);\n\t\t    q+=e; r+=e; e=0;\n\t\t  }\n\t\t  r = 0;                  // copy rest from start of window\n\t\t}\n\n\t      }\n\n\t      // copy all or what's left\n              do{s.window[q++] = s.window[r++];}\n\t\twhile(--c!=0);\n\t      break;\n\t    }\n\t    else if((e&64)==0){\n\t      t+=tp[tp_index_t_3+2];\n\t      t+=(b&inflate_mask[e]);\n\t      tp_index_t_3=(tp_index+t)*3;\n\t      e=tp[tp_index_t_3];\n\t    }\n\t    else{\n\t      z.msg = \"invalid distance code\";\n\n\t      c=z.avail_in-n;c=(k>>3)<c?k>>3:c;n+=c;p-=c;k-=c<<3;\n\n\t      s.bitb=b;s.bitk=k;\n\t      z.avail_in=n;z.total_in+=p-z.next_in_index;z.next_in_index=p;\n\t      s.write=q;\n\n\t      return Z_DATA_ERROR;\n\t    }\n\t  }\n\t  while(true);\n\t  break;\n\t}\n\n\tif((e&64)==0){\n\t  t+=tp[tp_index_t_3+2];\n\t  t+=(b&inflate_mask[e]);\n\t  tp_index_t_3=(tp_index+t)*3;\n\t  if((e=tp[tp_index_t_3])==0){\n\n\t    b>>=(tp[tp_index_t_3+1]); k-=(tp[tp_index_t_3+1]);\n\n\t    s.window[q++]=tp[tp_index_t_3+2];\n\t    m--;\n\t    break;\n\t  }\n\t}\n\telse if((e&32)!=0){\n\n\t  c=z.avail_in-n;c=(k>>3)<c?k>>3:c;n+=c;p-=c;k-=c<<3;\n \n\t  s.bitb=b;s.bitk=k;\n\t  z.avail_in=n;z.total_in+=p-z.next_in_index;z.next_in_index=p;\n\t  s.write=q;\n\n\t  return Z_STREAM_END;\n\t}\n\telse{\n\t  z.msg=\"invalid literal/length code\";\n\n\t  c=z.avail_in-n;c=(k>>3)<c?k>>3:c;n+=c;p-=c;k-=c<<3;\n\n\t  s.bitb=b;s.bitk=k;\n\t  z.avail_in=n;z.total_in+=p-z.next_in_index;z.next_in_index=p;\n\t  s.write=q;\n\n\t  return Z_DATA_ERROR;\n\t}\n      } \n      while(true);\n    } \n    while(m>=258 && n>= 10);\n\n    // not enough input or output--restore pointers and return\n    c=z.avail_in-n;c=(k>>3)<c?k>>3:c;n+=c;p-=c;k-=c<<3;\n\n    s.bitb=b;s.bitk=k;\n    z.avail_in=n;z.total_in+=p-z.next_in_index;z.next_in_index=p;\n    s.write=q;\n\n    return Z_OK;\n}\n\n//\n// InfTree.java\n//\n\nfunction InfTree() {\n}\n\nInfTree.prototype.huft_build = function(b, bindex, n, s, d, e, t, m, hp, hn, v) {\n\n    // Given a list of code lengths and a maximum table size, make a set of\n    // tables to decode that set of codes.  Return Z_OK on success, Z_BUF_ERROR\n    // if the given code set is incomplete (the tables are still built in this\n    // case), Z_DATA_ERROR if the input is invalid (an over-subscribed set of\n    // lengths), or Z_MEM_ERROR if not enough memory.\n\n    var a;                       // counter for codes of length k\n    var f;                       // i repeats in table every f entries\n    var g;                       // maximum code length\n    var h;                       // table level\n    var i;                       // counter, current code\n    var j;                       // counter\n    var k;                       // number of bits in current code\n    var l;                       // bits per table (returned in m)\n    var mask;                    // (1 << w) - 1, to avoid cc -O bug on HP\n    var p;                       // pointer into c[], b[], or v[]\n    var q;                       // points to current table\n    var w;                       // bits before this table == (l * h)\n    var xp;                      // pointer into x\n    var y;                       // number of dummy codes added\n    var z;                       // number of entries in current table\n\n    // Generate counts for each bit length\n\n    p = 0; i = n;\n    do {\n      this.c[b[bindex+p]]++; p++; i--;   // assume all entries <= BMAX\n    }while(i!=0);\n\n    if(this.c[0] == n){                // null input--all zero length codes\n      t[0] = -1;\n      m[0] = 0;\n      return Z_OK;\n    }\n\n    // Find minimum and maximum length, bound *m by those\n    l = m[0];\n    for (j = 1; j <= BMAX; j++)\n      if(this.c[j]!=0) break;\n    k = j;                        // minimum code length\n    if(l < j){\n      l = j;\n    }\n    for (i = BMAX; i!=0; i--){\n      if(this.c[i]!=0) break;\n    }\n    g = i;                        // maximum code length\n    if(l > i){\n      l = i;\n    }\n    m[0] = l;\n\n    // Adjust last length count to fill out codes, if needed\n    for (y = 1 << j; j < i; j++, y <<= 1){\n      if ((y -= this.c[j]) < 0){\n        return Z_DATA_ERROR;\n      }\n    }\n    if ((y -= this.c[i]) < 0){\n      return Z_DATA_ERROR;\n    }\n    this.c[i] += y;\n\n    // Generate starting offsets into the value table for each length\n    this.x[1] = j = 0;\n    p = 1;  xp = 2;\n    while (--i!=0) {                 // note that i == g from above\n      this.x[xp] = (j += this.c[p]);\n      xp++;\n      p++;\n    }\n\n    // Make a table of values in order of bit lengths\n    i = 0; p = 0;\n    do {\n      if ((j = b[bindex+p]) != 0){\n        this.v[this.x[j]++] = i;\n      }\n      p++;\n    }\n    while (++i < n);\n    n = this.x[g];                     // set n to length of v\n\n    // Generate the Huffman codes and for each, make the table entries\n    this.x[0] = i = 0;                 // first Huffman code is zero\n    p = 0;                        // grab values in bit order\n    h = -1;                       // no tables yet--level -1\n    w = -l;                       // bits decoded == (l * h)\n    this.u[0] = 0;                     // just to keep compilers happy\n    q = 0;                        // ditto\n    z = 0;                        // ditto\n\n    // go through the bit lengths (k already is bits in shortest code)\n    for (; k <= g; k++){\n      a = this.c[k];\n      while (a--!=0){\n\t// here i is the Huffman code of length k bits for value *p\n\t// make tables up to required level\n        while (k > w + l){\n          h++;\n          w += l;                 // previous table always l bits\n\t  // compute minimum size table less than or equal to l bits\n          z = g - w;\n          z = (z > l) ? l : z;        // table size upper limit\n          if((f=1<<(j=k-w))>a+1){     // try a k-w bit table\n                                      // too few codes for k-w bit table\n            f -= a + 1;               // deduct codes from patterns left\n            xp = k;\n            if(j < z){\n              while (++j < z){        // try smaller tables up to z bits\n                if((f <<= 1) <= this.c[++xp])\n                  break;              // enough codes to use up j bits\n                f -= this.c[xp];           // else deduct codes from patterns\n              }\n\t    }\n          }\n          z = 1 << j;                 // table entries for j-bit table\n\n\t  // allocate new table\n          if (this.hn[0] + z > MANY){       // (note: doesn't matter for fixed)\n            return Z_DATA_ERROR;       // overflow of MANY\n          }\n          this.u[h] = q = /*hp+*/ this.hn[0];   // DEBUG\n          this.hn[0] += z;\n \n\t  // connect to last table, if there is one\n\t  if(h!=0){\n            this.x[h]=i;           // save pattern for backing up\n            this.r[0]=j;     // bits in this table\n            this.r[1]=l;     // bits to dump before this table\n            j=i>>>(w - l);\n            this.r[2] = (q - this.u[h-1] - j);               // offset to this table\n            arrayCopy(this.r, 0, hp, (this.u[h-1]+j)*3, 3); // connect to last table\n          }\n          else{\n            t[0] = q;               // first table is returned result\n\t  }\n        }\n\n\t// set up table entry in r\n        this.r[1] = (k - w);\n        if (p >= n){\n          this.r[0] = 128 + 64;      // out of values--invalid code\n\t}\n        else if (v[p] < s){\n          this.r[0] = (this.v[p] < 256 ? 0 : 32 + 64);  // 256 is end-of-block\n          this.r[2] = this.v[p++];          // simple code is just the value\n        }\n        else{\n          this.r[0]=(e[this.v[p]-s]+16+64); // non-simple--look up in lists\n          this.r[2]=d[this.v[p++] - s];\n        }\n\n        // fill code-like entries with r\n        f=1<<(k-w);\n        for (j=i>>>w;j<z;j+=f){\n          arrayCopy(this.r, 0, hp, (q+j)*3, 3);\n\t}\n\n\t// backwards increment the k-bit code i\n        for (j = 1 << (k - 1); (i & j)!=0; j >>>= 1){\n          i ^= j;\n\t}\n        i ^= j;\n\n\t// backup over finished tables\n        mask = (1 << w) - 1;      // needed on HP, cc -O bug\n        while ((i & mask) != this.x[h]){\n          h--;                    // don't need to update q\n          w -= l;\n          mask = (1 << w) - 1;\n        }\n      }\n    }\n    // Return Z_BUF_ERROR if we were given an incomplete table\n    return y != 0 && g != 1 ? Z_BUF_ERROR : Z_OK;\n}\n\nInfTree.prototype.inflate_trees_bits = function(c, bb, tb, hp, z) {\n    var result;\n    this.initWorkArea(19);\n    this.hn[0]=0;\n    result = this.huft_build(c, 0, 19, 19, null, null, tb, bb, hp, this.hn, this.v);\n\n    if(result == Z_DATA_ERROR){\n      z.msg = \"oversubscribed dynamic bit lengths tree\";\n    }\n    else if(result == Z_BUF_ERROR || bb[0] == 0){\n      z.msg = \"incomplete dynamic bit lengths tree\";\n      result = Z_DATA_ERROR;\n    }\n    return result;\n}\n\nInfTree.prototype.inflate_trees_dynamic = function(nl, nd, c, bl, bd, tl, td, hp, z) {\n    var result;\n\n    // build literal/length tree\n    this.initWorkArea(288);\n    this.hn[0]=0;\n    result = this.huft_build(c, 0, nl, 257, cplens, cplext, tl, bl, hp, this.hn, this.v);\n    if (result != Z_OK || bl[0] == 0){\n      if(result == Z_DATA_ERROR){\n        z.msg = \"oversubscribed literal/length tree\";\n      }\n      else if (result != Z_MEM_ERROR){\n        z.msg = \"incomplete literal/length tree\";\n        result = Z_DATA_ERROR;\n      }\n      return result;\n    }\n\n    // build distance tree\n    this.initWorkArea(288);\n    result = this.huft_build(c, nl, nd, 0, cpdist, cpdext, td, bd, hp, this.hn, this.v);\n\n    if (result != Z_OK || (bd[0] == 0 && nl > 257)){\n      if (result == Z_DATA_ERROR){\n        z.msg = \"oversubscribed distance tree\";\n      }\n      else if (result == Z_BUF_ERROR) {\n        z.msg = \"incomplete distance tree\";\n        result = Z_DATA_ERROR;\n      }\n      else if (result != Z_MEM_ERROR){\n        z.msg = \"empty distance tree with lengths\";\n        result = Z_DATA_ERROR;\n      }\n      return result;\n    }\n\n    return Z_OK;\n}\n/*\n  static int inflate_trees_fixed(int[] bl,  //literal desired/actual bit depth\n                                 int[] bd,  //distance desired/actual bit depth\n                                 int[][] tl,//literal/length tree result\n                                 int[][] td,//distance tree result \n                                 ZStream z  //for memory allocation\n\t\t\t\t ){\n\n*/\n\nfunction inflate_trees_fixed(bl, bd, tl, td, z) {\n    bl[0]=fixed_bl;\n    bd[0]=fixed_bd;\n    tl[0]=fixed_tl;\n    td[0]=fixed_td;\n    return Z_OK;\n}\n\nInfTree.prototype.initWorkArea = function(vsize){\n    if(this.hn==null){\n        this.hn=new Int32Array(1);\n        this.v=new Int32Array(vsize);\n        this.c=new Int32Array(BMAX+1);\n        this.r=new Int32Array(3);\n        this.u=new Int32Array(BMAX);\n        this.x=new Int32Array(BMAX+1);\n    }\n    if(this.v.length<vsize){ \n        this.v=new Int32Array(vsize); \n    }\n    for(var i=0; i<vsize; i++){this.v[i]=0;}\n    for(var i=0; i<BMAX+1; i++){this.c[i]=0;}\n    for(var i=0; i<3; i++){this.r[i]=0;}\n//  for(int i=0; i<BMAX; i++){u[i]=0;}\n    arrayCopy(this.c, 0, this.u, 0, BMAX);\n//  for(int i=0; i<BMAX+1; i++){x[i]=0;}\n    arrayCopy(this.c, 0, this.x, 0, BMAX+1);\n}\n\nvar testArray = new Uint8Array(1);\nvar hasSubarray = (typeof testArray.subarray === 'function');\nvar hasSlice = false; /* (typeof testArray.slice === 'function'); */ // Chrome slice performance is so dire that we're currently not using it...\n\nfunction arrayCopy(src, srcOffset, dest, destOffset, count) {\n    if (count == 0) {\n        return;\n    } \n    if (!src) {\n        throw \"Undef src\";\n    } else if (!dest) {\n        throw \"Undef dest\";\n    }\n\n    if (srcOffset == 0 && count == src.length) {\n        arrayCopy_fast(src, dest, destOffset);\n    } else if (hasSubarray) {\n        arrayCopy_fast(src.subarray(srcOffset, srcOffset + count), dest, destOffset); \n    } else if (src.BYTES_PER_ELEMENT == 1 && count > 100) {\n        arrayCopy_fast(new Uint8Array(src.buffer, src.byteOffset + srcOffset, count), dest, destOffset);\n    } else { \n        arrayCopy_slow(src, srcOffset, dest, destOffset, count);\n    }\n\n}\n\nfunction arrayCopy_slow(src, srcOffset, dest, destOffset, count) {\n\n    // dlog('_slow call: srcOffset=' + srcOffset + '; destOffset=' + destOffset + '; count=' + count);\n\n     for (var i = 0; i < count; ++i) {\n        dest[destOffset + i] = src[srcOffset + i];\n    }\n}\n\nfunction arrayCopy_fast(src, dest, destOffset) {\n    dest.set(src, destOffset);\n}\n\n\n  // largest prime smaller than 65536\nvar ADLER_BASE=65521; \n  // NMAX is the largest n such that 255n(n+1)/2 + (n+1)(BASE-1) <= 2^32-1\nvar ADLER_NMAX=5552;\n\nfunction adler32(adler, /* byte[] */ buf,  index, len){\n    if(buf == null){ return 1; }\n\n    var s1=adler&0xffff;\n    var s2=(adler>>16)&0xffff;\n    var k;\n\n    while(len > 0) {\n      k=len<ADLER_NMAX?len:ADLER_NMAX;\n      len-=k;\n      while(k>=16){\n        s1+=buf[index++]&0xff; s2+=s1;\n        s1+=buf[index++]&0xff; s2+=s1;\n        s1+=buf[index++]&0xff; s2+=s1;\n        s1+=buf[index++]&0xff; s2+=s1;\n        s1+=buf[index++]&0xff; s2+=s1;\n        s1+=buf[index++]&0xff; s2+=s1;\n        s1+=buf[index++]&0xff; s2+=s1;\n        s1+=buf[index++]&0xff; s2+=s1;\n        s1+=buf[index++]&0xff; s2+=s1;\n        s1+=buf[index++]&0xff; s2+=s1;\n        s1+=buf[index++]&0xff; s2+=s1;\n        s1+=buf[index++]&0xff; s2+=s1;\n        s1+=buf[index++]&0xff; s2+=s1;\n        s1+=buf[index++]&0xff; s2+=s1;\n        s1+=buf[index++]&0xff; s2+=s1;\n        s1+=buf[index++]&0xff; s2+=s1;\n        k-=16;\n      }\n      if(k!=0){\n        do{\n          s1+=buf[index++]&0xff; s2+=s1;\n        }\n        while(--k!=0);\n      }\n      s1%=ADLER_BASE;\n      s2%=ADLER_BASE;\n    }\n    return (s2<<16)|s1;\n}\n\n\n\nfunction jszlib_inflate_buffer(buffer, start, length, afterUncOffset) {\n    if (!start) {\n        buffer = new Uint8Array(buffer);\n    } else if (!length) {\n        buffer = new Uint8Array(buffer, start, buffer.byteLength - start);\n    } else {\n        buffer = new Uint8Array(buffer, start, length);\n    }\n\n    var z = new ZStream();\n    z.inflateInit(DEF_WBITS, true);\n    z.next_in = buffer;\n    z.next_in_index = 0;\n    z.avail_in = buffer.length;\n\n    var oBlockList = [];\n    var totalSize = 0;\n    while (true) {\n        var obuf = new Uint8Array(32000);\n        z.next_out = obuf;\n        z.next_out_index = 0;\n        z.avail_out = obuf.length;\n        var status = z.inflate(Z_NO_FLUSH);\n        if (status != Z_OK && status != Z_STREAM_END && status != Z_BUF_ERROR) {\n            throw z.msg;\n        }\n        if (z.avail_out != 0) {\n            var newob = new Uint8Array(obuf.length - z.avail_out);\n            arrayCopy(obuf, 0, newob, 0, (obuf.length - z.avail_out));\n            obuf = newob;\n        }\n        oBlockList.push(obuf);\n        totalSize += obuf.length;\n        if (status == Z_STREAM_END || status == Z_BUF_ERROR) {\n            break;\n        }\n    }\n\n    if (afterUncOffset) {\n        afterUncOffset[0] = (start || 0) + z.next_in_index;\n    }\n\n    if (oBlockList.length == 1) {\n        return oBlockList[0].buffer;\n    } else {\n        var out = new Uint8Array(totalSize);\n        var cursor = 0;\n        for (var i = 0; i < oBlockList.length; ++i) {\n            var b = oBlockList[i];\n            arrayCopy(b, 0, out, cursor, b.length);\n            cursor += b.length;\n        }\n        return out.buffer;\n    }\n}\n\nif (typeof(module) !== 'undefined') {\n  module.exports = {\n    inflateBuffer: jszlib_inflate_buffer,\n    arrayCopy: arrayCopy\n  };\n}\n","// shim for using process in browser\nvar process = module.exports = {};\n\n// cached from whatever global is present so that test runners that stub it\n// don't break things.  But we need to wrap it in a try catch in case it is\n// wrapped in strict mode code which doesn't define any globals.  It's inside a\n// function because try/catches deoptimize in certain engines.\n\nvar cachedSetTimeout;\nvar cachedClearTimeout;\n\nfunction defaultSetTimout() {\n    throw new Error('setTimeout has not been defined');\n}\nfunction defaultClearTimeout () {\n    throw new Error('clearTimeout has not been defined');\n}\n(function () {\n    try {\n        if (typeof setTimeout === 'function') {\n            cachedSetTimeout = setTimeout;\n        } else {\n            cachedSetTimeout = defaultSetTimout;\n        }\n    } catch (e) {\n        cachedSetTimeout = defaultSetTimout;\n    }\n    try {\n        if (typeof clearTimeout === 'function') {\n            cachedClearTimeout = clearTimeout;\n        } else {\n            cachedClearTimeout = defaultClearTimeout;\n        }\n    } catch (e) {\n        cachedClearTimeout = defaultClearTimeout;\n    }\n} ())\nfunction runTimeout(fun) {\n    if (cachedSetTimeout === setTimeout) {\n        //normal enviroments in sane situations\n        return setTimeout(fun, 0);\n    }\n    // if setTimeout wasn't available but was latter defined\n    if ((cachedSetTimeout === defaultSetTimout || !cachedSetTimeout) && setTimeout) {\n        cachedSetTimeout = setTimeout;\n        return setTimeout(fun, 0);\n    }\n    try {\n        // when when somebody has screwed with setTimeout but no I.E. maddness\n        return cachedSetTimeout(fun, 0);\n    } catch(e){\n        try {\n            // When we are in I.E. but the script has been evaled so I.E. doesn't trust the global object when called normally\n            return cachedSetTimeout.call(null, fun, 0);\n        } catch(e){\n            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error\n            return cachedSetTimeout.call(this, fun, 0);\n        }\n    }\n\n\n}\nfunction runClearTimeout(marker) {\n    if (cachedClearTimeout === clearTimeout) {\n        //normal enviroments in sane situations\n        return clearTimeout(marker);\n    }\n    // if clearTimeout wasn't available but was latter defined\n    if ((cachedClearTimeout === defaultClearTimeout || !cachedClearTimeout) && clearTimeout) {\n        cachedClearTimeout = clearTimeout;\n        return clearTimeout(marker);\n    }\n    try {\n        // when when somebody has screwed with setTimeout but no I.E. maddness\n        return cachedClearTimeout(marker);\n    } catch (e){\n        try {\n            // When we are in I.E. but the script has been evaled so I.E. doesn't  trust the global object when called normally\n            return cachedClearTimeout.call(null, marker);\n        } catch (e){\n            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error.\n            // Some versions of I.E. have different rules for clearTimeout vs setTimeout\n            return cachedClearTimeout.call(this, marker);\n        }\n    }\n\n\n\n}\nvar queue = [];\nvar draining = false;\nvar currentQueue;\nvar queueIndex = -1;\n\nfunction cleanUpNextTick() {\n    if (!draining || !currentQueue) {\n        return;\n    }\n    draining = false;\n    if (currentQueue.length) {\n        queue = currentQueue.concat(queue);\n    } else {\n        queueIndex = -1;\n    }\n    if (queue.length) {\n        drainQueue();\n    }\n}\n\nfunction drainQueue() {\n    if (draining) {\n        return;\n    }\n    var timeout = runTimeout(cleanUpNextTick);\n    draining = true;\n\n    var len = queue.length;\n    while(len) {\n        currentQueue = queue;\n        queue = [];\n        while (++queueIndex < len) {\n            if (currentQueue) {\n                currentQueue[queueIndex].run();\n            }\n        }\n        queueIndex = -1;\n        len = queue.length;\n    }\n    currentQueue = null;\n    draining = false;\n    runClearTimeout(timeout);\n}\n\nprocess.nextTick = function (fun) {\n    var args = new Array(arguments.length - 1);\n    if (arguments.length > 1) {\n        for (var i = 1; i < arguments.length; i++) {\n            args[i - 1] = arguments[i];\n        }\n    }\n    queue.push(new Item(fun, args));\n    if (queue.length === 1 && !draining) {\n        runTimeout(drainQueue);\n    }\n};\n\n// v8 likes predictible objects\nfunction Item(fun, array) {\n    this.fun = fun;\n    this.array = array;\n}\nItem.prototype.run = function () {\n    this.fun.apply(null, this.array);\n};\nprocess.title = 'browser';\nprocess.browser = true;\nprocess.env = {};\nprocess.argv = [];\nprocess.version = ''; // empty string to avoid regexp issues\nprocess.versions = {};\n\nfunction noop() {}\n\nprocess.on = noop;\nprocess.addListener = noop;\nprocess.once = noop;\nprocess.off = noop;\nprocess.removeListener = noop;\nprocess.removeAllListeners = noop;\nprocess.emit = noop;\n\nprocess.binding = function (name) {\n    throw new Error('process.binding is not supported');\n};\n\nprocess.cwd = function () { return '/' };\nprocess.chdir = function (dir) {\n    throw new Error('process.chdir is not supported');\n};\nprocess.umask = function() { return 0; };\n","//  Ramda v0.21.0\n//  https://github.com/ramda/ramda\n//  (c) 2013-2016 Scott Sauyet, Michael Hurley, and David Chambers\n//  Ramda may be freely distributed under the MIT license.\n\n;(function() {\n\n  'use strict';\n\n  /**\n     * A special placeholder value used to specify \"gaps\" within curried functions,\n     * allowing partial application of any combination of arguments, regardless of\n     * their positions.\n     *\n     * If `g` is a curried ternary function and `_` is `R.__`, the following are\n     * equivalent:\n     *\n     *   - `g(1, 2, 3)`\n     *   - `g(_, 2, 3)(1)`\n     *   - `g(_, _, 3)(1)(2)`\n     *   - `g(_, _, 3)(1, 2)`\n     *   - `g(_, 2, _)(1, 3)`\n     *   - `g(_, 2)(1)(3)`\n     *   - `g(_, 2)(1, 3)`\n     *   - `g(_, 2)(_, 3)(1)`\n     *\n     * @constant\n     * @memberOf R\n     * @since v0.6.0\n     * @category Function\n     * @example\n     *\n     *      var greet = R.replace('{name}', R.__, 'Hello, {name}!');\n     *      greet('Alice'); //=> 'Hello, Alice!'\n     */\n    var __ = { '@@functional/placeholder': true };\n\n    /* eslint-disable no-unused-vars */\n    var _arity = function _arity(n, fn) {\n        /* eslint-disable no-unused-vars */\n        switch (n) {\n        case 0:\n            return function () {\n                return fn.apply(this, arguments);\n            };\n        case 1:\n            return function (a0) {\n                return fn.apply(this, arguments);\n            };\n        case 2:\n            return function (a0, a1) {\n                return fn.apply(this, arguments);\n            };\n        case 3:\n            return function (a0, a1, a2) {\n                return fn.apply(this, arguments);\n            };\n        case 4:\n            return function (a0, a1, a2, a3) {\n                return fn.apply(this, arguments);\n            };\n        case 5:\n            return function (a0, a1, a2, a3, a4) {\n                return fn.apply(this, arguments);\n            };\n        case 6:\n            return function (a0, a1, a2, a3, a4, a5) {\n                return fn.apply(this, arguments);\n            };\n        case 7:\n            return function (a0, a1, a2, a3, a4, a5, a6) {\n                return fn.apply(this, arguments);\n            };\n        case 8:\n            return function (a0, a1, a2, a3, a4, a5, a6, a7) {\n                return fn.apply(this, arguments);\n            };\n        case 9:\n            return function (a0, a1, a2, a3, a4, a5, a6, a7, a8) {\n                return fn.apply(this, arguments);\n            };\n        case 10:\n            return function (a0, a1, a2, a3, a4, a5, a6, a7, a8, a9) {\n                return fn.apply(this, arguments);\n            };\n        default:\n            throw new Error('First argument to _arity must be a non-negative integer no greater than ten');\n        }\n    };\n\n    var _arrayFromIterator = function _arrayFromIterator(iter) {\n        var list = [];\n        var next;\n        while (!(next = iter.next()).done) {\n            list.push(next.value);\n        }\n        return list;\n    };\n\n    var _arrayOf = function _arrayOf() {\n        return Array.prototype.slice.call(arguments);\n    };\n\n    var _cloneRegExp = function _cloneRegExp(pattern) {\n        return new RegExp(pattern.source, (pattern.global ? 'g' : '') + (pattern.ignoreCase ? 'i' : '') + (pattern.multiline ? 'm' : '') + (pattern.sticky ? 'y' : '') + (pattern.unicode ? 'u' : ''));\n    };\n\n    var _complement = function _complement(f) {\n        return function () {\n            return !f.apply(this, arguments);\n        };\n    };\n\n    /**\n     * Private `concat` function to merge two array-like objects.\n     *\n     * @private\n     * @param {Array|Arguments} [set1=[]] An array-like object.\n     * @param {Array|Arguments} [set2=[]] An array-like object.\n     * @return {Array} A new, merged array.\n     * @example\n     *\n     *      _concat([4, 5, 6], [1, 2, 3]); //=> [4, 5, 6, 1, 2, 3]\n     */\n    var _concat = function _concat(set1, set2) {\n        set1 = set1 || [];\n        set2 = set2 || [];\n        var idx;\n        var len1 = set1.length;\n        var len2 = set2.length;\n        var result = [];\n        idx = 0;\n        while (idx < len1) {\n            result[result.length] = set1[idx];\n            idx += 1;\n        }\n        idx = 0;\n        while (idx < len2) {\n            result[result.length] = set2[idx];\n            idx += 1;\n        }\n        return result;\n    };\n\n    var _containsWith = function _containsWith(pred, x, list) {\n        var idx = 0;\n        var len = list.length;\n        while (idx < len) {\n            if (pred(x, list[idx])) {\n                return true;\n            }\n            idx += 1;\n        }\n        return false;\n    };\n\n    var _filter = function _filter(fn, list) {\n        var idx = 0;\n        var len = list.length;\n        var result = [];\n        while (idx < len) {\n            if (fn(list[idx])) {\n                result[result.length] = list[idx];\n            }\n            idx += 1;\n        }\n        return result;\n    };\n\n    var _forceReduced = function _forceReduced(x) {\n        return {\n            '@@transducer/value': x,\n            '@@transducer/reduced': true\n        };\n    };\n\n    // String(x => x) evaluates to \"x => x\", so the pattern may not match.\n    var _functionName = function _functionName(f) {\n        // String(x => x) evaluates to \"x => x\", so the pattern may not match.\n        var match = String(f).match(/^function (\\w*)/);\n        return match == null ? '' : match[1];\n    };\n\n    var _has = function _has(prop, obj) {\n        return Object.prototype.hasOwnProperty.call(obj, prop);\n    };\n\n    var _identity = function _identity(x) {\n        return x;\n    };\n\n    var _isArguments = function () {\n        var toString = Object.prototype.toString;\n        return toString.call(arguments) === '[object Arguments]' ? function _isArguments(x) {\n            return toString.call(x) === '[object Arguments]';\n        } : function _isArguments(x) {\n            return _has('callee', x);\n        };\n    }();\n\n    /**\n     * Tests whether or not an object is an array.\n     *\n     * @private\n     * @param {*} val The object to test.\n     * @return {Boolean} `true` if `val` is an array, `false` otherwise.\n     * @example\n     *\n     *      _isArray([]); //=> true\n     *      _isArray(null); //=> false\n     *      _isArray({}); //=> false\n     */\n    var _isArray = Array.isArray || function _isArray(val) {\n        return val != null && val.length >= 0 && Object.prototype.toString.call(val) === '[object Array]';\n    };\n\n    var _isFunction = function _isNumber(x) {\n        return Object.prototype.toString.call(x) === '[object Function]';\n    };\n\n    /**\n     * Determine if the passed argument is an integer.\n     *\n     * @private\n     * @param {*} n\n     * @category Type\n     * @return {Boolean}\n     */\n    var _isInteger = Number.isInteger || function _isInteger(n) {\n        return n << 0 === n;\n    };\n\n    var _isNumber = function _isNumber(x) {\n        return Object.prototype.toString.call(x) === '[object Number]';\n    };\n\n    var _isObject = function _isObject(x) {\n        return Object.prototype.toString.call(x) === '[object Object]';\n    };\n\n    var _isPlaceholder = function _isPlaceholder(a) {\n        return a != null && typeof a === 'object' && a['@@functional/placeholder'] === true;\n    };\n\n    var _isRegExp = function _isRegExp(x) {\n        return Object.prototype.toString.call(x) === '[object RegExp]';\n    };\n\n    var _isString = function _isString(x) {\n        return Object.prototype.toString.call(x) === '[object String]';\n    };\n\n    var _isTransformer = function _isTransformer(obj) {\n        return typeof obj['@@transducer/step'] === 'function';\n    };\n\n    var _map = function _map(fn, functor) {\n        var idx = 0;\n        var len = functor.length;\n        var result = Array(len);\n        while (idx < len) {\n            result[idx] = fn(functor[idx]);\n            idx += 1;\n        }\n        return result;\n    };\n\n    // Based on https://developer.mozilla.org/en/docs/Web/JavaScript/Reference/Global_Objects/Object/assign\n    var _objectAssign = function _objectAssign(target) {\n        if (target == null) {\n            throw new TypeError('Cannot convert undefined or null to object');\n        }\n        var output = Object(target);\n        var idx = 1;\n        var length = arguments.length;\n        while (idx < length) {\n            var source = arguments[idx];\n            if (source != null) {\n                for (var nextKey in source) {\n                    if (_has(nextKey, source)) {\n                        output[nextKey] = source[nextKey];\n                    }\n                }\n            }\n            idx += 1;\n        }\n        return output;\n    };\n\n    var _of = function _of(x) {\n        return [x];\n    };\n\n    var _pipe = function _pipe(f, g) {\n        return function () {\n            return g.call(this, f.apply(this, arguments));\n        };\n    };\n\n    var _pipeP = function _pipeP(f, g) {\n        return function () {\n            var ctx = this;\n            return f.apply(ctx, arguments).then(function (x) {\n                return g.call(ctx, x);\n            });\n        };\n    };\n\n    // \\b matches word boundary; [\\b] matches backspace\n    var _quote = function _quote(s) {\n        var escaped = s.replace(/\\\\/g, '\\\\\\\\').replace(/[\\b]/g, '\\\\b')    // \\b matches word boundary; [\\b] matches backspace\n    .replace(/\\f/g, '\\\\f').replace(/\\n/g, '\\\\n').replace(/\\r/g, '\\\\r').replace(/\\t/g, '\\\\t').replace(/\\v/g, '\\\\v').replace(/\\0/g, '\\\\0');\n        return '\"' + escaped.replace(/\"/g, '\\\\\"') + '\"';\n    };\n\n    var _reduced = function _reduced(x) {\n        return x && x['@@transducer/reduced'] ? x : {\n            '@@transducer/value': x,\n            '@@transducer/reduced': true\n        };\n    };\n\n    /**\n     * An optimized, private array `slice` implementation.\n     *\n     * @private\n     * @param {Arguments|Array} args The array or arguments object to consider.\n     * @param {Number} [from=0] The array index to slice from, inclusive.\n     * @param {Number} [to=args.length] The array index to slice to, exclusive.\n     * @return {Array} A new, sliced array.\n     * @example\n     *\n     *      _slice([1, 2, 3, 4, 5], 1, 3); //=> [2, 3]\n     *\n     *      var firstThreeArgs = function(a, b, c, d) {\n     *        return _slice(arguments, 0, 3);\n     *      };\n     *      firstThreeArgs(1, 2, 3, 4); //=> [1, 2, 3]\n     */\n    var _slice = function _slice(args, from, to) {\n        switch (arguments.length) {\n        case 1:\n            return _slice(args, 0, args.length);\n        case 2:\n            return _slice(args, from, args.length);\n        default:\n            var list = [];\n            var idx = 0;\n            var len = Math.max(0, Math.min(args.length, to) - from);\n            while (idx < len) {\n                list[idx] = args[from + idx];\n                idx += 1;\n            }\n            return list;\n        }\n    };\n\n    /**\n     * Polyfill from <https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Date/toISOString>.\n     */\n    var _toISOString = function () {\n        var pad = function pad(n) {\n            return (n < 10 ? '0' : '') + n;\n        };\n        return typeof Date.prototype.toISOString === 'function' ? function _toISOString(d) {\n            return d.toISOString();\n        } : function _toISOString(d) {\n            return d.getUTCFullYear() + '-' + pad(d.getUTCMonth() + 1) + '-' + pad(d.getUTCDate()) + 'T' + pad(d.getUTCHours()) + ':' + pad(d.getUTCMinutes()) + ':' + pad(d.getUTCSeconds()) + '.' + (d.getUTCMilliseconds() / 1000).toFixed(3).slice(2, 5) + 'Z';\n        };\n    }();\n\n    var _xfBase = {\n        init: function () {\n            return this.xf['@@transducer/init']();\n        },\n        result: function (result) {\n            return this.xf['@@transducer/result'](result);\n        }\n    };\n\n    var _xwrap = function () {\n        function XWrap(fn) {\n            this.f = fn;\n        }\n        XWrap.prototype['@@transducer/init'] = function () {\n            throw new Error('init not implemented on XWrap');\n        };\n        XWrap.prototype['@@transducer/result'] = function (acc) {\n            return acc;\n        };\n        XWrap.prototype['@@transducer/step'] = function (acc, x) {\n            return this.f(acc, x);\n        };\n        return function _xwrap(fn) {\n            return new XWrap(fn);\n        };\n    }();\n\n    var _aperture = function _aperture(n, list) {\n        var idx = 0;\n        var limit = list.length - (n - 1);\n        var acc = new Array(limit >= 0 ? limit : 0);\n        while (idx < limit) {\n            acc[idx] = _slice(list, idx, idx + n);\n            idx += 1;\n        }\n        return acc;\n    };\n\n    var _assign = typeof Object.assign === 'function' ? Object.assign : _objectAssign;\n\n    /**\n     * Similar to hasMethod, this checks whether a function has a [methodname]\n     * function. If it isn't an array it will execute that function otherwise it\n     * will default to the ramda implementation.\n     *\n     * @private\n     * @param {Function} fn ramda implemtation\n     * @param {String} methodname property to check for a custom implementation\n     * @return {Object} Whatever the return value of the method is.\n     */\n    var _checkForMethod = function _checkForMethod(methodname, fn) {\n        return function () {\n            var length = arguments.length;\n            if (length === 0) {\n                return fn();\n            }\n            var obj = arguments[length - 1];\n            return _isArray(obj) || typeof obj[methodname] !== 'function' ? fn.apply(this, arguments) : obj[methodname].apply(obj, _slice(arguments, 0, length - 1));\n        };\n    };\n\n    /**\n     * Optimized internal one-arity curry function.\n     *\n     * @private\n     * @category Function\n     * @param {Function} fn The function to curry.\n     * @return {Function} The curried function.\n     */\n    var _curry1 = function _curry1(fn) {\n        return function f1(a) {\n            if (arguments.length === 0 || _isPlaceholder(a)) {\n                return f1;\n            } else {\n                return fn.apply(this, arguments);\n            }\n        };\n    };\n\n    /**\n     * Optimized internal two-arity curry function.\n     *\n     * @private\n     * @category Function\n     * @param {Function} fn The function to curry.\n     * @return {Function} The curried function.\n     */\n    var _curry2 = function _curry2(fn) {\n        return function f2(a, b) {\n            switch (arguments.length) {\n            case 0:\n                return f2;\n            case 1:\n                return _isPlaceholder(a) ? f2 : _curry1(function (_b) {\n                    return fn(a, _b);\n                });\n            default:\n                return _isPlaceholder(a) && _isPlaceholder(b) ? f2 : _isPlaceholder(a) ? _curry1(function (_a) {\n                    return fn(_a, b);\n                }) : _isPlaceholder(b) ? _curry1(function (_b) {\n                    return fn(a, _b);\n                }) : fn(a, b);\n            }\n        };\n    };\n\n    /**\n     * Optimized internal three-arity curry function.\n     *\n     * @private\n     * @category Function\n     * @param {Function} fn The function to curry.\n     * @return {Function} The curried function.\n     */\n    var _curry3 = function _curry3(fn) {\n        return function f3(a, b, c) {\n            switch (arguments.length) {\n            case 0:\n                return f3;\n            case 1:\n                return _isPlaceholder(a) ? f3 : _curry2(function (_b, _c) {\n                    return fn(a, _b, _c);\n                });\n            case 2:\n                return _isPlaceholder(a) && _isPlaceholder(b) ? f3 : _isPlaceholder(a) ? _curry2(function (_a, _c) {\n                    return fn(_a, b, _c);\n                }) : _isPlaceholder(b) ? _curry2(function (_b, _c) {\n                    return fn(a, _b, _c);\n                }) : _curry1(function (_c) {\n                    return fn(a, b, _c);\n                });\n            default:\n                return _isPlaceholder(a) && _isPlaceholder(b) && _isPlaceholder(c) ? f3 : _isPlaceholder(a) && _isPlaceholder(b) ? _curry2(function (_a, _b) {\n                    return fn(_a, _b, c);\n                }) : _isPlaceholder(a) && _isPlaceholder(c) ? _curry2(function (_a, _c) {\n                    return fn(_a, b, _c);\n                }) : _isPlaceholder(b) && _isPlaceholder(c) ? _curry2(function (_b, _c) {\n                    return fn(a, _b, _c);\n                }) : _isPlaceholder(a) ? _curry1(function (_a) {\n                    return fn(_a, b, c);\n                }) : _isPlaceholder(b) ? _curry1(function (_b) {\n                    return fn(a, _b, c);\n                }) : _isPlaceholder(c) ? _curry1(function (_c) {\n                    return fn(a, b, _c);\n                }) : fn(a, b, c);\n            }\n        };\n    };\n\n    /**\n     * Internal curryN function.\n     *\n     * @private\n     * @category Function\n     * @param {Number} length The arity of the curried function.\n     * @param {Array} received An array of arguments received thus far.\n     * @param {Function} fn The function to curry.\n     * @return {Function} The curried function.\n     */\n    var _curryN = function _curryN(length, received, fn) {\n        return function () {\n            var combined = [];\n            var argsIdx = 0;\n            var left = length;\n            var combinedIdx = 0;\n            while (combinedIdx < received.length || argsIdx < arguments.length) {\n                var result;\n                if (combinedIdx < received.length && (!_isPlaceholder(received[combinedIdx]) || argsIdx >= arguments.length)) {\n                    result = received[combinedIdx];\n                } else {\n                    result = arguments[argsIdx];\n                    argsIdx += 1;\n                }\n                combined[combinedIdx] = result;\n                if (!_isPlaceholder(result)) {\n                    left -= 1;\n                }\n                combinedIdx += 1;\n            }\n            return left <= 0 ? fn.apply(this, combined) : _arity(left, _curryN(length, combined, fn));\n        };\n    };\n\n    /**\n     * Returns a function that dispatches with different strategies based on the\n     * object in list position (last argument). If it is an array, executes [fn].\n     * Otherwise, if it has a function with [methodname], it will execute that\n     * function (functor case). Otherwise, if it is a transformer, uses transducer\n     * [xf] to return a new transformer (transducer case). Otherwise, it will\n     * default to executing [fn].\n     *\n     * @private\n     * @param {String} methodname property to check for a custom implementation\n     * @param {Function} xf transducer to initialize if object is transformer\n     * @param {Function} fn default ramda implementation\n     * @return {Function} A function that dispatches on object in list position\n     */\n    var _dispatchable = function _dispatchable(methodname, xf, fn) {\n        return function () {\n            var length = arguments.length;\n            if (length === 0) {\n                return fn();\n            }\n            var obj = arguments[length - 1];\n            if (!_isArray(obj)) {\n                var args = _slice(arguments, 0, length - 1);\n                if (typeof obj[methodname] === 'function') {\n                    return obj[methodname].apply(obj, args);\n                }\n                if (_isTransformer(obj)) {\n                    var transducer = xf.apply(null, args);\n                    return transducer(obj);\n                }\n            }\n            return fn.apply(this, arguments);\n        };\n    };\n\n    var _dropLastWhile = function dropLastWhile(pred, list) {\n        var idx = list.length - 1;\n        while (idx >= 0 && pred(list[idx])) {\n            idx -= 1;\n        }\n        return _slice(list, 0, idx + 1);\n    };\n\n    var _xall = function () {\n        function XAll(f, xf) {\n            this.xf = xf;\n            this.f = f;\n            this.all = true;\n        }\n        XAll.prototype['@@transducer/init'] = _xfBase.init;\n        XAll.prototype['@@transducer/result'] = function (result) {\n            if (this.all) {\n                result = this.xf['@@transducer/step'](result, true);\n            }\n            return this.xf['@@transducer/result'](result);\n        };\n        XAll.prototype['@@transducer/step'] = function (result, input) {\n            if (!this.f(input)) {\n                this.all = false;\n                result = _reduced(this.xf['@@transducer/step'](result, false));\n            }\n            return result;\n        };\n        return _curry2(function _xall(f, xf) {\n            return new XAll(f, xf);\n        });\n    }();\n\n    var _xany = function () {\n        function XAny(f, xf) {\n            this.xf = xf;\n            this.f = f;\n            this.any = false;\n        }\n        XAny.prototype['@@transducer/init'] = _xfBase.init;\n        XAny.prototype['@@transducer/result'] = function (result) {\n            if (!this.any) {\n                result = this.xf['@@transducer/step'](result, false);\n            }\n            return this.xf['@@transducer/result'](result);\n        };\n        XAny.prototype['@@transducer/step'] = function (result, input) {\n            if (this.f(input)) {\n                this.any = true;\n                result = _reduced(this.xf['@@transducer/step'](result, true));\n            }\n            return result;\n        };\n        return _curry2(function _xany(f, xf) {\n            return new XAny(f, xf);\n        });\n    }();\n\n    var _xaperture = function () {\n        function XAperture(n, xf) {\n            this.xf = xf;\n            this.pos = 0;\n            this.full = false;\n            this.acc = new Array(n);\n        }\n        XAperture.prototype['@@transducer/init'] = _xfBase.init;\n        XAperture.prototype['@@transducer/result'] = function (result) {\n            this.acc = null;\n            return this.xf['@@transducer/result'](result);\n        };\n        XAperture.prototype['@@transducer/step'] = function (result, input) {\n            this.store(input);\n            return this.full ? this.xf['@@transducer/step'](result, this.getCopy()) : result;\n        };\n        XAperture.prototype.store = function (input) {\n            this.acc[this.pos] = input;\n            this.pos += 1;\n            if (this.pos === this.acc.length) {\n                this.pos = 0;\n                this.full = true;\n            }\n        };\n        XAperture.prototype.getCopy = function () {\n            return _concat(_slice(this.acc, this.pos), _slice(this.acc, 0, this.pos));\n        };\n        return _curry2(function _xaperture(n, xf) {\n            return new XAperture(n, xf);\n        });\n    }();\n\n    var _xdrop = function () {\n        function XDrop(n, xf) {\n            this.xf = xf;\n            this.n = n;\n        }\n        XDrop.prototype['@@transducer/init'] = _xfBase.init;\n        XDrop.prototype['@@transducer/result'] = _xfBase.result;\n        XDrop.prototype['@@transducer/step'] = function (result, input) {\n            if (this.n > 0) {\n                this.n -= 1;\n                return result;\n            }\n            return this.xf['@@transducer/step'](result, input);\n        };\n        return _curry2(function _xdrop(n, xf) {\n            return new XDrop(n, xf);\n        });\n    }();\n\n    var _xdropLast = function () {\n        function XDropLast(n, xf) {\n            this.xf = xf;\n            this.pos = 0;\n            this.full = false;\n            this.acc = new Array(n);\n        }\n        XDropLast.prototype['@@transducer/init'] = _xfBase.init;\n        XDropLast.prototype['@@transducer/result'] = function (result) {\n            this.acc = null;\n            return this.xf['@@transducer/result'](result);\n        };\n        XDropLast.prototype['@@transducer/step'] = function (result, input) {\n            if (this.full) {\n                result = this.xf['@@transducer/step'](result, this.acc[this.pos]);\n            }\n            this.store(input);\n            return result;\n        };\n        XDropLast.prototype.store = function (input) {\n            this.acc[this.pos] = input;\n            this.pos += 1;\n            if (this.pos === this.acc.length) {\n                this.pos = 0;\n                this.full = true;\n            }\n        };\n        return _curry2(function _xdropLast(n, xf) {\n            return new XDropLast(n, xf);\n        });\n    }();\n\n    var _xdropRepeatsWith = function () {\n        function XDropRepeatsWith(pred, xf) {\n            this.xf = xf;\n            this.pred = pred;\n            this.lastValue = undefined;\n            this.seenFirstValue = false;\n        }\n        XDropRepeatsWith.prototype['@@transducer/init'] = function () {\n            return this.xf['@@transducer/init']();\n        };\n        XDropRepeatsWith.prototype['@@transducer/result'] = function (result) {\n            return this.xf['@@transducer/result'](result);\n        };\n        XDropRepeatsWith.prototype['@@transducer/step'] = function (result, input) {\n            var sameAsLast = false;\n            if (!this.seenFirstValue) {\n                this.seenFirstValue = true;\n            } else if (this.pred(this.lastValue, input)) {\n                sameAsLast = true;\n            }\n            this.lastValue = input;\n            return sameAsLast ? result : this.xf['@@transducer/step'](result, input);\n        };\n        return _curry2(function _xdropRepeatsWith(pred, xf) {\n            return new XDropRepeatsWith(pred, xf);\n        });\n    }();\n\n    var _xdropWhile = function () {\n        function XDropWhile(f, xf) {\n            this.xf = xf;\n            this.f = f;\n        }\n        XDropWhile.prototype['@@transducer/init'] = _xfBase.init;\n        XDropWhile.prototype['@@transducer/result'] = _xfBase.result;\n        XDropWhile.prototype['@@transducer/step'] = function (result, input) {\n            if (this.f) {\n                if (this.f(input)) {\n                    return result;\n                }\n                this.f = null;\n            }\n            return this.xf['@@transducer/step'](result, input);\n        };\n        return _curry2(function _xdropWhile(f, xf) {\n            return new XDropWhile(f, xf);\n        });\n    }();\n\n    var _xfilter = function () {\n        function XFilter(f, xf) {\n            this.xf = xf;\n            this.f = f;\n        }\n        XFilter.prototype['@@transducer/init'] = _xfBase.init;\n        XFilter.prototype['@@transducer/result'] = _xfBase.result;\n        XFilter.prototype['@@transducer/step'] = function (result, input) {\n            return this.f(input) ? this.xf['@@transducer/step'](result, input) : result;\n        };\n        return _curry2(function _xfilter(f, xf) {\n            return new XFilter(f, xf);\n        });\n    }();\n\n    var _xfind = function () {\n        function XFind(f, xf) {\n            this.xf = xf;\n            this.f = f;\n            this.found = false;\n        }\n        XFind.prototype['@@transducer/init'] = _xfBase.init;\n        XFind.prototype['@@transducer/result'] = function (result) {\n            if (!this.found) {\n                result = this.xf['@@transducer/step'](result, void 0);\n            }\n            return this.xf['@@transducer/result'](result);\n        };\n        XFind.prototype['@@transducer/step'] = function (result, input) {\n            if (this.f(input)) {\n                this.found = true;\n                result = _reduced(this.xf['@@transducer/step'](result, input));\n            }\n            return result;\n        };\n        return _curry2(function _xfind(f, xf) {\n            return new XFind(f, xf);\n        });\n    }();\n\n    var _xfindIndex = function () {\n        function XFindIndex(f, xf) {\n            this.xf = xf;\n            this.f = f;\n            this.idx = -1;\n            this.found = false;\n        }\n        XFindIndex.prototype['@@transducer/init'] = _xfBase.init;\n        XFindIndex.prototype['@@transducer/result'] = function (result) {\n            if (!this.found) {\n                result = this.xf['@@transducer/step'](result, -1);\n            }\n            return this.xf['@@transducer/result'](result);\n        };\n        XFindIndex.prototype['@@transducer/step'] = function (result, input) {\n            this.idx += 1;\n            if (this.f(input)) {\n                this.found = true;\n                result = _reduced(this.xf['@@transducer/step'](result, this.idx));\n            }\n            return result;\n        };\n        return _curry2(function _xfindIndex(f, xf) {\n            return new XFindIndex(f, xf);\n        });\n    }();\n\n    var _xfindLast = function () {\n        function XFindLast(f, xf) {\n            this.xf = xf;\n            this.f = f;\n        }\n        XFindLast.prototype['@@transducer/init'] = _xfBase.init;\n        XFindLast.prototype['@@transducer/result'] = function (result) {\n            return this.xf['@@transducer/result'](this.xf['@@transducer/step'](result, this.last));\n        };\n        XFindLast.prototype['@@transducer/step'] = function (result, input) {\n            if (this.f(input)) {\n                this.last = input;\n            }\n            return result;\n        };\n        return _curry2(function _xfindLast(f, xf) {\n            return new XFindLast(f, xf);\n        });\n    }();\n\n    var _xfindLastIndex = function () {\n        function XFindLastIndex(f, xf) {\n            this.xf = xf;\n            this.f = f;\n            this.idx = -1;\n            this.lastIdx = -1;\n        }\n        XFindLastIndex.prototype['@@transducer/init'] = _xfBase.init;\n        XFindLastIndex.prototype['@@transducer/result'] = function (result) {\n            return this.xf['@@transducer/result'](this.xf['@@transducer/step'](result, this.lastIdx));\n        };\n        XFindLastIndex.prototype['@@transducer/step'] = function (result, input) {\n            this.idx += 1;\n            if (this.f(input)) {\n                this.lastIdx = this.idx;\n            }\n            return result;\n        };\n        return _curry2(function _xfindLastIndex(f, xf) {\n            return new XFindLastIndex(f, xf);\n        });\n    }();\n\n    var _xmap = function () {\n        function XMap(f, xf) {\n            this.xf = xf;\n            this.f = f;\n        }\n        XMap.prototype['@@transducer/init'] = _xfBase.init;\n        XMap.prototype['@@transducer/result'] = _xfBase.result;\n        XMap.prototype['@@transducer/step'] = function (result, input) {\n            return this.xf['@@transducer/step'](result, this.f(input));\n        };\n        return _curry2(function _xmap(f, xf) {\n            return new XMap(f, xf);\n        });\n    }();\n\n    var _xtake = function () {\n        function XTake(n, xf) {\n            this.xf = xf;\n            this.n = n;\n        }\n        XTake.prototype['@@transducer/init'] = _xfBase.init;\n        XTake.prototype['@@transducer/result'] = _xfBase.result;\n        XTake.prototype['@@transducer/step'] = function (result, input) {\n            if (this.n === 0) {\n                return _reduced(result);\n            } else {\n                this.n -= 1;\n                return this.xf['@@transducer/step'](result, input);\n            }\n        };\n        return _curry2(function _xtake(n, xf) {\n            return new XTake(n, xf);\n        });\n    }();\n\n    var _xtakeWhile = function () {\n        function XTakeWhile(f, xf) {\n            this.xf = xf;\n            this.f = f;\n        }\n        XTakeWhile.prototype['@@transducer/init'] = _xfBase.init;\n        XTakeWhile.prototype['@@transducer/result'] = _xfBase.result;\n        XTakeWhile.prototype['@@transducer/step'] = function (result, input) {\n            return this.f(input) ? this.xf['@@transducer/step'](result, input) : _reduced(result);\n        };\n        return _curry2(function _xtakeWhile(f, xf) {\n            return new XTakeWhile(f, xf);\n        });\n    }();\n\n    /**\n     * Adds two values.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.1.0\n     * @category Math\n     * @sig Number -> Number -> Number\n     * @param {Number} a\n     * @param {Number} b\n     * @return {Number}\n     * @see R.subtract\n     * @example\n     *\n     *      R.add(2, 3);       //=>  5\n     *      R.add(7)(10);      //=> 17\n     */\n    var add = _curry2(function add(a, b) {\n        return Number(a) + Number(b);\n    });\n\n    /**\n     * Applies a function to the value at the given index of an array, returning a\n     * new copy of the array with the element at the given index replaced with the\n     * result of the function application.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.14.0\n     * @category List\n     * @sig (a -> a) -> Number -> [a] -> [a]\n     * @param {Function} fn The function to apply.\n     * @param {Number} idx The index.\n     * @param {Array|Arguments} list An array-like object whose value\n     *        at the supplied index will be replaced.\n     * @return {Array} A copy of the supplied array-like object with\n     *         the element at index `idx` replaced with the value\n     *         returned by applying `fn` to the existing element.\n     * @see R.update\n     * @example\n     *\n     *      R.adjust(R.add(10), 1, [0, 1, 2]);     //=> [0, 11, 2]\n     *      R.adjust(R.add(10))(1)([0, 1, 2]);     //=> [0, 11, 2]\n     */\n    var adjust = _curry3(function adjust(fn, idx, list) {\n        if (idx >= list.length || idx < -list.length) {\n            return list;\n        }\n        var start = idx < 0 ? list.length : 0;\n        var _idx = start + idx;\n        var _list = _concat(list);\n        _list[_idx] = fn(list[_idx]);\n        return _list;\n    });\n\n    /**\n     * Returns `true` if all elements of the list match the predicate, `false` if\n     * there are any that don't.\n     *\n     * Dispatches to the `all` method of the second argument, if present.\n     *\n     * Acts as a transducer if a transformer is given in list position.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.1.0\n     * @category List\n     * @sig (a -> Boolean) -> [a] -> Boolean\n     * @param {Function} fn The predicate function.\n     * @param {Array} list The array to consider.\n     * @return {Boolean} `true` if the predicate is satisfied by every element, `false`\n     *         otherwise.\n     * @see R.any, R.none, R.transduce\n     * @example\n     *\n     *      var lessThan2 = R.flip(R.lt)(2);\n     *      var lessThan3 = R.flip(R.lt)(3);\n     *      R.all(lessThan2)([1, 2]); //=> false\n     *      R.all(lessThan3)([1, 2]); //=> true\n     */\n    var all = _curry2(_dispatchable('all', _xall, function all(fn, list) {\n        var idx = 0;\n        while (idx < list.length) {\n            if (!fn(list[idx])) {\n                return false;\n            }\n            idx += 1;\n        }\n        return true;\n    }));\n\n    /**\n     * Returns a function that always returns the given value. Note that for\n     * non-primitives the value returned is a reference to the original value.\n     *\n     * This function is known as `const`, `constant`, or `K` (for K combinator) in\n     * other languages and libraries.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.1.0\n     * @category Function\n     * @sig a -> (* -> a)\n     * @param {*} val The value to wrap in a function\n     * @return {Function} A Function :: * -> val.\n     * @example\n     *\n     *      var t = R.always('Tee');\n     *      t(); //=> 'Tee'\n     */\n    var always = _curry1(function always(val) {\n        return function () {\n            return val;\n        };\n    });\n\n    /**\n     * Returns `true` if both arguments are `true`; `false` otherwise.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.1.0\n     * @category Logic\n     * @sig * -> * -> *\n     * @param {Boolean} a A boolean value\n     * @param {Boolean} b A boolean value\n     * @return {Boolean} `true` if both arguments are `true`, `false` otherwise\n     * @see R.both\n     * @example\n     *\n     *      R.and(true, true); //=> true\n     *      R.and(true, false); //=> false\n     *      R.and(false, true); //=> false\n     *      R.and(false, false); //=> false\n     */\n    var and = _curry2(function and(a, b) {\n        return a && b;\n    });\n\n    /**\n     * Returns `true` if at least one of elements of the list match the predicate,\n     * `false` otherwise.\n     *\n     * Dispatches to the `any` method of the second argument, if present.\n     *\n     * Acts as a transducer if a transformer is given in list position.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.1.0\n     * @category List\n     * @sig (a -> Boolean) -> [a] -> Boolean\n     * @param {Function} fn The predicate function.\n     * @param {Array} list The array to consider.\n     * @return {Boolean} `true` if the predicate is satisfied by at least one element, `false`\n     *         otherwise.\n     * @see R.all, R.none, R.transduce\n     * @example\n     *\n     *      var lessThan0 = R.flip(R.lt)(0);\n     *      var lessThan2 = R.flip(R.lt)(2);\n     *      R.any(lessThan0)([1, 2]); //=> false\n     *      R.any(lessThan2)([1, 2]); //=> true\n     */\n    var any = _curry2(_dispatchable('any', _xany, function any(fn, list) {\n        var idx = 0;\n        while (idx < list.length) {\n            if (fn(list[idx])) {\n                return true;\n            }\n            idx += 1;\n        }\n        return false;\n    }));\n\n    /**\n     * Returns a new list, composed of n-tuples of consecutive elements If `n` is\n     * greater than the length of the list, an empty list is returned.\n     *\n     * Dispatches to the `aperture` method of the second argument, if present.\n     *\n     * Acts as a transducer if a transformer is given in list position.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.12.0\n     * @category List\n     * @sig Number -> [a] -> [[a]]\n     * @param {Number} n The size of the tuples to create\n     * @param {Array} list The list to split into `n`-tuples\n     * @return {Array} The new list.\n     * @see R.transduce\n     * @example\n     *\n     *      R.aperture(2, [1, 2, 3, 4, 5]); //=> [[1, 2], [2, 3], [3, 4], [4, 5]]\n     *      R.aperture(3, [1, 2, 3, 4, 5]); //=> [[1, 2, 3], [2, 3, 4], [3, 4, 5]]\n     *      R.aperture(7, [1, 2, 3, 4, 5]); //=> []\n     */\n    var aperture = _curry2(_dispatchable('aperture', _xaperture, _aperture));\n\n    /**\n     * Returns a new list containing the contents of the given list, followed by\n     * the given element.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.1.0\n     * @category List\n     * @sig a -> [a] -> [a]\n     * @param {*} el The element to add to the end of the new list.\n     * @param {Array} list The list whose contents will be added to the beginning of the output\n     *        list.\n     * @return {Array} A new list containing the contents of the old list followed by `el`.\n     * @see R.prepend\n     * @example\n     *\n     *      R.append('tests', ['write', 'more']); //=> ['write', 'more', 'tests']\n     *      R.append('tests', []); //=> ['tests']\n     *      R.append(['tests'], ['write', 'more']); //=> ['write', 'more', ['tests']]\n     */\n    var append = _curry2(function append(el, list) {\n        return _concat(list, [el]);\n    });\n\n    /**\n     * Applies function `fn` to the argument list `args`. This is useful for\n     * creating a fixed-arity function from a variadic function. `fn` should be a\n     * bound function if context is significant.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.7.0\n     * @category Function\n     * @sig (*... -> a) -> [*] -> a\n     * @param {Function} fn\n     * @param {Array} args\n     * @return {*}\n     * @see R.call, R.unapply\n     * @example\n     *\n     *      var nums = [1, 2, 3, -99, 42, 6, 7];\n     *      R.apply(Math.max, nums); //=> 42\n     */\n    var apply = _curry2(function apply(fn, args) {\n        return fn.apply(this, args);\n    });\n\n    /**\n     * Makes a shallow clone of an object, setting or overriding the specified\n     * property with the given value. Note that this copies and flattens prototype\n     * properties onto the new object as well. All non-primitive properties are\n     * copied by reference.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.8.0\n     * @category Object\n     * @sig String -> a -> {k: v} -> {k: v}\n     * @param {String} prop the property name to set\n     * @param {*} val the new value\n     * @param {Object} obj the object to clone\n     * @return {Object} a new object similar to the original except for the specified property.\n     * @see R.dissoc\n     * @example\n     *\n     *      R.assoc('c', 3, {a: 1, b: 2}); //=> {a: 1, b: 2, c: 3}\n     */\n    var assoc = _curry3(function assoc(prop, val, obj) {\n        var result = {};\n        for (var p in obj) {\n            result[p] = obj[p];\n        }\n        result[prop] = val;\n        return result;\n    });\n\n    /**\n     * Makes a shallow clone of an object, setting or overriding the nodes required\n     * to create the given path, and placing the specific value at the tail end of\n     * that path. Note that this copies and flattens prototype properties onto the\n     * new object as well. All non-primitive properties are copied by reference.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.8.0\n     * @category Object\n     * @sig [String] -> a -> {k: v} -> {k: v}\n     * @param {Array} path the path to set\n     * @param {*} val the new value\n     * @param {Object} obj the object to clone\n     * @return {Object} a new object similar to the original except along the specified path.\n     * @see R.dissocPath\n     * @example\n     *\n     *      R.assocPath(['a', 'b', 'c'], 42, {a: {b: {c: 0}}}); //=> {a: {b: {c: 42}}}\n     */\n    var assocPath = _curry3(function assocPath(path, val, obj) {\n        switch (path.length) {\n        case 0:\n            return val;\n        case 1:\n            return assoc(path[0], val, obj);\n        default:\n            return assoc(path[0], assocPath(_slice(path, 1), val, Object(obj[path[0]])), obj);\n        }\n    });\n\n    /**\n     * Creates a function that is bound to a context.\n     * Note: `R.bind` does not provide the additional argument-binding capabilities of\n     * [Function.prototype.bind](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function/bind).\n     *\n     * @func\n     * @memberOf R\n     * @since v0.6.0\n     * @category Function\n     * @category Object\n     * @sig (* -> *) -> {*} -> (* -> *)\n     * @param {Function} fn The function to bind to context\n     * @param {Object} thisObj The context to bind `fn` to\n     * @return {Function} A function that will execute in the context of `thisObj`.\n     * @see R.partial\n     */\n    var bind = _curry2(function bind(fn, thisObj) {\n        return _arity(fn.length, function () {\n            return fn.apply(thisObj, arguments);\n        });\n    });\n\n    /**\n     * Restricts a number to be within a range.\n     *\n     * Also works for other ordered types such as Strings and Dates.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.20.0\n     * @category Relation\n     * @sig Ord a => a -> a -> a -> a\n     * @param {Number} minimum number\n     * @param {Number} maximum number\n     * @param {Number} value to be clamped\n     * @return {Number} Returns the clamped value\n     * @example\n     *\n     *      R.clamp(1, 10, -1) // => 1\n     *      R.clamp(1, 10, 11) // => 10\n     *      R.clamp(1, 10, 4)  // => 4\n     */\n    var clamp = _curry3(function clamp(min, max, value) {\n        if (min > max) {\n            throw new Error('min must not be greater than max in clamp(min, max, value)');\n        }\n        return value < min ? min : value > max ? max : value;\n    });\n\n    /**\n     * Makes a comparator function out of a function that reports whether the first\n     * element is less than the second.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.1.0\n     * @category Function\n     * @sig (a, b -> Boolean) -> (a, b -> Number)\n     * @param {Function} pred A predicate function of arity two.\n     * @return {Function} A Function :: a -> b -> Int that returns `-1` if a < b, `1` if b < a, otherwise `0`.\n     * @example\n     *\n     *      var cmp = R.comparator((a, b) => a.age < b.age);\n     *      var people = [\n     *        // ...\n     *      ];\n     *      R.sort(cmp, people);\n     */\n    var comparator = _curry1(function comparator(pred) {\n        return function (a, b) {\n            return pred(a, b) ? -1 : pred(b, a) ? 1 : 0;\n        };\n    });\n\n    /**\n     * Returns a curried equivalent of the provided function, with the specified\n     * arity. The curried function has two unusual capabilities. First, its\n     * arguments needn't be provided one at a time. If `g` is `R.curryN(3, f)`, the\n     * following are equivalent:\n     *\n     *   - `g(1)(2)(3)`\n     *   - `g(1)(2, 3)`\n     *   - `g(1, 2)(3)`\n     *   - `g(1, 2, 3)`\n     *\n     * Secondly, the special placeholder value `R.__` may be used to specify\n     * \"gaps\", allowing partial application of any combination of arguments,\n     * regardless of their positions. If `g` is as above and `_` is `R.__`, the\n     * following are equivalent:\n     *\n     *   - `g(1, 2, 3)`\n     *   - `g(_, 2, 3)(1)`\n     *   - `g(_, _, 3)(1)(2)`\n     *   - `g(_, _, 3)(1, 2)`\n     *   - `g(_, 2)(1)(3)`\n     *   - `g(_, 2)(1, 3)`\n     *   - `g(_, 2)(_, 3)(1)`\n     *\n     * @func\n     * @memberOf R\n     * @since v0.5.0\n     * @category Function\n     * @sig Number -> (* -> a) -> (* -> a)\n     * @param {Number} length The arity for the returned function.\n     * @param {Function} fn The function to curry.\n     * @return {Function} A new, curried function.\n     * @see R.curry\n     * @example\n     *\n     *      var sumArgs = (...args) => R.sum(args);\n     *\n     *      var curriedAddFourNumbers = R.curryN(4, sumArgs);\n     *      var f = curriedAddFourNumbers(1, 2);\n     *      var g = f(3);\n     *      g(4); //=> 10\n     */\n    var curryN = _curry2(function curryN(length, fn) {\n        if (length === 1) {\n            return _curry1(fn);\n        }\n        return _arity(length, _curryN(length, [], fn));\n    });\n\n    /**\n     * Decrements its argument.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.9.0\n     * @category Math\n     * @sig Number -> Number\n     * @param {Number} n\n     * @return {Number}\n     * @see R.inc\n     * @example\n     *\n     *      R.dec(42); //=> 41\n     */\n    var dec = add(-1);\n\n    /**\n     * Returns the second argument if it is not `null`, `undefined` or `NaN`\n     * otherwise the first argument is returned.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.10.0\n     * @category Logic\n     * @sig a -> b -> a | b\n     * @param {a} val The default value.\n     * @param {b} val The value to return if it is not null or undefined\n     * @return {*} The the second value or the default value\n     * @example\n     *\n     *      var defaultTo42 = R.defaultTo(42);\n     *\n     *      defaultTo42(null);  //=> 42\n     *      defaultTo42(undefined);  //=> 42\n     *      defaultTo42('Ramda');  //=> 'Ramda'\n     *      defaultTo42(parseInt('string')); //=> 42\n     */\n    var defaultTo = _curry2(function defaultTo(d, v) {\n        return v == null || v !== v ? d : v;\n    });\n\n    /**\n     * Finds the set (i.e. no duplicates) of all elements in the first list not\n     * contained in the second list. Duplication is determined according to the\n     * value returned by applying the supplied predicate to two list elements.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.1.0\n     * @category Relation\n     * @sig (a -> a -> Boolean) -> [*] -> [*] -> [*]\n     * @param {Function} pred A predicate used to test whether two items are equal.\n     * @param {Array} list1 The first list.\n     * @param {Array} list2 The second list.\n     * @return {Array} The elements in `list1` that are not in `list2`.\n     * @see R.difference\n     * @example\n     *\n     *      var cmp = (x, y) => x.a === y.a;\n     *      var l1 = [{a: 1}, {a: 2}, {a: 3}];\n     *      var l2 = [{a: 3}, {a: 4}];\n     *      R.differenceWith(cmp, l1, l2); //=> [{a: 1}, {a: 2}]\n     */\n    var differenceWith = _curry3(function differenceWith(pred, first, second) {\n        var out = [];\n        var idx = 0;\n        var firstLen = first.length;\n        while (idx < firstLen) {\n            if (!_containsWith(pred, first[idx], second) && !_containsWith(pred, first[idx], out)) {\n                out.push(first[idx]);\n            }\n            idx += 1;\n        }\n        return out;\n    });\n\n    /**\n     * Returns a new object that does not contain a `prop` property.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.10.0\n     * @category Object\n     * @sig String -> {k: v} -> {k: v}\n     * @param {String} prop the name of the property to dissociate\n     * @param {Object} obj the object to clone\n     * @return {Object} a new object similar to the original but without the specified property\n     * @see R.assoc\n     * @example\n     *\n     *      R.dissoc('b', {a: 1, b: 2, c: 3}); //=> {a: 1, c: 3}\n     */\n    var dissoc = _curry2(function dissoc(prop, obj) {\n        var result = {};\n        for (var p in obj) {\n            if (p !== prop) {\n                result[p] = obj[p];\n            }\n        }\n        return result;\n    });\n\n    /**\n     * Makes a shallow clone of an object, omitting the property at the given path.\n     * Note that this copies and flattens prototype properties onto the new object\n     * as well. All non-primitive properties are copied by reference.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.11.0\n     * @category Object\n     * @sig [String] -> {k: v} -> {k: v}\n     * @param {Array} path the path to set\n     * @param {Object} obj the object to clone\n     * @return {Object} a new object without the property at path\n     * @see R.assocPath\n     * @example\n     *\n     *      R.dissocPath(['a', 'b', 'c'], {a: {b: {c: 42}}}); //=> {a: {b: {}}}\n     */\n    var dissocPath = _curry2(function dissocPath(path, obj) {\n        switch (path.length) {\n        case 0:\n            return obj;\n        case 1:\n            return dissoc(path[0], obj);\n        default:\n            var head = path[0];\n            var tail = _slice(path, 1);\n            return obj[head] == null ? obj : assoc(head, dissocPath(tail, obj[head]), obj);\n        }\n    });\n\n    /**\n     * Divides two numbers. Equivalent to `a / b`.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.1.0\n     * @category Math\n     * @sig Number -> Number -> Number\n     * @param {Number} a The first value.\n     * @param {Number} b The second value.\n     * @return {Number} The result of `a / b`.\n     * @see R.multiply\n     * @example\n     *\n     *      R.divide(71, 100); //=> 0.71\n     *\n     *      var half = R.divide(R.__, 2);\n     *      half(42); //=> 21\n     *\n     *      var reciprocal = R.divide(1);\n     *      reciprocal(4);   //=> 0.25\n     */\n    var divide = _curry2(function divide(a, b) {\n        return a / b;\n    });\n\n    /**\n     * Returns a new list containing the last `n` elements of a given list, passing\n     * each value to the supplied predicate function, skipping elements while the\n     * predicate function returns `true`. The predicate function is passed one\n     * argument: *(value)*.\n     *\n     * Dispatches to the `dropWhile` method of the second argument, if present.\n     *\n     * Acts as a transducer if a transformer is given in list position.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.9.0\n     * @category List\n     * @sig (a -> Boolean) -> [a] -> [a]\n     * @param {Function} fn The function called per iteration.\n     * @param {Array} list The collection to iterate over.\n     * @return {Array} A new array.\n     * @see R.takeWhile, R.transduce, R.addIndex\n     * @example\n     *\n     *      var lteTwo = x => x <= 2;\n     *\n     *      R.dropWhile(lteTwo, [1, 2, 3, 4, 3, 2, 1]); //=> [3, 4, 3, 2, 1]\n     */\n    var dropWhile = _curry2(_dispatchable('dropWhile', _xdropWhile, function dropWhile(pred, list) {\n        var idx = 0;\n        var len = list.length;\n        while (idx < len && pred(list[idx])) {\n            idx += 1;\n        }\n        return _slice(list, idx);\n    }));\n\n    /**\n     * Returns the empty value of its argument's type. Ramda defines the empty\n     * value of Array (`[]`), Object (`{}`), String (`''`), and Arguments. Other\n     * types are supported if they define `<Type>.empty` and/or\n     * `<Type>.prototype.empty`.\n     *\n     * Dispatches to the `empty` method of the first argument, if present.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.3.0\n     * @category Function\n     * @sig a -> a\n     * @param {*} x\n     * @return {*}\n     * @example\n     *\n     *      R.empty(Just(42));      //=> Nothing()\n     *      R.empty([1, 2, 3]);     //=> []\n     *      R.empty('unicorns');    //=> ''\n     *      R.empty({x: 1, y: 2});  //=> {}\n     */\n    // else\n    var empty = _curry1(function empty(x) {\n        return x != null && typeof x.empty === 'function' ? x.empty() : x != null && x.constructor != null && typeof x.constructor.empty === 'function' ? x.constructor.empty() : _isArray(x) ? [] : _isString(x) ? '' : _isObject(x) ? {} : _isArguments(x) ? function () {\n            return arguments;\n        }() : // else\n        void 0;\n    });\n\n    /**\n     * Creates a new object by recursively evolving a shallow copy of `object`,\n     * according to the `transformation` functions. All non-primitive properties\n     * are copied by reference.\n     *\n     * A `transformation` function will not be invoked if its corresponding key\n     * does not exist in the evolved object.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.9.0\n     * @category Object\n     * @sig {k: (v -> v)} -> {k: v} -> {k: v}\n     * @param {Object} transformations The object specifying transformation functions to apply\n     *        to the object.\n     * @param {Object} object The object to be transformed.\n     * @return {Object} The transformed object.\n     * @example\n     *\n     *      var tomato  = {firstName: '  Tomato ', data: {elapsed: 100, remaining: 1400}, id:123};\n     *      var transformations = {\n     *        firstName: R.trim,\n     *        lastName: R.trim, // Will not get invoked.\n     *        data: {elapsed: R.add(1), remaining: R.add(-1)}\n     *      };\n     *      R.evolve(transformations, tomato); //=> {firstName: 'Tomato', data: {elapsed: 101, remaining: 1399}, id:123}\n     */\n    var evolve = _curry2(function evolve(transformations, object) {\n        var result = {};\n        var transformation, key, type;\n        for (key in object) {\n            transformation = transformations[key];\n            type = typeof transformation;\n            result[key] = type === 'function' ? transformation(object[key]) : type === 'object' ? evolve(transformations[key], object[key]) : object[key];\n        }\n        return result;\n    });\n\n    /**\n     * Returns the first element of the list which matches the predicate, or\n     * `undefined` if no element matches.\n     *\n     * Dispatches to the `find` method of the second argument, if present.\n     *\n     * Acts as a transducer if a transformer is given in list position.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.1.0\n     * @category List\n     * @sig (a -> Boolean) -> [a] -> a | undefined\n     * @param {Function} fn The predicate function used to determine if the element is the\n     *        desired one.\n     * @param {Array} list The array to consider.\n     * @return {Object} The element found, or `undefined`.\n     * @see R.transduce\n     * @example\n     *\n     *      var xs = [{a: 1}, {a: 2}, {a: 3}];\n     *      R.find(R.propEq('a', 2))(xs); //=> {a: 2}\n     *      R.find(R.propEq('a', 4))(xs); //=> undefined\n     */\n    var find = _curry2(_dispatchable('find', _xfind, function find(fn, list) {\n        var idx = 0;\n        var len = list.length;\n        while (idx < len) {\n            if (fn(list[idx])) {\n                return list[idx];\n            }\n            idx += 1;\n        }\n    }));\n\n    /**\n     * Returns the index of the first element of the list which matches the\n     * predicate, or `-1` if no element matches.\n     *\n     * Dispatches to the `findIndex` method of the second argument, if present.\n     *\n     * Acts as a transducer if a transformer is given in list position.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.1.1\n     * @category List\n     * @sig (a -> Boolean) -> [a] -> Number\n     * @param {Function} fn The predicate function used to determine if the element is the\n     * desired one.\n     * @param {Array} list The array to consider.\n     * @return {Number} The index of the element found, or `-1`.\n     * @see R.transduce\n     * @example\n     *\n     *      var xs = [{a: 1}, {a: 2}, {a: 3}];\n     *      R.findIndex(R.propEq('a', 2))(xs); //=> 1\n     *      R.findIndex(R.propEq('a', 4))(xs); //=> -1\n     */\n    var findIndex = _curry2(_dispatchable('findIndex', _xfindIndex, function findIndex(fn, list) {\n        var idx = 0;\n        var len = list.length;\n        while (idx < len) {\n            if (fn(list[idx])) {\n                return idx;\n            }\n            idx += 1;\n        }\n        return -1;\n    }));\n\n    /**\n     * Returns the last element of the list which matches the predicate, or\n     * `undefined` if no element matches.\n     *\n     * Dispatches to the `findLast` method of the second argument, if present.\n     *\n     * Acts as a transducer if a transformer is given in list position.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.1.1\n     * @category List\n     * @sig (a -> Boolean) -> [a] -> a | undefined\n     * @param {Function} fn The predicate function used to determine if the element is the\n     * desired one.\n     * @param {Array} list The array to consider.\n     * @return {Object} The element found, or `undefined`.\n     * @see R.transduce\n     * @example\n     *\n     *      var xs = [{a: 1, b: 0}, {a:1, b: 1}];\n     *      R.findLast(R.propEq('a', 1))(xs); //=> {a: 1, b: 1}\n     *      R.findLast(R.propEq('a', 4))(xs); //=> undefined\n     */\n    var findLast = _curry2(_dispatchable('findLast', _xfindLast, function findLast(fn, list) {\n        var idx = list.length - 1;\n        while (idx >= 0) {\n            if (fn(list[idx])) {\n                return list[idx];\n            }\n            idx -= 1;\n        }\n    }));\n\n    /**\n     * Returns the index of the last element of the list which matches the\n     * predicate, or `-1` if no element matches.\n     *\n     * Dispatches to the `findLastIndex` method of the second argument, if present.\n     *\n     * Acts as a transducer if a transformer is given in list position.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.1.1\n     * @category List\n     * @sig (a -> Boolean) -> [a] -> Number\n     * @param {Function} fn The predicate function used to determine if the element is the\n     * desired one.\n     * @param {Array} list The array to consider.\n     * @return {Number} The index of the element found, or `-1`.\n     * @see R.transduce\n     * @example\n     *\n     *      var xs = [{a: 1, b: 0}, {a:1, b: 1}];\n     *      R.findLastIndex(R.propEq('a', 1))(xs); //=> 1\n     *      R.findLastIndex(R.propEq('a', 4))(xs); //=> -1\n     */\n    var findLastIndex = _curry2(_dispatchable('findLastIndex', _xfindLastIndex, function findLastIndex(fn, list) {\n        var idx = list.length - 1;\n        while (idx >= 0) {\n            if (fn(list[idx])) {\n                return idx;\n            }\n            idx -= 1;\n        }\n        return -1;\n    }));\n\n    /**\n     * Iterate over an input `list`, calling a provided function `fn` for each\n     * element in the list.\n     *\n     * `fn` receives one argument: *(value)*.\n     *\n     * Note: `R.forEach` does not skip deleted or unassigned indices (sparse\n     * arrays), unlike the native `Array.prototype.forEach` method. For more\n     * details on this behavior, see:\n     * https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/forEach#Description\n     *\n     * Also note that, unlike `Array.prototype.forEach`, Ramda's `forEach` returns\n     * the original array. In some libraries this function is named `each`.\n     *\n     * Dispatches to the `forEach` method of the second argument, if present.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.1.1\n     * @category List\n     * @sig (a -> *) -> [a] -> [a]\n     * @param {Function} fn The function to invoke. Receives one argument, `value`.\n     * @param {Array} list The list to iterate over.\n     * @return {Array} The original list.\n     * @see R.addIndex\n     * @example\n     *\n     *      var printXPlusFive = x => console.log(x + 5);\n     *      R.forEach(printXPlusFive, [1, 2, 3]); //=> [1, 2, 3]\n     *      //-> 6\n     *      //-> 7\n     *      //-> 8\n     */\n    var forEach = _curry2(_checkForMethod('forEach', function forEach(fn, list) {\n        var len = list.length;\n        var idx = 0;\n        while (idx < len) {\n            fn(list[idx]);\n            idx += 1;\n        }\n        return list;\n    }));\n\n    /**\n     * Creates a new object out of a list key-value pairs.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.3.0\n     * @category List\n     * @sig [[k,v]] -> {k: v}\n     * @param {Array} pairs An array of two-element arrays that will be the keys and values of the output object.\n     * @return {Object} The object made by pairing up `keys` and `values`.\n     * @see R.toPairs, R.pair\n     * @example\n     *\n     *      R.fromPairs([['a', 1], ['b', 2],  ['c', 3]]); //=> {a: 1, b: 2, c: 3}\n     */\n    var fromPairs = _curry1(function fromPairs(pairs) {\n        var idx = 0;\n        var len = pairs.length;\n        var out = {};\n        while (idx < len) {\n            if (_isArray(pairs[idx]) && pairs[idx].length) {\n                out[pairs[idx][0]] = pairs[idx][1];\n            }\n            idx += 1;\n        }\n        return out;\n    });\n\n    /**\n     * Takes a list and returns a list of lists where each sublist's elements are\n     * all \"equal\" according to the provided equality function.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.21.0\n     * @category List\n     * @sig (a, a -> Boolean) -> [a] -> [[a]]\n     * @param {Function} fn Function for determining whether two given (adjacent)\n     *        elements should be in the same group\n     * @param {Array} list The array to group. Also accepts a string, which will be\n     *        treated as a list of characters.\n     * @return {List} A list that contains sublists of equal elements,\n     *         whose concatenations is equal to the original list.\n     * @example\n     *\n     *    groupWith(R.equals, [0, 1, 1, 2, 3, 5, 8, 13, 21])\n     *    // [[0], [1, 1], [2, 3, 5, 8, 13, 21]]\n     *\n     *    groupWith((a, b) => a % 2 === b % 2, [0, 1, 1, 2, 3, 5, 8, 13, 21])\n     *    // [[0], [1, 1], [2], [3, 5], [8], [13, 21]]\n     *\n     *    R.groupWith(R.eqBy(isVowel), 'aestiou')\n     *    // ['ae', 'st', 'iou']\n     */\n    var groupWith = _curry2(function (fn, list) {\n        var res = [];\n        var idx = 0;\n        var len = list.length;\n        while (idx < len) {\n            var nextidx = idx + 1;\n            while (nextidx < len && fn(list[idx], list[nextidx])) {\n                nextidx += 1;\n            }\n            res.push(list.slice(idx, nextidx));\n            idx = nextidx;\n        }\n        return res;\n    });\n\n    /**\n     * Returns `true` if the first argument is greater than the second; `false`\n     * otherwise.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.1.0\n     * @category Relation\n     * @sig Ord a => a -> a -> Boolean\n     * @param {*} a\n     * @param {*} b\n     * @return {Boolean}\n     * @see R.lt\n     * @example\n     *\n     *      R.gt(2, 1); //=> true\n     *      R.gt(2, 2); //=> false\n     *      R.gt(2, 3); //=> false\n     *      R.gt('a', 'z'); //=> false\n     *      R.gt('z', 'a'); //=> true\n     */\n    var gt = _curry2(function gt(a, b) {\n        return a > b;\n    });\n\n    /**\n     * Returns `true` if the first argument is greater than or equal to the second;\n     * `false` otherwise.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.1.0\n     * @category Relation\n     * @sig Ord a => a -> a -> Boolean\n     * @param {Number} a\n     * @param {Number} b\n     * @return {Boolean}\n     * @see R.lte\n     * @example\n     *\n     *      R.gte(2, 1); //=> true\n     *      R.gte(2, 2); //=> true\n     *      R.gte(2, 3); //=> false\n     *      R.gte('a', 'z'); //=> false\n     *      R.gte('z', 'a'); //=> true\n     */\n    var gte = _curry2(function gte(a, b) {\n        return a >= b;\n    });\n\n    /**\n     * Returns whether or not an object has an own property with the specified name\n     *\n     * @func\n     * @memberOf R\n     * @since v0.7.0\n     * @category Object\n     * @sig s -> {s: x} -> Boolean\n     * @param {String} prop The name of the property to check for.\n     * @param {Object} obj The object to query.\n     * @return {Boolean} Whether the property exists.\n     * @example\n     *\n     *      var hasName = R.has('name');\n     *      hasName({name: 'alice'});   //=> true\n     *      hasName({name: 'bob'});     //=> true\n     *      hasName({});                //=> false\n     *\n     *      var point = {x: 0, y: 0};\n     *      var pointHas = R.has(R.__, point);\n     *      pointHas('x');  //=> true\n     *      pointHas('y');  //=> true\n     *      pointHas('z');  //=> false\n     */\n    var has = _curry2(_has);\n\n    /**\n     * Returns whether or not an object or its prototype chain has a property with\n     * the specified name\n     *\n     * @func\n     * @memberOf R\n     * @since v0.7.0\n     * @category Object\n     * @sig s -> {s: x} -> Boolean\n     * @param {String} prop The name of the property to check for.\n     * @param {Object} obj The object to query.\n     * @return {Boolean} Whether the property exists.\n     * @example\n     *\n     *      function Rectangle(width, height) {\n     *        this.width = width;\n     *        this.height = height;\n     *      }\n     *      Rectangle.prototype.area = function() {\n     *        return this.width * this.height;\n     *      };\n     *\n     *      var square = new Rectangle(2, 2);\n     *      R.hasIn('width', square);  //=> true\n     *      R.hasIn('area', square);  //=> true\n     */\n    var hasIn = _curry2(function hasIn(prop, obj) {\n        return prop in obj;\n    });\n\n    /**\n     * Returns true if its arguments are identical, false otherwise. Values are\n     * identical if they reference the same memory. `NaN` is identical to `NaN`;\n     * `0` and `-0` are not identical.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.15.0\n     * @category Relation\n     * @sig a -> a -> Boolean\n     * @param {*} a\n     * @param {*} b\n     * @return {Boolean}\n     * @example\n     *\n     *      var o = {};\n     *      R.identical(o, o); //=> true\n     *      R.identical(1, 1); //=> true\n     *      R.identical(1, '1'); //=> false\n     *      R.identical([], []); //=> false\n     *      R.identical(0, -0); //=> false\n     *      R.identical(NaN, NaN); //=> true\n     */\n    // SameValue algorithm\n    // Steps 1-5, 7-10\n    // Steps 6.b-6.e: +0 != -0\n    // Step 6.a: NaN == NaN\n    var identical = _curry2(function identical(a, b) {\n        // SameValue algorithm\n        if (a === b) {\n            // Steps 1-5, 7-10\n            // Steps 6.b-6.e: +0 != -0\n            return a !== 0 || 1 / a === 1 / b;\n        } else {\n            // Step 6.a: NaN == NaN\n            return a !== a && b !== b;\n        }\n    });\n\n    /**\n     * A function that does nothing but return the parameter supplied to it. Good\n     * as a default or placeholder function.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.1.0\n     * @category Function\n     * @sig a -> a\n     * @param {*} x The value to return.\n     * @return {*} The input value, `x`.\n     * @example\n     *\n     *      R.identity(1); //=> 1\n     *\n     *      var obj = {};\n     *      R.identity(obj) === obj; //=> true\n     */\n    var identity = _curry1(_identity);\n\n    /**\n     * Creates a function that will process either the `onTrue` or the `onFalse`\n     * function depending upon the result of the `condition` predicate.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.8.0\n     * @category Logic\n     * @sig (*... -> Boolean) -> (*... -> *) -> (*... -> *) -> (*... -> *)\n     * @param {Function} condition A predicate function\n     * @param {Function} onTrue A function to invoke when the `condition` evaluates to a truthy value.\n     * @param {Function} onFalse A function to invoke when the `condition` evaluates to a falsy value.\n     * @return {Function} A new unary function that will process either the `onTrue` or the `onFalse`\n     *                    function depending upon the result of the `condition` predicate.\n     * @see R.unless, R.when\n     * @example\n     *\n     *      var incCount = R.ifElse(\n     *        R.has('count'),\n     *        R.over(R.lensProp('count'), R.inc),\n     *        R.assoc('count', 1)\n     *      );\n     *      incCount({});           //=> { count: 1 }\n     *      incCount({ count: 1 }); //=> { count: 2 }\n     */\n    var ifElse = _curry3(function ifElse(condition, onTrue, onFalse) {\n        return curryN(Math.max(condition.length, onTrue.length, onFalse.length), function _ifElse() {\n            return condition.apply(this, arguments) ? onTrue.apply(this, arguments) : onFalse.apply(this, arguments);\n        });\n    });\n\n    /**\n     * Increments its argument.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.9.0\n     * @category Math\n     * @sig Number -> Number\n     * @param {Number} n\n     * @return {Number}\n     * @see R.dec\n     * @example\n     *\n     *      R.inc(42); //=> 43\n     */\n    var inc = add(1);\n\n    /**\n     * Inserts the supplied element into the list, at index `index`. _Note that\n     * this is not destructive_: it returns a copy of the list with the changes.\n     * <small>No lists have been harmed in the application of this function.</small>\n     *\n     * @func\n     * @memberOf R\n     * @since v0.2.2\n     * @category List\n     * @sig Number -> a -> [a] -> [a]\n     * @param {Number} index The position to insert the element\n     * @param {*} elt The element to insert into the Array\n     * @param {Array} list The list to insert into\n     * @return {Array} A new Array with `elt` inserted at `index`.\n     * @example\n     *\n     *      R.insert(2, 'x', [1,2,3,4]); //=> [1,2,'x',3,4]\n     */\n    var insert = _curry3(function insert(idx, elt, list) {\n        idx = idx < list.length && idx >= 0 ? idx : list.length;\n        var result = _slice(list);\n        result.splice(idx, 0, elt);\n        return result;\n    });\n\n    /**\n     * Inserts the sub-list into the list, at index `index`. _Note that this is not\n     * destructive_: it returns a copy of the list with the changes.\n     * <small>No lists have been harmed in the application of this function.</small>\n     *\n     * @func\n     * @memberOf R\n     * @since v0.9.0\n     * @category List\n     * @sig Number -> [a] -> [a] -> [a]\n     * @param {Number} index The position to insert the sub-list\n     * @param {Array} elts The sub-list to insert into the Array\n     * @param {Array} list The list to insert the sub-list into\n     * @return {Array} A new Array with `elts` inserted starting at `index`.\n     * @example\n     *\n     *      R.insertAll(2, ['x','y','z'], [1,2,3,4]); //=> [1,2,'x','y','z',3,4]\n     */\n    var insertAll = _curry3(function insertAll(idx, elts, list) {\n        idx = idx < list.length && idx >= 0 ? idx : list.length;\n        return _concat(_concat(_slice(list, 0, idx), elts), _slice(list, idx));\n    });\n\n    /**\n     * Creates a new list with the separator interposed between elements.\n     *\n     * Dispatches to the `intersperse` method of the second argument, if present.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.14.0\n     * @category List\n     * @sig a -> [a] -> [a]\n     * @param {*} separator The element to add to the list.\n     * @param {Array} list The list to be interposed.\n     * @return {Array} The new list.\n     * @example\n     *\n     *      R.intersperse('n', ['ba', 'a', 'a']); //=> ['ba', 'n', 'a', 'n', 'a']\n     */\n    var intersperse = _curry2(_checkForMethod('intersperse', function intersperse(separator, list) {\n        var out = [];\n        var idx = 0;\n        var length = list.length;\n        while (idx < length) {\n            if (idx === length - 1) {\n                out.push(list[idx]);\n            } else {\n                out.push(list[idx], separator);\n            }\n            idx += 1;\n        }\n        return out;\n    }));\n\n    /**\n     * See if an object (`val`) is an instance of the supplied constructor. This\n     * function will check up the inheritance chain, if any.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.3.0\n     * @category Type\n     * @sig (* -> {*}) -> a -> Boolean\n     * @param {Object} ctor A constructor\n     * @param {*} val The value to test\n     * @return {Boolean}\n     * @example\n     *\n     *      R.is(Object, {}); //=> true\n     *      R.is(Number, 1); //=> true\n     *      R.is(Object, 1); //=> false\n     *      R.is(String, 's'); //=> true\n     *      R.is(String, new String('')); //=> true\n     *      R.is(Object, new String('')); //=> true\n     *      R.is(Object, 's'); //=> false\n     *      R.is(Number, {}); //=> false\n     */\n    var is = _curry2(function is(Ctor, val) {\n        return val != null && val.constructor === Ctor || val instanceof Ctor;\n    });\n\n    /**\n     * Tests whether or not an object is similar to an array.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.5.0\n     * @category Type\n     * @category List\n     * @sig * -> Boolean\n     * @param {*} x The object to test.\n     * @return {Boolean} `true` if `x` has a numeric length property and extreme indices defined; `false` otherwise.\n     * @example\n     *\n     *      R.isArrayLike([]); //=> true\n     *      R.isArrayLike(true); //=> false\n     *      R.isArrayLike({}); //=> false\n     *      R.isArrayLike({length: 10}); //=> false\n     *      R.isArrayLike({0: 'zero', 9: 'nine', length: 10}); //=> true\n     */\n    var isArrayLike = _curry1(function isArrayLike(x) {\n        if (_isArray(x)) {\n            return true;\n        }\n        if (!x) {\n            return false;\n        }\n        if (typeof x !== 'object') {\n            return false;\n        }\n        if (x instanceof String) {\n            return false;\n        }\n        if (x.nodeType === 1) {\n            return !!x.length;\n        }\n        if (x.length === 0) {\n            return true;\n        }\n        if (x.length > 0) {\n            return x.hasOwnProperty(0) && x.hasOwnProperty(x.length - 1);\n        }\n        return false;\n    });\n\n    /**\n     * Checks if the input value is `null` or `undefined`.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.9.0\n     * @category Type\n     * @sig * -> Boolean\n     * @param {*} x The value to test.\n     * @return {Boolean} `true` if `x` is `undefined` or `null`, otherwise `false`.\n     * @example\n     *\n     *      R.isNil(null); //=> true\n     *      R.isNil(undefined); //=> true\n     *      R.isNil(0); //=> false\n     *      R.isNil([]); //=> false\n     */\n    var isNil = _curry1(function isNil(x) {\n        return x == null;\n    });\n\n    /**\n     * Returns a list containing the names of all the enumerable own properties of\n     * the supplied object.\n     * Note that the order of the output array is not guaranteed to be consistent\n     * across different JS platforms.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.1.0\n     * @category Object\n     * @sig {k: v} -> [k]\n     * @param {Object} obj The object to extract properties from\n     * @return {Array} An array of the object's own properties.\n     * @example\n     *\n     *      R.keys({a: 1, b: 2, c: 3}); //=> ['a', 'b', 'c']\n     */\n    // cover IE < 9 keys issues\n    // Safari bug\n    var keys = function () {\n        // cover IE < 9 keys issues\n        var hasEnumBug = !{ toString: null }.propertyIsEnumerable('toString');\n        var nonEnumerableProps = [\n            'constructor',\n            'valueOf',\n            'isPrototypeOf',\n            'toString',\n            'propertyIsEnumerable',\n            'hasOwnProperty',\n            'toLocaleString'\n        ];\n        // Safari bug\n        var hasArgsEnumBug = function () {\n            'use strict';\n            return arguments.propertyIsEnumerable('length');\n        }();\n        var contains = function contains(list, item) {\n            var idx = 0;\n            while (idx < list.length) {\n                if (list[idx] === item) {\n                    return true;\n                }\n                idx += 1;\n            }\n            return false;\n        };\n        return typeof Object.keys === 'function' && !hasArgsEnumBug ? _curry1(function keys(obj) {\n            return Object(obj) !== obj ? [] : Object.keys(obj);\n        }) : _curry1(function keys(obj) {\n            if (Object(obj) !== obj) {\n                return [];\n            }\n            var prop, nIdx;\n            var ks = [];\n            var checkArgsLength = hasArgsEnumBug && _isArguments(obj);\n            for (prop in obj) {\n                if (_has(prop, obj) && (!checkArgsLength || prop !== 'length')) {\n                    ks[ks.length] = prop;\n                }\n            }\n            if (hasEnumBug) {\n                nIdx = nonEnumerableProps.length - 1;\n                while (nIdx >= 0) {\n                    prop = nonEnumerableProps[nIdx];\n                    if (_has(prop, obj) && !contains(ks, prop)) {\n                        ks[ks.length] = prop;\n                    }\n                    nIdx -= 1;\n                }\n            }\n            return ks;\n        });\n    }();\n\n    /**\n     * Returns a list containing the names of all the properties of the supplied\n     * object, including prototype properties.\n     * Note that the order of the output array is not guaranteed to be consistent\n     * across different JS platforms.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.2.0\n     * @category Object\n     * @sig {k: v} -> [k]\n     * @param {Object} obj The object to extract properties from\n     * @return {Array} An array of the object's own and prototype properties.\n     * @example\n     *\n     *      var F = function() { this.x = 'X'; };\n     *      F.prototype.y = 'Y';\n     *      var f = new F();\n     *      R.keysIn(f); //=> ['x', 'y']\n     */\n    var keysIn = _curry1(function keysIn(obj) {\n        var prop;\n        var ks = [];\n        for (prop in obj) {\n            ks[ks.length] = prop;\n        }\n        return ks;\n    });\n\n    /**\n     * Returns the number of elements in the array by returning `list.length`.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.3.0\n     * @category List\n     * @sig [a] -> Number\n     * @param {Array} list The array to inspect.\n     * @return {Number} The length of the array.\n     * @example\n     *\n     *      R.length([]); //=> 0\n     *      R.length([1, 2, 3]); //=> 3\n     */\n    var length = _curry1(function length(list) {\n        return list != null && is(Number, list.length) ? list.length : NaN;\n    });\n\n    /**\n     * Returns `true` if the first argument is less than the second; `false`\n     * otherwise.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.1.0\n     * @category Relation\n     * @sig Ord a => a -> a -> Boolean\n     * @param {*} a\n     * @param {*} b\n     * @return {Boolean}\n     * @see R.gt\n     * @example\n     *\n     *      R.lt(2, 1); //=> false\n     *      R.lt(2, 2); //=> false\n     *      R.lt(2, 3); //=> true\n     *      R.lt('a', 'z'); //=> true\n     *      R.lt('z', 'a'); //=> false\n     */\n    var lt = _curry2(function lt(a, b) {\n        return a < b;\n    });\n\n    /**\n     * Returns `true` if the first argument is less than or equal to the second;\n     * `false` otherwise.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.1.0\n     * @category Relation\n     * @sig Ord a => a -> a -> Boolean\n     * @param {Number} a\n     * @param {Number} b\n     * @return {Boolean}\n     * @see R.gte\n     * @example\n     *\n     *      R.lte(2, 1); //=> false\n     *      R.lte(2, 2); //=> true\n     *      R.lte(2, 3); //=> true\n     *      R.lte('a', 'z'); //=> true\n     *      R.lte('z', 'a'); //=> false\n     */\n    var lte = _curry2(function lte(a, b) {\n        return a <= b;\n    });\n\n    /**\n     * The mapAccum function behaves like a combination of map and reduce; it\n     * applies a function to each element of a list, passing an accumulating\n     * parameter from left to right, and returning a final value of this\n     * accumulator together with the new list.\n     *\n     * The iterator function receives two arguments, *acc* and *value*, and should\n     * return a tuple *[acc, value]*.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.10.0\n     * @category List\n     * @sig (acc -> x -> (acc, y)) -> acc -> [x] -> (acc, [y])\n     * @param {Function} fn The function to be called on every element of the input `list`.\n     * @param {*} acc The accumulator value.\n     * @param {Array} list The list to iterate over.\n     * @return {*} The final, accumulated value.\n     * @see R.addIndex\n     * @example\n     *\n     *      var digits = ['1', '2', '3', '4'];\n     *      var appender = (a, b) => [a + b, a + b];\n     *\n     *      R.mapAccum(appender, 0, digits); //=> ['01234', ['01', '012', '0123', '01234']]\n     */\n    var mapAccum = _curry3(function mapAccum(fn, acc, list) {\n        var idx = 0;\n        var len = list.length;\n        var result = [];\n        var tuple = [acc];\n        while (idx < len) {\n            tuple = fn(tuple[0], list[idx]);\n            result[idx] = tuple[1];\n            idx += 1;\n        }\n        return [\n            tuple[0],\n            result\n        ];\n    });\n\n    /**\n     * The mapAccumRight function behaves like a combination of map and reduce; it\n     * applies a function to each element of a list, passing an accumulating\n     * parameter from right to left, and returning a final value of this\n     * accumulator together with the new list.\n     *\n     * Similar to `mapAccum`, except moves through the input list from the right to\n     * the left.\n     *\n     * The iterator function receives two arguments, *acc* and *value*, and should\n     * return a tuple *[acc, value]*.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.10.0\n     * @category List\n     * @sig (acc -> x -> (acc, y)) -> acc -> [x] -> (acc, [y])\n     * @param {Function} fn The function to be called on every element of the input `list`.\n     * @param {*} acc The accumulator value.\n     * @param {Array} list The list to iterate over.\n     * @return {*} The final, accumulated value.\n     * @see R.addIndex\n     * @example\n     *\n     *      var digits = ['1', '2', '3', '4'];\n     *      var append = (a, b) => [a + b, a + b];\n     *\n     *      R.mapAccumRight(append, 0, digits); //=> ['04321', ['04321', '0432', '043', '04']]\n     */\n    var mapAccumRight = _curry3(function mapAccumRight(fn, acc, list) {\n        var idx = list.length - 1;\n        var result = [];\n        var tuple = [acc];\n        while (idx >= 0) {\n            tuple = fn(tuple[0], list[idx]);\n            result[idx] = tuple[1];\n            idx -= 1;\n        }\n        return [\n            tuple[0],\n            result\n        ];\n    });\n\n    /**\n     * Tests a regular expression against a String. Note that this function will\n     * return an empty array when there are no matches. This differs from\n     * [`String.prototype.match`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/match)\n     * which returns `null` when there are no matches.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.1.0\n     * @category String\n     * @sig RegExp -> String -> [String | Undefined]\n     * @param {RegExp} rx A regular expression.\n     * @param {String} str The string to match against\n     * @return {Array} The list of matches or empty array.\n     * @see R.test\n     * @example\n     *\n     *      R.match(/([a-z]a)/g, 'bananas'); //=> ['ba', 'na', 'na']\n     *      R.match(/a/, 'b'); //=> []\n     *      R.match(/a/, null); //=> TypeError: null does not have a method named \"match\"\n     */\n    var match = _curry2(function match(rx, str) {\n        return str.match(rx) || [];\n    });\n\n    /**\n     * mathMod behaves like the modulo operator should mathematically, unlike the\n     * `%` operator (and by extension, R.modulo). So while \"-17 % 5\" is -2,\n     * mathMod(-17, 5) is 3. mathMod requires Integer arguments, and returns NaN\n     * when the modulus is zero or negative.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.3.0\n     * @category Math\n     * @sig Number -> Number -> Number\n     * @param {Number} m The dividend.\n     * @param {Number} p the modulus.\n     * @return {Number} The result of `b mod a`.\n     * @example\n     *\n     *      R.mathMod(-17, 5);  //=> 3\n     *      R.mathMod(17, 5);   //=> 2\n     *      R.mathMod(17, -5);  //=> NaN\n     *      R.mathMod(17, 0);   //=> NaN\n     *      R.mathMod(17.2, 5); //=> NaN\n     *      R.mathMod(17, 5.3); //=> NaN\n     *\n     *      var clock = R.mathMod(R.__, 12);\n     *      clock(15); //=> 3\n     *      clock(24); //=> 0\n     *\n     *      var seventeenMod = R.mathMod(17);\n     *      seventeenMod(3);  //=> 2\n     *      seventeenMod(4);  //=> 1\n     *      seventeenMod(10); //=> 7\n     */\n    var mathMod = _curry2(function mathMod(m, p) {\n        if (!_isInteger(m)) {\n            return NaN;\n        }\n        if (!_isInteger(p) || p < 1) {\n            return NaN;\n        }\n        return (m % p + p) % p;\n    });\n\n    /**\n     * Returns the larger of its two arguments.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.1.0\n     * @category Relation\n     * @sig Ord a => a -> a -> a\n     * @param {*} a\n     * @param {*} b\n     * @return {*}\n     * @see R.maxBy, R.min\n     * @example\n     *\n     *      R.max(789, 123); //=> 789\n     *      R.max('a', 'b'); //=> 'b'\n     */\n    var max = _curry2(function max(a, b) {\n        return b > a ? b : a;\n    });\n\n    /**\n     * Takes a function and two values, and returns whichever value produces the\n     * larger result when passed to the provided function.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.8.0\n     * @category Relation\n     * @sig Ord b => (a -> b) -> a -> a -> a\n     * @param {Function} f\n     * @param {*} a\n     * @param {*} b\n     * @return {*}\n     * @see R.max, R.minBy\n     * @example\n     *\n     *      //  square :: Number -> Number\n     *      var square = n => n * n;\n     *\n     *      R.maxBy(square, -3, 2); //=> -3\n     *\n     *      R.reduce(R.maxBy(square), 0, [3, -5, 4, 1, -2]); //=> -5\n     *      R.reduce(R.maxBy(square), 0, []); //=> 0\n     */\n    var maxBy = _curry3(function maxBy(f, a, b) {\n        return f(b) > f(a) ? b : a;\n    });\n\n    /**\n     * Create a new object with the own properties of the first object merged with\n     * the own properties of the second object. If a key exists in both objects,\n     * the value from the second object will be used.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.1.0\n     * @category Object\n     * @sig {k: v} -> {k: v} -> {k: v}\n     * @param {Object} l\n     * @param {Object} r\n     * @return {Object}\n     * @see R.mergeWith, R.mergeWithKey\n     * @example\n     *\n     *      R.merge({ 'name': 'fred', 'age': 10 }, { 'age': 40 });\n     *      //=> { 'name': 'fred', 'age': 40 }\n     *\n     *      var resetToDefault = R.merge(R.__, {x: 0});\n     *      resetToDefault({x: 5, y: 2}); //=> {x: 0, y: 2}\n     */\n    var merge = _curry2(function merge(l, r) {\n        return _assign({}, l, r);\n    });\n\n    /**\n     * Merges a list of objects together into one object.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.10.0\n     * @category List\n     * @sig [{k: v}] -> {k: v}\n     * @param {Array} list An array of objects\n     * @return {Object} A merged object.\n     * @see R.reduce\n     * @example\n     *\n     *      R.mergeAll([{foo:1},{bar:2},{baz:3}]); //=> {foo:1,bar:2,baz:3}\n     *      R.mergeAll([{foo:1},{foo:2},{bar:2}]); //=> {foo:2,bar:2}\n     */\n    var mergeAll = _curry1(function mergeAll(list) {\n        return _assign.apply(null, [{}].concat(list));\n    });\n\n    /**\n     * Creates a new object with the own properties of the two provided objects. If\n     * a key exists in both objects, the provided function is applied to the key\n     * and the values associated with the key in each object, with the result being\n     * used as the value associated with the key in the returned object. The key\n     * will be excluded from the returned object if the resulting value is\n     * `undefined`.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.19.0\n     * @category Object\n     * @sig (String -> a -> a -> a) -> {a} -> {a} -> {a}\n     * @param {Function} fn\n     * @param {Object} l\n     * @param {Object} r\n     * @return {Object}\n     * @see R.merge, R.mergeWith\n     * @example\n     *\n     *      let concatValues = (k, l, r) => k == 'values' ? R.concat(l, r) : r\n     *      R.mergeWithKey(concatValues,\n     *                     { a: true, thing: 'foo', values: [10, 20] },\n     *                     { b: true, thing: 'bar', values: [15, 35] });\n     *      //=> { a: true, b: true, thing: 'bar', values: [10, 20, 15, 35] }\n     */\n    var mergeWithKey = _curry3(function mergeWithKey(fn, l, r) {\n        var result = {};\n        var k;\n        for (k in l) {\n            if (_has(k, l)) {\n                result[k] = _has(k, r) ? fn(k, l[k], r[k]) : l[k];\n            }\n        }\n        for (k in r) {\n            if (_has(k, r) && !_has(k, result)) {\n                result[k] = r[k];\n            }\n        }\n        return result;\n    });\n\n    /**\n     * Returns the smaller of its two arguments.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.1.0\n     * @category Relation\n     * @sig Ord a => a -> a -> a\n     * @param {*} a\n     * @param {*} b\n     * @return {*}\n     * @see R.minBy, R.max\n     * @example\n     *\n     *      R.min(789, 123); //=> 123\n     *      R.min('a', 'b'); //=> 'a'\n     */\n    var min = _curry2(function min(a, b) {\n        return b < a ? b : a;\n    });\n\n    /**\n     * Takes a function and two values, and returns whichever value produces the\n     * smaller result when passed to the provided function.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.8.0\n     * @category Relation\n     * @sig Ord b => (a -> b) -> a -> a -> a\n     * @param {Function} f\n     * @param {*} a\n     * @param {*} b\n     * @return {*}\n     * @see R.min, R.maxBy\n     * @example\n     *\n     *      //  square :: Number -> Number\n     *      var square = n => n * n;\n     *\n     *      R.minBy(square, -3, 2); //=> 2\n     *\n     *      R.reduce(R.minBy(square), Infinity, [3, -5, 4, 1, -2]); //=> 1\n     *      R.reduce(R.minBy(square), Infinity, []); //=> Infinity\n     */\n    var minBy = _curry3(function minBy(f, a, b) {\n        return f(b) < f(a) ? b : a;\n    });\n\n    /**\n     * Divides the second parameter by the first and returns the remainder. Note\n     * that this function preserves the JavaScript-style behavior for modulo. For\n     * mathematical modulo see `mathMod`.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.1.1\n     * @category Math\n     * @sig Number -> Number -> Number\n     * @param {Number} a The value to the divide.\n     * @param {Number} b The pseudo-modulus\n     * @return {Number} The result of `b % a`.\n     * @see R.mathMod\n     * @example\n     *\n     *      R.modulo(17, 3); //=> 2\n     *      // JS behavior:\n     *      R.modulo(-17, 3); //=> -2\n     *      R.modulo(17, -3); //=> 2\n     *\n     *      var isOdd = R.modulo(R.__, 2);\n     *      isOdd(42); //=> 0\n     *      isOdd(21); //=> 1\n     */\n    var modulo = _curry2(function modulo(a, b) {\n        return a % b;\n    });\n\n    /**\n     * Multiplies two numbers. Equivalent to `a * b` but curried.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.1.0\n     * @category Math\n     * @sig Number -> Number -> Number\n     * @param {Number} a The first value.\n     * @param {Number} b The second value.\n     * @return {Number} The result of `a * b`.\n     * @see R.divide\n     * @example\n     *\n     *      var double = R.multiply(2);\n     *      var triple = R.multiply(3);\n     *      double(3);       //=>  6\n     *      triple(4);       //=> 12\n     *      R.multiply(2, 5);  //=> 10\n     */\n    var multiply = _curry2(function multiply(a, b) {\n        return a * b;\n    });\n\n    /**\n     * Wraps a function of any arity (including nullary) in a function that accepts\n     * exactly `n` parameters. Any extraneous parameters will not be passed to the\n     * supplied function.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.1.0\n     * @category Function\n     * @sig Number -> (* -> a) -> (* -> a)\n     * @param {Number} n The desired arity of the new function.\n     * @param {Function} fn The function to wrap.\n     * @return {Function} A new function wrapping `fn`. The new function is guaranteed to be of\n     *         arity `n`.\n     * @example\n     *\n     *      var takesTwoArgs = (a, b) => [a, b];\n     *\n     *      takesTwoArgs.length; //=> 2\n     *      takesTwoArgs(1, 2); //=> [1, 2]\n     *\n     *      var takesOneArg = R.nAry(1, takesTwoArgs);\n     *      takesOneArg.length; //=> 1\n     *      // Only `n` arguments are passed to the wrapped function\n     *      takesOneArg(1, 2); //=> [1, undefined]\n     */\n    var nAry = _curry2(function nAry(n, fn) {\n        switch (n) {\n        case 0:\n            return function () {\n                return fn.call(this);\n            };\n        case 1:\n            return function (a0) {\n                return fn.call(this, a0);\n            };\n        case 2:\n            return function (a0, a1) {\n                return fn.call(this, a0, a1);\n            };\n        case 3:\n            return function (a0, a1, a2) {\n                return fn.call(this, a0, a1, a2);\n            };\n        case 4:\n            return function (a0, a1, a2, a3) {\n                return fn.call(this, a0, a1, a2, a3);\n            };\n        case 5:\n            return function (a0, a1, a2, a3, a4) {\n                return fn.call(this, a0, a1, a2, a3, a4);\n            };\n        case 6:\n            return function (a0, a1, a2, a3, a4, a5) {\n                return fn.call(this, a0, a1, a2, a3, a4, a5);\n            };\n        case 7:\n            return function (a0, a1, a2, a3, a4, a5, a6) {\n                return fn.call(this, a0, a1, a2, a3, a4, a5, a6);\n            };\n        case 8:\n            return function (a0, a1, a2, a3, a4, a5, a6, a7) {\n                return fn.call(this, a0, a1, a2, a3, a4, a5, a6, a7);\n            };\n        case 9:\n            return function (a0, a1, a2, a3, a4, a5, a6, a7, a8) {\n                return fn.call(this, a0, a1, a2, a3, a4, a5, a6, a7, a8);\n            };\n        case 10:\n            return function (a0, a1, a2, a3, a4, a5, a6, a7, a8, a9) {\n                return fn.call(this, a0, a1, a2, a3, a4, a5, a6, a7, a8, a9);\n            };\n        default:\n            throw new Error('First argument to nAry must be a non-negative integer no greater than ten');\n        }\n    });\n\n    /**\n     * Negates its argument.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.9.0\n     * @category Math\n     * @sig Number -> Number\n     * @param {Number} n\n     * @return {Number}\n     * @example\n     *\n     *      R.negate(42); //=> -42\n     */\n    var negate = _curry1(function negate(n) {\n        return -n;\n    });\n\n    /**\n     * Returns `true` if no elements of the list match the predicate, `false`\n     * otherwise.\n     *\n     * Dispatches to the `any` method of the second argument, if present.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.12.0\n     * @category List\n     * @sig (a -> Boolean) -> [a] -> Boolean\n     * @param {Function} fn The predicate function.\n     * @param {Array} list The array to consider.\n     * @return {Boolean} `true` if the predicate is not satisfied by every element, `false` otherwise.\n     * @see R.all, R.any\n     * @example\n     *\n     *      var isEven = n => n % 2 === 0;\n     *\n     *      R.none(isEven, [1, 3, 5, 7, 9, 11]); //=> true\n     *      R.none(isEven, [1, 3, 5, 7, 8, 11]); //=> false\n     */\n    var none = _curry2(_complement(_dispatchable('any', _xany, any)));\n\n    /**\n     * A function that returns the `!` of its argument. It will return `true` when\n     * passed false-y value, and `false` when passed a truth-y one.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.1.0\n     * @category Logic\n     * @sig * -> Boolean\n     * @param {*} a any value\n     * @return {Boolean} the logical inverse of passed argument.\n     * @see R.complement\n     * @example\n     *\n     *      R.not(true); //=> false\n     *      R.not(false); //=> true\n     *      R.not(0); => true\n     *      R.not(1); => false\n     */\n    var not = _curry1(function not(a) {\n        return !a;\n    });\n\n    /**\n     * Returns the nth element of the given list or string. If n is negative the\n     * element at index length + n is returned.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.1.0\n     * @category List\n     * @sig Number -> [a] -> a | Undefined\n     * @sig Number -> String -> String\n     * @param {Number} offset\n     * @param {*} list\n     * @return {*}\n     * @example\n     *\n     *      var list = ['foo', 'bar', 'baz', 'quux'];\n     *      R.nth(1, list); //=> 'bar'\n     *      R.nth(-1, list); //=> 'quux'\n     *      R.nth(-99, list); //=> undefined\n     *\n     *      R.nth(2, 'abc'); //=> 'c'\n     *      R.nth(3, 'abc'); //=> ''\n     */\n    var nth = _curry2(function nth(offset, list) {\n        var idx = offset < 0 ? list.length + offset : offset;\n        return _isString(list) ? list.charAt(idx) : list[idx];\n    });\n\n    /**\n     * Returns a function which returns its nth argument.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.9.0\n     * @category Function\n     * @sig Number -> *... -> *\n     * @param {Number} n\n     * @return {Function}\n     * @example\n     *\n     *      R.nthArg(1)('a', 'b', 'c'); //=> 'b'\n     *      R.nthArg(-1)('a', 'b', 'c'); //=> 'c'\n     */\n    var nthArg = _curry1(function nthArg(n) {\n        return function () {\n            return nth(n, arguments);\n        };\n    });\n\n    /**\n     * Creates an object containing a single key:value pair.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.18.0\n     * @category Object\n     * @sig String -> a -> {String:a}\n     * @param {String} key\n     * @param {*} val\n     * @return {Object}\n     * @see R.pair\n     * @example\n     *\n     *      var matchPhrases = R.compose(\n     *        R.objOf('must'),\n     *        R.map(R.objOf('match_phrase'))\n     *      );\n     *      matchPhrases(['foo', 'bar', 'baz']); //=> {must: [{match_phrase: 'foo'}, {match_phrase: 'bar'}, {match_phrase: 'baz'}]}\n     */\n    var objOf = _curry2(function objOf(key, val) {\n        var obj = {};\n        obj[key] = val;\n        return obj;\n    });\n\n    /**\n     * Returns a singleton array containing the value provided.\n     *\n     * Note this `of` is different from the ES6 `of`; See\n     * https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/of\n     *\n     * @func\n     * @memberOf R\n     * @since v0.3.0\n     * @category Function\n     * @sig a -> [a]\n     * @param {*} x any value\n     * @return {Array} An array wrapping `x`.\n     * @example\n     *\n     *      R.of(null); //=> [null]\n     *      R.of([42]); //=> [[42]]\n     */\n    var of = _curry1(_of);\n\n    /**\n     * Accepts a function `fn` and returns a function that guards invocation of\n     * `fn` such that `fn` can only ever be called once, no matter how many times\n     * the returned function is invoked. The first value calculated is returned in\n     * subsequent invocations.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.1.0\n     * @category Function\n     * @sig (a... -> b) -> (a... -> b)\n     * @param {Function} fn The function to wrap in a call-only-once wrapper.\n     * @return {Function} The wrapped function.\n     * @example\n     *\n     *      var addOneOnce = R.once(x => x + 1);\n     *      addOneOnce(10); //=> 11\n     *      addOneOnce(addOneOnce(50)); //=> 11\n     */\n    var once = _curry1(function once(fn) {\n        var called = false;\n        var result;\n        return _arity(fn.length, function () {\n            if (called) {\n                return result;\n            }\n            called = true;\n            result = fn.apply(this, arguments);\n            return result;\n        });\n    });\n\n    /**\n     * Returns `true` if one or both of its arguments are `true`. Returns `false`\n     * if both arguments are `false`.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.1.0\n     * @category Logic\n     * @sig * -> * -> *\n     * @param {Boolean} a A boolean value\n     * @param {Boolean} b A boolean value\n     * @return {Boolean} `true` if one or both arguments are `true`, `false` otherwise\n     * @see R.either\n     * @example\n     *\n     *      R.or(true, true); //=> true\n     *      R.or(true, false); //=> true\n     *      R.or(false, true); //=> true\n     *      R.or(false, false); //=> false\n     */\n    var or = _curry2(function or(a, b) {\n        return a || b;\n    });\n\n    /**\n     * Returns the result of \"setting\" the portion of the given data structure\n     * focused by the given lens to the result of applying the given function to\n     * the focused value.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.16.0\n     * @category Object\n     * @typedefn Lens s a = Functor f => (a -> f a) -> s -> f s\n     * @sig Lens s a -> (a -> a) -> s -> s\n     * @param {Lens} lens\n     * @param {*} v\n     * @param {*} x\n     * @return {*}\n     * @see R.prop, R.lensIndex, R.lensProp\n     * @example\n     *\n     *      var headLens = R.lensIndex(0);\n     *\n     *      R.over(headLens, R.toUpper, ['foo', 'bar', 'baz']); //=> ['FOO', 'bar', 'baz']\n     */\n    // `Identity` is a functor that holds a single value, where `map` simply\n    // transforms the held value with the provided function.\n    // The value returned by the getter function is first transformed with `f`,\n    // then set as the value of an `Identity`. This is then mapped over with the\n    // setter function of the lens.\n    var over = function () {\n        // `Identity` is a functor that holds a single value, where `map` simply\n        // transforms the held value with the provided function.\n        var Identity = function (x) {\n            return {\n                value: x,\n                map: function (f) {\n                    return Identity(f(x));\n                }\n            };\n        };\n        return _curry3(function over(lens, f, x) {\n            // The value returned by the getter function is first transformed with `f`,\n            // then set as the value of an `Identity`. This is then mapped over with the\n            // setter function of the lens.\n            return lens(function (y) {\n                return Identity(f(y));\n            })(x).value;\n        });\n    }();\n\n    /**\n     * Takes two arguments, `fst` and `snd`, and returns `[fst, snd]`.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.18.0\n     * @category List\n     * @sig a -> b -> (a,b)\n     * @param {*} fst\n     * @param {*} snd\n     * @return {Array}\n     * @see R.objOf, R.of\n     * @example\n     *\n     *      R.pair('foo', 'bar'); //=> ['foo', 'bar']\n     */\n    var pair = _curry2(function pair(fst, snd) {\n        return [\n            fst,\n            snd\n        ];\n    });\n\n    /**\n     * Retrieve the value at a given path.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.2.0\n     * @category Object\n     * @sig [String] -> {k: v} -> v | Undefined\n     * @param {Array} path The path to use.\n     * @param {Object} obj The object to retrieve the nested property from.\n     * @return {*} The data at `path`.\n     * @example\n     *\n     *      R.path(['a', 'b'], {a: {b: 2}}); //=> 2\n     *      R.path(['a', 'b'], {c: {b: 2}}); //=> undefined\n     */\n    var path = _curry2(function path(paths, obj) {\n        var val = obj;\n        var idx = 0;\n        while (idx < paths.length) {\n            if (val == null) {\n                return;\n            }\n            val = val[paths[idx]];\n            idx += 1;\n        }\n        return val;\n    });\n\n    /**\n     * If the given, non-null object has a value at the given path, returns the\n     * value at that path. Otherwise returns the provided default value.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.18.0\n     * @category Object\n     * @sig a -> [String] -> Object -> a\n     * @param {*} d The default value.\n     * @param {Array} p The path to use.\n     * @param {Object} obj The object to retrieve the nested property from.\n     * @return {*} The data at `path` of the supplied object or the default value.\n     * @example\n     *\n     *      R.pathOr('N/A', ['a', 'b'], {a: {b: 2}}); //=> 2\n     *      R.pathOr('N/A', ['a', 'b'], {c: {b: 2}}); //=> \"N/A\"\n     */\n    var pathOr = _curry3(function pathOr(d, p, obj) {\n        return defaultTo(d, path(p, obj));\n    });\n\n    /**\n     * Returns `true` if the specified object property at given path satisfies the\n     * given predicate; `false` otherwise.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.19.0\n     * @category Logic\n     * @sig (a -> Boolean) -> [String] -> Object -> Boolean\n     * @param {Function} pred\n     * @param {Array} propPath\n     * @param {*} obj\n     * @return {Boolean}\n     * @see R.propSatisfies, R.path\n     * @example\n     *\n     *      R.pathSatisfies(y => y > 0, ['x', 'y'], {x: {y: 2}}); //=> true\n     */\n    var pathSatisfies = _curry3(function pathSatisfies(pred, propPath, obj) {\n        return propPath.length > 0 && pred(path(propPath, obj));\n    });\n\n    /**\n     * Returns a partial copy of an object containing only the keys specified. If\n     * the key does not exist, the property is ignored.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.1.0\n     * @category Object\n     * @sig [k] -> {k: v} -> {k: v}\n     * @param {Array} names an array of String property names to copy onto a new object\n     * @param {Object} obj The object to copy from\n     * @return {Object} A new object with only properties from `names` on it.\n     * @see R.omit, R.props\n     * @example\n     *\n     *      R.pick(['a', 'd'], {a: 1, b: 2, c: 3, d: 4}); //=> {a: 1, d: 4}\n     *      R.pick(['a', 'e', 'f'], {a: 1, b: 2, c: 3, d: 4}); //=> {a: 1}\n     */\n    var pick = _curry2(function pick(names, obj) {\n        var result = {};\n        var idx = 0;\n        while (idx < names.length) {\n            if (names[idx] in obj) {\n                result[names[idx]] = obj[names[idx]];\n            }\n            idx += 1;\n        }\n        return result;\n    });\n\n    /**\n     * Similar to `pick` except that this one includes a `key: undefined` pair for\n     * properties that don't exist.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.1.0\n     * @category Object\n     * @sig [k] -> {k: v} -> {k: v}\n     * @param {Array} names an array of String property names to copy onto a new object\n     * @param {Object} obj The object to copy from\n     * @return {Object} A new object with only properties from `names` on it.\n     * @see R.pick\n     * @example\n     *\n     *      R.pickAll(['a', 'd'], {a: 1, b: 2, c: 3, d: 4}); //=> {a: 1, d: 4}\n     *      R.pickAll(['a', 'e', 'f'], {a: 1, b: 2, c: 3, d: 4}); //=> {a: 1, e: undefined, f: undefined}\n     */\n    var pickAll = _curry2(function pickAll(names, obj) {\n        var result = {};\n        var idx = 0;\n        var len = names.length;\n        while (idx < len) {\n            var name = names[idx];\n            result[name] = obj[name];\n            idx += 1;\n        }\n        return result;\n    });\n\n    /**\n     * Returns a partial copy of an object containing only the keys that satisfy\n     * the supplied predicate.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.8.0\n     * @category Object\n     * @sig (v, k -> Boolean) -> {k: v} -> {k: v}\n     * @param {Function} pred A predicate to determine whether or not a key\n     *        should be included on the output object.\n     * @param {Object} obj The object to copy from\n     * @return {Object} A new object with only properties that satisfy `pred`\n     *         on it.\n     * @see R.pick, R.filter\n     * @example\n     *\n     *      var isUpperCase = (val, key) => key.toUpperCase() === key;\n     *      R.pickBy(isUpperCase, {a: 1, b: 2, A: 3, B: 4}); //=> {A: 3, B: 4}\n     */\n    var pickBy = _curry2(function pickBy(test, obj) {\n        var result = {};\n        for (var prop in obj) {\n            if (test(obj[prop], prop, obj)) {\n                result[prop] = obj[prop];\n            }\n        }\n        return result;\n    });\n\n    /**\n     * Returns a new list with the given element at the front, followed by the\n     * contents of the list.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.1.0\n     * @category List\n     * @sig a -> [a] -> [a]\n     * @param {*} el The item to add to the head of the output list.\n     * @param {Array} list The array to add to the tail of the output list.\n     * @return {Array} A new array.\n     * @see R.append\n     * @example\n     *\n     *      R.prepend('fee', ['fi', 'fo', 'fum']); //=> ['fee', 'fi', 'fo', 'fum']\n     */\n    var prepend = _curry2(function prepend(el, list) {\n        return _concat([el], list);\n    });\n\n    /**\n     * Returns a function that when supplied an object returns the indicated\n     * property of that object, if it exists.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.1.0\n     * @category Object\n     * @sig s -> {s: a} -> a | Undefined\n     * @param {String} p The property name\n     * @param {Object} obj The object to query\n     * @return {*} The value at `obj.p`.\n     * @example\n     *\n     *      R.prop('x', {x: 100}); //=> 100\n     *      R.prop('x', {}); //=> undefined\n     */\n    var prop = _curry2(function prop(p, obj) {\n        return obj[p];\n    });\n\n    /**\n     * If the given, non-null object has an own property with the specified name,\n     * returns the value of that property. Otherwise returns the provided default\n     * value.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.6.0\n     * @category Object\n     * @sig a -> String -> Object -> a\n     * @param {*} val The default value.\n     * @param {String} p The name of the property to return.\n     * @param {Object} obj The object to query.\n     * @return {*} The value of given property of the supplied object or the default value.\n     * @example\n     *\n     *      var alice = {\n     *        name: 'ALICE',\n     *        age: 101\n     *      };\n     *      var favorite = R.prop('favoriteLibrary');\n     *      var favoriteWithDefault = R.propOr('Ramda', 'favoriteLibrary');\n     *\n     *      favorite(alice);  //=> undefined\n     *      favoriteWithDefault(alice);  //=> 'Ramda'\n     */\n    var propOr = _curry3(function propOr(val, p, obj) {\n        return obj != null && _has(p, obj) ? obj[p] : val;\n    });\n\n    /**\n     * Returns `true` if the specified object property satisfies the given\n     * predicate; `false` otherwise.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.16.0\n     * @category Logic\n     * @sig (a -> Boolean) -> String -> {String: a} -> Boolean\n     * @param {Function} pred\n     * @param {String} name\n     * @param {*} obj\n     * @return {Boolean}\n     * @see R.propEq, R.propIs\n     * @example\n     *\n     *      R.propSatisfies(x => x > 0, 'x', {x: 1, y: 2}); //=> true\n     */\n    var propSatisfies = _curry3(function propSatisfies(pred, name, obj) {\n        return pred(obj[name]);\n    });\n\n    /**\n     * Acts as multiple `prop`: array of keys in, array of values out. Preserves\n     * order.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.1.0\n     * @category Object\n     * @sig [k] -> {k: v} -> [v]\n     * @param {Array} ps The property names to fetch\n     * @param {Object} obj The object to query\n     * @return {Array} The corresponding values or partially applied function.\n     * @example\n     *\n     *      R.props(['x', 'y'], {x: 1, y: 2}); //=> [1, 2]\n     *      R.props(['c', 'a', 'b'], {b: 2, a: 1}); //=> [undefined, 1, 2]\n     *\n     *      var fullName = R.compose(R.join(' '), R.props(['first', 'last']));\n     *      fullName({last: 'Bullet-Tooth', age: 33, first: 'Tony'}); //=> 'Tony Bullet-Tooth'\n     */\n    var props = _curry2(function props(ps, obj) {\n        var len = ps.length;\n        var out = [];\n        var idx = 0;\n        while (idx < len) {\n            out[idx] = obj[ps[idx]];\n            idx += 1;\n        }\n        return out;\n    });\n\n    /**\n     * Returns a list of numbers from `from` (inclusive) to `to` (exclusive).\n     *\n     * @func\n     * @memberOf R\n     * @since v0.1.0\n     * @category List\n     * @sig Number -> Number -> [Number]\n     * @param {Number} from The first number in the list.\n     * @param {Number} to One more than the last number in the list.\n     * @return {Array} The list of numbers in tthe set `[a, b)`.\n     * @example\n     *\n     *      R.range(1, 5);    //=> [1, 2, 3, 4]\n     *      R.range(50, 53);  //=> [50, 51, 52]\n     */\n    var range = _curry2(function range(from, to) {\n        if (!(_isNumber(from) && _isNumber(to))) {\n            throw new TypeError('Both arguments to range must be numbers');\n        }\n        var result = [];\n        var n = from;\n        while (n < to) {\n            result.push(n);\n            n += 1;\n        }\n        return result;\n    });\n\n    /**\n     * Returns a single item by iterating through the list, successively calling\n     * the iterator function and passing it an accumulator value and the current\n     * value from the array, and then passing the result to the next call.\n     *\n     * Similar to `reduce`, except moves through the input list from the right to\n     * the left.\n     *\n     * The iterator function receives two values: *(acc, value)*\n     *\n     * Note: `R.reduceRight` does not skip deleted or unassigned indices (sparse\n     * arrays), unlike the native `Array.prototype.reduce` method. For more details\n     * on this behavior, see:\n     * https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/reduceRight#Description\n     *\n     * @func\n     * @memberOf R\n     * @since v0.1.0\n     * @category List\n     * @sig (a,b -> a) -> a -> [b] -> a\n     * @param {Function} fn The iterator function. Receives two values, the accumulator and the\n     *        current element from the array.\n     * @param {*} acc The accumulator value.\n     * @param {Array} list The list to iterate over.\n     * @return {*} The final, accumulated value.\n     * @see R.addIndex\n     * @example\n     *\n     *      var pairs = [ ['a', 1], ['b', 2], ['c', 3] ];\n     *      var flattenPairs = (acc, pair) => acc.concat(pair);\n     *\n     *      R.reduceRight(flattenPairs, [], pairs); //=> [ 'c', 3, 'b', 2, 'a', 1 ]\n     */\n    var reduceRight = _curry3(function reduceRight(fn, acc, list) {\n        var idx = list.length - 1;\n        while (idx >= 0) {\n            acc = fn(acc, list[idx]);\n            idx -= 1;\n        }\n        return acc;\n    });\n\n    /**\n     * Returns a value wrapped to indicate that it is the final value of the reduce\n     * and transduce functions. The returned value should be considered a black\n     * box: the internal structure is not guaranteed to be stable.\n     *\n     * Note: this optimization is unavailable to functions not explicitly listed\n     * above. For instance, it is not currently supported by reduceRight.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.15.0\n     * @category List\n     * @sig a -> *\n     * @param {*} x The final value of the reduce.\n     * @return {*} The wrapped value.\n     * @see R.reduce, R.transduce\n     * @example\n     *\n     *      R.reduce(\n     *        R.pipe(R.add, R.when(R.gte(R.__, 10), R.reduced)),\n     *        0,\n     *        [1, 2, 3, 4, 5]) // 10\n     */\n    var reduced = _curry1(_reduced);\n\n    /**\n     * Removes the sub-list of `list` starting at index `start` and containing\n     * `count` elements. _Note that this is not destructive_: it returns a copy of\n     * the list with the changes.\n     * <small>No lists have been harmed in the application of this function.</small>\n     *\n     * @func\n     * @memberOf R\n     * @since v0.2.2\n     * @category List\n     * @sig Number -> Number -> [a] -> [a]\n     * @param {Number} start The position to start removing elements\n     * @param {Number} count The number of elements to remove\n     * @param {Array} list The list to remove from\n     * @return {Array} A new Array with `count` elements from `start` removed.\n     * @example\n     *\n     *      R.remove(2, 3, [1,2,3,4,5,6,7,8]); //=> [1,2,6,7,8]\n     */\n    var remove = _curry3(function remove(start, count, list) {\n        return _concat(_slice(list, 0, Math.min(start, list.length)), _slice(list, Math.min(list.length, start + count)));\n    });\n\n    /**\n     * Replace a substring or regex match in a string with a replacement.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.7.0\n     * @category String\n     * @sig RegExp|String -> String -> String -> String\n     * @param {RegExp|String} pattern A regular expression or a substring to match.\n     * @param {String} replacement The string to replace the matches with.\n     * @param {String} str The String to do the search and replacement in.\n     * @return {String} The result.\n     * @example\n     *\n     *      R.replace('foo', 'bar', 'foo foo foo'); //=> 'bar foo foo'\n     *      R.replace(/foo/, 'bar', 'foo foo foo'); //=> 'bar foo foo'\n     *\n     *      // Use the \"g\" (global) flag to replace all occurrences:\n     *      R.replace(/foo/g, 'bar', 'foo foo foo'); //=> 'bar bar bar'\n     */\n    var replace = _curry3(function replace(regex, replacement, str) {\n        return str.replace(regex, replacement);\n    });\n\n    /**\n     * Returns a new list or string with the elements or characters in reverse\n     * order.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.1.0\n     * @category List\n     * @sig [a] -> [a]\n     * @sig String -> String\n     * @param {Array|String} list\n     * @return {Array|String}\n     * @example\n     *\n     *      R.reverse([1, 2, 3]);  //=> [3, 2, 1]\n     *      R.reverse([1, 2]);     //=> [2, 1]\n     *      R.reverse([1]);        //=> [1]\n     *      R.reverse([]);         //=> []\n     *\n     *      R.reverse('abc');      //=> 'cba'\n     *      R.reverse('ab');       //=> 'ba'\n     *      R.reverse('a');        //=> 'a'\n     *      R.reverse('');         //=> ''\n     */\n    var reverse = _curry1(function reverse(list) {\n        return _isString(list) ? list.split('').reverse().join('') : _slice(list).reverse();\n    });\n\n    /**\n     * Scan is similar to reduce, but returns a list of successively reduced values\n     * from the left\n     *\n     * @func\n     * @memberOf R\n     * @since v0.10.0\n     * @category List\n     * @sig (a,b -> a) -> a -> [b] -> [a]\n     * @param {Function} fn The iterator function. Receives two values, the accumulator and the\n     *        current element from the array\n     * @param {*} acc The accumulator value.\n     * @param {Array} list The list to iterate over.\n     * @return {Array} A list of all intermediately reduced values.\n     * @example\n     *\n     *      var numbers = [1, 2, 3, 4];\n     *      var factorials = R.scan(R.multiply, 1, numbers); //=> [1, 1, 2, 6, 24]\n     */\n    var scan = _curry3(function scan(fn, acc, list) {\n        var idx = 0;\n        var len = list.length;\n        var result = [acc];\n        while (idx < len) {\n            acc = fn(acc, list[idx]);\n            result[idx + 1] = acc;\n            idx += 1;\n        }\n        return result;\n    });\n\n    /**\n     * Returns the result of \"setting\" the portion of the given data structure\n     * focused by the given lens to the given value.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.16.0\n     * @category Object\n     * @typedefn Lens s a = Functor f => (a -> f a) -> s -> f s\n     * @sig Lens s a -> a -> s -> s\n     * @param {Lens} lens\n     * @param {*} v\n     * @param {*} x\n     * @return {*}\n     * @see R.prop, R.lensIndex, R.lensProp\n     * @example\n     *\n     *      var xLens = R.lensProp('x');\n     *\n     *      R.set(xLens, 4, {x: 1, y: 2});  //=> {x: 4, y: 2}\n     *      R.set(xLens, 8, {x: 1, y: 2});  //=> {x: 8, y: 2}\n     */\n    var set = _curry3(function set(lens, v, x) {\n        return over(lens, always(v), x);\n    });\n\n    /**\n     * Returns the elements of the given list or string (or object with a `slice`\n     * method) from `fromIndex` (inclusive) to `toIndex` (exclusive).\n     *\n     * Dispatches to the `slice` method of the third argument, if present.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.1.4\n     * @category List\n     * @sig Number -> Number -> [a] -> [a]\n     * @sig Number -> Number -> String -> String\n     * @param {Number} fromIndex The start index (inclusive).\n     * @param {Number} toIndex The end index (exclusive).\n     * @param {*} list\n     * @return {*}\n     * @example\n     *\n     *      R.slice(1, 3, ['a', 'b', 'c', 'd']);        //=> ['b', 'c']\n     *      R.slice(1, Infinity, ['a', 'b', 'c', 'd']); //=> ['b', 'c', 'd']\n     *      R.slice(0, -1, ['a', 'b', 'c', 'd']);       //=> ['a', 'b', 'c']\n     *      R.slice(-3, -1, ['a', 'b', 'c', 'd']);      //=> ['b', 'c']\n     *      R.slice(0, 3, 'ramda');                     //=> 'ram'\n     */\n    var slice = _curry3(_checkForMethod('slice', function slice(fromIndex, toIndex, list) {\n        return Array.prototype.slice.call(list, fromIndex, toIndex);\n    }));\n\n    /**\n     * Returns a copy of the list, sorted according to the comparator function,\n     * which should accept two values at a time and return a negative number if the\n     * first value is smaller, a positive number if it's larger, and zero if they\n     * are equal. Please note that this is a **copy** of the list. It does not\n     * modify the original.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.1.0\n     * @category List\n     * @sig (a,a -> Number) -> [a] -> [a]\n     * @param {Function} comparator A sorting function :: a -> b -> Int\n     * @param {Array} list The list to sort\n     * @return {Array} a new array with its elements sorted by the comparator function.\n     * @example\n     *\n     *      var diff = function(a, b) { return a - b; };\n     *      R.sort(diff, [4,2,7,5]); //=> [2, 4, 5, 7]\n     */\n    var sort = _curry2(function sort(comparator, list) {\n        return _slice(list).sort(comparator);\n    });\n\n    /**\n     * Sorts the list according to the supplied function.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.1.0\n     * @category Relation\n     * @sig Ord b => (a -> b) -> [a] -> [a]\n     * @param {Function} fn\n     * @param {Array} list The list to sort.\n     * @return {Array} A new list sorted by the keys generated by `fn`.\n     * @example\n     *\n     *      var sortByFirstItem = R.sortBy(R.prop(0));\n     *      var sortByNameCaseInsensitive = R.sortBy(R.compose(R.toLower, R.prop('name')));\n     *      var pairs = [[-1, 1], [-2, 2], [-3, 3]];\n     *      sortByFirstItem(pairs); //=> [[-3, 3], [-2, 2], [-1, 1]]\n     *      var alice = {\n     *        name: 'ALICE',\n     *        age: 101\n     *      };\n     *      var bob = {\n     *        name: 'Bob',\n     *        age: -10\n     *      };\n     *      var clara = {\n     *        name: 'clara',\n     *        age: 314.159\n     *      };\n     *      var people = [clara, bob, alice];\n     *      sortByNameCaseInsensitive(people); //=> [alice, bob, clara]\n     */\n    var sortBy = _curry2(function sortBy(fn, list) {\n        return _slice(list).sort(function (a, b) {\n            var aa = fn(a);\n            var bb = fn(b);\n            return aa < bb ? -1 : aa > bb ? 1 : 0;\n        });\n    });\n\n    /**\n     * Splits a given list or string at a given index.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.19.0\n     * @category List\n     * @sig Number -> [a] -> [[a], [a]]\n     * @sig Number -> String -> [String, String]\n     * @param {Number} index The index where the array/string is split.\n     * @param {Array|String} array The array/string to be split.\n     * @return {Array}\n     * @example\n     *\n     *      R.splitAt(1, [1, 2, 3]);          //=> [[1], [2, 3]]\n     *      R.splitAt(5, 'hello world');      //=> ['hello', ' world']\n     *      R.splitAt(-1, 'foobar');          //=> ['fooba', 'r']\n     */\n    var splitAt = _curry2(function splitAt(index, array) {\n        return [\n            slice(0, index, array),\n            slice(index, length(array), array)\n        ];\n    });\n\n    /**\n     * Splits a collection into slices of the specified length.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.16.0\n     * @category List\n     * @sig Number -> [a] -> [[a]]\n     * @sig Number -> String -> [String]\n     * @param {Number} n\n     * @param {Array} list\n     * @return {Array}\n     * @example\n     *\n     *      R.splitEvery(3, [1, 2, 3, 4, 5, 6, 7]); //=> [[1, 2, 3], [4, 5, 6], [7]]\n     *      R.splitEvery(3, 'foobarbaz'); //=> ['foo', 'bar', 'baz']\n     */\n    var splitEvery = _curry2(function splitEvery(n, list) {\n        if (n <= 0) {\n            throw new Error('First argument to splitEvery must be a positive integer');\n        }\n        var result = [];\n        var idx = 0;\n        while (idx < list.length) {\n            result.push(slice(idx, idx += n, list));\n        }\n        return result;\n    });\n\n    /**\n     * Takes a list and a predicate and returns a pair of lists with the following properties:\n     *\n     *  - the result of concatenating the two output lists is equivalent to the input list;\n     *  - none of the elements of the first output list satisfies the predicate; and\n     *  - if the second output list is non-empty, its first element satisfies the predicate.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.19.0\n     * @category List\n     * @sig (a -> Boolean) -> [a] -> [[a], [a]]\n     * @param {Function} pred The predicate that determines where the array is split.\n     * @param {Array} list The array to be split.\n     * @return {Array}\n     * @example\n     *\n     *      R.splitWhen(R.equals(2), [1, 2, 3, 1, 2, 3]);   //=> [[1], [2, 3, 1, 2, 3]]\n     */\n    var splitWhen = _curry2(function splitWhen(pred, list) {\n        var idx = 0;\n        var len = list.length;\n        var prefix = [];\n        while (idx < len && !pred(list[idx])) {\n            prefix.push(list[idx]);\n            idx += 1;\n        }\n        return [\n            prefix,\n            _slice(list, idx)\n        ];\n    });\n\n    /**\n     * Subtracts its second argument from its first argument.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.1.0\n     * @category Math\n     * @sig Number -> Number -> Number\n     * @param {Number} a The first value.\n     * @param {Number} b The second value.\n     * @return {Number} The result of `a - b`.\n     * @see R.add\n     * @example\n     *\n     *      R.subtract(10, 8); //=> 2\n     *\n     *      var minus5 = R.subtract(R.__, 5);\n     *      minus5(17); //=> 12\n     *\n     *      var complementaryAngle = R.subtract(90);\n     *      complementaryAngle(30); //=> 60\n     *      complementaryAngle(72); //=> 18\n     */\n    var subtract = _curry2(function subtract(a, b) {\n        return Number(a) - Number(b);\n    });\n\n    /**\n     * Returns all but the first element of the given list or string (or object\n     * with a `tail` method).\n     *\n     * Dispatches to the `slice` method of the first argument, if present.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.1.0\n     * @category List\n     * @sig [a] -> [a]\n     * @sig String -> String\n     * @param {*} list\n     * @return {*}\n     * @see R.head, R.init, R.last\n     * @example\n     *\n     *      R.tail([1, 2, 3]);  //=> [2, 3]\n     *      R.tail([1, 2]);     //=> [2]\n     *      R.tail([1]);        //=> []\n     *      R.tail([]);         //=> []\n     *\n     *      R.tail('abc');  //=> 'bc'\n     *      R.tail('ab');   //=> 'b'\n     *      R.tail('a');    //=> ''\n     *      R.tail('');     //=> ''\n     */\n    var tail = _checkForMethod('tail', slice(1, Infinity));\n\n    /**\n     * Returns the first `n` elements of the given list, string, or\n     * transducer/transformer (or object with a `take` method).\n     *\n     * Dispatches to the `take` method of the second argument, if present.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.1.0\n     * @category List\n     * @sig Number -> [a] -> [a]\n     * @sig Number -> String -> String\n     * @param {Number} n\n     * @param {*} list\n     * @return {*}\n     * @see R.drop\n     * @example\n     *\n     *      R.take(1, ['foo', 'bar', 'baz']); //=> ['foo']\n     *      R.take(2, ['foo', 'bar', 'baz']); //=> ['foo', 'bar']\n     *      R.take(3, ['foo', 'bar', 'baz']); //=> ['foo', 'bar', 'baz']\n     *      R.take(4, ['foo', 'bar', 'baz']); //=> ['foo', 'bar', 'baz']\n     *      R.take(3, 'ramda');               //=> 'ram'\n     *\n     *      var personnel = [\n     *        'Dave Brubeck',\n     *        'Paul Desmond',\n     *        'Eugene Wright',\n     *        'Joe Morello',\n     *        'Gerry Mulligan',\n     *        'Bob Bates',\n     *        'Joe Dodge',\n     *        'Ron Crotty'\n     *      ];\n     *\n     *      var takeFive = R.take(5);\n     *      takeFive(personnel);\n     *      //=> ['Dave Brubeck', 'Paul Desmond', 'Eugene Wright', 'Joe Morello', 'Gerry Mulligan']\n     */\n    var take = _curry2(_dispatchable('take', _xtake, function take(n, xs) {\n        return slice(0, n < 0 ? Infinity : n, xs);\n    }));\n\n    /**\n     * Returns a new list containing the last `n` elements of a given list, passing\n     * each value to the supplied predicate function, and terminating when the\n     * predicate function returns `false`. Excludes the element that caused the\n     * predicate function to fail. The predicate function is passed one argument:\n     * *(value)*.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.16.0\n     * @category List\n     * @sig (a -> Boolean) -> [a] -> [a]\n     * @param {Function} fn The function called per iteration.\n     * @param {Array} list The collection to iterate over.\n     * @return {Array} A new array.\n     * @see R.dropLastWhile, R.addIndex\n     * @example\n     *\n     *      var isNotOne = x => x !== 1;\n     *\n     *      R.takeLastWhile(isNotOne, [1, 2, 3, 4]); //=> [2, 3, 4]\n     */\n    var takeLastWhile = _curry2(function takeLastWhile(fn, list) {\n        var idx = list.length - 1;\n        while (idx >= 0 && fn(list[idx])) {\n            idx -= 1;\n        }\n        return _slice(list, idx + 1, Infinity);\n    });\n\n    /**\n     * Returns a new list containing the first `n` elements of a given list,\n     * passing each value to the supplied predicate function, and terminating when\n     * the predicate function returns `false`. Excludes the element that caused the\n     * predicate function to fail. The predicate function is passed one argument:\n     * *(value)*.\n     *\n     * Dispatches to the `takeWhile` method of the second argument, if present.\n     *\n     * Acts as a transducer if a transformer is given in list position.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.1.0\n     * @category List\n     * @sig (a -> Boolean) -> [a] -> [a]\n     * @param {Function} fn The function called per iteration.\n     * @param {Array} list The collection to iterate over.\n     * @return {Array} A new array.\n     * @see R.dropWhile, R.transduce, R.addIndex\n     * @example\n     *\n     *      var isNotFour = x => x !== 4;\n     *\n     *      R.takeWhile(isNotFour, [1, 2, 3, 4, 3, 2, 1]); //=> [1, 2, 3]\n     */\n    var takeWhile = _curry2(_dispatchable('takeWhile', _xtakeWhile, function takeWhile(fn, list) {\n        var idx = 0;\n        var len = list.length;\n        while (idx < len && fn(list[idx])) {\n            idx += 1;\n        }\n        return _slice(list, 0, idx);\n    }));\n\n    /**\n     * Runs the given function with the supplied object, then returns the object.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.1.0\n     * @category Function\n     * @sig (a -> *) -> a -> a\n     * @param {Function} fn The function to call with `x`. The return value of `fn` will be thrown away.\n     * @param {*} x\n     * @return {*} `x`.\n     * @example\n     *\n     *      var sayX = x => console.log('x is ' + x);\n     *      R.tap(sayX, 100); //=> 100\n     *      //-> 'x is 100'\n     */\n    var tap = _curry2(function tap(fn, x) {\n        fn(x);\n        return x;\n    });\n\n    /**\n     * Calls an input function `n` times, returning an array containing the results\n     * of those function calls.\n     *\n     * `fn` is passed one argument: The current value of `n`, which begins at `0`\n     * and is gradually incremented to `n - 1`.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.2.3\n     * @category List\n     * @sig (Number -> a) -> Number -> [a]\n     * @param {Function} fn The function to invoke. Passed one argument, the current value of `n`.\n     * @param {Number} n A value between `0` and `n - 1`. Increments after each function call.\n     * @return {Array} An array containing the return values of all calls to `fn`.\n     * @example\n     *\n     *      R.times(R.identity, 5); //=> [0, 1, 2, 3, 4]\n     */\n    var times = _curry2(function times(fn, n) {\n        var len = Number(n);\n        var idx = 0;\n        var list;\n        if (len < 0 || isNaN(len)) {\n            throw new RangeError('n must be a non-negative number');\n        }\n        list = new Array(len);\n        while (idx < len) {\n            list[idx] = fn(idx);\n            idx += 1;\n        }\n        return list;\n    });\n\n    /**\n     * Converts an object into an array of key, value arrays. Only the object's\n     * own properties are used.\n     * Note that the order of the output array is not guaranteed to be consistent\n     * across different JS platforms.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.4.0\n     * @category Object\n     * @sig {String: *} -> [[String,*]]\n     * @param {Object} obj The object to extract from\n     * @return {Array} An array of key, value arrays from the object's own properties.\n     * @see R.fromPairs\n     * @example\n     *\n     *      R.toPairs({a: 1, b: 2, c: 3}); //=> [['a', 1], ['b', 2], ['c', 3]]\n     */\n    var toPairs = _curry1(function toPairs(obj) {\n        var pairs = [];\n        for (var prop in obj) {\n            if (_has(prop, obj)) {\n                pairs[pairs.length] = [\n                    prop,\n                    obj[prop]\n                ];\n            }\n        }\n        return pairs;\n    });\n\n    /**\n     * Converts an object into an array of key, value arrays. The object's own\n     * properties and prototype properties are used. Note that the order of the\n     * output array is not guaranteed to be consistent across different JS\n     * platforms.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.4.0\n     * @category Object\n     * @sig {String: *} -> [[String,*]]\n     * @param {Object} obj The object to extract from\n     * @return {Array} An array of key, value arrays from the object's own\n     *         and prototype properties.\n     * @example\n     *\n     *      var F = function() { this.x = 'X'; };\n     *      F.prototype.y = 'Y';\n     *      var f = new F();\n     *      R.toPairsIn(f); //=> [['x','X'], ['y','Y']]\n     */\n    var toPairsIn = _curry1(function toPairsIn(obj) {\n        var pairs = [];\n        for (var prop in obj) {\n            pairs[pairs.length] = [\n                prop,\n                obj[prop]\n            ];\n        }\n        return pairs;\n    });\n\n    /**\n     * Transposes the rows and columns of a 2D list.\n     * When passed a list of `n` lists of length `x`,\n     * returns a list of `x` lists of length `n`.\n     *\n     *\n     * @func\n     * @memberOf R\n     * @since v0.19.0\n     * @category List\n     * @sig [[a]] -> [[a]]\n     * @param {Array} list A 2D list\n     * @return {Array} A 2D list\n     * @example\n     *\n     *      R.transpose([[1, 'a'], [2, 'b'], [3, 'c']]) //=> [[1, 2, 3], ['a', 'b', 'c']]\n     *      R.transpose([[1, 2, 3], ['a', 'b', 'c']]) //=> [[1, 'a'], [2, 'b'], [3, 'c']]\n     *\n     * If some of the rows are shorter than the following rows, their elements are skipped:\n     *\n     *      R.transpose([[10, 11], [20], [], [30, 31, 32]]) //=> [[10, 20, 30], [11, 31], [32]]\n     */\n    var transpose = _curry1(function transpose(outerlist) {\n        var i = 0;\n        var result = [];\n        while (i < outerlist.length) {\n            var innerlist = outerlist[i];\n            var j = 0;\n            while (j < innerlist.length) {\n                if (typeof result[j] === 'undefined') {\n                    result[j] = [];\n                }\n                result[j].push(innerlist[j]);\n                j += 1;\n            }\n            i += 1;\n        }\n        return result;\n    });\n\n    /**\n     * Removes (strips) whitespace from both ends of the string.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.6.0\n     * @category String\n     * @sig String -> String\n     * @param {String} str The string to trim.\n     * @return {String} Trimmed version of `str`.\n     * @example\n     *\n     *      R.trim('   xyz  '); //=> 'xyz'\n     *      R.map(R.trim, R.split(',', 'x, y, z')); //=> ['x', 'y', 'z']\n     */\n    var trim = function () {\n        var ws = '\\t\\n\\x0B\\f\\r \\xA0\\u1680\\u180E\\u2000\\u2001\\u2002\\u2003' + '\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200A\\u202F\\u205F\\u3000\\u2028' + '\\u2029\\uFEFF';\n        var zeroWidth = '\\u200B';\n        var hasProtoTrim = typeof String.prototype.trim === 'function';\n        if (!hasProtoTrim || (ws.trim() || !zeroWidth.trim())) {\n            return _curry1(function trim(str) {\n                var beginRx = new RegExp('^[' + ws + '][' + ws + ']*');\n                var endRx = new RegExp('[' + ws + '][' + ws + ']*$');\n                return str.replace(beginRx, '').replace(endRx, '');\n            });\n        } else {\n            return _curry1(function trim(str) {\n                return str.trim();\n            });\n        }\n    }();\n\n    /**\n     * `tryCatch` takes two functions, a `tryer` and a `catcher`. The returned\n     * function evaluates the `tryer`; if it does not throw, it simply returns the\n     * result. If the `tryer` *does* throw, the returned function evaluates the\n     * `catcher` function and returns its result. Note that for effective\n     * composition with this function, both the `tryer` and `catcher` functions\n     * must return the same type of results.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.20.0\n     * @category Function\n     * @sig (...x -> a) -> ((e, ...x) -> a) -> (...x -> a)\n     * @param {Function} tryer The function that may throw.\n     * @param {Function} catcher The function that will be evaluated if `tryer` throws.\n     * @return {Function} A new function that will catch exceptions and send then to the catcher.\n     * @example\n     *\n     *      R.tryCatch(R.prop('x'), R.F, {x: true}); //=> true\n     *      R.tryCatch(R.prop('x'), R.F, null);      //=> false\n     */\n    var tryCatch = _curry2(function _tryCatch(tryer, catcher) {\n        return _arity(tryer.length, function () {\n            try {\n                return tryer.apply(this, arguments);\n            } catch (e) {\n                return catcher.apply(this, _concat([e], arguments));\n            }\n        });\n    });\n\n    /**\n     * Gives a single-word string description of the (native) type of a value,\n     * returning such answers as 'Object', 'Number', 'Array', or 'Null'. Does not\n     * attempt to distinguish user Object types any further, reporting them all as\n     * 'Object'.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.8.0\n     * @category Type\n     * @sig (* -> {*}) -> String\n     * @param {*} val The value to test\n     * @return {String}\n     * @example\n     *\n     *      R.type({}); //=> \"Object\"\n     *      R.type(1); //=> \"Number\"\n     *      R.type(false); //=> \"Boolean\"\n     *      R.type('s'); //=> \"String\"\n     *      R.type(null); //=> \"Null\"\n     *      R.type([]); //=> \"Array\"\n     *      R.type(/[A-z]/); //=> \"RegExp\"\n     */\n    var type = _curry1(function type(val) {\n        return val === null ? 'Null' : val === undefined ? 'Undefined' : Object.prototype.toString.call(val).slice(8, -1);\n    });\n\n    /**\n     * Takes a function `fn`, which takes a single array argument, and returns a\n     * function which:\n     *\n     *   - takes any number of positional arguments;\n     *   - passes these arguments to `fn` as an array; and\n     *   - returns the result.\n     *\n     * In other words, R.unapply derives a variadic function from a function which\n     * takes an array. R.unapply is the inverse of R.apply.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.8.0\n     * @category Function\n     * @sig ([*...] -> a) -> (*... -> a)\n     * @param {Function} fn\n     * @return {Function}\n     * @see R.apply\n     * @example\n     *\n     *      R.unapply(JSON.stringify)(1, 2, 3); //=> '[1,2,3]'\n     */\n    var unapply = _curry1(function unapply(fn) {\n        return function () {\n            return fn(_slice(arguments));\n        };\n    });\n\n    /**\n     * Wraps a function of any arity (including nullary) in a function that accepts\n     * exactly 1 parameter. Any extraneous parameters will not be passed to the\n     * supplied function.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.2.0\n     * @category Function\n     * @sig (* -> b) -> (a -> b)\n     * @param {Function} fn The function to wrap.\n     * @return {Function} A new function wrapping `fn`. The new function is guaranteed to be of\n     *         arity 1.\n     * @example\n     *\n     *      var takesTwoArgs = function(a, b) {\n     *        return [a, b];\n     *      };\n     *      takesTwoArgs.length; //=> 2\n     *      takesTwoArgs(1, 2); //=> [1, 2]\n     *\n     *      var takesOneArg = R.unary(takesTwoArgs);\n     *      takesOneArg.length; //=> 1\n     *      // Only 1 argument is passed to the wrapped function\n     *      takesOneArg(1, 2); //=> [1, undefined]\n     */\n    var unary = _curry1(function unary(fn) {\n        return nAry(1, fn);\n    });\n\n    /**\n     * Returns a function of arity `n` from a (manually) curried function.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.14.0\n     * @category Function\n     * @sig Number -> (a -> b) -> (a -> c)\n     * @param {Number} length The arity for the returned function.\n     * @param {Function} fn The function to uncurry.\n     * @return {Function} A new function.\n     * @see R.curry\n     * @example\n     *\n     *      var addFour = a => b => c => d => a + b + c + d;\n     *\n     *      var uncurriedAddFour = R.uncurryN(4, addFour);\n     *      uncurriedAddFour(1, 2, 3, 4); //=> 10\n     */\n    var uncurryN = _curry2(function uncurryN(depth, fn) {\n        return curryN(depth, function () {\n            var currentDepth = 1;\n            var value = fn;\n            var idx = 0;\n            var endIdx;\n            while (currentDepth <= depth && typeof value === 'function') {\n                endIdx = currentDepth === depth ? arguments.length : idx + value.length;\n                value = value.apply(this, _slice(arguments, idx, endIdx));\n                currentDepth += 1;\n                idx = endIdx;\n            }\n            return value;\n        });\n    });\n\n    /**\n     * Builds a list from a seed value. Accepts an iterator function, which returns\n     * either false to stop iteration or an array of length 2 containing the value\n     * to add to the resulting list and the seed to be used in the next call to the\n     * iterator function.\n     *\n     * The iterator function receives one argument: *(seed)*.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.10.0\n     * @category List\n     * @sig (a -> [b]) -> * -> [b]\n     * @param {Function} fn The iterator function. receives one argument, `seed`, and returns\n     *        either false to quit iteration or an array of length two to proceed. The element\n     *        at index 0 of this array will be added to the resulting array, and the element\n     *        at index 1 will be passed to the next call to `fn`.\n     * @param {*} seed The seed value.\n     * @return {Array} The final list.\n     * @example\n     *\n     *      var f = n => n > 50 ? false : [-n, n + 10];\n     *      R.unfold(f, 10); //=> [-10, -20, -30, -40, -50]\n     */\n    var unfold = _curry2(function unfold(fn, seed) {\n        var pair = fn(seed);\n        var result = [];\n        while (pair && pair.length) {\n            result[result.length] = pair[0];\n            pair = fn(pair[1]);\n        }\n        return result;\n    });\n\n    /**\n     * Returns a new list containing only one copy of each element in the original\n     * list, based upon the value returned by applying the supplied predicate to\n     * two list elements. Prefers the first item if two items compare equal based\n     * on the predicate.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.2.0\n     * @category List\n     * @sig (a, a -> Boolean) -> [a] -> [a]\n     * @param {Function} pred A predicate used to test whether two items are equal.\n     * @param {Array} list The array to consider.\n     * @return {Array} The list of unique items.\n     * @example\n     *\n     *      var strEq = R.eqBy(String);\n     *      R.uniqWith(strEq)([1, '1', 2, 1]); //=> [1, 2]\n     *      R.uniqWith(strEq)([{}, {}]);       //=> [{}]\n     *      R.uniqWith(strEq)([1, '1', 1]);    //=> [1]\n     *      R.uniqWith(strEq)(['1', 1, 1]);    //=> ['1']\n     */\n    var uniqWith = _curry2(function uniqWith(pred, list) {\n        var idx = 0;\n        var len = list.length;\n        var result = [];\n        var item;\n        while (idx < len) {\n            item = list[idx];\n            if (!_containsWith(pred, item, result)) {\n                result[result.length] = item;\n            }\n            idx += 1;\n        }\n        return result;\n    });\n\n    /**\n     * Tests the final argument by passing it to the given predicate function. If\n     * the predicate is not satisfied, the function will return the result of\n     * calling the `whenFalseFn` function with the same argument. If the predicate\n     * is satisfied, the argument is returned as is.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.18.0\n     * @category Logic\n     * @sig (a -> Boolean) -> (a -> a) -> a -> a\n     * @param {Function} pred        A predicate function\n     * @param {Function} whenFalseFn A function to invoke when the `pred` evaluates\n     *                               to a falsy value.\n     * @param {*}        x           An object to test with the `pred` function and\n     *                               pass to `whenFalseFn` if necessary.\n     * @return {*} Either `x` or the result of applying `x` to `whenFalseFn`.\n     * @see R.ifElse, R.when\n     * @example\n     *\n     *      // coerceArray :: (a|[a]) -> [a]\n     *      var coerceArray = R.unless(R.isArrayLike, R.of);\n     *      coerceArray([1, 2, 3]); //=> [1, 2, 3]\n     *      coerceArray(1);         //=> [1]\n     */\n    var unless = _curry3(function unless(pred, whenFalseFn, x) {\n        return pred(x) ? x : whenFalseFn(x);\n    });\n\n    /**\n     * Takes a predicate, a transformation function, and an initial value,\n     * and returns a value of the same type as the initial value.\n     * It does so by applying the transformation until the predicate is satisfied,\n     * at which point it returns the satisfactory value.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.20.0\n     * @category Logic\n     * @sig (a -> Boolean) -> (a -> a) -> a -> a\n     * @param {Function} pred A predicate function\n     * @param {Function} fn The iterator function\n     * @param {*} init Initial value\n     * @return {*} Final value that satisfies predicate\n     * @example\n     *\n     *      R.until(R.gt(R.__, 100), R.multiply(2))(1) // => 128\n     */\n    var until = _curry3(function until(pred, fn, init) {\n        var val = init;\n        while (!pred(val)) {\n            val = fn(val);\n        }\n        return val;\n    });\n\n    /**\n     * Returns a new copy of the array with the element at the provided index\n     * replaced with the given value.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.14.0\n     * @category List\n     * @sig Number -> a -> [a] -> [a]\n     * @param {Number} idx The index to update.\n     * @param {*} x The value to exist at the given index of the returned array.\n     * @param {Array|Arguments} list The source array-like object to be updated.\n     * @return {Array} A copy of `list` with the value at index `idx` replaced with `x`.\n     * @see R.adjust\n     * @example\n     *\n     *      R.update(1, 11, [0, 1, 2]);     //=> [0, 11, 2]\n     *      R.update(1)(11)([0, 1, 2]);     //=> [0, 11, 2]\n     */\n    var update = _curry3(function update(idx, x, list) {\n        return adjust(always(x), idx, list);\n    });\n\n    /**\n     * Accepts a function `fn` and a list of transformer functions and returns a\n     * new curried function. When the new function is invoked, it calls the\n     * function `fn` with parameters consisting of the result of calling each\n     * supplied handler on successive arguments to the new function.\n     *\n     * If more arguments are passed to the returned function than transformer\n     * functions, those arguments are passed directly to `fn` as additional\n     * parameters. If you expect additional arguments that don't need to be\n     * transformed, although you can ignore them, it's best to pass an identity\n     * function so that the new function reports the correct arity.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.1.0\n     * @category Function\n     * @sig (x1 -> x2 -> ... -> z) -> [(a -> x1), (b -> x2), ...] -> (a -> b -> ... -> z)\n     * @param {Function} fn The function to wrap.\n     * @param {Array} transformers A list of transformer functions\n     * @return {Function} The wrapped function.\n     * @example\n     *\n     *      R.useWith(Math.pow, [R.identity, R.identity])(3, 4); //=> 81\n     *      R.useWith(Math.pow, [R.identity, R.identity])(3)(4); //=> 81\n     *      R.useWith(Math.pow, [R.dec, R.inc])(3, 4); //=> 32\n     *      R.useWith(Math.pow, [R.dec, R.inc])(3)(4); //=> 32\n     */\n    var useWith = _curry2(function useWith(fn, transformers) {\n        return curryN(transformers.length, function () {\n            var args = [];\n            var idx = 0;\n            while (idx < transformers.length) {\n                args.push(transformers[idx].call(this, arguments[idx]));\n                idx += 1;\n            }\n            return fn.apply(this, args.concat(_slice(arguments, transformers.length)));\n        });\n    });\n\n    /**\n     * Returns a list of all the enumerable own properties of the supplied object.\n     * Note that the order of the output array is not guaranteed across different\n     * JS platforms.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.1.0\n     * @category Object\n     * @sig {k: v} -> [v]\n     * @param {Object} obj The object to extract values from\n     * @return {Array} An array of the values of the object's own properties.\n     * @example\n     *\n     *      R.values({a: 1, b: 2, c: 3}); //=> [1, 2, 3]\n     */\n    var values = _curry1(function values(obj) {\n        var props = keys(obj);\n        var len = props.length;\n        var vals = [];\n        var idx = 0;\n        while (idx < len) {\n            vals[idx] = obj[props[idx]];\n            idx += 1;\n        }\n        return vals;\n    });\n\n    /**\n     * Returns a list of all the properties, including prototype properties, of the\n     * supplied object.\n     * Note that the order of the output array is not guaranteed to be consistent\n     * across different JS platforms.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.2.0\n     * @category Object\n     * @sig {k: v} -> [v]\n     * @param {Object} obj The object to extract values from\n     * @return {Array} An array of the values of the object's own and prototype properties.\n     * @example\n     *\n     *      var F = function() { this.x = 'X'; };\n     *      F.prototype.y = 'Y';\n     *      var f = new F();\n     *      R.valuesIn(f); //=> ['X', 'Y']\n     */\n    var valuesIn = _curry1(function valuesIn(obj) {\n        var prop;\n        var vs = [];\n        for (prop in obj) {\n            vs[vs.length] = obj[prop];\n        }\n        return vs;\n    });\n\n    /**\n     * Returns a \"view\" of the given data structure, determined by the given lens.\n     * The lens's focus determines which portion of the data structure is visible.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.16.0\n     * @category Object\n     * @typedefn Lens s a = Functor f => (a -> f a) -> s -> f s\n     * @sig Lens s a -> s -> a\n     * @param {Lens} lens\n     * @param {*} x\n     * @return {*}\n     * @see R.prop, R.lensIndex, R.lensProp\n     * @example\n     *\n     *      var xLens = R.lensProp('x');\n     *\n     *      R.view(xLens, {x: 1, y: 2});  //=> 1\n     *      R.view(xLens, {x: 4, y: 2});  //=> 4\n     */\n    // `Const` is a functor that effectively ignores the function given to `map`.\n    // Using `Const` effectively ignores the setter function of the `lens`,\n    // leaving the value returned by the getter function unmodified.\n    var view = function () {\n        // `Const` is a functor that effectively ignores the function given to `map`.\n        var Const = function (x) {\n            return {\n                value: x,\n                map: function () {\n                    return this;\n                }\n            };\n        };\n        return _curry2(function view(lens, x) {\n            // Using `Const` effectively ignores the setter function of the `lens`,\n            // leaving the value returned by the getter function unmodified.\n            return lens(Const)(x).value;\n        });\n    }();\n\n    /**\n     * Tests the final argument by passing it to the given predicate function. If\n     * the predicate is satisfied, the function will return the result of calling\n     * the `whenTrueFn` function with the same argument. If the predicate is not\n     * satisfied, the argument is returned as is.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.18.0\n     * @category Logic\n     * @sig (a -> Boolean) -> (a -> a) -> a -> a\n     * @param {Function} pred       A predicate function\n     * @param {Function} whenTrueFn A function to invoke when the `condition`\n     *                              evaluates to a truthy value.\n     * @param {*}        x          An object to test with the `pred` function and\n     *                              pass to `whenTrueFn` if necessary.\n     * @return {*} Either `x` or the result of applying `x` to `whenTrueFn`.\n     * @see R.ifElse, R.unless\n     * @example\n     *\n     *      // truncate :: String -> String\n     *      var truncate = R.when(\n     *        R.propSatisfies(R.gt(R.__, 10), 'length'),\n     *        R.pipe(R.take(10), R.append('…'), R.join(''))\n     *      );\n     *      truncate('12345');         //=> '12345'\n     *      truncate('0123456789ABC'); //=> '0123456789…'\n     */\n    var when = _curry3(function when(pred, whenTrueFn, x) {\n        return pred(x) ? whenTrueFn(x) : x;\n    });\n\n    /**\n     * Takes a spec object and a test object; returns true if the test satisfies\n     * the spec. Each of the spec's own properties must be a predicate function.\n     * Each predicate is applied to the value of the corresponding property of the\n     * test object. `where` returns true if all the predicates return true, false\n     * otherwise.\n     *\n     * `where` is well suited to declaratively expressing constraints for other\n     * functions such as `filter` and `find`.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.1.1\n     * @category Object\n     * @sig {String: (* -> Boolean)} -> {String: *} -> Boolean\n     * @param {Object} spec\n     * @param {Object} testObj\n     * @return {Boolean}\n     * @example\n     *\n     *      // pred :: Object -> Boolean\n     *      var pred = R.where({\n     *        a: R.equals('foo'),\n     *        b: R.complement(R.equals('bar')),\n     *        x: R.gt(_, 10),\n     *        y: R.lt(_, 20)\n     *      });\n     *\n     *      pred({a: 'foo', b: 'xxx', x: 11, y: 19}); //=> true\n     *      pred({a: 'xxx', b: 'xxx', x: 11, y: 19}); //=> false\n     *      pred({a: 'foo', b: 'bar', x: 11, y: 19}); //=> false\n     *      pred({a: 'foo', b: 'xxx', x: 10, y: 19}); //=> false\n     *      pred({a: 'foo', b: 'xxx', x: 11, y: 20}); //=> false\n     */\n    var where = _curry2(function where(spec, testObj) {\n        for (var prop in spec) {\n            if (_has(prop, spec) && !spec[prop](testObj[prop])) {\n                return false;\n            }\n        }\n        return true;\n    });\n\n    /**\n     * Wrap a function inside another to allow you to make adjustments to the\n     * parameters, or do other processing either before the internal function is\n     * called or with its results.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.1.0\n     * @category Function\n     * @sig (a... -> b) -> ((a... -> b) -> a... -> c) -> (a... -> c)\n     * @param {Function} fn The function to wrap.\n     * @param {Function} wrapper The wrapper function.\n     * @return {Function} The wrapped function.\n     * @example\n     *\n     *      var greet = name => 'Hello ' + name;\n     *\n     *      var shoutedGreet = R.wrap(greet, (gr, name) => gr(name).toUpperCase());\n     *\n     *      shoutedGreet(\"Kathy\"); //=> \"HELLO KATHY\"\n     *\n     *      var shortenedGreet = R.wrap(greet, function(gr, name) {\n     *        return gr(name.substring(0, 3));\n     *      });\n     *      shortenedGreet(\"Robert\"); //=> \"Hello Rob\"\n     */\n    var wrap = _curry2(function wrap(fn, wrapper) {\n        return curryN(fn.length, function () {\n            return wrapper.apply(this, _concat([fn], arguments));\n        });\n    });\n\n    /**\n     * Creates a new list out of the two supplied by creating each possible pair\n     * from the lists.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.1.0\n     * @category List\n     * @sig [a] -> [b] -> [[a,b]]\n     * @param {Array} as The first list.\n     * @param {Array} bs The second list.\n     * @return {Array} The list made by combining each possible pair from\n     *         `as` and `bs` into pairs (`[a, b]`).\n     * @example\n     *\n     *      R.xprod([1, 2], ['a', 'b']); //=> [[1, 'a'], [1, 'b'], [2, 'a'], [2, 'b']]\n     */\n    // = xprodWith(prepend); (takes about 3 times as long...)\n    var xprod = _curry2(function xprod(a, b) {\n        // = xprodWith(prepend); (takes about 3 times as long...)\n        var idx = 0;\n        var ilen = a.length;\n        var j;\n        var jlen = b.length;\n        var result = [];\n        while (idx < ilen) {\n            j = 0;\n            while (j < jlen) {\n                result[result.length] = [\n                    a[idx],\n                    b[j]\n                ];\n                j += 1;\n            }\n            idx += 1;\n        }\n        return result;\n    });\n\n    /**\n     * Creates a new list out of the two supplied by pairing up equally-positioned\n     * items from both lists. The returned list is truncated to the length of the\n     * shorter of the two input lists.\n     * Note: `zip` is equivalent to `zipWith(function(a, b) { return [a, b] })`.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.1.0\n     * @category List\n     * @sig [a] -> [b] -> [[a,b]]\n     * @param {Array} list1 The first array to consider.\n     * @param {Array} list2 The second array to consider.\n     * @return {Array} The list made by pairing up same-indexed elements of `list1` and `list2`.\n     * @example\n     *\n     *      R.zip([1, 2, 3], ['a', 'b', 'c']); //=> [[1, 'a'], [2, 'b'], [3, 'c']]\n     */\n    var zip = _curry2(function zip(a, b) {\n        var rv = [];\n        var idx = 0;\n        var len = Math.min(a.length, b.length);\n        while (idx < len) {\n            rv[idx] = [\n                a[idx],\n                b[idx]\n            ];\n            idx += 1;\n        }\n        return rv;\n    });\n\n    /**\n     * Creates a new object out of a list of keys and a list of values.\n     * Key/value pairing is truncated to the length of the shorter of the two lists.\n     * Note: `zipObj` is equivalent to `pipe(zipWith(pair), fromPairs)`.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.3.0\n     * @category List\n     * @sig [String] -> [*] -> {String: *}\n     * @param {Array} keys The array that will be properties on the output object.\n     * @param {Array} values The list of values on the output object.\n     * @return {Object} The object made by pairing up same-indexed elements of `keys` and `values`.\n     * @example\n     *\n     *      R.zipObj(['a', 'b', 'c'], [1, 2, 3]); //=> {a: 1, b: 2, c: 3}\n     */\n    var zipObj = _curry2(function zipObj(keys, values) {\n        var idx = 0;\n        var len = Math.min(keys.length, values.length);\n        var out = {};\n        while (idx < len) {\n            out[keys[idx]] = values[idx];\n            idx += 1;\n        }\n        return out;\n    });\n\n    /**\n     * Creates a new list out of the two supplied by applying the function to each\n     * equally-positioned pair in the lists. The returned list is truncated to the\n     * length of the shorter of the two input lists.\n     *\n     * @function\n     * @memberOf R\n     * @since v0.1.0\n     * @category List\n     * @sig (a,b -> c) -> [a] -> [b] -> [c]\n     * @param {Function} fn The function used to combine the two elements into one value.\n     * @param {Array} list1 The first array to consider.\n     * @param {Array} list2 The second array to consider.\n     * @return {Array} The list made by combining same-indexed elements of `list1` and `list2`\n     *         using `fn`.\n     * @example\n     *\n     *      var f = (x, y) => {\n     *        // ...\n     *      };\n     *      R.zipWith(f, [1, 2, 3], ['a', 'b', 'c']);\n     *      //=> [f(1, 'a'), f(2, 'b'), f(3, 'c')]\n     */\n    var zipWith = _curry3(function zipWith(fn, a, b) {\n        var rv = [];\n        var idx = 0;\n        var len = Math.min(a.length, b.length);\n        while (idx < len) {\n            rv[idx] = fn(a[idx], b[idx]);\n            idx += 1;\n        }\n        return rv;\n    });\n\n    /**\n     * A function that always returns `false`. Any passed in parameters are ignored.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.9.0\n     * @category Function\n     * @sig * -> Boolean\n     * @param {*}\n     * @return {Boolean}\n     * @see R.always, R.T\n     * @example\n     *\n     *      R.F(); //=> false\n     */\n    var F = always(false);\n\n    /**\n     * A function that always returns `true`. Any passed in parameters are ignored.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.9.0\n     * @category Function\n     * @sig * -> Boolean\n     * @param {*}\n     * @return {Boolean}\n     * @see R.always, R.F\n     * @example\n     *\n     *      R.T(); //=> true\n     */\n    var T = always(true);\n\n    /**\n     * Copies an object.\n     *\n     * @private\n     * @param {*} value The value to be copied\n     * @param {Array} refFrom Array containing the source references\n     * @param {Array} refTo Array containing the copied source references\n     * @param {Boolean} deep Whether or not to perform deep cloning.\n     * @return {*} The copied value.\n     */\n    var _clone = function _clone(value, refFrom, refTo, deep) {\n        var copy = function copy(copiedValue) {\n            var len = refFrom.length;\n            var idx = 0;\n            while (idx < len) {\n                if (value === refFrom[idx]) {\n                    return refTo[idx];\n                }\n                idx += 1;\n            }\n            refFrom[idx + 1] = value;\n            refTo[idx + 1] = copiedValue;\n            for (var key in value) {\n                copiedValue[key] = deep ? _clone(value[key], refFrom, refTo, true) : value[key];\n            }\n            return copiedValue;\n        };\n        switch (type(value)) {\n        case 'Object':\n            return copy({});\n        case 'Array':\n            return copy([]);\n        case 'Date':\n            return new Date(value.valueOf());\n        case 'RegExp':\n            return _cloneRegExp(value);\n        default:\n            return value;\n        }\n    };\n\n    var _createPartialApplicator = function _createPartialApplicator(concat) {\n        return _curry2(function (fn, args) {\n            return _arity(Math.max(0, fn.length - args.length), function () {\n                return fn.apply(this, concat(args, arguments));\n            });\n        });\n    };\n\n    var _dropLast = function dropLast(n, xs) {\n        return take(n < xs.length ? xs.length - n : 0, xs);\n    };\n\n    // Values of other types are only equal if identical.\n    var _equals = function _equals(a, b, stackA, stackB) {\n        if (identical(a, b)) {\n            return true;\n        }\n        if (type(a) !== type(b)) {\n            return false;\n        }\n        if (a == null || b == null) {\n            return false;\n        }\n        if (typeof a.equals === 'function' || typeof b.equals === 'function') {\n            return typeof a.equals === 'function' && a.equals(b) && typeof b.equals === 'function' && b.equals(a);\n        }\n        switch (type(a)) {\n        case 'Arguments':\n        case 'Array':\n        case 'Object':\n            if (typeof a.constructor === 'function' && _functionName(a.constructor) === 'Promise') {\n                return a === b;\n            }\n            break;\n        case 'Boolean':\n        case 'Number':\n        case 'String':\n            if (!(typeof a === typeof b && identical(a.valueOf(), b.valueOf()))) {\n                return false;\n            }\n            break;\n        case 'Date':\n            if (!identical(a.valueOf(), b.valueOf())) {\n                return false;\n            }\n            break;\n        case 'Error':\n            return a.name === b.name && a.message === b.message;\n        case 'RegExp':\n            if (!(a.source === b.source && a.global === b.global && a.ignoreCase === b.ignoreCase && a.multiline === b.multiline && a.sticky === b.sticky && a.unicode === b.unicode)) {\n                return false;\n            }\n            break;\n        case 'Map':\n        case 'Set':\n            if (!_equals(_arrayFromIterator(a.entries()), _arrayFromIterator(b.entries()), stackA, stackB)) {\n                return false;\n            }\n            break;\n        case 'Int8Array':\n        case 'Uint8Array':\n        case 'Uint8ClampedArray':\n        case 'Int16Array':\n        case 'Uint16Array':\n        case 'Int32Array':\n        case 'Uint32Array':\n        case 'Float32Array':\n        case 'Float64Array':\n            break;\n        case 'ArrayBuffer':\n            break;\n        default:\n            // Values of other types are only equal if identical.\n            return false;\n        }\n        var keysA = keys(a);\n        if (keysA.length !== keys(b).length) {\n            return false;\n        }\n        var idx = stackA.length - 1;\n        while (idx >= 0) {\n            if (stackA[idx] === a) {\n                return stackB[idx] === b;\n            }\n            idx -= 1;\n        }\n        stackA.push(a);\n        stackB.push(b);\n        idx = keysA.length - 1;\n        while (idx >= 0) {\n            var key = keysA[idx];\n            if (!(_has(key, b) && _equals(b[key], a[key], stackA, stackB))) {\n                return false;\n            }\n            idx -= 1;\n        }\n        stackA.pop();\n        stackB.pop();\n        return true;\n    };\n\n    /**\n     * `_makeFlat` is a helper function that returns a one-level or fully recursive\n     * function based on the flag passed in.\n     *\n     * @private\n     */\n    var _makeFlat = function _makeFlat(recursive) {\n        return function flatt(list) {\n            var value, jlen, j;\n            var result = [];\n            var idx = 0;\n            var ilen = list.length;\n            while (idx < ilen) {\n                if (isArrayLike(list[idx])) {\n                    value = recursive ? flatt(list[idx]) : list[idx];\n                    j = 0;\n                    jlen = value.length;\n                    while (j < jlen) {\n                        result[result.length] = value[j];\n                        j += 1;\n                    }\n                } else {\n                    result[result.length] = list[idx];\n                }\n                idx += 1;\n            }\n            return result;\n        };\n    };\n\n    var _reduce = function () {\n        function _arrayReduce(xf, acc, list) {\n            var idx = 0;\n            var len = list.length;\n            while (idx < len) {\n                acc = xf['@@transducer/step'](acc, list[idx]);\n                if (acc && acc['@@transducer/reduced']) {\n                    acc = acc['@@transducer/value'];\n                    break;\n                }\n                idx += 1;\n            }\n            return xf['@@transducer/result'](acc);\n        }\n        function _iterableReduce(xf, acc, iter) {\n            var step = iter.next();\n            while (!step.done) {\n                acc = xf['@@transducer/step'](acc, step.value);\n                if (acc && acc['@@transducer/reduced']) {\n                    acc = acc['@@transducer/value'];\n                    break;\n                }\n                step = iter.next();\n            }\n            return xf['@@transducer/result'](acc);\n        }\n        function _methodReduce(xf, acc, obj) {\n            return xf['@@transducer/result'](obj.reduce(bind(xf['@@transducer/step'], xf), acc));\n        }\n        var symIterator = typeof Symbol !== 'undefined' ? Symbol.iterator : '@@iterator';\n        return function _reduce(fn, acc, list) {\n            if (typeof fn === 'function') {\n                fn = _xwrap(fn);\n            }\n            if (isArrayLike(list)) {\n                return _arrayReduce(fn, acc, list);\n            }\n            if (typeof list.reduce === 'function') {\n                return _methodReduce(fn, acc, list);\n            }\n            if (list[symIterator] != null) {\n                return _iterableReduce(fn, acc, list[symIterator]());\n            }\n            if (typeof list.next === 'function') {\n                return _iterableReduce(fn, acc, list);\n            }\n            throw new TypeError('reduce: list must be array or iterable');\n        };\n    }();\n\n    var _stepCat = function () {\n        var _stepCatArray = {\n            '@@transducer/init': Array,\n            '@@transducer/step': function (xs, x) {\n                xs.push(x);\n                return xs;\n            },\n            '@@transducer/result': _identity\n        };\n        var _stepCatString = {\n            '@@transducer/init': String,\n            '@@transducer/step': function (a, b) {\n                return a + b;\n            },\n            '@@transducer/result': _identity\n        };\n        var _stepCatObject = {\n            '@@transducer/init': Object,\n            '@@transducer/step': function (result, input) {\n                return _assign(result, isArrayLike(input) ? objOf(input[0], input[1]) : input);\n            },\n            '@@transducer/result': _identity\n        };\n        return function _stepCat(obj) {\n            if (_isTransformer(obj)) {\n                return obj;\n            }\n            if (isArrayLike(obj)) {\n                return _stepCatArray;\n            }\n            if (typeof obj === 'string') {\n                return _stepCatString;\n            }\n            if (typeof obj === 'object') {\n                return _stepCatObject;\n            }\n            throw new Error('Cannot create transformer for ' + obj);\n        };\n    }();\n\n    var _xdropLastWhile = function () {\n        function XDropLastWhile(fn, xf) {\n            this.f = fn;\n            this.retained = [];\n            this.xf = xf;\n        }\n        XDropLastWhile.prototype['@@transducer/init'] = _xfBase.init;\n        XDropLastWhile.prototype['@@transducer/result'] = function (result) {\n            this.retained = null;\n            return this.xf['@@transducer/result'](result);\n        };\n        XDropLastWhile.prototype['@@transducer/step'] = function (result, input) {\n            return this.f(input) ? this.retain(result, input) : this.flush(result, input);\n        };\n        XDropLastWhile.prototype.flush = function (result, input) {\n            result = _reduce(this.xf['@@transducer/step'], result, this.retained);\n            this.retained = [];\n            return this.xf['@@transducer/step'](result, input);\n        };\n        XDropLastWhile.prototype.retain = function (result, input) {\n            this.retained.push(input);\n            return result;\n        };\n        return _curry2(function _xdropLastWhile(fn, xf) {\n            return new XDropLastWhile(fn, xf);\n        });\n    }();\n\n    var _xgroupBy = function () {\n        function XGroupBy(f, xf) {\n            this.xf = xf;\n            this.f = f;\n            this.inputs = {};\n        }\n        XGroupBy.prototype['@@transducer/init'] = _xfBase.init;\n        XGroupBy.prototype['@@transducer/result'] = function (result) {\n            var key;\n            for (key in this.inputs) {\n                if (_has(key, this.inputs)) {\n                    result = this.xf['@@transducer/step'](result, this.inputs[key]);\n                    if (result['@@transducer/reduced']) {\n                        result = result['@@transducer/value'];\n                        break;\n                    }\n                }\n            }\n            this.inputs = null;\n            return this.xf['@@transducer/result'](result);\n        };\n        XGroupBy.prototype['@@transducer/step'] = function (result, input) {\n            var key = this.f(input);\n            this.inputs[key] = this.inputs[key] || [\n                key,\n                []\n            ];\n            this.inputs[key][1] = append(input, this.inputs[key][1]);\n            return result;\n        };\n        return _curry2(function _xgroupBy(f, xf) {\n            return new XGroupBy(f, xf);\n        });\n    }();\n\n    /**\n     * Creates a new list iteration function from an existing one by adding two new\n     * parameters to its callback function: the current index, and the entire list.\n     *\n     * This would turn, for instance, Ramda's simple `map` function into one that\n     * more closely resembles `Array.prototype.map`. Note that this will only work\n     * for functions in which the iteration callback function is the first\n     * parameter, and where the list is the last parameter. (This latter might be\n     * unimportant if the list parameter is not used.)\n     *\n     * @func\n     * @memberOf R\n     * @since v0.15.0\n     * @category Function\n     * @category List\n     * @sig ((a ... -> b) ... -> [a] -> *) -> (a ..., Int, [a] -> b) ... -> [a] -> *)\n     * @param {Function} fn A list iteration function that does not pass index or list to its callback\n     * @return {Function} An altered list iteration function that passes (item, index, list) to its callback\n     * @example\n     *\n     *      var mapIndexed = R.addIndex(R.map);\n     *      mapIndexed((val, idx) => idx + '-' + val, ['f', 'o', 'o', 'b', 'a', 'r']);\n     *      //=> ['0-f', '1-o', '2-o', '3-b', '4-a', '5-r']\n     */\n    var addIndex = _curry1(function addIndex(fn) {\n        return curryN(fn.length, function () {\n            var idx = 0;\n            var origFn = arguments[0];\n            var list = arguments[arguments.length - 1];\n            var args = _slice(arguments);\n            args[0] = function () {\n                var result = origFn.apply(this, _concat(arguments, [\n                    idx,\n                    list\n                ]));\n                idx += 1;\n                return result;\n            };\n            return fn.apply(this, args);\n        });\n    });\n\n    /**\n     * Wraps a function of any arity (including nullary) in a function that accepts\n     * exactly 2 parameters. Any extraneous parameters will not be passed to the\n     * supplied function.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.2.0\n     * @category Function\n     * @sig (* -> c) -> (a, b -> c)\n     * @param {Function} fn The function to wrap.\n     * @return {Function} A new function wrapping `fn`. The new function is guaranteed to be of\n     *         arity 2.\n     * @example\n     *\n     *      var takesThreeArgs = function(a, b, c) {\n     *        return [a, b, c];\n     *      };\n     *      takesThreeArgs.length; //=> 3\n     *      takesThreeArgs(1, 2, 3); //=> [1, 2, 3]\n     *\n     *      var takesTwoArgs = R.binary(takesThreeArgs);\n     *      takesTwoArgs.length; //=> 2\n     *      // Only 2 arguments are passed to the wrapped function\n     *      takesTwoArgs(1, 2, 3); //=> [1, 2, undefined]\n     */\n    var binary = _curry1(function binary(fn) {\n        return nAry(2, fn);\n    });\n\n    /**\n     * Creates a deep copy of the value which may contain (nested) `Array`s and\n     * `Object`s, `Number`s, `String`s, `Boolean`s and `Date`s. `Function`s are not\n     * copied, but assigned by their reference.\n     *\n     * Dispatches to a `clone` method if present.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.1.0\n     * @category Object\n     * @sig {*} -> {*}\n     * @param {*} value The object or array to clone\n     * @return {*} A new object or array.\n     * @example\n     *\n     *      var objects = [{}, {}, {}];\n     *      var objectsClone = R.clone(objects);\n     *      objects[0] === objectsClone[0]; //=> false\n     */\n    var clone = _curry1(function clone(value) {\n        return value != null && typeof value.clone === 'function' ? value.clone() : _clone(value, [], [], true);\n    });\n\n    /**\n     * Returns a curried equivalent of the provided function. The curried function\n     * has two unusual capabilities. First, its arguments needn't be provided one\n     * at a time. If `f` is a ternary function and `g` is `R.curry(f)`, the\n     * following are equivalent:\n     *\n     *   - `g(1)(2)(3)`\n     *   - `g(1)(2, 3)`\n     *   - `g(1, 2)(3)`\n     *   - `g(1, 2, 3)`\n     *\n     * Secondly, the special placeholder value `R.__` may be used to specify\n     * \"gaps\", allowing partial application of any combination of arguments,\n     * regardless of their positions. If `g` is as above and `_` is `R.__`, the\n     * following are equivalent:\n     *\n     *   - `g(1, 2, 3)`\n     *   - `g(_, 2, 3)(1)`\n     *   - `g(_, _, 3)(1)(2)`\n     *   - `g(_, _, 3)(1, 2)`\n     *   - `g(_, 2)(1)(3)`\n     *   - `g(_, 2)(1, 3)`\n     *   - `g(_, 2)(_, 3)(1)`\n     *\n     * @func\n     * @memberOf R\n     * @since v0.1.0\n     * @category Function\n     * @sig (* -> a) -> (* -> a)\n     * @param {Function} fn The function to curry.\n     * @return {Function} A new, curried function.\n     * @see R.curryN\n     * @example\n     *\n     *      var addFourNumbers = (a, b, c, d) => a + b + c + d;\n     *\n     *      var curriedAddFourNumbers = R.curry(addFourNumbers);\n     *      var f = curriedAddFourNumbers(1, 2);\n     *      var g = f(3);\n     *      g(4); //=> 10\n     */\n    var curry = _curry1(function curry(fn) {\n        return curryN(fn.length, fn);\n    });\n\n    /**\n     * Returns all but the first `n` elements of the given list, string, or\n     * transducer/transformer (or object with a `drop` method).\n     *\n     * Dispatches to the `drop` method of the second argument, if present.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.1.0\n     * @category List\n     * @sig Number -> [a] -> [a]\n     * @sig Number -> String -> String\n     * @param {Number} n\n     * @param {*} list\n     * @return {*}\n     * @see R.take, R.transduce\n     * @example\n     *\n     *      R.drop(1, ['foo', 'bar', 'baz']); //=> ['bar', 'baz']\n     *      R.drop(2, ['foo', 'bar', 'baz']); //=> ['baz']\n     *      R.drop(3, ['foo', 'bar', 'baz']); //=> []\n     *      R.drop(4, ['foo', 'bar', 'baz']); //=> []\n     *      R.drop(3, 'ramda');               //=> 'da'\n     */\n    var drop = _curry2(_dispatchable('drop', _xdrop, function drop(n, xs) {\n        return slice(Math.max(0, n), Infinity, xs);\n    }));\n\n    /**\n     * Returns a list containing all but the last `n` elements of the given `list`.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.16.0\n     * @category List\n     * @sig Number -> [a] -> [a]\n     * @sig Number -> String -> String\n     * @param {Number} n The number of elements of `xs` to skip.\n     * @param {Array} xs The collection to consider.\n     * @return {Array}\n     * @see R.takeLast\n     * @example\n     *\n     *      R.dropLast(1, ['foo', 'bar', 'baz']); //=> ['foo', 'bar']\n     *      R.dropLast(2, ['foo', 'bar', 'baz']); //=> ['foo']\n     *      R.dropLast(3, ['foo', 'bar', 'baz']); //=> []\n     *      R.dropLast(4, ['foo', 'bar', 'baz']); //=> []\n     *      R.dropLast(3, 'ramda');               //=> 'ra'\n     */\n    var dropLast = _curry2(_dispatchable('dropLast', _xdropLast, _dropLast));\n\n    /**\n     * Returns a new list containing all but last the`n` elements of a given list,\n     * passing each value from the right to the supplied predicate function,\n     * skipping elements while the predicate function returns `true`. The predicate\n     * function is passed one argument: (value)*.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.16.0\n     * @category List\n     * @sig (a -> Boolean) -> [a] -> [a]\n     * @param {Function} fn The function called per iteration.\n     * @param {Array} list The collection to iterate over.\n     * @return {Array} A new array.\n     * @see R.takeLastWhile, R.addIndex\n     * @example\n     *\n     *      var lteThree = x => x <= 3;\n     *\n     *      R.dropLastWhile(lteThree, [1, 2, 3, 4, 3, 2, 1]); //=> [1, 2, 3, 4]\n     */\n    var dropLastWhile = _curry2(_dispatchable('dropLastWhile', _xdropLastWhile, _dropLastWhile));\n\n    /**\n     * Returns `true` if its arguments are equivalent, `false` otherwise. Handles\n     * cyclical data structures.\n     *\n     * Dispatches symmetrically to the `equals` methods of both arguments, if\n     * present.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.15.0\n     * @category Relation\n     * @sig a -> b -> Boolean\n     * @param {*} a\n     * @param {*} b\n     * @return {Boolean}\n     * @example\n     *\n     *      R.equals(1, 1); //=> true\n     *      R.equals(1, '1'); //=> false\n     *      R.equals([1, 2, 3], [1, 2, 3]); //=> true\n     *\n     *      var a = {}; a.v = a;\n     *      var b = {}; b.v = b;\n     *      R.equals(a, b); //=> true\n     */\n    var equals = _curry2(function equals(a, b) {\n        return _equals(a, b, [], []);\n    });\n\n    /**\n     * Takes a predicate and a \"filterable\", and returns a new filterable of the\n     * same type containing the members of the given filterable which satisfy the\n     * given predicate.\n     *\n     * Dispatches to the `filter` method of the second argument, if present.\n     *\n     * Acts as a transducer if a transformer is given in list position.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.1.0\n     * @category List\n     * @sig Filterable f => (a -> Boolean) -> f a -> f a\n     * @param {Function} pred\n     * @param {Array} filterable\n     * @return {Array}\n     * @see R.reject, R.transduce, R.addIndex\n     * @example\n     *\n     *      var isEven = n => n % 2 === 0;\n     *\n     *      R.filter(isEven, [1, 2, 3, 4]); //=> [2, 4]\n     *\n     *      R.filter(isEven, {a: 1, b: 2, c: 3, d: 4}); //=> {b: 2, d: 4}\n     */\n    // else\n    var filter = _curry2(_dispatchable('filter', _xfilter, function (pred, filterable) {\n        return _isObject(filterable) ? _reduce(function (acc, key) {\n            if (pred(filterable[key])) {\n                acc[key] = filterable[key];\n            }\n            return acc;\n        }, {}, keys(filterable)) : // else\n        _filter(pred, filterable);\n    }));\n\n    /**\n     * Returns a new list by pulling every item out of it (and all its sub-arrays)\n     * and putting them in a new array, depth-first.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.1.0\n     * @category List\n     * @sig [a] -> [b]\n     * @param {Array} list The array to consider.\n     * @return {Array} The flattened list.\n     * @see R.unnest\n     * @example\n     *\n     *      R.flatten([1, 2, [3, 4], 5, [6, [7, 8, [9, [10, 11], 12]]]]);\n     *      //=> [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12]\n     */\n    var flatten = _curry1(_makeFlat(true));\n\n    /**\n     * Returns a new function much like the supplied one, except that the first two\n     * arguments' order is reversed.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.1.0\n     * @category Function\n     * @sig (a -> b -> c -> ... -> z) -> (b -> a -> c -> ... -> z)\n     * @param {Function} fn The function to invoke with its first two parameters reversed.\n     * @return {*} The result of invoking `fn` with its first two parameters' order reversed.\n     * @example\n     *\n     *      var mergeThree = (a, b, c) => [].concat(a, b, c);\n     *\n     *      mergeThree(1, 2, 3); //=> [1, 2, 3]\n     *\n     *      R.flip(mergeThree)(1, 2, 3); //=> [2, 1, 3]\n     */\n    var flip = _curry1(function flip(fn) {\n        return curry(function (a, b) {\n            var args = _slice(arguments);\n            args[0] = b;\n            args[1] = a;\n            return fn.apply(this, args);\n        });\n    });\n\n    /**\n     * Returns the first element of the given list or string. In some libraries\n     * this function is named `first`.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.1.0\n     * @category List\n     * @sig [a] -> a | Undefined\n     * @sig String -> String\n     * @param {Array|String} list\n     * @return {*}\n     * @see R.tail, R.init, R.last\n     * @example\n     *\n     *      R.head(['fi', 'fo', 'fum']); //=> 'fi'\n     *      R.head([]); //=> undefined\n     *\n     *      R.head('abc'); //=> 'a'\n     *      R.head(''); //=> ''\n     */\n    var head = nth(0);\n\n    /**\n     * Returns all but the last element of the given list or string.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.9.0\n     * @category List\n     * @sig [a] -> [a]\n     * @sig String -> String\n     * @param {*} list\n     * @return {*}\n     * @see R.last, R.head, R.tail\n     * @example\n     *\n     *      R.init([1, 2, 3]);  //=> [1, 2]\n     *      R.init([1, 2]);     //=> [1]\n     *      R.init([1]);        //=> []\n     *      R.init([]);         //=> []\n     *\n     *      R.init('abc');  //=> 'ab'\n     *      R.init('ab');   //=> 'a'\n     *      R.init('a');    //=> ''\n     *      R.init('');     //=> ''\n     */\n    var init = slice(0, -1);\n\n    /**\n     * Combines two lists into a set (i.e. no duplicates) composed of those\n     * elements common to both lists. Duplication is determined according to the\n     * value returned by applying the supplied predicate to two list elements.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.1.0\n     * @category Relation\n     * @sig (a -> a -> Boolean) -> [*] -> [*] -> [*]\n     * @param {Function} pred A predicate function that determines whether\n     *        the two supplied elements are equal.\n     * @param {Array} list1 One list of items to compare\n     * @param {Array} list2 A second list of items to compare\n     * @return {Array} A new list containing those elements common to both lists.\n     * @see R.intersection\n     * @example\n     *\n     *      var buffaloSpringfield = [\n     *        {id: 824, name: 'Richie Furay'},\n     *        {id: 956, name: 'Dewey Martin'},\n     *        {id: 313, name: 'Bruce Palmer'},\n     *        {id: 456, name: 'Stephen Stills'},\n     *        {id: 177, name: 'Neil Young'}\n     *      ];\n     *      var csny = [\n     *        {id: 204, name: 'David Crosby'},\n     *        {id: 456, name: 'Stephen Stills'},\n     *        {id: 539, name: 'Graham Nash'},\n     *        {id: 177, name: 'Neil Young'}\n     *      ];\n     *\n     *      R.intersectionWith(R.eqBy(R.prop('id')), buffaloSpringfield, csny);\n     *      //=> [{id: 456, name: 'Stephen Stills'}, {id: 177, name: 'Neil Young'}]\n     */\n    var intersectionWith = _curry3(function intersectionWith(pred, list1, list2) {\n        var lookupList, filteredList;\n        if (list1.length > list2.length) {\n            lookupList = list1;\n            filteredList = list2;\n        } else {\n            lookupList = list2;\n            filteredList = list1;\n        }\n        var results = [];\n        var idx = 0;\n        while (idx < filteredList.length) {\n            if (_containsWith(pred, filteredList[idx], lookupList)) {\n                results[results.length] = filteredList[idx];\n            }\n            idx += 1;\n        }\n        return uniqWith(pred, results);\n    });\n\n    /**\n     * Transforms the items of the list with the transducer and appends the\n     * transformed items to the accumulator using an appropriate iterator function\n     * based on the accumulator type.\n     *\n     * The accumulator can be an array, string, object or a transformer. Iterated\n     * items will be appended to arrays and concatenated to strings. Objects will\n     * be merged directly or 2-item arrays will be merged as key, value pairs.\n     *\n     * The accumulator can also be a transformer object that provides a 2-arity\n     * reducing iterator function, step, 0-arity initial value function, init, and\n     * 1-arity result extraction function result. The step function is used as the\n     * iterator function in reduce. The result function is used to convert the\n     * final accumulator into the return type and in most cases is R.identity. The\n     * init function is used to provide the initial accumulator.\n     *\n     * The iteration is performed with R.reduce after initializing the transducer.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.12.0\n     * @category List\n     * @sig a -> (b -> b) -> [c] -> a\n     * @param {*} acc The initial accumulator value.\n     * @param {Function} xf The transducer function. Receives a transformer and returns a transformer.\n     * @param {Array} list The list to iterate over.\n     * @return {*} The final, accumulated value.\n     * @example\n     *\n     *      var numbers = [1, 2, 3, 4];\n     *      var transducer = R.compose(R.map(R.add(1)), R.take(2));\n     *\n     *      R.into([], transducer, numbers); //=> [2, 3]\n     *\n     *      var intoArray = R.into([]);\n     *      intoArray(transducer, numbers); //=> [2, 3]\n     */\n    var into = _curry3(function into(acc, xf, list) {\n        return _isTransformer(acc) ? _reduce(xf(acc), acc['@@transducer/init'](), list) : _reduce(xf(_stepCat(acc)), _clone(acc, [], [], false), list);\n    });\n\n    /**\n     * Same as R.invertObj, however this accounts for objects with duplicate values\n     * by putting the values into an array.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.9.0\n     * @category Object\n     * @sig {s: x} -> {x: [ s, ... ]}\n     * @param {Object} obj The object or array to invert\n     * @return {Object} out A new object with keys\n     * in an array.\n     * @example\n     *\n     *      var raceResultsByFirstName = {\n     *        first: 'alice',\n     *        second: 'jake',\n     *        third: 'alice',\n     *      };\n     *      R.invert(raceResultsByFirstName);\n     *      //=> { 'alice': ['first', 'third'], 'jake':['second'] }\n     */\n    var invert = _curry1(function invert(obj) {\n        var props = keys(obj);\n        var len = props.length;\n        var idx = 0;\n        var out = {};\n        while (idx < len) {\n            var key = props[idx];\n            var val = obj[key];\n            var list = _has(val, out) ? out[val] : out[val] = [];\n            list[list.length] = key;\n            idx += 1;\n        }\n        return out;\n    });\n\n    /**\n     * Returns a new object with the keys of the given object as values, and the\n     * values of the given object, which are coerced to strings, as keys. Note\n     * that the last key found is preferred when handling the same value.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.9.0\n     * @category Object\n     * @sig {s: x} -> {x: s}\n     * @param {Object} obj The object or array to invert\n     * @return {Object} out A new object\n     * @example\n     *\n     *      var raceResults = {\n     *        first: 'alice',\n     *        second: 'jake'\n     *      };\n     *      R.invertObj(raceResults);\n     *      //=> { 'alice': 'first', 'jake':'second' }\n     *\n     *      // Alternatively:\n     *      var raceResults = ['alice', 'jake'];\n     *      R.invertObj(raceResults);\n     *      //=> { 'alice': '0', 'jake':'1' }\n     */\n    var invertObj = _curry1(function invertObj(obj) {\n        var props = keys(obj);\n        var len = props.length;\n        var idx = 0;\n        var out = {};\n        while (idx < len) {\n            var key = props[idx];\n            out[obj[key]] = key;\n            idx += 1;\n        }\n        return out;\n    });\n\n    /**\n     * Returns `true` if the given value is its type's empty value; `false`\n     * otherwise.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.1.0\n     * @category Logic\n     * @sig a -> Boolean\n     * @param {*} x\n     * @return {Boolean}\n     * @see R.empty\n     * @example\n     *\n     *      R.isEmpty([1, 2, 3]);   //=> false\n     *      R.isEmpty([]);          //=> true\n     *      R.isEmpty('');          //=> true\n     *      R.isEmpty(null);        //=> false\n     *      R.isEmpty({});          //=> true\n     *      R.isEmpty({length: 0}); //=> false\n     */\n    var isEmpty = _curry1(function isEmpty(x) {\n        return x != null && equals(x, empty(x));\n    });\n\n    /**\n     * Returns the last element of the given list or string.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.1.4\n     * @category List\n     * @sig [a] -> a | Undefined\n     * @sig String -> String\n     * @param {*} list\n     * @return {*}\n     * @see R.init, R.head, R.tail\n     * @example\n     *\n     *      R.last(['fi', 'fo', 'fum']); //=> 'fum'\n     *      R.last([]); //=> undefined\n     *\n     *      R.last('abc'); //=> 'c'\n     *      R.last(''); //=> ''\n     */\n    var last = nth(-1);\n\n    /**\n     * Returns the position of the last occurrence of an item in an array, or -1 if\n     * the item is not included in the array. `R.equals` is used to determine\n     * equality.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.1.0\n     * @category List\n     * @sig a -> [a] -> Number\n     * @param {*} target The item to find.\n     * @param {Array} xs The array to search in.\n     * @return {Number} the index of the target, or -1 if the target is not found.\n     * @see R.indexOf\n     * @example\n     *\n     *      R.lastIndexOf(3, [-1,3,3,0,1,2,3,4]); //=> 6\n     *      R.lastIndexOf(10, [1,2,3,4]); //=> -1\n     */\n    var lastIndexOf = _curry2(function lastIndexOf(target, xs) {\n        if (typeof xs.lastIndexOf === 'function' && !_isArray(xs)) {\n            return xs.lastIndexOf(target);\n        } else {\n            var idx = xs.length - 1;\n            while (idx >= 0) {\n                if (equals(xs[idx], target)) {\n                    return idx;\n                }\n                idx -= 1;\n            }\n            return -1;\n        }\n    });\n\n    /**\n     * Takes a function and\n     * a [functor](https://github.com/fantasyland/fantasy-land#functor),\n     * applies the function to each of the functor's values, and returns\n     * a functor of the same shape.\n     *\n     * Ramda provides suitable `map` implementations for `Array` and `Object`,\n     * so this function may be applied to `[1, 2, 3]` or `{x: 1, y: 2, z: 3}`.\n     *\n     * Dispatches to the `map` method of the second argument, if present.\n     *\n     * Acts as a transducer if a transformer is given in list position.\n     *\n     * Also treats functions as functors and will compose them together.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.1.0\n     * @category List\n     * @sig Functor f => (a -> b) -> f a -> f b\n     * @param {Function} fn The function to be called on every element of the input `list`.\n     * @param {Array} list The list to be iterated over.\n     * @return {Array} The new list.\n     * @see R.transduce, R.addIndex\n     * @example\n     *\n     *      var double = x => x * 2;\n     *\n     *      R.map(double, [1, 2, 3]); //=> [2, 4, 6]\n     *\n     *      R.map(double, {x: 1, y: 2, z: 3}); //=> {x: 2, y: 4, z: 6}\n     */\n    var map = _curry2(_dispatchable('map', _xmap, function map(fn, functor) {\n        switch (Object.prototype.toString.call(functor)) {\n        case '[object Function]':\n            return curryN(functor.length, function () {\n                return fn.call(this, functor.apply(this, arguments));\n            });\n        case '[object Object]':\n            return _reduce(function (acc, key) {\n                acc[key] = fn(functor[key]);\n                return acc;\n            }, {}, keys(functor));\n        default:\n            return _map(fn, functor);\n        }\n    }));\n\n    /**\n     * An Object-specific version of `map`. The function is applied to three\n     * arguments: *(value, key, obj)*. If only the value is significant, use\n     * `map` instead.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.9.0\n     * @category Object\n     * @sig ((*, String, Object) -> *) -> Object -> Object\n     * @param {Function} fn\n     * @param {Object} obj\n     * @return {Object}\n     * @see R.map\n     * @example\n     *\n     *      var values = { x: 1, y: 2, z: 3 };\n     *      var prependKeyAndDouble = (num, key, obj) => key + (num * 2);\n     *\n     *      R.mapObjIndexed(prependKeyAndDouble, values); //=> { x: 'x2', y: 'y4', z: 'z6' }\n     */\n    var mapObjIndexed = _curry2(function mapObjIndexed(fn, obj) {\n        return _reduce(function (acc, key) {\n            acc[key] = fn(obj[key], key, obj);\n            return acc;\n        }, {}, keys(obj));\n    });\n\n    /**\n     * Creates a new object with the own properties of the two provided objects. If\n     * a key exists in both objects, the provided function is applied to the values\n     * associated with the key in each object, with the result being used as the\n     * value associated with the key in the returned object. The key will be\n     * excluded from the returned object if the resulting value is `undefined`.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.19.0\n     * @category Object\n     * @sig (a -> a -> a) -> {a} -> {a} -> {a}\n     * @param {Function} fn\n     * @param {Object} l\n     * @param {Object} r\n     * @return {Object}\n     * @see R.merge, R.mergeWithKey\n     * @example\n     *\n     *      R.mergeWith(R.concat,\n     *                  { a: true, values: [10, 20] },\n     *                  { b: true, values: [15, 35] });\n     *      //=> { a: true, b: true, values: [10, 20, 15, 35] }\n     */\n    var mergeWith = _curry3(function mergeWith(fn, l, r) {\n        return mergeWithKey(function (_, _l, _r) {\n            return fn(_l, _r);\n        }, l, r);\n    });\n\n    /**\n     * Takes a function `f` and a list of arguments, and returns a function `g`.\n     * When applied, `g` returns the result of applying `f` to the arguments\n     * provided initially followed by the arguments provided to `g`.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.10.0\n     * @category Function\n     * @sig ((a, b, c, ..., n) -> x) -> [a, b, c, ...] -> ((d, e, f, ..., n) -> x)\n     * @param {Function} f\n     * @param {Array} args\n     * @return {Function}\n     * @see R.partialRight\n     * @example\n     *\n     *      var multiply = (a, b) => a * b;\n     *      var double = R.partial(multiply, [2]);\n     *      double(2); //=> 4\n     *\n     *      var greet = (salutation, title, firstName, lastName) =>\n     *        salutation + ', ' + title + ' ' + firstName + ' ' + lastName + '!';\n     *\n     *      var sayHello = R.partial(greet, ['Hello']);\n     *      var sayHelloToMs = R.partial(sayHello, ['Ms.']);\n     *      sayHelloToMs('Jane', 'Jones'); //=> 'Hello, Ms. Jane Jones!'\n     */\n    var partial = _createPartialApplicator(_concat);\n\n    /**\n     * Takes a function `f` and a list of arguments, and returns a function `g`.\n     * When applied, `g` returns the result of applying `f` to the arguments\n     * provided to `g` followed by the arguments provided initially.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.10.0\n     * @category Function\n     * @sig ((a, b, c, ..., n) -> x) -> [d, e, f, ..., n] -> ((a, b, c, ...) -> x)\n     * @param {Function} f\n     * @param {Array} args\n     * @return {Function}\n     * @see R.partial\n     * @example\n     *\n     *      var greet = (salutation, title, firstName, lastName) =>\n     *        salutation + ', ' + title + ' ' + firstName + ' ' + lastName + '!';\n     *\n     *      var greetMsJaneJones = R.partialRight(greet, ['Ms.', 'Jane', 'Jones']);\n     *\n     *      greetMsJaneJones('Hello'); //=> 'Hello, Ms. Jane Jones!'\n     */\n    var partialRight = _createPartialApplicator(flip(_concat));\n\n    /**\n     * Determines whether a nested path on an object has a specific value, in\n     * `R.equals` terms. Most likely used to filter a list.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.7.0\n     * @category Relation\n     * @sig [String] -> * -> {String: *} -> Boolean\n     * @param {Array} path The path of the nested property to use\n     * @param {*} val The value to compare the nested property with\n     * @param {Object} obj The object to check the nested property in\n     * @return {Boolean} `true` if the value equals the nested object property,\n     *         `false` otherwise.\n     * @example\n     *\n     *      var user1 = { address: { zipCode: 90210 } };\n     *      var user2 = { address: { zipCode: 55555 } };\n     *      var user3 = { name: 'Bob' };\n     *      var users = [ user1, user2, user3 ];\n     *      var isFamous = R.pathEq(['address', 'zipCode'], 90210);\n     *      R.filter(isFamous, users); //=> [ user1 ]\n     */\n    var pathEq = _curry3(function pathEq(_path, val, obj) {\n        return equals(path(_path, obj), val);\n    });\n\n    /**\n     * Returns a new list by plucking the same named property off all objects in\n     * the list supplied.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.1.0\n     * @category List\n     * @sig k -> [{k: v}] -> [v]\n     * @param {Number|String} key The key name to pluck off of each object.\n     * @param {Array} list The array to consider.\n     * @return {Array} The list of values for the given key.\n     * @see R.props\n     * @example\n     *\n     *      R.pluck('a')([{a: 1}, {a: 2}]); //=> [1, 2]\n     *      R.pluck(0)([[1, 2], [3, 4]]);   //=> [1, 3]\n     */\n    var pluck = _curry2(function pluck(p, list) {\n        return map(prop(p), list);\n    });\n\n    /**\n     * Reasonable analog to SQL `select` statement.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.1.0\n     * @category Object\n     * @category Relation\n     * @sig [k] -> [{k: v}] -> [{k: v}]\n     * @param {Array} props The property names to project\n     * @param {Array} objs The objects to query\n     * @return {Array} An array of objects with just the `props` properties.\n     * @example\n     *\n     *      var abby = {name: 'Abby', age: 7, hair: 'blond', grade: 2};\n     *      var fred = {name: 'Fred', age: 12, hair: 'brown', grade: 7};\n     *      var kids = [abby, fred];\n     *      R.project(['name', 'grade'], kids); //=> [{name: 'Abby', grade: 2}, {name: 'Fred', grade: 7}]\n     */\n    // passing `identity` gives correct arity\n    var project = useWith(_map, [\n        pickAll,\n        identity\n    ]);\n\n    /**\n     * Returns `true` if the specified object property is equal, in `R.equals`\n     * terms, to the given value; `false` otherwise.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.1.0\n     * @category Relation\n     * @sig String -> a -> Object -> Boolean\n     * @param {String} name\n     * @param {*} val\n     * @param {*} obj\n     * @return {Boolean}\n     * @see R.equals, R.propSatisfies\n     * @example\n     *\n     *      var abby = {name: 'Abby', age: 7, hair: 'blond'};\n     *      var fred = {name: 'Fred', age: 12, hair: 'brown'};\n     *      var rusty = {name: 'Rusty', age: 10, hair: 'brown'};\n     *      var alois = {name: 'Alois', age: 15, disposition: 'surly'};\n     *      var kids = [abby, fred, rusty, alois];\n     *      var hasBrownHair = R.propEq('hair', 'brown');\n     *      R.filter(hasBrownHair, kids); //=> [fred, rusty]\n     */\n    var propEq = _curry3(function propEq(name, val, obj) {\n        return propSatisfies(equals(val), name, obj);\n    });\n\n    /**\n     * Returns `true` if the specified object property is of the given type;\n     * `false` otherwise.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.16.0\n     * @category Type\n     * @sig Type -> String -> Object -> Boolean\n     * @param {Function} type\n     * @param {String} name\n     * @param {*} obj\n     * @return {Boolean}\n     * @see R.is, R.propSatisfies\n     * @example\n     *\n     *      R.propIs(Number, 'x', {x: 1, y: 2});  //=> true\n     *      R.propIs(Number, 'x', {x: 'foo'});    //=> false\n     *      R.propIs(Number, 'x', {});            //=> false\n     */\n    var propIs = _curry3(function propIs(type, name, obj) {\n        return propSatisfies(is(type), name, obj);\n    });\n\n    /**\n     * Returns a single item by iterating through the list, successively calling\n     * the iterator function and passing it an accumulator value and the current\n     * value from the array, and then passing the result to the next call.\n     *\n     * The iterator function receives two values: *(acc, value)*. It may use\n     * `R.reduced` to shortcut the iteration.\n     *\n     * Note: `R.reduce` does not skip deleted or unassigned indices (sparse\n     * arrays), unlike the native `Array.prototype.reduce` method. For more details\n     * on this behavior, see:\n     * https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/reduce#Description\n     *\n     * Dispatches to the `reduce` method of the third argument, if present.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.1.0\n     * @category List\n     * @sig ((a, b) -> a) -> a -> [b] -> a\n     * @param {Function} fn The iterator function. Receives two values, the accumulator and the\n     *        current element from the array.\n     * @param {*} acc The accumulator value.\n     * @param {Array} list The list to iterate over.\n     * @return {*} The final, accumulated value.\n     * @see R.reduced, R.addIndex\n     * @example\n     *\n     *      var numbers = [1, 2, 3];\n     *      var add = (a, b) => a + b;\n     *\n     *      R.reduce(add, 10, numbers); //=> 16\n     */\n    var reduce = _curry3(_reduce);\n\n    /**\n     * Groups the elements of the list according to the result of calling\n     * the String-returning function `keyFn` on each element and reduces the elements\n     * of each group to a single value via the reducer function `valueFn`.\n     *\n     * This function is basically a more general `groupBy` function.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.20.0\n     * @category List\n     * @sig ((a, b) -> a) -> a -> (b -> String) -> [b] -> {String: a}\n     * @param {Function} valueFn The function that reduces the elements of each group to a single\n     *        value. Receives two values, accumulator for a particular group and the current element.\n     * @param {*} acc The (initial) accumulator value for each group.\n     * @param {Function} keyFn The function that maps the list's element into a key.\n     * @param {Array} list The array to group.\n     * @return {Object} An object with the output of `keyFn` for keys, mapped to the output of\n     *         `valueFn` for elements which produced that key when passed to `keyFn`.\n     * @see R.groupBy, R.reduce\n     * @example\n     *\n     *      var reduceToNamesBy = R.reduceBy((acc, student) => acc.concat(student.name), []);\n     *      var namesByGrade = reduceToNamesBy(function(student) {\n     *        var score = student.score;\n     *        return score < 65 ? 'F' :\n     *               score < 70 ? 'D' :\n     *               score < 80 ? 'C' :\n     *               score < 90 ? 'B' : 'A';\n     *      });\n     *      var students = [{name: 'Lucy', score: 92},\n     *                      {name: 'Drew', score: 85},\n     *                      // ...\n     *                      {name: 'Bart', score: 62}];\n     *      namesByGrade(students);\n     *      // {\n     *      //   'A': ['Lucy'],\n     *      //   'B': ['Drew']\n     *      //   // ...,\n     *      //   'F': ['Bart']\n     *      // }\n     */\n    var reduceBy = _curryN(4, [], function reduceBy(valueFn, valueAcc, keyFn, list) {\n        return _reduce(function (acc, elt) {\n            var key = keyFn(elt);\n            acc[key] = valueFn(_has(key, acc) ? acc[key] : valueAcc, elt);\n            return acc;\n        }, {}, list);\n    });\n\n    /**\n     * The complement of `filter`.\n     *\n     * Acts as a transducer if a transformer is given in list position.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.1.0\n     * @category List\n     * @sig Filterable f => (a -> Boolean) -> f a -> f a\n     * @param {Function} pred\n     * @param {Array} filterable\n     * @return {Array}\n     * @see R.filter, R.transduce, R.addIndex\n     * @example\n     *\n     *      var isOdd = (n) => n % 2 === 1;\n     *\n     *      R.reject(isOdd, [1, 2, 3, 4]); //=> [2, 4]\n     *\n     *      R.reject(isOdd, {a: 1, b: 2, c: 3, d: 4}); //=> {b: 2, d: 4}\n     */\n    var reject = _curry2(function reject(pred, filterable) {\n        return filter(_complement(pred), filterable);\n    });\n\n    /**\n     * Returns a fixed list of size `n` containing a specified identical value.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.1.1\n     * @category List\n     * @sig a -> n -> [a]\n     * @param {*} value The value to repeat.\n     * @param {Number} n The desired size of the output list.\n     * @return {Array} A new array containing `n` `value`s.\n     * @example\n     *\n     *      R.repeat('hi', 5); //=> ['hi', 'hi', 'hi', 'hi', 'hi']\n     *\n     *      var obj = {};\n     *      var repeatedObjs = R.repeat(obj, 5); //=> [{}, {}, {}, {}, {}]\n     *      repeatedObjs[0] === repeatedObjs[1]; //=> true\n     */\n    var repeat = _curry2(function repeat(value, n) {\n        return times(always(value), n);\n    });\n\n    /**\n     * Adds together all the elements of a list.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.1.0\n     * @category Math\n     * @sig [Number] -> Number\n     * @param {Array} list An array of numbers\n     * @return {Number} The sum of all the numbers in the list.\n     * @see R.reduce\n     * @example\n     *\n     *      R.sum([2,4,6,8,100,1]); //=> 121\n     */\n    var sum = reduce(add, 0);\n\n    /**\n     * Returns a new list containing the last `n` elements of the given list.\n     * If `n > list.length`, returns a list of `list.length` elements.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.16.0\n     * @category List\n     * @sig Number -> [a] -> [a]\n     * @sig Number -> String -> String\n     * @param {Number} n The number of elements to return.\n     * @param {Array} xs The collection to consider.\n     * @return {Array}\n     * @see R.dropLast\n     * @example\n     *\n     *      R.takeLast(1, ['foo', 'bar', 'baz']); //=> ['baz']\n     *      R.takeLast(2, ['foo', 'bar', 'baz']); //=> ['bar', 'baz']\n     *      R.takeLast(3, ['foo', 'bar', 'baz']); //=> ['foo', 'bar', 'baz']\n     *      R.takeLast(4, ['foo', 'bar', 'baz']); //=> ['foo', 'bar', 'baz']\n     *      R.takeLast(3, 'ramda');               //=> 'mda'\n     */\n    var takeLast = _curry2(function takeLast(n, xs) {\n        return drop(n >= 0 ? xs.length - n : 0, xs);\n    });\n\n    /**\n     * Initializes a transducer using supplied iterator function. Returns a single\n     * item by iterating through the list, successively calling the transformed\n     * iterator function and passing it an accumulator value and the current value\n     * from the array, and then passing the result to the next call.\n     *\n     * The iterator function receives two values: *(acc, value)*. It will be\n     * wrapped as a transformer to initialize the transducer. A transformer can be\n     * passed directly in place of an iterator function. In both cases, iteration\n     * may be stopped early with the `R.reduced` function.\n     *\n     * A transducer is a function that accepts a transformer and returns a\n     * transformer and can be composed directly.\n     *\n     * A transformer is an an object that provides a 2-arity reducing iterator\n     * function, step, 0-arity initial value function, init, and 1-arity result\n     * extraction function, result. The step function is used as the iterator\n     * function in reduce. The result function is used to convert the final\n     * accumulator into the return type and in most cases is R.identity. The init\n     * function can be used to provide an initial accumulator, but is ignored by\n     * transduce.\n     *\n     * The iteration is performed with R.reduce after initializing the transducer.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.12.0\n     * @category List\n     * @sig (c -> c) -> (a,b -> a) -> a -> [b] -> a\n     * @param {Function} xf The transducer function. Receives a transformer and returns a transformer.\n     * @param {Function} fn The iterator function. Receives two values, the accumulator and the\n     *        current element from the array. Wrapped as transformer, if necessary, and used to\n     *        initialize the transducer\n     * @param {*} acc The initial accumulator value.\n     * @param {Array} list The list to iterate over.\n     * @return {*} The final, accumulated value.\n     * @see R.reduce, R.reduced, R.into\n     * @example\n     *\n     *      var numbers = [1, 2, 3, 4];\n     *      var transducer = R.compose(R.map(R.add(1)), R.take(2));\n     *\n     *      R.transduce(transducer, R.flip(R.append), [], numbers); //=> [2, 3]\n     */\n    var transduce = curryN(4, function transduce(xf, fn, acc, list) {\n        return _reduce(xf(typeof fn === 'function' ? _xwrap(fn) : fn), acc, list);\n    });\n\n    /**\n     * Combines two lists into a set (i.e. no duplicates) composed of the elements\n     * of each list. Duplication is determined according to the value returned by\n     * applying the supplied predicate to two list elements.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.1.0\n     * @category Relation\n     * @sig (a -> a -> Boolean) -> [*] -> [*] -> [*]\n     * @param {Function} pred A predicate used to test whether two items are equal.\n     * @param {Array} list1 The first list.\n     * @param {Array} list2 The second list.\n     * @return {Array} The first and second lists concatenated, with\n     *         duplicates removed.\n     * @see R.union\n     * @example\n     *\n     *      var l1 = [{a: 1}, {a: 2}];\n     *      var l2 = [{a: 1}, {a: 4}];\n     *      R.unionWith(R.eqBy(R.prop('a')), l1, l2); //=> [{a: 1}, {a: 2}, {a: 4}]\n     */\n    var unionWith = _curry3(function unionWith(pred, list1, list2) {\n        return uniqWith(pred, _concat(list1, list2));\n    });\n\n    /**\n     * Takes a spec object and a test object; returns true if the test satisfies\n     * the spec, false otherwise. An object satisfies the spec if, for each of the\n     * spec's own properties, accessing that property of the object gives the same\n     * value (in `R.equals` terms) as accessing that property of the spec.\n     *\n     * `whereEq` is a specialization of [`where`](#where).\n     *\n     * @func\n     * @memberOf R\n     * @since v0.14.0\n     * @category Object\n     * @sig {String: *} -> {String: *} -> Boolean\n     * @param {Object} spec\n     * @param {Object} testObj\n     * @return {Boolean}\n     * @see R.where\n     * @example\n     *\n     *      // pred :: Object -> Boolean\n     *      var pred = R.whereEq({a: 1, b: 2});\n     *\n     *      pred({a: 1});              //=> false\n     *      pred({a: 1, b: 2});        //=> true\n     *      pred({a: 1, b: 2, c: 3});  //=> true\n     *      pred({a: 1, b: 1});        //=> false\n     */\n    var whereEq = _curry2(function whereEq(spec, testObj) {\n        return where(map(equals, spec), testObj);\n    });\n\n    var _flatCat = function () {\n        var preservingReduced = function (xf) {\n            return {\n                '@@transducer/init': _xfBase.init,\n                '@@transducer/result': function (result) {\n                    return xf['@@transducer/result'](result);\n                },\n                '@@transducer/step': function (result, input) {\n                    var ret = xf['@@transducer/step'](result, input);\n                    return ret['@@transducer/reduced'] ? _forceReduced(ret) : ret;\n                }\n            };\n        };\n        return function _xcat(xf) {\n            var rxf = preservingReduced(xf);\n            return {\n                '@@transducer/init': _xfBase.init,\n                '@@transducer/result': function (result) {\n                    return rxf['@@transducer/result'](result);\n                },\n                '@@transducer/step': function (result, input) {\n                    return !isArrayLike(input) ? _reduce(rxf, result, [input]) : _reduce(rxf, result, input);\n                }\n            };\n        };\n    }();\n\n    // Array.prototype.indexOf doesn't exist below IE9\n    // manually crawl the list to distinguish between +0 and -0\n    // NaN\n    // non-zero numbers can utilise Set\n    // all these types can utilise Set\n    // null can utilise Set\n    // anything else not covered above, defer to R.equals\n    var _indexOf = function _indexOf(list, a, idx) {\n        var inf, item;\n        // Array.prototype.indexOf doesn't exist below IE9\n        if (typeof list.indexOf === 'function') {\n            switch (typeof a) {\n            case 'number':\n                if (a === 0) {\n                    // manually crawl the list to distinguish between +0 and -0\n                    inf = 1 / a;\n                    while (idx < list.length) {\n                        item = list[idx];\n                        if (item === 0 && 1 / item === inf) {\n                            return idx;\n                        }\n                        idx += 1;\n                    }\n                    return -1;\n                } else if (a !== a) {\n                    // NaN\n                    while (idx < list.length) {\n                        item = list[idx];\n                        if (typeof item === 'number' && item !== item) {\n                            return idx;\n                        }\n                        idx += 1;\n                    }\n                    return -1;\n                }\n                // non-zero numbers can utilise Set\n                return list.indexOf(a, idx);\n            // all these types can utilise Set\n            case 'string':\n            case 'boolean':\n            case 'function':\n            case 'undefined':\n                return list.indexOf(a, idx);\n            case 'object':\n                if (a === null) {\n                    // null can utilise Set\n                    return list.indexOf(a, idx);\n                }\n            }\n        }\n        // anything else not covered above, defer to R.equals\n        while (idx < list.length) {\n            if (equals(list[idx], a)) {\n                return idx;\n            }\n            idx += 1;\n        }\n        return -1;\n    };\n\n    var _xchain = _curry2(function _xchain(f, xf) {\n        return map(f, _flatCat(xf));\n    });\n\n    /**\n     * Takes a list of predicates and returns a predicate that returns true for a\n     * given list of arguments if every one of the provided predicates is satisfied\n     * by those arguments.\n     *\n     * The function returned is a curried function whose arity matches that of the\n     * highest-arity predicate.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.9.0\n     * @category Logic\n     * @sig [(*... -> Boolean)] -> (*... -> Boolean)\n     * @param {Array} preds\n     * @return {Function}\n     * @see R.anyPass\n     * @example\n     *\n     *      var isQueen = R.propEq('rank', 'Q');\n     *      var isSpade = R.propEq('suit', '♠︎');\n     *      var isQueenOfSpades = R.allPass([isQueen, isSpade]);\n     *\n     *      isQueenOfSpades({rank: 'Q', suit: '♣︎'}); //=> false\n     *      isQueenOfSpades({rank: 'Q', suit: '♠︎'}); //=> true\n     */\n    var allPass = _curry1(function allPass(preds) {\n        return curryN(reduce(max, 0, pluck('length', preds)), function () {\n            var idx = 0;\n            var len = preds.length;\n            while (idx < len) {\n                if (!preds[idx].apply(this, arguments)) {\n                    return false;\n                }\n                idx += 1;\n            }\n            return true;\n        });\n    });\n\n    /**\n     * Returns `true` if all elements are unique, in `R.equals` terms, otherwise\n     * `false`.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.18.0\n     * @category List\n     * @sig [a] -> Boolean\n     * @param {Array} list The array to consider.\n     * @return {Boolean} `true` if all elements are unique, else `false`.\n     * @deprecated since v0.20.0\n     * @example\n     *\n     *      R.allUniq(['1', 1]); //=> true\n     *      R.allUniq([1, 1]);   //=> false\n     *      R.allUniq([[42], [42]]); //=> false\n     */\n    var allUniq = _curry1(function allUniq(list) {\n        var len = list.length;\n        var idx = 0;\n        while (idx < len) {\n            if (_indexOf(list, list[idx], idx + 1) >= 0) {\n                return false;\n            }\n            idx += 1;\n        }\n        return true;\n    });\n\n    /**\n     * Takes a list of predicates and returns a predicate that returns true for a\n     * given list of arguments if at least one of the provided predicates is\n     * satisfied by those arguments.\n     *\n     * The function returned is a curried function whose arity matches that of the\n     * highest-arity predicate.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.9.0\n     * @category Logic\n     * @sig [(*... -> Boolean)] -> (*... -> Boolean)\n     * @param {Array} preds\n     * @return {Function}\n     * @see R.allPass\n     * @example\n     *\n     *      var gte = R.anyPass([R.gt, R.equals]);\n     *\n     *      gte(3, 2); //=> true\n     *      gte(2, 2); //=> true\n     *      gte(2, 3); //=> false\n     */\n    var anyPass = _curry1(function anyPass(preds) {\n        return curryN(reduce(max, 0, pluck('length', preds)), function () {\n            var idx = 0;\n            var len = preds.length;\n            while (idx < len) {\n                if (preds[idx].apply(this, arguments)) {\n                    return true;\n                }\n                idx += 1;\n            }\n            return false;\n        });\n    });\n\n    /**\n     * ap applies a list of functions to a list of values.\n     *\n     * Dispatches to the `ap` method of the second argument, if present. Also\n     * treats functions as applicatives.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.3.0\n     * @category Function\n     * @sig [f] -> [a] -> [f a]\n     * @param {Array} fns An array of functions\n     * @param {Array} vs An array of values\n     * @return {Array} An array of results of applying each of `fns` to all of `vs` in turn.\n     * @example\n     *\n     *      R.ap([R.multiply(2), R.add(3)], [1,2,3]); //=> [2, 4, 6, 4, 5, 6]\n     */\n    // else\n    var ap = _curry2(function ap(applicative, fn) {\n        return typeof applicative.ap === 'function' ? applicative.ap(fn) : typeof applicative === 'function' ? curryN(Math.max(applicative.length, fn.length), function () {\n            return applicative.apply(this, arguments)(fn.apply(this, arguments));\n        }) : // else\n        _reduce(function (acc, f) {\n            return _concat(acc, map(f, fn));\n        }, [], applicative);\n    });\n\n    /**\n     * Given a spec object recursively mapping properties to functions, creates a\n     * function producing an object of the same structure, by mapping each property\n     * to the result of calling its associated function with the supplied arguments.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.20.0\n     * @category Function\n     * @sig {k: ((a, b, ..., m) -> v)} -> ((a, b, ..., m) -> {k: v})\n     * @param {Object} spec an object recursively mapping properties to functions for\n     *        producing the values for these properties.\n     * @return {Function} A function that returns an object of the same structure\n     * as `spec', with each property set to the value returned by calling its\n     * associated function with the supplied arguments.\n     * @see R.juxt\n     * @example\n     *\n     *      var getMetrics = R.applySpec({\n     *                                      sum: R.add,\n     *                                      nested: { mul: R.multiply }\n     *                                   });\n     *      getMetrics(2, 4); // => { sum: 6, nested: { mul: 8 } }\n     */\n    var applySpec = _curry1(function applySpec(spec) {\n        spec = map(function (v) {\n            return typeof v == 'function' ? v : applySpec(v);\n        }, spec);\n        return curryN(reduce(max, 0, pluck('length', values(spec))), function () {\n            var args = arguments;\n            return map(function (f) {\n                return apply(f, args);\n            }, spec);\n        });\n    });\n\n    /**\n     * Returns the result of calling its first argument with the remaining\n     * arguments. This is occasionally useful as a converging function for\n     * `R.converge`: the left branch can produce a function while the right branch\n     * produces a value to be passed to that function as an argument.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.9.0\n     * @category Function\n     * @sig (*... -> a),*... -> a\n     * @param {Function} fn The function to apply to the remaining arguments.\n     * @param {...*} args Any number of positional arguments.\n     * @return {*}\n     * @see R.apply\n     * @example\n     *\n     *      var indentN = R.pipe(R.times(R.always(' ')),\n     *                           R.join(''),\n     *                           R.replace(/^(?!$)/gm));\n     *\n     *      var format = R.converge(R.call, [\n     *                                  R.pipe(R.prop('indent'), indentN),\n     *                                  R.prop('value')\n     *                              ]);\n     *\n     *      format({indent: 2, value: 'foo\\nbar\\nbaz\\n'}); //=> '  foo\\n  bar\\n  baz\\n'\n     */\n    var call = curry(function call(fn) {\n        return fn.apply(this, _slice(arguments, 1));\n    });\n\n    /**\n     * `chain` maps a function over a list and concatenates the results. `chain`\n     * is also known as `flatMap` in some libraries\n     *\n     * Dispatches to the `chain` method of the second argument, if present.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.3.0\n     * @category List\n     * @sig (a -> [b]) -> [a] -> [b]\n     * @param {Function} fn\n     * @param {Array} list\n     * @return {Array}\n     * @example\n     *\n     *      var duplicate = n => [n, n];\n     *      R.chain(duplicate, [1, 2, 3]); //=> [1, 1, 2, 2, 3, 3]\n     */\n    var chain = _curry2(_dispatchable('chain', _xchain, function chain(fn, monad) {\n        if (typeof monad === 'function') {\n            return function () {\n                return monad.call(this, fn.apply(this, arguments)).apply(this, arguments);\n            };\n        }\n        return _makeFlat(false)(map(fn, monad));\n    }));\n\n    /**\n     * Returns a function, `fn`, which encapsulates if/else-if/else logic.\n     * `R.cond` takes a list of [predicate, transform] pairs. All of the arguments\n     * to `fn` are applied to each of the predicates in turn until one returns a\n     * \"truthy\" value, at which point `fn` returns the result of applying its\n     * arguments to the corresponding transformer. If none of the predicates\n     * matches, `fn` returns undefined.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.6.0\n     * @category Logic\n     * @sig [[(*... -> Boolean),(*... -> *)]] -> (*... -> *)\n     * @param {Array} pairs\n     * @return {Function}\n     * @example\n     *\n     *      var fn = R.cond([\n     *        [R.equals(0),   R.always('water freezes at 0°C')],\n     *        [R.equals(100), R.always('water boils at 100°C')],\n     *        [R.T,           temp => 'nothing special happens at ' + temp + '°C']\n     *      ]);\n     *      fn(0); //=> 'water freezes at 0°C'\n     *      fn(50); //=> 'nothing special happens at 50°C'\n     *      fn(100); //=> 'water boils at 100°C'\n     */\n    var cond = _curry1(function cond(pairs) {\n        var arity = reduce(max, 0, map(function (pair) {\n            return pair[0].length;\n        }, pairs));\n        return _arity(arity, function () {\n            var idx = 0;\n            while (idx < pairs.length) {\n                if (pairs[idx][0].apply(this, arguments)) {\n                    return pairs[idx][1].apply(this, arguments);\n                }\n                idx += 1;\n            }\n        });\n    });\n\n    /**\n     * Wraps a constructor function inside a curried function that can be called\n     * with the same arguments and returns the same type. The arity of the function\n     * returned is specified to allow using variadic constructor functions.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.4.0\n     * @category Function\n     * @sig Number -> (* -> {*}) -> (* -> {*})\n     * @param {Number} n The arity of the constructor function.\n     * @param {Function} Fn The constructor function to wrap.\n     * @return {Function} A wrapped, curried constructor function.\n     * @example\n     *\n     *      // Variadic constructor function\n     *      var Widget = () => {\n     *        this.children = Array.prototype.slice.call(arguments);\n     *        // ...\n     *      };\n     *      Widget.prototype = {\n     *        // ...\n     *      };\n     *      var allConfigs = [\n     *        // ...\n     *      ];\n     *      R.map(R.constructN(1, Widget), allConfigs); // a list of Widgets\n     */\n    var constructN = _curry2(function constructN(n, Fn) {\n        if (n > 10) {\n            throw new Error('Constructor with greater than ten arguments');\n        }\n        if (n === 0) {\n            return function () {\n                return new Fn();\n            };\n        }\n        return curry(nAry(n, function ($0, $1, $2, $3, $4, $5, $6, $7, $8, $9) {\n            switch (arguments.length) {\n            case 1:\n                return new Fn($0);\n            case 2:\n                return new Fn($0, $1);\n            case 3:\n                return new Fn($0, $1, $2);\n            case 4:\n                return new Fn($0, $1, $2, $3);\n            case 5:\n                return new Fn($0, $1, $2, $3, $4);\n            case 6:\n                return new Fn($0, $1, $2, $3, $4, $5);\n            case 7:\n                return new Fn($0, $1, $2, $3, $4, $5, $6);\n            case 8:\n                return new Fn($0, $1, $2, $3, $4, $5, $6, $7);\n            case 9:\n                return new Fn($0, $1, $2, $3, $4, $5, $6, $7, $8);\n            case 10:\n                return new Fn($0, $1, $2, $3, $4, $5, $6, $7, $8, $9);\n            }\n        }));\n    });\n\n    /**\n     * Accepts a converging function and a list of branching functions and returns\n     * a new function. When invoked, this new function is applied to some\n     * arguments, each branching function is applied to those same arguments. The\n     * results of each branching function are passed as arguments to the converging\n     * function to produce the return value.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.4.2\n     * @category Function\n     * @sig (x1 -> x2 -> ... -> z) -> [(a -> b -> ... -> x1), (a -> b -> ... -> x2), ...] -> (a -> b -> ... -> z)\n     * @param {Function} after A function. `after` will be invoked with the return values of\n     *        `fn1` and `fn2` as its arguments.\n     * @param {Array} functions A list of functions.\n     * @return {Function} A new function.\n     * @example\n     *\n     *      var add = (a, b) => a + b;\n     *      var multiply = (a, b) => a * b;\n     *      var subtract = (a, b) => a - b;\n     *\n     *      //≅ multiply( add(1, 2), subtract(1, 2) );\n     *      R.converge(multiply, [add, subtract])(1, 2); //=> -3\n     *\n     *      var add3 = (a, b, c) => a + b + c;\n     *      R.converge(add3, [multiply, add, subtract])(1, 2); //=> 4\n     */\n    var converge = _curry2(function converge(after, fns) {\n        return curryN(reduce(max, 0, pluck('length', fns)), function () {\n            var args = arguments;\n            var context = this;\n            return after.apply(context, _map(function (fn) {\n                return fn.apply(context, args);\n            }, fns));\n        });\n    });\n\n    /**\n     * Counts the elements of a list according to how many match each value of a\n     * key generated by the supplied function. Returns an object mapping the keys\n     * produced by `fn` to the number of occurrences in the list. Note that all\n     * keys are coerced to strings because of how JavaScript objects work.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.1.0\n     * @category Relation\n     * @sig (a -> String) -> [a] -> {*}\n     * @param {Function} fn The function used to map values to keys.\n     * @param {Array} list The list to count elements from.\n     * @return {Object} An object mapping keys to number of occurrences in the list.\n     * @example\n     *\n     *      var numbers = [1.0, 1.1, 1.2, 2.0, 3.0, 2.2];\n     *      var letters = R.split('', 'abcABCaaaBBc');\n     *      R.countBy(Math.floor)(numbers);    //=> {'1': 3, '2': 2, '3': 1}\n     *      R.countBy(R.toLower)(letters);   //=> {'a': 5, 'b': 4, 'c': 3}\n     */\n    var countBy = reduceBy(function (acc, elem) {\n        return acc + 1;\n    }, 0);\n\n    /**\n     * Returns a new list without any consecutively repeating elements. Equality is\n     * determined by applying the supplied predicate two consecutive elements. The\n     * first element in a series of equal element is the one being preserved.\n     *\n     * Dispatches to the `dropRepeatsWith` method of the second argument, if present.\n     *\n     * Acts as a transducer if a transformer is given in list position.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.14.0\n     * @category List\n     * @sig (a, a -> Boolean) -> [a] -> [a]\n     * @param {Function} pred A predicate used to test whether two items are equal.\n     * @param {Array} list The array to consider.\n     * @return {Array} `list` without repeating elements.\n     * @see R.transduce\n     * @example\n     *\n     *      var l = [1, -1, 1, 3, 4, -4, -4, -5, 5, 3, 3];\n     *      R.dropRepeatsWith(R.eqBy(Math.abs), l); //=> [1, 3, 4, -5, 3]\n     */\n    var dropRepeatsWith = _curry2(_dispatchable('dropRepeatsWith', _xdropRepeatsWith, function dropRepeatsWith(pred, list) {\n        var result = [];\n        var idx = 1;\n        var len = list.length;\n        if (len !== 0) {\n            result[0] = list[0];\n            while (idx < len) {\n                if (!pred(last(result), list[idx])) {\n                    result[result.length] = list[idx];\n                }\n                idx += 1;\n            }\n        }\n        return result;\n    }));\n\n    /**\n     * Takes a function and two values in its domain and returns `true` if the\n     * values map to the same value in the codomain; `false` otherwise.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.18.0\n     * @category Relation\n     * @sig (a -> b) -> a -> a -> Boolean\n     * @param {Function} f\n     * @param {*} x\n     * @param {*} y\n     * @return {Boolean}\n     * @example\n     *\n     *      R.eqBy(Math.abs, 5, -5); //=> true\n     */\n    var eqBy = _curry3(function eqBy(f, x, y) {\n        return equals(f(x), f(y));\n    });\n\n    /**\n     * Reports whether two objects have the same value, in `R.equals` terms, for\n     * the specified property. Useful as a curried predicate.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.1.0\n     * @category Object\n     * @sig k -> {k: v} -> {k: v} -> Boolean\n     * @param {String} prop The name of the property to compare\n     * @param {Object} obj1\n     * @param {Object} obj2\n     * @return {Boolean}\n     *\n     * @example\n     *\n     *      var o1 = { a: 1, b: 2, c: 3, d: 4 };\n     *      var o2 = { a: 10, b: 20, c: 3, d: 40 };\n     *      R.eqProps('a', o1, o2); //=> false\n     *      R.eqProps('c', o1, o2); //=> true\n     */\n    var eqProps = _curry3(function eqProps(prop, obj1, obj2) {\n        return equals(obj1[prop], obj2[prop]);\n    });\n\n    /**\n     * Splits a list into sub-lists stored in an object, based on the result of\n     * calling a String-returning function on each element, and grouping the\n     * results according to values returned.\n     *\n     * Dispatches to the `groupBy` method of the second argument, if present.\n     *\n     * Acts as a transducer if a transformer is given in list position.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.1.0\n     * @category List\n     * @sig (a -> String) -> [a] -> {String: [a]}\n     * @param {Function} fn Function :: a -> String\n     * @param {Array} list The array to group\n     * @return {Object} An object with the output of `fn` for keys, mapped to arrays of elements\n     *         that produced that key when passed to `fn`.\n     * @see R.transduce\n     * @example\n     *\n     *      var byGrade = R.groupBy(function(student) {\n     *        var score = student.score;\n     *        return score < 65 ? 'F' :\n     *               score < 70 ? 'D' :\n     *               score < 80 ? 'C' :\n     *               score < 90 ? 'B' : 'A';\n     *      });\n     *      var students = [{name: 'Abby', score: 84},\n     *                      {name: 'Eddy', score: 58},\n     *                      // ...\n     *                      {name: 'Jack', score: 69}];\n     *      byGrade(students);\n     *      // {\n     *      //   'A': [{name: 'Dianne', score: 99}],\n     *      //   'B': [{name: 'Abby', score: 84}]\n     *      //   // ...,\n     *      //   'F': [{name: 'Eddy', score: 58}]\n     *      // }\n     */\n    var groupBy = _curry2(_dispatchable('groupBy', _xgroupBy, reduceBy(function (acc, item) {\n        if (acc == null) {\n            acc = [];\n        }\n        acc.push(item);\n        return acc;\n    }, null)));\n\n    /**\n     * Given a function that generates a key, turns a list of objects into an\n     * object indexing the objects by the given key. Note that if multiple\n     * objects generate the same value for the indexing key only the last value\n     * will be included in the generated object.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.19.0\n     * @category List\n     * @sig (a -> String) -> [{k: v}] -> {k: {k: v}}\n     * @param {Function} fn Function :: a -> String\n     * @param {Array} array The array of objects to index\n     * @return {Object} An object indexing each array element by the given property.\n     * @example\n     *\n     *      var list = [{id: 'xyz', title: 'A'}, {id: 'abc', title: 'B'}];\n     *      R.indexBy(R.prop('id'), list);\n     *      //=> {abc: {id: 'abc', title: 'B'}, xyz: {id: 'xyz', title: 'A'}}\n     */\n    var indexBy = reduceBy(function (acc, elem) {\n        return elem;\n    }, null);\n\n    /**\n     * Returns the position of the first occurrence of an item in an array, or -1\n     * if the item is not included in the array. `R.equals` is used to determine\n     * equality.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.1.0\n     * @category List\n     * @sig a -> [a] -> Number\n     * @param {*} target The item to find.\n     * @param {Array} xs The array to search in.\n     * @return {Number} the index of the target, or -1 if the target is not found.\n     * @see R.lastIndexOf\n     * @example\n     *\n     *      R.indexOf(3, [1,2,3,4]); //=> 2\n     *      R.indexOf(10, [1,2,3,4]); //=> -1\n     */\n    var indexOf = _curry2(function indexOf(target, xs) {\n        return typeof xs.indexOf === 'function' && !_isArray(xs) ? xs.indexOf(target) : _indexOf(xs, target, 0);\n    });\n\n    /**\n     * juxt applies a list of functions to a list of values.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.19.0\n     * @category Function\n     * @sig [(a, b, ..., m) -> n] -> ((a, b, ..., m) -> [n])\n     * @param {Array} fns An array of functions\n     * @return {Function} A function that returns a list of values after applying each of the original `fns` to its parameters.\n     * @see R.applySpec\n     * @example\n     *\n     *      var range = R.juxt([Math.min, Math.max]);\n     *      range(3, 4, 9, -3); //=> [-3, 9]\n     */\n    var juxt = _curry1(function juxt(fns) {\n        return converge(_arrayOf, fns);\n    });\n\n    /**\n     * Returns a lens for the given getter and setter functions. The getter \"gets\"\n     * the value of the focus; the setter \"sets\" the value of the focus. The setter\n     * should not mutate the data structure.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.8.0\n     * @category Object\n     * @typedefn Lens s a = Functor f => (a -> f a) -> s -> f s\n     * @sig (s -> a) -> ((a, s) -> s) -> Lens s a\n     * @param {Function} getter\n     * @param {Function} setter\n     * @return {Lens}\n     * @see R.view, R.set, R.over, R.lensIndex, R.lensProp\n     * @example\n     *\n     *      var xLens = R.lens(R.prop('x'), R.assoc('x'));\n     *\n     *      R.view(xLens, {x: 1, y: 2});            //=> 1\n     *      R.set(xLens, 4, {x: 1, y: 2});          //=> {x: 4, y: 2}\n     *      R.over(xLens, R.negate, {x: 1, y: 2});  //=> {x: -1, y: 2}\n     */\n    var lens = _curry2(function lens(getter, setter) {\n        return function (toFunctorFn) {\n            return function (target) {\n                return map(function (focus) {\n                    return setter(focus, target);\n                }, toFunctorFn(getter(target)));\n            };\n        };\n    });\n\n    /**\n     * Returns a lens whose focus is the specified index.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.14.0\n     * @category Object\n     * @typedefn Lens s a = Functor f => (a -> f a) -> s -> f s\n     * @sig Number -> Lens s a\n     * @param {Number} n\n     * @return {Lens}\n     * @see R.view, R.set, R.over\n     * @example\n     *\n     *      var headLens = R.lensIndex(0);\n     *\n     *      R.view(headLens, ['a', 'b', 'c']);            //=> 'a'\n     *      R.set(headLens, 'x', ['a', 'b', 'c']);        //=> ['x', 'b', 'c']\n     *      R.over(headLens, R.toUpper, ['a', 'b', 'c']); //=> ['A', 'b', 'c']\n     */\n    var lensIndex = _curry1(function lensIndex(n) {\n        return lens(nth(n), update(n));\n    });\n\n    /**\n     * Returns a lens whose focus is the specified path.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.19.0\n     * @category Object\n     * @typedefn Lens s a = Functor f => (a -> f a) -> s -> f s\n     * @sig [String] -> Lens s a\n     * @param {Array} path The path to use.\n     * @return {Lens}\n     * @see R.view, R.set, R.over\n     * @example\n     *\n     *      var xyLens = R.lensPath(['x', 'y']);\n     *\n     *      R.view(xyLens, {x: {y: 2, z: 3}});            //=> 2\n     *      R.set(xyLens, 4, {x: {y: 2, z: 3}});          //=> {x: {y: 4, z: 3}}\n     *      R.over(xyLens, R.negate, {x: {y: 2, z: 3}});  //=> {x: {y: -2, z: 3}}\n     */\n    var lensPath = _curry1(function lensPath(p) {\n        return lens(path(p), assocPath(p));\n    });\n\n    /**\n     * Returns a lens whose focus is the specified property.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.14.0\n     * @category Object\n     * @typedefn Lens s a = Functor f => (a -> f a) -> s -> f s\n     * @sig String -> Lens s a\n     * @param {String} k\n     * @return {Lens}\n     * @see R.view, R.set, R.over\n     * @example\n     *\n     *      var xLens = R.lensProp('x');\n     *\n     *      R.view(xLens, {x: 1, y: 2});            //=> 1\n     *      R.set(xLens, 4, {x: 1, y: 2});          //=> {x: 4, y: 2}\n     *      R.over(xLens, R.negate, {x: 1, y: 2});  //=> {x: -1, y: 2}\n     */\n    var lensProp = _curry1(function lensProp(k) {\n        return lens(prop(k), assoc(k));\n    });\n\n    /**\n     * \"lifts\" a function to be the specified arity, so that it may \"map over\" that\n     * many lists, Functions or other objects that satisfy the [FantasyLand Apply spec](https://github.com/fantasyland/fantasy-land#apply).\n     *\n     * @func\n     * @memberOf R\n     * @since v0.7.0\n     * @category Function\n     * @sig Number -> (*... -> *) -> ([*]... -> [*])\n     * @param {Function} fn The function to lift into higher context\n     * @return {Function} The lifted function.\n     * @see R.lift, R.ap\n     * @example\n     *\n     *      var madd3 = R.liftN(3, R.curryN(3, (...args) => R.sum(args)));\n     *      madd3([1,2,3], [1,2,3], [1]); //=> [3, 4, 5, 4, 5, 6, 5, 6, 7]\n     */\n    var liftN = _curry2(function liftN(arity, fn) {\n        var lifted = curryN(arity, fn);\n        return curryN(arity, function () {\n            return _reduce(ap, map(lifted, arguments[0]), _slice(arguments, 1));\n        });\n    });\n\n    /**\n     * Returns the mean of the given list of numbers.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.14.0\n     * @category Math\n     * @sig [Number] -> Number\n     * @param {Array} list\n     * @return {Number}\n     * @example\n     *\n     *      R.mean([2, 7, 9]); //=> 6\n     *      R.mean([]); //=> NaN\n     */\n    var mean = _curry1(function mean(list) {\n        return sum(list) / list.length;\n    });\n\n    /**\n     * Returns the median of the given list of numbers.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.14.0\n     * @category Math\n     * @sig [Number] -> Number\n     * @param {Array} list\n     * @return {Number}\n     * @example\n     *\n     *      R.median([2, 9, 7]); //=> 7\n     *      R.median([7, 2, 10, 9]); //=> 8\n     *      R.median([]); //=> NaN\n     */\n    var median = _curry1(function median(list) {\n        var len = list.length;\n        if (len === 0) {\n            return NaN;\n        }\n        var width = 2 - len % 2;\n        var idx = (len - width) / 2;\n        return mean(_slice(list).sort(function (a, b) {\n            return a < b ? -1 : a > b ? 1 : 0;\n        }).slice(idx, idx + width));\n    });\n\n    /**\n     * Takes a predicate and a list or other \"filterable\" object and returns the\n     * pair of filterable objects of the same type of elements which do and do not\n     * satisfy, the predicate, respectively.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.1.4\n     * @category List\n     * @sig Filterable f => (a -> Boolean) -> f a -> [f a, f a]\n     * @param {Function} pred A predicate to determine which side the element belongs to.\n     * @param {Array} filterable the list (or other filterable) to partition.\n     * @return {Array} An array, containing first the subset of elements that satisfy the\n     *         predicate, and second the subset of elements that do not satisfy.\n     * @see R.filter, R.reject\n     * @example\n     *\n     *      R.partition(R.contains('s'), ['sss', 'ttt', 'foo', 'bars']);\n     *      // => [ [ 'sss', 'bars' ],  [ 'ttt', 'foo' ] ]\n     *\n     *      R.partition(R.contains('s'), { a: 'sss', b: 'ttt', foo: 'bars' });\n     *      // => [ { a: 'sss', foo: 'bars' }, { b: 'ttt' }  ]\n     */\n    var partition = juxt([\n        filter,\n        reject\n    ]);\n\n    /**\n     * Performs left-to-right function composition. The leftmost function may have\n     * any arity; the remaining functions must be unary.\n     *\n     * In some libraries this function is named `sequence`.\n     *\n     * **Note:** The result of pipe is not automatically curried.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.1.0\n     * @category Function\n     * @sig (((a, b, ..., n) -> o), (o -> p), ..., (x -> y), (y -> z)) -> ((a, b, ..., n) -> z)\n     * @param {...Function} functions\n     * @return {Function}\n     * @see R.compose\n     * @example\n     *\n     *      var f = R.pipe(Math.pow, R.negate, R.inc);\n     *\n     *      f(3, 4); // -(3^4) + 1\n     */\n    var pipe = function pipe() {\n        if (arguments.length === 0) {\n            throw new Error('pipe requires at least one argument');\n        }\n        return _arity(arguments[0].length, reduce(_pipe, arguments[0], tail(arguments)));\n    };\n\n    /**\n     * Performs left-to-right composition of one or more Promise-returning\n     * functions. The leftmost function may have any arity; the remaining functions\n     * must be unary.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.10.0\n     * @category Function\n     * @sig ((a -> Promise b), (b -> Promise c), ..., (y -> Promise z)) -> (a -> Promise z)\n     * @param {...Function} functions\n     * @return {Function}\n     * @see R.composeP\n     * @example\n     *\n     *      //  followersForUser :: String -> Promise [User]\n     *      var followersForUser = R.pipeP(db.getUserById, db.getFollowers);\n     */\n    var pipeP = function pipeP() {\n        if (arguments.length === 0) {\n            throw new Error('pipeP requires at least one argument');\n        }\n        return _arity(arguments[0].length, reduce(_pipeP, arguments[0], tail(arguments)));\n    };\n\n    /**\n     * Multiplies together all the elements of a list.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.1.0\n     * @category Math\n     * @sig [Number] -> Number\n     * @param {Array} list An array of numbers\n     * @return {Number} The product of all the numbers in the list.\n     * @see R.reduce\n     * @example\n     *\n     *      R.product([2,4,6,8,100,1]); //=> 38400\n     */\n    var product = reduce(multiply, 1);\n\n    /**\n     * Transforms a [Traversable](https://github.com/fantasyland/fantasy-land#traversable)\n     * of [Applicative](https://github.com/fantasyland/fantasy-land#applicative) into an\n     * Applicative of Traversable.\n     *\n     * Dispatches to the `sequence` method of the second argument, if present.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.19.0\n     * @category List\n     * @sig (Applicative f, Traversable t) => (a -> f a) -> t (f a) -> f (t a)\n     * @param {Function} of\n     * @param {*} traversable\n     * @return {*}\n     * @see R.traverse\n     * @example\n     *\n     *      R.sequence(Maybe.of, [Just(1), Just(2), Just(3)]);   //=> Just([1, 2, 3])\n     *      R.sequence(Maybe.of, [Just(1), Just(2), Nothing()]); //=> Nothing()\n     *\n     *      R.sequence(R.of, Just([1, 2, 3])); //=> [Just(1), Just(2), Just(3)]\n     *      R.sequence(R.of, Nothing());       //=> [Nothing()]\n     */\n    var sequence = _curry2(function sequence(of, traversable) {\n        return typeof traversable.sequence === 'function' ? traversable.sequence(of) : reduceRight(function (acc, x) {\n            return ap(map(prepend, x), acc);\n        }, of([]), traversable);\n    });\n\n    /**\n     * Maps an [Applicative](https://github.com/fantasyland/fantasy-land#applicative)-returning\n     * function over a [Traversable](https://github.com/fantasyland/fantasy-land#traversable),\n     * then uses [`sequence`](#sequence) to transform the resulting Traversable of Applicative\n     * into an Applicative of Traversable.\n     *\n     * Dispatches to the `sequence` method of the third argument, if present.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.19.0\n     * @category List\n     * @sig (Applicative f, Traversable t) => (a -> f a) -> (a -> f b) -> t a -> f (t b)\n     * @param {Function} of\n     * @param {Function} f\n     * @param {*} traversable\n     * @return {*}\n     * @see R.sequence\n     * @example\n     *\n     *      // Returns `Nothing` if the given divisor is `0`\n     *      safeDiv = n => d => d === 0 ? Nothing() : Just(n / d)\n     *\n     *      R.traverse(Maybe.of, safeDiv(10), [2, 4, 5]); //=> Just([5, 2.5, 2])\n     *      R.traverse(Maybe.of, safeDiv(10), [2, 0, 5]); //=> Nothing\n     */\n    var traverse = _curry3(function traverse(of, f, traversable) {\n        return sequence(of, map(f, traversable));\n    });\n\n    /**\n     * Shorthand for `R.chain(R.identity)`, which removes one level of nesting from\n     * any [Chain](https://github.com/fantasyland/fantasy-land#chain).\n     *\n     * @func\n     * @memberOf R\n     * @since v0.3.0\n     * @category List\n     * @sig Chain c => c (c a) -> c a\n     * @param {*} list\n     * @return {*}\n     * @see R.flatten, R.chain\n     * @example\n     *\n     *      R.unnest([1, [2], [[3]]]); //=> [1, 2, [3]]\n     *      R.unnest([[1, 2], [3, 4], [5, 6]]); //=> [1, 2, 3, 4, 5, 6]\n     */\n    var unnest = chain(_identity);\n\n    var _contains = function _contains(a, list) {\n        return _indexOf(list, a, 0) >= 0;\n    };\n\n    //  mapPairs :: (Object, [String]) -> [String]\n    var _toString = function _toString(x, seen) {\n        var recur = function recur(y) {\n            var xs = seen.concat([x]);\n            return _contains(y, xs) ? '<Circular>' : _toString(y, xs);\n        };\n        //  mapPairs :: (Object, [String]) -> [String]\n        var mapPairs = function (obj, keys) {\n            return _map(function (k) {\n                return _quote(k) + ': ' + recur(obj[k]);\n            }, keys.slice().sort());\n        };\n        switch (Object.prototype.toString.call(x)) {\n        case '[object Arguments]':\n            return '(function() { return arguments; }(' + _map(recur, x).join(', ') + '))';\n        case '[object Array]':\n            return '[' + _map(recur, x).concat(mapPairs(x, reject(function (k) {\n                return /^\\d+$/.test(k);\n            }, keys(x)))).join(', ') + ']';\n        case '[object Boolean]':\n            return typeof x === 'object' ? 'new Boolean(' + recur(x.valueOf()) + ')' : x.toString();\n        case '[object Date]':\n            return 'new Date(' + (isNaN(x.valueOf()) ? recur(NaN) : _quote(_toISOString(x))) + ')';\n        case '[object Null]':\n            return 'null';\n        case '[object Number]':\n            return typeof x === 'object' ? 'new Number(' + recur(x.valueOf()) + ')' : 1 / x === -Infinity ? '-0' : x.toString(10);\n        case '[object String]':\n            return typeof x === 'object' ? 'new String(' + recur(x.valueOf()) + ')' : _quote(x);\n        case '[object Undefined]':\n            return 'undefined';\n        default:\n            if (typeof x.toString === 'function') {\n                var repr = x.toString();\n                if (repr !== '[object Object]') {\n                    return repr;\n                }\n            }\n            return '{' + mapPairs(x, keys(x)).join(', ') + '}';\n        }\n    };\n\n    /**\n     * Performs right-to-left function composition. The rightmost function may have\n     * any arity; the remaining functions must be unary.\n     *\n     * **Note:** The result of compose is not automatically curried.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.1.0\n     * @category Function\n     * @sig ((y -> z), (x -> y), ..., (o -> p), ((a, b, ..., n) -> o)) -> ((a, b, ..., n) -> z)\n     * @param {...Function} functions\n     * @return {Function}\n     * @see R.pipe\n     * @example\n     *\n     *      var f = R.compose(R.inc, R.negate, Math.pow);\n     *\n     *      f(3, 4); // -(3^4) + 1\n     */\n    var compose = function compose() {\n        if (arguments.length === 0) {\n            throw new Error('compose requires at least one argument');\n        }\n        return pipe.apply(this, reverse(arguments));\n    };\n\n    /**\n     * Returns the right-to-left Kleisli composition of the provided functions,\n     * each of which must return a value of a type supported by [`chain`](#chain).\n     *\n     * `R.composeK(h, g, f)` is equivalent to `R.compose(R.chain(h), R.chain(g), R.chain(f))`.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.16.0\n     * @category Function\n     * @sig Chain m => ((y -> m z), (x -> m y), ..., (a -> m b)) -> (m a -> m z)\n     * @param {...Function}\n     * @return {Function}\n     * @see R.pipeK\n     * @example\n     *\n     *      //  parseJson :: String -> Maybe *\n     *      //  get :: String -> Object -> Maybe *\n     *\n     *      //  getStateCode :: Maybe String -> Maybe String\n     *      var getStateCode = R.composeK(\n     *        R.compose(Maybe.of, R.toUpper),\n     *        get('state'),\n     *        get('address'),\n     *        get('user'),\n     *        parseJson\n     *      );\n     *\n     *      getStateCode(Maybe.of('{\"user\":{\"address\":{\"state\":\"ny\"}}}'));\n     *      //=> Just('NY')\n     *      getStateCode(Maybe.of('[Invalid JSON]'));\n     *      //=> Nothing()\n     */\n    var composeK = function composeK() {\n        return compose.apply(this, prepend(identity, map(chain, arguments)));\n    };\n\n    /**\n     * Performs right-to-left composition of one or more Promise-returning\n     * functions. The rightmost function may have any arity; the remaining\n     * functions must be unary.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.10.0\n     * @category Function\n     * @sig ((y -> Promise z), (x -> Promise y), ..., (a -> Promise b)) -> (a -> Promise z)\n     * @param {...Function} functions\n     * @return {Function}\n     * @see R.pipeP\n     * @example\n     *\n     *      //  followersForUser :: String -> Promise [User]\n     *      var followersForUser = R.composeP(db.getFollowers, db.getUserById);\n     */\n    var composeP = function composeP() {\n        if (arguments.length === 0) {\n            throw new Error('composeP requires at least one argument');\n        }\n        return pipeP.apply(this, reverse(arguments));\n    };\n\n    /**\n     * Wraps a constructor function inside a curried function that can be called\n     * with the same arguments and returns the same type.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.1.0\n     * @category Function\n     * @sig (* -> {*}) -> (* -> {*})\n     * @param {Function} Fn The constructor function to wrap.\n     * @return {Function} A wrapped, curried constructor function.\n     * @example\n     *\n     *      // Constructor function\n     *      var Widget = config => {\n     *        // ...\n     *      };\n     *      Widget.prototype = {\n     *        // ...\n     *      };\n     *      var allConfigs = [\n     *        // ...\n     *      ];\n     *      R.map(R.construct(Widget), allConfigs); // a list of Widgets\n     */\n    var construct = _curry1(function construct(Fn) {\n        return constructN(Fn.length, Fn);\n    });\n\n    /**\n     * Returns `true` if the specified value is equal, in `R.equals` terms, to at\n     * least one element of the given list; `false` otherwise.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.1.0\n     * @category List\n     * @sig a -> [a] -> Boolean\n     * @param {Object} a The item to compare against.\n     * @param {Array} list The array to consider.\n     * @return {Boolean} `true` if the item is in the list, `false` otherwise.\n     * @see R.any\n     * @example\n     *\n     *      R.contains(3, [1, 2, 3]); //=> true\n     *      R.contains(4, [1, 2, 3]); //=> false\n     *      R.contains([42], [[42]]); //=> true\n     */\n    var contains = _curry2(_contains);\n\n    /**\n     * Finds the set (i.e. no duplicates) of all elements in the first list not\n     * contained in the second list.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.1.0\n     * @category Relation\n     * @sig [*] -> [*] -> [*]\n     * @param {Array} list1 The first list.\n     * @param {Array} list2 The second list.\n     * @return {Array} The elements in `list1` that are not in `list2`.\n     * @see R.differenceWith\n     * @example\n     *\n     *      R.difference([1,2,3,4], [7,6,5,4,3]); //=> [1,2]\n     *      R.difference([7,6,5,4,3], [1,2,3,4]); //=> [7,6,5]\n     */\n    var difference = _curry2(function difference(first, second) {\n        var out = [];\n        var idx = 0;\n        var firstLen = first.length;\n        while (idx < firstLen) {\n            if (!_contains(first[idx], second) && !_contains(first[idx], out)) {\n                out[out.length] = first[idx];\n            }\n            idx += 1;\n        }\n        return out;\n    });\n\n    /**\n     * Returns a new list without any consecutively repeating elements. `R.equals`\n     * is used to determine equality.\n     *\n     * Dispatches to the `dropRepeats` method of the first argument, if present.\n     *\n     * Acts as a transducer if a transformer is given in list position.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.14.0\n     * @category List\n     * @sig [a] -> [a]\n     * @param {Array} list The array to consider.\n     * @return {Array} `list` without repeating elements.\n     * @see R.transduce\n     * @example\n     *\n     *     R.dropRepeats([1, 1, 1, 2, 3, 4, 4, 2, 2]); //=> [1, 2, 3, 4, 2]\n     */\n    var dropRepeats = _curry1(_dispatchable('dropRepeats', _xdropRepeatsWith(equals), dropRepeatsWith(equals)));\n\n    /**\n     * \"lifts\" a function of arity > 1 so that it may \"map over\" a list, Function or other\n     * object that satisfies the [FantasyLand Apply spec](https://github.com/fantasyland/fantasy-land#apply).\n     *\n     * @func\n     * @memberOf R\n     * @since v0.7.0\n     * @category Function\n     * @sig (*... -> *) -> ([*]... -> [*])\n     * @param {Function} fn The function to lift into higher context\n     * @return {Function} The lifted function.\n     * @see R.liftN\n     * @example\n     *\n     *      var madd3 = R.lift(R.curry((a, b, c) => a + b + c));\n     *\n     *      madd3([1,2,3], [1,2,3], [1]); //=> [3, 4, 5, 4, 5, 6, 5, 6, 7]\n     *\n     *      var madd5 = R.lift(R.curry((a, b, c, d, e) => a + b + c + d + e));\n     *\n     *      madd5([1,2], [3], [4, 5], [6], [7, 8]); //=> [21, 22, 22, 23, 22, 23, 23, 24]\n     */\n    var lift = _curry1(function lift(fn) {\n        return liftN(fn.length, fn);\n    });\n\n    /**\n     * Returns a partial copy of an object omitting the keys specified.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.1.0\n     * @category Object\n     * @sig [String] -> {String: *} -> {String: *}\n     * @param {Array} names an array of String property names to omit from the new object\n     * @param {Object} obj The object to copy from\n     * @return {Object} A new object with properties from `names` not on it.\n     * @see R.pick\n     * @example\n     *\n     *      R.omit(['a', 'd'], {a: 1, b: 2, c: 3, d: 4}); //=> {b: 2, c: 3}\n     */\n    var omit = _curry2(function omit(names, obj) {\n        var result = {};\n        for (var prop in obj) {\n            if (!_contains(prop, names)) {\n                result[prop] = obj[prop];\n            }\n        }\n        return result;\n    });\n\n    /**\n     * Returns the left-to-right Kleisli composition of the provided functions,\n     * each of which must return a value of a type supported by [`chain`](#chain).\n     *\n     * `R.pipeK(f, g, h)` is equivalent to `R.pipe(R.chain(f), R.chain(g), R.chain(h))`.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.16.0\n     * @category Function\n     * @sig Chain m => ((a -> m b), (b -> m c), ..., (y -> m z)) -> (m a -> m z)\n     * @param {...Function}\n     * @return {Function}\n     * @see R.composeK\n     * @example\n     *\n     *      //  parseJson :: String -> Maybe *\n     *      //  get :: String -> Object -> Maybe *\n     *\n     *      //  getStateCode :: Maybe String -> Maybe String\n     *      var getStateCode = R.pipeK(\n     *        parseJson,\n     *        get('user'),\n     *        get('address'),\n     *        get('state'),\n     *        R.compose(Maybe.of, R.toUpper)\n     *      );\n     *\n     *      getStateCode(Maybe.of('{\"user\":{\"address\":{\"state\":\"ny\"}}}'));\n     *      //=> Just('NY')\n     *      getStateCode(Maybe.of('[Invalid JSON]'));\n     *      //=> Nothing()\n     */\n    var pipeK = function pipeK() {\n        return composeK.apply(this, reverse(arguments));\n    };\n\n    /**\n     * Returns the string representation of the given value. `eval`'ing the output\n     * should result in a value equivalent to the input value. Many of the built-in\n     * `toString` methods do not satisfy this requirement.\n     *\n     * If the given value is an `[object Object]` with a `toString` method other\n     * than `Object.prototype.toString`, this method is invoked with no arguments\n     * to produce the return value. This means user-defined constructor functions\n     * can provide a suitable `toString` method. For example:\n     *\n     *     function Point(x, y) {\n     *       this.x = x;\n     *       this.y = y;\n     *     }\n     *\n     *     Point.prototype.toString = function() {\n     *       return 'new Point(' + this.x + ', ' + this.y + ')';\n     *     };\n     *\n     *     R.toString(new Point(1, 2)); //=> 'new Point(1, 2)'\n     *\n     * @func\n     * @memberOf R\n     * @since v0.14.0\n     * @category String\n     * @sig * -> String\n     * @param {*} val\n     * @return {String}\n     * @example\n     *\n     *      R.toString(42); //=> '42'\n     *      R.toString('abc'); //=> '\"abc\"'\n     *      R.toString([1, 2, 3]); //=> '[1, 2, 3]'\n     *      R.toString({foo: 1, bar: 2, baz: 3}); //=> '{\"bar\": 2, \"baz\": 3, \"foo\": 1}'\n     *      R.toString(new Date('2001-02-03T04:05:06Z')); //=> 'new Date(\"2001-02-03T04:05:06.000Z\")'\n     */\n    var toString = _curry1(function toString(val) {\n        return _toString(val, []);\n    });\n\n    /**\n     * Returns a new list without values in the first argument.\n     * `R.equals` is used to determine equality.\n     *\n     * Acts as a transducer if a transformer is given in list position.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.19.0\n     * @category List\n     * @sig [a] -> [a] -> [a]\n     * @param {Array} list1 The values to be removed from `list2`.\n     * @param {Array} list2 The array to remove values from.\n     * @return {Array} The new array without values in `list1`.\n     * @see R.transduce\n     * @example\n     *\n     *      R.without([1, 2], [1, 2, 1, 3, 4]); //=> [3, 4]\n     */\n    var without = _curry2(function (xs, list) {\n        return reject(flip(_contains)(xs), list);\n    });\n\n    // A simple Set type that honours R.equals semantics\n    /* globals Set */\n    /**\n       * Combines the logic for checking whether an item is a member of the set and\n       * for adding a new item to the set.\n       *\n       * @param item       The item to check or add to the Set instance.\n       * @param shouldAdd  If true, the item will be added to the set if it doesn't\n       *                   already exist.\n       * @param set        The set instance to check or add to.\n       * @return {boolean} When shouldAdd is true, this will return true when a new\n       *                   item was added otherwise false. When shouldAdd is false,\n       *                   this will return true if the item already exists, otherwise\n       *                   false.\n       */\n    // distinguish between +0 and -0\n    // these types can all utilise Set\n    // set._items['boolean'] holds a two element array\n    // representing [ falseExists, trueExists ]\n    // compare functions for reference equality\n    /* falls through */\n    // reduce the search size of heterogeneous sets by creating buckets\n    // for each type.\n    // scan through all previously applied items\n    var _Set = function () {\n        function _Set() {\n            /* globals Set */\n            this._nativeSet = typeof Set === 'function' ? new Set() : null;\n            this._items = {};\n        }\n        _Set.prototype.add = function (item) {\n            return hasOrAdd(item, true, this);\n        };\n        _Set.prototype.has = function (item) {\n            return hasOrAdd(item, false, this);\n        };\n        /**\n       * Combines the logic for checking whether an item is a member of the set and\n       * for adding a new item to the set.\n       *\n       * @param item       The item to check or add to the Set instance.\n       * @param shouldAdd  If true, the item will be added to the set if it doesn't\n       *                   already exist.\n       * @param set        The set instance to check or add to.\n       * @return {boolean} When shouldAdd is true, this will return true when a new\n       *                   item was added otherwise false. When shouldAdd is false,\n       *                   this will return true if the item already exists, otherwise\n       *                   false.\n       */\n        function hasOrAdd(item, shouldAdd, set) {\n            var type = typeof item;\n            var prevSize, newSize;\n            switch (type) {\n            case 'string':\n            case 'number':\n                // distinguish between +0 and -0\n                if (item === 0 && !set._items['-0'] && 1 / item === -Infinity) {\n                    if (shouldAdd) {\n                        set._items['-0'] = true;\n                    }\n                    return shouldAdd;\n                }\n                // these types can all utilise Set\n                if (set._nativeSet !== null) {\n                    if (shouldAdd) {\n                        prevSize = set._nativeSet.size;\n                        set._nativeSet.add(item);\n                        newSize = set._nativeSet.size;\n                        return newSize > prevSize;\n                    } else {\n                        return set._nativeSet.has(item);\n                    }\n                } else {\n                    if (!(type in set._items)) {\n                        if (shouldAdd) {\n                            set._items[type] = {};\n                            set._items[type][item] = true;\n                        }\n                        return shouldAdd;\n                    } else if (item in set._items[type]) {\n                        return !shouldAdd;\n                    } else {\n                        if (shouldAdd) {\n                            set._items[type][item] = true;\n                        }\n                        return shouldAdd;\n                    }\n                }\n            case 'boolean':\n                // set._items['boolean'] holds a two element array\n                // representing [ falseExists, trueExists ]\n                if (type in set._items) {\n                    var bIdx = item ? 1 : 0;\n                    if (set._items[type][bIdx]) {\n                        return !shouldAdd;\n                    } else {\n                        if (shouldAdd) {\n                            set._items[type][bIdx] = true;\n                        }\n                        return shouldAdd;\n                    }\n                } else {\n                    if (shouldAdd) {\n                        set._items[type] = item ? [\n                            false,\n                            true\n                        ] : [\n                            true,\n                            false\n                        ];\n                    }\n                    return shouldAdd;\n                }\n            case 'function':\n                // compare functions for reference equality\n                if (set._nativeSet !== null) {\n                    if (shouldAdd) {\n                        prevSize = set._nativeSet.size;\n                        set._nativeSet.add(item);\n                        newSize = set._nativeSet.size;\n                        return newSize > prevSize;\n                    } else {\n                        return set._nativeSet.has(item);\n                    }\n                } else {\n                    if (!(type in set._items)) {\n                        if (shouldAdd) {\n                            set._items[type] = [item];\n                        }\n                        return shouldAdd;\n                    }\n                    if (!_contains(item, set._items[type])) {\n                        if (shouldAdd) {\n                            set._items[type].push(item);\n                        }\n                        return shouldAdd;\n                    }\n                }\n                return !shouldAdd;\n            case 'undefined':\n                if (set._items[type]) {\n                    return !shouldAdd;\n                } else {\n                    if (shouldAdd) {\n                        set._items[type] = true;\n                    }\n                    return shouldAdd;\n                }\n            case 'object':\n                if (item === null) {\n                    if (!set._items['null']) {\n                        if (shouldAdd) {\n                            set._items['null'] = true;\n                        }\n                        return shouldAdd;\n                    }\n                    return !shouldAdd;\n                }\n            /* falls through */\n            default:\n                // reduce the search size of heterogeneous sets by creating buckets\n                // for each type.\n                type = Object.prototype.toString.call(item);\n                if (!(type in set._items)) {\n                    if (shouldAdd) {\n                        set._items[type] = [item];\n                    }\n                    return shouldAdd;\n                }\n                // scan through all previously applied items\n                if (!_contains(item, set._items[type])) {\n                    if (shouldAdd) {\n                        set._items[type].push(item);\n                    }\n                    return shouldAdd;\n                }\n                return !shouldAdd;\n            }\n        }\n        return _Set;\n    }();\n\n    /**\n     * A function wrapping calls to the two functions in an `&&` operation,\n     * returning the result of the first function if it is false-y and the result\n     * of the second function otherwise. Note that this is short-circuited,\n     * meaning that the second function will not be invoked if the first returns a\n     * false-y value.\n     *\n     * In addition to functions, `R.both` also accepts any fantasy-land compatible\n     * applicative functor.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.12.0\n     * @category Logic\n     * @sig (*... -> Boolean) -> (*... -> Boolean) -> (*... -> Boolean)\n     * @param {Function} f a predicate\n     * @param {Function} g another predicate\n     * @return {Function} a function that applies its arguments to `f` and `g` and `&&`s their outputs together.\n     * @see R.and\n     * @example\n     *\n     *      var gt10 = x => x > 10;\n     *      var even = x => x % 2 === 0;\n     *      var f = R.both(gt10, even);\n     *      f(100); //=> true\n     *      f(101); //=> false\n     */\n    var both = _curry2(function both(f, g) {\n        return _isFunction(f) ? function _both() {\n            return f.apply(this, arguments) && g.apply(this, arguments);\n        } : lift(and)(f, g);\n    });\n\n    /**\n     * Takes a function `f` and returns a function `g` such that:\n     *\n     *   - applying `g` to zero or more arguments will give __true__ if applying\n     *     the same arguments to `f` gives a logical __false__ value; and\n     *\n     *   - applying `g` to zero or more arguments will give __false__ if applying\n     *     the same arguments to `f` gives a logical __true__ value.\n     *\n     * `R.complement` will work on all other functors as well.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.12.0\n     * @category Logic\n     * @sig (*... -> *) -> (*... -> Boolean)\n     * @param {Function} f\n     * @return {Function}\n     * @see R.not\n     * @example\n     *\n     *      var isEven = n => n % 2 === 0;\n     *      var isOdd = R.complement(isEven);\n     *      isOdd(21); //=> true\n     *      isOdd(42); //=> false\n     */\n    var complement = lift(not);\n\n    /**\n     * A function wrapping calls to the two functions in an `||` operation,\n     * returning the result of the first function if it is truth-y and the result\n     * of the second function otherwise. Note that this is short-circuited,\n     * meaning that the second function will not be invoked if the first returns a\n     * truth-y value.\n     *\n     * In addition to functions, `R.either` also accepts any fantasy-land compatible\n     * applicative functor.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.12.0\n     * @category Logic\n     * @sig (*... -> Boolean) -> (*... -> Boolean) -> (*... -> Boolean)\n     * @param {Function} f a predicate\n     * @param {Function} g another predicate\n     * @return {Function} a function that applies its arguments to `f` and `g` and `||`s their outputs together.\n     * @see R.or\n     * @example\n     *\n     *      var gt10 = x => x > 10;\n     *      var even = x => x % 2 === 0;\n     *      var f = R.either(gt10, even);\n     *      f(101); //=> true\n     *      f(8); //=> true\n     */\n    var either = _curry2(function either(f, g) {\n        return _isFunction(f) ? function _either() {\n            return f.apply(this, arguments) || g.apply(this, arguments);\n        } : lift(or)(f, g);\n    });\n\n    /**\n     * Turns a named method with a specified arity into a function that can be\n     * called directly supplied with arguments and a target object.\n     *\n     * The returned function is curried and accepts `arity + 1` parameters where\n     * the final parameter is the target object.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.1.0\n     * @category Function\n     * @sig Number -> String -> (a -> b -> ... -> n -> Object -> *)\n     * @param {Number} arity Number of arguments the returned function should take\n     *        before the target object.\n     * @param {String} method Name of the method to call.\n     * @return {Function} A new curried function.\n     * @example\n     *\n     *      var sliceFrom = R.invoker(1, 'slice');\n     *      sliceFrom(6, 'abcdefghijklm'); //=> 'ghijklm'\n     *      var sliceFrom6 = R.invoker(2, 'slice')(6);\n     *      sliceFrom6(8, 'abcdefghijklm'); //=> 'gh'\n     */\n    var invoker = _curry2(function invoker(arity, method) {\n        return curryN(arity + 1, function () {\n            var target = arguments[arity];\n            if (target != null && is(Function, target[method])) {\n                return target[method].apply(target, _slice(arguments, 0, arity));\n            }\n            throw new TypeError(toString(target) + ' does not have a method named \"' + method + '\"');\n        });\n    });\n\n    /**\n     * Returns a string made by inserting the `separator` between each element and\n     * concatenating all the elements into a single string.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.1.0\n     * @category List\n     * @sig String -> [a] -> String\n     * @param {Number|String} separator The string used to separate the elements.\n     * @param {Array} xs The elements to join into a string.\n     * @return {String} str The string made by concatenating `xs` with `separator`.\n     * @see R.split\n     * @example\n     *\n     *      var spacer = R.join(' ');\n     *      spacer(['a', 2, 3.4]);   //=> 'a 2 3.4'\n     *      R.join('|', [1, 2, 3]);    //=> '1|2|3'\n     */\n    var join = invoker(1, 'join');\n\n    /**\n     * Creates a new function that, when invoked, caches the result of calling `fn`\n     * for a given argument set and returns the result. Subsequent calls to the\n     * memoized `fn` with the same argument set will not result in an additional\n     * call to `fn`; instead, the cached result for that set of arguments will be\n     * returned.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.1.0\n     * @category Function\n     * @sig (*... -> a) -> (*... -> a)\n     * @param {Function} fn The function to memoize.\n     * @return {Function} Memoized version of `fn`.\n     * @example\n     *\n     *      var count = 0;\n     *      var factorial = R.memoize(n => {\n     *        count += 1;\n     *        return R.product(R.range(1, n + 1));\n     *      });\n     *      factorial(5); //=> 120\n     *      factorial(5); //=> 120\n     *      factorial(5); //=> 120\n     *      count; //=> 1\n     */\n    var memoize = _curry1(function memoize(fn) {\n        var cache = {};\n        return _arity(fn.length, function () {\n            var key = toString(arguments);\n            if (!_has(key, cache)) {\n                cache[key] = fn.apply(this, arguments);\n            }\n            return cache[key];\n        });\n    });\n\n    /**\n     * Splits a string into an array of strings based on the given\n     * separator.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.1.0\n     * @category String\n     * @sig (String | RegExp) -> String -> [String]\n     * @param {String|RegExp} sep The pattern.\n     * @param {String} str The string to separate into an array.\n     * @return {Array} The array of strings from `str` separated by `str`.\n     * @see R.join\n     * @example\n     *\n     *      var pathComponents = R.split('/');\n     *      R.tail(pathComponents('/usr/local/bin/node')); //=> ['usr', 'local', 'bin', 'node']\n     *\n     *      R.split('.', 'a.b.c.xyz.d'); //=> ['a', 'b', 'c', 'xyz', 'd']\n     */\n    var split = invoker(1, 'split');\n\n    /**\n     * Determines whether a given string matches a given regular expression.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.12.0\n     * @category String\n     * @sig RegExp -> String -> Boolean\n     * @param {RegExp} pattern\n     * @param {String} str\n     * @return {Boolean}\n     * @see R.match\n     * @example\n     *\n     *      R.test(/^x/, 'xyz'); //=> true\n     *      R.test(/^y/, 'xyz'); //=> false\n     */\n    var test = _curry2(function test(pattern, str) {\n        if (!_isRegExp(pattern)) {\n            throw new TypeError('\\u2018test\\u2019 requires a value of type RegExp as its first argument; received ' + toString(pattern));\n        }\n        return _cloneRegExp(pattern).test(str);\n    });\n\n    /**\n     * The lower case version of a string.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.9.0\n     * @category String\n     * @sig String -> String\n     * @param {String} str The string to lower case.\n     * @return {String} The lower case version of `str`.\n     * @see R.toUpper\n     * @example\n     *\n     *      R.toLower('XYZ'); //=> 'xyz'\n     */\n    var toLower = invoker(0, 'toLowerCase');\n\n    /**\n     * The upper case version of a string.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.9.0\n     * @category String\n     * @sig String -> String\n     * @param {String} str The string to upper case.\n     * @return {String} The upper case version of `str`.\n     * @see R.toLower\n     * @example\n     *\n     *      R.toUpper('abc'); //=> 'ABC'\n     */\n    var toUpper = invoker(0, 'toUpperCase');\n\n    /**\n     * Returns a new list containing only one copy of each element in the original\n     * list, based upon the value returned by applying the supplied function to\n     * each list element. Prefers the first item if the supplied function produces\n     * the same value on two items. `R.equals` is used for comparison.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.16.0\n     * @category List\n     * @sig (a -> b) -> [a] -> [a]\n     * @param {Function} fn A function used to produce a value to use during comparisons.\n     * @param {Array} list The array to consider.\n     * @return {Array} The list of unique items.\n     * @example\n     *\n     *      R.uniqBy(Math.abs, [-1, -5, 2, 10, 1, 2]); //=> [-1, -5, 2, 10]\n     */\n    var uniqBy = _curry2(function uniqBy(fn, list) {\n        var set = new _Set();\n        var result = [];\n        var idx = 0;\n        var appliedItem, item;\n        while (idx < list.length) {\n            item = list[idx];\n            appliedItem = fn(item);\n            if (set.add(appliedItem)) {\n                result.push(item);\n            }\n            idx += 1;\n        }\n        return result;\n    });\n\n    /**\n     * Returns the result of concatenating the given lists or strings.\n     *\n     * Dispatches to the `concat` method of the first argument, if present.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.1.0\n     * @category List\n     * @sig [a] -> [a] -> [a]\n     * @sig String -> String -> String\n     * @param {Array|String} a\n     * @param {Array|String} b\n     * @return {Array|String}\n     *\n     * @example\n     *\n     *      R.concat([], []); //=> []\n     *      R.concat([4, 5, 6], [1, 2, 3]); //=> [4, 5, 6, 1, 2, 3]\n     *      R.concat('ABC', 'DEF'); // 'ABCDEF'\n     */\n    var concat = flip(invoker(1, 'concat'));\n\n    /**\n     * Finds the set (i.e. no duplicates) of all elements contained in the first or\n     * second list, but not both.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.19.0\n     * @category Relation\n     * @sig [*] -> [*] -> [*]\n     * @param {Array} list1 The first list.\n     * @param {Array} list2 The second list.\n     * @return {Array} The elements in `list1` or `list2`, but not both.\n     * @see R.symmetricDifferenceWith\n     * @example\n     *\n     *      R.symmetricDifference([1,2,3,4], [7,6,5,4,3]); //=> [1,2,7,6,5]\n     *      R.symmetricDifference([7,6,5,4,3], [1,2,3,4]); //=> [7,6,5,1,2]\n     */\n    var symmetricDifference = _curry2(function symmetricDifference(list1, list2) {\n        return concat(difference(list1, list2), difference(list2, list1));\n    });\n\n    /**\n     * Finds the set (i.e. no duplicates) of all elements contained in the first or\n     * second list, but not both. Duplication is determined according to the value\n     * returned by applying the supplied predicate to two list elements.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.19.0\n     * @category Relation\n     * @sig (a -> a -> Boolean) -> [a] -> [a] -> [a]\n     * @param {Function} pred A predicate used to test whether two items are equal.\n     * @param {Array} list1 The first list.\n     * @param {Array} list2 The second list.\n     * @return {Array} The elements in `list1` or `list2`, but not both.\n     * @see R.symmetricDifference\n     * @example\n     *\n     *      var eqA = R.eqBy(R.prop('a'));\n     *      var l1 = [{a: 1}, {a: 2}, {a: 3}, {a: 4}];\n     *      var l2 = [{a: 3}, {a: 4}, {a: 5}, {a: 6}];\n     *      R.symmetricDifferenceWith(eqA, l1, l2); //=> [{a: 1}, {a: 2}, {a: 5}, {a: 6}]\n     */\n    var symmetricDifferenceWith = _curry3(function symmetricDifferenceWith(pred, list1, list2) {\n        return concat(differenceWith(pred, list1, list2), differenceWith(pred, list2, list1));\n    });\n\n    /**\n     * Returns a new list containing only one copy of each element in the original\n     * list. `R.equals` is used to determine equality.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.1.0\n     * @category List\n     * @sig [a] -> [a]\n     * @param {Array} list The array to consider.\n     * @return {Array} The list of unique items.\n     * @example\n     *\n     *      R.uniq([1, 1, 2, 1]); //=> [1, 2]\n     *      R.uniq([1, '1']);     //=> [1, '1']\n     *      R.uniq([[42], [42]]); //=> [[42]]\n     */\n    var uniq = uniqBy(identity);\n\n    /**\n     * Combines two lists into a set (i.e. no duplicates) composed of those\n     * elements common to both lists.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.1.0\n     * @category Relation\n     * @sig [*] -> [*] -> [*]\n     * @param {Array} list1 The first list.\n     * @param {Array} list2 The second list.\n     * @return {Array} The list of elements found in both `list1` and `list2`.\n     * @see R.intersectionWith\n     * @example\n     *\n     *      R.intersection([1,2,3,4], [7,6,5,4,3]); //=> [4, 3]\n     */\n    var intersection = _curry2(function intersection(list1, list2) {\n        var lookupList, filteredList;\n        if (list1.length > list2.length) {\n            lookupList = list1;\n            filteredList = list2;\n        } else {\n            lookupList = list2;\n            filteredList = list1;\n        }\n        return uniq(_filter(flip(_contains)(lookupList), filteredList));\n    });\n\n    /**\n     * Combines two lists into a set (i.e. no duplicates) composed of the elements\n     * of each list.\n     *\n     * @func\n     * @memberOf R\n     * @since v0.1.0\n     * @category Relation\n     * @sig [*] -> [*] -> [*]\n     * @param {Array} as The first list.\n     * @param {Array} bs The second list.\n     * @return {Array} The first and second lists concatenated, with\n     *         duplicates removed.\n     * @example\n     *\n     *      R.union([1, 2, 3], [2, 3, 4]); //=> [1, 2, 3, 4]\n     */\n    var union = _curry2(compose(uniq, _concat));\n\n    var R = {\n        F: F,\n        T: T,\n        __: __,\n        add: add,\n        addIndex: addIndex,\n        adjust: adjust,\n        all: all,\n        allPass: allPass,\n        allUniq: allUniq,\n        always: always,\n        and: and,\n        any: any,\n        anyPass: anyPass,\n        ap: ap,\n        aperture: aperture,\n        append: append,\n        apply: apply,\n        applySpec: applySpec,\n        assoc: assoc,\n        assocPath: assocPath,\n        binary: binary,\n        bind: bind,\n        both: both,\n        call: call,\n        chain: chain,\n        clamp: clamp,\n        clone: clone,\n        comparator: comparator,\n        complement: complement,\n        compose: compose,\n        composeK: composeK,\n        composeP: composeP,\n        concat: concat,\n        cond: cond,\n        construct: construct,\n        constructN: constructN,\n        contains: contains,\n        converge: converge,\n        countBy: countBy,\n        curry: curry,\n        curryN: curryN,\n        dec: dec,\n        defaultTo: defaultTo,\n        difference: difference,\n        differenceWith: differenceWith,\n        dissoc: dissoc,\n        dissocPath: dissocPath,\n        divide: divide,\n        drop: drop,\n        dropLast: dropLast,\n        dropLastWhile: dropLastWhile,\n        dropRepeats: dropRepeats,\n        dropRepeatsWith: dropRepeatsWith,\n        dropWhile: dropWhile,\n        either: either,\n        empty: empty,\n        eqBy: eqBy,\n        eqProps: eqProps,\n        equals: equals,\n        evolve: evolve,\n        filter: filter,\n        find: find,\n        findIndex: findIndex,\n        findLast: findLast,\n        findLastIndex: findLastIndex,\n        flatten: flatten,\n        flip: flip,\n        forEach: forEach,\n        fromPairs: fromPairs,\n        groupBy: groupBy,\n        groupWith: groupWith,\n        gt: gt,\n        gte: gte,\n        has: has,\n        hasIn: hasIn,\n        head: head,\n        identical: identical,\n        identity: identity,\n        ifElse: ifElse,\n        inc: inc,\n        indexBy: indexBy,\n        indexOf: indexOf,\n        init: init,\n        insert: insert,\n        insertAll: insertAll,\n        intersection: intersection,\n        intersectionWith: intersectionWith,\n        intersperse: intersperse,\n        into: into,\n        invert: invert,\n        invertObj: invertObj,\n        invoker: invoker,\n        is: is,\n        isArrayLike: isArrayLike,\n        isEmpty: isEmpty,\n        isNil: isNil,\n        join: join,\n        juxt: juxt,\n        keys: keys,\n        keysIn: keysIn,\n        last: last,\n        lastIndexOf: lastIndexOf,\n        length: length,\n        lens: lens,\n        lensIndex: lensIndex,\n        lensPath: lensPath,\n        lensProp: lensProp,\n        lift: lift,\n        liftN: liftN,\n        lt: lt,\n        lte: lte,\n        map: map,\n        mapAccum: mapAccum,\n        mapAccumRight: mapAccumRight,\n        mapObjIndexed: mapObjIndexed,\n        match: match,\n        mathMod: mathMod,\n        max: max,\n        maxBy: maxBy,\n        mean: mean,\n        median: median,\n        memoize: memoize,\n        merge: merge,\n        mergeAll: mergeAll,\n        mergeWith: mergeWith,\n        mergeWithKey: mergeWithKey,\n        min: min,\n        minBy: minBy,\n        modulo: modulo,\n        multiply: multiply,\n        nAry: nAry,\n        negate: negate,\n        none: none,\n        not: not,\n        nth: nth,\n        nthArg: nthArg,\n        objOf: objOf,\n        of: of,\n        omit: omit,\n        once: once,\n        or: or,\n        over: over,\n        pair: pair,\n        partial: partial,\n        partialRight: partialRight,\n        partition: partition,\n        path: path,\n        pathEq: pathEq,\n        pathOr: pathOr,\n        pathSatisfies: pathSatisfies,\n        pick: pick,\n        pickAll: pickAll,\n        pickBy: pickBy,\n        pipe: pipe,\n        pipeK: pipeK,\n        pipeP: pipeP,\n        pluck: pluck,\n        prepend: prepend,\n        product: product,\n        project: project,\n        prop: prop,\n        propEq: propEq,\n        propIs: propIs,\n        propOr: propOr,\n        propSatisfies: propSatisfies,\n        props: props,\n        range: range,\n        reduce: reduce,\n        reduceBy: reduceBy,\n        reduceRight: reduceRight,\n        reduced: reduced,\n        reject: reject,\n        remove: remove,\n        repeat: repeat,\n        replace: replace,\n        reverse: reverse,\n        scan: scan,\n        sequence: sequence,\n        set: set,\n        slice: slice,\n        sort: sort,\n        sortBy: sortBy,\n        split: split,\n        splitAt: splitAt,\n        splitEvery: splitEvery,\n        splitWhen: splitWhen,\n        subtract: subtract,\n        sum: sum,\n        symmetricDifference: symmetricDifference,\n        symmetricDifferenceWith: symmetricDifferenceWith,\n        tail: tail,\n        take: take,\n        takeLast: takeLast,\n        takeLastWhile: takeLastWhile,\n        takeWhile: takeWhile,\n        tap: tap,\n        test: test,\n        times: times,\n        toLower: toLower,\n        toPairs: toPairs,\n        toPairsIn: toPairsIn,\n        toString: toString,\n        toUpper: toUpper,\n        transduce: transduce,\n        transpose: transpose,\n        traverse: traverse,\n        trim: trim,\n        tryCatch: tryCatch,\n        type: type,\n        unapply: unapply,\n        unary: unary,\n        uncurryN: uncurryN,\n        unfold: unfold,\n        union: union,\n        unionWith: unionWith,\n        uniq: uniq,\n        uniqBy: uniqBy,\n        uniqWith: uniqWith,\n        unless: unless,\n        unnest: unnest,\n        until: until,\n        update: update,\n        useWith: useWith,\n        values: values,\n        valuesIn: valuesIn,\n        view: view,\n        when: when,\n        where: where,\n        whereEq: whereEq,\n        without: without,\n        wrap: wrap,\n        xprod: xprod,\n        zip: zip,\n        zipObj: zipObj,\n        zipWith: zipWith\n    };\n  /* eslint-env amd */\n\n  /* TEST_ENTRY_POINT */\n\n  if (typeof exports === 'object') {\n    module.exports = R;\n  } else if (typeof define === 'function' && define.amd) {\n    define(function() { return R; });\n  } else {\n    this.R = R;\n  }\n\n}.call(this));\n","(function (exports) {\n  exports.validate = validate;\n  exports.mixin = mixin;\n\n  //\n  // ### function validate (object, schema, options)\n  // #### {Object} object the object to validate.\n  // #### {Object} schema (optional) the JSON Schema to validate against.\n  // #### {Object} options (optional) options controlling the validation\n  //      process. See {@link #validate.defaults) for details.\n  // Validate <code>object</code> against a JSON Schema.\n  // If <code>object</code> is self-describing (i.e. has a\n  // <code>$schema</code> property), it will also be validated\n  // against the referenced schema. [TODO]: This behaviour bay be\n  // suppressed by setting the {@link #validate.options.???}\n  // option to <code>???</code>.[/TODO]\n  //\n  // If <code>schema</code> is not specified, and <code>object</code>\n  // is not self-describing, validation always passes.\n  //\n  // <strong>Note:</strong> in order to pass options but no schema,\n  // <code>schema</code> <em>must</em> be specified in the call to\n  // <code>validate()</code>; otherwise, <code>options</code> will\n  // be interpreted as the schema. <code>schema</code> may be passed\n  // as <code>null</code>, <code>undefinded</code>, or the empty object\n  // (<code>{}</code>) in this case.\n  //\n  function validate(object, schema, options) {\n    options = mixin({}, validate.defaults, options);\n    var errors = [];\n\n    if (schema.type === 'array')\n      validateProperty(object, object, '', schema, options, errors);\n    else\n      validateObject(object, schema, options, errors);\n\n    //\n    // TODO: self-described validation\n    // if (! options.selfDescribing) { ... }\n    //\n\n    return {\n      valid: !(errors.length),\n      errors: errors\n    };\n  };\n\n  /**\n   * Default validation options. Defaults can be overridden by\n   * passing an 'options' hash to {@link #validate}. They can\n   * also be set globally be changing the values in\n   * <code>validate.defaults</code> directly.\n   */\n  validate.defaults = {\n      /**\n       * <p>\n       * Enforce 'format' constraints.\n       * </p><p>\n       * <em>Default: <code>true</code></em>\n       * </p>\n       */\n      validateFormats: true,\n      /**\n       * <p>\n       * When {@link #validateFormats} is <code>true</code>,\n       * treat unrecognized formats as validation errors.\n       * </p><p>\n       * <em>Default: <code>false</code></em>\n       * </p>\n       *\n       * @see validation.formats for default supported formats.\n       */\n      validateFormatsStrict: false,\n      /**\n       * <p>\n       * When {@link #validateFormats} is <code>true</code>,\n       * also validate formats defined in {@link #validate.formatExtensions}.\n       * </p><p>\n       * <em>Default: <code>true</code></em>\n       * </p>\n       */\n      validateFormatExtensions: true,\n      /**\n       * <p>\n       * When {@link #additionalProperties} is <code>true</code>,\n       * allow additional unvisited properties on the object.\n       * </p><p>\n       * <em>Default: <code>true</code></em>\n       * </p>\n       */\n      additionalProperties: true\n  };\n\n  /**\n   * Default messages to include with validation errors.\n   */\n  validate.messages = {\n      required:             \"is required\",\n      allowEmpty:           \"must not be empty\",\n      minLength:            \"is too short (minimum is %{expected} characters)\",\n      maxLength:            \"is too long (maximum is %{expected} characters)\",\n      pattern:              \"invalid input\",\n      minimum:              \"must be greater than or equal to %{expected}\",\n      maximum:              \"must be less than or equal to %{expected}\",\n      exclusiveMinimum:     \"must be greater than %{expected}\",\n      exclusiveMaximum:     \"must be less than %{expected}\",\n      divisibleBy:          \"must be divisible by %{expected}\",\n      minItems:             \"must contain more than %{expected} items\",\n      maxItems:             \"must contain less than %{expected} items\",\n      uniqueItems:          \"must hold a unique set of values\",\n      format:               \"is not a valid %{expected}\",\n      conform:              \"must conform to given constraint\",\n      type:                 \"must be of %{expected} type\",\n      additionalProperties: \"must not exist\"\n  };\n  validate.messages['enum'] = \"must be present in given enumerator\";\n\n  /**\n   *\n   */\n  validate.formats = {\n    'email':          /^((([a-z]|\\d|[!#\\$%&'\\*\\+\\-\\/=\\?\\^_`{\\|}~]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])+(\\.([a-z]|\\d|[!#\\$%&'\\*\\+\\-\\/=\\?\\^_`{\\|}~]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])+)*)|((\\x22)((((\\x20|\\x09)*(\\x0d\\x0a))?(\\x20|\\x09)+)?(([\\x01-\\x08\\x0b\\x0c\\x0e-\\x1f\\x7f]|\\x21|[\\x23-\\x5b]|[\\x5d-\\x7e]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])|(\\\\([\\x01-\\x09\\x0b\\x0c\\x0d-\\x7f]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF]))))*(((\\x20|\\x09)*(\\x0d\\x0a))?(\\x20|\\x09)+)?(\\x22)))@((([a-z]|\\d|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])|(([a-z]|\\d|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])([a-z]|\\d|-|\\.|_|~|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])*([a-z]|\\d|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])))\\.)+(([a-z]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])|(([a-z]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])([a-z]|\\d|-|\\.|_|~|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])*([a-z]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])))\\.?$/i,\n    'ip-address':     /^(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/i,\n    'ipv6':           /^([0-9A-Fa-f]{1,4}:){7}[0-9A-Fa-f]{1,4}$/,\n    'date-time':      /^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}(?:.\\d{1,3})?Z$/,\n    'date':           /^\\d{4}-\\d{2}-\\d{2}$/,\n    'time':           /^\\d{2}:\\d{2}:\\d{2}$/,\n    'color':          /^#[a-z0-9]{6}|#[a-z0-9]{3}|(?:rgb\\(\\s*(?:[+-]?\\d+%?)\\s*,\\s*(?:[+-]?\\d+%?)\\s*,\\s*(?:[+-]?\\d+%?)\\s*\\))aqua|black|blue|fuchsia|gray|green|lime|maroon|navy|olive|orange|purple|red|silver|teal|white|yellow$/i,\n    //'style':        (not supported)\n    //'phone':        (not supported)\n    //'uri':          (not supported)\n    'host-name':      /^(([a-zA-Z]|[a-zA-Z][a-zA-Z0-9\\-]*[a-zA-Z0-9])\\.)*([A-Za-z]|[A-Za-z][A-Za-z0-9\\-]*[A-Za-z0-9])/,\n    'utc-millisec':   {\n      test: function (value) {\n        return typeof(value) === 'number' && value >= 0;\n      }\n    },\n    'regex':          {\n      test: function (value) {\n        try { new RegExp(value) }\n        catch (e) { return false }\n\n        return true;\n      }\n    }\n  };\n\n  /**\n   *\n   */\n  validate.formatExtensions = {\n    'url': /^(https?|ftp|git):\\/\\/(((([a-z]|\\d|-|\\.|_|~|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])|(%[\\da-f]{2})|[!\\$&'\\(\\)\\*\\+,;=]|:)*@)?(((\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])\\.(\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])\\.(\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])\\.(\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5]))|((([a-z]|\\d|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])|(([a-z]|\\d|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])([a-z]|\\d|-|\\.|_|~|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])*([a-z]|\\d|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])))\\.)+(([a-z]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])|(([a-z]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])([a-z]|\\d|-|\\.|_|~|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])*([a-z]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])))\\.?)(:\\d*)?)(\\/((([a-z]|\\d|-|\\.|_|~|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])|(%[\\da-f]{2})|[!\\$&'\\(\\)\\*\\+,;=]|:|@)+(\\/(([a-z]|\\d|-|\\.|_|~|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])|(%[\\da-f]{2})|[!\\$&'\\(\\)\\*\\+,;=]|:|@)*)*)?)?(\\?((([a-z]|\\d|-|\\.|_|~|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])|(%[\\da-f]{2})|[!\\$&'\\(\\)\\*\\+,;=]|:|@)|[\\uE000-\\uF8FF]|\\/|\\?)*)?(\\#((([a-z]|\\d|-|\\.|_|~|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])|(%[\\da-f]{2})|[!\\$&'\\(\\)\\*\\+,;=]|:|@)|\\/|\\?)*)?$/i\n  };\n\n  function mixin(obj) {\n    var sources = Array.prototype.slice.call(arguments, 1);\n    while (sources.length) {\n      var source = sources.shift();\n      if (!source) { continue }\n\n      if (typeof(source) !== 'object') {\n        throw new TypeError('mixin non-object');\n      }\n\n      for (var p in source) {\n        if (source.hasOwnProperty(p)) {\n          obj[p] = source[p];\n        }\n      }\n    }\n\n    return obj;\n  };\n\n  function validateObject(object, schema, options, errors) {\n    var props, allProps = Object.keys(object),\n        visitedProps = [];\n\n    // see 5.2\n    if (schema.properties) {\n      props = schema.properties;\n      for (var p in props) {\n        if (props.hasOwnProperty(p)) {\n          visitedProps.push(p);\n          validateProperty(object, object[p], p, props[p], options, errors);\n        }\n      }\n    }\n\n    // see 5.3\n    if (schema.patternProperties) {\n      props = schema.patternProperties;\n      for (var p in props) {\n        if (props.hasOwnProperty(p)) {\n          var re = new RegExp(p);\n\n          // Find all object properties that are matching `re`\n          for (var k in object) {\n            if (object.hasOwnProperty(k)) {\n              if (re.exec(k) !== null) {\n                validateProperty(object, object[k], k, props[p], options, errors);\n                visitedProps.push(k);\n              }\n            }\n          }\n        }\n      }\n    }\n\n    //if additionalProperties is not defined set default value\n    if (schema.additionalProperties === undefined) {\n      schema.additionalProperties = options.additionalProperties;\n    }\n\n    // see 5.4\n    if (undefined !== schema.additionalProperties) {\n      var i, l;\n\n      var unvisitedProps = allProps.filter(function(k){\n        return -1 === visitedProps.indexOf(k);\n      });\n\n      // Prevent additional properties; each unvisited property is therefore an error\n      if (schema.additionalProperties === false && unvisitedProps.length > 0) {\n        for (i = 0, l = unvisitedProps.length; i < l; i++) {\n          error(\"additionalProperties\", unvisitedProps[i], object[unvisitedProps[i]], false, errors);\n        }\n      }\n      // additionalProperties is a schema and validate unvisited properties against that schema\n      else if (typeof schema.additionalProperties == \"object\" && unvisitedProps.length > 0) {\n        for (i = 0, l = unvisitedProps.length; i < l; i++) {\n          validateProperty(object, object[unvisitedProps[i]], unvisitedProps[i], schema.unvisitedProperties, options, errors);\n        }\n      }\n    }\n\n  };\n\n  function validateProperty(object, value, property, schema, options, errors) {\n    var format,\n        valid,\n        spec,\n        type;\n\n    function constrain(name, value, assert) {\n      if (schema[name] !== undefined && !assert(value, schema[name])) {\n        error(name, property, value, schema, errors);\n      }\n    }\n\n    if (value === undefined) {\n      if (schema.required && schema.type !== 'any') {\n        return error('required', property, undefined, schema, errors);\n      } else {\n        return;\n      }\n    }\n\n    if (options.cast) {\n      if (('integer' === schema.type || 'number' === schema.type) && value == +value) {\n        value = +value;\n        object[property] = value;\n      }\n\n      if ('boolean' === schema.type) {\n        if ('true' === value || '1' === value || 1 === value) {\n          value = true;\n          object[property] = value;\n        }\n\n        if ('false' === value || '0' === value || 0 === value) {\n          value = false;\n          object[property] = value;\n        }\n      }\n    }\n\n    if (schema.format && options.validateFormats) {\n      format = schema.format;\n\n      if (options.validateFormatExtensions) { spec = validate.formatExtensions[format] }\n      if (!spec) { spec = validate.formats[format] }\n      if (!spec) {\n        if (options.validateFormatsStrict) {\n          return error('format', property, value, schema, errors);\n        }\n      }\n      else {\n        if (!spec.test(value)) {\n          return error('format', property, value, schema, errors);\n        }\n      }\n    }\n\n    if (schema['enum'] && schema['enum'].indexOf(value) === -1) {\n      error('enum', property, value, schema, errors);\n    }\n\n    // Dependencies (see 5.8)\n    if (typeof schema.dependencies === 'string' &&\n        object[schema.dependencies] === undefined) {\n      error('dependencies', property, null, schema, errors);\n    }\n\n    if (isArray(schema.dependencies)) {\n      for (var i = 0, l = schema.dependencies.length; i < l; i++) {\n        if (object[schema.dependencies[i]] === undefined) {\n          error('dependencies', property, null, schema, errors);\n        }\n      }\n    }\n\n    if (typeof schema.dependencies === 'object') {\n      validateObject(object, schema.dependencies, options, errors);\n    }\n\n    checkType(value, schema.type, function(err, type) {\n      if (err) return error('type', property, typeof value, schema, errors);\n\n      constrain('conform', value, function (a, e) { return e(a, object) });\n\n      switch (type || (isArray(value) ? 'array' : typeof value)) {\n        case 'string':\n          constrain('allowEmpty', value,        function (a, e) { return e ? e : a !== '' });\n          constrain('minLength',  value.length, function (a, e) { return a >= e });\n          constrain('maxLength',  value.length, function (a, e) { return a <= e });\n          constrain('pattern',    value,        function (a, e) {\n            e = typeof e === 'string'\n              ? e = new RegExp(e)\n              : e;\n            return e.test(a)\n          });\n          break;\n        case 'integer':\n        case 'number':\n          constrain('minimum',     value, function (a, e) { return a >= e });\n          constrain('maximum',     value, function (a, e) { return a <= e });\n          constrain('exclusiveMinimum', value, function (a, e) { return a > e });\n          constrain('exclusiveMaximum', value, function (a, e) { return a < e });\n          constrain('divisibleBy', value, function (a, e) {\n            var multiplier = Math.max((a - Math.floor(a)).toString().length - 2, (e - Math.floor(e)).toString().length - 2);\n            multiplier = multiplier > 0 ? Math.pow(10, multiplier) : 1;\n            return (a * multiplier) % (e * multiplier) === 0\n          });\n          break;\n        case 'array':\n          constrain('items', value, function (a, e) {\n            var nestedErrors;\n            for (var i = 0, l = a.length; i < l; i++) {\n              nestedErrors = [];\n              validateProperty(object, a[i], property, e, options, nestedErrors);\n              nestedErrors.forEach(function (err) {\n                err.property =\n                  (property ? property + '.' : '') +\n                  i +\n                  (err.property ? '.' + err.property.replace(property + '.', '') : '');\n              });\n              nestedErrors.unshift(0, 0);\n              Array.prototype.splice.apply(errors, nestedErrors);\n            }\n            return true;\n          });\n          constrain('minItems', value, function (a, e) { return a.length >= e });\n          constrain('maxItems', value, function (a, e) { return a.length <= e });\n          constrain('uniqueItems', value, function (a, e) {\n            if (!e) return true;\n\n            var h = {};\n\n            for (var i = 0, l = a.length; i < l; i++) {\n              var key = JSON.stringify(a[i]);\n              if (h[key]) return false;\n              h[key] = true;\n            }\n\n            return true;\n          });\n          break;\n        case 'object':\n          // Recursive validation\n          if (schema.properties || schema.patternProperties || schema.additionalProperties) {\n            var nestedErrors = [];\n            validateObject(value, schema, options, nestedErrors);\n            nestedErrors.forEach(function (e) {\n              e.property = property + '.' + e.property\n            });\n            nestedErrors.unshift(0, 0);\n            Array.prototype.splice.apply(errors, nestedErrors);\n          }\n          break;\n      }\n    });\n  };\n\n  function checkType(val, type, callback) {\n    var result = false,\n        types = isArray(type) ? type : [type];\n\n    // No type - no check\n    if (type === undefined) return callback(null, type);\n\n    // Go through available types\n    // And fine first matching\n    for (var i = 0, l = types.length; i < l; i++) {\n      type = types[i].toLowerCase().trim();\n      if (type === 'string' ? typeof val === 'string' :\n          type === 'array' ? isArray(val) :\n          type === 'object' ? val && typeof val === 'object' &&\n                             !isArray(val) :\n          type === 'number' ? typeof val === 'number' :\n          type === 'integer' ? typeof val === 'number' && Math.floor(val) === val :\n          type === 'null' ? val === null :\n          type === 'boolean'? typeof val === 'boolean' :\n          type === 'date' ? isDate(val) :\n          type === 'any' ? typeof val !== 'undefined' : false) {\n        return callback(null, type);\n      }\n    };\n\n    callback(true);\n  };\n\n  function error(attribute, property, actual, schema, errors) {\n    var lookup = { expected: schema[attribute], actual: actual, attribute: attribute, property: property };\n    var message = schema.messages && schema.messages[attribute] || schema.message || validate.messages[attribute] || \"no default message\";\n    message = message.replace(/%\\{([a-z]+)\\}/ig, function (_, match) { return lookup[match.toLowerCase()] || ''; });\n    errors.push({\n      attribute: attribute,\n      property:  property,\n      expected:  schema[attribute],\n      actual:    actual,\n      message:   message\n    });\n  };\n\n  function isArray(value) {\n    var s = typeof value;\n    if (s === 'object') {\n      if (value) {\n        if (typeof value.length === 'number' &&\n           !(value.propertyIsEnumerable('length')) &&\n           typeof value.splice === 'function') {\n           return true;\n        }\n      }\n    }\n    return false;\n  }\n\n  function isDate(value) {\n    var s = typeof value;\n    if (s === 'object') {\n      if (value) {\n        if (typeof value.getTime === 'function') {\n          return true;\n        }\n      }\n    }\n\n    return false;\n  }\n\n})(typeof module === 'object' && module && module.exports ? module.exports : window);\n"],"sourceRoot":"/source/"}